# Comparing `tmp/grizli-1.9.tar.gz` & `tmp/grizli-1.9.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "grizli-1.9.tar", last modified: Tue Jul 11 20:02:22 2023, max compression
+gzip compressed data, was "grizli-1.9.1.tar", last modified: Thu Aug  3 08:13:12 2023, max compression
```

## Comparing `grizli-1.9.tar` & `grizli-1.9.1.tar`

### file list

```diff
@@ -1,211 +1,212 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.779851 grizli-1.9/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.719851 grizli-1.9/.github/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.727851 grizli-1.9/.github/workflows/
--rw-r--r--   0 runner    (1001) docker     (123)     1594 2023-07-11 20:02:07.000000 grizli-1.9/.github/workflows/publish-to-pypi.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-07-11 20:02:07.000000 grizli-1.9/.github/workflows/python-package-ero.yml
--rw-r--r--   0 runner    (1001) docker     (123)      926 2023-07-11 20:02:07.000000 grizli-1.9/.github/workflows/python-package-with-jwst.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1797 2023-07-11 20:02:07.000000 grizli-1.9/.github/workflows/python-package.yml
--rw-r--r--   0 runner    (1001) docker     (123)      936 2023-07-11 20:02:07.000000 grizli-1.9/.gitignore
--rw-r--r--   0 runner    (1001) docker     (123)      556 2023-07-11 20:02:07.000000 grizli-1.9/.readthedocs.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1094 2023-07-11 20:02:07.000000 grizli-1.9/.travis.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1089 2023-07-11 20:02:07.000000 grizli-1.9/CHANGES.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1180 2023-07-11 20:02:07.000000 grizli-1.9/CITATION.cff
--rw-r--r--   0 runner    (1001) docker     (123)     1084 2023-07-11 20:02:07.000000 grizli-1.9/LICENSE.txt
--rw-r--r--   0 runner    (1001) docker     (123)     6825 2023-07-11 20:02:22.779851 grizli-1.9/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     6095 2023-07-11 20:02:07.000000 grizli-1.9/README.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.727851 grizli-1.9/docs/
--rw-r--r--   0 runner    (1001) docker     (123)     4581 2023-07-11 20:02:07.000000 grizli-1.9/docs/Makefile
--rw-r--r--   0 runner    (1001) docker     (123)      111 2023-07-11 20:02:07.000000 grizli-1.9/docs/README.rst
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.727851 grizli-1.9/docs/_static/
--rw-r--r--   0 runner    (1001) docker     (123)     4286 2023-07-11 20:02:07.000000 grizli-1.9/docs/_static/grizli.ico
--rw-r--r--   0 runner    (1001) docker     (123)      986 2023-07-11 20:02:07.000000 grizli-1.9/docs/_static/grizli_favico.png
--rw-r--r--   0 runner    (1001) docker     (123)    35735 2023-07-11 20:02:07.000000 grizli-1.9/docs/_static/grizli_favico_large.png
--rw-r--r--   0 runner    (1001) docker     (123)   193903 2023-07-11 20:02:07.000000 grizli-1.9/docs/_static/grizli_logo.pdf
--rw-r--r--   0 runner    (1001) docker     (123)    18807 2023-07-11 20:02:07.000000 grizli-1.9/docs/_static/grizli_logo.png
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.719851 grizli-1.9/docs/_templates/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.727851 grizli-1.9/docs/_templates/autosummary/
--rw-r--r--   0 runner    (1001) docker     (123)      250 2023-07-11 20:02:07.000000 grizli-1.9/docs/_templates/autosummary/base.rst
--rw-r--r--   0 runner    (1001) docker     (123)      251 2023-07-11 20:02:07.000000 grizli-1.9/docs/_templates/autosummary/class.rst
--rw-r--r--   0 runner    (1001) docker     (123)      252 2023-07-11 20:02:07.000000 grizli-1.9/docs/_templates/autosummary/module.rst
--rw-r--r--   0 runner    (1001) docker     (123)       75 2023-07-11 20:02:07.000000 grizli-1.9/docs/changelog.rst
--rw-r--r--   0 runner    (1001) docker     (123)     6794 2023-07-11 20:02:07.000000 grizli-1.9/docs/conf.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.731851 grizli-1.9/docs/grizli/
--rw-r--r--   0 runner    (1001) docker     (123)       86 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli/basic.rst
--rw-r--r--   0 runner    (1001) docker     (123)   851247 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli/ceers-sm.field.jpg
--rw-r--r--   0 runner    (1001) docker     (123)    98779 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli/image-release-v6.md
--rw-r--r--   0 runner    (1001) docker     (123)    65882 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli/image-release-v6.rst
--rw-r--r--   0 runner    (1001) docker     (123)     1176 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)     7704 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli/install.rst
--rw-r--r--   0 runner    (1001) docker     (123)      676 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli/prep.rst
--rw-r--r--   0 runner    (1001) docker     (123)    38260 2023-07-11 20:02:07.000000 grizli-1.9/docs/grizli-for-dummies.rst
--rw-r--r--   0 runner    (1001) docker     (123)     6655 2023-07-11 20:02:07.000000 grizli-1.9/docs/index.rst
--rw-r--r--   0 runner    (1001) docker     (123)     4549 2023-07-11 20:02:07.000000 grizli-1.9/docs/make.bat
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-07-11 20:02:07.000000 grizli-1.9/docs/rtd-pip-requirements
--rw-r--r--   0 runner    (1001) docker     (123)      189 2023-07-11 20:02:07.000000 grizli-1.9/environment.yml
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.731851 grizli-1.9/examples/
--rw-r--r--   0 runner    (1001) docker     (123)      257 2023-07-11 20:02:07.000000 grizli-1.9/examples/README.md
--rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-07-11 20:02:07.000000 grizli-1.9/examples/demo.py
--rw-r--r--   0 runner    (1001) docker     (123)    20658 2023-07-11 20:02:07.000000 grizli-1.9/examples/grizli_demo_0.pdf
--rw-r--r--   0 runner    (1001) docker     (123)   100981 2023-07-11 20:02:07.000000 grizli-1.9/examples/grizli_demo_1.pdf
--rw-r--r--   0 runner    (1001) docker     (123)   193903 2023-07-11 20:02:07.000000 grizli-1.9/examples/grizli_logo.pdf
--rw-r--r--   0 runner    (1001) docker     (123)    18807 2023-07-11 20:02:07.000000 grizli-1.9/examples/grizli_logo.png
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.735851 grizli-1.9/grizli/
--rw-r--r--   0 runner    (1001) docker     (123)      748 2023-07-11 20:02:07.000000 grizli-1.9/grizli/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.739851 grizli-1.9/grizli/aws/
--rw-r--r--   0 runner    (1001) docker     (123)      137 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    46339 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/aws_drizzler.py
--rw-r--r--   0 runner    (1001) docker     (123)   131901 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/db.py
--rw-r--r--   0 runner    (1001) docker     (123)    45124 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/field_tiles.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     9609 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/fit_redshift_lambda.py
--rw-r--r--   0 runner    (1001) docker     (123)    32480 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/lambda_handler.py
--rw-r--r--   0 runner    (1001) docker     (123)    56360 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/tile_mosaic.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    89873 2023-07-11 20:02:07.000000 grizli-1.9/grizli/aws/visit_processor.py
--rw-r--r--   0 runner    (1001) docker     (123)    40400 2023-07-11 20:02:07.000000 grizli-1.9/grizli/catalog.py
--rw-r--r--   0 runner    (1001) docker     (123)    19411 2023-07-11 20:02:07.000000 grizli-1.9/grizli/combine.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.747851 grizli-1.9/grizli/data/
--rw-r--r--   0 runner    (1001) docker     (123)     9295 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/auto_script_defaults.yml
--rw-r--r--   0 runner    (1001) docker     (123)      107 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/db.yml
--rw-r--r--   0 runner    (1001) docker     (123)     3639 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/gaia_dr2_vizier_columns.txt
--rw-r--r--   0 runner    (1001) docker     (123)    20160 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/hst_encircled_energy.fits
--rw-r--r--   0 runner    (1001) docker     (123)    11962 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/jwst_bp_info.yml
--rw-r--r--   0 runner    (1001) docker     (123)     1167 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nircam_wisp.yml
--rw-r--r--   0 runner    (1001) docker     (123)   126417 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nis_badpix_20230710.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)   132526 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_badpix_20230710_NRCALONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)   108369 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_badpix_20230710_NRCBLONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    47343 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_badpix_230120_NRCALONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    39840 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_badpix_230120_NRCBLONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    48187 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_badpix_230701_NRCALONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    40431 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_badpix_230701_NRCBLONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    17258 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA1.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    16916 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA2.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    16627 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA3.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    16943 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA4.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    35486 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCALONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    18003 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB1.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    16764 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB2.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    16962 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB3.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    16851 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB4.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    22659 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/nrc_lowpix_0916_NRCBLONG.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)     5043 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/photom_correction.yml
--rw-r--r--   0 runner    (1001) docker     (123)    97707 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/sep_catalog_junk.pkl
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.751851 grizli-1.9/grizli/data/templates/
--rw-r--r--   0 runner    (1001) docker     (123)    94256 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/FeII_VeronCetty2004.txt
--rw-r--r--   0 runner    (1001) docker     (123)      654 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/README
--rw-r--r--   0 runner    (1001) docker     (123)   221907 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/alf_SSP.dat
--rw-r--r--   0 runner    (1001) docker     (123)    48158 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/cvd12_t11_solar_Chabrier.dat
--rw-r--r--   0 runner    (1001) docker     (123)    51300 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/eazy_intermediate.dat
--rw-r--r--   0 runner    (1001) docker     (123)    44824 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/erb2010.dat
--rw-r--r--   0 runner    (1001) docker     (123)    31746 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/erb2010_continuum.dat
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.759851 grizli-1.9/grizli/data/templates/fsps/
--rw-r--r--   0 runner    (1001) docker     (123)      591 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3.param
--rw-r--r--   0 runner    (1001) docker     (123)    11520 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3.param.fits
--rw-r--r--   0 runner    (1001) docker     (123)   156520 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_001.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156521 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_002.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_003.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156527 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_004.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_005.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156523 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_006.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156509 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_007.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156510 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_008.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156511 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_009.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156512 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_010.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_011.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_012.dat
--rw-r--r--   0 runner    (1001) docker     (123)      687 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines.param
--rw-r--r--   0 runner    (1001) docker     (123)   156520 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_001.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156521 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_002.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_003.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156527 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_004.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_005.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156523 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_006.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156509 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_007.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156510 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_008.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156511 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_009.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156512 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_010.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_011.dat
--rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_012.dat
--rw-r--r--   0 runner    (1001) docker     (123)   143958 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/fsps_starburst_lines.txt
--rw-r--r--   0 runner    (1001) docker     (123)    12636 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/post_starburst.dat
--rw-r--r--   0 runner    (1001) docker     (123)   557728 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/quasar_lines.txt
--rw-r--r--   0 runner    (1001) docker     (123)   382216 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/red_blue_continuum.txt
--rw-r--r--   0 runner    (1001) docker     (123)   381266 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/red_blue_continuum_noLya.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.767851 grizli-1.9/grizli/data/templates/stars/
--rw-r--r--   0 runner    (1001) docker     (123)   173069 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/L1.0.txt
--rw-r--r--   0 runner    (1001) docker     (123)   145419 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/L3.5.txt
--rw-r--r--   0 runner    (1001) docker     (123)    26044 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/L6.0.txt
--rw-r--r--   0 runner    (1001) docker     (123)   159659 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/M6.5.txt
--rw-r--r--   0 runner    (1001) docker     (123)   166768 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/M8.0.txt
--rw-r--r--   0 runner    (1001) docker     (123)    57965 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/T2.0.txt
--rw-r--r--   0 runner    (1001) docker     (123)    55327 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/T6.0.txt
--rw-r--r--   0 runner    (1001) docker     (123)     8115 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/T7.5.txt
--rw-r--r--   0 runner    (1001) docker     (123)  3193920 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/bt-settl_t400-3500_z0.0.fits
--rw-r--r--   0 runner    (1001) docker     (123)    83291 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/carbon_star.txt
--rw-r--r--   0 runner    (1001) docker     (123)      175 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/templates/stars/stars_settl.param
--rw-r--r--   0 runner    (1001) docker     (123)   299891 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/visit_alignment.txt
--rw-r--r--   0 runner    (1001) docker     (123)    54096 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/wfc3ir_badpix_spars200_22.03.31.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    23739 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/wfc3ir_dark_badpix_2019.01.12.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)     1057 2023-07-11 20:02:07.000000 grizli-1.9/grizli/data/wfc3ir_ee.txt
--rw-r--r--   0 runner    (1001) docker     (123)     5521 2023-07-11 20:02:07.000000 grizli-1.9/grizli/ds9.py
--rw-r--r--   0 runner    (1001) docker     (123)    17575 2023-07-11 20:02:07.000000 grizli-1.9/grizli/fake_image.py
--rw-r--r--   0 runner    (1001) docker     (123)   185637 2023-07-11 20:02:07.000000 grizli-1.9/grizli/fitting.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.767851 grizli-1.9/grizli/galfit/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:07.000000 grizli-1.9/grizli/galfit/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    15242 2023-07-11 20:02:07.000000 grizli-1.9/grizli/galfit/deconvolve.py
--rw-r--r--   0 runner    (1001) docker     (123)    25223 2023-07-11 20:02:07.000000 grizli-1.9/grizli/galfit/galfit.py
--rw-r--r--   0 runner    (1001) docker     (123)     4926 2023-07-11 20:02:07.000000 grizli-1.9/grizli/galfit/gfutils.py
--rw-r--r--   0 runner    (1001) docker     (123)    16595 2023-07-11 20:02:07.000000 grizli-1.9/grizli/galfit/psf.py
--rw-r--r--   0 runner    (1001) docker     (123)    40681 2023-07-11 20:02:07.000000 grizli-1.9/grizli/grismconf.py
--rw-r--r--   0 runner    (1001) docker     (123)    35836 2023-07-11 20:02:07.000000 grizli-1.9/grizli/jwst_level1.py
--rw-r--r--   0 runner    (1001) docker     (123)    77490 2023-07-11 20:02:07.000000 grizli-1.9/grizli/jwst_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)   203738 2023-07-11 20:02:07.000000 grizli-1.9/grizli/model.py
--rw-r--r--   0 runner    (1001) docker     (123)   204523 2023-07-11 20:02:07.000000 grizli-1.9/grizli/multifit.py
--rw-r--r--   0 runner    (1001) docker     (123)     2872 2023-07-11 20:02:07.000000 grizli-1.9/grizli/nbutils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.767851 grizli-1.9/grizli/pipeline/
--rw-r--r--   0 runner    (1001) docker     (123)     1147 2023-07-11 20:02:07.000000 grizli-1.9/grizli/pipeline/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   225369 2023-07-11 20:02:07.000000 grizli-1.9/grizli/pipeline/auto_script.py
--rw-r--r--   0 runner    (1001) docker     (123)     8267 2023-07-11 20:02:07.000000 grizli-1.9/grizli/pipeline/default_params.py
--rw-r--r--   0 runner    (1001) docker     (123)    32411 2023-07-11 20:02:07.000000 grizli-1.9/grizli/pipeline/photoz.py
--rw-r--r--   0 runner    (1001) docker     (123)     6729 2023-07-11 20:02:07.000000 grizli-1.9/grizli/pipeline/reprocess.py
--rw-r--r--   0 runner    (1001) docker     (123)     1485 2023-07-11 20:02:07.000000 grizli-1.9/grizli/pipeline/run_MPI.py
--rw-r--r--   0 runner    (1001) docker     (123)     8973 2023-07-11 20:02:07.000000 grizli-1.9/grizli/pipeline/summary.py
--rw-r--r--   0 runner    (1001) docker     (123)   259968 2023-07-11 20:02:07.000000 grizli-1.9/grizli/prep.py
--rwxr-xr-x   0 runner    (1001) docker     (123)    49392 2023-07-11 20:02:07.000000 grizli-1.9/grizli/stack.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.771851 grizli-1.9/grizli/tests/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.771851 grizli-1.9/grizli/tests/data/
--rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/fit_args.npy
--rw-r--r--   0 runner    (1001) docker     (123)   812160 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/j033216m2743_00152.beams.fits
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.775851 grizli-1.9/grizli/tests/data/jwst-headers/
--rw-r--r--   0 runner    (1001) docker     (123)      116 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/jwst-headers/README.rst
--rw-r--r--   0 runner    (1001) docker     (123)    28024 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/jwst-headers/det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    47863 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca1_rate.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    47877 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca2_rate.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    47996 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca5_uncal_dispersed_GRISMR_crossing_F356W_rate.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)    47827 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01105_00002_nrca5_rate.fits.gz
--rw-r--r--   0 runner    (1001) docker     (123)      546 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/jwst-headers/strip_data.py
--rw-r--r--   0 runner    (1001) docker     (123)   509760 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/niriss_jw01324001001_test.beams.fits
--rw-r--r--   0 runner    (1001) docker     (123)  1120244 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/data/wfc3-parse-test.tar.gz
--rw-r--r--   0 runner    (1001) docker     (123)     2800 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/test_autoscript.py
--rw-r--r--   0 runner    (1001) docker     (123)      832 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/test_cutils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2478 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/test_fits.py
--rw-r--r--   0 runner    (1001) docker     (123)     1895 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/test_grismconf.py
--rw-r--r--   0 runner    (1001) docker     (123)     8532 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/test_jwst.py
--rw-r--r--   0 runner    (1001) docker     (123)     8525 2023-07-11 20:02:07.000000 grizli-1.9/grizli/tests/test_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)   304261 2023-07-11 20:02:07.000000 grizli-1.9/grizli/utils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.779851 grizli-1.9/grizli/utils_c/
--rw-r--r--   0 runner    (1001) docker     (123)      178 2023-07-11 20:02:07.000000 grizli-1.9/grizli/utils_c/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   335228 2023-07-11 20:02:21.000000 grizli-1.9/grizli/utils_c/disperse.c
--rw-r--r--   0 runner    (1001) docker     (123)     4083 2023-07-11 20:02:07.000000 grizli-1.9/grizli/utils_c/disperse.pyx
--rw-r--r--   0 runner    (1001) docker     (123)   659882 2023-07-11 20:02:21.000000 grizli-1.9/grizli/utils_c/interp.c
--rw-r--r--   0 runner    (1001) docker     (123)    16229 2023-07-11 20:02:07.000000 grizli-1.9/grizli/utils_c/interp.pyx
--rw-r--r--   0 runner    (1001) docker     (123)      155 2023-07-11 20:02:22.000000 grizli-1.9/grizli/version.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-11 20:02:22.739851 grizli-1.9/grizli.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     6825 2023-07-11 20:02:22.000000 grizli-1.9/grizli.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     6609 2023-07-11 20:02:22.000000 grizli-1.9/grizli.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-11 20:02:22.000000 grizli-1.9/grizli.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)      430 2023-07-11 20:02:22.000000 grizli-1.9/grizli.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        7 2023-07-11 20:02:22.000000 grizli-1.9/grizli.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)      229 2023-07-11 20:02:07.000000 grizli-1.9/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-07-11 20:02:22.779851 grizli-1.9/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)      841 2023-07-11 20:02:07.000000 grizli-1.9/setup.py
--rw-r--r--   0 runner    (1001) docker     (123)    13630 2023-07-11 20:02:07.000000 grizli-1.9/test_pipeline_hst.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.729345 grizli-1.9.1/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.665344 grizli-1.9.1/.github/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.677344 grizli-1.9.1/.github/workflows/
+-rw-r--r--   0 runner    (1001) docker     (123)     1594 2023-08-03 08:12:59.000000 grizli-1.9.1/.github/workflows/publish-to-pypi.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-08-03 08:12:59.000000 grizli-1.9.1/.github/workflows/python-package-ero.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      926 2023-08-03 08:12:59.000000 grizli-1.9.1/.github/workflows/python-package-with-jwst.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1797 2023-08-03 08:12:59.000000 grizli-1.9.1/.github/workflows/python-package.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      936 2023-08-03 08:12:59.000000 grizli-1.9.1/.gitignore
+-rw-r--r--   0 runner    (1001) docker     (123)      556 2023-08-03 08:12:59.000000 grizli-1.9.1/.readthedocs.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1094 2023-08-03 08:12:59.000000 grizli-1.9.1/.travis.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1089 2023-08-03 08:12:59.000000 grizli-1.9.1/CHANGES.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1180 2023-08-03 08:12:59.000000 grizli-1.9.1/CITATION.cff
+-rw-r--r--   0 runner    (1001) docker     (123)     1084 2023-08-03 08:12:59.000000 grizli-1.9.1/LICENSE.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     6827 2023-08-03 08:13:12.729345 grizli-1.9.1/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     6095 2023-08-03 08:12:59.000000 grizli-1.9.1/README.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.681344 grizli-1.9.1/docs/
+-rw-r--r--   0 runner    (1001) docker     (123)     4581 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/Makefile
+-rw-r--r--   0 runner    (1001) docker     (123)      111 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/README.rst
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.681344 grizli-1.9.1/docs/_static/
+-rw-r--r--   0 runner    (1001) docker     (123)     4286 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_static/grizli.ico
+-rw-r--r--   0 runner    (1001) docker     (123)      986 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_static/grizli_favico.png
+-rw-r--r--   0 runner    (1001) docker     (123)    35735 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_static/grizli_favico_large.png
+-rw-r--r--   0 runner    (1001) docker     (123)   193903 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_static/grizli_logo.pdf
+-rw-r--r--   0 runner    (1001) docker     (123)    18807 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_static/grizli_logo.png
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.669344 grizli-1.9.1/docs/_templates/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.681344 grizli-1.9.1/docs/_templates/autosummary/
+-rw-r--r--   0 runner    (1001) docker     (123)      250 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_templates/autosummary/base.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      251 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_templates/autosummary/class.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      252 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/_templates/autosummary/module.rst
+-rw-r--r--   0 runner    (1001) docker     (123)       75 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/changelog.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     6794 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/conf.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.685344 grizli-1.9.1/docs/grizli/
+-rw-r--r--   0 runner    (1001) docker     (123)       86 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli/basic.rst
+-rw-r--r--   0 runner    (1001) docker     (123)   851247 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli/ceers-sm.field.jpg
+-rw-r--r--   0 runner    (1001) docker     (123)    98779 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli/image-release-v6.md
+-rw-r--r--   0 runner    (1001) docker     (123)    65882 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli/image-release-v6.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     1176 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     7704 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli/install.rst
+-rw-r--r--   0 runner    (1001) docker     (123)      676 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli/prep.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    38260 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/grizli-for-dummies.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     6655 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/index.rst
+-rw-r--r--   0 runner    (1001) docker     (123)     4549 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/make.bat
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-08-03 08:12:59.000000 grizli-1.9.1/docs/rtd-pip-requirements
+-rw-r--r--   0 runner    (1001) docker     (123)      189 2023-08-03 08:12:59.000000 grizli-1.9.1/environment.yml
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.689345 grizli-1.9.1/examples/
+-rw-r--r--   0 runner    (1001) docker     (123)      257 2023-08-03 08:12:59.000000 grizli-1.9.1/examples/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)     6880 2023-08-03 08:12:59.000000 grizli-1.9.1/examples/demo.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20658 2023-08-03 08:12:59.000000 grizli-1.9.1/examples/grizli_demo_0.pdf
+-rw-r--r--   0 runner    (1001) docker     (123)   100981 2023-08-03 08:12:59.000000 grizli-1.9.1/examples/grizli_demo_1.pdf
+-rw-r--r--   0 runner    (1001) docker     (123)   193903 2023-08-03 08:12:59.000000 grizli-1.9.1/examples/grizli_logo.pdf
+-rw-r--r--   0 runner    (1001) docker     (123)    18807 2023-08-03 08:12:59.000000 grizli-1.9.1/examples/grizli_logo.png
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.697345 grizli-1.9.1/grizli/
+-rw-r--r--   0 runner    (1001) docker     (123)      748 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.697345 grizli-1.9.1/grizli/aws/
+-rw-r--r--   0 runner    (1001) docker     (123)      137 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    46339 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/aws_drizzler.py
+-rw-r--r--   0 runner    (1001) docker     (123)   131901 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/db.py
+-rw-r--r--   0 runner    (1001) docker     (123)    45124 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/field_tiles.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     9609 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/fit_redshift_lambda.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32480 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/lambda_handler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56360 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/tile_mosaic.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2826 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/utils.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    89873 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/aws/visit_processor.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40400 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/catalog.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19411 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/combine.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.701345 grizli-1.9.1/grizli/data/
+-rw-r--r--   0 runner    (1001) docker     (123)     9295 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/auto_script_defaults.yml
+-rw-r--r--   0 runner    (1001) docker     (123)      107 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/db.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     3639 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/gaia_dr2_vizier_columns.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    20160 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/hst_encircled_energy.fits
+-rw-r--r--   0 runner    (1001) docker     (123)    11962 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/jwst_bp_info.yml
+-rw-r--r--   0 runner    (1001) docker     (123)     1167 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nircam_wisp.yml
+-rw-r--r--   0 runner    (1001) docker     (123)   126417 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nis_badpix_20230710.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)   132526 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_badpix_20230710_NRCALONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)   108369 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_badpix_20230710_NRCBLONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    47343 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_badpix_230120_NRCALONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    39840 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_badpix_230120_NRCBLONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    48187 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_badpix_230701_NRCALONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    40431 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_badpix_230701_NRCBLONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    17258 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA1.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    16916 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA2.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    16627 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA3.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    16943 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA4.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    35486 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCALONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    18003 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB1.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    16764 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB2.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    16962 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB3.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    16851 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB4.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    22659 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCBLONG.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)     5043 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/photom_correction.yml
+-rw-r--r--   0 runner    (1001) docker     (123)    97707 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/sep_catalog_junk.pkl
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.709345 grizli-1.9.1/grizli/data/templates/
+-rw-r--r--   0 runner    (1001) docker     (123)    94256 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/FeII_VeronCetty2004.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      654 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/README
+-rw-r--r--   0 runner    (1001) docker     (123)   221907 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/alf_SSP.dat
+-rw-r--r--   0 runner    (1001) docker     (123)    48158 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/cvd12_t11_solar_Chabrier.dat
+-rw-r--r--   0 runner    (1001) docker     (123)    51300 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/eazy_intermediate.dat
+-rw-r--r--   0 runner    (1001) docker     (123)    44824 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/erb2010.dat
+-rw-r--r--   0 runner    (1001) docker     (123)    31746 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/erb2010_continuum.dat
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.717345 grizli-1.9.1/grizli/data/templates/fsps/
+-rw-r--r--   0 runner    (1001) docker     (123)      591 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3.param
+-rw-r--r--   0 runner    (1001) docker     (123)    11520 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3.param.fits
+-rw-r--r--   0 runner    (1001) docker     (123)   156520 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_001.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156521 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_002.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_003.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156527 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_004.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_005.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156523 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_006.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156509 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_007.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156510 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_008.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156511 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_009.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156512 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_010.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_011.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_012.dat
+-rw-r--r--   0 runner    (1001) docker     (123)      687 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines.param
+-rw-r--r--   0 runner    (1001) docker     (123)   156520 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_001.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156521 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_002.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_003.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156527 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_004.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156524 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_005.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156523 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_006.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156509 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_007.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156510 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_008.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156511 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_009.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156512 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_010.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_011.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   156518 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_012.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   143958 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/fsps_starburst_lines.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    12636 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/post_starburst.dat
+-rw-r--r--   0 runner    (1001) docker     (123)   557728 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/quasar_lines.txt
+-rw-r--r--   0 runner    (1001) docker     (123)   382216 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/red_blue_continuum.txt
+-rw-r--r--   0 runner    (1001) docker     (123)   381266 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/red_blue_continuum_noLya.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.721345 grizli-1.9.1/grizli/data/templates/stars/
+-rw-r--r--   0 runner    (1001) docker     (123)   173069 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/L1.0.txt
+-rw-r--r--   0 runner    (1001) docker     (123)   145419 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/L3.5.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    26044 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/L6.0.txt
+-rw-r--r--   0 runner    (1001) docker     (123)   159659 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/M6.5.txt
+-rw-r--r--   0 runner    (1001) docker     (123)   166768 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/M8.0.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    57965 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/T2.0.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    55327 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/T6.0.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     8115 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/T7.5.txt
+-rw-r--r--   0 runner    (1001) docker     (123)  3193920 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/bt-settl_t400-3500_z0.0.fits
+-rw-r--r--   0 runner    (1001) docker     (123)    83291 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/carbon_star.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      175 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/templates/stars/stars_settl.param
+-rw-r--r--   0 runner    (1001) docker     (123)   299891 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/visit_alignment.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    54096 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/wfc3ir_badpix_spars200_22.03.31.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    23739 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/wfc3ir_dark_badpix_2019.01.12.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)     1057 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/data/wfc3ir_ee.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     5521 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/ds9.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17575 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/fake_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)   185637 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/fitting.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.721345 grizli-1.9.1/grizli/galfit/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/galfit/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15242 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/galfit/deconvolve.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25223 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/galfit/galfit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4926 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/galfit/gfutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16595 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/galfit/psf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40681 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/grismconf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    35836 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/jwst_level1.py
+-rw-r--r--   0 runner    (1001) docker     (123)    77490 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/jwst_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)   203738 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/model.py
+-rw-r--r--   0 runner    (1001) docker     (123)   204523 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/multifit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2872 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/nbutils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.721345 grizli-1.9.1/grizli/pipeline/
+-rw-r--r--   0 runner    (1001) docker     (123)     1147 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/pipeline/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   225370 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/pipeline/auto_script.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8267 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/pipeline/default_params.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32411 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/pipeline/photoz.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6729 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/pipeline/reprocess.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1485 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/pipeline/run_MPI.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8973 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/pipeline/summary.py
+-rw-r--r--   0 runner    (1001) docker     (123)   260257 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/prep.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    49392 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/stack.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.725345 grizli-1.9.1/grizli/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.725345 grizli-1.9.1/grizli/tests/data/
+-rw-r--r--   0 runner    (1001) docker     (123)     1576 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/fit_args.npy
+-rw-r--r--   0 runner    (1001) docker     (123)   812160 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/j033216m2743_00152.beams.fits
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.729345 grizli-1.9.1/grizli/tests/data/jwst-headers/
+-rw-r--r--   0 runner    (1001) docker     (123)      116 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/jwst-headers/README.rst
+-rw-r--r--   0 runner    (1001) docker     (123)    28024 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/jwst-headers/det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    47863 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca1_rate.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    47877 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca2_rate.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    47996 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca5_uncal_dispersed_GRISMR_crossing_F356W_rate.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)    47827 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01105_00002_nrca5_rate.fits.gz
+-rw-r--r--   0 runner    (1001) docker     (123)      546 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/jwst-headers/strip_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)   509760 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/niriss_jw01324001001_test.beams.fits
+-rw-r--r--   0 runner    (1001) docker     (123)  1120244 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/data/wfc3-parse-test.tar.gz
+-rw-r--r--   0 runner    (1001) docker     (123)     2800 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/test_autoscript.py
+-rw-r--r--   0 runner    (1001) docker     (123)      832 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/test_cutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2478 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/test_fits.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1895 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/test_grismconf.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8532 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/test_jwst.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8525 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/tests/test_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)   306229 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.729345 grizli-1.9.1/grizli/utils_c/
+-rw-r--r--   0 runner    (1001) docker     (123)      178 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/utils_c/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   465869 2023-08-03 08:13:11.000000 grizli-1.9.1/grizli/utils_c/disperse.c
+-rw-r--r--   0 runner    (1001) docker     (123)     4083 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/utils_c/disperse.pyx
+-rw-r--r--   0 runner    (1001) docker     (123)   823688 2023-08-03 08:13:11.000000 grizli-1.9.1/grizli/utils_c/interp.c
+-rw-r--r--   0 runner    (1001) docker     (123)    16229 2023-08-03 08:12:59.000000 grizli-1.9.1/grizli/utils_c/interp.pyx
+-rw-r--r--   0 runner    (1001) docker     (123)      160 2023-08-03 08:13:12.000000 grizli-1.9.1/grizli/version.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-08-03 08:13:12.697345 grizli-1.9.1/grizli.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     6827 2023-08-03 08:13:12.000000 grizli-1.9.1/grizli.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     6629 2023-08-03 08:13:12.000000 grizli-1.9.1/grizli.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-08-03 08:13:12.000000 grizli-1.9.1/grizli.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      430 2023-08-03 08:13:12.000000 grizli-1.9.1/grizli.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        7 2023-08-03 08:13:12.000000 grizli-1.9.1/grizli.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      229 2023-08-03 08:12:59.000000 grizli-1.9.1/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)     1772 2023-08-03 08:13:12.729345 grizli-1.9.1/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)      841 2023-08-03 08:12:59.000000 grizli-1.9.1/setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13630 2023-08-03 08:12:59.000000 grizli-1.9.1/test_pipeline_hst.py
```

### Comparing `grizli-1.9/.github/workflows/publish-to-pypi.yml` & `grizli-1.9.1/.github/workflows/publish-to-pypi.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/.github/workflows/python-package-ero.yml` & `grizli-1.9.1/.github/workflows/python-package-ero.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/.github/workflows/python-package-with-jwst.yml` & `grizli-1.9.1/.github/workflows/python-package-with-jwst.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/.github/workflows/python-package.yml` & `grizli-1.9.1/.github/workflows/python-package.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/.gitignore` & `grizli-1.9.1/.gitignore`

 * *Files identical despite different names*

### Comparing `grizli-1.9/.readthedocs.yml` & `grizli-1.9.1/.readthedocs.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/.travis.yml` & `grizli-1.9.1/.travis.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/CHANGES.rst` & `grizli-1.9.1/CHANGES.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/CITATION.cff` & `grizli-1.9.1/CITATION.cff`

 * *Files identical despite different names*

### Comparing `grizli-1.9/LICENSE.txt` & `grizli-1.9.1/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/PKG-INFO` & `grizli-1.9.1/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: grizli
-Version: 1.9
+Version: 1.9.1
 Summary: Grism redshift and line analysis software
 Home-page: https://github.com/gbrammer/grizli
 Author: G. Brammer
 Author-email: gbrammer@gmail.com
 License: MIT
 Project-URL: Documentation, https://grizli.readthedocs.io/
 Project-URL: Source, https://github.com/gbrammer/grizli
```

### Comparing `grizli-1.9/README.rst` & `grizli-1.9.1/README.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/Makefile` & `grizli-1.9.1/docs/Makefile`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/_static/grizli.ico` & `grizli-1.9.1/docs/_static/grizli.ico`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/_static/grizli_favico.png` & `grizli-1.9.1/docs/_static/grizli_favico.png`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/_static/grizli_favico_large.png` & `grizli-1.9.1/docs/_static/grizli_favico_large.png`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/_static/grizli_logo.pdf` & `grizli-1.9.1/docs/_static/grizli_logo.pdf`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/_static/grizli_logo.png` & `grizli-1.9.1/docs/_static/grizli_logo.png`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/conf.py` & `grizli-1.9.1/docs/conf.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/grizli/ceers-sm.field.jpg` & `grizli-1.9.1/docs/grizli/ceers-sm.field.jpg`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/grizli/image-release-v6.md` & `grizli-1.9.1/docs/grizli/image-release-v6.md`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/grizli/image-release-v6.rst` & `grizli-1.9.1/docs/grizli/image-release-v6.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/grizli/index.rst` & `grizli-1.9.1/docs/grizli/index.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/grizli/install.rst` & `grizli-1.9.1/docs/grizli/install.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/grizli/prep.rst` & `grizli-1.9.1/docs/grizli/prep.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/grizli-for-dummies.rst` & `grizli-1.9.1/docs/grizli-for-dummies.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/index.rst` & `grizli-1.9.1/docs/index.rst`

 * *Files identical despite different names*

### Comparing `grizli-1.9/docs/make.bat` & `grizli-1.9.1/docs/make.bat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/examples/demo.py` & `grizli-1.9.1/examples/demo.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/examples/grizli_demo_0.pdf` & `grizli-1.9.1/examples/grizli_demo_0.pdf`

 * *Files identical despite different names*

### Comparing `grizli-1.9/examples/grizli_demo_1.pdf` & `grizli-1.9.1/examples/grizli_demo_1.pdf`

 * *Files identical despite different names*

### Comparing `grizli-1.9/examples/grizli_logo.pdf` & `grizli-1.9.1/examples/grizli_logo.pdf`

 * *Files identical despite different names*

### Comparing `grizli-1.9/examples/grizli_logo.png` & `grizli-1.9.1/examples/grizli_logo.png`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/__init__.py` & `grizli-1.9.1/grizli/__init__.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/aws/aws_drizzler.py` & `grizli-1.9.1/grizli/aws/aws_drizzler.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/aws/db.py` & `grizli-1.9.1/grizli/aws/db.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/aws/field_tiles.py` & `grizli-1.9.1/grizli/aws/field_tiles.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/aws/fit_redshift_lambda.py` & `grizli-1.9.1/grizli/aws/fit_redshift_lambda.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/aws/lambda_handler.py` & `grizli-1.9.1/grizli/aws/lambda_handler.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/aws/tile_mosaic.py` & `grizli-1.9.1/grizli/aws/tile_mosaic.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/aws/visit_processor.py` & `grizli-1.9.1/grizli/aws/visit_processor.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/catalog.py` & `grizli-1.9.1/grizli/catalog.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/combine.py` & `grizli-1.9.1/grizli/combine.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/auto_script_defaults.yml` & `grizli-1.9.1/grizli/data/auto_script_defaults.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/gaia_dr2_vizier_columns.txt` & `grizli-1.9.1/grizli/data/gaia_dr2_vizier_columns.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/hst_encircled_energy.fits` & `grizli-1.9.1/grizli/data/hst_encircled_energy.fits`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/jwst_bp_info.yml` & `grizli-1.9.1/grizli/data/jwst_bp_info.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nircam_wisp.yml` & `grizli-1.9.1/grizli/data/nircam_wisp.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nis_badpix_20230710.fits.gz` & `grizli-1.9.1/grizli/data/nis_badpix_20230710.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_badpix_20230710_NRCALONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_badpix_20230710_NRCALONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_badpix_20230710_NRCBLONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_badpix_20230710_NRCBLONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_badpix_230120_NRCALONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_badpix_230120_NRCALONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_badpix_230120_NRCBLONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_badpix_230120_NRCBLONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_badpix_230701_NRCALONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_badpix_230701_NRCALONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_badpix_230701_NRCBLONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_badpix_230701_NRCBLONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA1.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA1.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA2.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA2.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA3.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA3.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCA4.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCA4.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCALONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCALONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB1.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB1.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB2.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB2.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB3.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB3.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCB4.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCB4.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/nrc_lowpix_0916_NRCBLONG.fits.gz` & `grizli-1.9.1/grizli/data/nrc_lowpix_0916_NRCBLONG.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/photom_correction.yml` & `grizli-1.9.1/grizli/data/photom_correction.yml`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/sep_catalog_junk.pkl` & `grizli-1.9.1/grizli/data/sep_catalog_junk.pkl`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/FeII_VeronCetty2004.txt` & `grizli-1.9.1/grizli/data/templates/FeII_VeronCetty2004.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/README` & `grizli-1.9.1/grizli/data/templates/README`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/alf_SSP.dat` & `grizli-1.9.1/grizli/data/templates/alf_SSP.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/cvd12_t11_solar_Chabrier.dat` & `grizli-1.9.1/grizli/data/templates/cvd12_t11_solar_Chabrier.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/eazy_intermediate.dat` & `grizli-1.9.1/grizli/data/templates/eazy_intermediate.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/erb2010.dat` & `grizli-1.9.1/grizli/data/templates/erb2010.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/erb2010_continuum.dat` & `grizli-1.9.1/grizli/data/templates/erb2010_continuum.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3.param` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3.param`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3.param.fits` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3.param.fits`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_001.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_001.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_002.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_002.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_003.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_003.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_004.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_004.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_005.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_005.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_006.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_006.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_007.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_007.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_008.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_008.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_009.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_009.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_010.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_010.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_011.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_011.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_012.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_012.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines.param` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines.param`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_001.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_001.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_002.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_002.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_003.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_003.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_004.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_004.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_005.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_005.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_006.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_006.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_007.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_007.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_008.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_008.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_009.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_009.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_010.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_010.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_011.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_011.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_012.dat` & `grizli-1.9.1/grizli/data/templates/fsps/fsps_QSF_12_v3_nolines_012.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/fsps_starburst_lines.txt` & `grizli-1.9.1/grizli/data/templates/fsps_starburst_lines.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/post_starburst.dat` & `grizli-1.9.1/grizli/data/templates/post_starburst.dat`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/quasar_lines.txt` & `grizli-1.9.1/grizli/data/templates/quasar_lines.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/red_blue_continuum.txt` & `grizli-1.9.1/grizli/data/templates/red_blue_continuum.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/red_blue_continuum_noLya.txt` & `grizli-1.9.1/grizli/data/templates/red_blue_continuum_noLya.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/L1.0.txt` & `grizli-1.9.1/grizli/data/templates/stars/L1.0.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/L3.5.txt` & `grizli-1.9.1/grizli/data/templates/stars/L3.5.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/L6.0.txt` & `grizli-1.9.1/grizli/data/templates/stars/L6.0.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/M6.5.txt` & `grizli-1.9.1/grizli/data/templates/stars/M6.5.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/M8.0.txt` & `grizli-1.9.1/grizli/data/templates/stars/M8.0.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/T2.0.txt` & `grizli-1.9.1/grizli/data/templates/stars/T2.0.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/T6.0.txt` & `grizli-1.9.1/grizli/data/templates/stars/T6.0.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/T7.5.txt` & `grizli-1.9.1/grizli/data/templates/stars/T7.5.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/bt-settl_t400-3500_z0.0.fits` & `grizli-1.9.1/grizli/data/templates/stars/bt-settl_t400-3500_z0.0.fits`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/templates/stars/carbon_star.txt` & `grizli-1.9.1/grizli/data/templates/stars/carbon_star.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/visit_alignment.txt` & `grizli-1.9.1/grizli/data/visit_alignment.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/wfc3ir_badpix_spars200_22.03.31.fits.gz` & `grizli-1.9.1/grizli/data/wfc3ir_badpix_spars200_22.03.31.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/wfc3ir_dark_badpix_2019.01.12.fits.gz` & `grizli-1.9.1/grizli/data/wfc3ir_dark_badpix_2019.01.12.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/data/wfc3ir_ee.txt` & `grizli-1.9.1/grizli/data/wfc3ir_ee.txt`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/ds9.py` & `grizli-1.9.1/grizli/ds9.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/fake_image.py` & `grizli-1.9.1/grizli/fake_image.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/fitting.py` & `grizli-1.9.1/grizli/fitting.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/galfit/deconvolve.py` & `grizli-1.9.1/grizli/galfit/deconvolve.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/galfit/galfit.py` & `grizli-1.9.1/grizli/galfit/galfit.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/galfit/gfutils.py` & `grizli-1.9.1/grizli/galfit/gfutils.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/galfit/psf.py` & `grizli-1.9.1/grizli/galfit/psf.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/grismconf.py` & `grizli-1.9.1/grizli/grismconf.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/jwst_level1.py` & `grizli-1.9.1/grizli/jwst_level1.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/jwst_utils.py` & `grizli-1.9.1/grizli/jwst_utils.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/model.py` & `grizli-1.9.1/grizli/model.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/multifit.py` & `grizli-1.9.1/grizli/multifit.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/nbutils.py` & `grizli-1.9.1/grizli/nbutils.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/pipeline/__init__.py` & `grizli-1.9.1/grizli/pipeline/__init__.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/pipeline/auto_script.py` & `grizli-1.9.1/grizli/pipeline/auto_script.py`

 * *Files 0% similar despite different names*

```diff
@@ -4988,15 +4988,15 @@
     ir_filters = []
 
     # Preferred combinations
     filter_list_lower = [f.lower() for f in filter_list]
     rpref = ['h', 'f160w', 'f140w','f444w-clear','f410m-clear',
              'f356w-clear','f277w-clear','f200w-clear','f150w-clear']
     gpref = ['j', 'yj', 'f125w', 'f110w', 'f105w', 'f098m','f277w-clear',
-             'f356w-clear','f200w-clear'
+             'f356w-clear','f200w-clear',
              'f150w-clear','f115w-clear',
              'f410m-clear','f300m-clear',
              ]
     bpref = ['opt', 'visr', 'visb', 'f814w', 'f814wu', 'f606w', 'f606wu',
              'f775w', 'f850lp', 'f435w',
              'f115w-clear','f090w-clear','f070w-clear',
              'f277w-clear','f150w-clear'
```

### Comparing `grizli-1.9/grizli/pipeline/default_params.py` & `grizli-1.9.1/grizli/pipeline/default_params.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/pipeline/photoz.py` & `grizli-1.9.1/grizli/pipeline/photoz.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/pipeline/reprocess.py` & `grizli-1.9.1/grizli/pipeline/reprocess.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/pipeline/run_MPI.py` & `grizli-1.9.1/grizli/pipeline/run_MPI.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/pipeline/summary.py` & `grizli-1.9.1/grizli/pipeline/summary.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/prep.py` & `grizli-1.9.1/grizli/prep.py`

 * *Files 1% similar despite different names*

```diff
@@ -5363,24 +5363,32 @@
     
     exptime = np.zeros(len(files))
     
     for i, file in enumerate(files):
         root = file.split('.fits')[0]
 
         im = pyfits.open(file)
-        try:
-            ok = im['DQ', 1].data == 0
-        except:
-            ok = np.isfinite(im['SCI', 1].data)
+        
+        if os.path.basename(file).startswith('jw0'):
+            ok = im['DQ'].data & 1 == 0
+        else:
+            try:
+                ok = im['DQ', 1].data == 0
+            except:
+                ok &= np.isfinite(im['SCI', 1].data)
+                pass
+                
+        ok &= np.isfinite(im['SCI', 1].data)
         
         if 'EXPTIME' in im[0].header:
             exptime[i] = im[0].header['EXPTIME']
             
         sci = im['SCI', 1].data*ok - np.nanmedian(im['SCI', 1].data[ok])
-
+        sci[~ok] = 0
+        
         header = im['SCI', 1].header.copy()
 
         for k in ['PHOTFNU', 'PHOTFLAM', 'PHOTPLAM', 'FILTER']:
             if k in im[0].header:
                 header[k] = im[0].header[k]
         
         hst_filter = utils.parse_filter_from_header(im[0].header)
@@ -5405,14 +5413,16 @@
 
             output = sew('{0}_xsci.fits'.format(root))
             cat = output['table']
         else:
             # SEP
             wht = 1/im['ERR', 1].data**2
             wht[~(np.isfinite(wht))] = 0
+            wht[sci == 0] == 0
+            
             pyfits.writeto('{0}_xwht.fits'.format(root), data=wht,
                            header=im['ERR', 1].header, overwrite=True)
 
             pars = SEP_DETECT_PARAMS.copy()
             pars['minarea'] = 8
 
             cat = make_SEP_catalog(root=root,
```

### Comparing `grizli-1.9/grizli/stack.py` & `grizli-1.9.1/grizli/stack.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/fit_args.npy` & `grizli-1.9.1/grizli/tests/data/fit_args.npy`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/j033216m2743_00152.beams.fits` & `grizli-1.9.1/grizli/tests/data/j033216m2743_00152.beams.fits`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/jwst-headers/det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits.gz` & `grizli-1.9.1/grizli/tests/data/jwst-headers/det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca1_rate.fits.gz` & `grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca1_rate.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca2_rate.fits.gz` & `grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca2_rate.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca5_uncal_dispersed_GRISMR_crossing_F356W_rate.fits.gz` & `grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01101_00001_nrca5_uncal_dispersed_GRISMR_crossing_F356W_rate.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/jwst-headers/jw42424001001_01105_00002_nrca5_rate.fits.gz` & `grizli-1.9.1/grizli/tests/data/jwst-headers/jw42424001001_01105_00002_nrca5_rate.fits.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/jwst-headers/strip_data.py` & `grizli-1.9.1/grizli/tests/data/jwst-headers/strip_data.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/niriss_jw01324001001_test.beams.fits` & `grizli-1.9.1/grizli/tests/data/niriss_jw01324001001_test.beams.fits`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/data/wfc3-parse-test.tar.gz` & `grizli-1.9.1/grizli/tests/data/wfc3-parse-test.tar.gz`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/test_autoscript.py` & `grizli-1.9.1/grizli/tests/test_autoscript.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/test_cutils.py` & `grizli-1.9.1/grizli/tests/test_cutils.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/test_fits.py` & `grizli-1.9.1/grizli/tests/test_fits.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/test_grismconf.py` & `grizli-1.9.1/grizli/tests/test_grismconf.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/test_jwst.py` & `grizli-1.9.1/grizli/tests/test_jwst.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/tests/test_utils.py` & `grizli-1.9.1/grizli/tests/test_utils.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/utils.py` & `grizli-1.9.1/grizli/utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -15736,3282 +15736,3405 @@
 0003d770: 5f69 643d 4e6f 6e65 2c20 7461 626c 655f  _id=None, table_
 0003d780: 636c 6173 733d 2264 6973 706c 6179 2063  class="display c
 0003d790: 6f6d 7061 6374 222c 2063 7373 3d4e 6f6e  ompact", css=Non
 0003d7a0: 652c 2066 696c 7465 725f 636f 6c75 6d6e  e, filter_column
 0003d7b0: 733d 5b5d 2c20 6275 7474 6f6e 733d 5b27  s=[], buttons=['
 0003d7c0: 6373 7627 5d2c 2074 6f67 676c 653d 5472  csv'], toggle=Tr
 0003d7d0: 7565 2c20 7573 655f 6a73 6f6e 3d46 616c  ue, use_json=Fal
-0003d7e0: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-0003d7f0: 5772 6170 7065 7220 6172 6f75 6e64 2060  Wrapper around `
-0003d800: 7e61 7374 726f 7079 2e74 6162 6c65 2e54  ~astropy.table.T
-0003d810: 6162 6c65 2e77 7269 7465 2866 6f72 6d61  able.write(forma
-0003d820: 743d 276a 7376 6965 7765 7227 2960 2e0a  t='jsviewer')`..
-0003d830: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0003d840: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0003d850: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206f  ------.        o
-0003d860: 7574 7075 7420 3a20 7374 720a 2020 2020  utput : str.    
-0003d870: 2020 2020 2020 2020 4f75 7470 7574 2066          Output f
-0003d880: 696c 656e 616d 652e 0a0a 2020 2020 2020  ilename...      
-0003d890: 2020 7265 706c 6163 655f 6272 6163 6573    replace_braces
-0003d8a0: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
-0003d8b0: 2020 2020 5265 706c 6163 6520 2726 6c74      Replace '&lt
-0003d8c0: 3b27 2061 6e64 2027 2667 743b 2720 6368  ;' and '&gt;' ch
-0003d8d0: 6172 6163 7465 7273 2074 6861 7420 6172  aracters that ar
-0003d8e0: 6520 636f 6e76 6572 7465 640a 2020 2020  e converted.    
-0003d8f0: 2020 2020 2020 2020 6175 746f 6d61 7469          automati
-0003d900: 6361 6c6c 7920 6672 6f6d 2022 3c3e 2220  cally from "<>" 
-0003d910: 6279 2074 6865 2060 7e61 7374 726f 7079  by the `~astropy
-0003d920: 2e74 6162 6c65 2e54 6162 6c65 2e77 7269  .table.Table.wri
-0003d930: 7465 600a 2020 2020 2020 2020 2020 2020  te`.            
-0003d940: 6d65 7468 6f64 2e20 5468 6572 6520 6172  method. There ar
-0003d950: 6520 7061 7261 6d65 7465 7273 2066 6f72  e parameters for
-0003d960: 2064 6f69 6e67 2074 6869 7320 6175 746f   doing this auto
-0003d970: 6d61 7469 6361 6c6c 7920 7769 7468 0a20  matically with. 
-0003d980: 2020 2020 2020 2020 2020 2060 7772 6974             `writ
-0003d990: 6528 666f 726d 6174 3d27 6874 6d6c 2729  e(format='html')
-0003d9a0: 6020 6275 7420 7468 6174 2064 6f6e 2774  ` but that don't
-0003d9b0: 2061 7070 6561 7220 746f 2062 6520 6176   appear to be av
-0003d9c0: 6169 6c61 626c 6520 7769 7468 0a20 2020  ailable with.   
-0003d9d0: 2020 2020 2020 2020 2060 7772 6974 6528           `write(
-0003d9e0: 666f 726d 6174 3d27 6a73 7669 6577 6572  format='jsviewer
-0003d9f0: 2729 602e 0a0a 2020 2020 2020 2020 6c6f  ')`...        lo
-0003da00: 6361 6c68 6f73 7420 3a20 626f 6f6c 0a20  calhost : bool. 
-0003da10: 2020 2020 2020 2020 2020 2055 7365 206c             Use l
-0003da20: 6f63 616c 204a 5320 6669 6c65 732e 204f  ocal JS files. O
-0003da30: 7468 6572 7769 7365 2075 7365 2066 696c  therwise use fil
-0003da40: 6573 2068 6f73 7465 6420 6578 7465 726e  es hosted extern
-0003da50: 616c 6c79 2e0a 0a20 2020 2020 2020 2066  ally...        f
-0003da60: 696c 7465 725f 636f 6c75 6d6e 7320 3a20  ilter_columns : 
-0003da70: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-0003da80: 2041 6464 206f 7074 696f 6e20 746f 206c   Add option to l
-0003da90: 696d 6974 206d 696e 2f6d 6178 2076 616c  imit min/max val
-0003daa0: 7565 7320 6f66 2063 6f6c 756d 6e20 6461  ues of column da
-0003dab0: 7461 0a0a 2020 2020 2020 2020 6275 7474  ta..        butt
-0003dac0: 6f6e 7320 3a20 6c69 7374 0a20 2020 2020  ons : list.     
-0003dad0: 2020 2020 2020 2041 6464 2062 7574 746f         Add butto
-0003dae0: 6e73 2066 6f72 2065 7870 6f72 7469 6e67  ns for exporting
-0003daf0: 2064 6174 612e 2020 416c 6c6f 7765 6420   data.  Allowed 
-0003db00: 6f70 7469 6f6e 7320 6172 650a 2020 2020  options are.    
-0003db10: 2020 2020 2020 2020 2763 6f70 7927 2c20          'copy', 
-0003db20: 2763 7376 272c 2027 6578 6365 6c27 2c20  'csv', 'excel', 
-0003db30: 2770 6466 272c 2027 7072 696e 7427 2e0a  'pdf', 'print'..
-0003db40: 0a20 2020 2020 2020 2074 6f67 676c 6520  .        toggle 
-0003db50: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
-0003db60: 2020 2041 6464 206c 696e 6b73 2061 7420     Add links at 
-0003db70: 746f 7020 6f66 2070 6167 6520 666f 7220  top of page for 
-0003db80: 746f 6767 6c69 6e67 2063 6f6c 756d 6e73  toggling columns
-0003db90: 206f 6e2f 6f66 660a 0a20 2020 2020 2020   on/off..       
-0003dba0: 2075 7365 5f6a 736f 6e20 3a20 626f 6f6c   use_json : bool
-0003dbb0: 0a20 2020 2020 2020 2020 2020 2057 7269  .            Wri
-0003dbc0: 7465 2074 6865 2064 6174 6120 746f 2061  te the data to a
-0003dbd0: 204a 534f 4e20 6669 6c65 2061 6e64 2073   JSON file and s
-0003dbe0: 7472 6970 206f 7574 206f 6620 7468 6520  trip out of the 
-0003dbf0: 4854 4d4c 2068 6561 6465 722e 0a20 2020  HTML header..   
-0003dc00: 2020 2020 2020 2020 2055 7365 2074 6869           Use thi
-0003dc10: 7320 666f 7220 6c61 7267 6520 6461 7461  s for large data
-0003dc20: 7365 7473 206f 7220 6966 2063 6f6c 756d  sets or if colum
-0003dc30: 6e73 2069 6e63 6c75 6465 2072 656e 6465  ns include rende
-0003dc40: 7265 640a 2020 2020 2020 2020 2020 2020  red.            
-0003dc50: 696d 6167 6573 2e0a 0a20 2020 2020 2020  images...       
-0003dc60: 2065 7463 203a 202e 2e2e 0a20 2020 2020   etc : ....     
-0003dc70: 2020 2020 2020 2041 6464 6974 696f 6e61         Additiona
-0003dc80: 6c20 7061 7261 6d65 7465 7273 2070 6173  l parameters pas
-0003dc90: 7365 6420 7468 726f 7567 6820 746f 2060  sed through to `
-0003dca0: 7772 6974 6560 2e0a 2020 2020 2020 2020  write`..        
-0003dcb0: 2222 220a 2020 2020 2020 2020 2366 726f  """.        #fro
-0003dcc0: 6d20 6173 7472 6f70 792e 7461 626c 652e  m astropy.table.
-0003dcd0: 6a73 7669 6577 6572 2069 6d70 6f72 7420  jsviewer import 
-0003dce0: 4445 4641 554c 545f 4353 530a 2020 2020  DEFAULT_CSS.    
-0003dcf0: 2020 2020 4445 4641 554c 545f 4353 5320      DEFAULT_CSS 
-0003dd00: 3d20 2222 220a 626f 6479 207b 666f 6e74  = """.body {font
-0003dd10: 2d66 616d 696c 793a 2073 616e 732d 7365  -family: sans-se
-0003dd20: 7269 663b 7d0a 7461 626c 652e 6461 7461  rif;}.table.data
-0003dd30: 5461 626c 6520 7b77 6964 7468 3a20 6175  Table {width: au
-0003dd40: 746f 2021 696d 706f 7274 616e 743b 206d  to !important; m
-0003dd50: 6172 6769 6e3a 2030 2021 696d 706f 7274  argin: 0 !import
-0003dd60: 616e 743b 7d0a 2e64 6174 6154 6162 6c65  ant;}..dataTable
-0003dd70: 735f 6669 6c74 6572 2c20 2e64 6174 6154  s_filter, .dataT
-0003dd80: 6162 6c65 735f 7061 6769 6e61 7465 207b  ables_paginate {
-0003dd90: 666c 6f61 743a 206c 6566 7420 2169 6d70  float: left !imp
-0003dda0: 6f72 7461 6e74 3b20 6d61 7267 696e 2d6c  ortant; margin-l
-0003ddb0: 6566 743a 3165 6d7d 0a74 6420 7b66 6f6e  eft:1em}.td {fon
-0003ddc0: 742d 7369 7a65 3a20 3130 7074 3b7d 0a20  t-size: 10pt;}. 
-0003ddd0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0003dde0: 2020 2069 6620 6373 7320 6973 206e 6f74     if css is not
-0003ddf0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0003de00: 2020 2044 4546 4155 4c54 5f43 5353 202b     DEFAULT_CSS +
-0003de10: 3d20 6373 730a 0a20 2020 2020 2020 2069  = css..        i
-0003de20: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-0003de30: 286f 7574 7075 7429 3a0a 2020 2020 2020  (output):.      
-0003de40: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
-0003de50: 6f75 7470 7574 290a 0a20 2020 2020 2020  output)..       
-0003de60: 2073 656c 662e 7772 6974 6528 6f75 7470   self.write(outp
-0003de70: 7574 2c20 666f 726d 6174 3d27 6a73 7669  ut, format='jsvi
-0003de80: 6577 6572 272c 2063 7373 3d44 4546 4155  ewer', css=DEFAU
-0003de90: 4c54 5f43 5353 2c0a 2020 2020 2020 2020  LT_CSS,.        
-0003dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003deb0: 2020 2020 6d61 785f 6c69 6e65 733d 6d61      max_lines=ma
-0003dec0: 785f 6c69 6e65 732c 0a20 2020 2020 2020  x_lines,.       
-0003ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dee0: 2020 2020 206a 736b 7761 7267 733d 7b27       jskwargs={'
-0003def0: 7573 655f 6c6f 6361 6c5f 6669 6c65 7327  use_local_files'
-0003df00: 3a20 6c6f 6361 6c68 6f73 747d 2c0a 2020  : localhost},.  
-0003df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003df20: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-0003df30: 6964 3d4e 6f6e 652c 2074 6162 6c65 5f63  id=None, table_c
-0003df40: 6c61 7373 3d74 6162 6c65 5f63 6c61 7373  lass=table_class
-0003df50: 290a 0a20 2020 2020 2020 2069 6620 7265  )..        if re
-0003df60: 706c 6163 655f 6272 6163 6573 3a0a 2020  place_braces:.  
-0003df70: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
-0003df80: 3d20 6f70 656e 286f 7574 7075 7429 2e72  = open(output).r
-0003df90: 6561 646c 696e 6573 2829 0a20 2020 2020  eadlines().     
-0003dfa0: 2020 2020 2020 2069 6620 7265 706c 6163         if replac
-0003dfb0: 655f 6272 6163 6573 3a0a 2020 2020 2020  e_braces:.      
-0003dfc0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-0003dfd0: 696e 2072 616e 6765 286c 656e 286c 696e  in range(len(lin
-0003dfe0: 6573 2929 3a0a 2020 2020 2020 2020 2020  es)):.          
-0003dff0: 2020 2020 2020 2020 2020 6c69 6e65 735b            lines[
-0003e000: 695d 203d 206c 696e 6573 5b69 5d2e 7265  i] = lines[i].re
-0003e010: 706c 6163 6528 2726 6c74 3b27 2c20 273c  place('&lt;', '<
-0003e020: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0003e030: 2020 2020 2020 206c 696e 6573 5b69 5d20         lines[i] 
-0003e040: 3d20 6c69 6e65 735b 695d 2e72 6570 6c61  = lines[i].repla
-0003e050: 6365 2827 2667 743b 272c 2027 3e27 290a  ce('&gt;', '>').
-0003e060: 0a20 2020 2020 2020 2020 2020 2066 7020  .            fp 
-0003e070: 3d20 6f70 656e 286f 7574 7075 742c 2027  = open(output, '
-0003e080: 7727 290a 2020 2020 2020 2020 2020 2020  w').            
-0003e090: 6670 2e77 7269 7465 6c69 6e65 7328 6c69  fp.writelines(li
-0003e0a0: 6e65 7329 0a20 2020 2020 2020 2020 2020  nes).           
-0003e0b0: 2066 702e 636c 6f73 6528 290a 0a20 2020   fp.close()..   
-0003e0c0: 2020 2020 2023 2052 6561 6420 616c 6c20       # Read all 
-0003e0d0: 6c69 6e65 730a 2020 2020 2020 2020 6c69  lines.        li
-0003e0e0: 6e65 7320 3d20 6f70 656e 286f 7574 7075  nes = open(outpu
-0003e0f0: 7429 2e72 6561 646c 696e 6573 2829 0a0a  t).readlines()..
-0003e100: 2020 2020 2020 2020 6966 2027 616c 6164          if 'alad
-0003e110: 696e 2720 696e 2073 656c 662e 636f 6c6e  in' in self.coln
-0003e120: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-0003e130: 2020 2320 496e 7365 7274 2041 6c61 6469    # Insert Aladi
-0003e140: 6e20 4353 530a 2020 2020 2020 2020 2020  n CSS.          
-0003e150: 2020 616c 6164 696e 5f63 7373 203d 2027    aladin_css = '
-0003e160: 3c6c 696e 6b20 7265 6c3d 2273 7479 6c65  <link rel="style
-0003e170: 7368 6565 7422 2068 7265 663d 2268 7474  sheet" href="htt
-0003e180: 7073 3a2f 2f61 6c61 6469 6e2e 752d 7374  ps://aladin.u-st
-0003e190: 7261 7362 672e 6672 2f41 6c61 6469 6e4c  rasbg.fr/AladinL
-0003e1a0: 6974 652f 6170 692f 7632 2f6c 6174 6573  ite/api/v2/lates
-0003e1b0: 742f 616c 6164 696e 2e6d 696e 2e63 7373  t/aladin.min.css
-0003e1c0: 2220 2f3e 5c6e 270a 0a20 2020 2020 2020  " />\n'..       
-0003e1d0: 2020 2020 2066 6f72 2069 6c2c 206c 696e       for il, lin
-0003e1e0: 6520 696e 2065 6e75 6d65 7261 7465 286c  e in enumerate(l
-0003e1f0: 696e 6573 293a 0a20 2020 2020 2020 2020  ines):.         
-0003e200: 2020 2020 2020 2069 6620 273c 6c69 6e6b         if '<link
-0003e210: 2068 7265 663d 2720 696e 206c 696e 653a   href=' in line:
-0003e220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e230: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
-0003e240: 2020 2020 2020 2020 6c69 6e65 732e 696e          lines.in
-0003e250: 7365 7274 2869 6c2b 312c 2061 6c61 6469  sert(il+1, aladi
-0003e260: 6e5f 6373 7329 0a0a 2020 2020 2020 2020  n_css)..        
-0003e270: 2320 4578 706f 7274 2062 7574 746f 6e73  # Export buttons
-0003e280: 0a20 2020 2020 2020 2069 6620 6275 7474  .        if butt
-0003e290: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
-0003e2a0: 2023 2043 5353 0a20 2020 2020 2020 2020   # CSS.         
-0003e2b0: 2020 2063 7373 5f73 6372 6970 7420 3d20     css_script = 
-0003e2c0: 273c 6c69 6e6b 2072 656c 3d22 7374 796c  '<link rel="styl
-0003e2d0: 6573 6865 6574 2220 7479 7065 3d22 7465  esheet" type="te
-0003e2e0: 7874 2f63 7373 2220 6872 6566 3d22 6874  xt/css" href="ht
-0003e2f0: 7470 733a 2f2f 6364 6e2e 6461 7461 7461  tps://cdn.datata
-0003e300: 626c 6573 2e6e 6574 2f62 7574 746f 6e73  bles.net/buttons
-0003e310: 2f31 2e35 2e31 2f63 7373 2f62 7574 746f  /1.5.1/css/butto
-0003e320: 6e73 2e64 6174 6154 6162 6c65 732e 6d69  ns.dataTables.mi
-0003e330: 6e2e 6373 7322 3e5c 6e27 0a20 2020 2020  n.css">\n'.     
-0003e340: 2020 2020 2020 2066 6f72 2069 6c2c 206c         for il, l
-0003e350: 696e 6520 696e 2065 6e75 6d65 7261 7465  ine in enumerate
-0003e360: 286c 696e 6573 293a 0a20 2020 2020 2020  (lines):.       
-0003e370: 2020 2020 2020 2020 2069 6620 2763 7373           if 'css
-0003e380: 2f6a 7175 6572 792e 6461 7461 5461 626c  /jquery.dataTabl
-0003e390: 6527 2069 6e20 6c69 6e65 3a0a 2020 2020  e' in line:.    
-0003e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e3b0: 6272 6561 6b0a 0a20 2020 2020 2020 2020  break..         
-0003e3c0: 2020 206c 696e 6573 2e69 6e73 6572 7428     lines.insert(
-0003e3d0: 696c 2b31 2c20 6373 735f 7363 7269 7074  il+1, css_script
-0003e3e0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0003e3f0: 204a 5320 6c69 6272 6172 6965 730a 2020   JS libraries.  
-0003e400: 2020 2020 2020 2020 2020 6a73 5f73 6372            js_scr
-0003e410: 6970 7473 203d 2022 2222 0a20 2020 2020  ipts = """.     
-0003e420: 2020 2020 2020 203c 7363 7269 7074 2074         <script t
-0003e430: 7970 653d 2274 6578 742f 6a61 7661 7363  ype="text/javasc
-0003e440: 7269 7074 2220 6c61 6e67 7561 6765 3d22  ript" language="
-0003e450: 6a61 7661 7363 7269 7074 2220 7372 633d  javascript" src=
-0003e460: 2268 7474 7073 3a2f 2f63 646e 2e64 6174  "https://cdn.dat
-0003e470: 6174 6162 6c65 732e 6e65 742f 6275 7474  atables.net/butt
-0003e480: 6f6e 732f 312e 352e 312f 6a73 2f64 6174  ons/1.5.1/js/dat
-0003e490: 6154 6162 6c65 732e 6275 7474 6f6e 732e  aTables.buttons.
-0003e4a0: 6d69 6e2e 6a73 223e 3c2f 7363 7269 7074  min.js"></script
-0003e4b0: 3e0a 2020 2020 2020 2020 2020 2020 3c73  >.            <s
-0003e4c0: 6372 6970 7420 7479 7065 3d22 7465 7874  cript type="text
-0003e4d0: 2f6a 6176 6173 6372 6970 7422 206c 616e  /javascript" lan
-0003e4e0: 6775 6167 653d 226a 6176 6173 6372 6970  guage="javascrip
-0003e4f0: 7422 2073 7263 3d22 6874 7470 733a 2f2f  t" src="https://
-0003e500: 6364 6e2e 6461 7461 7461 626c 6573 2e6e  cdn.datatables.n
-0003e510: 6574 2f62 7574 746f 6e73 2f31 2e35 2e31  et/buttons/1.5.1
-0003e520: 2f6a 732f 6275 7474 6f6e 732e 666c 6173  /js/buttons.flas
-0003e530: 682e 6d69 6e2e 6a73 223e 3c2f 7363 7269  h.min.js"></scri
-0003e540: 7074 3e0a 2020 2020 2020 2020 2020 2020  pt>.            
-0003e550: 3c73 6372 6970 7420 7479 7065 3d22 7465  <script type="te
-0003e560: 7874 2f6a 6176 6173 6372 6970 7422 206c  xt/javascript" l
-0003e570: 616e 6775 6167 653d 226a 6176 6173 6372  anguage="javascr
-0003e580: 6970 7422 2073 7263 3d22 6874 7470 733a  ipt" src="https:
-0003e590: 2f2f 6364 6e6a 732e 636c 6f75 6466 6c61  //cdnjs.cloudfla
-0003e5a0: 7265 2e63 6f6d 2f61 6a61 782f 6c69 6273  re.com/ajax/libs
-0003e5b0: 2f6a 737a 6970 2f33 2e31 2e33 2f6a 737a  /jszip/3.1.3/jsz
-0003e5c0: 6970 2e6d 696e 2e6a 7322 3e3c 2f73 6372  ip.min.js"></scr
-0003e5d0: 6970 743e 0a20 2020 2020 2020 2020 2020  ipt>.           
-0003e5e0: 203c 7363 7269 7074 2074 7970 653d 2274   <script type="t
-0003e5f0: 6578 742f 6a61 7661 7363 7269 7074 2220  ext/javascript" 
-0003e600: 6c61 6e67 7561 6765 3d22 6a61 7661 7363  language="javasc
-0003e610: 7269 7074 2220 7372 633d 2268 7474 7073  ript" src="https
-0003e620: 3a2f 2f63 646e 6a73 2e63 6c6f 7564 666c  ://cdnjs.cloudfl
-0003e630: 6172 652e 636f 6d2f 616a 6178 2f6c 6962  are.com/ajax/lib
-0003e640: 732f 7064 666d 616b 652f 302e 312e 3332  s/pdfmake/0.1.32
-0003e650: 2f70 6466 6d61 6b65 2e6d 696e 2e6a 7322  /pdfmake.min.js"
-0003e660: 3e3c 2f73 6372 6970 743e 0a20 2020 2020  ></script>.     
-0003e670: 2020 2020 2020 203c 7363 7269 7074 2074         <script t
-0003e680: 7970 653d 2274 6578 742f 6a61 7661 7363  ype="text/javasc
-0003e690: 7269 7074 2220 6c61 6e67 7561 6765 3d22  ript" language="
-0003e6a0: 6a61 7661 7363 7269 7074 2220 7372 633d  javascript" src=
-0003e6b0: 2268 7474 7073 3a2f 2f63 646e 6a73 2e63  "https://cdnjs.c
-0003e6c0: 6c6f 7564 666c 6172 652e 636f 6d2f 616a  loudflare.com/aj
-0003e6d0: 6178 2f6c 6962 732f 7064 666d 616b 652f  ax/libs/pdfmake/
-0003e6e0: 302e 312e 3332 2f76 6673 5f66 6f6e 7473  0.1.32/vfs_fonts
-0003e6f0: 2e6a 7322 3e3c 2f73 6372 6970 743e 0a20  .js"></script>. 
-0003e700: 2020 2020 2020 2020 2020 203c 7363 7269             <scri
-0003e710: 7074 2074 7970 653d 2274 6578 742f 6a61  pt type="text/ja
-0003e720: 7661 7363 7269 7074 2220 6c61 6e67 7561  vascript" langua
-0003e730: 6765 3d22 6a61 7661 7363 7269 7074 2220  ge="javascript" 
-0003e740: 7372 633d 2268 7474 7073 3a2f 2f63 646e  src="https://cdn
-0003e750: 2e64 6174 6174 6162 6c65 732e 6e65 742f  .datatables.net/
-0003e760: 6275 7474 6f6e 732f 312e 352e 312f 6a73  buttons/1.5.1/js
-0003e770: 2f62 7574 746f 6e73 2e68 746d 6c35 2e6d  /buttons.html5.m
-0003e780: 696e 2e6a 7322 3e3c 2f73 6372 6970 743e  in.js"></script>
-0003e790: 0a20 2020 2020 2020 2020 2020 203c 7363  .            <sc
-0003e7a0: 7269 7074 2074 7970 653d 2274 6578 742f  ript type="text/
-0003e7b0: 6a61 7661 7363 7269 7074 2220 6c61 6e67  javascript" lang
-0003e7c0: 7561 6765 3d22 6a61 7661 7363 7269 7074  uage="javascript
-0003e7d0: 2220 7372 633d 2268 7474 7073 3a2f 2f63  " src="https://c
-0003e7e0: 646e 2e64 6174 6174 6162 6c65 732e 6e65  dn.datatables.ne
-0003e7f0: 742f 6275 7474 6f6e 732f 312e 352e 312f  t/buttons/1.5.1/
-0003e800: 6a73 2f62 7574 746f 6e73 2e70 7269 6e74  js/buttons.print
-0003e810: 2e6d 696e 2e6a 7322 3e3c 2f73 6372 6970  .min.js"></scrip
-0003e820: 743e 0a20 2020 2020 2020 2020 2020 2022  t>.            "
-0003e830: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-0003e840: 666f 7220 696c 2c20 6c69 6e65 2069 6e20  for il, line in 
-0003e850: 656e 756d 6572 6174 6528 6c69 6e65 7329  enumerate(lines)
-0003e860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003e870: 2020 6966 2027 6a73 2f6a 7175 6572 792e    if 'js/jquery.
-0003e880: 6461 7461 5461 626c 6527 2069 6e20 6c69  dataTable' in li
-0003e890: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0003e8a0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0003e8b0: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
-0003e8c0: 696e 7365 7274 2869 6c2b 322c 206a 735f  insert(il+2, js_
-0003e8d0: 7363 7269 7074 7329 0a0a 2020 2020 2020  scripts)..      
-0003e8e0: 2020 2020 2020 666f 7220 696c 2c20 6c69        for il, li
-0003e8f0: 6e65 2069 6e20 656e 756d 6572 6174 6528  ne in enumerate(
-0003e900: 6c69 6e65 7329 3a0a 2020 2020 2020 2020  lines):.        
-0003e910: 2020 2020 2020 2020 6966 2027 7061 6765          if 'page
-0003e920: 4c65 6e67 7468 2720 696e 206c 696e 653a  Length' in line:
-0003e930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e940: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
-0003e950: 2020 2020 2020 2020 6275 7474 6f6e 5f6f          button_o
-0003e960: 7074 696f 6e20 3d20 277b 7370 6163 6572  ption = '{spacer
-0003e970: 7d64 6f6d 3a20 5c27 426c 6672 7469 705c  }dom: \'Blfrtip\
-0003e980: 272c 5c6e 7b73 7061 6365 727d 6275 7474  ',\n{spacer}butt
-0003e990: 6f6e 733a 207b 6273 7472 7d2c 5c6e 272e  ons: {bstr},\n'.
-0003e9a0: 666f 726d 6174 2873 7061 6365 723d 2720  format(spacer=' 
-0003e9b0: 272a 382c 2062 7374 723d 6275 7474 6f6e  '*8, bstr=button
-0003e9c0: 732e 5f5f 7265 7072 5f5f 2829 290a 2020  s.__repr__()).  
-0003e9d0: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
-0003e9e0: 696e 7365 7274 2869 6c2b 312c 2062 7574  insert(il+1, but
-0003e9f0: 746f 6e5f 6f70 7469 6f6e 290a 0a20 2020  ton_option)..   
-0003ea00: 2020 2020 2023 2052 616e 6765 2063 6f6c       # Range col
-0003ea10: 756d 6e73 0a20 2020 2020 2020 2069 635f  umns.        ic_
-0003ea20: 6c69 7374 203d 205b 5d0a 0a20 2020 2020  list = []..     
-0003ea30: 2020 2066 696c 7465 725f 6c69 6e65 7320     filter_lines 
-0003ea40: 3d20 5b22 3c74 6162 6c65 3e5c 6e22 5d0a  = ["<table>\n"].
-0003ea50: 2020 2020 2020 2020 6465 7363 725f 7061          descr_pa
-0003ea60: 6420 3d20 2720 3c73 7061 6e20 7374 796c  d = ' <span styl
-0003ea70: 653d 2264 6973 706c 6179 3a69 6e6c 696e  e="display:inlin
-0003ea80: 652d 626c 6f63 6b3b 2077 6964 7468 3a31  e-block; width:1
-0003ea90: 303b 223e 3c2f 7370 616e 3e20 270a 0a20  0;"></span> '.. 
-0003eaa0: 2020 2020 2020 2066 6f72 2069 632c 2063         for ic, c
-0003eab0: 6f6c 2069 6e20 656e 756d 6572 6174 6528  ol in enumerate(
-0003eac0: 7365 6c66 2e63 6f6c 6e61 6d65 7329 3a0a  self.colnames):.
-0003ead0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0003eae0: 6f6c 2069 6e20 6669 6c74 6572 5f63 6f6c  ol in filter_col
-0003eaf0: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-0003eb00: 2020 2020 2020 666f 756e 6420 3d20 4661        found = Fa
-0003eb10: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0003eb20: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0003eb30: 6765 286c 656e 286c 696e 6573 2929 3a0a  ge(len(lines)):.
-0003eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003eb50: 2020 2020 6966 2027 3c74 683e 7b30 7d27      if '<th>{0}'
-0003eb60: 2e66 6f72 6d61 7428 636f 6c29 2069 6e20  .format(col) in 
-0003eb70: 6c69 6e65 735b 695d 3a0a 2020 2020 2020  lines[i]:.      
-0003eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003eb90: 2020 666f 756e 6420 3d20 5472 7565 0a20    found = True. 
-0003eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ebb0: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
-0003ebc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0003ebd0: 2066 6f75 6e64 3a0a 2020 2020 2020 2020   found:.        
-0003ebe0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-0003ebf0: 696e 7428 636f 6c29 0a20 2020 2020 2020  int(col).       
-0003ec00: 2020 2020 2020 2020 2020 2020 2069 635f               ic_
-0003ec10: 6c69 7374 2e61 7070 656e 6428 6963 290a  list.append(ic).
-0003ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ec30: 2020 2020 236c 696e 6573 5b69 5d20 3d20      #lines[i] = 
-0003ec40: 6c69 6e65 735b 695d 2e72 6570 6c61 6365  lines[i].replace
-0003ec50: 2863 6f6c 2c20 277b 307d 203c 6272 3e20  (col, '{0} <br> 
-0003ec60: 3c69 6e70 7574 2074 7970 653d 2274 6578  <input type="tex
-0003ec70: 7422 2069 643d 227b 307d 5f6d 696e 2220  t" id="{0}_min" 
-0003ec80: 6e61 6d65 3d22 7b30 7d5f 6d69 6e22 2073  name="{0}_min" s
-0003ec90: 7479 6c65 3d22 7769 6474 683a 3330 7078  tyle="width:30px
-0003eca0: 3b22 3e20 3c69 6e70 7574 2074 7970 653d  ;"> <input type=
-0003ecb0: 2274 6578 7422 2069 643d 227b 307d 5f6d  "text" id="{0}_m
-0003ecc0: 6178 2220 6e61 6d65 3d22 7b30 7d5f 6d61  ax" name="{0}_ma
-0003ecd0: 7822 2073 7479 6c65 3d22 7769 6474 683a  x" style="width:
-0003ece0: 3330 7078 3b22 3e27 2e66 6f72 6d61 7428  30px;">'.format(
-0003ecf0: 636f 6c29 290a 0a20 2020 2020 2020 2020  col))..         
-0003ed00: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-0003ed10: 725f 6c69 6e65 7320 2b3d 2027 3c74 723e  r_lines += '<tr>
-0003ed20: 203c 7464 3e20 3c69 6e70 7574 2074 7970   <td> <input typ
-0003ed30: 653d 2274 6578 7422 2069 643d 227b 307d  e="text" id="{0}
-0003ed40: 5f6d 696e 2220 6e61 6d65 3d22 7b30 7d5f  _min" name="{0}_
-0003ed50: 6d69 6e22 2073 7479 6c65 3d22 7769 6474  min" style="widt
-0003ed60: 683a 3430 7078 3b22 3e20 2623 3630 3b20  h:40px;"> &#60; 
-0003ed70: 3c2f 7464 3e20 3c74 643e 207b 307d 203c  </td> <td> {0} <
-0003ed80: 2f74 643e 203c 7464 3e20 2026 2336 303b  /td> <td>  &#60;
-0003ed90: 203c 696e 7075 7420 7479 7065 3d22 7465   <input type="te
-0003eda0: 7874 2220 6964 3d22 7b30 7d5f 6d61 7822  xt" id="{0}_max"
-0003edb0: 206e 616d 653d 227b 307d 5f6d 6178 2220   name="{0}_max" 
-0003edc0: 7374 796c 653d 2277 6964 7468 3a34 3070  style="width:40p
-0003edd0: 783b 223e 272e 666f 726d 6174 2863 6f6c  x;">'.format(col
-0003ede0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0003edf0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0003ee00: 2020 2020 2020 2020 2020 2064 6573 6372             descr
-0003ee10: 203d 2027 5c6e 270a 2020 2020 2020 2020   = '\n'.        
-0003ee20: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0003ee30: 6173 6174 7472 2873 656c 662e 636f 6c75  asattr(self.colu
-0003ee40: 6d6e 735b 636f 6c5d 2c20 2764 6573 6372  mns[col], 'descr
-0003ee50: 6970 7469 6f6e 2729 3a0a 2020 2020 2020  iption'):.      
-0003ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ee70: 2020 6966 2073 656c 662e 636f 6c75 6d6e    if self.column
-0003ee80: 735b 636f 6c5d 2e64 6573 6372 6970 7469  s[col].descripti
-0003ee90: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  on is not None:.
-0003eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003eeb0: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-0003eec0: 7220 3d20 277b 307d 207b 317d 5c6e 272e  r = '{0} {1}\n'.
-0003eed0: 666f 726d 6174 2864 6573 6372 5f70 6164  format(descr_pad
-0003eee0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-0003eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ef00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003ef10: 656c 662e 636f 6c75 6d6e 735b 636f 6c5d  elf.columns[col]
-0003ef20: 2e64 6573 6372 6970 7469 6f6e 290a 2020  .description).  
-0003ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ef60: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0003ef70: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-0003ef80: 725f 6c69 6e65 7320 2b3d 2064 6573 6372  r_lines += descr
-0003ef90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003efa0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-0003efb0: 2069 635f 6c69 7374 3a0a 2020 2020 2020   ic_list:.      
-0003efc0: 2020 2020 2020 2320 496e 7365 7274 2069        # Insert i
-0003efd0: 6e70 7574 206c 696e 6573 0a0a 2020 2020  nput lines..    
-0003efe0: 2020 2020 2020 2020 666f 7220 696c 2c20          for il, 
-0003eff0: 6c69 6e65 2069 6e20 656e 756d 6572 6174  line in enumerat
-0003f000: 6528 6c69 6e65 7329 3a0a 2020 2020 2020  e(lines):.      
-0003f010: 2020 2020 2020 2020 2020 6966 2027 7d20            if '} 
-0003f020: 293b 2020 3c2f 7363 7269 7074 3e27 2069  );  </script>' i
-0003f030: 6e20 6c69 6e65 3a0a 2020 2020 2020 2020  n line:.        
-0003f040: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0003f050: 6b0a 2020 2020 2020 2020 2020 2020 0a20  k.            . 
-0003f060: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-0003f070: 725f 726f 7720 3d20 273c 7472 3e20 3c74  r_row = '<tr> <t
-0003f080: 643e 203c 696e 7075 7420 7479 7065 3d22  d> <input type="
-0003f090: 7465 7874 2220 6964 3d22 7b30 7d5f 6d69  text" id="{0}_mi
-0003f0a0: 6e22 206e 616d 653d 227b 307d 5f6d 696e  n" name="{0}_min
-0003f0b0: 2220 7374 796c 653d 2277 6964 7468 3a34  " style="width:4
-0003f0c0: 3070 783b 223e 2026 2336 303b 203c 2f74  0px;"> &#60; </t
-0003f0d0: 643e 203c 7464 2073 7479 6c65 3d22 616c  d> <td style="al
-0003f0e0: 6967 6e3a 6365 6e74 6572 3b22 3e20 3c74  ign:center;"> <t
-0003f0f0: 743e 7b30 7d3c 2f74 743e 203c 2f74 643e  t>{0}</tt> </td>
-0003f100: 203c 7464 3e20 2026 2336 303b 203c 696e   <td>  &#60; <in
-0003f110: 7075 7420 7479 7065 3d22 7465 7874 2220  put type="text" 
-0003f120: 6964 3d22 7b30 7d5f 6d61 7822 206e 616d  id="{0}_max" nam
-0003f130: 653d 227b 307d 5f6d 6178 2220 7374 796c  e="{0}_max" styl
-0003f140: 653d 2277 6964 7468 3a34 3070 783b 223e  e="width:40px;">
-0003f150: 270a 2020 2020 2020 2020 2020 2020 0a20  '.            . 
-0003f160: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-0003f170: 725f 726f 7773 203d 205b 5d0a 2020 2020  r_rows = [].    
-0003f180: 2020 2020 2020 2020 666f 7220 6963 2069          for ic i
-0003f190: 6e20 6963 5f6c 6973 743a 0a20 2020 2020  n ic_list:.     
-0003f1a0: 2020 2020 2020 2020 2020 2063 6f6c 203d             col =
-0003f1b0: 2073 656c 662e 636f 6c6e 616d 6573 5b69   self.colnames[i
-0003f1c0: 635d 0a20 2020 2020 2020 2020 2020 2020  c].             
-0003f1d0: 2020 2072 6f77 5f69 203d 2066 696c 7465     row_i = filte
-0003f1e0: 725f 726f 772e 666f 726d 6174 2863 6f6c  r_row.format(col
-0003f1f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0003f200: 2020 6465 7363 7220 3d20 275c 6e27 0a20    descr = '\n'. 
-0003f210: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003f220: 6620 6861 7361 7474 7228 7365 6c66 2e63  f hasattr(self.c
-0003f230: 6f6c 756d 6e73 5b63 6f6c 5d2c 2027 6465  olumns[col], 'de
-0003f240: 7363 7269 7074 696f 6e27 293a 0a20 2020  scription'):.   
-0003f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f260: 2069 6620 7365 6c66 2e63 6f6c 756d 6e73   if self.columns
-0003f270: 5b63 6f6c 5d2e 6465 7363 7269 7074 696f  [col].descriptio
-0003f280: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
-0003f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2a0: 2020 2020 2020 2064 6573 6372 203d 2027         descr = '
-0003f2b0: 7b30 7d20 7b31 7d5c 6e27 2e66 6f72 6d61  {0} {1}\n'.forma
-0003f2c0: 7428 6465 7363 725f 7061 642c 200a 2020  t(descr_pad, .  
-0003f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2f0: 2020 2020 2020 7365 6c66 2e63 6f6c 756d        self.colum
-0003f300: 6e73 5b63 6f6c 5d2e 6465 7363 7269 7074  ns[col].descript
-0003f310: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
-0003f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f340: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0003f350: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-0003f360: 5f72 6f77 732e 6170 7065 6e64 2872 6f77  _rows.append(row
-0003f370: 5f69 202b 2064 6573 6372 290a 2020 2020  _i + descr).    
-0003f380: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0003f390: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
-0003f3a0: 696e 7075 7420 3d20 2222 220a 0a3c 6469  input = """..<di
-0003f3b0: 7620 7374 796c 653d 2262 6f72 6465 723a  v style="border:
-0003f3c0: 3170 7820 736f 6c69 6420 626c 6163 6b3b  1px solid black;
-0003f3d0: 2070 6164 6469 6e67 3a31 3070 783b 206d   padding:10px; m
-0003f3e0: 6172 6769 6e3a 3130 7078 223e 0a3c 623e  argin:10px">.<b>
-0003f3f0: 2046 696c 7465 723a 203c 2f62 3e0a 2020   Filter: </b>.  
-0003f400: 2020 3c74 6162 6c65 3e0a 2020 2020 2020    <table>.      
-0003f410: 7b30 7d0a 2020 2020 3c2f 7461 626c 653e  {0}.    </table>
-0003f420: 0a3c 2f64 6976 3e0a 0a22 2222 2e66 6f72  .</div>..""".for
-0003f430: 6d61 7428 275c 6e27 2e6a 6f69 6e28 6669  mat('\n'.join(fi
-0003f440: 6c74 6572 5f72 6f77 7329 290a 0a20 2020  lter_rows))..   
-0003f450: 2020 2020 2020 2020 206c 696e 6573 2e69           lines.i
-0003f460: 6e73 6572 7428 696c 2b31 2c20 6669 6c74  nsert(il+1, filt
-0003f470: 6572 5f69 6e70 7574 290a 0a20 2020 2020  er_input)..     
-0003f480: 2020 2020 2020 2023 204a 6176 6173 6372         # Javascr
-0003f490: 6970 7420 7075 7368 2066 756e 6374 696f  ipt push functio
-0003f4a0: 6e0a 2020 2020 2020 2020 2020 2020 6865  n.            he
-0003f4b0: 6164 6572 5f6c 696e 6573 203d 2022 220a  ader_lines = "".
-0003f4c0: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0003f4d0: 6572 203d 205b 5d0a 0a20 2020 2020 2020  er = []..       
-0003f4e0: 2020 2020 2066 6f72 2069 6320 696e 2069       for ic in i
-0003f4f0: 635f 6c69 7374 3a0a 2020 2020 2020 2020  c_list:.        
-0003f500: 2020 2020 2020 2020 6865 6164 6572 5f6c          header_l
-0003f510: 696e 6573 202b 3d20 2222 220a 2020 2020  ines += """.    
-0003f520: 2020 2020 7661 7220 6d69 6e5f 7b30 7d20      var min_{0} 
-0003f530: 3d20 7061 7273 6546 6c6f 6174 2820 2428  = parseFloat( $(
-0003f540: 2723 7b30 7d5f 6d69 6e27 292e 7661 6c28  '#{0}_min').val(
-0003f550: 2929 207c 7c20 2d31 6533 303b 0a20 2020  )) || -1e30;.   
-0003f560: 2020 2020 2076 6172 206d 6178 5f7b 307d       var max_{0}
-0003f570: 203d 2070 6172 7365 466c 6f61 7428 2024   = parseFloat( $
-0003f580: 2827 237b 307d 5f6d 6178 2729 2e76 616c  ('#{0}_max').val
-0003f590: 2829 2920 7c7c 2020 3165 3330 3b0a 2020  ()) ||  1e30;.  
-0003f5a0: 2020 2020 2020 7661 7220 6461 7461 5f7b        var data_{
-0003f5b0: 307d 203d 2070 6172 7365 466c 6f61 7428  0} = parseFloat(
-0003f5c0: 2064 6174 615b 7b31 7d5d 2029 207c 7c20   data[{1}] ) || 
-0003f5d0: 303b 0a20 2020 2020 2020 2020 2020 2020  0;.             
-0003f5e0: 2020 2022 2222 2e66 6f72 6d61 7428 7365     """.format(se
-0003f5f0: 6c66 2e63 6f6c 6e61 6d65 735b 6963 5d2c  lf.colnames[ic],
-0003f600: 2069 6329 0a0a 2020 2020 2020 2020 2020   ic)..          
-0003f610: 2020 2020 2020 7465 7374 6572 2e61 7070        tester.app
-0003f620: 656e 6428 2222 2228 2028 2069 734e 614e  end("""( ( isNaN
-0003f630: 2820 6d69 6e5f 7b30 7d20 2920 2626 2069  ( min_{0} ) && i
-0003f640: 734e 614e 2820 6d61 785f 7b30 7d20 2920  sNaN( max_{0} ) 
-0003f650: 2920 7c7c 2028 2069 734e 614e 2820 6d69  ) || ( isNaN( mi
-0003f660: 6e5f 7b30 7d20 2920 2626 2064 6174 615f  n_{0} ) && data_
-0003f670: 7b30 7d20 3c3d 206d 6178 5f7b 307d 2029  {0} <= max_{0} )
-0003f680: 207c 7c20 2820 6d69 6e5f 7b30 7d20 3c3d   || ( min_{0} <=
-0003f690: 2064 6174 615f 7b30 7d20 2026 2620 6973   data_{0}  && is
-0003f6a0: 4e61 4e28 206d 6178 5f7b 307d 2029 2029  NaN( max_{0} ) )
-0003f6b0: 207c 7c20 2820 6d69 6e5f 7b30 7d20 3c3d   || ( min_{0} <=
-0003f6c0: 2064 6174 615f 7b30 7d20 2026 2620 6461   data_{0}  && da
-0003f6d0: 7461 5f7b 307d 203c 3d20 6d61 785f 7b30  ta_{0} <= max_{0
-0003f6e0: 7d20 2920 2922 2222 2e66 6f72 6d61 7428  } ) )""".format(
-0003f6f0: 7365 6c66 2e63 6f6c 6e61 6d65 735b 6963  self.colnames[ic
-0003f700: 5d29 290a 0a20 2020 2020 2020 2020 2020  ]))..           
-0003f710: 2023 204a 6176 6173 6372 6970 7420 6669   # Javascript fi
-0003f720: 6c74 6572 2066 756e 6374 696f 6e0a 2020  lter function.  
-0003f730: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-0003f740: 5f66 756e 6374 696f 6e20 3d20 2222 220a  _function = """.
-0003f750: 0a2f 2f2f 2f20 5061 7273 6572 0a2f 2f20  .//// Parser.// 
-0003f760: 6874 7470 733a 2f2f 7374 6163 6b6f 7665  https://stackove
-0003f770: 7266 6c6f 772e 636f 6d2f 7175 6573 7469  rflow.com/questi
-0003f780: 6f6e 732f 3139 3439 3133 3336 2f67 6574  ons/19491336/get
-0003f790: 2d75 726c 2d70 6172 616d 6574 6572 2d6a  -url-parameter-j
-0003f7a0: 7175 6572 792d 6f72 2d68 6f77 2d74 6f2d  query-or-how-to-
-0003f7b0: 6765 742d 7175 6572 792d 7374 7269 6e67  get-query-string
-0003f7c0: 2d76 616c 7565 732d 696e 2d6a 7320 4020  -values-in-js @ 
-0003f7d0: 5265 7a61 2042 6172 6164 6172 616e 0a24  Reza Baradaran.$
-0003f7e0: 2e75 726c 5061 7261 6d20 3d20 6675 6e63  .urlParam = func
-0003f7f0: 7469 6f6e 286e 616d 6529 7b7b 0a20 2020  tion(name){{.   
-0003f800: 2076 6172 2072 6573 756c 7473 203d 206e   var results = n
-0003f810: 6577 2052 6567 4578 7028 275b 5c3f 265d  ew RegExp('[\?&]
-0003f820: 2720 2b20 6e61 6d65 202b 2027 3d28 5b5e  ' + name + '=([^
-0003f830: 2623 5d2a 2927 292e 6578 6563 2877 696e  &#]*)').exec(win
-0003f840: 646f 772e 6c6f 6361 7469 6f6e 2e68 7265  dow.location.hre
-0003f850: 6629 3b0a 2020 2020 6966 2028 7265 7375  f);.    if (resu
-0003f860: 6c74 733d 3d6e 756c 6c29 7b7b 0a20 2020  lts==null){{.   
-0003f870: 2020 2020 7265 7475 726e 206e 756c 6c3b      return null;
-0003f880: 0a20 2020 207d 7d0a 2020 2020 656c 7365  .    }}.    else
-0003f890: 7b7b 0a20 2020 2020 2020 7265 7475 726e  {{.       return
-0003f8a0: 2064 6563 6f64 6555 5249 2872 6573 756c   decodeURI(resul
-0003f8b0: 7473 5b31 5d29 207c 7c20 303b 0a20 2020  ts[1]) || 0;.   
-0003f8c0: 207d 7d0a 7d7d 0a0a 242e 666e 2e64 6174   }}.}}..$.fn.dat
-0003f8d0: 6154 6162 6c65 2e65 7874 2e73 6561 7263  aTable.ext.searc
-0003f8e0: 682e 7075 7368 280a 2020 2020 6675 6e63  h.push(.    func
-0003f8f0: 7469 6f6e 2820 7365 7474 696e 6773 2c20  tion( settings, 
-0003f900: 6461 7461 2c20 6461 7461 496e 6465 7820  data, dataIndex 
-0003f910: 2920 7b7b 0a7b 307d 0a0a 2020 2020 2020  ) {{.{0}..      
-0003f920: 2020 6966 2028 207b 317d 2029 0a20 2020    if ( {1} ).   
-0003f930: 2020 2020 207b 7b0a 2020 2020 2020 2020       {{.        
-0003f940: 2020 2020 7265 7475 726e 2074 7275 653b      return true;
-0003f950: 0a20 2020 2020 2020 207d 7d0a 2020 2020  .        }}.    
-0003f960: 2020 2020 7265 7475 726e 2066 616c 7365      return false
-0003f970: 3b0a 2020 2020 7d7d 0a29 3b0a 0a2f 2f2f  ;.    }}.);..///
-0003f980: 2f20 5570 6461 7465 2055 524c 2077 6974  / Update URL wit
-0003f990: 6820 6669 6c74 6572 2070 6172 616d 6574  h filter paramet
-0003f9a0: 6572 730a 7661 7220 6669 6c74 6572 5f70  ers.var filter_p
-0003f9b0: 6172 616d 7320 3d20 7b32 7d3b 0a0a 242e  arams = {2};..$.
-0003f9c0: 5570 6461 7465 4669 6c74 6572 5552 4c20  UpdateFilterURL 
-0003f9d0: 3d20 6675 6e63 7469 6f6e 2028 2920 7b7b  = function () {{
-0003f9e0: 0a20 2020 2076 6172 2069 3b0a 2020 2020  .    var i;.    
-0003f9f0: 7661 7220 6669 6c74 6572 5f75 726c 203d  var filter_url =
-0003fa00: 2022 223b 0a20 2020 2066 6f72 2028 6920   "";.    for (i 
-0003fa10: 3d20 303b 2069 203c 2066 696c 7465 725f  = 0; i < filter_
-0003fa20: 7061 7261 6d73 2e6c 656e 6774 683b 2069  params.length; i
-0003fa30: 2b2b 2920 7b7b 0a20 2020 2020 2020 2069  ++) {{.        i
-0003fa40: 6620 2824 2827 2327 2b66 696c 7465 725f  f ($('#'+filter_
-0003fa50: 7061 7261 6d73 5b69 5d2b 275f 6d69 6e27  params[i]+'_min'
-0003fa60: 292e 7661 6c28 2920 213d 2022 2229 207b  ).val() != "") {
-0003fa70: 7b0a 2020 2020 2020 2020 2020 2020 6669  {.            fi
-0003fa80: 6c74 6572 5f75 726c 202b 3d20 2726 272b  lter_url += '&'+
-0003fa90: 6669 6c74 6572 5f70 6172 616d 735b 695d  filter_params[i]
-0003faa0: 2b27 5f6d 696e 3d27 2b0a 2020 2020 2020  +'_min='+.      
-0003fab0: 2020 2020 2020 2020 2020 2020 2020 2428                $(
-0003fac0: 2723 272b 6669 6c74 6572 5f70 6172 616d  '#'+filter_param
-0003fad0: 735b 695d 2b27 5f6d 696e 2729 2e76 616c  s[i]+'_min').val
-0003fae0: 2829 3b0a 2020 2020 2020 2020 7d7d 0a20  ();.        }}. 
-0003faf0: 2020 2020 2020 2069 6620 2824 2827 2327         if ($('#'
-0003fb00: 2b66 696c 7465 725f 7061 7261 6d73 5b69  +filter_params[i
-0003fb10: 5d2b 275f 6d61 7827 292e 7661 6c28 2920  ]+'_max').val() 
-0003fb20: 213d 2022 2229 207b 7b0a 2020 2020 2020  != "") {{.      
-0003fb30: 2020 2020 2020 6669 6c74 6572 5f75 726c        filter_url
-0003fb40: 202b 3d20 2726 272b 6669 6c74 6572 5f70   += '&'+filter_p
-0003fb50: 6172 616d 735b 695d 2b27 5f6d 6178 3d27  arams[i]+'_max='
-0003fb60: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-0003fb70: 2020 2020 2020 2428 2723 272b 6669 6c74        $('#'+filt
-0003fb80: 6572 5f70 6172 616d 735b 695d 2b27 5f6d  er_params[i]+'_m
-0003fb90: 6178 2729 2e76 616c 2829 3b0a 2020 2020  ax').val();.    
-0003fba0: 2020 2020 7d7d 0a20 2020 207d 7d0a 0a20      }}.    }}.. 
-0003fbb0: 2020 2069 6620 2866 696c 7465 725f 7572     if (filter_ur
-0003fbc0: 6c20 213d 2022 2229 207b 7b0a 2020 2020  l != "") {{.    
-0003fbd0: 2020 2020 7661 7220 6669 6c74 6572 6564      var filtered
-0003fbe0: 5f75 726c 203d 2077 696e 646f 772e 6c6f  _url = window.lo
-0003fbf0: 6361 7469 6f6e 2e68 7265 662e 7370 6c69  cation.href.spli
-0003fc00: 7428 273f 2729 5b30 5d20 2b20 273f 2720  t('?')[0] + '?' 
-0003fc10: 2b20 6669 6c74 6572 5f75 726c 3b0a 2020  + filter_url;.  
-0003fc20: 2020 2020 2020 7769 6e64 6f77 2e68 6973        window.his
-0003fc30: 746f 7279 2e70 7573 6853 7461 7465 2827  tory.pushState('
-0003fc40: 272c 2027 272c 2066 696c 7465 7265 645f  ', '', filtered_
-0003fc50: 7572 6c29 3b0a 2020 2020 7d7d 0a7d 7d5c  url);.    }}.}}\
-0003fc60: 6e5c 6e22 2222 2e66 6f72 6d61 7428 6865  n\n""".format(he
-0003fc70: 6164 6572 5f6c 696e 6573 2c20 225c 6e20  ader_lines, "\n 
-0003fc80: 2626 2022 2e6a 6f69 6e28 7465 7374 6572  && ".join(tester
-0003fc90: 292c 205b 7365 6c66 2e63 6f6c 6e61 6d65  ), [self.colname
-0003fca0: 735b 6963 5d20 666f 7220 6963 2069 6e20  s[ic] for ic in 
-0003fcb0: 6963 5f6c 6973 745d 2e5f 5f72 6570 725f  ic_list].__repr_
-0003fcc0: 5f28 2929 0a0a 2020 2020 2020 2020 2020  _())..          
-0003fcd0: 2020 666f 7220 692c 206c 696e 6520 696e    for i, line in
-0003fce0: 2065 6e75 6d65 7261 7465 286c 696e 6573   enumerate(lines
-0003fcf0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0003fd00: 2020 2069 6620 2224 2864 6f63 756d 656e     if "$(documen
-0003fd10: 7429 2e72 6561 6479 2866 756e 6374 696f  t).ready(functio
-0003fd20: 6e28 2922 2069 6e20 6c69 6e65 3a0a 2020  n()" in line:.  
-0003fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fd40: 2020 6973 7461 7274 203d 2069 0a20 2020    istart = i.   
-0003fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fd60: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-0003fd70: 2020 2020 6c69 6e65 732e 696e 7365 7274      lines.insert
-0003fd80: 2869 7374 6172 742c 2066 696c 7465 725f  (istart, filter_
-0003fd90: 6675 6e63 7469 6f6e 290a 0a20 2020 2020  function)..     
-0003fda0: 2020 2020 2020 2023 2050 6172 7365 2061         # Parse a
-0003fdb0: 6464 7265 7373 2062 6172 0a20 2020 2020  ddress bar.     
-0003fdc0: 2020 2020 2020 206c 696e 6573 2e69 6e73         lines.ins
-0003fdd0: 6572 7428 6973 7461 7274 2b32 2c20 225c  ert(istart+2, "\
-0003fde0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-0003fdf0: 666f 7220 6963 2069 6e20 6963 5f6c 6973  for ic in ic_lis
-0003fe00: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0003fe10: 2020 206c 696e 6573 2e69 6e73 6572 7428     lines.insert(
-0003fe20: 6973 7461 7274 2b32 2c20 227b 317d 2428  istart+2, "{1}$(
-0003fe30: 2723 7b30 7d5f 6d61 7827 292e 7661 6c28  '#{0}_max').val(
-0003fe40: 242e 7572 6c50 6172 616d 2827 7b30 7d5f  $.urlParam('{0}_
-0003fe50: 6d61 7827 2929 3b5c 6e22 2e66 6f72 6d61  max'));\n".forma
-0003fe60: 7428 7365 6c66 2e63 6f6c 6e61 6d65 735b  t(self.colnames[
-0003fe70: 6963 5d2c 2027 2027 2a33 2929 0a20 2020  ic], ' '*3)).   
-0003fe80: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-0003fe90: 6573 2e69 6e73 6572 7428 6973 7461 7274  es.insert(istart
-0003fea0: 2b32 2c20 227b 317d 2428 2723 7b30 7d5f  +2, "{1}$('#{0}_
-0003feb0: 6d69 6e27 292e 7661 6c28 242e 7572 6c50  min').val($.urlP
-0003fec0: 6172 616d 2827 7b30 7d5f 6d69 6e27 2929  aram('{0}_min'))
-0003fed0: 3b5c 6e22 2e66 6f72 6d61 7428 7365 6c66  ;\n".format(self
-0003fee0: 2e63 6f6c 6e61 6d65 735b 6963 5d2c 2027  .colnames[ic], '
-0003fef0: 2027 2a33 2929 0a20 2020 2020 2020 2020   '*3)).         
-0003ff00: 2020 206c 696e 6573 2e69 6e73 6572 7428     lines.insert(
-0003ff10: 6973 7461 7274 2b32 2c20 225c 6e22 290a  istart+2, "\n").
-0003ff20: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-0003ff30: 6e70 7574 206c 6973 7465 6e65 720a 2020  nput listener.  
-0003ff40: 2020 2020 2020 2020 2020 6c69 7374 656e            listen
-0003ff50: 6572 203d 2022 2222 0a20 2020 202f 2f20  er = """.    // 
-0003ff60: 4576 656e 7420 6c69 7374 656e 6572 2074  Event listener t
-0003ff70: 6f20 7468 6520 7477 6f20 7261 6e67 6520  o the two range 
-0003ff80: 6669 6c74 6572 696e 6720 696e 7075 7473  filtering inputs
-0003ff90: 2074 6f20 7265 6472 6177 206f 6e20 696e   to redraw on in
-0003ffa0: 7075 740a 2020 2020 2428 277b 307d 2729  put.    $('{0}')
-0003ffb0: 2e6b 6579 7570 2820 6675 6e63 7469 6f6e  .keyup( function
-0003ffc0: 2829 207b 7b0a 2020 2020 2020 2020 7461  () {{.        ta
-0003ffd0: 626c 652e 6472 6177 2829 3b0a 2020 2020  ble.draw();.    
-0003ffe0: 2020 2020 242e 5570 6461 7465 4669 6c74      $.UpdateFilt
-0003fff0: 6572 5552 4c28 293b 0a20 2020 207d 7d20  erURL();.    }} 
-00040000: 293b 0a20 2020 2020 2020 2020 2020 2022  );.            "
-00040010: 2222 2e66 6f72 6d61 7428 272c 2027 2e6a  "".format(', '.j
-00040020: 6f69 6e28 5b27 237b 307d 5f6d 696e 2c20  oin(['#{0}_min, 
-00040030: 237b 307d 5f6d 6178 272e 666f 726d 6174  #{0}_max'.format
-00040040: 2873 656c 662e 636f 6c6e 616d 6573 5b69  (self.colnames[i
-00040050: 635d 2920 666f 7220 6963 2069 6e20 6963  c]) for ic in ic
-00040060: 5f6c 6973 745d 2929 0a0a 2020 2020 2020  _list]))..      
-00040070: 2020 2020 2020 666f 7220 696c 2c20 6c69        for il, li
-00040080: 6e65 2069 6e20 656e 756d 6572 6174 6528  ne in enumerate(
-00040090: 6c69 6e65 7329 3a0a 2020 2020 2020 2020  lines):.        
-000400a0: 2020 2020 2020 2020 6966 2027 7d20 293b          if '} );
-000400b0: 2020 3c2f 7363 7269 7074 3e27 2069 6e20    </script>' in 
-000400c0: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
-000400d0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-000400e0: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-000400f0: 6573 2e69 6e73 6572 7428 696c 2c20 6c69  es.insert(il, li
-00040100: 7374 656e 6572 290a 0a20 2020 2020 2020  stener)..       
-00040110: 2020 2020 2066 7020 3d20 6f70 656e 286f       fp = open(o
-00040120: 7574 7075 742c 2027 7727 290a 2020 2020  utput, 'w').    
-00040130: 2020 2020 2020 2020 6670 2e77 7269 7465          fp.write
-00040140: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
-00040150: 2020 2020 2020 2020 2066 702e 636c 6f73           fp.clos
-00040160: 6528 290a 0a20 2020 2020 2020 2069 6620  e()..        if 
-00040170: 746f 6767 6c65 3a0a 2020 2020 2020 2020  toggle:.        
-00040180: 2020 2020 6c69 6e65 7320 3d20 6f70 656e      lines = open
-00040190: 286f 7574 7075 7429 2e72 6561 646c 696e  (output).readlin
-000401a0: 6573 2829 0a0a 2020 2020 2020 2020 2020  es()..          
-000401b0: 2020 2320 4368 616e 6765 2063 616c 6c20    # Change call 
-000401c0: 746f 2044 6174 6154 6162 6c65 0a20 2020  to DataTable.   
-000401d0: 2020 2020 2020 2020 2066 6f72 2069 6c2c           for il,
-000401e0: 206c 696e 6520 696e 2065 6e75 6d65 7261   line in enumera
-000401f0: 7465 286c 696e 6573 293a 0a20 2020 2020  te(lines):.     
-00040200: 2020 2020 2020 2020 2020 2069 6620 2764             if 'd
-00040210: 6174 6154 6162 6c65 2827 2069 6e20 6c69  ataTable(' in li
-00040220: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00040230: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
-00040240: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-00040250: 5b69 6c5d 203d 2022 2020 2076 6172 2074  [il] = "   var t
-00040260: 6162 6c65 203d 207b 307d 5c6e 222e 666f  able = {0}\n".fo
-00040270: 726d 6174 286c 696e 6573 5b69 6c5d 2e73  rmat(lines[il].s
-00040280: 7472 6970 2829 2e72 6570 6c61 6365 2827  trip().replace('
-00040290: 6461 7461 5461 626c 6527 2c20 2744 6174  dataTable', 'Dat
-000402a0: 6154 6162 6c65 2729 290a 0a20 2020 2020  aTable'))..     
-000402b0: 2020 2020 2020 2023 2041 6464 2066 756e         # Add fun
-000402c0: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
-000402d0: 2020 666f 7220 696c 2c20 6c69 6e65 2069    for il, line i
-000402e0: 6e20 656e 756d 6572 6174 6528 6c69 6e65  n enumerate(line
-000402f0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00040300: 2020 2020 6966 2027 7d20 293b 2020 3c2f      if '} );  </
-00040310: 7363 7269 7074 3e27 2069 6e20 6c69 6e65  script>' in line
-00040320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00040330: 2020 2020 2020 6272 6561 6b0a 0a20 2020        break..   
-00040340: 2020 2020 2020 2020 2074 6f67 676c 6572           toggler
-00040350: 203d 2022 2222 0a20 2020 2024 2827 612e   = """.    $('a.
-00040360: 746f 6767 6c65 2d76 6973 2729 2e6f 6e28  toggle-vis').on(
-00040370: 2027 636c 6963 6b27 2c20 6675 6e63 7469   'click', functi
-00040380: 6f6e 2028 6529 207b 0a20 2020 2020 2020  on (e) {.       
-00040390: 2065 2e70 7265 7665 6e74 4465 6661 756c   e.preventDefaul
-000403a0: 7428 293b 0a0a 2020 2020 2020 2020 2f2f  t();..        //
-000403b0: 2047 6574 2074 6865 2063 6f6c 756d 6e20   Get the column 
-000403c0: 4150 4920 6f62 6a65 6374 0a20 2020 2020  API object.     
-000403d0: 2020 2076 6172 2063 6f6c 756d 6e20 3d20     var column = 
-000403e0: 7461 626c 652e 636f 6c75 6d6e 2820 2428  table.column( $(
-000403f0: 7468 6973 292e 6174 7472 2827 6461 7461  this).attr('data
-00040400: 2d63 6f6c 756d 6e27 2920 293b 0a0a 2020  -column') );..  
-00040410: 2020 2020 2020 2f2f 2054 6f67 676c 6520        // Toggle 
-00040420: 7468 6520 7669 7369 6269 6c69 7479 0a20  the visibility. 
-00040430: 2020 2020 2020 2063 6f6c 756d 6e2e 7669         column.vi
-00040440: 7369 626c 6528 2021 2063 6f6c 756d 6e2e  sible( ! column.
-00040450: 7669 7369 626c 6528 2920 293b 0a20 2020  visible() );.   
-00040460: 207d 2029 3b0a 0a20 2020 2020 2020 2020   } );..         
-00040470: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
-00040480: 2020 206c 696e 6573 2e69 6e73 6572 7428     lines.insert(
-00040490: 696c 2c20 746f 6767 6c65 7229 0a0a 2020  il, toggler)..  
-000404a0: 2020 2020 2020 2020 2020 746f 6767 6c65            toggle
-000404b0: 5f64 6976 203d 2022 2222 0a3c 6469 7620  _div = """.<div 
-000404c0: 7374 796c 653d 2262 6f72 6465 723a 3170  style="border:1p
-000404d0: 7820 736f 6c69 6420 626c 6163 6b3b 2070  x solid black; p
-000404e0: 6164 6469 6e67 3a31 3070 783b 206d 6172  adding:10px; mar
-000404f0: 6769 6e3a 3130 7078 223e 0a20 2020 203c  gin:10px">.    <
-00040500: 623e 546f 6767 6c65 2063 6f6c 756d 6e3a  b>Toggle column:
-00040510: 3c2f 623e 3c2f 6272 3e20 7b30 7d0a 3c2f  </b></br> {0}.</
-00040520: 6469 763e 0a0a 2020 2020 2020 2020 2020  div>..          
-00040530: 2020 2222 222e 666f 726d 6174 2827 203c    """.format(' <
-00040540: 623e 2f3c 2f62 3e20 272e 6a6f 696e 285b  b>/</b> '.join([
-00040550: 273c 6120 636c 6173 733d 2274 6f67 676c  '<a class="toggl
-00040560: 652d 7669 7322 2064 6174 612d 636f 6c75  e-vis" data-colu
-00040570: 6d6e 3d22 7b30 7d22 3e20 3c74 743e 7b31  mn="{0}"> <tt>{1
-00040580: 7d3c 2f74 743e 203c 2f61 3e27 2e66 6f72  }</tt> </a>'.for
-00040590: 6d61 7428 6963 2c20 636f 6c29 2066 6f72  mat(ic, col) for
-000405a0: 2069 632c 2063 6f6c 2069 6e20 656e 756d   ic, col in enum
-000405b0: 6572 6174 6528 7365 6c66 2e63 6f6c 6e61  erate(self.colna
-000405c0: 6d65 7329 5d29 290a 0a20 2020 2020 2020  mes)]))..       
-000405d0: 2020 2020 206c 696e 6573 2e69 6e73 6572       lines.inser
-000405e0: 7428 696c 2b32 2c20 746f 6767 6c65 5f64  t(il+2, toggle_d
-000405f0: 6976 290a 0a20 2020 2020 2020 2020 2020  iv)..           
-00040600: 2066 7020 3d20 6f70 656e 286f 7574 7075   fp = open(outpu
-00040610: 742c 2027 7727 290a 2020 2020 2020 2020  t, 'w').        
-00040620: 2020 2020 6670 2e77 7269 7465 6c69 6e65      fp.writeline
-00040630: 7328 6c69 6e65 7329 0a20 2020 2020 2020  s(lines).       
-00040640: 2020 2020 2066 702e 636c 6f73 6528 290a       fp.close().
-00040650: 0a20 2020 2020 2020 2069 6620 7573 655f  .        if use_
-00040660: 6a73 6f6e 3a0a 2020 2020 2020 2020 2020  json:.          
-00040670: 2020 2320 5772 6974 6520 6173 206a 736f    # Write as jso
-00040680: 6e0a 0a20 2020 2020 2020 2020 2020 2023  n..            #
-00040690: 2057 6f72 6b61 726f 756e 6420 746f 2067   Workaround to g
-000406a0: 6574 2061 7363 6969 2066 6f72 6d61 7474  et ascii formatt
-000406b0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-000406c0: 2370 6420 3d20 7365 6c66 2e74 6f5f 7061  #pd = self.to_pa
-000406d0: 6e64 6173 2829 0a20 2020 2020 2020 2020  ndas().         
-000406e0: 2020 206e 6577 203d 2047 5461 626c 6528     new = GTable(
-000406f0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00040700: 7220 6320 696e 2073 656c 662e 636f 6c6e  r c in self.coln
-00040710: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
-00040720: 2020 2020 2020 6e65 775b 635d 203d 2073        new[c] = s
-00040730: 656c 665b 635d 0a0a 2020 2020 2020 2020  elf[c]..        
-00040740: 2020 2020 6966 2027 616c 6164 696e 2720      if 'aladin' 
-00040750: 696e 2073 656c 662e 636f 6c6e 616d 6573  in self.colnames
-00040760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00040770: 2020 7064 203d 2047 5461 626c 6528 6e65    pd = GTable(ne
-00040780: 7729 2e74 6f5f 7061 6e64 6173 2829 0a20  w).to_pandas(). 
-00040790: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000407a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000407b0: 206e 6577 2e77 7269 7465 2827 2f74 6d70   new.write('/tmp
-000407c0: 2f74 6162 6c65 2e63 7376 272c 2066 6f72  /table.csv', for
-000407d0: 6d61 743d 2763 7376 272c 206f 7665 7277  mat='csv', overw
-000407e0: 7269 7465 3d54 7275 6529 0a20 2020 2020  rite=True).     
-000407f0: 2020 2020 2020 2020 2020 2070 6420 3d20             pd = 
-00040800: 4754 6162 6c65 2e67 7265 6164 2827 2f74  GTable.gread('/t
-00040810: 6d70 2f74 6162 6c65 2e63 7376 2729 2e74  mp/table.csv').t
-00040820: 6f5f 7061 6e64 6173 2829 0a0a 2020 2020  o_pandas()..    
-00040830: 2020 2020 2020 2020 2320 5265 666f 726d          # Reform
-00040840: 6174 2074 6f20 6a73 6f6e 0a20 2020 2020  at to json.     
-00040850: 2020 2020 2020 206a 736f 6e5f 6461 7461         json_data
-00040860: 203d 2027 2020 2020 2020 2020 2720 2b20   = '        ' + 
-00040870: 7064 2e74 6f5f 6a73 6f6e 286f 7269 656e  pd.to_json(orien
-00040880: 743d 2776 616c 7565 7327 292e 7265 706c  t='values').repl
-00040890: 6163 6528 275d 2c5b 272c 2027 5c6e 2020  ace('],[', '\n  
-000408a0: 2020 5d78 7878 7878 785c 6e20 2020 205b    ]xxxxxx\n    [
-000408b0: 5c6e 2020 2020 2020 2020 2729 2e72 6570  \n        ').rep
-000408c0: 6c61 6365 2827 2c20 272c 2027 7863 6f6d  lace(', ', 'xcom
-000408d0: 6d61 7370 6163 6578 2729 2e72 6570 6c61  maspacex').repla
-000408e0: 6365 2827 2c27 2c20 272c 5c6e 2020 2020  ce(',', ',\n    
-000408f0: 2020 2020 2729 2e72 6570 6c61 6365 2827      ').replace('
-00040900: 7878 7878 7878 272c 2027 2c27 292e 7265  xxxxxx', ',').re
-00040910: 706c 6163 6528 2778 636f 6d6d 6173 7061  place('xcommaspa
-00040920: 6365 7827 2c20 272c 2027 290a 2020 2020  cex', ', ').    
-00040930: 2020 2020 2020 2020 6a73 6f6e 5f73 7472          json_str
-00040940: 203d 2022 2222 7b7b 0a20 2022 6461 7461   = """{{.  "data
-00040950: 223a 0a7b 307d 0a0a 7d7d 0a22 2222 2e66  ":.{0}..}}.""".f
-00040960: 6f72 6d61 7428 6a73 6f6e 5f64 6174 612e  ormat(json_data.
-00040970: 7265 706c 6163 6528 275c 5c22 2227 2c20  replace('\\""', 
-00040980: 2722 2729 290a 0a20 2020 2020 2020 2020  '"'))..         
-00040990: 2020 2066 7020 3d20 6f70 656e 286f 7574     fp = open(out
-000409a0: 7075 742e 7265 706c 6163 6528 272e 6874  put.replace('.ht
-000409b0: 6d6c 272c 2027 2e6a 736f 6e27 292c 2027  ml', '.json'), '
-000409c0: 7727 290a 2020 2020 2020 2020 2020 2020  w').            
-000409d0: 6670 2e77 7269 7465 286a 736f 6e5f 7374  fp.write(json_st
-000409e0: 7229 0a20 2020 2020 2020 2020 2020 2066  r).            f
+0003d7e0: 7365 2c20 7769 7468 5f64 6a61 5f63 7373  se, with_dja_css
+0003d7f0: 3d46 616c 7365 2c20 7469 6d65 7374 616d  =False, timestam
+0003d800: 703d 5472 7565 293a 0a20 2020 2020 2020  p=True):.       
+0003d810: 2022 2222 5772 6170 7065 7220 6172 6f75   """Wrapper arou
+0003d820: 6e64 2060 7e61 7374 726f 7079 2e74 6162  nd `~astropy.tab
+0003d830: 6c65 2e54 6162 6c65 2e77 7269 7465 2866  le.Table.write(f
+0003d840: 6f72 6d61 743d 276a 7376 6965 7765 7227  ormat='jsviewer'
+0003d850: 2960 2e0a 0a20 2020 2020 2020 2050 6172  )`...        Par
+0003d860: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+0003d870: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+0003d880: 2020 206f 7574 7075 7420 3a20 7374 720a     output : str.
+0003d890: 2020 2020 2020 2020 2020 2020 4f75 7470              Outp
+0003d8a0: 7574 2066 696c 656e 616d 652e 0a0a 2020  ut filename...  
+0003d8b0: 2020 2020 2020 7265 706c 6163 655f 6272        replace_br
+0003d8c0: 6163 6573 203a 2062 6f6f 6c0a 2020 2020  aces : bool.    
+0003d8d0: 2020 2020 2020 2020 5265 706c 6163 6520          Replace 
+0003d8e0: 2726 6c74 3b27 2061 6e64 2027 2667 743b  '&lt;' and '&gt;
+0003d8f0: 2720 6368 6172 6163 7465 7273 2074 6861  ' characters tha
+0003d900: 7420 6172 6520 636f 6e76 6572 7465 640a  t are converted.
+0003d910: 2020 2020 2020 2020 2020 2020 6175 746f              auto
+0003d920: 6d61 7469 6361 6c6c 7920 6672 6f6d 2022  matically from "
+0003d930: 3c3e 2220 6279 2074 6865 2060 7e61 7374  <>" by the `~ast
+0003d940: 726f 7079 2e74 6162 6c65 2e54 6162 6c65  ropy.table.Table
+0003d950: 2e77 7269 7465 600a 2020 2020 2020 2020  .write`.        
+0003d960: 2020 2020 6d65 7468 6f64 2e20 5468 6572      method. Ther
+0003d970: 6520 6172 6520 7061 7261 6d65 7465 7273  e are parameters
+0003d980: 2066 6f72 2064 6f69 6e67 2074 6869 7320   for doing this 
+0003d990: 6175 746f 6d61 7469 6361 6c6c 7920 7769  automatically wi
+0003d9a0: 7468 0a20 2020 2020 2020 2020 2020 2060  th.            `
+0003d9b0: 7772 6974 6528 666f 726d 6174 3d27 6874  write(format='ht
+0003d9c0: 6d6c 2729 6020 6275 7420 7468 6174 2064  ml')` but that d
+0003d9d0: 6f6e 2774 2061 7070 6561 7220 746f 2062  on't appear to b
+0003d9e0: 6520 6176 6169 6c61 626c 6520 7769 7468  e available with
+0003d9f0: 0a20 2020 2020 2020 2020 2020 2060 7772  .            `wr
+0003da00: 6974 6528 666f 726d 6174 3d27 6a73 7669  ite(format='jsvi
+0003da10: 6577 6572 2729 602e 0a0a 2020 2020 2020  ewer')`...      
+0003da20: 2020 6c6f 6361 6c68 6f73 7420 3a20 626f    localhost : bo
+0003da30: 6f6c 0a20 2020 2020 2020 2020 2020 2055  ol.            U
+0003da40: 7365 206c 6f63 616c 204a 5320 6669 6c65  se local JS file
+0003da50: 732e 204f 7468 6572 7769 7365 2075 7365  s. Otherwise use
+0003da60: 2066 696c 6573 2068 6f73 7465 6420 6578   files hosted ex
+0003da70: 7465 726e 616c 6c79 2e0a 0a20 2020 2020  ternally...     
+0003da80: 2020 2066 696c 7465 725f 636f 6c75 6d6e     filter_column
+0003da90: 7320 3a20 6c69 7374 0a20 2020 2020 2020  s : list.       
+0003daa0: 2020 2020 2041 6464 206f 7074 696f 6e20       Add option 
+0003dab0: 746f 206c 696d 6974 206d 696e 2f6d 6178  to limit min/max
+0003dac0: 2076 616c 7565 7320 6f66 2063 6f6c 756d   values of colum
+0003dad0: 6e20 6461 7461 0a0a 2020 2020 2020 2020  n data..        
+0003dae0: 6275 7474 6f6e 7320 3a20 6c69 7374 0a20  buttons : list. 
+0003daf0: 2020 2020 2020 2020 2020 2041 6464 2062             Add b
+0003db00: 7574 746f 6e73 2066 6f72 2065 7870 6f72  uttons for expor
+0003db10: 7469 6e67 2064 6174 612e 2020 416c 6c6f  ting data.  Allo
+0003db20: 7765 6420 6f70 7469 6f6e 7320 6172 650a  wed options are.
+0003db30: 2020 2020 2020 2020 2020 2020 2763 6f70              'cop
+0003db40: 7927 2c20 2763 7376 272c 2027 6578 6365  y', 'csv', 'exce
+0003db50: 6c27 2c20 2770 6466 272c 2027 7072 696e  l', 'pdf', 'prin
+0003db60: 7427 2e0a 0a20 2020 2020 2020 2074 6f67  t'...        tog
+0003db70: 676c 6520 3a20 626f 6f6c 0a20 2020 2020  gle : bool.     
+0003db80: 2020 2020 2020 2041 6464 206c 696e 6b73         Add links
+0003db90: 2061 7420 746f 7020 6f66 2070 6167 6520   at top of page 
+0003dba0: 666f 7220 746f 6767 6c69 6e67 2063 6f6c  for toggling col
+0003dbb0: 756d 6e73 206f 6e2f 6f66 660a 0a20 2020  umns on/off..   
+0003dbc0: 2020 2020 2075 7365 5f6a 736f 6e20 3a20       use_json : 
+0003dbd0: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
+0003dbe0: 2057 7269 7465 2074 6865 2064 6174 6120   Write the data 
+0003dbf0: 746f 2061 204a 534f 4e20 6669 6c65 2061  to a JSON file a
+0003dc00: 6e64 2073 7472 6970 206f 7574 206f 6620  nd strip out of 
+0003dc10: 7468 6520 4854 4d4c 2068 6561 6465 722e  the HTML header.
+0003dc20: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+0003dc30: 2074 6869 7320 666f 7220 6c61 7267 6520   this for large 
+0003dc40: 6461 7461 7365 7473 206f 7220 6966 2063  datasets or if c
+0003dc50: 6f6c 756d 6e73 2069 6e63 6c75 6465 2072  olumns include r
+0003dc60: 656e 6465 7265 640a 2020 2020 2020 2020  endered.        
+0003dc70: 2020 2020 696d 6167 6573 2e0a 0a20 2020      images...   
+0003dc80: 2020 2020 2065 7463 203a 202e 2e2e 0a20       etc : .... 
+0003dc90: 2020 2020 2020 2020 2020 2041 6464 6974             Addit
+0003dca0: 696f 6e61 6c20 7061 7261 6d65 7465 7273  ional parameters
+0003dcb0: 2070 6173 7365 6420 7468 726f 7567 6820   passed through 
+0003dcc0: 746f 2060 7772 6974 6560 2e0a 2020 2020  to `write`..    
+0003dcd0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0003dce0: 696d 706f 7274 2074 696d 650a 2020 2020  import time.    
+0003dcf0: 2020 2020 0a20 2020 2020 2020 2023 6672      .        #fr
+0003dd00: 6f6d 2061 7374 726f 7079 2e74 6162 6c65  om astropy.table
+0003dd10: 2e6a 7376 6965 7765 7220 696d 706f 7274  .jsviewer import
+0003dd20: 2044 4546 4155 4c54 5f43 5353 0a20 2020   DEFAULT_CSS.   
+0003dd30: 2020 2020 2044 4546 4155 4c54 5f43 5353       DEFAULT_CSS
+0003dd40: 203d 2022 2222 0a62 6f64 7920 7b66 6f6e   = """.body {fon
+0003dd50: 742d 6661 6d69 6c79 3a20 7361 6e73 2d73  t-family: sans-s
+0003dd60: 6572 6966 3b7d 0a74 6162 6c65 2e64 6174  erif;}.table.dat
+0003dd70: 6154 6162 6c65 207b 7769 6474 683a 2061  aTable {width: a
+0003dd80: 7574 6f20 2169 6d70 6f72 7461 6e74 3b20  uto !important; 
+0003dd90: 6d61 7267 696e 3a20 3020 2169 6d70 6f72  margin: 0 !impor
+0003dda0: 7461 6e74 3b7d 0a2e 6461 7461 5461 626c  tant;}..dataTabl
+0003ddb0: 6573 5f66 696c 7465 722c 202e 6461 7461  es_filter, .data
+0003ddc0: 5461 626c 6573 5f70 6167 696e 6174 6520  Tables_paginate 
+0003ddd0: 7b66 6c6f 6174 3a20 6c65 6674 2021 696d  {float: left !im
+0003dde0: 706f 7274 616e 743b 206d 6172 6769 6e2d  portant; margin-
+0003ddf0: 6c65 6674 3a31 656d 7d0a 7464 207b 666f  left:1em}.td {fo
+0003de00: 6e74 2d73 697a 653a 2031 3070 743b 7d0a  nt-size: 10pt;}.
+0003de10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003de20: 2020 2020 6966 2063 7373 2069 7320 6e6f      if css is no
+0003de30: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0003de40: 2020 2020 4445 4641 554c 545f 4353 5320      DEFAULT_CSS 
+0003de50: 2b3d 2063 7373 0a20 2020 2020 2020 200a  += css.        .
+0003de60: 2020 2020 2020 2020 6966 2077 6974 685f          if with_
+0003de70: 646a 615f 6373 733a 0a20 2020 2020 2020  dja_css:.       
+0003de80: 2020 2020 2044 4546 4155 4c54 5f43 5353       DEFAULT_CSS
+0003de90: 202b 3d20 2222 220a 7365 6c65 6374 207b   += """.select {
+0003dea0: 6469 7370 6c61 793a 2069 6e6c 696e 653b  display: inline;
+0003deb0: 2077 6964 7468 3a31 3030 7078 3b7d 0a69   width:100px;}.i
+0003dec0: 6e70 7574 5b74 7970 653d 2273 6561 7263  nput[type="searc
+0003ded0: 6822 5d20 7b64 6973 706c 6179 3a20 696e  h"] {display: in
+0003dee0: 6c69 6e65 3b20 7769 6474 683a 3430 3070  line; width:400p
+0003def0: 783b 7d0a 2020 2020 2020 2020 2222 220a  x;}.        """.
+0003df00: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0003df10: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+0003df20: 7473 286f 7574 7075 7429 3a0a 2020 2020  ts(output):.    
+0003df30: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+0003df40: 6528 6f75 7470 7574 290a 0a20 2020 2020  e(output)..     
+0003df50: 2020 2073 656c 662e 7772 6974 6528 6f75     self.write(ou
+0003df60: 7470 7574 2c20 666f 726d 6174 3d27 6a73  tput, format='js
+0003df70: 7669 6577 6572 272c 2063 7373 3d44 4546  viewer', css=DEF
+0003df80: 4155 4c54 5f43 5353 2c0a 2020 2020 2020  AULT_CSS,.      
+0003df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dfa0: 2020 2020 2020 6d61 785f 6c69 6e65 733d        max_lines=
+0003dfb0: 6d61 785f 6c69 6e65 732c 0a20 2020 2020  max_lines,.     
+0003dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dfd0: 2020 2020 2020 206a 736b 7761 7267 733d         jskwargs=
+0003dfe0: 7b27 7573 655f 6c6f 6361 6c5f 6669 6c65  {'use_local_file
+0003dff0: 7327 3a20 6c6f 6361 6c68 6f73 747d 2c0a  s': localhost},.
+0003e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e010: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+0003e020: 655f 6964 3d4e 6f6e 652c 2074 6162 6c65  e_id=None, table
+0003e030: 5f63 6c61 7373 3d74 6162 6c65 5f63 6c61  _class=table_cla
+0003e040: 7373 290a 0a20 2020 2020 2020 2069 6620  ss)..        if 
+0003e050: 7265 706c 6163 655f 6272 6163 6573 3a0a  replace_braces:.
+0003e060: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0003e070: 7320 3d20 6f70 656e 286f 7574 7075 7429  s = open(output)
+0003e080: 2e72 6561 646c 696e 6573 2829 0a20 2020  .readlines().   
+0003e090: 2020 2020 2020 2020 2069 6620 7265 706c           if repl
+0003e0a0: 6163 655f 6272 6163 6573 3a0a 2020 2020  ace_braces:.    
+0003e0b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003e0c0: 6920 696e 2072 616e 6765 286c 656e 286c  i in range(len(l
+0003e0d0: 696e 6573 2929 3a0a 2020 2020 2020 2020  ines)):.        
+0003e0e0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0003e0f0: 735b 695d 203d 206c 696e 6573 5b69 5d2e  s[i] = lines[i].
+0003e100: 7265 706c 6163 6528 2726 6c74 3b27 2c20  replace('&lt;', 
+0003e110: 273c 2729 0a20 2020 2020 2020 2020 2020  '<').           
+0003e120: 2020 2020 2020 2020 206c 696e 6573 5b69           lines[i
+0003e130: 5d20 3d20 6c69 6e65 735b 695d 2e72 6570  ] = lines[i].rep
+0003e140: 6c61 6365 2827 2667 743b 272c 2027 3e27  lace('&gt;', '>'
+0003e150: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0003e160: 7020 3d20 6f70 656e 286f 7574 7075 742c  p = open(output,
+0003e170: 2027 7727 290a 2020 2020 2020 2020 2020   'w').          
+0003e180: 2020 6670 2e77 7269 7465 6c69 6e65 7328    fp.writelines(
+0003e190: 6c69 6e65 7329 0a20 2020 2020 2020 2020  lines).         
+0003e1a0: 2020 2066 702e 636c 6f73 6528 290a 0a20     fp.close().. 
+0003e1b0: 2020 2020 2020 2023 2052 6561 6420 616c         # Read al
+0003e1c0: 6c20 6c69 6e65 730a 2020 2020 2020 2020  l lines.        
+0003e1d0: 6c69 6e65 7320 3d20 6f70 656e 286f 7574  lines = open(out
+0003e1e0: 7075 7429 2e72 6561 646c 696e 6573 2829  put).readlines()
+0003e1f0: 0a0a 2020 2020 2020 2020 6966 2077 6974  ..        if wit
+0003e200: 685f 646a 615f 6373 733a 0a20 2020 2020  h_dja_css:.     
+0003e210: 2020 2020 2020 2066 6f72 2069 2c20 6c69         for i, li
+0003e220: 6e65 2069 6e20 656e 756d 6572 6174 6528  ne in enumerate(
+0003e230: 6c69 6e65 7329 3a0a 2020 2020 2020 2020  lines):.        
+0003e240: 2020 2020 2020 2020 6966 2027 3c73 7479          if '<sty
+0003e250: 6c65 3e27 2069 6e20 6c69 6e65 3a0a 2020  le>' in line:.  
+0003e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e270: 2020 6c69 6e65 732e 696e 7365 7274 2869    lines.insert(i
+0003e280: 2c20 2222 220a 2020 2020 3c6c 696e 6b20  , """.    <link 
+0003e290: 7265 6c3d 2273 7479 6c65 7368 6565 7422  rel="stylesheet"
+0003e2a0: 2068 7265 663d 2268 7474 7073 3a2f 2f64   href="https://d
+0003e2b0: 6177 6e2d 6370 682e 6769 7468 7562 2e69  awn-cph.github.i
+0003e2c0: 6f2f 646a 612f 6173 7365 7473 2f63 7373  o/dja/assets/css
+0003e2d0: 2f6d 6169 6e2e 6373 7322 202f 3e0a 2020  /main.css" />.  
+0003e2e0: 2020 2020 2020 2222 2229 0a20 2020 2020        """).     
+0003e2f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0003e300: 7265 616b 0a0a 2020 2020 2020 2020 6966  reak..        if
+0003e310: 2027 616c 6164 696e 2720 696e 2073 656c   'aladin' in sel
+0003e320: 662e 636f 6c6e 616d 6573 3a0a 2020 2020  f.colnames:.    
+0003e330: 2020 2020 2020 2020 2320 496e 7365 7274          # Insert
+0003e340: 2041 6c61 6469 6e20 4353 530a 2020 2020   Aladin CSS.    
+0003e350: 2020 2020 2020 2020 616c 6164 696e 5f63          aladin_c
+0003e360: 7373 203d 2027 3c6c 696e 6b20 7265 6c3d  ss = '<link rel=
+0003e370: 2273 7479 6c65 7368 6565 7422 2068 7265  "stylesheet" hre
+0003e380: 663d 2268 7474 7073 3a2f 2f61 6c61 6469  f="https://aladi
+0003e390: 6e2e 752d 7374 7261 7362 672e 6672 2f41  n.u-strasbg.fr/A
+0003e3a0: 6c61 6469 6e4c 6974 652f 6170 692f 7632  ladinLite/api/v2
+0003e3b0: 2f6c 6174 6573 742f 616c 6164 696e 2e6d  /latest/aladin.m
+0003e3c0: 696e 2e63 7373 2220 2f3e 5c6e 270a 0a20  in.css" />\n'.. 
+0003e3d0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0003e3e0: 6c2c 206c 696e 6520 696e 2065 6e75 6d65  l, line in enume
+0003e3f0: 7261 7465 286c 696e 6573 293a 0a20 2020  rate(lines):.   
+0003e400: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003e410: 273c 6c69 6e6b 2068 7265 663d 2720 696e  '<link href=' in
+0003e420: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
+0003e430: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0003e440: 0a0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
+0003e450: 6e65 732e 696e 7365 7274 2869 6c2b 312c  nes.insert(il+1,
+0003e460: 2061 6c61 6469 6e5f 6373 7329 0a20 2020   aladin_css).   
+0003e470: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
+0003e480: 4578 706f 7274 2062 7574 746f 6e73 0a20  Export buttons. 
+0003e490: 2020 2020 2020 2069 6620 6275 7474 6f6e         if button
+0003e4a0: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
+0003e4b0: 2043 5353 0a20 2020 2020 2020 2020 2020   CSS.           
+0003e4c0: 2063 7373 5f73 6372 6970 7420 3d20 273c   css_script = '<
+0003e4d0: 6c69 6e6b 2072 656c 3d22 7374 796c 6573  link rel="styles
+0003e4e0: 6865 6574 2220 7479 7065 3d22 7465 7874  heet" type="text
+0003e4f0: 2f63 7373 2220 6872 6566 3d22 6874 7470  /css" href="http
+0003e500: 733a 2f2f 6364 6e2e 6461 7461 7461 626c  s://cdn.datatabl
+0003e510: 6573 2e6e 6574 2f62 7574 746f 6e73 2f31  es.net/buttons/1
+0003e520: 2e35 2e31 2f63 7373 2f62 7574 746f 6e73  .5.1/css/buttons
+0003e530: 2e64 6174 6154 6162 6c65 732e 6d69 6e2e  .dataTables.min.
+0003e540: 6373 7322 3e5c 6e27 0a20 2020 2020 2020  css">\n'.       
+0003e550: 2020 2020 2066 6f72 2069 6c2c 206c 696e       for il, lin
+0003e560: 6520 696e 2065 6e75 6d65 7261 7465 286c  e in enumerate(l
+0003e570: 696e 6573 293a 0a20 2020 2020 2020 2020  ines):.         
+0003e580: 2020 2020 2020 2069 6620 2763 7373 2f6a         if 'css/j
+0003e590: 7175 6572 792e 6461 7461 5461 626c 6527  query.dataTable'
+0003e5a0: 2069 6e20 6c69 6e65 3a0a 2020 2020 2020   in line:.      
+0003e5b0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0003e5c0: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
+0003e5d0: 206c 696e 6573 2e69 6e73 6572 7428 696c   lines.insert(il
+0003e5e0: 2b31 2c20 6373 735f 7363 7269 7074 290a  +1, css_script).
+0003e5f0: 0a20 2020 2020 2020 2020 2020 2023 204a  .            # J
+0003e600: 5320 6c69 6272 6172 6965 730a 2020 2020  S libraries.    
+0003e610: 2020 2020 2020 2020 6a73 5f73 6372 6970          js_scrip
+0003e620: 7473 203d 2022 2222 0a20 2020 2020 2020  ts = """.       
+0003e630: 2020 2020 203c 7363 7269 7074 2074 7970       <script typ
+0003e640: 653d 2274 6578 742f 6a61 7661 7363 7269  e="text/javascri
+0003e650: 7074 2220 6c61 6e67 7561 6765 3d22 6a61  pt" language="ja
+0003e660: 7661 7363 7269 7074 2220 7372 633d 2268  vascript" src="h
+0003e670: 7474 7073 3a2f 2f63 646e 2e64 6174 6174  ttps://cdn.datat
+0003e680: 6162 6c65 732e 6e65 742f 6275 7474 6f6e  ables.net/button
+0003e690: 732f 312e 352e 312f 6a73 2f64 6174 6154  s/1.5.1/js/dataT
+0003e6a0: 6162 6c65 732e 6275 7474 6f6e 732e 6d69  ables.buttons.mi
+0003e6b0: 6e2e 6a73 223e 3c2f 7363 7269 7074 3e0a  n.js"></script>.
+0003e6c0: 2020 2020 2020 2020 2020 2020 3c73 6372              <scr
+0003e6d0: 6970 7420 7479 7065 3d22 7465 7874 2f6a  ipt type="text/j
+0003e6e0: 6176 6173 6372 6970 7422 206c 616e 6775  avascript" langu
+0003e6f0: 6167 653d 226a 6176 6173 6372 6970 7422  age="javascript"
+0003e700: 2073 7263 3d22 6874 7470 733a 2f2f 6364   src="https://cd
+0003e710: 6e2e 6461 7461 7461 626c 6573 2e6e 6574  n.datatables.net
+0003e720: 2f62 7574 746f 6e73 2f31 2e35 2e31 2f6a  /buttons/1.5.1/j
+0003e730: 732f 6275 7474 6f6e 732e 666c 6173 682e  s/buttons.flash.
+0003e740: 6d69 6e2e 6a73 223e 3c2f 7363 7269 7074  min.js"></script
+0003e750: 3e0a 2020 2020 2020 2020 2020 2020 3c73  >.            <s
+0003e760: 6372 6970 7420 7479 7065 3d22 7465 7874  cript type="text
+0003e770: 2f6a 6176 6173 6372 6970 7422 206c 616e  /javascript" lan
+0003e780: 6775 6167 653d 226a 6176 6173 6372 6970  guage="javascrip
+0003e790: 7422 2073 7263 3d22 6874 7470 733a 2f2f  t" src="https://
+0003e7a0: 6364 6e6a 732e 636c 6f75 6466 6c61 7265  cdnjs.cloudflare
+0003e7b0: 2e63 6f6d 2f61 6a61 782f 6c69 6273 2f6a  .com/ajax/libs/j
+0003e7c0: 737a 6970 2f33 2e31 2e33 2f6a 737a 6970  szip/3.1.3/jszip
+0003e7d0: 2e6d 696e 2e6a 7322 3e3c 2f73 6372 6970  .min.js"></scrip
+0003e7e0: 743e 0a20 2020 2020 2020 2020 2020 203c  t>.            <
+0003e7f0: 7363 7269 7074 2074 7970 653d 2274 6578  script type="tex
+0003e800: 742f 6a61 7661 7363 7269 7074 2220 6c61  t/javascript" la
+0003e810: 6e67 7561 6765 3d22 6a61 7661 7363 7269  nguage="javascri
+0003e820: 7074 2220 7372 633d 2268 7474 7073 3a2f  pt" src="https:/
+0003e830: 2f63 646e 6a73 2e63 6c6f 7564 666c 6172  /cdnjs.cloudflar
+0003e840: 652e 636f 6d2f 616a 6178 2f6c 6962 732f  e.com/ajax/libs/
+0003e850: 7064 666d 616b 652f 302e 312e 3332 2f70  pdfmake/0.1.32/p
+0003e860: 6466 6d61 6b65 2e6d 696e 2e6a 7322 3e3c  dfmake.min.js"><
+0003e870: 2f73 6372 6970 743e 0a20 2020 2020 2020  /script>.       
+0003e880: 2020 2020 203c 7363 7269 7074 2074 7970       <script typ
+0003e890: 653d 2274 6578 742f 6a61 7661 7363 7269  e="text/javascri
+0003e8a0: 7074 2220 6c61 6e67 7561 6765 3d22 6a61  pt" language="ja
+0003e8b0: 7661 7363 7269 7074 2220 7372 633d 2268  vascript" src="h
+0003e8c0: 7474 7073 3a2f 2f63 646e 6a73 2e63 6c6f  ttps://cdnjs.clo
+0003e8d0: 7564 666c 6172 652e 636f 6d2f 616a 6178  udflare.com/ajax
+0003e8e0: 2f6c 6962 732f 7064 666d 616b 652f 302e  /libs/pdfmake/0.
+0003e8f0: 312e 3332 2f76 6673 5f66 6f6e 7473 2e6a  1.32/vfs_fonts.j
+0003e900: 7322 3e3c 2f73 6372 6970 743e 0a20 2020  s"></script>.   
+0003e910: 2020 2020 2020 2020 203c 7363 7269 7074           <script
+0003e920: 2074 7970 653d 2274 6578 742f 6a61 7661   type="text/java
+0003e930: 7363 7269 7074 2220 6c61 6e67 7561 6765  script" language
+0003e940: 3d22 6a61 7661 7363 7269 7074 2220 7372  ="javascript" sr
+0003e950: 633d 2268 7474 7073 3a2f 2f63 646e 2e64  c="https://cdn.d
+0003e960: 6174 6174 6162 6c65 732e 6e65 742f 6275  atatables.net/bu
+0003e970: 7474 6f6e 732f 312e 352e 312f 6a73 2f62  ttons/1.5.1/js/b
+0003e980: 7574 746f 6e73 2e68 746d 6c35 2e6d 696e  uttons.html5.min
+0003e990: 2e6a 7322 3e3c 2f73 6372 6970 743e 0a20  .js"></script>. 
+0003e9a0: 2020 2020 2020 2020 2020 203c 7363 7269             <scri
+0003e9b0: 7074 2074 7970 653d 2274 6578 742f 6a61  pt type="text/ja
+0003e9c0: 7661 7363 7269 7074 2220 6c61 6e67 7561  vascript" langua
+0003e9d0: 6765 3d22 6a61 7661 7363 7269 7074 2220  ge="javascript" 
+0003e9e0: 7372 633d 2268 7474 7073 3a2f 2f63 646e  src="https://cdn
+0003e9f0: 2e64 6174 6174 6162 6c65 732e 6e65 742f  .datatables.net/
+0003ea00: 6275 7474 6f6e 732f 312e 352e 312f 6a73  buttons/1.5.1/js
+0003ea10: 2f62 7574 746f 6e73 2e70 7269 6e74 2e6d  /buttons.print.m
+0003ea20: 696e 2e6a 7322 3e3c 2f73 6372 6970 743e  in.js"></script>
+0003ea30: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+0003ea40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ea50: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0003ea60: 2020 2020 2020 666f 7220 696c 2c20 6c69        for il, li
+0003ea70: 6e65 2069 6e20 656e 756d 6572 6174 6528  ne in enumerate(
+0003ea80: 6c69 6e65 7329 3a0a 2020 2020 2020 2020  lines):.        
+0003ea90: 2020 2020 2020 2020 6966 2027 6a73 2f6a          if 'js/j
+0003eaa0: 7175 6572 792e 6461 7461 5461 626c 6527  query.dataTable'
+0003eab0: 2069 6e20 6c69 6e65 3a0a 2020 2020 2020   in line:.      
+0003eac0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0003ead0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0003eae0: 6c69 6e65 732e 696e 7365 7274 2869 6c2b  lines.insert(il+
+0003eaf0: 322c 206a 735f 7363 7269 7074 7329 0a0a  2, js_scripts)..
+0003eb00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0003eb10: 696c 2c20 6c69 6e65 2069 6e20 656e 756d  il, line in enum
+0003eb20: 6572 6174 6528 6c69 6e65 7329 3a0a 2020  erate(lines):.  
+0003eb30: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003eb40: 2027 7061 6765 4c65 6e67 7468 2720 696e   'pageLength' in
+0003eb50: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
+0003eb60: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0003eb70: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+0003eb80: 2020 2020 2020 2020 2020 6275 7474 6f6e            button
+0003eb90: 5f73 7472 203d 2027 7b73 7061 6365 727d  _str = '{spacer}
+0003eba0: 646f 6d3a 205c 2742 6c66 7274 6970 5c27  dom: \'Blfrtip\'
+0003ebb0: 2c5c 6e7b 7370 6163 6572 7d62 7574 746f  ,\n{spacer}butto
+0003ebc0: 6e73 3a20 7b62 7374 727d 2c5c 6e27 0a20  ns: {bstr},\n'. 
+0003ebd0: 2020 2020 2020 2020 2020 2062 7574 746f             butto
+0003ebe0: 6e5f 6f70 7469 6f6e 203d 2062 7574 746f  n_option = butto
+0003ebf0: 6e5f 7374 722e 666f 726d 6174 2873 7061  n_str.format(spa
+0003ec00: 6365 723d 2720 272a 382c 2062 7374 723d  cer=' '*8, bstr=
+0003ec10: 6275 7474 6f6e 732e 5f5f 7265 7072 5f5f  buttons.__repr__
+0003ec20: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+0003ec30: 6c69 6e65 732e 696e 7365 7274 2869 6c2b  lines.insert(il+
+0003ec40: 312c 2062 7574 746f 6e5f 6f70 7469 6f6e  1, button_option
+0003ec50: 290a 0a20 2020 2020 2020 2023 2052 616e  )..        # Ran
+0003ec60: 6765 2063 6f6c 756d 6e73 0a20 2020 2020  ge columns.     
+0003ec70: 2020 2069 635f 6c69 7374 203d 205b 5d0a     ic_list = [].
+0003ec80: 0a20 2020 2020 2020 2066 696c 7465 725f  .        filter_
+0003ec90: 6c69 6e65 7320 3d20 5b22 3c74 6162 6c65  lines = ["<table
+0003eca0: 3e5c 6e22 5d0a 2020 2020 2020 2020 6465  >\n"].        de
+0003ecb0: 7363 725f 7061 6420 3d20 2720 3c73 7061  scr_pad = ' <spa
+0003ecc0: 6e20 7374 796c 653d 2264 6973 706c 6179  n style="display
+0003ecd0: 3a69 6e6c 696e 652d 626c 6f63 6b3b 2077  :inline-block; w
+0003ece0: 6964 7468 3a31 303b 223e 3c2f 7370 616e  idth:10;"></span
+0003ecf0: 3e20 270a 0a20 2020 2020 2020 2066 696c  > '..        fil
+0003ed00: 7465 725f 696e 7075 7420 3d20 2222 220a  ter_input = """.
+0003ed10: 2020 2020 3c74 723e 0a20 2020 2020 2020      <tr>.       
+0003ed20: 203c 7464 2073 7479 6c65 3d22 7769 6474   <td style="widt
+0003ed30: 683a 3130 3070 7822 3e0a 2020 2020 2020  h:100px">.      
+0003ed40: 2020 2020 2020 3c69 6e70 7574 2074 7970        <input typ
+0003ed50: 653d 2274 6578 7422 2069 643d 227b 307d  e="text" id="{0}
+0003ed60: 5f6d 696e 2220 6e61 6d65 3d22 7b30 7d5f  _min" name="{0}_
+0003ed70: 6d69 6e22 2020 0a20 2020 2020 2020 2020  min"  .         
+0003ed80: 2020 2020 2020 2020 2020 7374 796c 653d            style=
+0003ed90: 2277 6964 7468 3a36 3070 783b 6469 7370  "width:60px;disp
+0003eda0: 6c61 793a 696e 6c69 6e65 223e 2026 2336  lay:inline"> &#6
+0003edb0: 303b 0a20 2020 2020 2020 203c 2f74 643e  0;.        </td>
+0003edc0: 200a 2020 2020 2020 2020 3c74 6420 7374   .        <td st
+0003edd0: 796c 653d 2277 6964 7468 3a31 3030 7078  yle="width:100px
+0003ede0: 223e 207b 307d 203c 2f74 643e 200a 2020  "> {0} </td> .  
+0003edf0: 2020 2020 2020 3c74 643e 2020 2623 3630        <td>  &#60
+0003ee00: 3b20 3c69 6e70 7574 2074 7970 653d 2274  ; <input type="t
+0003ee10: 6578 7422 2069 643d 227b 307d 5f6d 6178  ext" id="{0}_max
+0003ee20: 2220 6e61 6d65 3d22 7b30 7d5f 6d61 7822  " name="{0}_max"
+0003ee30: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0003ee40: 2020 2020 2020 7374 796c 653d 2277 6964        style="wid
+0003ee50: 7468 3a36 3070 783b 6469 7370 6c61 793a  th:60px;display:
+0003ee60: 696e 6c69 6e65 223e 0a20 2020 203c 2f74  inline">.    </t
+0003ee70: 723e 2222 220a 2020 2020 2020 2020 0a20  r>""".        . 
+0003ee80: 2020 2020 2020 2066 6f72 2069 632c 2063         for ic, c
+0003ee90: 6f6c 2069 6e20 656e 756d 6572 6174 6528  ol in enumerate(
+0003eea0: 7365 6c66 2e63 6f6c 6e61 6d65 7329 3a0a  self.colnames):.
+0003eeb0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0003eec0: 6f6c 2069 6e20 6669 6c74 6572 5f63 6f6c  ol in filter_col
+0003eed0: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
+0003eee0: 2020 2020 2020 666f 756e 6420 3d20 4661        found = Fa
+0003eef0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0003ef00: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0003ef10: 6765 286c 656e 286c 696e 6573 2929 3a0a  ge(len(lines)):.
+0003ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ef30: 2020 2020 6966 2027 3c74 683e 7b30 7d27      if '<th>{0}'
+0003ef40: 2e66 6f72 6d61 7428 636f 6c29 2069 6e20  .format(col) in 
+0003ef50: 6c69 6e65 735b 695d 3a0a 2020 2020 2020  lines[i]:.      
+0003ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ef70: 2020 666f 756e 6420 3d20 5472 7565 0a20    found = True. 
+0003ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ef90: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
+0003efa0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003efb0: 2066 6f75 6e64 3a0a 2020 2020 2020 2020   found:.        
+0003efc0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+0003efd0: 696e 7428 636f 6c29 0a20 2020 2020 2020  int(col).       
+0003efe0: 2020 2020 2020 2020 2020 2020 2069 635f               ic_
+0003eff0: 6c69 7374 2e61 7070 656e 6428 6963 290a  list.append(ic).
+0003f000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f010: 2020 2020 2066 696c 7465 725f 6c69 6e65       filter_line
+0003f020: 7320 2b3d 2066 696c 7465 725f 696e 7075  s += filter_inpu
+0003f030: 742e 666f 726d 6174 2863 6f6c 290a 2020  t.format(col).  
+0003f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f050: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0003f060: 2020 2020 2020 2064 6573 6372 203d 2027         descr = '
+0003f070: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0003f080: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+0003f090: 7472 2873 656c 662e 636f 6c75 6d6e 735b  tr(self.columns[
+0003f0a0: 636f 6c5d 2c20 2764 6573 6372 6970 7469  col], 'descripti
+0003f0b0: 6f6e 2729 3a0a 2020 2020 2020 2020 2020  on'):.          
+0003f0c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003f0d0: 2073 656c 662e 636f 6c75 6d6e 735b 636f   self.columns[co
+0003f0e0: 6c5d 2e64 6573 6372 6970 7469 6f6e 2069  l].description i
+0003f0f0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0003f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f110: 2020 2020 2020 2020 6465 7363 7220 3d20          descr = 
+0003f120: 277b 307d 207b 317d 5c6e 272e 666f 726d  '{0} {1}\n'.form
+0003f130: 6174 2864 6573 6372 5f70 6164 2c20 0a20  at(descr_pad, . 
+0003f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f160: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003f170: 636f 6c75 6d6e 735b 636f 6c5d 2e64 6573  columns[col].des
+0003f180: 6372 6970 7469 6f6e 290a 2020 2020 2020  cription).      
+0003f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f1c0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0003f1d0: 2020 2020 2020 2066 696c 7465 725f 6c69         filter_li
+0003f1e0: 6e65 7320 2b3d 2064 6573 6372 0a20 2020  nes += descr.   
+0003f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f200: 200a 2020 2020 2020 2020 6966 2069 635f   .        if ic_
+0003f210: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
+0003f220: 2020 2320 496e 7365 7274 2069 6e70 7574    # Insert input
+0003f230: 206c 696e 6573 0a0a 2020 2020 2020 2020   lines..        
+0003f240: 2020 2020 666f 7220 696c 2c20 6c69 6e65      for il, line
+0003f250: 2069 6e20 656e 756d 6572 6174 6528 6c69   in enumerate(li
+0003f260: 6e65 7329 3a0a 2020 2020 2020 2020 2020  nes):.          
+0003f270: 2020 2020 2020 6966 2027 7d20 293b 2020        if '} );  
+0003f280: 3c2f 7363 7269 7074 3e27 2069 6e20 6c69  </script>' in li
+0003f290: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0003f2a0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0003f2b0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0003f2c0: 2020 2020 2020 2023 2066 696c 7465 725f         # filter_
+0003f2d0: 726f 7720 3d20 273c 7472 3e20 3c74 643e  row = '<tr> <td>
+0003f2e0: 203c 696e 7075 7420 7479 7065 3d22 7465   <input type="te
+0003f2f0: 7874 2220 6964 3d22 7b30 7d5f 6d69 6e22  xt" id="{0}_min"
+0003f300: 206e 616d 653d 227b 307d 5f6d 696e 2220   name="{0}_min" 
+0003f310: 7374 796c 653d 2277 6964 7468 3a34 3070  style="width:40p
+0003f320: 783b 223e 2026 2336 303b 203c 2f74 643e  x;"> &#60; </td>
+0003f330: 203c 7464 2073 7479 6c65 3d22 616c 6967   <td style="alig
+0003f340: 6e3a 6365 6e74 6572 3b22 3e20 3c74 743e  n:center;"> <tt>
+0003f350: 7b30 7d3c 2f74 743e 203c 2f74 643e 203c  {0}</tt> </td> <
+0003f360: 7464 3e20 2026 2336 303b 203c 696e 7075  td>  &#60; <inpu
+0003f370: 7420 7479 7065 3d22 7465 7874 2220 6964  t type="text" id
+0003f380: 3d22 7b30 7d5f 6d61 7822 206e 616d 653d  ="{0}_max" name=
+0003f390: 227b 307d 5f6d 6178 2220 7374 796c 653d  "{0}_max" style=
+0003f3a0: 2277 6964 7468 3a34 3070 783b 223e 270a  "width:40px;">'.
+0003f3b0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0003f3c0: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+0003f3d0: 726f 7773 203d 205b 5d0a 2020 2020 2020  rows = [].      
+0003f3e0: 2020 2020 2020 666f 7220 6963 2069 6e20        for ic in 
+0003f3f0: 6963 5f6c 6973 743a 0a20 2020 2020 2020  ic_list:.       
+0003f400: 2020 2020 2020 2020 2063 6f6c 203d 2073           col = s
+0003f410: 656c 662e 636f 6c6e 616d 6573 5b69 635d  elf.colnames[ic]
+0003f420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f430: 2072 6f77 5f69 203d 2066 696c 7465 725f   row_i = filter_
+0003f440: 696e 7075 742e 666f 726d 6174 2863 6f6c  input.format(col
+0003f450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003f460: 2020 6465 7363 7220 3d20 275c 6e27 0a20    descr = '\n'. 
+0003f470: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003f480: 6620 6861 7361 7474 7228 7365 6c66 2e63  f hasattr(self.c
+0003f490: 6f6c 756d 6e73 5b63 6f6c 5d2c 2027 6465  olumns[col], 'de
+0003f4a0: 7363 7269 7074 696f 6e27 293a 0a20 2020  scription'):.   
+0003f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f4c0: 2069 6620 7365 6c66 2e63 6f6c 756d 6e73   if self.columns
+0003f4d0: 5b63 6f6c 5d2e 6465 7363 7269 7074 696f  [col].descriptio
+0003f4e0: 6e20 6973 206e 6f74 204e 6f6e 653a 0a20  n is not None:. 
+0003f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f500: 2020 2020 2020 2064 6573 6372 203d 2027         descr = '
+0003f510: 7b30 7d20 7b31 7d5c 6e27 2e66 6f72 6d61  {0} {1}\n'.forma
+0003f520: 7428 6465 7363 725f 7061 642c 200a 2020  t(descr_pad, .  
+0003f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f550: 2020 2020 2020 7365 6c66 2e63 6f6c 756d        self.colum
+0003f560: 6e73 5b63 6f6c 5d2e 6465 7363 7269 7074  ns[col].descript
+0003f570: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
+0003f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f5a0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0003f5b0: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+0003f5c0: 5f72 6f77 732e 6170 7065 6e64 2872 6f77  _rows.append(row
+0003f5d0: 5f69 202b 2064 6573 6372 290a 2020 2020  _i + descr).    
+0003f5e0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0003f5f0: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
+0003f600: 696e 7075 7420 3d20 2222 220a 0a3c 6469  input = """..<di
+0003f610: 7620 7374 796c 653d 2262 6f72 6465 723a  v style="border:
+0003f620: 3170 7820 736f 6c69 6420 626c 6163 6b3b  1px solid black;
+0003f630: 2070 6164 6469 6e67 3a31 3070 783b 206d   padding:10px; m
+0003f640: 6172 6769 6e3a 3130 7078 223e 0a3c 623e  argin:10px">.<b>
+0003f650: 2046 696c 7465 723a 203c 2f62 3e0a 2020   Filter: </b>.  
+0003f660: 2020 3c74 6162 6c65 3e0a 2020 2020 2020    <table>.      
+0003f670: 7b30 7d0a 2020 2020 3c2f 7461 626c 653e  {0}.    </table>
+0003f680: 0a3c 2f64 6976 3e0a 0a22 2222 2e66 6f72  .</div>..""".for
+0003f690: 6d61 7428 275c 6e27 2e6a 6f69 6e28 6669  mat('\n'.join(fi
+0003f6a0: 6c74 6572 5f72 6f77 7329 290a 0a20 2020  lter_rows))..   
+0003f6b0: 2020 2020 2020 2020 206c 696e 6573 2e69           lines.i
+0003f6c0: 6e73 6572 7428 696c 2b31 2c20 6669 6c74  nsert(il+1, filt
+0003f6d0: 6572 5f69 6e70 7574 290a 0a20 2020 2020  er_input)..     
+0003f6e0: 2020 2020 2020 2023 204a 6176 6173 6372         # Javascr
+0003f6f0: 6970 7420 7075 7368 2066 756e 6374 696f  ipt push functio
+0003f700: 6e0a 2020 2020 2020 2020 2020 2020 6865  n.            he
+0003f710: 6164 6572 5f6c 696e 6573 203d 2022 220a  ader_lines = "".
+0003f720: 2020 2020 2020 2020 2020 2020 7465 7374              test
+0003f730: 6572 203d 205b 5d0a 0a20 2020 2020 2020  er = []..       
+0003f740: 2020 2020 2066 6f72 2069 6320 696e 2069       for ic in i
+0003f750: 635f 6c69 7374 3a0a 2020 2020 2020 2020  c_list:.        
+0003f760: 2020 2020 2020 2020 6865 6164 6572 5f6c          header_l
+0003f770: 696e 6573 202b 3d20 2222 220a 2020 2020  ines += """.    
+0003f780: 2020 2020 7661 7220 6d69 6e5f 7b30 7d20      var min_{0} 
+0003f790: 3d20 7061 7273 6546 6c6f 6174 2820 2428  = parseFloat( $(
+0003f7a0: 2723 7b30 7d5f 6d69 6e27 292e 7661 6c28  '#{0}_min').val(
+0003f7b0: 2929 207c 7c20 2d31 6533 303b 0a20 2020  )) || -1e30;.   
+0003f7c0: 2020 2020 2076 6172 206d 6178 5f7b 307d       var max_{0}
+0003f7d0: 203d 2070 6172 7365 466c 6f61 7428 2024   = parseFloat( $
+0003f7e0: 2827 237b 307d 5f6d 6178 2729 2e76 616c  ('#{0}_max').val
+0003f7f0: 2829 2920 7c7c 2020 3165 3330 3b0a 2020  ()) ||  1e30;.  
+0003f800: 2020 2020 2020 7661 7220 6461 7461 5f7b        var data_{
+0003f810: 307d 203d 2070 6172 7365 466c 6f61 7428  0} = parseFloat(
+0003f820: 2064 6174 615b 7b31 7d5d 2029 207c 7c20   data[{1}] ) || 
+0003f830: 303b 0a20 2020 2020 2020 2020 2020 2020  0;.             
+0003f840: 2020 2022 2222 2e66 6f72 6d61 7428 7365     """.format(se
+0003f850: 6c66 2e63 6f6c 6e61 6d65 735b 6963 5d2c  lf.colnames[ic],
+0003f860: 2069 6329 0a0a 2020 2020 2020 2020 2020   ic)..          
+0003f870: 2020 2020 2020 7465 7374 6572 2e61 7070        tester.app
+0003f880: 656e 6428 2222 2228 2028 2069 734e 614e  end("""( ( isNaN
+0003f890: 2820 6d69 6e5f 7b30 7d20 2920 2626 2069  ( min_{0} ) && i
+0003f8a0: 734e 614e 2820 6d61 785f 7b30 7d20 2920  sNaN( max_{0} ) 
+0003f8b0: 2920 7c7c 2028 2069 734e 614e 2820 6d69  ) || ( isNaN( mi
+0003f8c0: 6e5f 7b30 7d20 2920 2626 2064 6174 615f  n_{0} ) && data_
+0003f8d0: 7b30 7d20 3c3d 206d 6178 5f7b 307d 2029  {0} <= max_{0} )
+0003f8e0: 207c 7c20 2820 6d69 6e5f 7b30 7d20 3c3d   || ( min_{0} <=
+0003f8f0: 2064 6174 615f 7b30 7d20 2026 2620 6973   data_{0}  && is
+0003f900: 4e61 4e28 206d 6178 5f7b 307d 2029 2029  NaN( max_{0} ) )
+0003f910: 207c 7c20 2820 6d69 6e5f 7b30 7d20 3c3d   || ( min_{0} <=
+0003f920: 2064 6174 615f 7b30 7d20 2026 2620 6461   data_{0}  && da
+0003f930: 7461 5f7b 307d 203c 3d20 6d61 785f 7b30  ta_{0} <= max_{0
+0003f940: 7d20 2920 2922 2222 2e66 6f72 6d61 7428  } ) )""".format(
+0003f950: 7365 6c66 2e63 6f6c 6e61 6d65 735b 6963  self.colnames[ic
+0003f960: 5d29 290a 0a20 2020 2020 2020 2020 2020  ]))..           
+0003f970: 2023 204a 6176 6173 6372 6970 7420 6669   # Javascript fi
+0003f980: 6c74 6572 2066 756e 6374 696f 6e0a 2020  lter function.  
+0003f990: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+0003f9a0: 5f66 756e 6374 696f 6e20 3d20 2222 220a  _function = """.
+0003f9b0: 0a2f 2f2f 2f20 5061 7273 6572 0a2f 2f20  .//// Parser.// 
+0003f9c0: 6874 7470 733a 2f2f 7374 6163 6b6f 7665  https://stackove
+0003f9d0: 7266 6c6f 772e 636f 6d2f 7175 6573 7469  rflow.com/questi
+0003f9e0: 6f6e 732f 3139 3439 3133 3336 2f67 6574  ons/19491336/get
+0003f9f0: 2d75 726c 2d70 6172 616d 6574 6572 2d6a  -url-parameter-j
+0003fa00: 7175 6572 792d 6f72 2d68 6f77 2d74 6f2d  query-or-how-to-
+0003fa10: 6765 742d 7175 6572 792d 7374 7269 6e67  get-query-string
+0003fa20: 2d76 616c 7565 732d 696e 2d6a 7320 4020  -values-in-js @ 
+0003fa30: 5265 7a61 2042 6172 6164 6172 616e 0a24  Reza Baradaran.$
+0003fa40: 2e75 726c 5061 7261 6d20 3d20 6675 6e63  .urlParam = func
+0003fa50: 7469 6f6e 286e 616d 6529 7b7b 0a20 2020  tion(name){{.   
+0003fa60: 2076 6172 2072 6573 756c 7473 203d 206e   var results = n
+0003fa70: 6577 2052 6567 4578 7028 275b 5c3f 265d  ew RegExp('[\?&]
+0003fa80: 2720 2b20 6e61 6d65 202b 2027 3d28 5b5e  ' + name + '=([^
+0003fa90: 2623 5d2a 2927 292e 6578 6563 2877 696e  &#]*)').exec(win
+0003faa0: 646f 772e 6c6f 6361 7469 6f6e 2e68 7265  dow.location.hre
+0003fab0: 6629 3b0a 2020 2020 6966 2028 7265 7375  f);.    if (resu
+0003fac0: 6c74 733d 3d6e 756c 6c29 7b7b 0a20 2020  lts==null){{.   
+0003fad0: 2020 2020 7265 7475 726e 206e 756c 6c3b      return null;
+0003fae0: 0a20 2020 207d 7d0a 2020 2020 656c 7365  .    }}.    else
+0003faf0: 7b7b 0a20 2020 2020 2020 7265 7475 726e  {{.       return
+0003fb00: 2064 6563 6f64 6555 5249 2872 6573 756c   decodeURI(resul
+0003fb10: 7473 5b31 5d29 207c 7c20 303b 0a20 2020  ts[1]) || 0;.   
+0003fb20: 207d 7d0a 7d7d 0a0a 242e 666e 2e64 6174   }}.}}..$.fn.dat
+0003fb30: 6154 6162 6c65 2e65 7874 2e73 6561 7263  aTable.ext.searc
+0003fb40: 682e 7075 7368 280a 2020 2020 6675 6e63  h.push(.    func
+0003fb50: 7469 6f6e 2820 7365 7474 696e 6773 2c20  tion( settings, 
+0003fb60: 6461 7461 2c20 6461 7461 496e 6465 7820  data, dataIndex 
+0003fb70: 2920 7b7b 0a7b 307d 0a0a 2020 2020 2020  ) {{.{0}..      
+0003fb80: 2020 6966 2028 207b 317d 2029 0a20 2020    if ( {1} ).   
+0003fb90: 2020 2020 207b 7b0a 2020 2020 2020 2020       {{.        
+0003fba0: 2020 2020 7265 7475 726e 2074 7275 653b      return true;
+0003fbb0: 0a20 2020 2020 2020 207d 7d0a 2020 2020  .        }}.    
+0003fbc0: 2020 2020 7265 7475 726e 2066 616c 7365      return false
+0003fbd0: 3b0a 2020 2020 7d7d 0a29 3b0a 0a2f 2f2f  ;.    }}.);..///
+0003fbe0: 2f20 5570 6461 7465 2055 524c 2077 6974  / Update URL wit
+0003fbf0: 6820 6669 6c74 6572 2070 6172 616d 6574  h filter paramet
+0003fc00: 6572 730a 7661 7220 6669 6c74 6572 5f70  ers.var filter_p
+0003fc10: 6172 616d 7320 3d20 7b32 7d3b 0a0a 242e  arams = {2};..$.
+0003fc20: 5570 6461 7465 4669 6c74 6572 5552 4c20  UpdateFilterURL 
+0003fc30: 3d20 6675 6e63 7469 6f6e 2028 2920 7b7b  = function () {{
+0003fc40: 0a20 2020 2076 6172 2069 3b0a 2020 2020  .    var i;.    
+0003fc50: 7661 7220 6669 6c74 6572 5f75 726c 203d  var filter_url =
+0003fc60: 2022 223b 0a20 2020 2066 6f72 2028 6920   "";.    for (i 
+0003fc70: 3d20 303b 2069 203c 2066 696c 7465 725f  = 0; i < filter_
+0003fc80: 7061 7261 6d73 2e6c 656e 6774 683b 2069  params.length; i
+0003fc90: 2b2b 2920 7b7b 0a20 2020 2020 2020 2069  ++) {{.        i
+0003fca0: 6620 2824 2827 2327 2b66 696c 7465 725f  f ($('#'+filter_
+0003fcb0: 7061 7261 6d73 5b69 5d2b 275f 6d69 6e27  params[i]+'_min'
+0003fcc0: 292e 7661 6c28 2920 213d 2022 2229 207b  ).val() != "") {
+0003fcd0: 7b0a 2020 2020 2020 2020 2020 2020 6669  {.            fi
+0003fce0: 6c74 6572 5f75 726c 202b 3d20 2726 272b  lter_url += '&'+
+0003fcf0: 6669 6c74 6572 5f70 6172 616d 735b 695d  filter_params[i]
+0003fd00: 2b27 5f6d 696e 3d27 2b0a 2020 2020 2020  +'_min='+.      
+0003fd10: 2020 2020 2020 2020 2020 2020 2020 2428                $(
+0003fd20: 2723 272b 6669 6c74 6572 5f70 6172 616d  '#'+filter_param
+0003fd30: 735b 695d 2b27 5f6d 696e 2729 2e76 616c  s[i]+'_min').val
+0003fd40: 2829 3b0a 2020 2020 2020 2020 7d7d 0a20  ();.        }}. 
+0003fd50: 2020 2020 2020 2069 6620 2824 2827 2327         if ($('#'
+0003fd60: 2b66 696c 7465 725f 7061 7261 6d73 5b69  +filter_params[i
+0003fd70: 5d2b 275f 6d61 7827 292e 7661 6c28 2920  ]+'_max').val() 
+0003fd80: 213d 2022 2229 207b 7b0a 2020 2020 2020  != "") {{.      
+0003fd90: 2020 2020 2020 6669 6c74 6572 5f75 726c        filter_url
+0003fda0: 202b 3d20 2726 272b 6669 6c74 6572 5f70   += '&'+filter_p
+0003fdb0: 6172 616d 735b 695d 2b27 5f6d 6178 3d27  arams[i]+'_max='
+0003fdc0: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+0003fdd0: 2020 2020 2020 2428 2723 272b 6669 6c74        $('#'+filt
+0003fde0: 6572 5f70 6172 616d 735b 695d 2b27 5f6d  er_params[i]+'_m
+0003fdf0: 6178 2729 2e76 616c 2829 3b0a 2020 2020  ax').val();.    
+0003fe00: 2020 2020 7d7d 0a20 2020 207d 7d0a 0a20      }}.    }}.. 
+0003fe10: 2020 2069 6620 2866 696c 7465 725f 7572     if (filter_ur
+0003fe20: 6c20 213d 2022 2229 207b 7b0a 2020 2020  l != "") {{.    
+0003fe30: 2020 2020 7661 7220 6669 6c74 6572 6564      var filtered
+0003fe40: 5f75 726c 203d 2077 696e 646f 772e 6c6f  _url = window.lo
+0003fe50: 6361 7469 6f6e 2e68 7265 662e 7370 6c69  cation.href.spli
+0003fe60: 7428 273f 2729 5b30 5d20 2b20 273f 2720  t('?')[0] + '?' 
+0003fe70: 2b20 6669 6c74 6572 5f75 726c 3b0a 2020  + filter_url;.  
+0003fe80: 2020 2020 2020 7769 6e64 6f77 2e68 6973        window.his
+0003fe90: 746f 7279 2e70 7573 6853 7461 7465 2827  tory.pushState('
+0003fea0: 272c 2027 272c 2066 696c 7465 7265 645f  ', '', filtered_
+0003feb0: 7572 6c29 3b0a 2020 2020 7d7d 0a7d 7d5c  url);.    }}.}}\
+0003fec0: 6e5c 6e22 2222 2e66 6f72 6d61 7428 6865  n\n""".format(he
+0003fed0: 6164 6572 5f6c 696e 6573 2c20 225c 6e20  ader_lines, "\n 
+0003fee0: 2626 2022 2e6a 6f69 6e28 7465 7374 6572  && ".join(tester
+0003fef0: 292c 205b 7365 6c66 2e63 6f6c 6e61 6d65  ), [self.colname
+0003ff00: 735b 6963 5d20 666f 7220 6963 2069 6e20  s[ic] for ic in 
+0003ff10: 6963 5f6c 6973 745d 2e5f 5f72 6570 725f  ic_list].__repr_
+0003ff20: 5f28 2929 0a0a 2020 2020 2020 2020 2020  _())..          
+0003ff30: 2020 666f 7220 692c 206c 696e 6520 696e    for i, line in
+0003ff40: 2065 6e75 6d65 7261 7465 286c 696e 6573   enumerate(lines
+0003ff50: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0003ff60: 2020 2069 6620 2224 2864 6f63 756d 656e     if "$(documen
+0003ff70: 7429 2e72 6561 6479 2866 756e 6374 696f  t).ready(functio
+0003ff80: 6e28 2922 2069 6e20 6c69 6e65 3a0a 2020  n()" in line:.  
+0003ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ffa0: 2020 6973 7461 7274 203d 2069 0a20 2020    istart = i.   
+0003ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ffc0: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
+0003ffd0: 2020 2020 6c69 6e65 732e 696e 7365 7274      lines.insert
+0003ffe0: 2869 7374 6172 742c 2066 696c 7465 725f  (istart, filter_
+0003fff0: 6675 6e63 7469 6f6e 290a 0a20 2020 2020  function)..     
+00040000: 2020 2020 2020 2023 2050 6172 7365 2061         # Parse a
+00040010: 6464 7265 7373 2062 6172 0a20 2020 2020  ddress bar.     
+00040020: 2020 2020 2020 206c 696e 6573 2e69 6e73         lines.ins
+00040030: 6572 7428 6973 7461 7274 2b32 2c20 225c  ert(istart+2, "\
+00040040: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00040050: 666f 7220 6963 2069 6e20 6963 5f6c 6973  for ic in ic_lis
+00040060: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00040070: 2020 206c 696e 6573 2e69 6e73 6572 7428     lines.insert(
+00040080: 6973 7461 7274 2b32 2c20 227b 317d 2428  istart+2, "{1}$(
+00040090: 2723 7b30 7d5f 6d61 7827 292e 7661 6c28  '#{0}_max').val(
+000400a0: 242e 7572 6c50 6172 616d 2827 7b30 7d5f  $.urlParam('{0}_
+000400b0: 6d61 7827 2929 3b5c 6e22 2e66 6f72 6d61  max'));\n".forma
+000400c0: 7428 7365 6c66 2e63 6f6c 6e61 6d65 735b  t(self.colnames[
+000400d0: 6963 5d2c 2027 2027 2a33 2929 0a20 2020  ic], ' '*3)).   
+000400e0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+000400f0: 6573 2e69 6e73 6572 7428 6973 7461 7274  es.insert(istart
+00040100: 2b32 2c20 227b 317d 2428 2723 7b30 7d5f  +2, "{1}$('#{0}_
+00040110: 6d69 6e27 292e 7661 6c28 242e 7572 6c50  min').val($.urlP
+00040120: 6172 616d 2827 7b30 7d5f 6d69 6e27 2929  aram('{0}_min'))
+00040130: 3b5c 6e22 2e66 6f72 6d61 7428 7365 6c66  ;\n".format(self
+00040140: 2e63 6f6c 6e61 6d65 735b 6963 5d2c 2027  .colnames[ic], '
+00040150: 2027 2a33 2929 0a20 2020 2020 2020 2020   '*3)).         
+00040160: 2020 206c 696e 6573 2e69 6e73 6572 7428     lines.insert(
+00040170: 6973 7461 7274 2b32 2c20 225c 6e22 290a  istart+2, "\n").
+00040180: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00040190: 6e70 7574 206c 6973 7465 6e65 720a 2020  nput listener.  
+000401a0: 2020 2020 2020 2020 2020 6c69 7374 656e            listen
+000401b0: 6572 203d 2022 2222 0a20 2020 202f 2f20  er = """.    // 
+000401c0: 4576 656e 7420 6c69 7374 656e 6572 2074  Event listener t
+000401d0: 6f20 7468 6520 7477 6f20 7261 6e67 6520  o the two range 
+000401e0: 6669 6c74 6572 696e 6720 696e 7075 7473  filtering inputs
+000401f0: 2074 6f20 7265 6472 6177 206f 6e20 696e   to redraw on in
+00040200: 7075 740a 2020 2020 2428 277b 307d 2729  put.    $('{0}')
+00040210: 2e6b 6579 7570 2820 6675 6e63 7469 6f6e  .keyup( function
+00040220: 2829 207b 7b0a 2020 2020 2020 2020 7461  () {{.        ta
+00040230: 626c 652e 6472 6177 2829 3b0a 2020 2020  ble.draw();.    
+00040240: 2020 2020 242e 5570 6461 7465 4669 6c74      $.UpdateFilt
+00040250: 6572 5552 4c28 293b 0a20 2020 207d 7d20  erURL();.    }} 
+00040260: 293b 0a20 2020 2020 2020 2020 2020 2022  );.            "
+00040270: 2222 2e66 6f72 6d61 7428 272c 2027 2e6a  "".format(', '.j
+00040280: 6f69 6e28 5b27 237b 307d 5f6d 696e 2c20  oin(['#{0}_min, 
+00040290: 237b 307d 5f6d 6178 272e 666f 726d 6174  #{0}_max'.format
+000402a0: 2873 656c 662e 636f 6c6e 616d 6573 5b69  (self.colnames[i
+000402b0: 635d 2920 666f 7220 6963 2069 6e20 6963  c]) for ic in ic
+000402c0: 5f6c 6973 745d 2929 0a0a 2020 2020 2020  _list]))..      
+000402d0: 2020 2020 2020 666f 7220 696c 2c20 6c69        for il, li
+000402e0: 6e65 2069 6e20 656e 756d 6572 6174 6528  ne in enumerate(
+000402f0: 6c69 6e65 7329 3a0a 2020 2020 2020 2020  lines):.        
+00040300: 2020 2020 2020 2020 6966 2027 7d20 293b          if '} );
+00040310: 2020 3c2f 7363 7269 7074 3e27 2069 6e20    </script>' in 
+00040320: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
+00040330: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00040340: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
+00040350: 6573 2e69 6e73 6572 7428 696c 2c20 6c69  es.insert(il, li
+00040360: 7374 656e 6572 290a 0a20 2020 2020 2020  stener)..       
+00040370: 2066 7020 3d20 6f70 656e 286f 7574 7075   fp = open(outpu
+00040380: 742c 2027 7727 290a 2020 2020 2020 2020  t, 'w').        
+00040390: 6670 2e77 7269 7465 6c69 6e65 7328 6c69  fp.writelines(li
+000403a0: 6e65 7329 0a20 2020 2020 2020 2066 702e  nes).        fp.
+000403b0: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
+000403c0: 2069 6620 746f 6767 6c65 3a0a 2020 2020   if toggle:.    
+000403d0: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
+000403e0: 6f70 656e 286f 7574 7075 7429 2e72 6561  open(output).rea
+000403f0: 646c 696e 6573 2829 0a0a 2020 2020 2020  dlines()..      
+00040400: 2020 2020 2020 2320 4368 616e 6765 2063        # Change c
+00040410: 616c 6c20 746f 2044 6174 6154 6162 6c65  all to DataTable
+00040420: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00040430: 2069 6c2c 206c 696e 6520 696e 2065 6e75   il, line in enu
+00040440: 6d65 7261 7465 286c 696e 6573 293a 0a20  merate(lines):. 
+00040450: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00040460: 6620 2764 6174 6154 6162 6c65 2827 2069  f 'dataTable(' i
+00040470: 6e20 6c69 6e65 3a0a 2020 2020 2020 2020  n line:.        
+00040480: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00040490: 6b0a 0a20 2020 2020 2020 2020 2020 206c  k..            l
+000404a0: 696e 6573 5b69 6c5d 203d 2022 2020 2076  ines[il] = "   v
+000404b0: 6172 2074 6162 6c65 203d 207b 307d 5c6e  ar table = {0}\n
+000404c0: 222e 666f 726d 6174 286c 696e 6573 5b69  ".format(lines[i
+000404d0: 6c5d 2e73 7472 6970 2829 2e72 6570 6c61  l].strip().repla
+000404e0: 6365 2827 6461 7461 5461 626c 6527 2c20  ce('dataTable', 
+000404f0: 2744 6174 6154 6162 6c65 2729 290a 0a20  'DataTable')).. 
+00040500: 2020 2020 2020 2020 2020 2023 2041 6464             # Add
+00040510: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00040520: 2020 2020 2020 666f 7220 696c 2c20 6c69        for il, li
+00040530: 6e65 2069 6e20 656e 756d 6572 6174 6528  ne in enumerate(
+00040540: 6c69 6e65 7329 3a0a 2020 2020 2020 2020  lines):.        
+00040550: 2020 2020 2020 2020 6966 2027 7d20 293b          if '} );
+00040560: 2020 3c2f 7363 7269 7074 3e27 2069 6e20    </script>' in 
+00040570: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
+00040580: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00040590: 0a20 2020 2020 2020 2020 2020 2074 6f67  .            tog
+000405a0: 676c 6572 203d 2022 2222 0a20 2020 2024  gler = """.    $
+000405b0: 2827 612e 746f 6767 6c65 2d76 6973 2729  ('a.toggle-vis')
+000405c0: 2e6f 6e28 2027 636c 6963 6b27 2c20 6675  .on( 'click', fu
+000405d0: 6e63 7469 6f6e 2028 6529 207b 0a20 2020  nction (e) {.   
+000405e0: 2020 2020 2065 2e70 7265 7665 6e74 4465       e.preventDe
+000405f0: 6661 756c 7428 293b 0a0a 2020 2020 2020  fault();..      
+00040600: 2020 2f2f 2047 6574 2074 6865 2063 6f6c    // Get the col
+00040610: 756d 6e20 4150 4920 6f62 6a65 6374 0a20  umn API object. 
+00040620: 2020 2020 2020 2076 6172 2063 6f6c 756d         var colum
+00040630: 6e20 3d20 7461 626c 652e 636f 6c75 6d6e  n = table.column
+00040640: 2820 2428 7468 6973 292e 6174 7472 2827  ( $(this).attr('
+00040650: 6461 7461 2d63 6f6c 756d 6e27 2920 293b  data-column') );
+00040660: 0a0a 2020 2020 2020 2020 2f2f 2054 6f67  ..        // Tog
+00040670: 676c 6520 7468 6520 7669 7369 6269 6c69  gle the visibili
+00040680: 7479 0a20 2020 2020 2020 2063 6f6c 756d  ty.        colum
+00040690: 6e2e 7669 7369 626c 6528 2021 2063 6f6c  n.visible( ! col
+000406a0: 756d 6e2e 7669 7369 626c 6528 2920 293b  umn.visible() );
+000406b0: 0a20 2020 207d 2029 3b0a 0a20 2020 2020  .    } );..     
+000406c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000406d0: 2020 2020 2020 206c 696e 6573 2e69 6e73         lines.ins
+000406e0: 6572 7428 696c 2c20 746f 6767 6c65 7229  ert(il, toggler)
+000406f0: 0a0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+00040700: 6767 6c65 5f64 6976 203d 2022 2222 0a3c  ggle_div = """.<
+00040710: 6469 7620 7374 796c 653d 2262 6f72 6465  div style="borde
+00040720: 723a 3170 7820 736f 6c69 6420 626c 6163  r:1px solid blac
+00040730: 6b3b 2070 6164 6469 6e67 3a31 3070 783b  k; padding:10px;
+00040740: 206d 6172 6769 6e3a 3130 7078 223e 0a20   margin:10px">. 
+00040750: 2020 203c 623e 546f 6767 6c65 2063 6f6c     <b>Toggle col
+00040760: 756d 6e3a 3c2f 623e 3c2f 6272 3e20 7b30  umn:</b></br> {0
+00040770: 7d0a 3c2f 6469 763e 0a0a 2020 2020 2020  }.</div>..      
+00040780: 2020 2020 2020 2222 222e 666f 726d 6174        """.format
+00040790: 2827 203c 623e 2f3c 2f62 3e20 272e 6a6f  (' <b>/</b> '.jo
+000407a0: 696e 285b 273c 6120 636c 6173 733d 2274  in(['<a class="t
+000407b0: 6f67 676c 652d 7669 7322 2064 6174 612d  oggle-vis" data-
+000407c0: 636f 6c75 6d6e 3d22 7b30 7d22 3e20 3c74  column="{0}"> <t
+000407d0: 743e 7b31 7d3c 2f74 743e 203c 2f61 3e27  t>{1}</tt> </a>'
+000407e0: 2e66 6f72 6d61 7428 6963 2c20 636f 6c29  .format(ic, col)
+000407f0: 2066 6f72 2069 632c 2063 6f6c 2069 6e20   for ic, col in 
+00040800: 656e 756d 6572 6174 6528 7365 6c66 2e63  enumerate(self.c
+00040810: 6f6c 6e61 6d65 7329 5d29 290a 0a20 2020  olnames)]))..   
+00040820: 2020 2020 2020 2020 206c 696e 6573 2e69           lines.i
+00040830: 6e73 6572 7428 696c 2b32 2c20 746f 6767  nsert(il+2, togg
+00040840: 6c65 5f64 6976 290a 2020 2020 2020 2020  le_div).        
+00040850: 2020 2020 0a20 2020 2020 2020 2023 2049      .        # I
+00040860: 6e73 6572 7420 7469 6d65 7374 616d 700a  nsert timestamp.
+00040870: 2020 2020 2020 2020 6966 2074 696d 6573          if times
+00040880: 7461 6d70 3a0a 2020 2020 2020 2020 2020  tamp:.          
+00040890: 2020 666f 7220 692c 206c 696e 6520 696e    for i, line in
+000408a0: 2065 6e75 6d65 7261 7465 286c 696e 6573   enumerate(lines
+000408b0: 5b3a 3a2d 315d 293a 0a20 2020 2020 2020  [::-1]):.       
+000408c0: 2020 2020 2020 2020 2069 6620 273c 2f62           if '</b
+000408d0: 6f64 793e 2720 696e 206c 696e 653a 0a20  ody>' in line:. 
+000408e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000408f0: 2020 2023 2070 7269 6e74 2827 7469 6d65     # print('time
+00040900: 7374 616d 7021 272c 6929 0a20 2020 2020  stamp!',i).     
+00040910: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00040920: 696e 6573 2e69 6e73 6572 7428 2d28 692b  ines.insert(-(i+
+00040930: 3129 2c0a 2020 2020 2020 2020 2020 2020  1),.            
+00040940: 6627 3c73 7061 6e20 7374 796c 653d 2266  f'<span style="f
+00040950: 6f6e 742d 7369 7a65 3a78 2d73 6d61 6c6c  ont-size:x-small
+00040960: 3b22 3e20 4372 6561 7465 643a 207b 7469  ;"> Created: {ti
+00040970: 6d65 2e63 7469 6d65 2829 7d20 3c2f 7370  me.ctime()} </sp
+00040980: 616e 3e5c 6e27 290a 2020 2020 2020 2020  an>\n').        
+00040990: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+000409a0: 6b0a 2020 2020 2020 2020 0a20 2020 2020  k.        .     
+000409b0: 2020 2066 7020 3d20 6f70 656e 286f 7574     fp = open(out
+000409c0: 7075 742c 2027 7727 290a 2020 2020 2020  put, 'w').      
+000409d0: 2020 6670 2e77 7269 7465 6c69 6e65 7328    fp.writelines(
+000409e0: 6c69 6e65 7329 0a20 2020 2020 2020 2066  lines).        f
 000409f0: 702e 636c 6f73 6528 290a 0a20 2020 2020  p.close()..     
-00040a00: 2020 2020 2020 2023 2045 6469 7420 4854         # Edit HT
-00040a10: 4d4c 2066 696c 650a 2020 2020 2020 2020  ML file.        
-00040a20: 2020 2020 6c69 6e65 7320 3d20 6f70 656e      lines = open
-00040a30: 286f 7574 7075 7429 2e72 6561 646c 696e  (output).readlin
-00040a40: 6573 2829 0a0a 2020 2020 2020 2020 2020  es()..          
-00040a50: 2020 2320 4164 6420 616a 6178 2063 616c    # Add ajax cal
-00040a60: 6c20 746f 2044 6174 6154 6162 6c65 0a20  l to DataTable. 
-00040a70: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00040a80: 6c2c 206c 696e 6520 696e 2065 6e75 6d65  l, line in enume
-00040a90: 7261 7465 286c 696e 6573 293a 0a20 2020  rate(lines):.   
-00040aa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00040ab0: 2770 6167 654c 656e 6774 6827 2069 6e20  'pageLength' in 
-00040ac0: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
-00040ad0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00040ae0: 0a20 2020 2020 2020 2020 2020 2061 6a61  .            aja
-00040af0: 785f 6361 6c6c 203d 2027 7b73 7061 6365  x_call = '{space
-00040b00: 727d 2261 6a61 7822 3a20 227b 6a73 6f6e  r}"ajax": "{json
-00040b10: 7d22 2c5c 6e7b 7370 6163 6572 7d22 6465  }",\n{spacer}"de
-00040b20: 6665 7252 656e 6465 7222 3a20 7472 7565  ferRender": true
-00040b30: 2c5c 6e27 2e66 6f72 6d61 7428 7370 6163  ,\n'.format(spac
-00040b40: 6572 3d27 2027 2a38 2c20 6a73 6f6e 3d6f  er=' '*8, json=o
-00040b50: 7574 7075 742e 7265 706c 6163 6528 272e  utput.replace('.
-00040b60: 6874 6d6c 272c 2027 2e6a 736f 6e27 2929  html', '.json'))
-00040b70: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-00040b80: 6573 2e69 6e73 6572 7428 696c 2b31 2c20  es.insert(il+1, 
-00040b90: 616a 6178 5f63 616c 6c29 0a0a 2020 2020  ajax_call)..    
-00040ba0: 2020 2020 2020 2020 2320 5374 7269 7020          # Strip 
-00040bb0: 6f75 7420 7461 626c 6520 626f 6479 0a20  out table body. 
-00040bc0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00040bd0: 6865 6164 2c20 6c69 6e65 2069 6e20 656e  head, line in en
-00040be0: 756d 6572 6174 6528 6c69 6e65 7329 3a0a  umerate(lines):.
-00040bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040c00: 6966 2027 3c2f 7468 6561 643e 2720 696e  if '</thead>' in
-00040c10: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
-00040c20: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00040c30: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00040c40: 7220 6974 6169 6c2c 206c 696e 6520 696e  r itail, line in
-00040c50: 2065 6e75 6d65 7261 7465 286c 696e 6573   enumerate(lines
-00040c60: 5b3a 3a2d 315d 293a 0a20 2020 2020 2020  [::-1]):.       
-00040c70: 2020 2020 2020 2020 2069 6620 273c 2f74           if '</t
-00040c80: 723e 2720 696e 206c 696e 653a 0a20 2020  r>' in line:.   
-00040c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040ca0: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-00040cb0: 2020 2020 6670 203d 206f 7065 6e28 6f75      fp = open(ou
-00040cc0: 7470 7574 2c20 2777 2729 0a20 2020 2020  tput, 'w').     
-00040cd0: 2020 2020 2020 2066 702e 7772 6974 656c         fp.writel
-00040ce0: 696e 6573 286c 696e 6573 5b3a 6968 6561  ines(lines[:ihea
-00040cf0: 642b 315d 290a 2020 2020 2020 2020 2020  d+1]).          
-00040d00: 2020 6670 2e77 7269 7465 6c69 6e65 7328    fp.writelines(
-00040d10: 6c69 6e65 735b 2d69 7461 696c 3a5d 290a  lines[-itail:]).
-00040d20: 2020 2020 2020 2020 2020 2020 6670 2e63              fp.c
-00040d30: 6c6f 7365 2829 0a0a 0a64 6566 2063 6f6c  lose()...def col
-00040d40: 756d 6e5f 7374 7269 6e67 5f6f 7065 7261  umn_string_opera
-00040d50: 7469 6f6e 2863 6f6c 2c20 7465 7374 2c20  tion(col, test, 
-00040d60: 6d65 7468 6f64 3d27 636f 6e74 6169 6e73  method='contains
-00040d70: 272c 206c 6f67 6963 616c 3d27 6f72 2729  ', logical='or')
-00040d80: 3a0a 2020 2020 2222 220a 2020 2020 416e  :.    """.    An
-00040d90: 616c 6f67 6f75 7320 746f 2060 6073 7472  alogous to ``str
-00040da0: 2e63 6f6e 7461 696e 7360 6020 6275 7420  .contains`` but 
-00040db0: 666f 7220 7461 626c 6520 636f 6c75 6d6e  for table column
-00040dc0: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00040dd0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00040de0: 0a20 2020 2063 6f6c 203a 2069 7465 7261  .    col : itera
-00040df0: 626c 6520 6c69 7374 206f 6620 7374 7269  ble list of stri
-00040e00: 6e67 730a 2020 2020 2020 2020 4c69 7374  ngs.        List
-00040e10: 206f 6620 7374 7269 6e67 7320 746f 2074   of strings to t
-00040e20: 6573 742e 2020 416e 7974 6869 6e67 2069  est.  Anything i
-00040e30: 7465 7261 626c 652c 2065 2e67 2e2c 206c  terable, e.g., l
-00040e40: 6973 7420 6f72 200a 2020 2020 2020 2020  ist or .        
-00040e50: 607e 6173 7472 6f70 792e 7461 626c 652e  `~astropy.table.
-00040e60: 636f 6c75 6d6e 2e43 6f6c 756d 6e60 2e0a  column.Column`..
-00040e70: 0a20 2020 2074 6573 7420 3a20 7374 722c  .    test : str,
-00040e80: 206c 6973 7420 6f66 2073 7472 696e 6773   list of strings
-00040e90: 2c20 4e6f 6e65 2c20 6f72 2073 6c69 6365  , None, or slice
-00040ea0: 0a0a 2020 2020 2020 2020 4966 2060 6074  ..        If ``t
-00040eb0: 6573 7460 6020 6973 2061 2073 7472 696e  est`` is a strin
-00040ec0: 672c 206f 7220 6c69 7374 206f 6620 7374  g, or list of st
-00040ed0: 7269 6e67 732c 2074 6865 6e20 7275 6e20  rings, then run 
-00040ee0: 7468 6520 7374 7269 6e67 0a20 2020 2020  the string.     
-00040ef0: 2020 2060 606d 6574 686f 6460 6020 6f6e     ``method`` on
-00040f00: 2065 6163 6820 656e 7472 7920 6f66 2060   each entry of `
-00040f10: 6063 6f6c 6060 2077 6974 6820 6060 7465  `col`` with ``te
-00040f20: 7374 6060 2061 7320 7468 6520 6172 6775  st`` as the argu
-00040f30: 6d65 6e74 206f 720a 2020 2020 2020 2020  ment or.        
-00040f40: 6561 6368 2065 6c65 6d65 6e74 206f 6620  each element of 
-00040f50: 7468 6520 6060 7465 7374 6060 206c 6973  the ``test`` lis
-00040f60: 7420 6173 2061 7267 756d 656e 7473 2e0a  t as arguments..
-00040f70: 0a20 2020 2020 2020 2049 6620 6060 7465  .        If ``te
-00040f80: 7374 6060 2069 7320 4e6f 6e65 2c20 7275  st`` is None, ru
-00040f90: 6e20 606d 6574 686f 6460 206f 6e20 6561  n `method` on ea
-00040fa0: 6368 2065 6e74 7279 2077 6974 6820 6e6f  ch entry with no
-00040fb0: 2061 7267 756d 656e 7473 2c20 0a20 2020   arguments, .   
-00040fc0: 2020 2020 2065 2e67 2e2c 2027 7570 7065       e.g., 'uppe
-00040fd0: 7227 2e0a 0a20 2020 2020 2020 2049 6620  r'...        If 
-00040fe0: 6060 7465 7374 6060 2069 7320 6120 6060  ``test`` is a ``
-00040ff0: 736c 6963 6560 602c 2072 6574 7572 6e20  slice``, return 
-00041000: 736c 6963 6564 2073 7472 696e 6773 2066  sliced strings f
-00041010: 6f72 2065 6163 6820 656e 7472 792e 0a0a  or each entry...
-00041020: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
-00041030: 0a20 2020 2020 2020 2053 7472 696e 6720  .        String 
-00041040: 6d65 7468 6f64 2074 6f20 6170 706c 7920  method to apply 
-00041050: 746f 2065 6163 6820 656e 7472 7920 6f66  to each entry of
-00041060: 2060 6063 6f6c 6060 2e20 2045 2e67 2e2c   ``col``.  E.g.,
-00041070: 2027 636f 6e74 6169 6e73 272c 0a20 2020   'contains',.   
-00041080: 2020 2020 2027 7374 6172 7473 7769 7468       'startswith
-00041090: 272c 2027 656e 6473 7769 7468 272c 2027  ', 'endswith', '
-000410a0: 696e 6465 7827 2e0a 0a20 2020 206c 6f67  index'...    log
-000410b0: 6963 616c 203a 205b 276f 7227 2c27 616e  ical : ['or','an
-000410c0: 6427 2c27 6e6f 7427 5d0a 2020 2020 2020  d','not'].      
-000410d0: 2020 4c6f 6769 6361 6c20 7465 7374 2074    Logical test t
-000410e0: 6f20 7573 6520 7768 656e 2060 6074 6573  o use when ``tes
-000410f0: 7460 6020 6973 2061 206c 6973 7420 6f66  t`` is a list of
-00041100: 2073 7472 696e 6773 2e20 2046 6f72 2065   strings.  For e
-00041110: 7861 6d70 6c65 2c0a 2020 2020 2020 2020  xample,.        
-00041120: 6966 2079 6f75 2077 616e 7420 746f 2074  if you want to t
-00041130: 6573 7420 6966 2074 6865 2063 6f6c 756d  est if the colum
-00041140: 6e20 6861 7320 7661 6c75 6573 2074 6861  n has values tha
-00041150: 7420 6d61 7463 6820 6569 7468 6572 0a20  t match either. 
-00041160: 2020 2020 2020 2027 7661 6c75 6531 2720         'value1' 
-00041170: 6f72 2027 7661 6c75 6532 272c 2074 6865  or 'value2', the
-00041180: 6e20 7275 6e20 7769 7468 0a0a 2020 2020  n run with..    
-00041190: 2020 2020 2020 2020 3e3e 3e20 7265 7320          >>> res 
-000411a0: 3d20 636f 6c75 6d6e 5f74 6f5f 7374 7269  = column_to_stri
-000411b0: 6e67 5f6f 7065 7261 7469 6f6e 2863 6f6c  ng_operation(col
-000411c0: 2c20 5b27 7661 6c75 6531 272c 2776 616c  , ['value1','val
-000411d0: 7565 3227 5d2c 206d 6574 686f 643d 2763  ue2'], method='c
-000411e0: 6f6e 7461 696e 7327 2c20 6c6f 6769 6361  ontains', logica
-000411f0: 6c3d 276f 7227 290a 0a20 2020 2052 6574  l='or')..    Ret
-00041200: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00041210: 0a20 2020 2072 6573 756c 7420 3a20 6c69  .    result : li
-00041220: 7374 0a20 2020 2020 2020 204c 6973 7420  st.        List 
-00041230: 6f66 2069 7465 7261 7465 6420 7265 7375  of iterated resu
-00041240: 6c74 7320 6f6e 2074 6865 2065 6e74 7269  lts on the entri
-00041250: 6573 206f 6620 6060 636f 6c60 602c 2065  es of ``col``, e
-00041260: 2e67 2e2c 206c 6973 7420 6f66 200a 2020  .g., list of .  
-00041270: 2020 2020 2020 6060 626f 6f6c 6060 206f        ``bool`` o
-00041280: 7220 6060 7374 7269 6e67 6060 2e0a 0a20  r ``string``... 
-00041290: 2020 2022 2222 0a20 2020 2069 6620 6973     """.    if is
-000412a0: 696e 7374 616e 6365 2874 6573 742c 206c  instance(test, l
-000412b0: 6973 7429 3a0a 2020 2020 2020 2020 7465  ist):.        te
-000412c0: 7374 5f6c 6973 7420 3d20 7465 7374 0a20  st_list = test. 
-000412d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000412e0: 2074 6573 745f 6c69 7374 203d 205b 7465   test_list = [te
-000412f0: 7374 5d0a 0a20 2020 206f 7574 5f74 6573  st]..    out_tes
-00041300: 7420 3d20 5b5d 0a0a 2020 2020 666f 7220  t = []..    for 
-00041310: 692c 2063 5f69 2069 6e20 656e 756d 6572  i, c_i in enumer
-00041320: 6174 6528 636f 6c29 3a0a 2020 2020 2020  ate(col):.      
-00041330: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00041340: 7465 7374 2c20 736c 6963 6529 3a0a 2020  test, slice):.  
-00041350: 2020 2020 2020 2020 2020 6f75 745f 7465            out_te
-00041360: 7374 2e61 7070 656e 6428 635f 695b 7465  st.append(c_i[te
-00041370: 7374 5d29 0a20 2020 2020 2020 2020 2020  st]).           
-00041380: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
-00041390: 2020 2066 756e 6320 3d20 6765 7461 7474     func = getatt
-000413a0: 7228 635f 692c 206d 6574 686f 6429 0a20  r(c_i, method). 
-000413b0: 2020 2020 2020 2069 6620 7465 7374 2069         if test i
-000413c0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000413d0: 2020 2020 6f75 745f 7465 7374 2e61 7070      out_test.app
-000413e0: 656e 6428 6675 6e63 2829 290a 2020 2020  end(func()).    
-000413f0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00041400: 0a0a 2020 2020 2020 2020 6c69 7374 5f69  ..        list_i
-00041410: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00041420: 7220 745f 6920 696e 2074 6573 745f 6c69  r t_i in test_li
-00041430: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00041440: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00041450: 2020 2020 206c 6973 745f 692e 6170 7065       list_i.appe
-00041460: 6e64 2866 756e 6328 745f 6929 290a 2020  nd(func(t_i)).  
-00041470: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00041480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00041490: 2020 6c69 7374 5f69 2e61 7070 656e 6428    list_i.append(
-000414a0: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
-000414b0: 6f75 745f 7465 7374 2e61 7070 656e 6428  out_test.append(
-000414c0: 6c69 7374 5f69 290a 0a20 2020 2061 7272  list_i)..    arr
-000414d0: 203d 206e 702e 6172 7261 7928 6f75 745f   = np.array(out_
-000414e0: 7465 7374 290a 2020 2020 7368 203d 2061  test).    sh = a
-000414f0: 7272 2e73 6861 7065 0a0a 2020 2020 6966  rr.shape..    if
-00041500: 206c 6f67 6963 616c 2069 7320 4e6f 6e65   logical is None
-00041510: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00041520: 206e 702e 7371 7565 657a 6528 6172 7229   np.squeeze(arr)
-00041530: 0a20 2020 2065 6c69 6620 6c6f 6769 6361  .    elif logica
-00041540: 6c2e 7570 7065 7228 2920 3d3d 2027 414e  l.upper() == 'AN
-00041550: 4427 3a0a 2020 2020 2020 2020 7265 7475  D':.        retu
-00041560: 726e 206e 702e 7375 6d28 6172 722c 2061  rn np.sum(arr, a
-00041570: 7869 733d 3129 203e 3d20 7368 5b31 5d0a  xis=1) >= sh[1].
-00041580: 2020 2020 656c 6966 206c 6f67 6963 616c      elif logical
-00041590: 2e75 7070 6572 2829 203d 3d20 274e 4f54  .upper() == 'NOT
-000415a0: 273a 0a20 2020 2020 2020 2072 6574 7572  ':.        retur
-000415b0: 6e20 6e70 2e73 756d 2861 7272 2c20 6178  n np.sum(arr, ax
-000415c0: 6973 3d31 2920 3d3d 2030 0a20 2020 2065  is=1) == 0.    e
-000415d0: 6c73 653a 2020 2320 4f52 0a20 2020 2020  lse:  # OR.     
-000415e0: 2020 2072 6574 7572 6e20 6e70 2e73 756d     return np.sum
-000415f0: 2861 7272 2c20 6178 6973 3d31 2920 3e20  (arr, axis=1) > 
-00041600: 300a 0a0a 6465 6620 636f 6c75 6d6e 5f76  0...def column_v
-00041610: 616c 7565 735f 696e 5f6c 6973 7428 636f  alues_in_list(co
-00041620: 6c2c 2074 6573 745f 6c69 7374 293a 0a20  l, test_list):. 
-00041630: 2020 2022 2222 5465 7374 2069 6620 636f     """Test if co
-00041640: 6c75 6d6e 2065 6c65 6d65 6e74 7320 2269  lumn elements "i
-00041650: 6e22 2061 6e20 6974 6572 6162 6c65 2028  n" an iterable (
-00041660: 652e 672e 2c20 6120 6c69 7374 206f 6620  e.g., a list of 
-00041670: 7374 7269 6e67 7329 0a0a 2020 2020 5061  strings)..    Pa
-00041680: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-00041690: 2d2d 2d2d 2d2d 2d0a 2020 2020 636f 6c20  -------.    col 
-000416a0: 3a20 6061 7374 726f 7079 2e74 6162 6c65  : `astropy.table
-000416b0: 2e43 6f6c 756d 6e60 206f 7220 6f74 6865  .Column` or othe
-000416c0: 7220 6974 6572 6162 6c65 0a20 2020 2020  r iterable.     
-000416d0: 2020 2047 726f 7570 206f 6620 656e 7472     Group of entr
-000416e0: 6965 7320 746f 2074 6573 740a 0a20 2020  ies to test..   
-000416f0: 2074 6573 745f 6c69 7374 203a 2069 7465   test_list : ite
-00041700: 7261 626c 650a 2020 2020 2020 2020 4c69  rable.        Li
-00041710: 7374 206f 6620 7661 6c75 6573 2074 6f20  st of values to 
-00041720: 7365 6172 6368 0a0a 2020 2020 5265 7475  search..    Retu
-00041730: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-00041740: 2020 2020 7465 7374 203a 2062 6f6f 6c20      test : bool 
-00041750: 6172 7261 790a 2020 2020 2020 2020 5369  array.        Si
-00041760: 6d70 6c65 2074 6573 743a 0a20 2020 2020  mple test:.     
-00041770: 2020 2020 2020 203e 3e3e 205b 635f 6920         >>> [c_i 
-00041780: 696e 2074 6573 745f 6c69 7374 2066 6f72  in test_list for
-00041790: 2063 5f69 2069 6e20 636f 6c5d 0a20 2020   c_i in col].   
-000417a0: 2022 2222 0a20 2020 2074 6573 7420 3d20   """.    test = 
-000417b0: 6e70 2e61 7272 6179 285b 635f 6920 696e  np.array([c_i in
-000417c0: 2074 6573 745f 6c69 7374 2066 6f72 2063   test_list for c
-000417d0: 5f69 2069 6e20 636f 6c5d 290a 2020 2020  _i in col]).    
-000417e0: 7265 7475 726e 2074 6573 740a 0a0a 6465  return test...de
-000417f0: 6620 6669 6c6c 5f62 6574 7765 656e 5f73  f fill_between_s
-00041800: 7465 7073 2878 2c20 7930 2c20 7931 2c20  teps(x, y0, y1, 
-00041810: 6178 3d4e 6f6e 652c 202a 6172 6773 2c20  ax=None, *args, 
-00041820: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-00041830: 2222 0a20 2020 204d 616b 6520 6066 696c  "".    Make `fil
-00041840: 6c5f 6265 7477 6565 6e60 2077 6f72 6b20  l_between` work 
-00041850: 6c69 6b65 206c 696e 6573 7479 6c65 3d27  like linestyle='
-00041860: 7374 6570 732d 6d69 6427 2e0a 2020 2020  steps-mid'..    
-00041870: 2222 220a 2020 2020 696d 706f 7274 206d  """.    import m
-00041880: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
-00041890: 2061 7320 706c 740a 2020 2020 0a20 2020   as plt.    .   
-000418a0: 2073 6f20 3d20 6e70 2e61 7267 736f 7274   so = np.argsort
-000418b0: 2878 290a 2020 2020 6478 203d 206e 702e  (x).    dx = np.
-000418c0: 6469 6666 2878 5b73 6f5d 292f 322e 0a20  diff(x[so])/2.. 
-000418d0: 2020 206d 6964 203d 2078 5b73 6f5d 5b3a     mid = x[so][:
-000418e0: 2d31 5d20 2b20 6478 0a20 2020 200a 2020  -1] + dx.    .  
-000418f0: 2020 7866 756c 6c20 3d20 6e70 2e68 7374    xfull = np.hst
-00041900: 6163 6b28 5b78 5b73 6f5d 5b30 5d2d 6478  ack([x[so][0]-dx
-00041910: 5b30 5d2c 206d 6964 2c20 6d69 642b 6478  [0], mid, mid+dx
-00041920: 2a32 2f31 2e65 362c 2078 5b73 6f5d 5b2d  *2/1.e6, x[so][-
-00041930: 315d 2b64 785b 2d31 5d5d 290a 2020 2020  1]+dx[-1]]).    
-00041940: 7930 6675 6c6c 203d 206e 702e 6873 7461  y0full = np.hsta
-00041950: 636b 285b 7930 5b30 5d2c 2079 305b 3a2d  ck([y0[0], y0[:-
-00041960: 315d 2c20 7930 5b31 3a5d 2c20 7930 5b2d  1], y0[1:], y0[-
-00041970: 315d 5d29 0a20 2020 2079 3166 756c 6c20  1]]).    y1full 
-00041980: 3d20 6e70 2e68 7374 6163 6b28 5b79 315b  = np.hstack([y1[
-00041990: 305d 2c20 7931 5b3a 2d31 5d2c 2079 315b  0], y1[:-1], y1[
-000419a0: 313a 5d2c 2079 315b 2d31 5d5d 290a 2020  1:], y1[-1]]).  
-000419b0: 2020 0a20 2020 2023 2078 6675 6c6c 203d    .    # xfull =
-000419c0: 206e 702e 6170 7065 6e64 286e 702e 6170   np.append(np.ap
-000419d0: 7065 6e64 2878 2c20 6d69 6429 2c20 6d69  pend(x, mid), mi
-000419e0: 642b 6e70 2e64 6966 6628 785b 736f 5d29  d+np.diff(x[so])
-000419f0: 2f31 2e65 3629 0a20 2020 2023 2079 3066  /1.e6).    # y0f
-00041a00: 756c 6c20 3d20 6e70 2e61 7070 656e 6428  ull = np.append(
-00041a10: 6e70 2e61 7070 656e 6428 7930 2c20 7930  np.append(y0, y0
-00041a20: 5b3a 2d31 5d29 2c20 7930 5b31 3a5d 290a  [:-1]), y0[1:]).
-00041a30: 2020 2020 2320 7931 6675 6c6c 203d 206e      # y1full = n
-00041a40: 702e 6170 7065 6e64 286e 702e 6170 7065  p.append(np.appe
-00041a50: 6e64 2879 312c 2079 315b 3a2d 315d 292c  nd(y1, y1[:-1]),
-00041a60: 2079 315b 313a 5d29 0a0a 2020 2020 736f   y1[1:])..    so
-00041a70: 203d 206e 702e 6172 6773 6f72 7428 7866   = np.argsort(xf
-00041a80: 756c 6c29 0a20 2020 2069 6620 6178 2069  ull).    if ax i
-00041a90: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00041aa0: 6178 203d 2070 6c74 2e67 6361 2829 0a0a  ax = plt.gca()..
-00041ab0: 2020 2020 6178 2e66 696c 6c5f 6265 7477      ax.fill_betw
-00041ac0: 6565 6e28 7866 756c 6c5b 736f 5d2c 2079  een(xfull[so], y
-00041ad0: 3066 756c 6c5b 736f 5d2c 2079 3166 756c  0full[so], y1ful
-00041ae0: 6c5b 736f 5d2c 202a 6172 6773 2c20 2a2a  l[so], *args, **
-00041af0: 6b77 6172 6773 290a 0a0a 6465 6620 6669  kwargs)...def fi
-00041b00: 6c6c 5f6d 6173 6b65 645f 636f 7661 7228  ll_masked_covar(
-00041b10: 636f 7661 722c 206d 6173 6b29 3a0a 2020  covar, mask):.  
-00041b20: 2020 2222 2246 696c 6c20 6120 636f 7661    """Fill a cova
-00041b30: 7269 616e 6365 206d 6174 7269 7820 696e  riance matrix in
-00041b40: 2061 206c 6172 6765 7220 6172 7261 7920   a larger array 
-00041b50: 7468 6174 2068 6164 206d 6173 6b65 6420  that had masked 
-00041b60: 7661 6c75 6573 0a0a 2020 2020 5061 7261  values..    Para
-00041b70: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-00041b80: 2d2d 2d2d 2d0a 2020 2020 636f 7661 7220  -----.    covar 
-00041b90: 3a20 6028 4d2c 4d29 6020 7371 7561 7265  : `(M,M)` square
-00041ba0: 2060 7e6e 702e 6e64 6172 7261 7960 0a20   `~np.ndarray`. 
-00041bb0: 2020 2020 2020 204d 6173 6b65 6420 636f         Masked co
-00041bc0: 7661 7269 616e 6365 2061 7272 6179 2e0a  variance array..
-00041bd0: 0a20 2020 206d 6173 6b20 3a20 626f 6f6c  .    mask : bool
-00041be0: 206d 6173 6b2c 2060 4e3e 4d60 0a20 2020   mask, `N>M`.   
-00041bf0: 2020 2020 2054 6865 206f 7269 6769 6e61       The origina
-00041c00: 6c20 6d61 736b 2e0a 0a20 2020 2052 6574  l mask...    Ret
-00041c10: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00041c20: 0a20 2020 2063 6f76 6172 5f66 756c 6c20  .    covar_full 
-00041c30: 3a20 607e 6e70 2e6e 6461 7272 6179 600a  : `~np.ndarray`.
-00041c40: 2020 2020 2020 2020 4675 6c6c 2063 6f76          Full cov
-00041c50: 6172 6961 6e63 6520 6172 7261 7920 7769  ariance array wi
-00041c60: 7468 2064 696d 656e 7369 6f6e 7320 6028  th dimensions `(
-00041c70: 4e2c 4e29 602e 0a0a 2020 2020 2222 220a  N,N)`...    """.
-00041c80: 2020 2020 4e20 3d20 6d61 736b 2e73 6861      N = mask.sha
-00041c90: 7065 5b30 5d0a 2020 2020 6964 7820 3d20  pe[0].    idx = 
-00041ca0: 6e70 2e61 7261 6e67 6528 4e29 5b6d 6173  np.arange(N)[mas
-00041cb0: 6b5d 0a20 2020 2063 6f76 6172 5f66 756c  k].    covar_ful
-00041cc0: 6c20 3d20 6e70 2e7a 6572 6f73 2828 4e2c  l = np.zeros((N,
-00041cd0: 204e 292c 2064 7479 7065 3d63 6f76 6172   N), dtype=covar
-00041ce0: 2e64 7479 7065 290a 2020 2020 666f 7220  .dtype).    for 
-00041cf0: 692c 2069 6920 696e 2065 6e75 6d65 7261  i, ii in enumera
-00041d00: 7465 2869 6478 293a 0a20 2020 2020 2020  te(idx):.       
-00041d10: 2066 6f72 206a 2c20 6a6a 2069 6e20 656e   for j, jj in en
-00041d20: 756d 6572 6174 6528 6964 7829 3a0a 2020  umerate(idx):.  
-00041d30: 2020 2020 2020 2020 2020 636f 7661 725f            covar_
-00041d40: 6675 6c6c 5b69 692c 206a 6a5d 203d 2063  full[ii, jj] = c
-00041d50: 6f76 6172 5b69 2c20 6a5d 0a0a 2020 2020  ovar[i, j]..    
-00041d60: 7265 7475 726e 2063 6f76 6172 5f66 756c  return covar_ful
-00041d70: 6c0a 0a0a 6465 6620 6c6f 675f 7363 616c  l...def log_scal
-00041d80: 655f 6473 3928 696d 2c20 6c65 7870 3d31  e_ds9(im, lexp=1
-00041d90: 2e65 3132 2c20 636d 6170 3d5b 372e 3937  .e12, cmap=[7.97
-00041da0: 3931 372c 2030 2e38 3738 3034 3933 5d2c  917, 0.8780493],
-00041db0: 2073 6361 6c65 3d5b 2d30 2e31 2c20 3130   scale=[-0.1, 10
-00041dc0: 5d29 3a0a 2020 2020 2222 220a 2020 2020  ]):.    """.    
-00041dd0: 5363 616c 6520 616e 2061 7272 6179 206c  Scale an array l
-00041de0: 696b 6520 6473 3920 6c6f 6720 7363 616c  ike ds9 log scal
-00041df0: 696e 670a 2020 2020 2222 220a 2020 2020  ing.    """.    
-00041e00: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-00041e10: 6e70 0a0a 2020 2020 636f 6e74 7261 7374  np..    contrast
-00041e20: 2c20 6269 6173 203d 2063 6d61 700a 2020  , bias = cmap.  
-00041e30: 2020 636c 6970 203d 2028 6e70 2e63 6c69    clip = (np.cli
-00041e40: 7028 696d 2c20 7363 616c 655b 305d 2c20  p(im, scale[0], 
-00041e50: 7363 616c 655b 315d 292d 7363 616c 655b  scale[1])-scale[
-00041e60: 305d 292f 2873 6361 6c65 5b31 5d2d 7363  0])/(scale[1]-sc
-00041e70: 616c 655b 305d 290a 2020 2020 636c 6970  ale[0]).    clip
-00041e80: 5f6c 6f67 203d 206e 702e 636c 6970 2828  _log = np.clip((
-00041e90: 6e70 2e6c 6f67 3130 286c 6578 702a 636c  np.log10(lexp*cl
-00041ea0: 6970 2b31 292f 6e70 2e6c 6f67 3130 286c  ip+1)/np.log10(l
-00041eb0: 6578 7029 2d62 6961 7329 2a63 6f6e 7472  exp)-bias)*contr
-00041ec0: 6173 742b 302e 352c 2030 2c20 3129 0a0a  ast+0.5, 0, 1)..
-00041ed0: 2020 2020 7265 7475 726e 2063 6c69 705f      return clip_
-00041ee0: 6c6f 670a 0a0a 6465 6620 6d6f 6465 5f73  log...def mode_s
-00041ef0: 7461 7469 7374 6963 2864 6174 612c 2070  tatistic(data, p
-00041f00: 6572 6365 6e74 696c 6573 3d72 616e 6765  ercentiles=range
-00041f10: 2831 302c 2039 312c 2031 3029 293a 0a20  (10, 91, 10)):. 
-00041f20: 2020 2022 2222 0a20 2020 2047 6574 206d     """.    Get m
-00041f30: 6f64 616c 2076 616c 7565 206f 6620 6120  odal value of a 
-00041f40: 6469 7374 7269 6275 7469 6f6e 206f 6620  distribution of 
-00041f50: 6461 7461 2066 6f6c 6c6f 7769 6e67 2043  data following C
-00041f60: 6f6e 6e6f 7220 6574 2061 6c2e 2032 3031  onnor et al. 201
-00041f70: 370a 2020 2020 6874 7470 733a 2f2f 6172  7.    https://ar
-00041f80: 7869 762e 6f72 672f 7064 662f 3137 3039  xiv.org/pdf/1709
-00041f90: 2e30 3139 3235 2e70 6466 0a0a 2020 2020  .01925.pdf..    
-00041fa0: 4865 7265 2077 6520 6669 7420 6120 7370  Here we fit a sp
-00041fb0: 6c69 6e65 2074 6f20 7468 6520 6375 6d75  line to the cumu
-00041fc0: 6c61 7469 7665 2064 6973 7472 6962 7574  lative distribut
-00041fd0: 696f 6e20 6576 616c 7561 7465 6420 6174  ion evaluated at
-00041fe0: 206b 6e6f 7473 0a20 2020 2073 6574 2074   knots.    set t
-00041ff0: 6f20 7468 6520 6070 6572 6365 6e74 696c  o the `percentil
-00042000: 6573 6020 6f66 2074 6865 2064 6973 7472  es` of the distr
-00042010: 6962 7574 696f 6e20 746f 2069 6d70 726f  ibution to impro
-00042020: 7665 2073 6d6f 6f74 686e 6573 732e 0a20  ve smoothness.. 
-00042030: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
-00042040: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
-00042050: 6520 696d 706f 7274 2055 6e69 7661 7269  e import Univari
-00042060: 6174 6553 706c 696e 652c 204c 5351 556e  ateSpline, LSQUn
-00042070: 6976 6172 6961 7465 5370 6c69 6e65 0a0a  ivariateSpline..
-00042080: 2020 2020 736f 203d 206e 702e 6172 6773      so = np.args
-00042090: 6f72 7428 6461 7461 290a 2020 2020 6f72  ort(data).    or
-000420a0: 6465 7220 3d20 6e70 2e61 7261 6e67 6528  der = np.arange(
-000420b0: 6c65 6e28 6461 7461 2929 0a20 2020 2023  len(data)).    #
-000420c0: 7370 6c20 3d20 556e 6976 6172 6961 7465  spl = Univariate
-000420d0: 5370 6c69 6e65 2864 6174 615b 736f 5d2c  Spline(data[so],
-000420e0: 206f 7264 6572 290a 0a20 2020 206b 6e6f   order)..    kno
-000420f0: 7473 203d 206e 702e 7065 7263 656e 7469  ts = np.percenti
-00042100: 6c65 2864 6174 612c 2070 6572 6365 6e74  le(data, percent
-00042110: 696c 6573 290a 2020 2020 6478 203d 206e  iles).    dx = n
-00042120: 702e 6469 6666 286b 6e6f 7473 290a 2020  p.diff(knots).  
-00042130: 2020 6d61 736b 203d 2028 6461 7461 5b73    mask = (data[s
-00042140: 6f5d 203e 3d20 6b6e 6f74 735b 305d 2d64  o] >= knots[0]-d
-00042150: 785b 305d 2920 2620 2864 6174 615b 736f  x[0]) & (data[so
-00042160: 5d20 3c3d 206b 6e6f 7473 5b2d 315d 2b64  ] <= knots[-1]+d
-00042170: 785b 2d31 5d29 0a20 2020 2073 706c 203d  x[-1]).    spl =
-00042180: 204c 5351 556e 6976 6172 6961 7465 5370   LSQUnivariateSp
-00042190: 6c69 6e65 2864 6174 615b 736f 5d5b 6d61  line(data[so][ma
-000421a0: 736b 5d2c 206f 7264 6572 5b6d 6173 6b5d  sk], order[mask]
-000421b0: 2c20 6b6e 6f74 732c 2065 7874 3d27 7a65  , knots, ext='ze
-000421c0: 726f 7327 290a 0a20 2020 206d 6173 6b20  ros')..    mask 
-000421d0: 3d20 2864 6174 615b 736f 5d20 3e3d 206b  = (data[so] >= k
-000421e0: 6e6f 7473 5b30 5d29 2026 2028 6461 7461  nots[0]) & (data
-000421f0: 5b73 6f5d 203c 3d20 6b6e 6f74 735b 2d31  [so] <= knots[-1
-00042200: 5d29 0a20 2020 2069 7820 3d20 2873 706c  ]).    ix = (spl
-00042210: 2864 6174 615b 736f 5d2c 206e 753d 312c  (data[so], nu=1,
-00042220: 2065 7874 3d27 7a65 726f 7327 292a 6d61   ext='zeros')*ma
-00042230: 736b 292e 6172 676d 6178 2829 0a20 2020  sk).argmax().   
-00042240: 206d 6f64 6520 3d20 6461 7461 5b73 6f5d   mode = data[so]
-00042250: 5b69 785d 0a20 2020 2072 6574 7572 6e20  [ix].    return 
-00042260: 6d6f 6465 0a0a 0a64 6566 206d 616b 655f  mode...def make_
-00042270: 616c 665f 7465 6d70 6c61 7465 2829 3a0a  alf_template():.
-00042280: 2020 2020 2222 220a 2020 2020 4d61 6b65      """.    Make
-00042290: 2041 6c66 202b 2046 5350 5320 7465 6d70   Alf + FSPS temp
-000422a0: 6c61 7465 0a20 2020 2022 2222 0a20 2020  late.    """.   
-000422b0: 2069 6d70 6f72 7420 616c 662e 616c 660a   import alf.alf.
-000422c0: 2020 2020 696d 706f 7274 2066 7370 730a      import fsps.
-000422d0: 0a20 2020 2073 7370 203d 2061 6c66 2e61  .    ssp = alf.a
-000422e0: 6c66 2e41 6c66 2829 0a0a 2020 2020 7370  lf.Alf()..    sp
-000422f0: 203d 2066 7370 732e 5374 656c 6c61 7250   = fsps.StellarP
-00042300: 6f70 756c 6174 696f 6e28 7a63 6f6e 7469  opulation(zconti
-00042310: 6e75 6f75 733d 3129 0a20 2020 2073 702e  nuous=1).    sp.
-00042320: 7061 7261 6d73 5b27 6c6f 677a 736f 6c27  params['logzsol'
-00042330: 5d20 3d20 302e 320a 0a20 2020 2023 2041  ] = 0.2..    # A
-00042340: 6c66 0a20 2020 206d 203d 2073 7370 2e67  lf.    m = ssp.g
-00042350: 6574 5f6d 6f64 656c 2869 6e5f 706c 6163  et_model(in_plac
-00042360: 653d 4661 6c73 652c 206c 6f67 6167 653d  e=False, logage=
-00042370: 302e 3936 2c20 7a68 3d30 2e32 2c20 6d67  0.96, zh=0.2, mg
-00042380: 683d 302e 3229 0a0a 2020 2020 2320 4653  h=0.2)..    # FS
-00042390: 5053 0a20 2020 2077 2c20 7370 6563 203d  PS.    w, spec =
-000423a0: 2073 702e 6765 745f 7370 6563 7472 756d   sp.get_spectrum
-000423b0: 2874 6167 653d 3130 2a2a 302e 3936 2c20  (tage=10**0.96, 
-000423c0: 7065 7261 613d 5472 7565 290a 0a20 2020  peraa=True)..   
-000423d0: 2023 2062 6c75 650a 2020 2020 626c 7565   # blue.    blue
-000423e0: 5f6e 6f72 6d20 3d20 7370 6563 5b77 203e  _norm = spec[w >
-000423f0: 2033 3630 305d 5b30 5d20 2f20 6d5b 7373   3600][0] / m[ss
-00042400: 702e 7761 7665 203e 2033 3630 305d 5b30  p.wave > 3600][0
-00042410: 5d0a 2020 2020 7265 645f 6e6f 726d 203d  ].    red_norm =
-00042420: 2073 7065 635b 7720 3e20 312e 3765 345d   spec[w > 1.7e4]
-00042430: 5b30 5d20 2f20 6d5b 7373 702e 7761 7665  [0] / m[ssp.wave
-00042440: 203e 2031 2e37 6534 5d5b 305d 0a0a 2020   > 1.7e4][0]..  
-00042450: 2020 7465 6d70 6c78 203d 206e 702e 6873    templx = np.hs
-00042460: 7461 636b 285b 775b 7720 3c20 3336 3030  tack([w[w < 3600
-00042470: 5d2c 2073 7370 2e77 6176 655b 2873 7370  ], ssp.wave[(ssp
-00042480: 2e77 6176 6520 3e20 3336 3030 2920 2620  .wave > 3600) & 
-00042490: 2873 7370 2e77 6176 6520 3c20 312e 3765  (ssp.wave < 1.7e
-000424a0: 3429 5d2c 2077 5b77 203e 2031 2e37 6534  4)], w[w > 1.7e4
-000424b0: 5d5d 290a 2020 2020 7465 6d70 6c79 203d  ]]).    temply =
-000424c0: 206e 702e 6873 7461 636b 285b 7370 6563   np.hstack([spec
-000424d0: 5b77 203c 2033 3630 305d 2f62 6c75 655f  [w < 3600]/blue_
-000424e0: 6e6f 726d 2c20 6d5b 2873 7370 2e77 6176  norm, m[(ssp.wav
-000424f0: 6520 3e20 3336 3030 2920 2620 2873 7370  e > 3600) & (ssp
-00042500: 2e77 6176 6520 3c20 312e 3765 3429 5d2c  .wave < 1.7e4)],
-00042510: 2073 7065 635b 7720 3e20 312e 3765 345d   spec[w > 1.7e4]
-00042520: 2f72 6564 5f6e 6f72 6d5d 290a 0a20 2020  /red_norm])..   
-00042530: 206e 702e 7361 7665 7478 7428 2761 6c66   np.savetxt('alf
-00042540: 5f53 5350 2e64 6174 272c 206e 702e 6172  _SSP.dat', np.ar
-00042550: 7261 7928 5b74 656d 706c 782c 2074 656d  ray([templx, tem
-00042560: 706c 795d 292e 542c 2066 6d74 3d27 252e  ply]).T, fmt='%.
-00042570: 3565 272c 2068 6561 6465 723d 2777 6176  5e', header='wav
-00042580: 6520 666c 7578 5c6e 6c6f 6761 6765 203d  e flux\nlogage =
-00042590: 2030 2e39 365c 6e7a 683d 302e 325c 6e6d   0.96\nzh=0.2\nm
-000425a0: 6768 3d30 2e32 5c6e 6673 7073 3a20 7720  gh=0.2\nfsps: w 
-000425b0: 3c20 3336 3030 2c20 7720 3e20 312e 3765  < 3600, w > 1.7e
-000425c0: 3427 290a 0a0a 6465 6620 6361 7461 6c6f  4')...def catalo
-000425d0: 675f 6172 6561 2872 613d 5b5d 2c20 6465  g_area(ra=[], de
-000425e0: 633d 5b5d 2c20 6d61 6b65 5f70 6c6f 743d  c=[], make_plot=
-000425f0: 5472 7565 2c20 4e4d 4158 3d35 3030 302c  True, NMAX=5000,
-00042600: 2062 7566 663d 302e 382c 2076 6572 626f   buff=0.8, verbo
-00042610: 7365 3d54 7275 6529 3a0a 2020 2020 2222  se=True):.    ""
-00042620: 2243 6f6d 7075 7465 2074 6865 2073 7572  "Compute the sur
-00042630: 6661 6365 2061 7265 6120 6f66 2061 206c  face area of a l
-00042640: 6973 7420 6f66 2052 412f 4445 4320 636f  ist of RA/DEC co
-00042650: 6f72 6469 6e61 7465 730a 0a20 2020 2050  ordinates..    P
-00042660: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00042670: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2072 612c  --------.    ra,
-00042680: 2064 6563 203a 2060 7e6e 756d 7079 2e6e   dec : `~numpy.n
-00042690: 6461 7272 6179 600a 2020 2020 2020 2020  darray`.        
-000426a0: 5241 2061 6e64 2044 6563 2e20 636f 6f72  RA and Dec. coor
-000426b0: 6469 6e61 7465 7320 696e 2064 6563 696d  dinates in decim
-000426c0: 616c 2064 6567 7265 6573 0a0a 2020 2020  al degrees..    
-000426d0: 6d61 6b65 5f70 6c6f 7420 3a20 626f 6f6c  make_plot : bool
-000426e0: 0a20 2020 2020 2020 204d 616b 6520 6120  .        Make a 
-000426f0: 6669 6775 7265 2e0a 0a20 2020 204e 4d41  figure...    NMA
-00042700: 5820 3a20 696e 740a 2020 2020 2020 2020  X : int.        
-00042710: 4966 2074 6865 2063 6174 616c 6f67 2068  If the catalog h
-00042720: 6173 206d 6f72 6520 7468 656e 2060 4e4d  as more then `NM
-00042730: 4158 6020 656e 7472 6965 732c 2064 7261  AX` entries, dra
-00042740: 7720 604e 4d41 5860 2072 616e 646f 6d0a  w `NMAX` random.
-00042750: 2020 2020 2020 2020 7361 6d70 6c65 732e          samples.
-00042760: 0a0a 2020 2020 6275 6666 203a 2066 6c6f  ..    buff : flo
-00042770: 6174 0a20 2020 2020 2020 2042 7566 6665  at.        Buffe
-00042780: 7220 696e 2061 7263 6d69 6e20 746f 2061  r in arcmin to a
-00042790: 6464 2061 726f 756e 6420 6561 6368 2063  dd around each c
-000427a0: 6174 616c 6f67 2070 6f69 6e74 2e0a 0a0a  atalog point....
-000427b0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000427c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6172 6561  -------.    area
-000427d0: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
-000427e0: 2043 6f6d 7075 7465 6420 6361 7461 6c6f   Computed catalo
-000427f0: 6720 6172 6561 2069 6e20 7371 7561 7265  g area in square
-00042800: 2061 7263 6d69 6e75 7465 730a 0a20 2020   arcminutes..   
-00042810: 2066 6967 203a 2060 7e6d 6174 706c 6f74   fig : `~matplot
-00042820: 6c69 622e 6669 6775 7265 2e46 6967 7572  lib.figure.Figur
-00042830: 6560 0a20 2020 2020 2020 2046 6967 7572  e`.        Figur
-00042840: 6520 6f62 6a65 6374 2072 6574 7572 6e65  e object returne
-00042850: 6420 6966 2060 6d61 6b65 5f70 6c6f 743d  d if `make_plot=
-00042860: 3d54 7275 6560 2e0a 0a20 2020 2022 2222  =True`...    """
-00042870: 0a20 2020 2069 6d70 6f72 7420 6d61 7470  .    import matp
-00042880: 6c6f 746c 6962 2e70 7970 6c6f 7420 6173  lotlib.pyplot as
-00042890: 2070 6c74 0a20 2020 2066 726f 6d20 7368   plt.    from sh
-000428a0: 6170 656c 792e 6765 6f6d 6574 7279 2069  apely.geometry i
-000428b0: 6d70 6f72 7420 506f 6c79 676f 6e2c 2050  mport Polygon, P
-000428c0: 6f69 6e74 2c20 4d75 6c74 6950 6f6c 7967  oint, MultiPolyg
-000428d0: 6f6e 2c20 4d75 6c74 694c 696e 6553 7472  on, MultiLineStr
-000428e0: 696e 670a 2020 2020 6672 6f6d 2073 6369  ing.    from sci
-000428f0: 7079 2069 6d70 6f72 7420 7370 6174 6961  py import spatia
-00042900: 6c0a 0a20 2020 2070 6f69 6e74 7320 3d20  l..    points = 
-00042910: 6e70 2e61 7272 6179 285b 7261 2c20 6465  np.array([ra, de
-00042920: 635d 292a 312e 0a20 2020 2063 656e 7465  c])*1..    cente
-00042930: 7220 3d20 6e70 2e6d 6561 6e28 706f 696e  r = np.mean(poin
-00042940: 7473 2c20 6178 6973 3d31 290a 2020 2020  ts, axis=1).    
-00042950: 706f 696e 7473 203d 2028 706f 696e 7473  points = (points
-00042960: 2e54 202d 2063 656e 7465 7229 2a36 302e  .T - center)*60.
-00042970: 2020 2320 6172 636d 696e 0a20 2020 2070    # arcmin.    p
-00042980: 6f69 6e74 735b 3a2c 2030 5d20 2a3d 206e  oints[:, 0] *= n
-00042990: 702e 636f 7328 6365 6e74 6572 5b31 5d2f  p.cos(center[1]/
-000429a0: 3138 302a 6e70 2e70 6929 0a0a 2020 2020  180*np.pi)..    
-000429b0: 6875 6c6c 203d 2073 7061 7469 616c 2e43  hull = spatial.C
-000429c0: 6f6e 7665 7848 756c 6c28 706f 696e 7473  onvexHull(points
-000429d0: 290a 2020 2020 6564 6765 203d 2070 6f69  ).    edge = poi
-000429e0: 6e74 735b 6875 6c6c 2e76 6572 7469 6365  nts[hull.vertice
-000429f0: 732c 203a 5d0a 0a20 2020 2023 7062 7566  s, :]..    #pbuf
-00042a00: 6620 3d20 310a 0a20 2020 2069 6620 6c65  f = 1..    if le
-00042a10: 6e28 7261 2920 3e20 4e4d 4158 3a0a 2020  n(ra) > NMAX:.  
-00042a20: 2020 2020 2020 726e 645f 6964 7820 3d20        rnd_idx = 
-00042a30: 6e70 2e75 6e69 7175 6528 6e70 2e63 6173  np.unique(np.cas
-00042a40: 745b 696e 745d 286e 702e 726f 756e 6428  t[int](np.round(
-00042a50: 6e70 2e72 616e 646f 6d2e 7261 6e64 284e  np.random.rand(N
-00042a60: 4d41 5829 2a6c 656e 2872 6129 2929 290a  MAX)*len(ra)))).
-00042a70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00042a80: 2020 726e 645f 6964 7820 3d20 6e70 2e61    rnd_idx = np.a
-00042a90: 7261 6e67 6528 6c65 6e28 7261 2929 0a0a  range(len(ra))..
-00042aa0: 2020 2020 706f 6c79 203d 2050 6f69 6e74      poly = Point
-00042ab0: 2870 6f69 6e74 735b 726e 645f 6964 785b  (points[rnd_idx[
-00042ac0: 305d 2c20 3a5d 292e 6275 6666 6572 2862  0], :]).buffer(b
-00042ad0: 7566 6629 0a20 2020 2066 6f72 2069 2c20  uff).    for i, 
-00042ae0: 6978 2069 6e20 656e 756d 6572 6174 6528  ix in enumerate(
-00042af0: 726e 645f 6964 7829 3a0a 2020 2020 2020  rnd_idx):.      
-00042b00: 2020 6966 2076 6572 626f 7365 3a0a 2020    if verbose:.  
-00042b10: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00042b20: 4e4f 5f4e 4557 4c49 4e45 202b 2027 7b30  NO_NEWLINE + '{0
-00042b30: 7d20 7b31 7d27 2e66 6f72 6d61 7428 692c  } {1}'.format(i,
-00042b40: 2069 7829 290a 0a20 2020 2020 2020 2070   ix))..        p
-00042b50: 6f6c 7920 3d20 706f 6c79 2e75 6e69 6f6e  oly = poly.union
-00042b60: 2850 6f69 6e74 2870 6f69 6e74 735b 6978  (Point(points[ix
-00042b70: 2c20 3a5d 292e 6275 6666 6572 2862 7566  , :]).buffer(buf
-00042b80: 6629 290a 0a20 2020 2023 2046 696e 616c  f))..    # Final
-00042b90: 2028 6d75 6c74 6929 506f 6c79 676f 6e0a   (multi)Polygon.
-00042ba0: 2020 2020 706a 6f69 6e20 3d20 706f 6c79      pjoin = poly
-00042bb0: 2e62 7566 6665 7228 2d62 7566 6629 0a0a  .buffer(-buff)..
-00042bc0: 2020 2020 6966 206d 616b 655f 706c 6f74      if make_plot
-00042bd0: 3a0a 0a20 2020 2020 2020 2066 6967 203d  :..        fig =
-00042be0: 2070 6c74 2e66 6967 7572 6528 290a 2020   plt.figure().  
-00042bf0: 2020 2020 2020 6178 203d 2066 6967 2e61        ax = fig.a
-00042c00: 6464 5f73 7562 706c 6f74 2831 3131 290a  dd_subplot(111).
-00042c10: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00042c20: 7374 616e 6365 2870 6a6f 696e 2c20 4d75  stance(pjoin, Mu
-00042c30: 6c74 6950 6f6c 7967 6f6e 293a 0a20 2020  ltiPolygon):.   
-00042c40: 2020 2020 2020 2020 2066 6f72 2070 5f69           for p_i
-00042c50: 2069 6e20 706a 6f69 6e3a 0a20 2020 2020   in pjoin:.     
-00042c60: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00042c70: 696e 7374 616e 6365 2870 5f69 2e62 6f75  instance(p_i.bou
-00042c80: 6e64 6172 792c 204d 756c 7469 4c69 6e65  ndary, MultiLine
-00042c90: 5374 7269 6e67 293a 0a20 2020 2020 2020  String):.       
-00042ca0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00042cb0: 2073 2069 6e20 705f 692e 626f 756e 6461   s in p_i.bounda
-00042cc0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00042cd0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-00042ce0: 732e 7879 0a20 2020 2020 2020 2020 2020  s.xy.           
-00042cf0: 2020 2020 2020 2020 2020 2020 2061 782e               ax.
-00042d00: 706c 6f74 2870 5b30 5d2c 2070 5b31 5d29  plot(p[0], p[1])
-00042d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042d20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00042d30: 2020 2020 2020 2020 2020 2070 203d 2070             p = p
-00042d40: 5f69 2e62 6f75 6e64 6172 792e 7879 0a20  _i.boundary.xy. 
-00042d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042d60: 2020 2061 782e 706c 6f74 2870 5b30 5d2c     ax.plot(p[0],
-00042d70: 2070 5b31 5d29 0a20 2020 2020 2020 2065   p[1]).        e
-00042d80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00042d90: 2070 5f69 203d 2070 6a6f 696e 0a20 2020   p_i = pjoin.   
-00042da0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00042db0: 7374 616e 6365 2870 5f69 2e62 6f75 6e64  stance(p_i.bound
-00042dc0: 6172 792c 204d 756c 7469 4c69 6e65 5374  ary, MultiLineSt
-00042dd0: 7269 6e67 293a 0a20 2020 2020 2020 2020  ring):.         
-00042de0: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
-00042df0: 705f 692e 626f 756e 6461 7279 3a0a 2020  p_i.boundary:.  
-00042e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042e10: 2020 7020 3d20 732e 7879 0a20 2020 2020    p = s.xy.     
-00042e20: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00042e30: 782e 706c 6f74 2870 5b30 5d2c 2070 5b31  x.plot(p[0], p[1
-00042e40: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
-00042e50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00042e60: 2020 2020 2070 203d 2070 5f69 2e62 6f75       p = p_i.bou
-00042e70: 6e64 6172 792e 7879 0a20 2020 2020 2020  ndary.xy.       
-00042e80: 2020 2020 2020 2020 2061 782e 706c 6f74           ax.plot
-00042e90: 2870 5b30 5d2c 2070 5b31 5d29 0a0a 2020  (p[0], p[1])..  
-00042ea0: 2020 2020 2020 6178 2e73 6361 7474 6572        ax.scatter
-00042eb0: 2870 6f69 6e74 735b 726e 645f 6964 782c  (points[rnd_idx,
-00042ec0: 2030 5d2c 2070 6f69 6e74 735b 726e 645f   0], points[rnd_
-00042ed0: 6964 782c 2031 5d2c 2061 6c70 6861 3d30  idx, 1], alpha=0
-00042ee0: 2e31 2c20 6d61 726b 6572 3d27 2b27 290a  .1, marker='+').
-00042ef0: 0a20 2020 2020 2020 2061 782e 7365 745f  .        ax.set_
-00042f00: 786c 696d 2861 782e 6765 745f 786c 696d  xlim(ax.get_xlim
-00042f10: 2829 5b3a 3a2d 315d 290a 2020 2020 2020  ()[::-1]).      
-00042f20: 2020 6178 2e73 6574 5f78 6c61 6265 6c28    ax.set_xlabel(
-00042f30: 7227 245c 4465 6c74 6124 5241 2028 7b30  r'$\Delta$RA ({0
-00042f40: 3a2e 3566 7d29 272e 666f 726d 6174 2863  :.5f})'.format(c
-00042f50: 656e 7465 725b 305d 2929 0a20 2020 2020  enter[0])).     
-00042f60: 2020 2061 782e 7365 745f 796c 6162 656c     ax.set_ylabel
-00042f70: 2872 2724 5c44 656c 7461 2444 6563 2e20  (r'$\Delta$Dec. 
-00042f80: 287b 303a 2e35 667d 2927 2e66 6f72 6d61  ({0:.5f})'.forma
-00042f90: 7428 6365 6e74 6572 5b31 5d29 290a 2020  t(center[1])).  
-00042fa0: 2020 2020 2020 6178 2e73 6574 5f74 6974        ax.set_tit
-00042fb0: 6c65 2827 546f 7461 6c20 6172 6561 3a20  le('Total area: 
-00042fc0: 7b30 3a2e 3166 7d20 6172 636d 696e 245e  {0:.1f} arcmin$^
-00042fd0: 3224 272e 666f 726d 6174 2870 6a6f 696e  2$'.format(pjoin
-00042fe0: 2e61 7265 6129 290a 2020 2020 2020 2020  .area)).        
-00042ff0: 6178 2e67 7269 6428 290a 2020 2020 2020  ax.grid().      
-00043000: 2020 6669 672e 7469 6768 745f 6c61 796f    fig.tight_layo
-00043010: 7574 2870 6164 3d30 2e31 290a 0a20 2020  ut(pad=0.1)..   
-00043020: 2020 2020 2072 6574 7572 6e20 706a 6f69       return pjoi
-00043030: 6e2e 6172 6561 2c20 6669 670a 0a20 2020  n.area, fig..   
-00043040: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-00043050: 6574 7572 6e20 706a 6f69 6e2e 6172 6561  eturn pjoin.area
-00043060: 0a0a 0a64 6566 2066 6978 5f66 6c74 5f6e  ...def fix_flt_n
-00043070: 616e 2866 6c74 5f66 696c 652c 2062 6164  an(flt_file, bad
-00043080: 5f62 6974 3d34 3039 362c 2076 6572 626f  _bit=4096, verbo
-00043090: 7365 3d54 7275 6529 3a0a 2020 2020 2222  se=True):.    ""
-000430a0: 220a 2020 2020 4669 7820 4e61 4e20 7661  ".    Fix NaN va
-000430b0: 6c75 6573 2069 6e20 464c 5420 6669 6c65  lues in FLT file
-000430c0: 730a 2020 2020 2222 220a 2020 2020 696d  s.    """.    im
-000430d0: 203d 2070 7966 6974 732e 6f70 656e 2866   = pyfits.open(f
-000430e0: 6c74 5f66 696c 652c 206d 6f64 653d 2775  lt_file, mode='u
-000430f0: 7064 6174 6527 290a 2020 2020 666f 7220  pdate').    for 
-00043100: 6578 7420 696e 2072 616e 6765 2831 2c20  ext in range(1, 
-00043110: 3529 3a0a 2020 2020 2020 2020 6966 2028  5):.        if (
-00043120: 2753 4349 272c 2065 7874 2920 696e 2069  'SCI', ext) in i
-00043130: 6d3a 0a20 2020 2020 2020 2020 2020 206d  m:.            m
-00043140: 6173 6b20 3d20 7e6e 702e 6973 6669 6e69  ask = ~np.isfini
-00043150: 7465 2869 6d5b 2753 4349 272c 2065 7874  te(im['SCI', ext
-00043160: 5d2e 6461 7461 290a 2020 2020 2020 2020  ].data).        
-00043170: 2020 2020 6966 2076 6572 626f 7365 3a0a      if verbose:.
-00043180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043190: 6c61 6265 6c20 3d20 2775 7469 6c73 2e66  label = 'utils.f
-000431a0: 6978 5f66 6c74 5f6e 616e 3a20 7b30 7d5b  ix_flt_nan: {0}[
-000431b0: 5343 492c 7b31 7d5d 204e 614e 5069 7865  SCI,{1}] NaNPixe
-000431c0: 6c73 3d7b 327d 270a 2020 2020 2020 2020  ls={2}'.        
-000431d0: 2020 2020 2020 2020 7072 696e 7428 6c61          print(la
-000431e0: 6265 6c2e 666f 726d 6174 2866 6c74 5f66  bel.format(flt_f
-000431f0: 696c 652c 2065 7874 2c20 6d61 736b 2e73  ile, ext, mask.s
-00043200: 756d 2829 2929 0a0a 2020 2020 2020 2020  um()))..        
-00043210: 2020 2020 6966 206d 6173 6b2e 7375 6d28      if mask.sum(
-00043220: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00043230: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00043240: 0a0a 2020 2020 2020 2020 2020 2020 696d  ..            im
-00043250: 5b27 5343 4927 2c20 6578 745d 2e64 6174  ['SCI', ext].dat
-00043260: 615b 6d61 736b 5d20 3d20 300a 2020 2020  a[mask] = 0.    
-00043270: 2020 2020 2020 2020 696d 5b27 4451 272c          im['DQ',
-00043280: 2065 7874 5d2e 6461 7461 5b6d 6173 6b5d   ext].data[mask]
-00043290: 207c 3d20 6261 645f 6269 740a 0a20 2020   |= bad_bit..   
-000432a0: 2069 6d2e 666c 7573 6828 290a 2020 2020   im.flush().    
-000432b0: 696d 2e63 6c6f 7365 2829 0a0a 0a64 6566  im.close()...def
-000432c0: 2064 756d 705f 666c 745f 6471 2866 696c   dump_flt_dq(fil
-000432d0: 656e 616d 652c 2072 6570 6c61 6365 3d28  ename, replace=(
-000432e0: 272e 6669 7473 272c 2027 2e64 712e 6669  '.fits', '.dq.fi
-000432f0: 7473 2e67 7a27 292c 2076 6572 626f 7365  ts.gz'), verbose
-00043300: 3d54 7275 6529 3a0a 2020 2020 2222 2244  =True):.    """D
-00043310: 756d 7020 464c 542f 464c 4320 6865 6164  ump FLT/FLC head
-00043320: 6572 2026 2044 5120 6578 7465 6e73 696f  er & DQ extensio
-00043330: 6e73 2074 6f20 6120 636f 6d70 6163 7420  ns to a compact 
-00043340: 6669 6c65 0a0a 2020 2020 5061 7261 6d65  file..    Parame
-00043350: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00043360: 2d2d 2d0a 2020 2020 6669 6c65 6e61 6d65  ---.    filename
-00043370: 203a 2073 7472 0a20 2020 2020 2020 2046   : str.        F
-00043380: 4c54 2f46 4c43 2066 696c 656e 616d 652e  LT/FLC filename.
-00043390: 0a0a 2020 2020 7265 706c 6163 6520 3a20  ..    replace : 
-000433a0: 2873 7472 2c20 7374 7229 0a20 2020 2020  (str, str).     
-000433b0: 2020 2052 6570 6c61 6365 2061 7267 756d     Replace argum
-000433c0: 656e 7473 2066 6f72 206f 7574 7075 7420  ents for output 
-000433d0: 6669 6c65 6e61 6d65 3a0a 0a20 2020 2020  filename:..     
-000433e0: 2020 203e 3e3e 206f 7574 7075 745f 6669     >>> output_fi
-000433f0: 6c65 6e61 6d65 203d 2066 696c 656e 616d  lename = filenam
-00043400: 652e 7265 706c 6163 6528 7265 706c 6163  e.replace(replac
-00043410: 655b 305d 2c20 7265 706c 6163 655b 315d  e[0], replace[1]
-00043420: 290a 0a20 2020 2052 6574 7572 6e73 0a20  )..    Returns. 
-00043430: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2057     -------.    W
-00043440: 7269 7465 7320 6865 6164 6572 2061 6e64  rites header and
-00043450: 2063 6f6d 7061 6374 2044 5120 6172 7261   compact DQ arra
-00043460: 7920 746f 2060 6f75 7470 7574 5f66 696c  y to `output_fil
-00043470: 656e 616d 6560 2e0a 0a20 2020 2022 2222  ename`...    """
-00043480: 0a20 2020 2069 6d20 3d20 7079 6669 7473  .    im = pyfits
-00043490: 2e6f 7065 6e28 6669 6c65 6e61 6d65 290a  .open(filename).
-000434a0: 2020 2020 6864 7573 203d 205b 5d0a 2020      hdus = [].  
-000434b0: 2020 666f 7220 6920 696e 205b 312c 2032    for i in [1, 2
-000434c0: 2c20 332c 2034 5d3a 0a20 2020 2020 2020  , 3, 4]:.       
-000434d0: 2069 6620 2827 5343 4927 2c20 6929 2069   if ('SCI', i) i
-000434e0: 6e20 696d 3a0a 2020 2020 2020 2020 2020  n im:.          
-000434f0: 2020 6865 6164 6572 203d 2069 6d5b 2753    header = im['S
-00043500: 4349 272c 2069 5d2e 6865 6164 6572 0a20  CI', i].header. 
-00043510: 2020 2020 2020 2020 2020 2064 7120 3d20             dq = 
-00043520: 696d 5b27 4451 272c 2069 5d2e 6461 7461  im['DQ', i].data
-00043530: 0a20 2020 2020 2020 2020 2020 206e 7a20  .            nz 
-00043540: 3d20 6e70 2e77 6865 7265 2864 7120 3e20  = np.where(dq > 
-00043550: 3029 0a20 2020 2020 2020 2020 2020 2064  0).            d
-00043560: 715f 6461 7461 203d 206e 702e 6172 7261  q_data = np.arra
-00043570: 7928 5b6e 7a5b 305d 2c20 6e7a 5b31 5d2c  y([nz[0], nz[1],
-00043580: 2064 715b 6471 203e 2030 5d5d 2c20 6474   dq[dq > 0]], dt
-00043590: 7970 653d 6e70 2e69 6e74 3136 290a 2020  ype=np.int16).  
-000435a0: 2020 2020 2020 2020 2020 6864 7520 3d20            hdu = 
-000435b0: 7079 6669 7473 2e49 6d61 6765 4844 5528  pyfits.ImageHDU(
-000435c0: 6865 6164 6572 3d68 6561 6465 722c 2064  header=header, d
-000435d0: 6174 613d 6471 5f64 6174 6129 0a20 2020  ata=dq_data).   
-000435e0: 2020 2020 2020 2020 2068 6475 732e 6170           hdus.ap
-000435f0: 7065 6e64 2868 6475 290a 0a20 2020 206f  pend(hdu)..    o
-00043600: 7574 7075 745f 6669 6c65 6e61 6d65 203d  utput_filename =
-00043610: 2066 696c 656e 616d 652e 7265 706c 6163   filename.replac
-00043620: 6528 7265 706c 6163 655b 305d 2c20 7265  e(replace[0], re
-00043630: 706c 6163 655b 315d 290a 0a20 2020 206d  place[1])..    m
-00043640: 7367 203d 2027 2320 6475 6d70 5f66 6c74  sg = '# dump_flt
-00043650: 5f64 713a 207b 307d 203e 207b 317d 272e  _dq: {0} > {1}'.
-00043660: 666f 726d 6174 2866 696c 656e 616d 652c  format(filename,
-00043670: 206f 7574 7075 745f 6669 6c65 6e61 6d65   output_filename
-00043680: 290a 2020 2020 6c6f 675f 636f 6d6d 656e  ).    log_commen
-00043690: 7428 4c4f 4746 494c 452c 206d 7367 2c20  t(LOGFILE, msg, 
-000436a0: 7665 7262 6f73 653d 7665 7262 6f73 652c  verbose=verbose,
-000436b0: 2073 686f 775f 6461 7465 3d54 7275 6529   show_date=True)
-000436c0: 0a0a 2020 2020 7079 6669 7473 2e48 4455  ..    pyfits.HDU
-000436d0: 4c69 7374 2868 6475 7329 2e77 7269 7465  List(hdus).write
-000436e0: 746f 286f 7574 7075 745f 6669 6c65 6e61  to(output_filena
-000436f0: 6d65 2c20 6f76 6572 7772 6974 653d 5472  me, overwrite=Tr
-00043700: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00043710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043720: 2020 2020 206f 7574 7075 745f 7665 7269       output_veri
-00043730: 6679 3d27 6669 7827 290a 2020 2020 0a20  fy='fix').    . 
-00043740: 2020 2069 6d2e 636c 6f73 6528 290a 0a0a     im.close()...
-00043750: 6465 6620 6170 706c 795f 666c 745f 6471  def apply_flt_dq
-00043760: 2866 696c 656e 616d 652c 2072 6570 6c61  (filename, repla
-00043770: 6365 3d28 272e 6669 7473 272c 2027 2e64  ce=('.fits', '.d
-00043780: 712e 6669 7473 2e67 7a27 292c 2076 6572  q.fits.gz'), ver
-00043790: 626f 7365 3d54 7275 652c 206f 725f 636f  bose=True, or_co
-000437a0: 6d62 696e 653d 4661 6c73 6529 3a0a 2020  mbine=False):.  
-000437b0: 2020 2222 220a 2020 2020 5265 6164 2061    """.    Read a
-000437c0: 6e64 2061 7070 6c79 2074 6865 2063 6f6d  nd apply the com
-000437d0: 7061 6374 2065 7870 6f73 7572 6520 696e  pact exposure in
-000437e0: 666f 726d 6174 696f 6e20 6669 6c65 0a0a  formation file..
-000437f0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00043800: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00043810: 2020 6669 6c65 6e61 6d65 203a 2073 7472    filename : str
-00043820: 0a20 2020 2020 2020 2046 4c54 2f46 4c43  .        FLT/FLC
-00043830: 2066 696c 656e 616d 652e 0a0a 2020 2020   filename...    
-00043840: 7265 706c 6163 6520 3a20 2873 7472 2c20  replace : (str, 
-00043850: 7374 7229 0a20 2020 2020 2020 2052 6570  str).        Rep
-00043860: 6c61 6365 2061 7267 756d 656e 7473 2066  lace arguments f
-00043870: 6f72 206f 7574 7075 7420 4451 2066 696c  or output DQ fil
-00043880: 656e 616d 653a 0a0a 2020 2020 2020 2020  ename:..        
-00043890: 3e3e 3e20 6f75 7470 7574 5f66 696c 656e  >>> output_filen
-000438a0: 616d 6520 3d20 6669 6c65 6e61 6d65 2e72  ame = filename.r
-000438b0: 6570 6c61 6365 2872 6570 6c61 6365 5b30  eplace(replace[0
-000438c0: 5d2c 2072 6570 6c61 6365 5b31 5d29 0a0a  ], replace[1])..
-000438d0: 2020 2020 6f72 5f63 6f6d 6269 6e65 203a      or_combine :
-000438e0: 2062 6f6f 6c0a 2020 2020 2020 2020 4966   bool.        If
-000438f0: 2054 7275 652c 2074 6865 6e20 6170 706c   True, then appl
-00043900: 7920 4451 2064 6174 6120 696e 2060 6f75  y DQ data in `ou
-00043910: 7470 7574 5f66 696c 656e 616d 6560 2077  tput_filename` w
-00043920: 6974 6820 4f52 206c 6f67 6963 2e0a 0a20  ith OR logic... 
-00043930: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
-00043940: 2074 6865 6e20 7265 7365 7420 7468 6520   then reset the 
-00043950: 4451 2065 7874 656e 7369 6f6e 7320 746f  DQ extensions to
-00043960: 2062 6520 6578 6163 746c 7920 7468 6f73   be exactly thos
-00043970: 6520 696e 0a20 2020 2020 2020 2060 6f75  e in.        `ou
-00043980: 7470 7574 5f66 696c 656e 616d 6560 2e0a  tput_filename`..
-00043990: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-000439a0: 202d 2d2d 2d2d 2d2d 0a20 2020 2057 7269   -------.    Wri
-000439b0: 7465 7320 6865 6164 6572 2061 6e64 2063  tes header and c
-000439c0: 6f6d 7061 6374 2044 5120 6172 7261 7920  ompact DQ array 
-000439d0: 746f 2060 6f75 7470 7574 5f66 696c 656e  to `output_filen
-000439e0: 616d 6560 2e0a 0a20 2020 2022 2222 0a0a  ame`...    """..
-000439f0: 2020 2020 6f75 7470 7574 5f66 696c 656e      output_filen
-00043a00: 616d 6520 3d20 6669 6c65 6e61 6d65 2e72  ame = filename.r
-00043a10: 6570 6c61 6365 2872 6570 6c61 6365 5b30  eplace(replace[0
-00043a20: 5d2c 2072 6570 6c61 6365 5b31 5d29 0a0a  ], replace[1])..
-00043a30: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00043a40: 7468 2e65 7869 7374 7328 6f75 7470 7574  th.exists(output
-00043a50: 5f66 696c 656e 616d 6529 3a0a 2020 2020  _filename):.    
-00043a60: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00043a70: 0a0a 2020 2020 696d 203d 2070 7966 6974  ..    im = pyfit
-00043a80: 732e 6f70 656e 2866 696c 656e 616d 652c  s.open(filename,
-00043a90: 206d 6f64 653d 2775 7064 6174 6527 290a   mode='update').
-00043aa0: 0a20 2020 206d 7367 203d 2027 2320 6170  .    msg = '# ap
-00043ab0: 706c 795f 666c 745f 6471 3a20 7b31 7d20  ply_flt_dq: {1} 
-00043ac0: 3e20 7b30 7d27 2e66 6f72 6d61 7428 6669  > {0}'.format(fi
-00043ad0: 6c65 6e61 6d65 2c20 6f75 7470 7574 5f66  lename, output_f
-00043ae0: 696c 656e 616d 6529 0a20 2020 206c 6f67  ilename).    log
-00043af0: 5f63 6f6d 6d65 6e74 284c 4f47 4649 4c45  _comment(LOGFILE
-00043b00: 2c20 6d73 672c 2076 6572 626f 7365 3d76  , msg, verbose=v
-00043b10: 6572 626f 7365 2c20 7368 6f77 5f64 6174  erbose, show_dat
-00043b20: 653d 5472 7565 290a 0a20 2020 2064 7120  e=True)..    dq 
-00043b30: 3d20 7079 6669 7473 2e6f 7065 6e28 6f75  = pyfits.open(ou
-00043b40: 7470 7574 5f66 696c 656e 616d 6529 0a20  tput_filename). 
-00043b50: 2020 2066 6f72 2065 7874 2069 6e20 5b31     for ext in [1
-00043b60: 2c20 322c 2033 2c20 345d 3a0a 2020 2020  , 2, 3, 4]:.    
-00043b70: 2020 2020 6966 2028 2827 5343 4927 2c20      if (('SCI', 
-00043b80: 6578 7429 2069 6e20 696d 2920 2620 2828  ext) in im) & ((
-00043b90: 2753 4349 272c 2065 7874 2920 696e 2064  'SCI', ext) in d
-00043ba0: 7129 3a0a 2020 2020 2020 2020 2020 2020  q):.            
-00043bb0: 7368 203d 2064 715b 2753 4349 272c 2065  sh = dq['SCI', e
-00043bc0: 7874 5d2e 6461 7461 2e73 6861 7065 0a20  xt].data.shape. 
-00043bd0: 2020 2020 2020 2020 2020 2069 6620 7368             if sh
-00043be0: 5b30 5d20 3d3d 2033 3a0a 2020 2020 2020  [0] == 3:.      
-00043bf0: 2020 2020 2020 2020 2020 692c 206a 2c20            i, j, 
-00043c00: 6471 5f69 203d 2064 715b 2753 4349 272c  dq_i = dq['SCI',
-00043c10: 2065 7874 5d2e 6461 7461 0a20 2020 2020   ext].data.     
-00043c20: 2020 2020 2020 2065 6c69 6620 7368 5b31         elif sh[1
-00043c30: 5d20 3d3d 2032 3a0a 2020 2020 2020 2020  ] == 2:.        
-00043c40: 2020 2020 2020 2020 6e7a 2c20 6471 5f69          nz, dq_i
-00043c50: 203d 2064 715b 2753 4349 272c 2065 7874   = dq['SCI', ext
-00043c60: 5d2e 6461 7461 0a20 2020 2020 2020 2020  ].data.         
-00043c70: 2020 2020 2020 2069 2c20 6a20 3d20 6e70         i, j = np
-00043c80: 2e75 6e72 6176 656c 5f69 6e64 6578 286e  .unravel_index(n
-00043c90: 7a2c 2073 6829 0a20 2020 2020 2020 2020  z, sh).         
-00043ca0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00043cb0: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-00043cc0: 4f45 7272 6f72 2827 6471 5b7b 307d 5d20  OError('dq[{0}] 
-00043cd0: 7368 6170 6520 7b31 7d20 6e6f 7420 7265  shape {1} not re
-00043ce0: 636f 676e 697a 6564 272e 666f 726d 6174  cognized'.format
-00043cf0: 2865 7874 2c20 7368 2929 0a20 2020 2020  (ext, sh)).     
-00043d00: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00043d10: 2020 2020 2020 2020 2320 4170 706c 7920          # Apply 
-00043d20: 4451 0a20 2020 2020 2020 2020 2020 2069  DQ.            i
-00043d30: 6620 6f72 5f63 6f6d 6269 6e65 3a0a 2020  f or_combine:.  
-00043d40: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00043d50: 5b27 4451 272c 2065 7874 5d2e 6461 7461  ['DQ', ext].data
-00043d60: 5b69 2c20 6a5d 2021 3d20 6471 5f69 0a20  [i, j] != dq_i. 
-00043d70: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00043d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043d90: 2069 6d5b 2744 5127 2c20 6578 745d 2e64   im['DQ', ext].d
-00043da0: 6174 6120 2a3d 2030 0a20 2020 2020 2020  ata *= 0.       
-00043db0: 2020 2020 2020 2020 2069 6d5b 2744 5127           im['DQ'
-00043dc0: 2c20 6578 745d 2e64 6174 615b 692c 206a  , ext].data[i, j
-00043dd0: 5d20 3d20 6471 5f69 0a0a 2020 2020 2020  ] = dq_i..      
-00043de0: 2020 2020 2020 2320 436f 7079 2068 6561        # Copy hea
-00043df0: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-00043e00: 6861 735f 626c 6f74 736b 7920 3d20 2742  has_blotsky = 'B
-00043e10: 4c4f 5453 4b59 2720 696e 2069 6d5b 2753  LOTSKY' in im['S
-00043e20: 4349 272c 2065 7874 5d2e 6865 6164 6572  CI', ext].header
-00043e30: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00043e40: 206b 2069 6e20 6471 5b27 5343 4927 2c20   k in dq['SCI', 
-00043e50: 6578 745d 2e68 6561 6465 723a 0a20 2020  ext].header:.   
-00043e60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00043e70: 6b20 696e 205b 2742 4954 5049 5827 2c20  k in ['BITPIX', 
-00043e80: 274e 4158 4953 3127 2c20 274e 4158 4953  'NAXIS1', 'NAXIS
-00043e90: 3227 2c20 2727 2c20 2748 4953 544f 5259  2', '', 'HISTORY
-00043ea0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00043eb0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00043ec0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00043ed0: 2020 696d 5b27 5343 4927 2c20 6578 745d    im['SCI', ext]
-00043ee0: 2e68 6561 6465 725b 6b5d 203d 2064 715b  .header[k] = dq[
-00043ef0: 2753 4349 272c 2065 7874 5d2e 6865 6164  'SCI', ext].head
-00043f00: 6572 5b6b 5d0a 0a20 2020 2020 2020 2020  er[k]..         
-00043f10: 2020 2069 6620 286e 6f74 2068 6173 5f62     if (not has_b
-00043f20: 6c6f 7473 6b79 2920 2620 2827 424c 4f54  lotsky) & ('BLOT
-00043f30: 534b 5927 2069 6e20 6471 5b27 5343 4927  SKY' in dq['SCI'
-00043f40: 2c20 6578 745d 2e68 6561 6465 7229 3a0a  , ext].header):.
-00043f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043f60: 696d 5b27 5343 4927 2c20 6578 745d 2e68  im['SCI', ext].h
-00043f70: 6561 6465 725b 2742 4c4f 5453 4b59 275d  eader['BLOTSKY']
-00043f80: 203d 2046 616c 7365 0a0a 2020 2020 696d   = False..    im
-00043f90: 2e66 6c75 7368 2829 0a20 2020 2069 6d2e  .flush().    im.
-00043fa0: 636c 6f73 6528 290a 0a0a 6465 6620 5247  close()...def RG
-00043fb0: 4274 6f48 6578 2876 616c 732c 2072 6762  BtoHex(vals, rgb
-00043fc0: 7479 7065 3d31 293a 0a20 2020 2022 2222  type=1):.    """
-00043fd0: 436f 6e76 6572 7473 2052 4742 2076 616c  Converts RGB val
-00043fe0: 7565 7320 696e 2061 2076 6172 6965 7479  ues in a variety
-00043ff0: 206f 6620 666f 726d 6174 7320 746f 2048   of formats to H
-00044000: 6578 2076 616c 7565 732e 0a0a 2020 2020  ex values...    
-00044010: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-00044020: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7661  ---------.    va
-00044030: 6c73 203a 2074 7570 6c65 0a20 2020 2020  ls : tuple.     
-00044040: 2020 2020 416e 2052 4742 2f52 4742 4120      An RGB/RGBA 
-00044050: 7475 706c 650a 0a20 2020 2072 6762 5f74  tuple..    rgb_t
-00044060: 7970 6520 3a20 696e 740a 2020 2020 2020  ype : int.      
-00044070: 2020 5661 6c69 6420 7661 6c75 7320 6172    Valid valus ar
-00044080: 653a 0a20 2020 2020 2020 2020 2d20 3120  e:.         - 1 
-00044090: 3d20 496e 7075 7473 2061 7265 2069 6e20  = Inputs are in 
-000440a0: 7468 6520 7261 6e67 6520 3020 746f 2031  the range 0 to 1
-000440b0: 0a20 2020 2020 2020 2020 2d20 3235 3620  .         - 256 
-000440c0: 3d20 496e 7075 7473 2061 7265 2069 6e20  = Inputs are in 
-000440d0: 7468 6520 7261 6e67 6520 3020 746f 2032  the range 0 to 2
-000440e0: 3535 0a20 0a20 2020 2052 6574 7572 6e73  55. .    Returns
-000440f0: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00044100: 2068 6578 7473 7472 203a 2073 7472 0a20   hextstr : str. 
-00044110: 2020 2020 2020 2041 2068 6578 2073 7472         A hex str
-00044120: 696e 6720 696e 2074 6865 2066 6f72 6d20  ing in the form 
-00044130: 2723 5252 4747 4242 2720 6f72 2027 2352  '#RRGGBB' or '#R
-00044140: 5247 4742 4241 4127 0a0a 2020 2020 5265  RGGBBAA'..    Re
-00044150: 6665 7265 6e63 6573 0a20 2020 202d 2d2d  ferences.    ---
-00044160: 2d2d 2d2d 2d2d 2d0a 2020 2020 2863 7265  -------.    (cre
-00044170: 6469 743a 2052 7963 6861 7264 2040 2068  dit: Rychard @ h
-00044180: 7474 7073 3a2f 2f73 7461 636b 6f76 6572  ttps://stackover
-00044190: 666c 6f77 2e63 6f6d 2f61 2f34 3832 3838  flow.com/a/48288
-000441a0: 3137 3329 0a0a 2020 2020 2222 220a 0a20  173)..    """.. 
-000441b0: 2020 206d 7367 203d 2022 5247 4220 6f72     msg = "RGB or
-000441c0: 2052 4742 4120 696e 7075 7473 2074 6f20   RGBA inputs to 
-000441d0: 5247 4274 6f48 6578 206d 7573 7420 6861  RGBtoHex must ha
-000441e0: 7665 2074 6872 6565 206f 7220 666f 7572  ve three or four
-000441f0: 2065 6c65 6d65 6e74 7321 220a 2020 2020   elements!".    
-00044200: 6966 2028 6c65 6e28 7661 6c73 2920 213d  if (len(vals) !=
-00044210: 2033 2920 2620 286c 656e 2876 616c 7329   3) & (len(vals)
-00044220: 2021 3d20 3429 3a0a 2020 2020 2020 2020   != 4):.        
-00044230: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00044240: 6d73 6729 0a0a 2020 2020 6966 2028 7267  msg)..    if (rg
-00044250: 6274 7970 6520 213d 2031 2920 2620 2872  btype != 1) & (r
-00044260: 6762 7479 7065 2021 3d20 3235 3629 3a0a  gbtype != 256):.
-00044270: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00044280: 6365 7074 696f 6e28 2272 6762 7479 7065  ception("rgbtype
-00044290: 206d 7573 7420 6265 2031 206f 7220 3235   must be 1 or 25
-000442a0: 3621 2229 0a0a 2020 2020 2320 436f 6e76  6!")..    # Conv
-000442b0: 6572 7420 6672 6f6d 2030 2d31 2052 4742  ert from 0-1 RGB
-000442c0: 2f52 4742 4120 746f 2030 2d32 3535 2052  /RGBA to 0-255 R
-000442d0: 4742 2f52 4742 410a 2020 2020 6966 2072  GB/RGBA.    if r
-000442e0: 6762 7479 7065 203d 3d20 313a 0a20 2020  gbtype == 1:.   
-000442f0: 2020 2020 2076 616c 7320 3d20 5b32 3535       vals = [255
-00044300: 2a78 2066 6f72 2078 2069 6e20 7661 6c73  *x for x in vals
-00044310: 5b3a 335d 5d0a 0a20 2020 2023 2045 6e73  [:3]]..    # Ens
-00044320: 7572 6520 7661 6c75 6573 2061 7265 2072  ure values are r
-00044330: 6f75 6e64 6564 2069 6e74 6567 6572 732c  ounded integers,
-00044340: 2063 6f6e 7665 7274 2074 6f20 6865 782c   convert to hex,
-00044350: 2061 6e64 2063 6f6e 6361 7465 6e61 7465   and concatenate
-00044360: 0a20 2020 2072 6574 7572 6e20 2723 2720  .    return '#' 
-00044370: 2b20 2727 2e6a 6f69 6e28 5b27 7b3a 3032  + ''.join(['{:02
-00044380: 587d 272e 666f 726d 6174 2869 6e74 2872  X}'.format(int(r
-00044390: 6f75 6e64 2878 2929 2920 666f 7220 7820  ound(x))) for x 
-000443a0: 696e 2076 616c 735d 290a 0a0a 6465 6620  in vals])...def 
-000443b0: 6361 7461 6c6f 675f 6d61 736b 2863 6174  catalog_mask(cat
-000443c0: 2c20 6563 6f6c 3d27 464c 5558 4552 525f  , ecol='FLUXERR_
-000443d0: 4150 4552 5f30 272c 206d 6178 5f65 7272  APER_0', max_err
-000443e0: 5f70 6572 6365 6e74 696c 653d 3930 2c20  _percentile=90, 
-000443f0: 7061 643d 302e 3035 2c20 7061 645f 6973  pad=0.05, pad_is
-00044400: 5f61 6273 6f6c 7574 653d 4661 6c73 652c  _absolute=False,
-00044410: 206d 696e 5f66 6c75 785f 7261 6469 7573   min_flux_radius
-00044420: 3d31 2e29 3a0a 2020 2020 2222 220a 2020  =1.):.    """.  
-00044430: 2020 436f 6d70 7574 6520 6120 6361 7461    Compute a cata
-00044440: 6c6f 6720 6d61 736b 2066 6f72 0a20 2020  log mask for.   
-00044450: 2020 2031 2920 4f62 6a65 6374 7320 7769     1) Objects wi
-00044460: 7468 696e 2060 7061 6460 206f 6620 7468  thin `pad` of th
-00044470: 6520 6564 6765 206f 6620 7468 6520 6361  e edge of the ca
-00044480: 7461 6c6f 6720 636f 6e76 6578 2068 756c  talog convex hul
-00044490: 6c0a 2020 2020 2020 3229 2055 6e63 6572  l.      2) Uncer
-000444a0: 7461 696e 7469 6573 203c 2060 6d61 785f  tainties < `max_
-000444b0: 6572 725f 7065 7263 656e 7469 6c65 600a  err_percentile`.
-000444c0: 0a20 2020 2022 2222 0a20 2020 2074 6573  .    """.    tes
-000444d0: 7420 3d20 6e70 2e69 7366 696e 6974 6528  t = np.isfinite(
-000444e0: 6361 745b 2746 4c55 585f 4155 544f 275d  cat['FLUX_AUTO']
-000444f0: 290a 2020 2020 6966 2027 464c 5558 5f52  ).    if 'FLUX_R
-00044500: 4144 4955 5327 2069 6e20 6361 742e 636f  ADIUS' in cat.co
-00044510: 6c6e 616d 6573 3a0a 2020 2020 2020 2020  lnames:.        
-00044520: 7465 7374 2026 3d20 6361 745b 2746 4c55  test &= cat['FLU
-00044530: 585f 5241 4449 5553 275d 203e 206d 696e  X_RADIUS'] > min
-00044540: 5f66 6c75 785f 7261 6469 7573 0a0a 2020  _flux_radius..  
-00044550: 2020 7465 7374 2026 3d20 2863 6174 5b27    test &= (cat['
-00044560: 5448 5245 5348 275d 203e 2030 2920 2620  THRESH'] > 0) & 
-00044570: 2863 6174 5b27 5448 5245 5348 275d 203c  (cat['THRESH'] <
-00044580: 2031 6532 3829 0a0a 2020 2020 6e6f 745f   1e28)..    not_
-00044590: 6564 6765 203d 2068 756c 6c5f 6564 6765  edge = hull_edge
-000445a0: 5f6d 6173 6b28 6361 745b 2758 5f49 4d41  _mask(cat['X_IMA
-000445b0: 4745 275d 2c20 6361 745b 2759 5f49 4d41  GE'], cat['Y_IMA
-000445c0: 4745 275d 2c0a 2020 2020 2020 2020 2020  GE'],.          
-000445d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000445e0: 2020 2020 7061 643d 7061 642c 2070 6164      pad=pad, pad
-000445f0: 5f69 735f 6162 736f 6c75 7465 3d70 6164  _is_absolute=pad
-00044600: 5f69 735f 6162 736f 6c75 7465 290a 0a20  _is_absolute).. 
-00044610: 2020 2074 6573 7420 263d 206e 6f74 5f65     test &= not_e
-00044620: 6467 650a 0a20 2020 2069 6620 6563 6f6c  dge..    if ecol
-00044630: 2069 6e20 6361 742e 636f 6c6e 616d 6573   in cat.colnames
-00044640: 3a0a 2020 2020 2020 2020 7661 6c69 6420  :.        valid 
-00044650: 3d20 6e70 2e69 7366 696e 6974 6528 6361  = np.isfinite(ca
-00044660: 745b 6563 6f6c 5d29 0a20 2020 2020 2020  t[ecol]).       
-00044670: 2069 6620 6d61 785f 6572 725f 7065 7263   if max_err_perc
-00044680: 656e 7469 6c65 203c 2031 3030 3a0a 2020  entile < 100:.  
-00044690: 2020 2020 2020 2020 2020 7465 7374 2026            test &
-000446a0: 3d20 6361 745b 6563 6f6c 5d20 3c20 6e70  = cat[ecol] < np
-000446b0: 2e70 6572 6365 6e74 696c 6528 6361 745b  .percentile(cat[
-000446c0: 6563 6f6c 5d5b 287e 6e6f 745f 6564 6765  ecol][(~not_edge
-000446d0: 2920 2620 7661 6c69 645d 2c0a 2020 2020  ) & valid],.    
-000446e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000446f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044700: 2020 2020 2020 6d61 785f 6572 725f 7065        max_err_pe
-00044710: 7263 656e 7469 6c65 290a 0a20 2020 2072  rcentile)..    r
-00044720: 6574 7572 6e20 7465 7374 0a0a 0a64 6566  eturn test...def
-00044730: 2068 756c 6c5f 6564 6765 5f6d 6173 6b28   hull_edge_mask(
-00044740: 782c 2079 2c20 7061 643d 3130 302c 2070  x, y, pad=100, p
-00044750: 6164 5f69 735f 6162 736f 6c75 7465 3d54  ad_is_absolute=T
-00044760: 7275 652c 206d 6173 6b3d 4e6f 6e65 293a  rue, mask=None):
-00044770: 0a20 2020 2022 2222 0a20 2020 2043 6f6d  .    """.    Com
-00044780: 7075 7465 2067 656f 6d65 7472 6963 616c  pute geometrical
-00044790: 2065 6467 6520 6d61 736b 2066 6f72 2070   edge mask for p
-000447a0: 6f69 6e74 7320 7769 7468 696e 2061 2063  oints within a c
-000447b0: 6f6e 7665 7820 6875 6c6c 0a0a 2020 2020  onvex hull..    
-000447c0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-000447d0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 782c  ---------.    x,
-000447e0: 2079 203a 2061 7272 6179 0a20 2020 2020   y : array.     
-000447f0: 2020 2043 6f6f 7264 696e 6174 6573 206f     Coordinates o
-00044800: 6620 7468 6520 6361 7461 6c6f 670a 0a20  f the catalog.. 
-00044810: 2020 2070 6164 203a 2066 6c6f 6174 0a20     pad : float. 
-00044820: 2020 2020 2020 2042 7566 6665 7220 7061         Buffer pa
-00044830: 6464 696e 670a 0a20 2020 2070 6164 5f69  dding..    pad_i
-00044840: 735f 6162 736f 6c75 7465 203a 2062 6f6f  s_absolute : boo
-00044850: 6c0a 2020 2020 2020 2020 4966 2054 7275  l.        If Tru
-00044860: 652c 2074 6865 6e20 7468 6520 6275 6666  e, then the buff
-00044870: 6572 2069 7320 7461 6b65 6e20 6672 6f6d  er is taken from
-00044880: 2060 7061 6460 2028 652e 672e 2c20 7069   `pad` (e.g., pi
-00044890: 7865 6c73 292e 2020 4966 0a20 2020 2020  xels).  If.     
-000448a0: 2020 2046 616c 7365 2c20 7468 656e 2060     False, then `
-000448b0: 7061 6460 2069 7320 7472 6561 7465 6420  pad` is treated 
-000448c0: 6173 2061 2066 7261 6374 696f 6e20 6f66  as a fraction of
-000448d0: 2074 6865 206c 696e 6561 7220 6469 6d65   the linear dime
-000448e0: 6e73 696f 6e0a 2020 2020 2020 2020 6f66  nsion.        of
-000448f0: 2074 6865 2063 6174 616c 6f67 2028 607e   the catalog (`~
-00044900: 7371 7274 2868 756c 6c20 6172 6561 2960  sqrt(hull area)`
-00044910: 292e 0a0a 2020 2020 6d61 736b 203a 2062  )...    mask : b
-00044920: 6f6f 6c20 6172 7261 790a 2020 2020 2020  ool array.      
-00044930: 2020 4d61 736b 2074 6f20 6170 706c 7920    Mask to apply 
-00044940: 746f 2078 2f79 2062 6566 6f72 6520 636f  to x/y before co
-00044950: 6d70 7574 696e 6720 7468 6520 636f 6e76  mputing the conv
-00044960: 6578 2068 756c 6c0a 0a20 2020 2052 6574  ex hull..    Ret
-00044970: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00044980: 0a20 2020 206d 6173 6b20 3a20 626f 6f6c  .    mask : bool
-00044990: 2061 7272 6179 0a20 2020 2020 2020 2054   array.        T
-000449a0: 7275 6520 6966 2070 6f69 6e74 7320 7769  rue if points wi
-000449b0: 7468 696e 2074 6865 2062 7566 6665 7265  thin the buffere
-000449c0: 6420 6875 6c6c 0a0a 2020 2020 2222 220a  d hull..    """.
-000449d0: 0a20 2020 2066 726f 6d20 7363 6970 792e  .    from scipy.
-000449e0: 7370 6174 6961 6c20 696d 706f 7274 2043  spatial import C
-000449f0: 6f6e 7665 7848 756c 6c0a 2020 2020 6672  onvexHull.    fr
-00044a00: 6f6d 2073 6861 7065 6c79 2e67 656f 6d65  om shapely.geome
-00044a10: 7472 7920 696d 706f 7274 2050 6f6c 7967  try import Polyg
-00044a20: 6f6e 2c20 506f 696e 740a 0a20 2020 2078  on, Point..    x
-00044a30: 7920 3d20 6e70 2e61 7272 6179 285b 782c  y = np.array([x,
-00044a40: 2079 5d29 2e54 0a0a 2020 2020 6966 206d   y]).T..    if m
-00044a50: 6173 6b20 6973 204e 6f6e 653a 0a20 2020  ask is None:.   
-00044a60: 2020 2020 2068 756c 6c20 3d20 436f 6e76       hull = Conv
-00044a70: 6578 4875 6c6c 2878 7929 0a20 2020 2065  exHull(xy).    e
-00044a80: 6c73 653a 0a20 2020 2020 2020 2068 756c  lse:.        hul
-00044a90: 6c20 3d20 436f 6e76 6578 4875 6c6c 2878  l = ConvexHull(x
-00044aa0: 795b 6d61 736b 2c20 3a5d 290a 0a20 2020  y[mask, :])..   
-00044ab0: 2070 7879 203d 2078 795b 6875 6c6c 2e76   pxy = xy[hull.v
-00044ac0: 6572 7469 6365 732c 203a 5d0a 2020 2020  ertices, :].    
-00044ad0: 706f 6c79 203d 2050 6f6c 7967 6f6e 2870  poly = Polygon(p
-00044ae0: 7879 290a 0a20 2020 2069 6620 7061 645f  xy)..    if pad_
-00044af0: 6973 5f61 6273 6f6c 7574 653a 0a20 2020  is_absolute:.   
-00044b00: 2020 2020 2062 7566 6620 3d20 2d70 6164       buff = -pad
-00044b10: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00044b20: 2020 2023 206c 696e 6561 7220 6469 6d65     # linear dime
-00044b30: 6e73 696f 6e20 7e20 7371 7274 2861 7265  nsion ~ sqrt(are
-00044b40: 6129 0a20 2020 2020 2020 2062 7566 6620  a).        buff 
-00044b50: 3d20 2d70 6164 2a6e 702e 7371 7274 2870  = -pad*np.sqrt(p
-00044b60: 6f6c 792e 6172 6561 290a 0a20 2020 2070  oly.area)..    p
-00044b70: 6275 6666 203d 2070 6f6c 792e 6275 6666  buff = poly.buff
-00044b80: 6572 2862 7566 6629 0a20 2020 2069 6e5f  er(buff).    in_
-00044b90: 6275 6666 203d 206e 702e 6172 7261 7928  buff = np.array(
-00044ba0: 5b70 6275 6666 2e63 6f6e 7461 696e 7328  [pbuff.contains(
-00044bb0: 506f 696e 7428 5b78 5b69 5d2c 2079 5b69  Point([x[i], y[i
-00044bc0: 5d5d 2929 2066 6f72 2069 2069 6e20 7261  ]])) for i in ra
-00044bd0: 6e67 6528 6c65 6e28 7829 295d 290a 0a20  nge(len(x))]).. 
-00044be0: 2020 2072 6574 7572 6e20 696e 5f62 7566     return in_buf
-00044bf0: 660a 0a0a 6465 6620 636f 6e76 6578 5f68  f...def convex_h
-00044c00: 756c 6c5f 7772 6170 7065 7228 782c 2079  ull_wrapper(x, y
-00044c10: 293a 0a20 2020 2022 2222 0a20 2020 2047  ):.    """.    G
-00044c20: 656e 6572 6174 6520 6120 636f 6e76 6578  enerate a convex
-00044c30: 2068 756c 6c20 6672 6f6d 2061 206c 6973   hull from a lis
-00044c40: 7420 6f66 2070 6f69 6e74 730a 2020 2020  t of points.    
-00044c50: 0a20 2020 2052 6574 7572 6e73 3a0a 2020  .    Returns:.  
-00044c60: 2020 0a20 2020 2070 7879 203a 2028 6172    .    pxy : (ar
-00044c70: 7261 792c 2061 7272 6179 290a 2020 2020  ray, array).    
-00044c80: 2020 2020 5475 706c 6520 6f66 2068 756c      Tuple of hul
-00044c90: 6c20 7665 7274 6963 6573 0a20 2020 200a  l vertices.    .
-00044ca0: 2020 2020 706f 6c79 203a 2060 7e73 6861      poly : `~sha
-00044cb0: 7065 6c79 2e67 656f 6d65 7472 792e 506f  pely.geometry.Po
-00044cc0: 6c79 676f 6e60 0a20 2020 2020 2020 2050  lygon`.        P
-00044cd0: 6f6c 7967 6f6e 206f 626a 6563 742e 0a20  olygon object.. 
-00044ce0: 2020 200a 2020 2020 6875 6c6c 203a 2060     .    hull : `
-00044cf0: 7e73 6369 7079 2e73 7061 7469 616c 2e43  ~scipy.spatial.C
-00044d00: 6f6e 7665 7848 756c 6c60 0a20 2020 2020  onvexHull`.     
-00044d10: 2020 2054 6865 2068 756c 6c20 6f62 6a65     The hull obje
-00044d20: 6374 2e0a 2020 2020 2020 2020 0a20 2020  ct..        .   
-00044d30: 2022 2222 0a20 2020 2066 726f 6d20 7363   """.    from sc
-00044d40: 6970 792e 7370 6174 6961 6c20 696d 706f  ipy.spatial impo
-00044d50: 7274 2043 6f6e 7665 7848 756c 6c0a 2020  rt ConvexHull.  
-00044d60: 2020 6672 6f6d 2073 6861 7065 6c79 2e67    from shapely.g
-00044d70: 656f 6d65 7472 7920 696d 706f 7274 2050  eometry import P
-00044d80: 6f6c 7967 6f6e 2c20 506f 696e 740a 0a20  olygon, Point.. 
-00044d90: 2020 2078 7920 3d20 6e70 2e61 7272 6179     xy = np.array
-00044da0: 285b 782c 2079 5d29 2e54 0a20 2020 2068  ([x, y]).T.    h
-00044db0: 756c 6c20 3d20 436f 6e76 6578 4875 6c6c  ull = ConvexHull
-00044dc0: 2878 7929 0a20 2020 2070 7879 203d 2078  (xy).    pxy = x
-00044dd0: 795b 6875 6c6c 2e76 6572 7469 6365 732c  y[hull.vertices,
-00044de0: 203a 5d0a 2020 2020 706f 6c79 203d 2050   :].    poly = P
-00044df0: 6f6c 7967 6f6e 2870 7879 290a 2020 2020  olygon(pxy).    
-00044e00: 0a20 2020 2072 6574 7572 6e20 7078 792c  .    return pxy,
-00044e10: 2070 6f6c 792c 2068 756c 6c0a 0a0a 6465   poly, hull...de
-00044e20: 6620 6875 6c6c 5f61 7265 6128 782c 2079  f hull_area(x, y
-00044e30: 293a 0a20 2020 2022 2222 0a20 2020 2052  ):.    """.    R
-00044e40: 6574 7572 6e20 7468 6520 6172 6561 206f  eturn the area o
-00044e50: 6620 6120 636f 6e76 6578 2068 756c 6c20  f a convex hull 
-00044e60: 6f66 2061 206c 6973 7420 6f66 2070 6f69  of a list of poi
-00044e70: 6e74 730a 2020 2020 2222 220a 2020 2020  nts.    """.    
-00044e80: 7078 792c 2070 6f6c 792c 2068 756c 6c20  pxy, poly, hull 
-00044e90: 3d20 636f 6e76 6578 5f68 756c 6c5f 7772  = convex_hull_wr
-00044ea0: 6170 7065 7228 782c 2079 290a 0a20 2020  apper(x, y)..   
-00044eb0: 2072 6574 7572 6e20 706f 6c79 2e61 7265   return poly.are
-00044ec0: 610a 2020 2020 0a20 2020 200a 6465 6620  a.    .    .def 
-00044ed0: 7265 6d6f 7665 5f74 6578 745f 6c61 6265  remove_text_labe
-00044ee0: 6c73 2866 6967 293a 0a20 2020 2022 2222  ls(fig):.    """
-00044ef0: 0a20 2020 2052 656d 6f76 6520 616c 6c20  .    Remove all 
-00044f00: 5465 7874 2061 6e6e 6f74 6174 696f 6e73  Text annotations
-00044f10: 2066 726f 6d20 6060 6669 672e 6178 6573   from ``fig.axes
-00044f20: 6060 2e0a 2020 2020 2222 220a 2020 2020  ``..    """.    
-00044f30: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
-00044f40: 620a 2020 2020 0a20 2020 2066 6f72 2061  b.    .    for a
-00044f50: 7820 696e 2066 6967 2e61 7865 733a 0a20  x in fig.axes:. 
-00044f60: 2020 2020 2020 2066 6f72 2063 6869 6c64         for child
-00044f70: 2069 6e20 6178 2e67 6574 5f63 6869 6c64   in ax.get_child
-00044f80: 7265 6e28 293a 0a20 2020 2020 2020 2020  ren():.         
-00044f90: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00044fa0: 2863 6869 6c64 2c20 6d61 7470 6c6f 746c  (child, matplotl
-00044fb0: 6962 2e74 6578 742e 5465 7874 293a 0a20  ib.text.Text):. 
-00044fc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00044fd0: 6620 6368 696c 642e 6765 745f 7465 7874  f child.get_text
-00044fe0: 2829 3a20 2320 446f 6e27 7420 7265 6d6f  (): # Don't remo
-00044ff0: 7665 2065 6d70 7479 206c 6162 656c 730a  ve empty labels.
-00045000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045010: 2020 2020 6368 696c 642e 7365 745f 7669      child.set_vi
-00045020: 7369 626c 6528 4661 6c73 6529 0a0a 2020  sible(False)..  
-00045030: 2020 0a4c 4f47 4649 4c45 203d 2027 2f74    .LOGFILE = '/t
-00045040: 6d70 2f67 7269 7a6c 692e 6c6f 6727 0a0a  mp/grizli.log'..
-00045050: 0a64 6566 206c 6f67 5f66 756e 6374 696f  .def log_functio
-00045060: 6e5f 6172 6775 6d65 6e74 7328 4c4f 4746  n_arguments(LOGF
-00045070: 494c 452c 2066 7261 6d65 2c20 6675 6e63  ILE, frame, func
-00045080: 3d27 6675 6e63 272c 2069 676e 6f72 653d  ='func', ignore=
-00045090: 5b5d 2c20 7665 7262 6f73 653d 5472 7565  [], verbose=True
-000450a0: 293a 0a20 2020 2022 2222 0a20 2020 204c  ):.    """.    L
-000450b0: 6f67 206c 6f63 616c 2076 6172 6961 626c  og local variabl
-000450c0: 6573 2c20 652e 672e 2c20 7061 7261 6d65  es, e.g., parame
-000450d0: 7465 7220 6172 6775 656d 656e 7473 2074  ter arguements t
-000450e0: 6f20 6120 6669 6c65 0a0a 2020 2020 5061  o a file..    Pa
-000450f0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-00045100: 2d2d 2d2d 2d2d 2d0a 2020 2020 4c4f 4746  -------.    LOGF
-00045110: 494c 4520 3a20 7374 7220 6f72 204e 6f6e  ILE : str or Non
-00045120: 650a 2020 2020 2020 2020 4f75 7470 7574  e.        Output
-00045130: 2066 696c 652e 2020 4966 2060 4e6f 6e65   file.  If `None
-00045140: 602c 2074 6865 6e20 666f 7263 6520 6076  `, then force `v
-00045150: 6572 626f 7365 3d54 7275 6560 2e0a 0a20  erbose=True`... 
-00045160: 2020 2066 7261 6d65 203a 2060 7e69 6e73     frame : `~ins
-00045170: 7065 6374 2e63 7572 7265 6e74 6672 616d  pect.currentfram
-00045180: 6528 2960 0a20 2020 2020 2020 204e 616d  e()`.        Nam
-00045190: 6573 7061 6365 206f 626a 6563 742e 0a0a  espace object...
-000451a0: 2020 2020 6675 6e63 203a 2073 7472 0a20      func : str. 
-000451b0: 2020 2020 2020 2046 756e 6374 696f 6e20         Function 
-000451c0: 6e61 6d65 2074 6f20 7573 650a 2020 2020  name to use.    
-000451d0: 0a20 2020 2069 676e 6f72 6520 3a20 6c69  .    ignore : li
-000451e0: 7374 0a20 2020 2020 2020 2056 6172 6961  st.        Varia
-000451f0: 626c 6520 6e61 6d65 7320 746f 2069 676e  ble names to ign
-00045200: 6f72 650a 2020 2020 0a20 2020 2076 6572  ore.    .    ver
-00045210: 626f 7365 203a 2062 6f6f 6c0a 2020 2020  bose : bool.    
-00045220: 2020 2020 5072 696e 7420 6d65 7373 6161      Print messaa
-00045230: 6765 2074 6f20 7374 646f 7574 2e0a 0a20  ge to stdout... 
-00045240: 2020 2022 2222 0a20 2020 2061 7267 7320     """.    args 
-00045250: 3d20 696e 7370 6563 742e 6765 7461 7267  = inspect.getarg
-00045260: 7661 6c75 6573 2866 7261 6d65 292e 6c6f  values(frame).lo
-00045270: 6361 6c73 0a20 2020 2061 7267 732e 706f  cals.    args.po
-00045280: 7028 2766 7261 6d65 2729 0a20 2020 2066  p('frame').    f
-00045290: 6f72 206b 2069 6e20 6c69 7374 2861 7267  or k in list(arg
-000452a0: 732e 6b65 7973 2829 293a 0a20 2020 2020  s.keys()):.     
-000452b0: 2020 2069 6620 6861 7361 7474 7228 6172     if hasattr(ar
-000452c0: 6773 5b6b 5d2c 2027 5f5f 6275 696c 7469  gs[k], '__builti
-000452d0: 6e73 5f5f 2729 3a0a 2020 2020 2020 2020  ns__'):.        
-000452e0: 2020 2020 6172 6773 2e70 6f70 286b 290a      args.pop(k).
-000452f0: 2020 2020 0a20 2020 2066 6f72 206b 2069      .    for k i
-00045300: 6e20 6967 6e6f 7265 3a0a 2020 2020 2020  n ignore:.      
-00045310: 2020 6966 206b 2069 6e20 6172 6773 3a0a    if k in args:.
-00045320: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00045330: 2e70 6f70 286b 290a 2020 2020 2020 2020  .pop(k).        
-00045340: 2020 2020 0a20 2020 2069 6620 6675 6e63      .    if func
-00045350: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00045360: 2020 2020 2020 6c6f 6773 7472 203d 2027        logstr = '
-00045370: 5c6e 7b30 7d28 2a2a 7b31 7d29 5c6e 270a  \n{0}(**{1})\n'.
-00045380: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00045390: 2020 6c6f 6773 7472 203d 2027 5c6e 7b31    logstr = '\n{1
-000453a0: 7d27 0a0a 2020 2020 6c6f 6773 7472 203d  }'..    logstr =
-000453b0: 206c 6f67 7374 722e 666f 726d 6174 2866   logstr.format(f
-000453c0: 756e 632c 2061 7267 7329 0a20 2020 206d  unc, args).    m
-000453d0: 7367 203d 206c 6f67 5f63 6f6d 6d65 6e74  sg = log_comment
-000453e0: 284c 4f47 4649 4c45 2c20 6c6f 6773 7472  (LOGFILE, logstr
-000453f0: 2c20 7665 7262 6f73 653d 7665 7262 6f73  , verbose=verbos
-00045400: 652c 2073 686f 775f 6461 7465 3d54 7275  e, show_date=Tru
-00045410: 6529 0a0a 2020 2020 7265 7475 726e 206d  e)..    return m
-00045420: 7367 0a0a 0a64 6566 2063 7469 6d65 5f74  sg...def ctime_t
-00045430: 6f5f 6973 6f28 6d74 696d 652c 2066 6f72  o_iso(mtime, for
-00045440: 6d61 743d 2725 6120 2562 2025 6420 2548  mat='%a %b %d %H
-00045450: 3a25 4d3a 2553 2025 5927 2c20 7374 7269  :%M:%S %Y', stri
-00045460: 705f 6465 6369 6d61 6c3d 5472 7565 2c20  p_decimal=True, 
-00045470: 7665 7262 6f73 653d 5472 7565 293a 0a20  verbose=True):. 
-00045480: 2020 2022 2222 0a20 2020 2043 6f6e 7665     """.    Conve
-00045490: 7274 2060 7469 6d65 2e63 7469 6d65 6020  rt `time.ctime` 
-000454a0: 7374 7269 6e67 7320 746f 2049 534f 2064  strings to ISO d
-000454b0: 6174 6573 0a0a 2020 2020 5061 7261 6d65  ates..    Parame
-000454c0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-000454d0: 2d2d 2d0a 2020 2020 6d74 696d 6520 3a20  ---.    mtime : 
-000454e0: 7374 720a 2020 2020 2020 2020 5469 6d65  str.        Time
-000454f0: 2073 7472 696e 672c 2067 656e 6572 616c   string, general
-00045500: 6c79 2061 7320 6f75 7470 7574 2066 726f  ly as output fro
-00045510: 6d20 6074 696d 652e 6374 696d 6560 2c20  m `time.ctime`, 
-00045520: 652e 672e 2c20 0a20 2020 2020 2020 2060  e.g., .        `
-00045530: 6027 4d6f 6e20 5365 7020 3136 2031 313a  `'Mon Sep 16 11:
-00045540: 3233 3a32 3720 3230 3139 2760 600a 0a20  23:27 2019'``.. 
-00045550: 2020 2066 6f72 6d61 7420 3a20 7374 720a     format : str.
-00045560: 2020 2020 2020 2020 6064 6174 6574 696d          `datetim
-00045570: 652e 7374 7270 7469 6d65 6020 666f 726d  e.strptime` form
-00045580: 6174 2073 7472 696e 672c 2063 6f64 6573  at string, codes
-00045590: 2061 7420 0a20 2020 2020 2020 2068 7474   at .        htt
-000455a0: 7073 3a2f 2f77 7777 2e70 726f 6772 616d  ps://www.program
-000455b0: 697a 2e63 6f6d 2f70 7974 686f 6e2d 7072  iz.com/python-pr
-000455c0: 6f67 7261 6d6d 696e 672f 6461 7465 7469  ogramming/dateti
-000455d0: 6d65 2f73 7472 7074 696d 650a 0a20 2020  me/strptime..   
-000455e0: 2073 7472 6970 5f64 6563 696d 616c 203a   strip_decimal :
-000455f0: 2062 6f6f 6c0a 2020 2020 2020 2020 5374   bool.        St
-00045600: 7269 7020 6465 6369 6d61 6c20 7365 636f  rip decimal seco
-00045610: 6e64 7320 6672 6f6d 2065 6e64 206f 6620  nds from end of 
-00045620: 4953 4f20 7374 7269 6e67 0a0a 2020 2020  ISO string..    
-00045630: 7665 7262 6f73 6520 3a20 626f 6f6c 0a20  verbose : bool. 
-00045640: 2020 2020 2020 2050 7269 6e74 2061 206d         Print a m
-00045650: 6573 7361 6765 2069 6620 636f 6e76 6572  essage if conver
-00045660: 7369 6f6e 2066 6169 6c73 0a0a 2020 2020  sion fails..    
-00045670: 5265 7475 726e 7320 0a20 2020 202d 2d2d  Returns .    ---
-00045680: 2d2d 2d2d 0a20 2020 2069 736f 203a 2073  ----.    iso : s
-00045690: 7472 0a20 2020 2020 2020 2053 7472 696e  tr.        Strin
-000456a0: 6720 696e 2028 736f 7274 6162 6c65 2920  g in (sortable) 
-000456b0: 4953 4f20 666f 726d 6174 2c20 652e 672e  ISO format, e.g.
-000456c0: 2c20 6060 2732 3031 392d 3039 2d31 3620  , ``'2019-09-16 
-000456d0: 3131 3a32 333a 3237 2e30 3030 2760 600a  11:23:27.000'``.
-000456e0: 0a20 2020 2022 2222 0a20 2020 2066 726f  .    """.    fro
-000456f0: 6d20 6173 7472 6f70 792e 7469 6d65 2069  m astropy.time i
-00045700: 6d70 6f72 7420 5469 6d65 0a20 2020 2066  mport Time.    f
-00045710: 726f 6d20 6461 7465 7469 6d65 2069 6d70  rom datetime imp
-00045720: 6f72 7420 6461 7465 7469 6d65 0a0a 2020  ort datetime..  
-00045730: 2020 2320 4973 2061 6c72 6561 6479 2049    # Is already I
-00045740: 534f 2066 6f72 6d61 740a 2020 2020 6966  SO format.    if
-00045750: 206d 7469 6d65 2e63 6f75 6e74 2827 2d27   mtime.count('-'
-00045760: 2920 3d3d 2032 3a0a 2020 2020 2020 2020  ) == 2:.        
-00045770: 6973 6f20 3d20 6d74 696d 6520 2b20 2727  iso = mtime + ''
-00045780: 0a0a 2020 2020 656c 7365 3a0a 2020 2020  ..    else:.    
-00045790: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000457a0: 2020 2020 2069 736f 203d 2054 696d 6528       iso = Time(
-000457b0: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
-000457c0: 6528 6d74 696d 652c 2066 6f72 6d61 7429  e(mtime, format)
-000457d0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-000457e0: 2020 2020 2020 2020 2020 666f 726d 6174            format
-000457f0: 3d27 6461 7465 7469 6d65 2729 2e69 736f  ='datetime').iso
-00045800: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00045810: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
-00045820: 2020 2020 2020 2020 6966 2076 6572 626f          if verbo
-00045830: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00045840: 2020 2020 7072 696e 7428 6627 436f 756c      print(f'Coul
-00045850: 646e 5c27 7420 636f 6e76 6572 7420 5c27  dn\'t convert \'
-00045860: 7b6d 7469 6d65 7d5c 2720 7769 7468 2027  {mtime}\' with '
-00045870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045880: 2020 2020 2020 2066 2766 6f72 6d61 7420         f'format 
-00045890: 5c27 7b66 6f72 6d61 747d 5c27 2729 0a0a  \'{format}\'')..
-000458a0: 2020 2020 2020 2020 2020 2020 6973 6f20              iso 
-000458b0: 3d20 6d74 696d 6520 2b20 2727 0a0a 2020  = mtime + ''..  
-000458c0: 2020 6966 2073 7472 6970 5f64 6563 696d    if strip_decim
-000458d0: 616c 3a0a 2020 2020 2020 2020 6973 6f20  al:.        iso 
-000458e0: 3d20 6973 6f2e 7370 6c69 7428 272e 2729  = iso.split('.')
-000458f0: 5b30 5d0a 0a20 2020 2072 6574 7572 6e20  [0]..    return 
-00045900: 6973 6f0a 0a0a 6465 6620 6e6f 7774 696d  iso...def nowtim
-00045910: 6528 6973 6f3d 5472 7565 293a 0a20 2020  e(iso=True):.   
-00045920: 2022 2222 0a20 2020 2057 7261 7070 6572   """.    Wrapper
-00045930: 2066 6f72 2060 6173 7472 6f70 792e 7469   for `astropy.ti
-00045940: 6d65 2e6e 6f77 600a 0a20 2020 2050 6172  me.now`..    Par
-00045950: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-00045960: 2d2d 2d2d 2d2d 0a20 2020 2069 736f 203a  ------.    iso :
-00045970: 2062 6f6f 6c0a 2020 2020 2020 2020 4966   bool.        If
-00045980: 2054 7275 652c 2072 6574 7572 6e20 7469   True, return ti
-00045990: 6d65 2069 6e20 4953 4f20 7374 7269 6e67  me in ISO string
-000459a0: 2c20 656c 7365 2072 6574 7572 6e20 5469  , else return Ti
-000459b0: 6d65 206f 626a 6563 740a 0a20 2020 2052  me object..    R
-000459c0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-000459d0: 2d2d 0a20 2020 2074 6e6f 7720 3a20 7374  --.    tnow : st
-000459e0: 720a 2020 2020 2020 2020 5365 6520 6069  r.        See `i
-000459f0: 736f 600a 0a20 2020 2022 2222 0a20 2020  so`..    """.   
-00045a00: 2066 726f 6d20 6173 7472 6f70 792e 7469   from astropy.ti
-00045a10: 6d65 2069 6d70 6f72 7420 5469 6d65 0a20  me import Time. 
-00045a20: 2020 2074 6e6f 7720 3d20 5469 6d65 2e6e     tnow = Time.n
-00045a30: 6f77 2829 0a20 2020 2069 6620 6973 6f3a  ow().    if iso:
-00045a40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00045a50: 746e 6f77 2e69 736f 0a20 2020 2065 6c73  tnow.iso.    els
-00045a60: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
-00045a70: 6e20 746e 6f77 0a0a 0a64 6566 206c 6f67  n tnow...def log
-00045a80: 5f63 6f6d 6d65 6e74 284c 4f47 4649 4c45  _comment(LOGFILE
-00045a90: 2c20 636f 6d6d 656e 742c 2076 6572 626f  , comment, verbo
-00045aa0: 7365 3d46 616c 7365 2c20 7368 6f77 5f64  se=False, show_d
-00045ab0: 6174 653d 4661 6c73 652c 206d 6f64 653d  ate=False, mode=
-00045ac0: 2761 2729 3a0a 2020 2020 2222 220a 2020  'a'):.    """.  
-00045ad0: 2020 4c6f 6720 6120 6d65 7373 6167 6520    Log a message 
-00045ae0: 746f 2061 2066 696c 652c 206f 7074 696f  to a file, optio
-00045af0: 6e61 6c6c 7920 696e 636c 7564 696e 6720  nally including 
-00045b00: 6120 6461 7465 2074 6167 0a20 2020 2022  a date tag.    "
-00045b10: 2222 0a20 2020 2069 6d70 6f72 7420 7469  "".    import ti
-00045b20: 6d65 0a0a 2020 2020 6966 2073 686f 775f  me..    if show_
-00045b30: 6461 7465 3a0a 2020 2020 2020 2020 6d73  date:.        ms
-00045b40: 6720 3d20 2723 2028 7b30 7d29 5c6e 272e  g = '# ({0})\n'.
-00045b50: 666f 726d 6174 286e 6f77 7469 6d65 2829  format(nowtime()
-00045b60: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00045b70: 2020 2020 6d73 6720 3d20 2727 0a0a 2020      msg = ''..  
-00045b80: 2020 6d73 6720 2b3d 2027 7b30 7d5c 6e27    msg += '{0}\n'
-00045b90: 2e66 6f72 6d61 7428 636f 6d6d 656e 7429  .format(comment)
-00045ba0: 0a0a 2020 2020 6966 204c 4f47 4649 4c45  ..    if LOGFILE
-00045bb0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00045bc0: 2020 2020 2020 6670 203d 206f 7065 6e28        fp = open(
-00045bd0: 4c4f 4746 494c 452c 206d 6f64 6529 0a20  LOGFILE, mode). 
-00045be0: 2020 2020 2020 2066 702e 7772 6974 6528         fp.write(
-00045bf0: 6d73 6729 0a20 2020 2020 2020 2066 702e  msg).        fp.
-00045c00: 636c 6f73 6528 290a 0a20 2020 2069 6620  close()..    if 
-00045c10: 7665 7262 6f73 653a 0a20 2020 2020 2020  verbose:.       
-00045c20: 2070 7269 6e74 286d 7367 5b3a 2d31 5d29   print(msg[:-1])
-00045c30: 0a0a 2020 2020 7265 7475 726e 206d 7367  ..    return msg
-00045c40: 0a0a 0a64 6566 206c 6f67 5f65 7863 6570  ...def log_excep
-00045c50: 7469 6f6e 284c 4f47 4649 4c45 2c20 7472  tion(LOGFILE, tr
-00045c60: 6163 6562 6163 6b2c 2076 6572 626f 7365  aceback, verbose
-00045c70: 3d54 7275 652c 206d 6f64 653d 2761 2729  =True, mode='a')
-00045c80: 3a0a 2020 2020 2222 220a 2020 2020 4c6f  :.    """.    Lo
-00045c90: 6720 6578 6365 7074 696f 6e20 696e 666f  g exception info
-00045ca0: 726d 6174 696f 6e20 746f 2061 2066 696c  rmation to a fil
-00045cb0: 652c 206f 7220 7072 696e 7420 746f 2073  e, or print to s
-00045cc0: 6372 6565 6e0a 0a20 2020 2050 6172 616d  creen..    Param
-00045cd0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-00045ce0: 2d2d 2d2d 0a20 2020 204c 4f47 4649 4c45  ----.    LOGFILE
-00045cf0: 203a 2073 7472 206f 7220 4e6f 6e65 0a20   : str or None. 
-00045d00: 2020 2020 2020 204f 7574 7075 7420 6669         Output fi
-00045d10: 6c65 2e20 2049 6620 604e 6f6e 6560 2c20  le.  If `None`, 
-00045d20: 7468 656e 2066 6f72 6365 2060 7665 7262  then force `verb
-00045d30: 6f73 653d 5472 7565 602e 0a0a 2020 2020  ose=True`...    
-00045d40: 7472 6163 6562 6163 6b20 3a20 6275 696c  traceback : buil
-00045d50: 7469 6e20 7472 6163 6562 6163 6b20 6d6f  tin traceback mo
-00045d60: 6475 6c65 0a20 2020 2020 2020 2045 7863  dule.        Exc
-00045d70: 6570 7469 6f6e 2074 7261 6365 6261 636b  eption traceback
-00045d80: 2c20 6672 6f6d 2067 6c6f 6261 6c20 6069  , from global `i
-00045d90: 6d70 6f72 7420 7472 6163 6562 6163 6b60  mport traceback`
-00045da0: 2e0a 0a20 2020 2076 6572 626f 7365 203a  ...    verbose :
-00045db0: 2062 6f6f 6c0a 2020 2020 2020 2020 5072   bool.        Pr
-00045dc0: 696e 7420 6578 6365 7074 696f 6e20 746f  int exception to
-00045dd0: 2073 7464 6f75 742e 0a0a 2020 2020 6d6f   stdout...    mo
-00045de0: 6465 203a 2027 6127 2c20 2777 270a 2020  de : 'a', 'w'.  
-00045df0: 2020 2020 2020 4669 6c65 206d 6f64 6520        File mode 
-00045e00: 6f6e 2060 6f70 656e 284c 4f47 4649 4c45  on `open(LOGFILE
-00045e10: 2c20 6d6f 6465 2960 2c20 692e 652e 2c20  , mode)`, i.e., 
-00045e20: 6170 7065 6e64 206f 7220 7772 6974 652e  append or write.
-00045e30: 0a0a 2020 2020 2222 220a 2020 2020 696d  ..    """.    im
-00045e40: 706f 7274 2074 696d 650a 0a20 2020 2074  port time..    t
-00045e50: 7261 6365 203d 2074 7261 6365 6261 636b  race = traceback
-00045e60: 2e66 6f72 6d61 745f 6578 6328 6c69 6d69  .format_exc(limi
-00045e70: 743d 3229 0a20 2020 206c 6f67 203d 2027  t=2).    log = '
-00045e80: 5c6e 2323 2323 2323 2323 2323 2323 2323  \n##############
-00045e90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00045ea0: 2323 2323 2323 2323 2323 2323 205c 6e27  ############ \n'
-00045eb0: 0a20 2020 206c 6f67 202b 3d20 2723 2021  .    log += '# !
-00045ec0: 2045 7863 6570 7469 6f6e 2028 7b30 7d29   Exception ({0})
-00045ed0: 5c6e 272e 666f 726d 6174 286e 6f77 7469  \n'.format(nowti
-00045ee0: 6d65 2829 290a 2020 2020 6c6f 6720 2b3d  me()).    log +=
-00045ef0: 2027 235c 6e23 2021 272b 275c 6e23 2021   '#\n# !'+'\n# !
-00045f00: 272e 6a6f 696e 2874 7261 6365 2e73 706c  '.join(trace.spl
-00045f10: 6974 2827 5c6e 2729 290a 2020 2020 6c6f  it('\n')).    lo
-00045f20: 6720 2b3d 2027 5c6e 2323 2323 2323 2323  g += '\n########
-00045f30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00045f40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00045f50: 2320 5c6e 5c6e 270a 2020 2020 6966 2076  # \n\n'.    if v
-00045f60: 6572 626f 7365 207c 2028 4c4f 4746 494c  erbose | (LOGFIL
-00045f70: 4520 6973 204e 6f6e 6529 3a0a 2020 2020  E is None):.    
-00045f80: 2020 2020 7072 696e 7428 6c6f 6729 0a0a      print(log)..
-00045f90: 2020 2020 6966 204c 4f47 4649 4c45 2069      if LOGFILE i
-00045fa0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00045fb0: 2020 2020 6670 203d 206f 7065 6e28 4c4f      fp = open(LO
-00045fc0: 4746 494c 452c 206d 6f64 6529 0a20 2020  GFILE, mode).   
-00045fd0: 2020 2020 2066 702e 7772 6974 6528 6c6f       fp.write(lo
-00045fe0: 6729 0a20 2020 2020 2020 2066 702e 636c  g).        fp.cl
-00045ff0: 6f73 6528 290a 0a64 6566 2073 696d 706c  ose()..def simpl
-00046000: 655f 4c43 444d 284f 6d30 3d30 2e33 2c20  e_LCDM(Om0=0.3, 
-00046010: 4f64 6530 3d30 2e37 2c20 4830 3d37 302c  Ode0=0.7, H0=70,
-00046020: 204f 6230 3d30 2e30 3436 332c 2054 636d   Ob0=0.0463, Tcm
-00046030: 6230 3d32 2e37 3235 2c20 6e61 6d65 3d4e  b0=2.725, name=N
-00046040: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
-00046050: 2020 5369 6d70 6c65 204c 616d 6264 6143    Simple LambdaC
-00046060: 444d 2063 6f73 6d6f 6c6f 6779 0a20 2020  DM cosmology.   
-00046070: 200a 2020 2020 5061 7261 6d65 7465 7273   .    Parameters
-00046080: 2061 7265 2064 6566 696e 6564 2061 7320   are defined as 
-00046090: 696e 2060 7e61 7374 726f 7079 2e63 6f73  in `~astropy.cos
-000460a0: 6d6f 6c6f 6779 2e4c 616d 6264 6143 444d  mology.LambdaCDM
-000460b0: 602e 0a20 2020 200a 2020 2020 2222 220a  `..    .    """.
-000460c0: 2020 2020 6672 6f6d 2061 7374 726f 7079      from astropy
-000460d0: 2e63 6f73 6d6f 6c6f 6779 2069 6d70 6f72  .cosmology impor
-000460e0: 7420 4c61 6d62 6461 4344 4d0a 2020 2020  t LambdaCDM.    
-000460f0: 636f 736d 6f6c 6f67 7920 3d20 4c61 6d62  cosmology = Lamb
-00046100: 6461 4344 4d28 4830 2c20 4f6d 302c 204f  daCDM(H0, Om0, O
-00046110: 6465 302c 2054 636d 6230 3d54 636d 6230  de0, Tcmb0=Tcmb0
-00046120: 2c20 6e61 6d65 3d6e 616d 6529 0a20 2020  , name=name).   
-00046130: 2072 6574 7572 6e20 636f 736d 6f6c 6f67   return cosmolog
-00046140: 790a 0a0a 6465 6620 7069 7865 6c5f 706f  y...def pixel_po
-00046150: 6c79 676f 6e5f 6d61 736b 2870 6f6c 7967  lygon_mask(polyg
-00046160: 6f6e 2c20 7368 6170 652c 2077 6373 3d4e  on, shape, wcs=N
-00046170: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
-00046180: 2020 4d61 6b65 2061 206d 6173 6b20 706f    Make a mask po
-00046190: 696e 7473 2069 6e20 6120 3244 2061 7272  ints in a 2D arr
-000461a0: 6179 2069 6e73 6964 6520 6120 706f 6c79  ay inside a poly
-000461b0: 676f 6e0a 2020 2020 0a20 2020 2050 6172  gon.    .    Par
-000461c0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-000461d0: 2d2d 2d2d 2d2d 0a20 2020 2070 6f6c 7967  ------.    polyg
-000461e0: 6f6e 203a 2073 7472 2c20 2832 2c4d 2920  on : str, (2,M) 
-000461f0: 6172 7261 790a 2020 2020 2020 2020 536f  array.        So
-00046200: 6d65 7468 696e 6720 7468 6174 2060 6772  mething that `gr
-00046210: 697a 6c69 2e75 7469 6c73 2e53 5265 6769  izli.utils.SRegi
-00046220: 6f6e 6020 6361 6e20 7061 7273 6520 6173  on` can parse as
-00046230: 2061 2070 6f6c 7967 6f6e 0a20 2020 200a   a polygon.    .
-00046240: 2020 2020 7368 6170 6520 3a20 7475 706c      shape : tupl
-00046250: 650a 2020 2020 2020 2020 322d 7475 706c  e.        2-tupl
-00046260: 6520 6f66 2069 6d61 6765 2064 696d 656e  e of image dimen
-00046270: 7369 6f6e 730a 2020 2020 0a20 2020 2077  sions.    .    w
-00046280: 6373 203a 2060 6173 7472 6f70 792e 7763  cs : `astropy.wc
-00046290: 732e 5743 5360 0a20 2020 2020 2020 2049  s.WCS`.        I
-000462a0: 6620 7370 6563 6966 6965 642c 2061 7373  f specified, ass
-000462b0: 756d 6520 6060 706f 6c79 676f 6e60 6020  ume ``polygon`` 
-000462c0: 6973 2073 6b79 2063 6f6f 7264 696e 6174  is sky coordinat
-000462d0: 6573 2061 6e64 2074 7261 6e73 666f 726d  es and transform
-000462e0: 2074 6f0a 2020 2020 2020 2020 696d 6167   to.        imag
-000462f0: 652e 0a20 2020 200a 2020 2020 5265 7475  e..    .    Retu
-00046300: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-00046310: 2020 2020 6d61 736b 203a 2061 7272 6179      mask : array
-00046320: 0a20 2020 2020 2020 2060 6062 6f6f 6c60  .        ``bool`
-00046330: 6020 6172 7261 7920 7769 7468 2060 6073  ` array with ``s
-00046340: 6861 7065 6060 2074 6861 7420 6973 2060  hape`` that is `
-00046350: 5472 7565 6020 696e 7369 6465 2060 706f  True` inside `po
-00046360: 6c79 676f 6e60 0a20 2020 2022 2222 0a20  lygon`.    """. 
-00046370: 2020 2073 7220 3d20 5352 6567 696f 6e28     sr = SRegion(
-00046380: 706f 6c79 676f 6e2c 2077 7261 703d 4661  polygon, wrap=Fa
-00046390: 6c73 6529 0a20 2020 200a 2020 2020 7970  lse).    .    yp
-000463a0: 2c20 7870 203d 206e 702e 696e 6469 6365  , xp = np.indice
-000463b0: 7328 7368 6170 6529 0a20 2020 2070 7473  s(shape).    pts
-000463c0: 203d 206e 702e 6172 7261 7928 5b78 702e   = np.array([xp.
-000463d0: 666c 6174 7465 6e28 292c 2079 702e 666c  flatten(), yp.fl
-000463e0: 6174 7465 6e28 295d 292e 540a 2020 2020  atten()]).T.    
-000463f0: 0a20 2020 2069 6620 7763 7320 6973 206e  .    if wcs is n
-00046400: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00046410: 2070 7473 203d 2077 6373 2e61 6c6c 5f70   pts = wcs.all_p
-00046420: 6978 3277 6f72 6c64 2870 7473 2c20 3029  ix2world(pts, 0)
-00046430: 0a20 2020 2020 2020 200a 2020 2020 6d61  .        .    ma
-00046440: 736b 203d 206e 702e 7a65 726f 7328 7368  sk = np.zeros(sh
-00046450: 6170 652c 2064 7479 7065 3d62 6f6f 6c29  ape, dtype=bool)
-00046460: 2e66 6c61 7474 656e 2829 0a20 2020 2066  .flatten().    f
-00046470: 6f72 2070 2069 6e20 7372 2e70 6174 683a  or p in sr.path:
-00046480: 0a20 2020 2020 2020 206d 6173 6b20 7c3d  .        mask |=
-00046490: 2070 2e63 6f6e 7461 696e 735f 706f 696e   p.contains_poin
-000464a0: 7473 2870 7473 290a 2020 2020 0a20 2020  ts(pts).    .   
-000464b0: 2072 6574 7572 6e20 6d61 736b 2e72 6573   return mask.res
-000464c0: 6861 7065 2873 6861 7065 290a 0a0a 6465  hape(shape)...de
-000464d0: 6620 6d61 6b65 5f66 696c 7465 725f 666f  f make_filter_fo
-000464e0: 6f74 7072 696e 7428 6669 6c74 6572 5f73  otprint(filter_s
-000464f0: 697a 653d 3731 2c20 6669 6c74 6572 5f63  ize=71, filter_c
-00046500: 656e 7472 616c 3d30 2c20 2a2a 6b77 6172  entral=0, **kwar
-00046510: 6773 293a 0a20 2020 2022 2222 0a20 2020  gs):.    """.   
-00046520: 204d 616b 6520 6120 666f 6f74 7072 696e   Make a footprin
-00046530: 7420 666f 7220 696d 6167 6520 6669 6c74  t for image filt
-00046540: 6572 696e 670a 2020 2020 2222 220a 2020  ering.    """.  
-00046550: 2020 6669 6c74 6572 5f66 6f6f 7470 7269    filter_footpri
-00046560: 6e74 203d 206e 702e 6f6e 6573 2866 696c  nt = np.ones(fil
-00046570: 7465 725f 7369 7a65 2c20 6474 7970 653d  ter_size, dtype=
-00046580: 696e 7429 0a20 2020 200a 2020 2020 6966  int).    .    if
-00046590: 2066 696c 7465 725f 6365 6e74 7261 6c20   filter_central 
-000465a0: 3e20 303a 0a20 2020 2020 2020 2066 3020  > 0:.        f0 
-000465b0: 3d20 2866 696c 7465 725f 7369 7a65 2d31  = (filter_size-1
-000465c0: 292f 2f32 0a20 2020 2020 2020 2066 696c  )//2.        fil
-000465d0: 7465 725f 666f 6f74 7072 696e 745b 6630  ter_footprint[f0
-000465e0: 2d66 696c 7465 725f 6365 6e74 7261 6c3a  -filter_central:
-000465f0: 6630 2b66 696c 7465 725f 6365 6e74 7261  f0+filter_centra
-00046600: 6c5d 203d 2030 0a20 2020 200a 2020 2020  l] = 0.    .    
-00046610: 7265 7475 726e 2066 696c 7465 725f 666f  return filter_fo
-00046620: 6f74 7072 696e 740a 0a0a 6465 6620 7361  otprint...def sa
-00046630: 6665 5f6e 616e 6d65 6469 616e 5f66 696c  fe_nanmedian_fil
-00046640: 7465 7228 6461 7461 2c20 6669 6c74 6572  ter(data, filter
-00046650: 5f6b 7761 7267 733d 7b7d 2c20 6669 6c74  _kwargs={}, filt
-00046660: 6572 5f66 6f6f 7470 7269 6e74 3d4e 6f6e  er_footprint=Non
-00046670: 652c 2061 7869 733d 312c 2063 6c65 616e  e, axis=1, clean
-00046680: 3d54 7275 652c 2063 7661 6c3d 302e 3029  =True, cval=0.0)
-00046690: 3a0a 2020 2020 2222 220a 2020 2020 5275  :.    """.    Ru
-000466a0: 6e20 6e61 6e6d 6564 6961 6e20 6669 6c74  n nanmedian filt
-000466b0: 6572 206f 6e20 6064 6174 6160 0a20 2020  er on `data`.   
-000466c0: 200a 2020 2020 5061 7261 6d65 7465 7273   .    Parameters
-000466d0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-000466e0: 2020 2020 6461 7461 203a 2061 7272 6179      data : array
-000466f0: 2d6c 696b 650a 2020 2020 2020 2020 5468  -like.        Th
-00046700: 6520 3244 2064 6174 6120 746f 2066 696c  e 2D data to fil
-00046710: 7465 720a 2020 2020 0a20 2020 2066 696c  ter.    .    fil
-00046720: 7465 725f 6b77 6172 6773 203a 2064 6963  ter_kwargs : dic
-00046730: 740a 2020 2020 2020 2020 4172 6775 6d65  t.        Argume
-00046740: 6e74 7320 746f 2060 7e67 7269 7a6c 692e  nts to `~grizli.
-00046750: 7574 696c 732e 6d61 6b65 5f66 696c 7465  utils.make_filte
-00046760: 725f 666f 6f74 7072 696e 7460 2074 6f20  r_footprint` to 
-00046770: 6d61 6b65 2061 2031 4420 6669 6c74 6572  make a 1D filter
-00046780: 0a20 2020 200a 2020 2020 6669 6c74 6572  .    .    filter
-00046790: 5f66 6f6f 7470 7269 6e74 203a 2061 7272  _footprint : arr
-000467a0: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
-000467b0: 5370 6563 6966 7920 7468 6520 6669 6c74  Specify the filt
-000467c0: 6572 2065 7870 6c69 6369 746c 792e 2020  er explicitly.  
-000467d0: 4966 2031 442c 2074 6865 6e20 7769 6c6c  If 1D, then will
-000467e0: 2061 7070 6c79 2074 6865 2066 696c 7465   apply the filte
-000467f0: 7220 6f76 6572 0a20 2020 2020 2020 2060  r over.        `
-00046800: 6178 6973 3d31 6020 2869 2e65 2e2c 2060  axis=1` (i.e., `
-00046810: 7860 2920 6f66 2060 6064 6174 6160 600a  x`) of ``data``.
-00046820: 2020 2020 0a20 2020 2061 7869 7320 3a20      .    axis : 
-00046830: 3020 6f72 2031 0a20 2020 2020 2020 2020  0 or 1.         
-00046840: 4178 6973 206f 7665 7220 7768 6963 6820  Axis over which 
-00046850: 746f 2061 7070 6c79 2074 6865 2066 696c  to apply the fil
-00046860: 7465 7220 2860 6061 7869 733d 3160 6020  ter (``axis=1`` 
-00046870: 6669 6c74 6572 7320 6f6e 2072 6f77 7329  filters on rows)
-00046880: 0a20 2020 200a 2020 2020 636c 6561 6e2c  .    .    clean,
-00046890: 2063 7661 6c20 3a20 626f 6f6c 2c20 7363   cval : bool, sc
-000468a0: 616c 6172 0a20 2020 2020 2020 2052 6570  alar.        Rep
-000468b0: 6c61 6365 2060 7e6e 756d 7079 2e6e 616e  lace `~numpy.nan
-000468c0: 6020 696e 2074 6865 206f 7574 7075 7420  ` in the output 
-000468d0: 7769 7468 2060 6063 7661 6c60 600a 2020  with ``cval``.  
-000468e0: 2020 0a20 2020 2052 6574 7572 6e73 0a20    .    Returns. 
-000468f0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2066     -------.    f
-00046900: 696c 7465 725f 6461 7461 203a 2061 7272  ilter_data : arr
-00046910: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
-00046920: 4669 6c74 6572 6564 2064 6174 610a 2020  Filtered data.  
-00046930: 2020 0a20 2020 2066 696c 7465 725f 6e61    .    filter_na
-00046940: 6d65 203a 2073 7472 0a20 2020 2020 2020  me : str.       
-00046950: 2054 6865 2074 7970 6520 6f66 2066 696c   The type of fil
-00046960: 7465 7220 7468 6174 2077 6173 2061 7070  ter that was app
-00046970: 6c69 6564 3a20 606e 6275 7469 6c73 2e6e  lied: `nbutils.n
-00046980: 616e 6d65 6469 616e 6020 6966 200a 2020  anmedian` if .  
-00046990: 2020 2020 2020 607e 6772 697a 6c69 2e6e        `~grizli.n
-000469a0: 6275 7469 6c73 2e6e 616e 6d65 6469 616e  butils.nanmedian
-000469b0: 6020 7761 7320 696d 706f 7274 6564 2073  ` was imported s
-000469c0: 7563 6365 7373 6675 6c6c 7920 616e 6420  uccessfully and 
-000469d0: 0a20 2020 2020 2020 2060 6d65 6469 616e  .        `median
-000469e0: 5f66 696c 7465 7260 2066 6f72 2074 6865  _filter` for the
-000469f0: 2066 616c 6c62 6163 6b20 746f 2060 7363   fallback to `sc
-00046a00: 6970 2e6e 6469 6d61 6765 2e6d 6564 6961  ip.ndimage.media
-00046a10: 6e5f 6669 6c74 6572 6020 0a20 2020 2020  n_filter` .     
-00046a20: 2020 206f 7468 6572 7769 7365 2e0a 2020     otherwise..  
-00046a30: 2020 2222 220a 2020 2020 696d 706f 7274    """.    import
-00046a40: 2073 6369 7079 2e6e 6469 6d61 6765 2061   scipy.ndimage a
-00046a50: 7320 6e64 0a20 2020 200a 2020 2020 7472  s nd.    .    tr
-00046a60: 793a 0a20 2020 2020 2020 2066 726f 6d20  y:.        from 
-00046a70: 2e20 696d 706f 7274 206e 6275 7469 6c73  . import nbutils
-00046a80: 0a20 2020 2020 2020 205f 6669 6c74 6572  .        _filter
-00046a90: 5f6e 616d 6520 3d20 276e 6275 7469 6c73  _name = 'nbutils
-00046aa0: 2e6e 616e 6d65 6469 616e 270a 2020 2020  .nanmedian'.    
-00046ab0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00046ac0: 6e62 7574 696c 7320 3d20 4e6f 6e65 0a20  nbutils = None. 
-00046ad0: 2020 2020 2020 205f 6669 6c74 6572 5f6e         _filter_n
-00046ae0: 616d 6520 3d20 276d 6564 6961 6e5f 6669  ame = 'median_fi
-00046af0: 6c74 6572 270a 2020 2020 0a20 2020 2069  lter'.    .    i
-00046b00: 6620 6669 6c74 6572 5f66 6f6f 7470 7269  f filter_footpri
-00046b10: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-00046b20: 2020 2020 5f66 696c 7465 725f 666f 6f74      _filter_foot
-00046b30: 7072 696e 7420 3d20 6d61 6b65 5f66 696c  print = make_fil
-00046b40: 7465 725f 666f 6f74 7072 696e 7428 2a2a  ter_footprint(**
-00046b50: 6669 6c74 6572 5f6b 7761 7267 7329 0a20  filter_kwargs). 
-00046b60: 2020 2020 2020 2069 6620 6178 6973 203d         if axis =
-00046b70: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00046b80: 205f 6669 6c74 6572 5f66 6f6f 7470 7269   _filter_footpri
-00046b90: 6e74 203d 205f 6669 6c74 6572 5f66 6f6f  nt = _filter_foo
-00046ba0: 7470 7269 6e74 5b4e 6f6e 652c 3a5d 0a20  tprint[None,:]. 
-00046bb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00046bc0: 2020 2020 2020 2020 205f 6669 6c74 6572           _filter
-00046bd0: 5f66 6f6f 7470 7269 6e74 203d 205f 6669  _footprint = _fi
-00046be0: 6c74 6572 5f66 6f6f 7470 7269 6e74 5b3a  lter_footprint[:
-00046bf0: 2c4e 6f6e 655d 0a20 2020 2065 6c73 653a  ,None].    else:
-00046c00: 0a20 2020 2020 2020 2069 6620 6669 6c74  .        if filt
-00046c10: 6572 5f66 6f6f 7470 7269 6e74 2e6e 6469  er_footprint.ndi
-00046c20: 6d20 3d3d 2031 3a0a 2020 2020 2020 2020  m == 1:.        
-00046c30: 2020 2020 6966 2061 7869 7320 3d3d 2031      if axis == 1
-00046c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00046c50: 2020 5f66 696c 7465 725f 666f 6f74 7072    _filter_footpr
-00046c60: 696e 7420 3d20 6669 6c74 6572 5f66 6f6f  int = filter_foo
-00046c70: 7470 7269 6e74 5b4e 6f6e 652c 3a5d 0a20  tprint[None,:]. 
-00046c80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00046c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046ca0: 205f 6669 6c74 6572 5f66 6f6f 7470 7269   _filter_footpri
-00046cb0: 6e74 203d 2066 696c 7465 725f 666f 6f74  nt = filter_foot
-00046cc0: 7072 696e 745b 3a2c 4e6f 6e65 5d0a 2020  print[:,None].  
-00046cd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00046ce0: 2020 2020 2020 2020 5f66 696c 7465 725f          _filter_
-00046cf0: 666f 6f74 7072 696e 7420 3d20 6669 6c74  footprint = filt
-00046d00: 6572 5f66 6f6f 7470 7269 6e74 0a20 2020  er_footprint.   
-00046d10: 200a 2020 2020 6966 206e 6275 7469 6c73   .    if nbutils
-00046d20: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00046d30: 2020 6669 6c74 6572 5f64 6174 6120 3d20    filter_data = 
-00046d40: 6e64 2e6d 6564 6961 6e5f 6669 6c74 6572  nd.median_filter
-00046d50: 2864 6174 612c 2066 6f6f 7470 7269 6e74  (data, footprint
-00046d60: 3d5f 6669 6c74 6572 5f66 6f6f 7470 7269  =_filter_footpri
-00046d70: 6e74 290a 2020 2020 656c 7365 3a0a 2020  nt).    else:.  
-00046d80: 2020 2020 2020 6669 6c74 6572 5f64 6174        filter_dat
-00046d90: 6120 3d20 6e64 2e67 656e 6572 6963 5f66  a = nd.generic_f
-00046da0: 696c 7465 7228 6461 7461 2c20 6e62 7574  ilter(data, nbut
-00046db0: 696c 732e 6e61 6e6d 6564 6961 6e2c 0a20  ils.nanmedian,. 
-00046dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046de0: 2020 2020 2020 2066 6f6f 7470 7269 6e74         footprint
-00046df0: 3d5f 6669 6c74 6572 5f66 6f6f 7470 7269  =_filter_footpri
-00046e00: 6e74 290a 2020 2020 2020 2020 6966 2063  nt).        if c
-00046e10: 6c65 616e 3a0a 2020 2020 2020 2020 2020  lean:.          
-00046e20: 2020 6669 6c74 6572 5f64 6174 615b 7e6e    filter_data[~n
-00046e30: 702e 6973 6669 6e69 7465 2866 696c 7465  p.isfinite(filte
-00046e40: 725f 6461 7461 295d 203d 2063 7661 6c0a  r_data)] = cval.
-00046e50: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00046e60: 2072 6574 7572 6e20 6669 6c74 6572 5f64   return filter_d
-00046e70: 6174 612c 205f 6669 6c74 6572 5f6e 616d  ata, _filter_nam
-00046e80: 650a 0a0a 6465 6620 6172 6776 5f74 6f5f  e...def argv_to_
-00046e90: 6469 6374 2861 7267 762c 2064 6566 6175  dict(argv, defau
-00046ea0: 6c74 733d 7b7d 2c20 646f 745f 6469 6374  lts={}, dot_dict
-00046eb0: 3d54 7275 6529 3a0a 2020 2020 2222 220a  =True):.    """.
-00046ec0: 2020 2020 436f 6e76 6572 7420 6120 6c69      Convert a li
-00046ed0: 7374 206f 6620 2873 696d 706c 6529 2063  st of (simple) c
-00046ee0: 6f6d 6d61 6e64 2d6c 696e 6520 6172 6775  ommand-line argu
-00046ef0: 6d65 6e74 7320 746f 2061 2064 6963 7469  ments to a dicti
-00046f00: 6f6e 6172 792e 0a20 2020 200a 2020 2020  onary..    .    
-00046f10: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-00046f20: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6172  ---------.    ar
-00046f30: 6776 203a 206c 6973 7420 6f66 2073 7472  gv : list of str
-00046f40: 696e 6773 0a20 2020 2020 2020 2045 2e67  ings.        E.g
-00046f50: 2e2c 2060 6073 7973 2e61 7267 765b 313a  ., ``sys.argv[1:
-00046f60: 5d60 602e 0a20 2020 200a 2020 2020 6465  ]``..    .    de
-00046f70: 6661 756c 7473 203a 2064 6963 740a 2020  faults : dict.  
-00046f80: 2020 2020 2020 4465 6661 756c 7420 6469        Default di
-00046f90: 6374 696f 6e61 7279 0a20 2020 200a 2020  ctionary.    .  
-00046fa0: 2020 646f 745f 6469 6374 203a 2062 6f6f    dot_dict : boo
-00046fb0: 6c0a 2020 2020 2020 2020 4966 2074 7275  l.        If tru
-00046fc0: 652c 2074 6865 6e20 696e 7465 7072 6574  e, then intepret
-00046fd0: 206b 6579 776f 7264 7320 7769 7468 2027   keywords with '
-00046fe0: 2e27 2061 7320 6e65 7374 6564 2064 6963  .' as nested dic
-00046ff0: 7469 6f6e 6172 7920 6b65 7973 2c20 0a20  tionary keys, . 
-00047000: 2020 2020 2020 2065 2e67 2e2c 2060 602d         e.g., ``-
-00047010: 2d64 2e6b 6579 3d76 616c 6060 203e 3e20  -d.key=val`` >> 
-00047020: 7b27 6427 3a20 7b27 6b65 7927 3a20 2776  {'d': {'key': 'v
-00047030: 616c 277d 7d0a 2020 2020 2020 2020 0a20  al'}}.        . 
-00047040: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-00047050: 2d2d 2d2d 2d2d 2d2d 0a20 2020 200a 2020  --------.    .  
-00047060: 2020 2020 2020 2320 2420 6d79 6675 6e63        # $ myfunc
-00047070: 2061 7267 3120 2d2d 7031 3d31 202d 2d6c   arg1 --p1=1 --l
-00047080: 313d 312c 322c 3320 2d2d 7064 6963 742e  1=1,2,3 --pdict.
-00047090: 6b31 3d31 202d 666c 6167 0a20 2020 2020  k1=1 -flag.     
-000470a0: 2020 203e 3e3e 2061 7267 7620 3d20 2761     >>> argv = 'a
-000470b0: 7267 3120 2d2d 7031 3d31 202d 2d6c 313d  rg1 --p1=1 --l1=
-000470c0: 312c 322c 3320 2d2d 7064 6963 742e 6b31  1,2,3 --pdict.k1
-000470d0: 3d31 202d 666c 6167 272e 7370 6c69 7428  =1 -flag'.split(
-000470e0: 290a 2020 2020 2020 2020 3e3e 3e20 6172  ).        >>> ar
-000470f0: 6773 2c20 6b77 6172 6773 203d 2061 7267  gs, kwargs = arg
-00047100: 765f 746f 5f64 6963 7428 6172 6776 290a  v_to_dict(argv).
-00047110: 2020 2020 2020 2020 3e3e 3e20 7072 696e          >>> prin
-00047120: 7428 6172 6773 290a 2020 2020 2020 2020  t(args).        
-00047130: 5b27 6172 6731 275d 0a20 2020 2020 2020  ['arg1'].       
-00047140: 203e 3e3e 2070 7269 6e74 286b 7761 7267   >>> print(kwarg
-00047150: 7329 0a20 2020 2020 2020 207b 2770 3127  s).        {'p1'
-00047160: 3a20 312c 2027 6c31 273a 205b 312c 2032  : 1, 'l1': [1, 2
-00047170: 2c20 335d 2c20 2770 6469 6374 273a 207b  , 3], 'pdict': {
-00047180: 276b 3127 3a20 317d 2c20 2766 6c61 6727  'k1': 1}, 'flag'
-00047190: 3a20 5472 7565 7d0a 2020 2020 2020 2020  : True}.        
-000471a0: 0a20 2020 2020 2020 2023 2057 6974 6820  .        # With 
-000471b0: 6465 6661 756c 7473 0a20 2020 2020 2020  defaults.       
-000471c0: 2064 6566 6175 6c74 7320 3d20 7b27 7064   defaults = {'pd
-000471d0: 6963 7427 3a7b 276b 3227 3a32 2e30 7d2c  ict':{'k2':2.0},
-000471e0: 2027 7032 273a 322e 307d 0a20 2020 2020   'p2':2.0}.     
-000471f0: 2020 203e 3e3e 2061 7267 732c 206b 7761     >>> args, kwa
-00047200: 7267 7320 3d20 6172 6776 5f74 6f5f 6469  rgs = argv_to_di
-00047210: 6374 2861 7267 762c 2064 6566 6175 6c74  ct(argv, default
-00047220: 733d 6465 6661 756c 7473 290a 2020 2020  s=defaults).    
-00047230: 2020 2020 3e3e 3e20 7072 696e 7428 6b77      >>> print(kw
-00047240: 6172 6773 290a 2020 2020 2020 2020 7b27  args).        {'
-00047250: 7064 6963 7427 3a20 7b27 6b32 273a 2032  pdict': {'k2': 2
-00047260: 2e30 2c20 276b 3127 3a20 317d 2c20 2770  .0, 'k1': 1}, 'p
-00047270: 3227 3a20 322e 302c 2027 7031 273a 2031  2': 2.0, 'p1': 1
-00047280: 2c20 276c 3127 3a20 5b31 2c20 322c 2033  , 'l1': [1, 2, 3
-00047290: 5d2c 2027 666c 6167 273a 2054 7275 657d  ], 'flag': True}
-000472a0: 0a20 2020 2020 2020 200a 2020 2020 2222  .        .    ""
-000472b0: 220a 2020 2020 696d 706f 7274 2063 6f70  ".    import cop
-000472c0: 790a 2020 2020 696d 706f 7274 206a 736f  y.    import jso
-000472d0: 6e0a 2020 2020 0a20 2020 206b 7761 7267  n.    .    kwarg
-000472e0: 7320 3d20 636f 7079 2e64 6565 7063 6f70  s = copy.deepcop
-000472f0: 7928 6465 6661 756c 7473 290a 2020 2020  y(defaults).    
-00047300: 6172 6773 203d 205b 5d0a 2020 2020 0a20  args = [].    . 
-00047310: 2020 2066 6f72 2069 2c20 6172 6720 696e     for i, arg in
-00047320: 2065 6e75 6d65 7261 7465 2861 7267 7629   enumerate(argv)
-00047330: 3a20 2020 2020 2020 200a 2020 2020 2020  :        .      
-00047340: 2020 6966 206e 6f74 2061 7267 2e73 7461    if not arg.sta
-00047350: 7274 7377 6974 6828 272d 2729 3a0a 2020  rtswith('-'):.  
-00047360: 2020 2020 2020 2020 2020 2320 4172 6775            # Argu
-00047370: 6d65 6e74 730a 2020 2020 2020 2020 2020  ments.          
-00047380: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00047390: 2020 2020 2020 2061 7267 732e 6170 7065         args.appe
-000473a0: 6e64 286a 736f 6e2e 6c6f 6164 7328 6172  nd(json.loads(ar
-000473b0: 6729 290a 2020 2020 2020 2020 2020 2020  g)).            
-000473c0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-000473d0: 2020 2020 2020 2020 6172 6773 2e61 7070          args.app
-000473e0: 656e 6428 6a73 6f6e 2e6c 6f61 6473 2866  end(json.loads(f
-000473f0: 2722 7b61 7267 7d22 2729 290a 2020 2020  '"{arg}"')).    
-00047400: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00047410: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00047420: 650a 2020 2020 2020 2020 2020 2020 0a20  e.            . 
-00047430: 2020 2020 2020 2073 706c 203d 2061 7267         spl = arg
-00047440: 2e73 7472 6970 2827 2d2d 2729 2e73 706c  .strip('--').spl
-00047450: 6974 2827 3d27 290a 2020 2020 2020 2020  it('=').        
-00047460: 6966 206c 656e 2873 706c 2920 3e20 313a  if len(spl) > 1:
-00047470: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-00047480: 6172 616d 6574 6572 2076 616c 7565 730a  arameter values.
-00047490: 2020 2020 2020 2020 2020 2020 6b65 792c              key,
-000474a0: 2076 616c 203d 2073 706c 0a20 2020 2020   val = spl.     
-000474b0: 2020 2020 2020 2076 616c 203d 2076 616c         val = val
-000474c0: 2e72 6570 6c61 6365 2827 5472 7565 272c  .replace('True',
-000474d0: 2774 7275 6527 292e 7265 706c 6163 6528  'true').replace(
-000474e0: 2746 616c 7365 272c 2766 616c 7365 2729  'False','false')
-000474f0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00047500: 203d 2076 616c 2e72 6570 6c61 6365 2827   = val.replace('
-00047510: 4e6f 6e65 272c 276e 756c 6c27 290a 2020  None','null').  
-00047520: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00047530: 2020 2020 2020 2020 2320 5061 7261 6d65          # Parame
-00047540: 7465 7273 2c20 7365 7420 746f 2074 7275  ters, set to tru
-00047550: 652c 2065 2e67 2e2c 202d 7365 745f 666c  e, e.g., -set_fl
-00047560: 6167 0a20 2020 2020 2020 2020 2020 206b  ag.            k
-00047570: 6579 2c20 7661 6c20 3d20 7370 6c5b 305d  ey, val = spl[0]
-00047580: 2c20 2774 7275 6527 0a20 2020 2020 2020  , 'true'.       
-00047590: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-000475a0: 2020 2320 7369 6e67 6c65 202d 0a20 2020    # single -.   
-000475b0: 2020 2020 2020 2020 2069 6620 6b65 792e           if key.
-000475c0: 7374 6172 7473 7769 7468 2827 2d27 293a  startswith('-'):
-000475d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000475e0: 206b 6579 203d 206b 6579 5b31 3a5d 0a20   key = key[1:]. 
-000475f0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00047600: 2320 4c69 7374 2076 616c 7565 7320 2020  # List values   
-00047610: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
-00047620: 2027 2c27 2069 6e20 7661 6c3a 0a20 2020   ',' in val:.   
-00047630: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00047640: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00047650: 5472 7920 7061 7273 696e 6720 7769 7468  Try parsing with
-00047660: 204a 534f 4e0a 2020 2020 2020 2020 2020   JSON.          
-00047670: 2020 2020 2020 6a76 616c 203d 206a 736f        jval = jso
-00047680: 6e2e 6c6f 6164 7328 6627 5b7b 7661 6c7d  n.loads(f'[{val}
-00047690: 5d27 290a 2020 2020 2020 2020 2020 2020  ]').            
-000476a0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-000476b0: 2020 2020 2020 2020 2320 4173 7375 6d65          # Assume
-000476c0: 2073 7472 696e 6773 0a20 2020 2020 2020   strings.       
-000476d0: 2020 2020 2020 2020 2073 7472 5f76 616c           str_val
-000476e0: 203d 2027 2c27 2e6a 6f69 6e28 5b66 2722   = ','.join([f'"
-000476f0: 7b76 7d22 2720 666f 7220 7620 696e 2076  {v}"' for v in v
-00047700: 616c 2e73 706c 6974 2827 2c27 295d 290a  al.split(',')]).
-00047710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047720: 6a76 616c 203d 206a 736f 6e2e 6c6f 6164  jval = json.load
-00047730: 7328 6627 5b7b 7374 725f 7661 6c7d 5d27  s(f'[{str_val}]'
-00047740: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00047750: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00047760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00047770: 206a 7661 6c20 3d20 6a73 6f6e 2e6c 6f61   jval = json.loa
-00047780: 6473 2876 616c 290a 2020 2020 2020 2020  ds(val).        
-00047790: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-000477a0: 2020 2020 2020 2020 2020 2020 2320 5374              # St
-000477b0: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-000477c0: 2020 2020 206a 7661 6c20 3d20 7661 6c0a       jval = val.
-000477d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000477e0: 2023 2044 6963 7420 6b65 7973 2c20 706f   # Dict keys, po
-000477f0: 7465 6e74 6961 6c6c 7920 6e65 7374 6564  tentially nested
-00047800: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00047810: 2069 6620 646f 745f 6469 6374 2026 2028   if dot_dict & (
-00047820: 272e 2720 696e 206b 6579 293a 0a20 2020  '.' in key):.   
-00047830: 2020 2020 2020 2020 206b 6579 7320 3d20           keys = 
-00047840: 6b65 792e 7370 6c69 7428 272e 2729 0a20  key.split('.'). 
-00047850: 2020 2020 2020 2020 2020 2064 203d 206b             d = k
-00047860: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
-00047870: 2020 666f 7220 6b20 696e 206b 6579 735b    for k in keys[
-00047880: 3a2d 315d 3a0a 2020 2020 2020 2020 2020  :-1]:.          
-00047890: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
-000478a0: 6e20 643a 0a20 2020 2020 2020 2020 2020  n d:.           
-000478b0: 2020 2020 2020 2020 2064 5b6b 5d20 3d20           d[k] = 
-000478c0: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
-000478d0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-000478e0: 2020 2020 6420 3d20 645b 6b5d 0a20 2020      d = d[k].   
-000478f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047900: 200a 2020 2020 2020 2020 2020 2020 645b   .            d[
-00047910: 6b65 7973 5b2d 315d 5d20 3d20 6a76 616c  keys[-1]] = jval
-00047920: 0a20 2020 2020 2020 2065 6c73 653a 2020  .        else:  
-00047930: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00047940: 2020 2020 2020 206b 7761 7267 735b 6b65         kwargs[ke
-00047950: 795d 203d 206a 7661 6c0a 2020 2020 2020  y] = jval.      
-00047960: 2020 2020 2020 0a20 2020 200a 2020 2020        .    .    
-00047970: 7265 7475 726e 2061 7267 732c 206b 7761  return args, kwa
-00047980: 7267 730a 0a0a 636c 6173 7320 556e 6971  rgs...class Uniq
-00047990: 7565 286f 626a 6563 7429 3a0a 2020 2020  ue(object):.    
-000479a0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-000479b0: 662c 2061 7272 6179 2c20 7665 7262 6f73  f, array, verbos
-000479c0: 653d 5472 7565 293a 0a20 2020 2020 2020  e=True):.       
-000479d0: 2022 2222 0a20 2020 2020 2020 2048 656c   """.        Hel
-000479e0: 7065 7220 666f 7220 756e 6971 7565 2069  per for unique i
-000479f0: 7465 6d73 2069 6e20 616e 2061 7272 6179  tems in an array
-00047a00: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00047a10: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00047a20: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00047a30: 2020 2020 2020 2020 6172 7261 7920 3a20          array : 
-00047a40: 6172 7261 792d 6c69 6b65 0a20 2020 2020  array-like.     
-00047a50: 2020 2020 2020 2044 6174 6120 746f 2070         Data to p
-00047a60: 6172 7365 2c20 6765 6e65 7261 6c6c 7920  arse, generally 
-00047a70: 7374 7269 6e67 7320 6275 7420 6361 6e20  strings but can 
-00047a80: 6265 2061 6e79 7468 696e 6720 7468 6174  be anything that
-00047a90: 2063 616e 200a 2020 2020 2020 2020 2020   can .          
-00047aa0: 2020 6265 2070 6172 7365 6420 6279 2060    be parsed by `
-00047ab0: 6e75 6d70 792e 756e 6971 7565 600a 0a0a  numpy.unique`...
-00047ac0: 2020 2020 2020 2020 4174 7472 6962 7574          Attribut
-00047ad0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-00047ae0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6469  -----.        di
-00047af0: 6d20 3a20 696e 740a 2020 2020 2020 2020  m : int.        
-00047b00: 2020 2020 6060 7369 7a65 6060 206f 6620      ``size`` of 
-00047b10: 696e 7075 7420 6060 6172 7261 7960 600a  input ``array``.
-00047b20: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00047b30: 2076 616c 7565 7320 3a20 6c69 7374 0a20   values : list. 
-00047b40: 2020 2020 2020 2020 2020 2055 6e69 7175             Uniqu
-00047b50: 6520 656c 656d 656e 7473 206f 6620 6060  e elements of ``
-00047b60: 6172 7261 7960 600a 2020 2020 2020 2020  array``.        
-00047b70: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
-00047b80: 203a 206c 6973 740a 2020 2020 2020 2020   : list.        
-00047b90: 2020 2020 496e 7465 6765 7220 6c69 7374      Integer list
-00047ba0: 206c 656e 6774 6820 6f66 2060 6061 7272   length of ``arr
-00047bb0: 6179 6060 2077 6974 6820 7468 6520 696e  ay`` with the in
-00047bc0: 6469 6365 7320 6f66 2060 6076 616c 7565  dices of ``value
-00047bd0: 7360 600a 2020 2020 2020 2020 2020 2020  s``.            
-00047be0: 666f 7220 6561 6368 2065 6c65 6d65 6e74  for each element
-00047bf0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00047c00: 2020 636f 756e 7473 203a 206c 6973 740a    counts : list.
-00047c10: 2020 2020 2020 2020 2020 2020 436f 756e              Coun
-00047c20: 7473 206f 6620 6561 6368 2065 6c65 6d65  ts of each eleme
-00047c30: 6e74 206f 6620 6060 7661 6c75 6573 6060  nt of ``values``
-00047c40: 0a20 2020 2020 2020 200a 0a20 2020 2020  .        ..     
-00047c50: 2020 204d 6574 686f 6473 0a20 2020 2020     Methods.     
-00047c60: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00047c70: 2020 205f 5f67 6574 5f5f 286b 6579 290a     __get__(key).
-00047c80: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
-00047c90: 726e 2061 2060 626f 6f6c 6020 6172 7261  rn a `bool` arra
-00047ca0: 7920 7768 6572 6520 656e 7472 6965 7320  y where entries 
-00047cb0: 6f66 2060 6061 7272 6179 6060 206d 6174  of ``array`` mat
-00047cc0: 6368 2074 6865 200a 2020 2020 2020 2020  ch the .        
-00047cd0: 2020 2020 7370 6563 6966 6965 6420 6060      specified ``
-00047ce0: 6b65 7960 600a 2020 2020 2020 2020 0a20  key``.        . 
-00047cf0: 2020 2020 2020 205f 5f69 7465 725f 5f0a         __iter__.
-00047d00: 2020 2020 2020 2020 2020 2020 4974 6572              Iter
-00047d10: 6174 6f72 206f 7665 7220 6060 7661 6c75  ator over ``valu
-00047d20: 6573 6060 0a20 2020 2020 2020 200a 2020  es``.        .  
-00047d30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00047d40: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00047d50: 6172 7261 792c 206c 6973 7429 3a0a 2020  array, list):.  
-00047d60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00047d70: 7272 6179 203d 206e 702e 6172 7261 7928  rray = np.array(
-00047d80: 6172 7261 7929 0a20 2020 2020 2020 2065  array).        e
-00047d90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00047da0: 2073 656c 662e 6172 7261 7920 3d20 6172   self.array = ar
-00047db0: 7261 790a 2020 2020 2020 2020 0a20 2020  ray.        .   
-00047dc0: 2020 2020 205f 203d 206e 702e 756e 6971       _ = np.uniq
-00047dd0: 7565 2873 656c 662e 6172 7261 792c 2072  ue(self.array, r
-00047de0: 6574 7572 6e5f 636f 756e 7473 3d54 7275  eturn_counts=Tru
-00047df0: 652c 2072 6574 7572 6e5f 696e 7665 7273  e, return_invers
-00047e00: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00047e10: 7365 6c66 2e64 696d 203d 2073 656c 662e  self.dim = self.
-00047e20: 6172 7261 792e 7369 7a65 0a20 2020 2020  array.size.     
-00047e30: 2020 2073 656c 662e 7a65 726f 7320 3d20     self.zeros = 
-00047e40: 6e70 2e7a 6572 6f73 2873 656c 662e 6172  np.zeros(self.ar
-00047e50: 7261 792e 7368 6170 652c 2064 7479 7065  ray.shape, dtype
-00047e60: 3d62 6f6f 6c29 0a20 2020 2020 2020 200a  =bool).        .
-00047e70: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
-00047e80: 7565 7320 3d20 5b6c 2066 6f72 206c 2069  ues = [l for l i
-00047e90: 6e20 5f5b 305d 5d0a 2020 2020 2020 2020  n _[0]].        
-00047ea0: 7365 6c66 2e69 6e64 6963 6573 203d 205f  self.indices = _
-00047eb0: 5b31 5d0a 2020 2020 2020 2020 7365 6c66  [1].        self
-00047ec0: 2e63 6f75 6e74 7320 3d20 5f5b 325d 0a20  .counts = _[2]. 
-00047ed0: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
-00047ee0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00047ef0: 656c 662e 696e 666f 2873 6f72 745f 636f  elf.info(sort_co
-00047f00: 756e 7473 3d76 6572 626f 7365 290a 2020  unts=verbose).  
-00047f10: 2020 0a20 2020 200a 2020 2020 4070 726f    .    .    @pro
-00047f20: 7065 7274 790a 2020 2020 6465 6620 4e28  perty.    def N(
-00047f30: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00047f40: 2222 0a20 2020 2020 2020 204e 756d 6265  "".        Numbe
-00047f50: 7220 6f66 2075 6e69 7175 6520 6060 7661  r of unique ``va
-00047f60: 6c75 6573 6060 0a20 2020 2020 2020 2022  lues``.        "
-00047f70: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00047f80: 6e20 6c65 6e28 7365 6c66 2e76 616c 7565  n len(self.value
-00047f90: 7329 0a0a 0a20 2020 2064 6566 2069 6e66  s)...    def inf
-00047fa0: 6f28 7365 6c66 2c20 736f 7274 5f63 6f75  o(self, sort_cou
-00047fb0: 6e74 733d 2d31 293a 0a20 2020 2020 2020  nts=-1):.       
-00047fc0: 2022 2222 0a20 2020 2020 2020 2050 7269   """.        Pri
-00047fd0: 6e74 2061 2073 756d 6d61 7279 0a20 2020  nt a summary.   
-00047fe0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00047ff0: 2070 7269 6e74 2866 277b 224e 223a 3e34   print(f'{"N":>4
-00048000: 7d20 207b 2276 616c 7565 223a 3130 7d27  }  {"value":10}'
-00048010: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00048020: 273d 3d3d 3d20 203d 3d3d 3d3d 3d3d 3d3d  '====  =========
-00048030: 3d27 290a 2020 2020 2020 2020 6966 2073  =').        if s
-00048040: 6f72 745f 636f 756e 7473 3a0a 2020 2020  ort_counts:.    
-00048050: 2020 2020 2020 2020 736f 203d 206e 702e          so = np.
-00048060: 6172 6773 6f72 7428 7365 6c66 2e63 6f75  argsort(self.cou
-00048070: 6e74 7329 5b3a 3a69 6e74 2873 6f72 745f  nts)[::int(sort_
-00048080: 636f 756e 7473 295d 0a20 2020 2020 2020  counts)].       
-00048090: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000480a0: 2020 2073 6f20 3d20 6e70 2e61 7261 6e67     so = np.arang
-000480b0: 6528 7365 6c66 2e4e 290a 2020 2020 2020  e(self.N).      
-000480c0: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
-000480d0: 6f72 2069 2069 6e20 736f 3a0a 2020 2020  or i in so:.    
-000480e0: 2020 2020 2020 2020 762c 2063 203d 2073          v, c = s
-000480f0: 656c 662e 7661 6c75 6573 5b69 5d2c 2073  elf.values[i], s
-00048100: 656c 662e 636f 756e 7473 5b69 5d0a 2020  elf.counts[i].  
-00048110: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00048120: 6627 7b63 3a3e 347d 2020 7b76 3a31 307d  f'{c:>4}  {v:10}
-00048130: 2729 0a0a 0a20 2020 2064 6566 2063 6f75  ')...    def cou
-00048140: 6e74 2873 656c 662c 206b 6579 293a 0a20  nt(self, key):. 
-00048150: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00048160: 2020 2047 6574 206f 6363 7572 7265 6e63     Get occurrenc
-00048170: 6573 2063 6f75 6e74 206f 6620 6120 7061  es count of a pa
-00048180: 7274 6963 756c 6172 2060 6076 616c 7565  rticular ``value
-00048190: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
-000481a0: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-000481b0: 2073 656c 662e 7661 6c75 6573 3a0a 2020   self.values:.  
-000481c0: 2020 2020 2020 2020 2020 6978 203d 2073            ix = s
-000481d0: 656c 662e 7661 6c75 6573 2e69 6e64 6578  elf.values.index
-000481e0: 286b 6579 290a 2020 2020 2020 2020 2020  (key).          
-000481f0: 2020 7265 7475 726e 2073 656c 662e 636f    return self.co
-00048200: 756e 7473 5b69 785d 0a20 2020 2020 2020  unts[ix].       
-00048210: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00048220: 2020 2072 6574 7572 6e20 300a 2020 2020     return 0.    
-00048230: 0a20 2020 200a 2020 2020 4070 726f 7065  .    .    @prope
-00048240: 7274 790a 2020 2020 6465 6620 6c69 7374  rty.    def list
-00048250: 5f69 6e64 6963 6573 2873 656c 6629 3a0a  _indices(self):.
-00048260: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00048270: 2020 2020 4275 696c 6420 6c69 7374 206f      Build list o
-00048280: 6620 6c69 7374 7320 6f66 2069 6e64 6963  f lists of indic
-00048290: 6573 2074 6861 7420 6561 6368 2075 6e69  es that each uni
-000482a0: 7175 6520 7661 6c75 650a 2020 2020 2020  que value.      
-000482b0: 2020 2222 220a 2020 2020 0a20 2020 2020    """.    .     
-000482c0: 2020 2069 6e64 7320 3d20 5b5b 5d20 666f     inds = [[] fo
-000482d0: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
-000482e0: 662e 4e29 5d20 2020 200a 2020 2020 2020  f.N)]    .      
-000482f0: 2020 736f 203d 206e 702e 6172 6773 6f72    so = np.argsor
-00048300: 7428 7365 6c66 2e69 6e64 6963 6573 290a  t(self.indices).
-00048310: 2020 2020 0a20 2020 2020 2020 2066 6f72      .        for
-00048320: 2069 2c20 6969 2069 6e20 7a69 7028 736f   i, ii in zip(so
-00048330: 2c20 7365 6c66 2e69 6e64 6963 6573 5b73  , self.indices[s
-00048340: 6f5d 293a 0a20 2020 2020 2020 2020 2020  o]):.           
-00048350: 2069 6e64 735b 6969 5d2e 6170 7065 6e64   inds[ii].append
-00048360: 2869 290a 2020 2020 2020 2020 0a20 2020  (i).        .   
-00048370: 2020 2020 2023 2053 6f72 7420 7468 6520       # Sort the 
-00048380: 7375 626c 6973 7473 0a20 2020 2020 2020  sublists.       
-00048390: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-000483a0: 7365 6c66 2e4e 293a 0a20 2020 2020 2020  self.N):.       
-000483b0: 2020 2020 2069 6620 7365 6c66 2e63 6f75       if self.cou
-000483c0: 6e74 735b 695d 203e 2031 3a0a 2020 2020  nts[i] > 1:.    
-000483d0: 2020 2020 2020 2020 2020 2020 696e 6473              inds
-000483e0: 5b69 5d2e 736f 7274 2829 0a20 2020 200a  [i].sort().    .
-000483f0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00048400: 6e64 730a 2020 2020 0a20 2020 200a 2020  nds.    .    .  
-00048410: 2020 6465 6620 756e 6971 7565 5f69 6e64    def unique_ind
-00048420: 6578 2873 656c 662c 2069 6e64 6578 3d30  ex(self, index=0
-00048430: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00048440: 2020 2020 2020 2052 6574 7572 6e20 6172         Return ar
-00048450: 7261 7920 6f66 2069 6e64 6963 6573 206f  ray of indices o
-00048460: 6620 7468 6520 7061 7265 6e74 2061 7272  f the parent arr
-00048470: 6179 2074 6861 7420 6d61 6b65 7320 6120  ay that makes a 
-00048480: 756e 6971 7565 206f 7574 7075 7420 6172  unique output ar
-00048490: 7261 790a 2020 2020 2020 2020 0a20 2020  ray.        .   
-000484a0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-000484b0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-000484c0: 2020 2020 2075 6978 203a 206c 6973 740a       uix : list.
-000484d0: 2020 2020 2020 2020 2020 2020 4c69 7374              List
-000484e0: 206f 6620 756e 6971 7565 2069 6e64 6963   of unique indic
-000484f0: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
-00048500: 2020 2020 2020 2075 6978 203d 205b 696e         uix = [in
-00048510: 645b 696e 6465 785d 2066 6f72 2069 6e64  d[index] for ind
-00048520: 2069 6e20 7365 6c66 2e6c 6973 745f 696e   in self.list_in
-00048530: 6469 6365 735d 0a20 2020 2020 2020 2020  dices].         
-00048540: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00048550: 2020 2020 7265 7475 726e 2075 6978 0a20      return uix. 
-00048560: 2020 200a 2020 2020 0a20 2020 2064 6566     .    .    def
-00048570: 205f 5f69 7465 725f 5f28 7365 6c66 293a   __iter__(self):
-00048580: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00048590: 2020 2020 2049 7465 7261 626c 6520 6f76       Iterable ov
-000485a0: 6572 2060 7661 6c75 6573 6020 6174 7472  er `values` attr
-000485b0: 6962 7574 650a 2020 2020 2020 2020 0a20  ibute.        . 
-000485c0: 2020 2020 2020 2052 6574 7572 6e73 2061         Returns a
-000485d0: 2074 7570 6c65 206f 6620 7468 6520 7661   tuple of the va
-000485e0: 6c75 6520 616e 6420 7468 6520 626f 6f6c  lue and the bool
-000485f0: 6561 6e20 7365 6c65 6374 696f 6e20 6172  ean selection ar
-00048600: 7261 7920 666f 7220 7468 6174 200a 2020  ray for that .  
-00048610: 2020 2020 2020 7661 6c75 652e 0a20 2020        value..   
-00048620: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00048630: 2069 203d 2030 0a20 2020 2020 2020 2077   i = 0.        w
-00048640: 6869 6c65 2069 203c 2073 656c 662e 4e3a  hile i < self.N:
-00048650: 0a20 2020 2020 2020 2020 2020 2076 6920  .            vi 
-00048660: 3d20 7365 6c66 2e76 616c 7565 735b 695d  = self.values[i]
-00048670: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
-00048680: 6c64 2028 7669 2c20 7365 6c66 5b76 695d  ld (vi, self[vi]
-00048690: 290a 2020 2020 2020 2020 2020 2020 6920  ).            i 
-000486a0: 2b3d 2031 0a0a 0a20 2020 2064 6566 205f  += 1...    def _
-000486b0: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
-000486c0: 206b 6579 293a 0a20 2020 2020 2020 2069   key):.        i
-000486d0: 6620 6b65 7920 696e 2073 656c 662e 7661  f key in self.va
-000486e0: 6c75 6573 3a0a 2020 2020 2020 2020 2020  lues:.          
-000486f0: 2020 6978 203d 2073 656c 662e 7661 6c75    ix = self.valu
-00048700: 6573 2e69 6e64 6578 286b 6579 290a 2020  es.index(key).  
-00048710: 2020 2020 2020 2020 2020 7465 7374 203d            test =
-00048720: 2073 656c 662e 696e 6469 6365 7320 3d3d   self.indices ==
-00048730: 2069 780a 2020 2020 2020 2020 2020 2020   ix.            
-00048740: 7265 7475 726e 2074 6573 740a 2020 2020  return test.    
-00048750: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00048760: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00048770: 662e 7a65 726f 730a 0a0a 2020 2020 6465  f.zeros...    de
-00048780: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 293a  f __len__(self):
-00048790: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000487a0: 7365 6c66 2e4e 0a0a 0a63 6c61 7373 2048  self.N...class H
-000487b0: 7562 626c 6558 595a 286f 626a 6563 7429  ubbleXYZ(object)
-000487c0: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
-000487d0: 5f5f 2873 656c 662c 2073 7074 5f66 696c  __(self, spt_fil
-000487e0: 653d 2727 2c20 7061 7261 6d5f 6469 6374  e='', param_dict
-000487f0: 3d7b 7d29 3a0a 2020 2020 2020 2020 2222  ={}):.        ""
-00048800: 220a 2020 2020 2020 2020 4865 6c70 6572  ".        Helper
-00048810: 2074 6f20 636f 6d70 7574 6520 4853 5420   to compute HST 
-00048820: 6765 6f63 656e 7472 6963 2063 6f6f 7264  geocentric coord
-00048830: 696e 6174 6573 2066 726f 6d20 6f72 6269  inates from orbi
-00048840: 7461 6c20 7061 7261 6d65 7465 7273 0a20  tal parameters. 
-00048850: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00048860: 2874 6573 7469 6e67 290a 2020 2020 2020  (testing).      
-00048870: 2020 0a20 2020 2020 2020 2042 6173 6564    .        Based
-00048880: 206f 6e20 6874 7470 3a2f 2f61 7274 6963   on http://artic
-00048890: 6c65 732e 6164 7361 6273 2e68 6172 7661  les.adsabs.harva
-000488a0: 7264 2e65 6475 2f2f 6675 6c6c 2f31 3939  rd.edu//full/199
-000488b0: 3541 5350 432e 2e2e 3737 2e2e 3436 3441  5ASPC...77..464A
-000488c0: 2f0a 2020 2020 2020 2020 2222 220a 2020  /.        """.  
-000488d0: 2020 2020 2020 6966 2073 7074 5f66 696c        if spt_fil
-000488e0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-000488f0: 656c 662e 7061 7261 6d5f 6469 6374 203d  elf.param_dict =
-00048900: 2073 656c 662e 7061 7273 655f 6672 6f6d   self.parse_from
-00048910: 5f73 7074 2873 7074 5f66 696c 6529 0a20  _spt(spt_file). 
-00048920: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00048930: 656c 6966 2070 6172 616d 5f64 6963 743a  elif param_dict:
-00048940: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00048950: 662e 7061 7261 6d5f 6469 6374 203d 2070  f.param_dict = p
-00048960: 6172 616d 5f64 6963 740a 2020 2020 2020  aram_dict.      
-00048970: 2020 0a20 2020 2020 2020 2065 6c73 653a    .        else:
-00048980: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00048990: 662e 7061 7261 6d5f 6469 6374 203d 207b  f.param_dict = {
-000489a0: 7d0a 2020 2020 2020 2020 0a20 2020 2020  }.        .     
-000489b0: 2020 2073 656c 662e 636f 6d70 7574 6564     self.computed
-000489c0: 203d 207b 7d0a 0a0a 2020 2020 4070 726f   = {}...    @pro
-000489d0: 7065 7274 7920 0a20 2020 2064 6566 205f  perty .    def _
-000489e0: 7431 3938 3528 7365 6c66 293a 0a20 2020  t1985(self):.   
-000489f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00048a00: 2052 6566 6572 656e 6365 2074 696d 650a   Reference time.
+00040a00: 2020 2069 6620 7573 655f 6a73 6f6e 3a0a     if use_json:.
+00040a10: 2020 2020 2020 2020 2020 2020 2320 5772              # Wr
+00040a20: 6974 6520 6173 206a 736f 6e0a 0a20 2020  ite as json..   
+00040a30: 2020 2020 2020 2020 2023 2057 6f72 6b61           # Worka
+00040a40: 726f 756e 6420 746f 2067 6574 2061 7363  round to get asc
+00040a50: 6969 2066 6f72 6d61 7474 696e 670a 2020  ii formatting.  
+00040a60: 2020 2020 2020 2020 2020 2370 6420 3d20            #pd = 
+00040a70: 7365 6c66 2e74 6f5f 7061 6e64 6173 2829  self.to_pandas()
+00040a80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00040a90: 203d 2047 5461 626c 6528 290a 2020 2020   = GTable().    
+00040aa0: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
+00040ab0: 2073 656c 662e 636f 6c6e 616d 6573 3a0a   self.colnames:.
+00040ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ad0: 6e65 775b 635d 203d 2073 656c 665b 635d  new[c] = self[c]
+00040ae0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00040af0: 2027 616c 6164 696e 2720 696e 2073 656c   'aladin' in sel
+00040b00: 662e 636f 6c6e 616d 6573 3a0a 2020 2020  f.colnames:.    
+00040b10: 2020 2020 2020 2020 2020 2020 7064 203d              pd =
+00040b20: 2047 5461 626c 6528 6e65 7729 2e74 6f5f   GTable(new).to_
+00040b30: 7061 6e64 6173 2829 0a20 2020 2020 2020  pandas().       
+00040b40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00040b50: 2020 2020 2020 2020 2020 206e 6577 2e77             new.w
+00040b60: 7269 7465 2827 2f74 6d70 2f74 6162 6c65  rite('/tmp/table
+00040b70: 2e63 7376 272c 2066 6f72 6d61 743d 2763  .csv', format='c
+00040b80: 7376 272c 206f 7665 7277 7269 7465 3d54  sv', overwrite=T
+00040b90: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00040ba0: 2020 2020 2070 6420 3d20 4754 6162 6c65       pd = GTable
+00040bb0: 2e67 7265 6164 2827 2f74 6d70 2f74 6162  .gread('/tmp/tab
+00040bc0: 6c65 2e63 7376 2729 2e74 6f5f 7061 6e64  le.csv').to_pand
+00040bd0: 6173 2829 0a0a 2020 2020 2020 2020 2020  as()..          
+00040be0: 2020 2320 5265 666f 726d 6174 2074 6f20    # Reformat to 
+00040bf0: 6a73 6f6e 0a20 2020 2020 2020 2020 2020  json.           
+00040c00: 206a 736f 6e5f 6461 7461 203d 2027 2020   json_data = '  
+00040c10: 2020 2020 2020 2720 2b20 7064 2e74 6f5f        ' + pd.to_
+00040c20: 6a73 6f6e 286f 7269 656e 743d 2776 616c  json(orient='val
+00040c30: 7565 7327 292e 7265 706c 6163 6528 275d  ues').replace(']
+00040c40: 2c5b 272c 2027 5c6e 2020 2020 5d78 7878  ,[', '\n    ]xxx
+00040c50: 7878 785c 6e20 2020 205b 5c6e 2020 2020  xxx\n    [\n    
+00040c60: 2020 2020 2729 2e72 6570 6c61 6365 2827      ').replace('
+00040c70: 2c20 272c 2027 7863 6f6d 6d61 7370 6163  , ', 'xcommaspac
+00040c80: 6578 2729 2e72 6570 6c61 6365 2827 2c27  ex').replace(','
+00040c90: 2c20 272c 5c6e 2020 2020 2020 2020 2729  , ',\n        ')
+00040ca0: 2e72 6570 6c61 6365 2827 7878 7878 7878  .replace('xxxxxx
+00040cb0: 272c 2027 2c27 292e 7265 706c 6163 6528  ', ',').replace(
+00040cc0: 2778 636f 6d6d 6173 7061 6365 7827 2c20  'xcommaspacex', 
+00040cd0: 272c 2027 290a 2020 2020 2020 2020 2020  ', ').          
+00040ce0: 2020 6a73 6f6e 5f73 7472 203d 2022 2222    json_str = """
+00040cf0: 7b7b 0a20 2022 6461 7461 223a 0a7b 307d  {{.  "data":.{0}
+00040d00: 0a0a 7d7d 0a22 2222 2e66 6f72 6d61 7428  ..}}.""".format(
+00040d10: 6a73 6f6e 5f64 6174 612e 7265 706c 6163  json_data.replac
+00040d20: 6528 275c 5c22 2227 2c20 2722 2729 290a  e('\\""', '"')).
+00040d30: 0a20 2020 2020 2020 2020 2020 2066 7020  .            fp 
+00040d40: 3d20 6f70 656e 286f 7574 7075 742e 7265  = open(output.re
+00040d50: 706c 6163 6528 272e 6874 6d6c 272c 2027  place('.html', '
+00040d60: 2e6a 736f 6e27 292c 2027 7727 290a 2020  .json'), 'w').  
+00040d70: 2020 2020 2020 2020 2020 6670 2e77 7269            fp.wri
+00040d80: 7465 286a 736f 6e5f 7374 7229 0a20 2020  te(json_str).   
+00040d90: 2020 2020 2020 2020 2066 702e 636c 6f73           fp.clos
+00040da0: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
+00040db0: 2023 2045 6469 7420 4854 4d4c 2066 696c   # Edit HTML fil
+00040dc0: 650a 2020 2020 2020 2020 2020 2020 6c69  e.            li
+00040dd0: 6e65 7320 3d20 6f70 656e 286f 7574 7075  nes = open(outpu
+00040de0: 7429 2e72 6561 646c 696e 6573 2829 0a0a  t).readlines()..
+00040df0: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
+00040e00: 6420 616a 6178 2063 616c 6c20 746f 2044  d ajax call to D
+00040e10: 6174 6154 6162 6c65 0a20 2020 2020 2020  ataTable.       
+00040e20: 2020 2020 2066 6f72 2069 6c2c 206c 696e       for il, lin
+00040e30: 6520 696e 2065 6e75 6d65 7261 7465 286c  e in enumerate(l
+00040e40: 696e 6573 293a 0a20 2020 2020 2020 2020  ines):.         
+00040e50: 2020 2020 2020 2069 6620 2770 6167 654c         if 'pageL
+00040e60: 656e 6774 6827 2069 6e20 6c69 6e65 3a0a  ength' in line:.
+00040e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040e80: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
+00040e90: 2020 2020 2020 2061 6a61 785f 6361 6c6c         ajax_call
+00040ea0: 203d 2027 7b73 7061 6365 727d 2261 6a61   = '{spacer}"aja
+00040eb0: 7822 3a20 227b 6a73 6f6e 7d22 2c5c 6e7b  x": "{json}",\n{
+00040ec0: 7370 6163 6572 7d22 6465 6665 7252 656e  spacer}"deferRen
+00040ed0: 6465 7222 3a20 7472 7565 2c5c 6e27 2e66  der": true,\n'.f
+00040ee0: 6f72 6d61 7428 7370 6163 6572 3d27 2027  ormat(spacer=' '
+00040ef0: 2a38 2c20 6a73 6f6e 3d6f 7574 7075 742e  *8, json=output.
+00040f00: 7265 706c 6163 6528 272e 6874 6d6c 272c  replace('.html',
+00040f10: 2027 2e6a 736f 6e27 2929 0a20 2020 2020   '.json')).     
+00040f20: 2020 2020 2020 206c 696e 6573 2e69 6e73         lines.ins
+00040f30: 6572 7428 696c 2b31 2c20 616a 6178 5f63  ert(il+1, ajax_c
+00040f40: 616c 6c29 0a20 2020 2020 2020 2020 2020  all).           
+00040f50: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
+00040f60: 5374 7269 7020 6f75 7420 7461 626c 6520  Strip out table 
+00040f70: 626f 6479 0a20 2020 2020 2020 2020 2020  body.           
+00040f80: 2066 6f72 2069 6865 6164 2c20 6c69 6e65   for ihead, line
+00040f90: 2069 6e20 656e 756d 6572 6174 6528 6c69   in enumerate(li
+00040fa0: 6e65 7329 3a0a 2020 2020 2020 2020 2020  nes):.          
+00040fb0: 2020 2020 2020 6966 2027 3c2f 7468 6561        if '</thea
+00040fc0: 643e 2720 696e 206c 696e 653a 0a20 2020  d>' in line:.   
+00040fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040fe0: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
+00040ff0: 2020 2020 666f 7220 6974 6169 6c2c 206c      for itail, l
+00041000: 696e 6520 696e 2065 6e75 6d65 7261 7465  ine in enumerate
+00041010: 286c 696e 6573 5b3a 3a2d 315d 293a 0a20  (lines[::-1]):. 
+00041020: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00041030: 6620 273c 2f74 723e 2720 696e 206c 696e  f '</tr>' in lin
+00041040: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00041050: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
+00041060: 2020 2020 2020 2020 2020 6670 203d 206f            fp = o
+00041070: 7065 6e28 6f75 7470 7574 2c20 2777 2729  pen(output, 'w')
+00041080: 0a20 2020 2020 2020 2020 2020 2066 702e  .            fp.
+00041090: 7772 6974 656c 696e 6573 286c 696e 6573  writelines(lines
+000410a0: 5b3a 6968 6561 642b 315d 290a 2020 2020  [:ihead+1]).    
+000410b0: 2020 2020 2020 2020 6670 2e77 7269 7465          fp.write
+000410c0: 6c69 6e65 7328 6c69 6e65 735b 2d69 7461  lines(lines[-ita
+000410d0: 696c 3a5d 290a 2020 2020 2020 2020 2020  il:]).          
+000410e0: 2020 6670 2e63 6c6f 7365 2829 0a0a 0a64    fp.close()...d
+000410f0: 6566 2063 6f6c 756d 6e5f 7374 7269 6e67  ef column_string
+00041100: 5f6f 7065 7261 7469 6f6e 2863 6f6c 2c20  _operation(col, 
+00041110: 7465 7374 2c20 6d65 7468 6f64 3d27 636f  test, method='co
+00041120: 6e74 6169 6e73 272c 206c 6f67 6963 616c  ntains', logical
+00041130: 3d27 6f72 2729 3a0a 2020 2020 2222 220a  ='or'):.    """.
+00041140: 2020 2020 416e 616c 6f67 6f75 7320 746f      Analogous to
+00041150: 2060 6073 7472 2e63 6f6e 7461 696e 7360   ``str.contains`
+00041160: 6020 6275 7420 666f 7220 7461 626c 6520  ` but for table 
+00041170: 636f 6c75 6d6e 2e0a 0a20 2020 2050 6172  column...    Par
+00041180: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00041190: 2d2d 2d2d 2d2d 0a20 2020 2063 6f6c 203a  ------.    col :
+000411a0: 2069 7465 7261 626c 6520 6c69 7374 206f   iterable list o
+000411b0: 6620 7374 7269 6e67 730a 2020 2020 2020  f strings.      
+000411c0: 2020 4c69 7374 206f 6620 7374 7269 6e67    List of string
+000411d0: 7320 746f 2074 6573 742e 2020 416e 7974  s to test.  Anyt
+000411e0: 6869 6e67 2069 7465 7261 626c 652c 2065  hing iterable, e
+000411f0: 2e67 2e2c 206c 6973 7420 6f72 200a 2020  .g., list or .  
+00041200: 2020 2020 2020 607e 6173 7472 6f70 792e        `~astropy.
+00041210: 7461 626c 652e 636f 6c75 6d6e 2e43 6f6c  table.column.Col
+00041220: 756d 6e60 2e0a 0a20 2020 2074 6573 7420  umn`...    test 
+00041230: 3a20 7374 722c 206c 6973 7420 6f66 2073  : str, list of s
+00041240: 7472 696e 6773 2c20 4e6f 6e65 2c20 6f72  trings, None, or
+00041250: 2073 6c69 6365 0a0a 2020 2020 2020 2020   slice..        
+00041260: 4966 2060 6074 6573 7460 6020 6973 2061  If ``test`` is a
+00041270: 2073 7472 696e 672c 206f 7220 6c69 7374   string, or list
+00041280: 206f 6620 7374 7269 6e67 732c 2074 6865   of strings, the
+00041290: 6e20 7275 6e20 7468 6520 7374 7269 6e67  n run the string
+000412a0: 0a20 2020 2020 2020 2060 606d 6574 686f  .        ``metho
+000412b0: 6460 6020 6f6e 2065 6163 6820 656e 7472  d`` on each entr
+000412c0: 7920 6f66 2060 6063 6f6c 6060 2077 6974  y of ``col`` wit
+000412d0: 6820 6060 7465 7374 6060 2061 7320 7468  h ``test`` as th
+000412e0: 6520 6172 6775 6d65 6e74 206f 720a 2020  e argument or.  
+000412f0: 2020 2020 2020 6561 6368 2065 6c65 6d65        each eleme
+00041300: 6e74 206f 6620 7468 6520 6060 7465 7374  nt of the ``test
+00041310: 6060 206c 6973 7420 6173 2061 7267 756d  `` list as argum
+00041320: 656e 7473 2e0a 0a20 2020 2020 2020 2049  ents...        I
+00041330: 6620 6060 7465 7374 6060 2069 7320 4e6f  f ``test`` is No
+00041340: 6e65 2c20 7275 6e20 606d 6574 686f 6460  ne, run `method`
+00041350: 206f 6e20 6561 6368 2065 6e74 7279 2077   on each entry w
+00041360: 6974 6820 6e6f 2061 7267 756d 656e 7473  ith no arguments
+00041370: 2c20 0a20 2020 2020 2020 2065 2e67 2e2c  , .        e.g.,
+00041380: 2027 7570 7065 7227 2e0a 0a20 2020 2020   'upper'...     
+00041390: 2020 2049 6620 6060 7465 7374 6060 2069     If ``test`` i
+000413a0: 7320 6120 6060 736c 6963 6560 602c 2072  s a ``slice``, r
+000413b0: 6574 7572 6e20 736c 6963 6564 2073 7472  eturn sliced str
+000413c0: 696e 6773 2066 6f72 2065 6163 6820 656e  ings for each en
+000413d0: 7472 792e 0a0a 2020 2020 6d65 7468 6f64  try...    method
+000413e0: 203a 2073 7472 0a20 2020 2020 2020 2053   : str.        S
+000413f0: 7472 696e 6720 6d65 7468 6f64 2074 6f20  tring method to 
+00041400: 6170 706c 7920 746f 2065 6163 6820 656e  apply to each en
+00041410: 7472 7920 6f66 2060 6063 6f6c 6060 2e20  try of ``col``. 
+00041420: 2045 2e67 2e2c 2027 636f 6e74 6169 6e73   E.g., 'contains
+00041430: 272c 0a20 2020 2020 2020 2027 7374 6172  ',.        'star
+00041440: 7473 7769 7468 272c 2027 656e 6473 7769  tswith', 'endswi
+00041450: 7468 272c 2027 696e 6465 7827 2e0a 0a20  th', 'index'... 
+00041460: 2020 206c 6f67 6963 616c 203a 205b 276f     logical : ['o
+00041470: 7227 2c27 616e 6427 2c27 6e6f 7427 5d0a  r','and','not'].
+00041480: 2020 2020 2020 2020 4c6f 6769 6361 6c20          Logical 
+00041490: 7465 7374 2074 6f20 7573 6520 7768 656e  test to use when
+000414a0: 2060 6074 6573 7460 6020 6973 2061 206c   ``test`` is a l
+000414b0: 6973 7420 6f66 2073 7472 696e 6773 2e20  ist of strings. 
+000414c0: 2046 6f72 2065 7861 6d70 6c65 2c0a 2020   For example,.  
+000414d0: 2020 2020 2020 6966 2079 6f75 2077 616e        if you wan
+000414e0: 7420 746f 2074 6573 7420 6966 2074 6865  t to test if the
+000414f0: 2063 6f6c 756d 6e20 6861 7320 7661 6c75   column has valu
+00041500: 6573 2074 6861 7420 6d61 7463 6820 6569  es that match ei
+00041510: 7468 6572 0a20 2020 2020 2020 2027 7661  ther.        'va
+00041520: 6c75 6531 2720 6f72 2027 7661 6c75 6532  lue1' or 'value2
+00041530: 272c 2074 6865 6e20 7275 6e20 7769 7468  ', then run with
+00041540: 0a0a 2020 2020 2020 2020 2020 2020 3e3e  ..            >>
+00041550: 3e20 7265 7320 3d20 636f 6c75 6d6e 5f74  > res = column_t
+00041560: 6f5f 7374 7269 6e67 5f6f 7065 7261 7469  o_string_operati
+00041570: 6f6e 2863 6f6c 2c20 5b27 7661 6c75 6531  on(col, ['value1
+00041580: 272c 2776 616c 7565 3227 5d2c 206d 6574  ','value2'], met
+00041590: 686f 643d 2763 6f6e 7461 696e 7327 2c20  hod='contains', 
+000415a0: 6c6f 6769 6361 6c3d 276f 7227 290a 0a20  logical='or').. 
+000415b0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+000415c0: 2d2d 2d2d 2d2d 0a20 2020 2072 6573 756c  ------.    resul
+000415d0: 7420 3a20 6c69 7374 0a20 2020 2020 2020  t : list.       
+000415e0: 204c 6973 7420 6f66 2069 7465 7261 7465   List of iterate
+000415f0: 6420 7265 7375 6c74 7320 6f6e 2074 6865  d results on the
+00041600: 2065 6e74 7269 6573 206f 6620 6060 636f   entries of ``co
+00041610: 6c60 602c 2065 2e67 2e2c 206c 6973 7420  l``, e.g., list 
+00041620: 6f66 200a 2020 2020 2020 2020 6060 626f  of .        ``bo
+00041630: 6f6c 6060 206f 7220 6060 7374 7269 6e67  ol`` or ``string
+00041640: 6060 2e0a 0a20 2020 2022 2222 0a20 2020  ``...    """.   
+00041650: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
+00041660: 6573 742c 206c 6973 7429 3a0a 2020 2020  est, list):.    
+00041670: 2020 2020 7465 7374 5f6c 6973 7420 3d20      test_list = 
+00041680: 7465 7374 0a20 2020 2065 6c73 653a 0a20  test.    else:. 
+00041690: 2020 2020 2020 2074 6573 745f 6c69 7374         test_list
+000416a0: 203d 205b 7465 7374 5d0a 0a20 2020 206f   = [test]..    o
+000416b0: 7574 5f74 6573 7420 3d20 5b5d 0a0a 2020  ut_test = []..  
+000416c0: 2020 666f 7220 692c 2063 5f69 2069 6e20    for i, c_i in 
+000416d0: 656e 756d 6572 6174 6528 636f 6c29 3a0a  enumerate(col):.
+000416e0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000416f0: 7461 6e63 6528 7465 7374 2c20 736c 6963  tance(test, slic
+00041700: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00041710: 6f75 745f 7465 7374 2e61 7070 656e 6428  out_test.append(
+00041720: 635f 695b 7465 7374 5d29 0a20 2020 2020  c_i[test]).     
+00041730: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00041740: 0a20 2020 2020 2020 2066 756e 6320 3d20  .        func = 
+00041750: 6765 7461 7474 7228 635f 692c 206d 6574  getattr(c_i, met
+00041760: 686f 6429 0a20 2020 2020 2020 2069 6620  hod).        if 
+00041770: 7465 7374 2069 7320 4e6f 6e65 3a0a 2020  test is None:.  
+00041780: 2020 2020 2020 2020 2020 6f75 745f 7465            out_te
+00041790: 7374 2e61 7070 656e 6428 6675 6e63 2829  st.append(func()
+000417a0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+000417b0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+000417c0: 6c69 7374 5f69 203d 205b 5d0a 2020 2020  list_i = [].    
+000417d0: 2020 2020 666f 7220 745f 6920 696e 2074      for t_i in t
+000417e0: 6573 745f 6c69 7374 3a0a 2020 2020 2020  est_list:.      
+000417f0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00041800: 2020 2020 2020 2020 2020 206c 6973 745f             list_
+00041810: 692e 6170 7065 6e64 2866 756e 6328 745f  i.append(func(t_
+00041820: 6929 290a 2020 2020 2020 2020 2020 2020  i)).            
+00041830: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00041840: 2020 2020 2020 2020 6c69 7374 5f69 2e61          list_i.a
+00041850: 7070 656e 6428 4661 6c73 6529 0a0a 2020  ppend(False)..  
+00041860: 2020 2020 2020 6f75 745f 7465 7374 2e61        out_test.a
+00041870: 7070 656e 6428 6c69 7374 5f69 290a 0a20  ppend(list_i).. 
+00041880: 2020 2061 7272 203d 206e 702e 6172 7261     arr = np.arra
+00041890: 7928 6f75 745f 7465 7374 290a 2020 2020  y(out_test).    
+000418a0: 7368 203d 2061 7272 2e73 6861 7065 0a0a  sh = arr.shape..
+000418b0: 2020 2020 6966 206c 6f67 6963 616c 2069      if logical i
+000418c0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000418d0: 7265 7475 726e 206e 702e 7371 7565 657a  return np.squeez
+000418e0: 6528 6172 7229 0a20 2020 2065 6c69 6620  e(arr).    elif 
+000418f0: 6c6f 6769 6361 6c2e 7570 7065 7228 2920  logical.upper() 
+00041900: 3d3d 2027 414e 4427 3a0a 2020 2020 2020  == 'AND':.      
+00041910: 2020 7265 7475 726e 206e 702e 7375 6d28    return np.sum(
+00041920: 6172 722c 2061 7869 733d 3129 203e 3d20  arr, axis=1) >= 
+00041930: 7368 5b31 5d0a 2020 2020 656c 6966 206c  sh[1].    elif l
+00041940: 6f67 6963 616c 2e75 7070 6572 2829 203d  ogical.upper() =
+00041950: 3d20 274e 4f54 273a 0a20 2020 2020 2020  = 'NOT':.       
+00041960: 2072 6574 7572 6e20 6e70 2e73 756d 2861   return np.sum(a
+00041970: 7272 2c20 6178 6973 3d31 2920 3d3d 2030  rr, axis=1) == 0
+00041980: 0a20 2020 2065 6c73 653a 2020 2320 4f52  .    else:  # OR
+00041990: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000419a0: 6e70 2e73 756d 2861 7272 2c20 6178 6973  np.sum(arr, axis
+000419b0: 3d31 2920 3e20 300a 0a0a 6465 6620 636f  =1) > 0...def co
+000419c0: 6c75 6d6e 5f76 616c 7565 735f 696e 5f6c  lumn_values_in_l
+000419d0: 6973 7428 636f 6c2c 2074 6573 745f 6c69  ist(col, test_li
+000419e0: 7374 293a 0a20 2020 2022 2222 5465 7374  st):.    """Test
+000419f0: 2069 6620 636f 6c75 6d6e 2065 6c65 6d65   if column eleme
+00041a00: 6e74 7320 2269 6e22 2061 6e20 6974 6572  nts "in" an iter
+00041a10: 6162 6c65 2028 652e 672e 2c20 6120 6c69  able (e.g., a li
+00041a20: 7374 206f 6620 7374 7269 6e67 7329 0a0a  st of strings)..
+00041a30: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00041a40: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00041a50: 2020 636f 6c20 3a20 6061 7374 726f 7079    col : `astropy
+00041a60: 2e74 6162 6c65 2e43 6f6c 756d 6e60 206f  .table.Column` o
+00041a70: 7220 6f74 6865 7220 6974 6572 6162 6c65  r other iterable
+00041a80: 0a20 2020 2020 2020 2047 726f 7570 206f  .        Group o
+00041a90: 6620 656e 7472 6965 7320 746f 2074 6573  f entries to tes
+00041aa0: 740a 0a20 2020 2074 6573 745f 6c69 7374  t..    test_list
+00041ab0: 203a 2069 7465 7261 626c 650a 2020 2020   : iterable.    
+00041ac0: 2020 2020 4c69 7374 206f 6620 7661 6c75      List of valu
+00041ad0: 6573 2074 6f20 7365 6172 6368 0a0a 2020  es to search..  
+00041ae0: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00041af0: 2d2d 2d2d 2d0a 2020 2020 7465 7374 203a  -----.    test :
+00041b00: 2062 6f6f 6c20 6172 7261 790a 2020 2020   bool array.    
+00041b10: 2020 2020 5369 6d70 6c65 2074 6573 743a      Simple test:
+00041b20: 0a20 2020 2020 2020 2020 2020 203e 3e3e  .            >>>
+00041b30: 205b 635f 6920 696e 2074 6573 745f 6c69   [c_i in test_li
+00041b40: 7374 2066 6f72 2063 5f69 2069 6e20 636f  st for c_i in co
+00041b50: 6c5d 0a20 2020 2022 2222 0a20 2020 2074  l].    """.    t
+00041b60: 6573 7420 3d20 6e70 2e61 7272 6179 285b  est = np.array([
+00041b70: 635f 6920 696e 2074 6573 745f 6c69 7374  c_i in test_list
+00041b80: 2066 6f72 2063 5f69 2069 6e20 636f 6c5d   for c_i in col]
+00041b90: 290a 2020 2020 7265 7475 726e 2074 6573  ).    return tes
+00041ba0: 740a 0a0a 6465 6620 6669 6c6c 5f62 6574  t...def fill_bet
+00041bb0: 7765 656e 5f73 7465 7073 2878 2c20 7930  ween_steps(x, y0
+00041bc0: 2c20 7931 2c20 6178 3d4e 6f6e 652c 202a  , y1, ax=None, *
+00041bd0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+00041be0: 0a20 2020 2022 2222 0a20 2020 204d 616b  .    """.    Mak
+00041bf0: 6520 6066 696c 6c5f 6265 7477 6565 6e60  e `fill_between`
+00041c00: 2077 6f72 6b20 6c69 6b65 206c 696e 6573   work like lines
+00041c10: 7479 6c65 3d27 7374 6570 732d 6d69 6427  tyle='steps-mid'
+00041c20: 2e0a 2020 2020 2222 220a 2020 2020 696d  ..    """.    im
+00041c30: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
+00041c40: 7079 706c 6f74 2061 7320 706c 740a 2020  pyplot as plt.  
+00041c50: 2020 0a20 2020 2073 6f20 3d20 6e70 2e61    .    so = np.a
+00041c60: 7267 736f 7274 2878 290a 2020 2020 6478  rgsort(x).    dx
+00041c70: 203d 206e 702e 6469 6666 2878 5b73 6f5d   = np.diff(x[so]
+00041c80: 292f 322e 0a20 2020 206d 6964 203d 2078  )/2..    mid = x
+00041c90: 5b73 6f5d 5b3a 2d31 5d20 2b20 6478 0a20  [so][:-1] + dx. 
+00041ca0: 2020 200a 2020 2020 7866 756c 6c20 3d20     .    xfull = 
+00041cb0: 6e70 2e68 7374 6163 6b28 5b78 5b73 6f5d  np.hstack([x[so]
+00041cc0: 5b30 5d2d 6478 5b30 5d2c 206d 6964 2c20  [0]-dx[0], mid, 
+00041cd0: 6d69 642b 6478 2a32 2f31 2e65 362c 2078  mid+dx*2/1.e6, x
+00041ce0: 5b73 6f5d 5b2d 315d 2b64 785b 2d31 5d5d  [so][-1]+dx[-1]]
+00041cf0: 290a 2020 2020 7930 6675 6c6c 203d 206e  ).    y0full = n
+00041d00: 702e 6873 7461 636b 285b 7930 5b30 5d2c  p.hstack([y0[0],
+00041d10: 2079 305b 3a2d 315d 2c20 7930 5b31 3a5d   y0[:-1], y0[1:]
+00041d20: 2c20 7930 5b2d 315d 5d29 0a20 2020 2079  , y0[-1]]).    y
+00041d30: 3166 756c 6c20 3d20 6e70 2e68 7374 6163  1full = np.hstac
+00041d40: 6b28 5b79 315b 305d 2c20 7931 5b3a 2d31  k([y1[0], y1[:-1
+00041d50: 5d2c 2079 315b 313a 5d2c 2079 315b 2d31  ], y1[1:], y1[-1
+00041d60: 5d5d 290a 2020 2020 0a20 2020 2023 2078  ]]).    .    # x
+00041d70: 6675 6c6c 203d 206e 702e 6170 7065 6e64  full = np.append
+00041d80: 286e 702e 6170 7065 6e64 2878 2c20 6d69  (np.append(x, mi
+00041d90: 6429 2c20 6d69 642b 6e70 2e64 6966 6628  d), mid+np.diff(
+00041da0: 785b 736f 5d29 2f31 2e65 3629 0a20 2020  x[so])/1.e6).   
+00041db0: 2023 2079 3066 756c 6c20 3d20 6e70 2e61   # y0full = np.a
+00041dc0: 7070 656e 6428 6e70 2e61 7070 656e 6428  ppend(np.append(
+00041dd0: 7930 2c20 7930 5b3a 2d31 5d29 2c20 7930  y0, y0[:-1]), y0
+00041de0: 5b31 3a5d 290a 2020 2020 2320 7931 6675  [1:]).    # y1fu
+00041df0: 6c6c 203d 206e 702e 6170 7065 6e64 286e  ll = np.append(n
+00041e00: 702e 6170 7065 6e64 2879 312c 2079 315b  p.append(y1, y1[
+00041e10: 3a2d 315d 292c 2079 315b 313a 5d29 0a0a  :-1]), y1[1:])..
+00041e20: 2020 2020 736f 203d 206e 702e 6172 6773      so = np.args
+00041e30: 6f72 7428 7866 756c 6c29 0a20 2020 2069  ort(xfull).    i
+00041e40: 6620 6178 2069 7320 4e6f 6e65 3a0a 2020  f ax is None:.  
+00041e50: 2020 2020 2020 6178 203d 2070 6c74 2e67        ax = plt.g
+00041e60: 6361 2829 0a0a 2020 2020 6178 2e66 696c  ca()..    ax.fil
+00041e70: 6c5f 6265 7477 6565 6e28 7866 756c 6c5b  l_between(xfull[
+00041e80: 736f 5d2c 2079 3066 756c 6c5b 736f 5d2c  so], y0full[so],
+00041e90: 2079 3166 756c 6c5b 736f 5d2c 202a 6172   y1full[so], *ar
+00041ea0: 6773 2c20 2a2a 6b77 6172 6773 290a 0a0a  gs, **kwargs)...
+00041eb0: 6465 6620 6669 6c6c 5f6d 6173 6b65 645f  def fill_masked_
+00041ec0: 636f 7661 7228 636f 7661 722c 206d 6173  covar(covar, mas
+00041ed0: 6b29 3a0a 2020 2020 2222 2246 696c 6c20  k):.    """Fill 
+00041ee0: 6120 636f 7661 7269 616e 6365 206d 6174  a covariance mat
+00041ef0: 7269 7820 696e 2061 206c 6172 6765 7220  rix in a larger 
+00041f00: 6172 7261 7920 7468 6174 2068 6164 206d  array that had m
+00041f10: 6173 6b65 6420 7661 6c75 6573 0a0a 2020  asked values..  
+00041f20: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00041f30: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00041f40: 636f 7661 7220 3a20 6028 4d2c 4d29 6020  covar : `(M,M)` 
+00041f50: 7371 7561 7265 2060 7e6e 702e 6e64 6172  square `~np.ndar
+00041f60: 7261 7960 0a20 2020 2020 2020 204d 6173  ray`.        Mas
+00041f70: 6b65 6420 636f 7661 7269 616e 6365 2061  ked covariance a
+00041f80: 7272 6179 2e0a 0a20 2020 206d 6173 6b20  rray...    mask 
+00041f90: 3a20 626f 6f6c 206d 6173 6b2c 2060 4e3e  : bool mask, `N>
+00041fa0: 4d60 0a20 2020 2020 2020 2054 6865 206f  M`.        The o
+00041fb0: 7269 6769 6e61 6c20 6d61 736b 2e0a 0a20  riginal mask... 
+00041fc0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+00041fd0: 2d2d 2d2d 2d2d 0a20 2020 2063 6f76 6172  ------.    covar
+00041fe0: 5f66 756c 6c20 3a20 607e 6e70 2e6e 6461  _full : `~np.nda
+00041ff0: 7272 6179 600a 2020 2020 2020 2020 4675  rray`.        Fu
+00042000: 6c6c 2063 6f76 6172 6961 6e63 6520 6172  ll covariance ar
+00042010: 7261 7920 7769 7468 2064 696d 656e 7369  ray with dimensi
+00042020: 6f6e 7320 6028 4e2c 4e29 602e 0a0a 2020  ons `(N,N)`...  
+00042030: 2020 2222 220a 2020 2020 4e20 3d20 6d61    """.    N = ma
+00042040: 736b 2e73 6861 7065 5b30 5d0a 2020 2020  sk.shape[0].    
+00042050: 6964 7820 3d20 6e70 2e61 7261 6e67 6528  idx = np.arange(
+00042060: 4e29 5b6d 6173 6b5d 0a20 2020 2063 6f76  N)[mask].    cov
+00042070: 6172 5f66 756c 6c20 3d20 6e70 2e7a 6572  ar_full = np.zer
+00042080: 6f73 2828 4e2c 204e 292c 2064 7479 7065  os((N, N), dtype
+00042090: 3d63 6f76 6172 2e64 7479 7065 290a 2020  =covar.dtype).  
+000420a0: 2020 666f 7220 692c 2069 6920 696e 2065    for i, ii in e
+000420b0: 6e75 6d65 7261 7465 2869 6478 293a 0a20  numerate(idx):. 
+000420c0: 2020 2020 2020 2066 6f72 206a 2c20 6a6a         for j, jj
+000420d0: 2069 6e20 656e 756d 6572 6174 6528 6964   in enumerate(id
+000420e0: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
+000420f0: 636f 7661 725f 6675 6c6c 5b69 692c 206a  covar_full[ii, j
+00042100: 6a5d 203d 2063 6f76 6172 5b69 2c20 6a5d  j] = covar[i, j]
+00042110: 0a0a 2020 2020 7265 7475 726e 2063 6f76  ..    return cov
+00042120: 6172 5f66 756c 6c0a 0a0a 6465 6620 6c6f  ar_full...def lo
+00042130: 675f 7363 616c 655f 6473 3928 696d 2c20  g_scale_ds9(im, 
+00042140: 6c65 7870 3d31 2e65 3132 2c20 636d 6170  lexp=1.e12, cmap
+00042150: 3d5b 372e 3937 3931 372c 2030 2e38 3738  =[7.97917, 0.878
+00042160: 3034 3933 5d2c 2073 6361 6c65 3d5b 2d30  0493], scale=[-0
+00042170: 2e31 2c20 3130 5d29 3a0a 2020 2020 2222  .1, 10]):.    ""
+00042180: 220a 2020 2020 5363 616c 6520 616e 2061  ".    Scale an a
+00042190: 7272 6179 206c 696b 6520 6473 3920 6c6f  rray like ds9 lo
+000421a0: 6720 7363 616c 696e 670a 2020 2020 2222  g scaling.    ""
+000421b0: 220a 2020 2020 696d 706f 7274 206e 756d  ".    import num
+000421c0: 7079 2061 7320 6e70 0a0a 2020 2020 636f  py as np..    co
+000421d0: 6e74 7261 7374 2c20 6269 6173 203d 2063  ntrast, bias = c
+000421e0: 6d61 700a 2020 2020 636c 6970 203d 2028  map.    clip = (
+000421f0: 6e70 2e63 6c69 7028 696d 2c20 7363 616c  np.clip(im, scal
+00042200: 655b 305d 2c20 7363 616c 655b 315d 292d  e[0], scale[1])-
+00042210: 7363 616c 655b 305d 292f 2873 6361 6c65  scale[0])/(scale
+00042220: 5b31 5d2d 7363 616c 655b 305d 290a 2020  [1]-scale[0]).  
+00042230: 2020 636c 6970 5f6c 6f67 203d 206e 702e    clip_log = np.
+00042240: 636c 6970 2828 6e70 2e6c 6f67 3130 286c  clip((np.log10(l
+00042250: 6578 702a 636c 6970 2b31 292f 6e70 2e6c  exp*clip+1)/np.l
+00042260: 6f67 3130 286c 6578 7029 2d62 6961 7329  og10(lexp)-bias)
+00042270: 2a63 6f6e 7472 6173 742b 302e 352c 2030  *contrast+0.5, 0
+00042280: 2c20 3129 0a0a 2020 2020 7265 7475 726e  , 1)..    return
+00042290: 2063 6c69 705f 6c6f 670a 0a0a 6465 6620   clip_log...def 
+000422a0: 6d6f 6465 5f73 7461 7469 7374 6963 2864  mode_statistic(d
+000422b0: 6174 612c 2070 6572 6365 6e74 696c 6573  ata, percentiles
+000422c0: 3d72 616e 6765 2831 302c 2039 312c 2031  =range(10, 91, 1
+000422d0: 3029 293a 0a20 2020 2022 2222 0a20 2020  0)):.    """.   
+000422e0: 2047 6574 206d 6f64 616c 2076 616c 7565   Get modal value
+000422f0: 206f 6620 6120 6469 7374 7269 6275 7469   of a distributi
+00042300: 6f6e 206f 6620 6461 7461 2066 6f6c 6c6f  on of data follo
+00042310: 7769 6e67 2043 6f6e 6e6f 7220 6574 2061  wing Connor et a
+00042320: 6c2e 2032 3031 370a 2020 2020 6874 7470  l. 2017.    http
+00042330: 733a 2f2f 6172 7869 762e 6f72 672f 7064  s://arxiv.org/pd
+00042340: 662f 3137 3039 2e30 3139 3235 2e70 6466  f/1709.01925.pdf
+00042350: 0a0a 2020 2020 4865 7265 2077 6520 6669  ..    Here we fi
+00042360: 7420 6120 7370 6c69 6e65 2074 6f20 7468  t a spline to th
+00042370: 6520 6375 6d75 6c61 7469 7665 2064 6973  e cumulative dis
+00042380: 7472 6962 7574 696f 6e20 6576 616c 7561  tribution evalua
+00042390: 7465 6420 6174 206b 6e6f 7473 0a20 2020  ted at knots.   
+000423a0: 2073 6574 2074 6f20 7468 6520 6070 6572   set to the `per
+000423b0: 6365 6e74 696c 6573 6020 6f66 2074 6865  centiles` of the
+000423c0: 2064 6973 7472 6962 7574 696f 6e20 746f   distribution to
+000423d0: 2069 6d70 726f 7665 2073 6d6f 6f74 686e   improve smoothn
+000423e0: 6573 732e 0a20 2020 2022 2222 0a20 2020  ess..    """.   
+000423f0: 2066 726f 6d20 7363 6970 792e 696e 7465   from scipy.inte
+00042400: 7270 6f6c 6174 6520 696d 706f 7274 2055  rpolate import U
+00042410: 6e69 7661 7269 6174 6553 706c 696e 652c  nivariateSpline,
+00042420: 204c 5351 556e 6976 6172 6961 7465 5370   LSQUnivariateSp
+00042430: 6c69 6e65 0a0a 2020 2020 736f 203d 206e  line..    so = n
+00042440: 702e 6172 6773 6f72 7428 6461 7461 290a  p.argsort(data).
+00042450: 2020 2020 6f72 6465 7220 3d20 6e70 2e61      order = np.a
+00042460: 7261 6e67 6528 6c65 6e28 6461 7461 2929  range(len(data))
+00042470: 0a20 2020 2023 7370 6c20 3d20 556e 6976  .    #spl = Univ
+00042480: 6172 6961 7465 5370 6c69 6e65 2864 6174  ariateSpline(dat
+00042490: 615b 736f 5d2c 206f 7264 6572 290a 0a20  a[so], order).. 
+000424a0: 2020 206b 6e6f 7473 203d 206e 702e 7065     knots = np.pe
+000424b0: 7263 656e 7469 6c65 2864 6174 612c 2070  rcentile(data, p
+000424c0: 6572 6365 6e74 696c 6573 290a 2020 2020  ercentiles).    
+000424d0: 6478 203d 206e 702e 6469 6666 286b 6e6f  dx = np.diff(kno
+000424e0: 7473 290a 2020 2020 6d61 736b 203d 2028  ts).    mask = (
+000424f0: 6461 7461 5b73 6f5d 203e 3d20 6b6e 6f74  data[so] >= knot
+00042500: 735b 305d 2d64 785b 305d 2920 2620 2864  s[0]-dx[0]) & (d
+00042510: 6174 615b 736f 5d20 3c3d 206b 6e6f 7473  ata[so] <= knots
+00042520: 5b2d 315d 2b64 785b 2d31 5d29 0a20 2020  [-1]+dx[-1]).   
+00042530: 2073 706c 203d 204c 5351 556e 6976 6172   spl = LSQUnivar
+00042540: 6961 7465 5370 6c69 6e65 2864 6174 615b  iateSpline(data[
+00042550: 736f 5d5b 6d61 736b 5d2c 206f 7264 6572  so][mask], order
+00042560: 5b6d 6173 6b5d 2c20 6b6e 6f74 732c 2065  [mask], knots, e
+00042570: 7874 3d27 7a65 726f 7327 290a 0a20 2020  xt='zeros')..   
+00042580: 206d 6173 6b20 3d20 2864 6174 615b 736f   mask = (data[so
+00042590: 5d20 3e3d 206b 6e6f 7473 5b30 5d29 2026  ] >= knots[0]) &
+000425a0: 2028 6461 7461 5b73 6f5d 203c 3d20 6b6e   (data[so] <= kn
+000425b0: 6f74 735b 2d31 5d29 0a20 2020 2069 7820  ots[-1]).    ix 
+000425c0: 3d20 2873 706c 2864 6174 615b 736f 5d2c  = (spl(data[so],
+000425d0: 206e 753d 312c 2065 7874 3d27 7a65 726f   nu=1, ext='zero
+000425e0: 7327 292a 6d61 736b 292e 6172 676d 6178  s')*mask).argmax
+000425f0: 2829 0a20 2020 206d 6f64 6520 3d20 6461  ().    mode = da
+00042600: 7461 5b73 6f5d 5b69 785d 0a20 2020 2072  ta[so][ix].    r
+00042610: 6574 7572 6e20 6d6f 6465 0a0a 0a64 6566  eturn mode...def
+00042620: 206d 616b 655f 616c 665f 7465 6d70 6c61   make_alf_templa
+00042630: 7465 2829 3a0a 2020 2020 2222 220a 2020  te():.    """.  
+00042640: 2020 4d61 6b65 2041 6c66 202b 2046 5350    Make Alf + FSP
+00042650: 5320 7465 6d70 6c61 7465 0a20 2020 2022  S template.    "
+00042660: 2222 0a20 2020 2069 6d70 6f72 7420 616c  "".    import al
+00042670: 662e 616c 660a 2020 2020 696d 706f 7274  f.alf.    import
+00042680: 2066 7370 730a 0a20 2020 2073 7370 203d   fsps..    ssp =
+00042690: 2061 6c66 2e61 6c66 2e41 6c66 2829 0a0a   alf.alf.Alf()..
+000426a0: 2020 2020 7370 203d 2066 7370 732e 5374      sp = fsps.St
+000426b0: 656c 6c61 7250 6f70 756c 6174 696f 6e28  ellarPopulation(
+000426c0: 7a63 6f6e 7469 6e75 6f75 733d 3129 0a20  zcontinuous=1). 
+000426d0: 2020 2073 702e 7061 7261 6d73 5b27 6c6f     sp.params['lo
+000426e0: 677a 736f 6c27 5d20 3d20 302e 320a 0a20  gzsol'] = 0.2.. 
+000426f0: 2020 2023 2041 6c66 0a20 2020 206d 203d     # Alf.    m =
+00042700: 2073 7370 2e67 6574 5f6d 6f64 656c 2869   ssp.get_model(i
+00042710: 6e5f 706c 6163 653d 4661 6c73 652c 206c  n_place=False, l
+00042720: 6f67 6167 653d 302e 3936 2c20 7a68 3d30  ogage=0.96, zh=0
+00042730: 2e32 2c20 6d67 683d 302e 3229 0a0a 2020  .2, mgh=0.2)..  
+00042740: 2020 2320 4653 5053 0a20 2020 2077 2c20    # FSPS.    w, 
+00042750: 7370 6563 203d 2073 702e 6765 745f 7370  spec = sp.get_sp
+00042760: 6563 7472 756d 2874 6167 653d 3130 2a2a  ectrum(tage=10**
+00042770: 302e 3936 2c20 7065 7261 613d 5472 7565  0.96, peraa=True
+00042780: 290a 0a20 2020 2023 2062 6c75 650a 2020  )..    # blue.  
+00042790: 2020 626c 7565 5f6e 6f72 6d20 3d20 7370    blue_norm = sp
+000427a0: 6563 5b77 203e 2033 3630 305d 5b30 5d20  ec[w > 3600][0] 
+000427b0: 2f20 6d5b 7373 702e 7761 7665 203e 2033  / m[ssp.wave > 3
+000427c0: 3630 305d 5b30 5d0a 2020 2020 7265 645f  600][0].    red_
+000427d0: 6e6f 726d 203d 2073 7065 635b 7720 3e20  norm = spec[w > 
+000427e0: 312e 3765 345d 5b30 5d20 2f20 6d5b 7373  1.7e4][0] / m[ss
+000427f0: 702e 7761 7665 203e 2031 2e37 6534 5d5b  p.wave > 1.7e4][
+00042800: 305d 0a0a 2020 2020 7465 6d70 6c78 203d  0]..    templx =
+00042810: 206e 702e 6873 7461 636b 285b 775b 7720   np.hstack([w[w 
+00042820: 3c20 3336 3030 5d2c 2073 7370 2e77 6176  < 3600], ssp.wav
+00042830: 655b 2873 7370 2e77 6176 6520 3e20 3336  e[(ssp.wave > 36
+00042840: 3030 2920 2620 2873 7370 2e77 6176 6520  00) & (ssp.wave 
+00042850: 3c20 312e 3765 3429 5d2c 2077 5b77 203e  < 1.7e4)], w[w >
+00042860: 2031 2e37 6534 5d5d 290a 2020 2020 7465   1.7e4]]).    te
+00042870: 6d70 6c79 203d 206e 702e 6873 7461 636b  mply = np.hstack
+00042880: 285b 7370 6563 5b77 203c 2033 3630 305d  ([spec[w < 3600]
+00042890: 2f62 6c75 655f 6e6f 726d 2c20 6d5b 2873  /blue_norm, m[(s
+000428a0: 7370 2e77 6176 6520 3e20 3336 3030 2920  sp.wave > 3600) 
+000428b0: 2620 2873 7370 2e77 6176 6520 3c20 312e  & (ssp.wave < 1.
+000428c0: 3765 3429 5d2c 2073 7065 635b 7720 3e20  7e4)], spec[w > 
+000428d0: 312e 3765 345d 2f72 6564 5f6e 6f72 6d5d  1.7e4]/red_norm]
+000428e0: 290a 0a20 2020 206e 702e 7361 7665 7478  )..    np.savetx
+000428f0: 7428 2761 6c66 5f53 5350 2e64 6174 272c  t('alf_SSP.dat',
+00042900: 206e 702e 6172 7261 7928 5b74 656d 706c   np.array([templ
+00042910: 782c 2074 656d 706c 795d 292e 542c 2066  x, temply]).T, f
+00042920: 6d74 3d27 252e 3565 272c 2068 6561 6465  mt='%.5e', heade
+00042930: 723d 2777 6176 6520 666c 7578 5c6e 6c6f  r='wave flux\nlo
+00042940: 6761 6765 203d 2030 2e39 365c 6e7a 683d  gage = 0.96\nzh=
+00042950: 302e 325c 6e6d 6768 3d30 2e32 5c6e 6673  0.2\nmgh=0.2\nfs
+00042960: 7073 3a20 7720 3c20 3336 3030 2c20 7720  ps: w < 3600, w 
+00042970: 3e20 312e 3765 3427 290a 0a0a 6465 6620  > 1.7e4')...def 
+00042980: 6361 7461 6c6f 675f 6172 6561 2872 613d  catalog_area(ra=
+00042990: 5b5d 2c20 6465 633d 5b5d 2c20 6d61 6b65  [], dec=[], make
+000429a0: 5f70 6c6f 743d 5472 7565 2c20 4e4d 4158  _plot=True, NMAX
+000429b0: 3d35 3030 302c 2062 7566 663d 302e 382c  =5000, buff=0.8,
+000429c0: 2076 6572 626f 7365 3d54 7275 6529 3a0a   verbose=True):.
+000429d0: 2020 2020 2222 2243 6f6d 7075 7465 2074      """Compute t
+000429e0: 6865 2073 7572 6661 6365 2061 7265 6120  he surface area 
+000429f0: 6f66 2061 206c 6973 7420 6f66 2052 412f  of a list of RA/
+00042a00: 4445 4320 636f 6f72 6469 6e61 7465 730a  DEC coordinates.
+00042a10: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+00042a20: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00042a30: 2020 2072 612c 2064 6563 203a 2060 7e6e     ra, dec : `~n
+00042a40: 756d 7079 2e6e 6461 7272 6179 600a 2020  umpy.ndarray`.  
+00042a50: 2020 2020 2020 5241 2061 6e64 2044 6563        RA and Dec
+00042a60: 2e20 636f 6f72 6469 6e61 7465 7320 696e  . coordinates in
+00042a70: 2064 6563 696d 616c 2064 6567 7265 6573   decimal degrees
+00042a80: 0a0a 2020 2020 6d61 6b65 5f70 6c6f 7420  ..    make_plot 
+00042a90: 3a20 626f 6f6c 0a20 2020 2020 2020 204d  : bool.        M
+00042aa0: 616b 6520 6120 6669 6775 7265 2e0a 0a20  ake a figure... 
+00042ab0: 2020 204e 4d41 5820 3a20 696e 740a 2020     NMAX : int.  
+00042ac0: 2020 2020 2020 4966 2074 6865 2063 6174        If the cat
+00042ad0: 616c 6f67 2068 6173 206d 6f72 6520 7468  alog has more th
+00042ae0: 656e 2060 4e4d 4158 6020 656e 7472 6965  en `NMAX` entrie
+00042af0: 732c 2064 7261 7720 604e 4d41 5860 2072  s, draw `NMAX` r
+00042b00: 616e 646f 6d0a 2020 2020 2020 2020 7361  andom.        sa
+00042b10: 6d70 6c65 732e 0a0a 2020 2020 6275 6666  mples...    buff
+00042b20: 203a 2066 6c6f 6174 0a20 2020 2020 2020   : float.       
+00042b30: 2042 7566 6665 7220 696e 2061 7263 6d69   Buffer in arcmi
+00042b40: 6e20 746f 2061 6464 2061 726f 756e 6420  n to add around 
+00042b50: 6561 6368 2063 6174 616c 6f67 2070 6f69  each catalog poi
+00042b60: 6e74 2e0a 0a0a 2020 2020 5265 7475 726e  nt....    Return
+00042b70: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+00042b80: 2020 6172 6561 203a 2066 6c6f 6174 0a20    area : float. 
+00042b90: 2020 2020 2020 2043 6f6d 7075 7465 6420         Computed 
+00042ba0: 6361 7461 6c6f 6720 6172 6561 2069 6e20  catalog area in 
+00042bb0: 7371 7561 7265 2061 7263 6d69 6e75 7465  square arcminute
+00042bc0: 730a 0a20 2020 2066 6967 203a 2060 7e6d  s..    fig : `~m
+00042bd0: 6174 706c 6f74 6c69 622e 6669 6775 7265  atplotlib.figure
+00042be0: 2e46 6967 7572 6560 0a20 2020 2020 2020  .Figure`.       
+00042bf0: 2046 6967 7572 6520 6f62 6a65 6374 2072   Figure object r
+00042c00: 6574 7572 6e65 6420 6966 2060 6d61 6b65  eturned if `make
+00042c10: 5f70 6c6f 743d 3d54 7275 6560 2e0a 0a20  _plot==True`... 
+00042c20: 2020 2022 2222 0a20 2020 2069 6d70 6f72     """.    impor
+00042c30: 7420 6d61 7470 6c6f 746c 6962 2e70 7970  t matplotlib.pyp
+00042c40: 6c6f 7420 6173 2070 6c74 0a20 2020 2066  lot as plt.    f
+00042c50: 726f 6d20 7368 6170 656c 792e 6765 6f6d  rom shapely.geom
+00042c60: 6574 7279 2069 6d70 6f72 7420 506f 6c79  etry import Poly
+00042c70: 676f 6e2c 2050 6f69 6e74 2c20 4d75 6c74  gon, Point, Mult
+00042c80: 6950 6f6c 7967 6f6e 2c20 4d75 6c74 694c  iPolygon, MultiL
+00042c90: 696e 6553 7472 696e 670a 2020 2020 6672  ineString.    fr
+00042ca0: 6f6d 2073 6369 7079 2069 6d70 6f72 7420  om scipy import 
+00042cb0: 7370 6174 6961 6c0a 0a20 2020 2070 6f69  spatial..    poi
+00042cc0: 6e74 7320 3d20 6e70 2e61 7272 6179 285b  nts = np.array([
+00042cd0: 7261 2c20 6465 635d 292a 312e 0a20 2020  ra, dec])*1..   
+00042ce0: 2063 656e 7465 7220 3d20 6e70 2e6d 6561   center = np.mea
+00042cf0: 6e28 706f 696e 7473 2c20 6178 6973 3d31  n(points, axis=1
+00042d00: 290a 2020 2020 706f 696e 7473 203d 2028  ).    points = (
+00042d10: 706f 696e 7473 2e54 202d 2063 656e 7465  points.T - cente
+00042d20: 7229 2a36 302e 2020 2320 6172 636d 696e  r)*60.  # arcmin
+00042d30: 0a20 2020 2070 6f69 6e74 735b 3a2c 2030  .    points[:, 0
+00042d40: 5d20 2a3d 206e 702e 636f 7328 6365 6e74  ] *= np.cos(cent
+00042d50: 6572 5b31 5d2f 3138 302a 6e70 2e70 6929  er[1]/180*np.pi)
+00042d60: 0a0a 2020 2020 6875 6c6c 203d 2073 7061  ..    hull = spa
+00042d70: 7469 616c 2e43 6f6e 7665 7848 756c 6c28  tial.ConvexHull(
+00042d80: 706f 696e 7473 290a 2020 2020 6564 6765  points).    edge
+00042d90: 203d 2070 6f69 6e74 735b 6875 6c6c 2e76   = points[hull.v
+00042da0: 6572 7469 6365 732c 203a 5d0a 0a20 2020  ertices, :]..   
+00042db0: 2023 7062 7566 6620 3d20 310a 0a20 2020   #pbuff = 1..   
+00042dc0: 2069 6620 6c65 6e28 7261 2920 3e20 4e4d   if len(ra) > NM
+00042dd0: 4158 3a0a 2020 2020 2020 2020 726e 645f  AX:.        rnd_
+00042de0: 6964 7820 3d20 6e70 2e75 6e69 7175 6528  idx = np.unique(
+00042df0: 6e70 2e63 6173 745b 696e 745d 286e 702e  np.cast[int](np.
+00042e00: 726f 756e 6428 6e70 2e72 616e 646f 6d2e  round(np.random.
+00042e10: 7261 6e64 284e 4d41 5829 2a6c 656e 2872  rand(NMAX)*len(r
+00042e20: 6129 2929 290a 2020 2020 656c 7365 3a0a  a)))).    else:.
+00042e30: 2020 2020 2020 2020 726e 645f 6964 7820          rnd_idx 
+00042e40: 3d20 6e70 2e61 7261 6e67 6528 6c65 6e28  = np.arange(len(
+00042e50: 7261 2929 0a0a 2020 2020 706f 6c79 203d  ra))..    poly =
+00042e60: 2050 6f69 6e74 2870 6f69 6e74 735b 726e   Point(points[rn
+00042e70: 645f 6964 785b 305d 2c20 3a5d 292e 6275  d_idx[0], :]).bu
+00042e80: 6666 6572 2862 7566 6629 0a20 2020 2066  ffer(buff).    f
+00042e90: 6f72 2069 2c20 6978 2069 6e20 656e 756d  or i, ix in enum
+00042ea0: 6572 6174 6528 726e 645f 6964 7829 3a0a  erate(rnd_idx):.
+00042eb0: 2020 2020 2020 2020 6966 2076 6572 626f          if verbo
+00042ec0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00042ed0: 7072 696e 7428 4e4f 5f4e 4557 4c49 4e45  print(NO_NEWLINE
+00042ee0: 202b 2027 7b30 7d20 7b31 7d27 2e66 6f72   + '{0} {1}'.for
+00042ef0: 6d61 7428 692c 2069 7829 290a 0a20 2020  mat(i, ix))..   
+00042f00: 2020 2020 2070 6f6c 7920 3d20 706f 6c79       poly = poly
+00042f10: 2e75 6e69 6f6e 2850 6f69 6e74 2870 6f69  .union(Point(poi
+00042f20: 6e74 735b 6978 2c20 3a5d 292e 6275 6666  nts[ix, :]).buff
+00042f30: 6572 2862 7566 6629 290a 0a20 2020 2023  er(buff))..    #
+00042f40: 2046 696e 616c 2028 6d75 6c74 6929 506f   Final (multi)Po
+00042f50: 6c79 676f 6e0a 2020 2020 706a 6f69 6e20  lygon.    pjoin 
+00042f60: 3d20 706f 6c79 2e62 7566 6665 7228 2d62  = poly.buffer(-b
+00042f70: 7566 6629 0a0a 2020 2020 6966 206d 616b  uff)..    if mak
+00042f80: 655f 706c 6f74 3a0a 0a20 2020 2020 2020  e_plot:..       
+00042f90: 2066 6967 203d 2070 6c74 2e66 6967 7572   fig = plt.figur
+00042fa0: 6528 290a 2020 2020 2020 2020 6178 203d  e().        ax =
+00042fb0: 2066 6967 2e61 6464 5f73 7562 706c 6f74   fig.add_subplot
+00042fc0: 2831 3131 290a 0a20 2020 2020 2020 2069  (111)..        i
+00042fd0: 6620 6973 696e 7374 616e 6365 2870 6a6f  f isinstance(pjo
+00042fe0: 696e 2c20 4d75 6c74 6950 6f6c 7967 6f6e  in, MultiPolygon
+00042ff0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00043000: 6f72 2070 5f69 2069 6e20 706a 6f69 6e3a  or p_i in pjoin:
+00043010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043020: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
+00043030: 5f69 2e62 6f75 6e64 6172 792c 204d 756c  _i.boundary, Mul
+00043040: 7469 4c69 6e65 5374 7269 6e67 293a 0a20  tiLineString):. 
+00043050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043060: 2020 2066 6f72 2073 2069 6e20 705f 692e     for s in p_i.
+00043070: 626f 756e 6461 7279 3a0a 2020 2020 2020  boundary:.      
+00043080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043090: 2020 7020 3d20 732e 7879 0a20 2020 2020    p = s.xy.     
+000430a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000430b0: 2020 2061 782e 706c 6f74 2870 5b30 5d2c     ax.plot(p[0],
+000430c0: 2070 5b31 5d29 0a20 2020 2020 2020 2020   p[1]).         
+000430d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000430e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000430f0: 2070 203d 2070 5f69 2e62 6f75 6e64 6172   p = p_i.boundar
+00043100: 792e 7879 0a20 2020 2020 2020 2020 2020  y.xy.           
+00043110: 2020 2020 2020 2020 2061 782e 706c 6f74           ax.plot
+00043120: 2870 5b30 5d2c 2070 5b31 5d29 0a20 2020  (p[0], p[1]).   
+00043130: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00043140: 2020 2020 2020 2070 5f69 203d 2070 6a6f         p_i = pjo
+00043150: 696e 0a20 2020 2020 2020 2020 2020 2069  in.            i
+00043160: 6620 6973 696e 7374 616e 6365 2870 5f69  f isinstance(p_i
+00043170: 2e62 6f75 6e64 6172 792c 204d 756c 7469  .boundary, Multi
+00043180: 4c69 6e65 5374 7269 6e67 293a 0a20 2020  LineString):.   
+00043190: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000431a0: 2073 2069 6e20 705f 692e 626f 756e 6461   s in p_i.bounda
+000431b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000431c0: 2020 2020 2020 2020 7020 3d20 732e 7879          p = s.xy
+000431d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000431e0: 2020 2020 2061 782e 706c 6f74 2870 5b30       ax.plot(p[0
+000431f0: 5d2c 2070 5b31 5d29 0a20 2020 2020 2020  ], p[1]).       
+00043200: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00043210: 2020 2020 2020 2020 2020 2070 203d 2070             p = p
+00043220: 5f69 2e62 6f75 6e64 6172 792e 7879 0a20  _i.boundary.xy. 
+00043230: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00043240: 782e 706c 6f74 2870 5b30 5d2c 2070 5b31  x.plot(p[0], p[1
+00043250: 5d29 0a0a 2020 2020 2020 2020 6178 2e73  ])..        ax.s
+00043260: 6361 7474 6572 2870 6f69 6e74 735b 726e  catter(points[rn
+00043270: 645f 6964 782c 2030 5d2c 2070 6f69 6e74  d_idx, 0], point
+00043280: 735b 726e 645f 6964 782c 2031 5d2c 2061  s[rnd_idx, 1], a
+00043290: 6c70 6861 3d30 2e31 2c20 6d61 726b 6572  lpha=0.1, marker
+000432a0: 3d27 2b27 290a 0a20 2020 2020 2020 2061  ='+')..        a
+000432b0: 782e 7365 745f 786c 696d 2861 782e 6765  x.set_xlim(ax.ge
+000432c0: 745f 786c 696d 2829 5b3a 3a2d 315d 290a  t_xlim()[::-1]).
+000432d0: 2020 2020 2020 2020 6178 2e73 6574 5f78          ax.set_x
+000432e0: 6c61 6265 6c28 7227 245c 4465 6c74 6124  label(r'$\Delta$
+000432f0: 5241 2028 7b30 3a2e 3566 7d29 272e 666f  RA ({0:.5f})'.fo
+00043300: 726d 6174 2863 656e 7465 725b 305d 2929  rmat(center[0]))
+00043310: 0a20 2020 2020 2020 2061 782e 7365 745f  .        ax.set_
+00043320: 796c 6162 656c 2872 2724 5c44 656c 7461  ylabel(r'$\Delta
+00043330: 2444 6563 2e20 287b 303a 2e35 667d 2927  $Dec. ({0:.5f})'
+00043340: 2e66 6f72 6d61 7428 6365 6e74 6572 5b31  .format(center[1
+00043350: 5d29 290a 2020 2020 2020 2020 6178 2e73  ])).        ax.s
+00043360: 6574 5f74 6974 6c65 2827 546f 7461 6c20  et_title('Total 
+00043370: 6172 6561 3a20 7b30 3a2e 3166 7d20 6172  area: {0:.1f} ar
+00043380: 636d 696e 245e 3224 272e 666f 726d 6174  cmin$^2$'.format
+00043390: 2870 6a6f 696e 2e61 7265 6129 290a 2020  (pjoin.area)).  
+000433a0: 2020 2020 2020 6178 2e67 7269 6428 290a        ax.grid().
+000433b0: 2020 2020 2020 2020 6669 672e 7469 6768          fig.tigh
+000433c0: 745f 6c61 796f 7574 2870 6164 3d30 2e31  t_layout(pad=0.1
+000433d0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000433e0: 6e20 706a 6f69 6e2e 6172 6561 2c20 6669  n pjoin.area, fi
+000433f0: 670a 0a20 2020 2065 6c73 653a 0a20 2020  g..    else:.   
+00043400: 2020 2020 2072 6574 7572 6e20 706a 6f69       return pjoi
+00043410: 6e2e 6172 6561 0a0a 0a64 6566 2066 6978  n.area...def fix
+00043420: 5f66 6c74 5f6e 616e 2866 6c74 5f66 696c  _flt_nan(flt_fil
+00043430: 652c 2062 6164 5f62 6974 3d34 3039 362c  e, bad_bit=4096,
+00043440: 2076 6572 626f 7365 3d54 7275 6529 3a0a   verbose=True):.
+00043450: 2020 2020 2222 220a 2020 2020 4669 7820      """.    Fix 
+00043460: 4e61 4e20 7661 6c75 6573 2069 6e20 464c  NaN values in FL
+00043470: 5420 6669 6c65 730a 2020 2020 2222 220a  T files.    """.
+00043480: 2020 2020 696d 203d 2070 7966 6974 732e      im = pyfits.
+00043490: 6f70 656e 2866 6c74 5f66 696c 652c 206d  open(flt_file, m
+000434a0: 6f64 653d 2775 7064 6174 6527 290a 2020  ode='update').  
+000434b0: 2020 666f 7220 6578 7420 696e 2072 616e    for ext in ran
+000434c0: 6765 2831 2c20 3529 3a0a 2020 2020 2020  ge(1, 5):.      
+000434d0: 2020 6966 2028 2753 4349 272c 2065 7874    if ('SCI', ext
+000434e0: 2920 696e 2069 6d3a 0a20 2020 2020 2020  ) in im:.       
+000434f0: 2020 2020 206d 6173 6b20 3d20 7e6e 702e       mask = ~np.
+00043500: 6973 6669 6e69 7465 2869 6d5b 2753 4349  isfinite(im['SCI
+00043510: 272c 2065 7874 5d2e 6461 7461 290a 2020  ', ext].data).  
+00043520: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
+00043530: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
+00043540: 2020 2020 2020 6c61 6265 6c20 3d20 2775        label = 'u
+00043550: 7469 6c73 2e66 6978 5f66 6c74 5f6e 616e  tils.fix_flt_nan
+00043560: 3a20 7b30 7d5b 5343 492c 7b31 7d5d 204e  : {0}[SCI,{1}] N
+00043570: 614e 5069 7865 6c73 3d7b 327d 270a 2020  aNPixels={2}'.  
+00043580: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00043590: 696e 7428 6c61 6265 6c2e 666f 726d 6174  int(label.format
+000435a0: 2866 6c74 5f66 696c 652c 2065 7874 2c20  (flt_file, ext, 
+000435b0: 6d61 736b 2e73 756d 2829 2929 0a0a 2020  mask.sum()))..  
+000435c0: 2020 2020 2020 2020 2020 6966 206d 6173            if mas
+000435d0: 6b2e 7375 6d28 2920 3d3d 2030 3a0a 2020  k.sum() == 0:.  
+000435e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000435f0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+00043600: 2020 2020 696d 5b27 5343 4927 2c20 6578      im['SCI', ex
+00043610: 745d 2e64 6174 615b 6d61 736b 5d20 3d20  t].data[mask] = 
+00043620: 300a 2020 2020 2020 2020 2020 2020 696d  0.            im
+00043630: 5b27 4451 272c 2065 7874 5d2e 6461 7461  ['DQ', ext].data
+00043640: 5b6d 6173 6b5d 207c 3d20 6261 645f 6269  [mask] |= bad_bi
+00043650: 740a 0a20 2020 2069 6d2e 666c 7573 6828  t..    im.flush(
+00043660: 290a 2020 2020 696d 2e63 6c6f 7365 2829  ).    im.close()
+00043670: 0a0a 0a64 6566 2064 756d 705f 666c 745f  ...def dump_flt_
+00043680: 6471 2866 696c 656e 616d 652c 2072 6570  dq(filename, rep
+00043690: 6c61 6365 3d28 272e 6669 7473 272c 2027  lace=('.fits', '
+000436a0: 2e64 712e 6669 7473 2e67 7a27 292c 2076  .dq.fits.gz'), v
+000436b0: 6572 626f 7365 3d54 7275 6529 3a0a 2020  erbose=True):.  
+000436c0: 2020 2222 2244 756d 7020 464c 542f 464c    """Dump FLT/FL
+000436d0: 4320 6865 6164 6572 2026 2044 5120 6578  C header & DQ ex
+000436e0: 7465 6e73 696f 6e73 2074 6f20 6120 636f  tensions to a co
+000436f0: 6d70 6163 7420 6669 6c65 0a0a 2020 2020  mpact file..    
+00043700: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00043710: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6669  ---------.    fi
+00043720: 6c65 6e61 6d65 203a 2073 7472 0a20 2020  lename : str.   
+00043730: 2020 2020 2046 4c54 2f46 4c43 2066 696c       FLT/FLC fil
+00043740: 656e 616d 652e 0a0a 2020 2020 7265 706c  ename...    repl
+00043750: 6163 6520 3a20 2873 7472 2c20 7374 7229  ace : (str, str)
+00043760: 0a20 2020 2020 2020 2052 6570 6c61 6365  .        Replace
+00043770: 2061 7267 756d 656e 7473 2066 6f72 206f   arguments for o
+00043780: 7574 7075 7420 6669 6c65 6e61 6d65 3a0a  utput filename:.
+00043790: 0a20 2020 2020 2020 203e 3e3e 206f 7574  .        >>> out
+000437a0: 7075 745f 6669 6c65 6e61 6d65 203d 2066  put_filename = f
+000437b0: 696c 656e 616d 652e 7265 706c 6163 6528  ilename.replace(
+000437c0: 7265 706c 6163 655b 305d 2c20 7265 706c  replace[0], repl
+000437d0: 6163 655b 315d 290a 0a20 2020 2052 6574  ace[1])..    Ret
+000437e0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+000437f0: 0a20 2020 2057 7269 7465 7320 6865 6164  .    Writes head
+00043800: 6572 2061 6e64 2063 6f6d 7061 6374 2044  er and compact D
+00043810: 5120 6172 7261 7920 746f 2060 6f75 7470  Q array to `outp
+00043820: 7574 5f66 696c 656e 616d 6560 2e0a 0a20  ut_filename`... 
+00043830: 2020 2022 2222 0a20 2020 2069 6d20 3d20     """.    im = 
+00043840: 7079 6669 7473 2e6f 7065 6e28 6669 6c65  pyfits.open(file
+00043850: 6e61 6d65 290a 2020 2020 6864 7573 203d  name).    hdus =
+00043860: 205b 5d0a 2020 2020 666f 7220 6920 696e   [].    for i in
+00043870: 205b 312c 2032 2c20 332c 2034 5d3a 0a20   [1, 2, 3, 4]:. 
+00043880: 2020 2020 2020 2069 6620 2827 5343 4927         if ('SCI'
+00043890: 2c20 6929 2069 6e20 696d 3a0a 2020 2020  , i) in im:.    
+000438a0: 2020 2020 2020 2020 6865 6164 6572 203d          header =
+000438b0: 2069 6d5b 2753 4349 272c 2069 5d2e 6865   im['SCI', i].he
+000438c0: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
+000438d0: 2064 7120 3d20 696d 5b27 4451 272c 2069   dq = im['DQ', i
+000438e0: 5d2e 6461 7461 0a20 2020 2020 2020 2020  ].data.         
+000438f0: 2020 206e 7a20 3d20 6e70 2e77 6865 7265     nz = np.where
+00043900: 2864 7120 3e20 3029 0a20 2020 2020 2020  (dq > 0).       
+00043910: 2020 2020 2064 715f 6461 7461 203d 206e       dq_data = n
+00043920: 702e 6172 7261 7928 5b6e 7a5b 305d 2c20  p.array([nz[0], 
+00043930: 6e7a 5b31 5d2c 2064 715b 6471 203e 2030  nz[1], dq[dq > 0
+00043940: 5d5d 2c20 6474 7970 653d 6e70 2e69 6e74  ]], dtype=np.int
+00043950: 3136 290a 2020 2020 2020 2020 2020 2020  16).            
+00043960: 6864 7520 3d20 7079 6669 7473 2e49 6d61  hdu = pyfits.Ima
+00043970: 6765 4844 5528 6865 6164 6572 3d68 6561  geHDU(header=hea
+00043980: 6465 722c 2064 6174 613d 6471 5f64 6174  der, data=dq_dat
+00043990: 6129 0a20 2020 2020 2020 2020 2020 2068  a).            h
+000439a0: 6475 732e 6170 7065 6e64 2868 6475 290a  dus.append(hdu).
+000439b0: 0a20 2020 206f 7574 7075 745f 6669 6c65  .    output_file
+000439c0: 6e61 6d65 203d 2066 696c 656e 616d 652e  name = filename.
+000439d0: 7265 706c 6163 6528 7265 706c 6163 655b  replace(replace[
+000439e0: 305d 2c20 7265 706c 6163 655b 315d 290a  0], replace[1]).
+000439f0: 0a20 2020 206d 7367 203d 2027 2320 6475  .    msg = '# du
+00043a00: 6d70 5f66 6c74 5f64 713a 207b 307d 203e  mp_flt_dq: {0} >
+00043a10: 207b 317d 272e 666f 726d 6174 2866 696c   {1}'.format(fil
+00043a20: 656e 616d 652c 206f 7574 7075 745f 6669  ename, output_fi
+00043a30: 6c65 6e61 6d65 290a 2020 2020 6c6f 675f  lename).    log_
+00043a40: 636f 6d6d 656e 7428 4c4f 4746 494c 452c  comment(LOGFILE,
+00043a50: 206d 7367 2c20 7665 7262 6f73 653d 7665   msg, verbose=ve
+00043a60: 7262 6f73 652c 2073 686f 775f 6461 7465  rbose, show_date
+00043a70: 3d54 7275 6529 0a0a 2020 2020 7079 6669  =True)..    pyfi
+00043a80: 7473 2e48 4455 4c69 7374 2868 6475 7329  ts.HDUList(hdus)
+00043a90: 2e77 7269 7465 746f 286f 7574 7075 745f  .writeto(output_
+00043aa0: 6669 6c65 6e61 6d65 2c20 6f76 6572 7772  filename, overwr
+00043ab0: 6974 653d 5472 7565 2c0a 2020 2020 2020  ite=True,.      
+00043ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043ad0: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00043ae0: 745f 7665 7269 6679 3d27 6669 7827 290a  t_verify='fix').
+00043af0: 2020 2020 0a20 2020 2069 6d2e 636c 6f73      .    im.clos
+00043b00: 6528 290a 0a0a 6465 6620 6170 706c 795f  e()...def apply_
+00043b10: 666c 745f 6471 2866 696c 656e 616d 652c  flt_dq(filename,
+00043b20: 2072 6570 6c61 6365 3d28 272e 6669 7473   replace=('.fits
+00043b30: 272c 2027 2e64 712e 6669 7473 2e67 7a27  ', '.dq.fits.gz'
+00043b40: 292c 2076 6572 626f 7365 3d54 7275 652c  ), verbose=True,
+00043b50: 206f 725f 636f 6d62 696e 653d 4661 6c73   or_combine=Fals
+00043b60: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
+00043b70: 5265 6164 2061 6e64 2061 7070 6c79 2074  Read and apply t
+00043b80: 6865 2063 6f6d 7061 6374 2065 7870 6f73  he compact expos
+00043b90: 7572 6520 696e 666f 726d 6174 696f 6e20  ure information 
+00043ba0: 6669 6c65 0a0a 2020 2020 5061 7261 6d65  file..    Parame
+00043bb0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00043bc0: 2d2d 2d0a 2020 2020 6669 6c65 6e61 6d65  ---.    filename
+00043bd0: 203a 2073 7472 0a20 2020 2020 2020 2046   : str.        F
+00043be0: 4c54 2f46 4c43 2066 696c 656e 616d 652e  LT/FLC filename.
+00043bf0: 0a0a 2020 2020 7265 706c 6163 6520 3a20  ..    replace : 
+00043c00: 2873 7472 2c20 7374 7229 0a20 2020 2020  (str, str).     
+00043c10: 2020 2052 6570 6c61 6365 2061 7267 756d     Replace argum
+00043c20: 656e 7473 2066 6f72 206f 7574 7075 7420  ents for output 
+00043c30: 4451 2066 696c 656e 616d 653a 0a0a 2020  DQ filename:..  
+00043c40: 2020 2020 2020 3e3e 3e20 6f75 7470 7574        >>> output
+00043c50: 5f66 696c 656e 616d 6520 3d20 6669 6c65  _filename = file
+00043c60: 6e61 6d65 2e72 6570 6c61 6365 2872 6570  name.replace(rep
+00043c70: 6c61 6365 5b30 5d2c 2072 6570 6c61 6365  lace[0], replace
+00043c80: 5b31 5d29 0a0a 2020 2020 6f72 5f63 6f6d  [1])..    or_com
+00043c90: 6269 6e65 203a 2062 6f6f 6c0a 2020 2020  bine : bool.    
+00043ca0: 2020 2020 4966 2054 7275 652c 2074 6865      If True, the
+00043cb0: 6e20 6170 706c 7920 4451 2064 6174 6120  n apply DQ data 
+00043cc0: 696e 2060 6f75 7470 7574 5f66 696c 656e  in `output_filen
+00043cd0: 616d 6560 2077 6974 6820 4f52 206c 6f67  ame` with OR log
+00043ce0: 6963 2e0a 0a20 2020 2020 2020 2049 6620  ic...        If 
+00043cf0: 4661 6c73 652c 2074 6865 6e20 7265 7365  False, then rese
+00043d00: 7420 7468 6520 4451 2065 7874 656e 7369  t the DQ extensi
+00043d10: 6f6e 7320 746f 2062 6520 6578 6163 746c  ons to be exactl
+00043d20: 7920 7468 6f73 6520 696e 0a20 2020 2020  y those in.     
+00043d30: 2020 2060 6f75 7470 7574 5f66 696c 656e     `output_filen
+00043d40: 616d 6560 2e0a 0a20 2020 2052 6574 7572  ame`...    Retur
+00043d50: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+00043d60: 2020 2057 7269 7465 7320 6865 6164 6572     Writes header
+00043d70: 2061 6e64 2063 6f6d 7061 6374 2044 5120   and compact DQ 
+00043d80: 6172 7261 7920 746f 2060 6f75 7470 7574  array to `output
+00043d90: 5f66 696c 656e 616d 6560 2e0a 0a20 2020  _filename`...   
+00043da0: 2022 2222 0a0a 2020 2020 6f75 7470 7574   """..    output
+00043db0: 5f66 696c 656e 616d 6520 3d20 6669 6c65  _filename = file
+00043dc0: 6e61 6d65 2e72 6570 6c61 6365 2872 6570  name.replace(rep
+00043dd0: 6c61 6365 5b30 5d2c 2072 6570 6c61 6365  lace[0], replace
+00043de0: 5b31 5d29 0a0a 2020 2020 6966 206e 6f74  [1])..    if not
+00043df0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00043e00: 6f75 7470 7574 5f66 696c 656e 616d 6529  output_filename)
+00043e10: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00043e20: 2046 616c 7365 0a0a 2020 2020 696d 203d   False..    im =
+00043e30: 2070 7966 6974 732e 6f70 656e 2866 696c   pyfits.open(fil
+00043e40: 656e 616d 652c 206d 6f64 653d 2775 7064  ename, mode='upd
+00043e50: 6174 6527 290a 0a20 2020 206d 7367 203d  ate')..    msg =
+00043e60: 2027 2320 6170 706c 795f 666c 745f 6471   '# apply_flt_dq
+00043e70: 3a20 7b31 7d20 3e20 7b30 7d27 2e66 6f72  : {1} > {0}'.for
+00043e80: 6d61 7428 6669 6c65 6e61 6d65 2c20 6f75  mat(filename, ou
+00043e90: 7470 7574 5f66 696c 656e 616d 6529 0a20  tput_filename). 
+00043ea0: 2020 206c 6f67 5f63 6f6d 6d65 6e74 284c     log_comment(L
+00043eb0: 4f47 4649 4c45 2c20 6d73 672c 2076 6572  OGFILE, msg, ver
+00043ec0: 626f 7365 3d76 6572 626f 7365 2c20 7368  bose=verbose, sh
+00043ed0: 6f77 5f64 6174 653d 5472 7565 290a 0a20  ow_date=True).. 
+00043ee0: 2020 2064 7120 3d20 7079 6669 7473 2e6f     dq = pyfits.o
+00043ef0: 7065 6e28 6f75 7470 7574 5f66 696c 656e  pen(output_filen
+00043f00: 616d 6529 0a20 2020 2066 6f72 2065 7874  ame).    for ext
+00043f10: 2069 6e20 5b31 2c20 322c 2033 2c20 345d   in [1, 2, 3, 4]
+00043f20: 3a0a 2020 2020 2020 2020 6966 2028 2827  :.        if (('
+00043f30: 5343 4927 2c20 6578 7429 2069 6e20 696d  SCI', ext) in im
+00043f40: 2920 2620 2828 2753 4349 272c 2065 7874  ) & (('SCI', ext
+00043f50: 2920 696e 2064 7129 3a0a 2020 2020 2020  ) in dq):.      
+00043f60: 2020 2020 2020 7368 203d 2064 715b 2753        sh = dq['S
+00043f70: 4349 272c 2065 7874 5d2e 6461 7461 2e73  CI', ext].data.s
+00043f80: 6861 7065 0a20 2020 2020 2020 2020 2020  hape.           
+00043f90: 2069 6620 7368 5b30 5d20 3d3d 2033 3a0a   if sh[0] == 3:.
+00043fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043fb0: 692c 206a 2c20 6471 5f69 203d 2064 715b  i, j, dq_i = dq[
+00043fc0: 2753 4349 272c 2065 7874 5d2e 6461 7461  'SCI', ext].data
+00043fd0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00043fe0: 6620 7368 5b31 5d20 3d3d 2032 3a0a 2020  f sh[1] == 2:.  
+00043ff0: 2020 2020 2020 2020 2020 2020 2020 6e7a                nz
+00044000: 2c20 6471 5f69 203d 2064 715b 2753 4349  , dq_i = dq['SCI
+00044010: 272c 2065 7874 5d2e 6461 7461 0a20 2020  ', ext].data.   
+00044020: 2020 2020 2020 2020 2020 2020 2069 2c20               i, 
+00044030: 6a20 3d20 6e70 2e75 6e72 6176 656c 5f69  j = np.unravel_i
+00044040: 6e64 6578 286e 7a2c 2073 6829 0a20 2020  ndex(nz, sh).   
+00044050: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00044060: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00044070: 6169 7365 2049 4f45 7272 6f72 2827 6471  aise IOError('dq
+00044080: 5b7b 307d 5d20 7368 6170 6520 7b31 7d20  [{0}] shape {1} 
+00044090: 6e6f 7420 7265 636f 676e 697a 6564 272e  not recognized'.
+000440a0: 666f 726d 6174 2865 7874 2c20 7368 2929  format(ext, sh))
+000440b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000440c0: 200a 2020 2020 2020 2020 2020 2020 2320   .            # 
+000440d0: 4170 706c 7920 4451 0a20 2020 2020 2020  Apply DQ.       
+000440e0: 2020 2020 2069 6620 6f72 5f63 6f6d 6269       if or_combi
+000440f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00044100: 2020 2020 696d 5b27 4451 272c 2065 7874      im['DQ', ext
+00044110: 5d2e 6461 7461 5b69 2c20 6a5d 2021 3d20  ].data[i, j] != 
+00044120: 6471 5f69 0a20 2020 2020 2020 2020 2020  dq_i.           
+00044130: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00044140: 2020 2020 2020 2069 6d5b 2744 5127 2c20         im['DQ', 
+00044150: 6578 745d 2e64 6174 6120 2a3d 2030 0a20  ext].data *= 0. 
+00044160: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00044170: 6d5b 2744 5127 2c20 6578 745d 2e64 6174  m['DQ', ext].dat
+00044180: 615b 692c 206a 5d20 3d20 6471 5f69 0a0a  a[i, j] = dq_i..
+00044190: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+000441a0: 7079 2068 6561 6465 720a 2020 2020 2020  py header.      
+000441b0: 2020 2020 2020 6861 735f 626c 6f74 736b        has_blotsk
+000441c0: 7920 3d20 2742 4c4f 5453 4b59 2720 696e  y = 'BLOTSKY' in
+000441d0: 2069 6d5b 2753 4349 272c 2065 7874 5d2e   im['SCI', ext].
+000441e0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+000441f0: 2020 2066 6f72 206b 2069 6e20 6471 5b27     for k in dq['
+00044200: 5343 4927 2c20 6578 745d 2e68 6561 6465  SCI', ext].heade
+00044210: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00044220: 2020 2069 6620 6b20 696e 205b 2742 4954     if k in ['BIT
+00044230: 5049 5827 2c20 274e 4158 4953 3127 2c20  PIX', 'NAXIS1', 
+00044240: 274e 4158 4953 3227 2c20 2727 2c20 2748  'NAXIS2', '', 'H
+00044250: 4953 544f 5259 275d 3a0a 2020 2020 2020  ISTORY']:.      
+00044260: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00044270: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+00044280: 2020 2020 2020 2020 696d 5b27 5343 4927          im['SCI'
+00044290: 2c20 6578 745d 2e68 6561 6465 725b 6b5d  , ext].header[k]
+000442a0: 203d 2064 715b 2753 4349 272c 2065 7874   = dq['SCI', ext
+000442b0: 5d2e 6865 6164 6572 5b6b 5d0a 0a20 2020  ].header[k]..   
+000442c0: 2020 2020 2020 2020 2069 6620 286e 6f74           if (not
+000442d0: 2068 6173 5f62 6c6f 7473 6b79 2920 2620   has_blotsky) & 
+000442e0: 2827 424c 4f54 534b 5927 2069 6e20 6471  ('BLOTSKY' in dq
+000442f0: 5b27 5343 4927 2c20 6578 745d 2e68 6561  ['SCI', ext].hea
+00044300: 6465 7229 3a0a 2020 2020 2020 2020 2020  der):.          
+00044310: 2020 2020 2020 696d 5b27 5343 4927 2c20        im['SCI', 
+00044320: 6578 745d 2e68 6561 6465 725b 2742 4c4f  ext].header['BLO
+00044330: 5453 4b59 275d 203d 2046 616c 7365 0a0a  TSKY'] = False..
+00044340: 2020 2020 696d 2e66 6c75 7368 2829 0a20      im.flush(). 
+00044350: 2020 2069 6d2e 636c 6f73 6528 290a 0a0a     im.close()...
+00044360: 6465 6620 5247 4274 6f48 6578 2876 616c  def RGBtoHex(val
+00044370: 732c 2072 6762 7479 7065 3d31 293a 0a20  s, rgbtype=1):. 
+00044380: 2020 2022 2222 436f 6e76 6572 7473 2052     """Converts R
+00044390: 4742 2076 616c 7565 7320 696e 2061 2076  GB values in a v
+000443a0: 6172 6965 7479 206f 6620 666f 726d 6174  ariety of format
+000443b0: 7320 746f 2048 6578 2076 616c 7565 732e  s to Hex values.
+000443c0: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+000443d0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+000443e0: 2020 2020 7661 6c73 203a 2074 7570 6c65      vals : tuple
+000443f0: 0a20 2020 2020 2020 2020 416e 2052 4742  .         An RGB
+00044400: 2f52 4742 4120 7475 706c 650a 0a20 2020  /RGBA tuple..   
+00044410: 2072 6762 5f74 7970 6520 3a20 696e 740a   rgb_type : int.
+00044420: 2020 2020 2020 2020 5661 6c69 6420 7661          Valid va
+00044430: 6c75 7320 6172 653a 0a20 2020 2020 2020  lus are:.       
+00044440: 2020 2d20 3120 3d20 496e 7075 7473 2061    - 1 = Inputs a
+00044450: 7265 2069 6e20 7468 6520 7261 6e67 6520  re in the range 
+00044460: 3020 746f 2031 0a20 2020 2020 2020 2020  0 to 1.         
+00044470: 2d20 3235 3620 3d20 496e 7075 7473 2061  - 256 = Inputs a
+00044480: 7265 2069 6e20 7468 6520 7261 6e67 6520  re in the range 
+00044490: 3020 746f 2032 3535 0a20 0a20 2020 2052  0 to 255. .    R
+000444a0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+000444b0: 2d2d 0a20 2020 2068 6578 7473 7472 203a  --.    hextstr :
+000444c0: 2073 7472 0a20 2020 2020 2020 2041 2068   str.        A h
+000444d0: 6578 2073 7472 696e 6720 696e 2074 6865  ex string in the
+000444e0: 2066 6f72 6d20 2723 5252 4747 4242 2720   form '#RRGGBB' 
+000444f0: 6f72 2027 2352 5247 4742 4241 4127 0a0a  or '#RRGGBBAA'..
+00044500: 2020 2020 5265 6665 7265 6e63 6573 0a20      References. 
+00044510: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00044520: 2020 2863 7265 6469 743a 2052 7963 6861    (credit: Rycha
+00044530: 7264 2040 2068 7474 7073 3a2f 2f73 7461  rd @ https://sta
+00044540: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f61  ckoverflow.com/a
+00044550: 2f34 3832 3838 3137 3329 0a0a 2020 2020  /48288173)..    
+00044560: 2222 220a 0a20 2020 206d 7367 203d 2022  """..    msg = "
+00044570: 5247 4220 6f72 2052 4742 4120 696e 7075  RGB or RGBA inpu
+00044580: 7473 2074 6f20 5247 4274 6f48 6578 206d  ts to RGBtoHex m
+00044590: 7573 7420 6861 7665 2074 6872 6565 206f  ust have three o
+000445a0: 7220 666f 7572 2065 6c65 6d65 6e74 7321  r four elements!
+000445b0: 220a 2020 2020 6966 2028 6c65 6e28 7661  ".    if (len(va
+000445c0: 6c73 2920 213d 2033 2920 2620 286c 656e  ls) != 3) & (len
+000445d0: 2876 616c 7329 2021 3d20 3429 3a0a 2020  (vals) != 4):.  
+000445e0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+000445f0: 7074 696f 6e28 6d73 6729 0a0a 2020 2020  ption(msg)..    
+00044600: 6966 2028 7267 6274 7970 6520 213d 2031  if (rgbtype != 1
+00044610: 2920 2620 2872 6762 7479 7065 2021 3d20  ) & (rgbtype != 
+00044620: 3235 3629 3a0a 2020 2020 2020 2020 7261  256):.        ra
+00044630: 6973 6520 4578 6365 7074 696f 6e28 2272  ise Exception("r
+00044640: 6762 7479 7065 206d 7573 7420 6265 2031  gbtype must be 1
+00044650: 206f 7220 3235 3621 2229 0a0a 2020 2020   or 256!")..    
+00044660: 2320 436f 6e76 6572 7420 6672 6f6d 2030  # Convert from 0
+00044670: 2d31 2052 4742 2f52 4742 4120 746f 2030  -1 RGB/RGBA to 0
+00044680: 2d32 3535 2052 4742 2f52 4742 410a 2020  -255 RGB/RGBA.  
+00044690: 2020 6966 2072 6762 7479 7065 203d 3d20    if rgbtype == 
+000446a0: 313a 0a20 2020 2020 2020 2076 616c 7320  1:.        vals 
+000446b0: 3d20 5b32 3535 2a78 2066 6f72 2078 2069  = [255*x for x i
+000446c0: 6e20 7661 6c73 5b3a 335d 5d0a 0a20 2020  n vals[:3]]..   
+000446d0: 2023 2045 6e73 7572 6520 7661 6c75 6573   # Ensure values
+000446e0: 2061 7265 2072 6f75 6e64 6564 2069 6e74   are rounded int
+000446f0: 6567 6572 732c 2063 6f6e 7665 7274 2074  egers, convert t
+00044700: 6f20 6865 782c 2061 6e64 2063 6f6e 6361  o hex, and conca
+00044710: 7465 6e61 7465 0a20 2020 2072 6574 7572  tenate.    retur
+00044720: 6e20 2723 2720 2b20 2727 2e6a 6f69 6e28  n '#' + ''.join(
+00044730: 5b27 7b3a 3032 587d 272e 666f 726d 6174  ['{:02X}'.format
+00044740: 2869 6e74 2872 6f75 6e64 2878 2929 2920  (int(round(x))) 
+00044750: 666f 7220 7820 696e 2076 616c 735d 290a  for x in vals]).
+00044760: 0a0a 6465 6620 6361 7461 6c6f 675f 6d61  ..def catalog_ma
+00044770: 736b 2863 6174 2c20 6563 6f6c 3d27 464c  sk(cat, ecol='FL
+00044780: 5558 4552 525f 4150 4552 5f30 272c 206d  UXERR_APER_0', m
+00044790: 6178 5f65 7272 5f70 6572 6365 6e74 696c  ax_err_percentil
+000447a0: 653d 3930 2c20 7061 643d 302e 3035 2c20  e=90, pad=0.05, 
+000447b0: 7061 645f 6973 5f61 6273 6f6c 7574 653d  pad_is_absolute=
+000447c0: 4661 6c73 652c 206d 696e 5f66 6c75 785f  False, min_flux_
+000447d0: 7261 6469 7573 3d31 2e29 3a0a 2020 2020  radius=1.):.    
+000447e0: 2222 220a 2020 2020 436f 6d70 7574 6520  """.    Compute 
+000447f0: 6120 6361 7461 6c6f 6720 6d61 736b 2066  a catalog mask f
+00044800: 6f72 0a20 2020 2020 2031 2920 4f62 6a65  or.      1) Obje
+00044810: 6374 7320 7769 7468 696e 2060 7061 6460  cts within `pad`
+00044820: 206f 6620 7468 6520 6564 6765 206f 6620   of the edge of 
+00044830: 7468 6520 6361 7461 6c6f 6720 636f 6e76  the catalog conv
+00044840: 6578 2068 756c 6c0a 2020 2020 2020 3229  ex hull.      2)
+00044850: 2055 6e63 6572 7461 696e 7469 6573 203c   Uncertainties <
+00044860: 2060 6d61 785f 6572 725f 7065 7263 656e   `max_err_percen
+00044870: 7469 6c65 600a 0a20 2020 2022 2222 0a20  tile`..    """. 
+00044880: 2020 2074 6573 7420 3d20 6e70 2e69 7366     test = np.isf
+00044890: 696e 6974 6528 6361 745b 2746 4c55 585f  inite(cat['FLUX_
+000448a0: 4155 544f 275d 290a 2020 2020 6966 2027  AUTO']).    if '
+000448b0: 464c 5558 5f52 4144 4955 5327 2069 6e20  FLUX_RADIUS' in 
+000448c0: 6361 742e 636f 6c6e 616d 6573 3a0a 2020  cat.colnames:.  
+000448d0: 2020 2020 2020 7465 7374 2026 3d20 6361        test &= ca
+000448e0: 745b 2746 4c55 585f 5241 4449 5553 275d  t['FLUX_RADIUS']
+000448f0: 203e 206d 696e 5f66 6c75 785f 7261 6469   > min_flux_radi
+00044900: 7573 0a0a 2020 2020 7465 7374 2026 3d20  us..    test &= 
+00044910: 2863 6174 5b27 5448 5245 5348 275d 203e  (cat['THRESH'] >
+00044920: 2030 2920 2620 2863 6174 5b27 5448 5245   0) & (cat['THRE
+00044930: 5348 275d 203c 2031 6532 3829 0a0a 2020  SH'] < 1e28)..  
+00044940: 2020 6e6f 745f 6564 6765 203d 2068 756c    not_edge = hul
+00044950: 6c5f 6564 6765 5f6d 6173 6b28 6361 745b  l_edge_mask(cat[
+00044960: 2758 5f49 4d41 4745 275d 2c20 6361 745b  'X_IMAGE'], cat[
+00044970: 2759 5f49 4d41 4745 275d 2c0a 2020 2020  'Y_IMAGE'],.    
+00044980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044990: 2020 2020 2020 2020 2020 7061 643d 7061            pad=pa
+000449a0: 642c 2070 6164 5f69 735f 6162 736f 6c75  d, pad_is_absolu
+000449b0: 7465 3d70 6164 5f69 735f 6162 736f 6c75  te=pad_is_absolu
+000449c0: 7465 290a 0a20 2020 2074 6573 7420 263d  te)..    test &=
+000449d0: 206e 6f74 5f65 6467 650a 0a20 2020 2069   not_edge..    i
+000449e0: 6620 6563 6f6c 2069 6e20 6361 742e 636f  f ecol in cat.co
+000449f0: 6c6e 616d 6573 3a0a 2020 2020 2020 2020  lnames:.        
+00044a00: 7661 6c69 6420 3d20 6e70 2e69 7366 696e  valid = np.isfin
+00044a10: 6974 6528 6361 745b 6563 6f6c 5d29 0a20  ite(cat[ecol]). 
+00044a20: 2020 2020 2020 2069 6620 6d61 785f 6572         if max_er
+00044a30: 725f 7065 7263 656e 7469 6c65 203c 2031  r_percentile < 1
+00044a40: 3030 3a0a 2020 2020 2020 2020 2020 2020  00:.            
+00044a50: 7465 7374 2026 3d20 6361 745b 6563 6f6c  test &= cat[ecol
+00044a60: 5d20 3c20 6e70 2e70 6572 6365 6e74 696c  ] < np.percentil
+00044a70: 6528 6361 745b 6563 6f6c 5d5b 287e 6e6f  e(cat[ecol][(~no
+00044a80: 745f 6564 6765 2920 2620 7661 6c69 645d  t_edge) & valid]
+00044a90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00044aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044ab0: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00044ac0: 6572 725f 7065 7263 656e 7469 6c65 290a  err_percentile).
+00044ad0: 0a20 2020 2072 6574 7572 6e20 7465 7374  .    return test
+00044ae0: 0a0a 0a64 6566 2068 756c 6c5f 6564 6765  ...def hull_edge
+00044af0: 5f6d 6173 6b28 782c 2079 2c20 7061 643d  _mask(x, y, pad=
+00044b00: 3130 302c 2070 6164 5f69 735f 6162 736f  100, pad_is_abso
+00044b10: 6c75 7465 3d54 7275 652c 206d 6173 6b3d  lute=True, mask=
+00044b20: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
+00044b30: 2020 2043 6f6d 7075 7465 2067 656f 6d65     Compute geome
+00044b40: 7472 6963 616c 2065 6467 6520 6d61 736b  trical edge mask
+00044b50: 2066 6f72 2070 6f69 6e74 7320 7769 7468   for points with
+00044b60: 696e 2061 2063 6f6e 7665 7820 6875 6c6c  in a convex hull
+00044b70: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+00044b80: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00044b90: 2020 2020 782c 2079 203a 2061 7272 6179      x, y : array
+00044ba0: 0a20 2020 2020 2020 2043 6f6f 7264 696e  .        Coordin
+00044bb0: 6174 6573 206f 6620 7468 6520 6361 7461  ates of the cata
+00044bc0: 6c6f 670a 0a20 2020 2070 6164 203a 2066  log..    pad : f
+00044bd0: 6c6f 6174 0a20 2020 2020 2020 2042 7566  loat.        Buf
+00044be0: 6665 7220 7061 6464 696e 670a 0a20 2020  fer padding..   
+00044bf0: 2070 6164 5f69 735f 6162 736f 6c75 7465   pad_is_absolute
+00044c00: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
+00044c10: 4966 2054 7275 652c 2074 6865 6e20 7468  If True, then th
+00044c20: 6520 6275 6666 6572 2069 7320 7461 6b65  e buffer is take
+00044c30: 6e20 6672 6f6d 2060 7061 6460 2028 652e  n from `pad` (e.
+00044c40: 672e 2c20 7069 7865 6c73 292e 2020 4966  g., pixels).  If
+00044c50: 0a20 2020 2020 2020 2046 616c 7365 2c20  .        False, 
+00044c60: 7468 656e 2060 7061 6460 2069 7320 7472  then `pad` is tr
+00044c70: 6561 7465 6420 6173 2061 2066 7261 6374  eated as a fract
+00044c80: 696f 6e20 6f66 2074 6865 206c 696e 6561  ion of the linea
+00044c90: 7220 6469 6d65 6e73 696f 6e0a 2020 2020  r dimension.    
+00044ca0: 2020 2020 6f66 2074 6865 2063 6174 616c      of the catal
+00044cb0: 6f67 2028 607e 7371 7274 2868 756c 6c20  og (`~sqrt(hull 
+00044cc0: 6172 6561 2960 292e 0a0a 2020 2020 6d61  area)`)...    ma
+00044cd0: 736b 203a 2062 6f6f 6c20 6172 7261 790a  sk : bool array.
+00044ce0: 2020 2020 2020 2020 4d61 736b 2074 6f20          Mask to 
+00044cf0: 6170 706c 7920 746f 2078 2f79 2062 6566  apply to x/y bef
+00044d00: 6f72 6520 636f 6d70 7574 696e 6720 7468  ore computing th
+00044d10: 6520 636f 6e76 6578 2068 756c 6c0a 0a20  e convex hull.. 
+00044d20: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+00044d30: 2d2d 2d2d 2d2d 0a20 2020 206d 6173 6b20  ------.    mask 
+00044d40: 3a20 626f 6f6c 2061 7272 6179 0a20 2020  : bool array.   
+00044d50: 2020 2020 2054 7275 6520 6966 2070 6f69       True if poi
+00044d60: 6e74 7320 7769 7468 696e 2074 6865 2062  nts within the b
+00044d70: 7566 6665 7265 6420 6875 6c6c 0a0a 2020  uffered hull..  
+00044d80: 2020 2222 220a 0a20 2020 2066 726f 6d20    """..    from 
+00044d90: 7363 6970 792e 7370 6174 6961 6c20 696d  scipy.spatial im
+00044da0: 706f 7274 2043 6f6e 7665 7848 756c 6c0a  port ConvexHull.
+00044db0: 2020 2020 6672 6f6d 2073 6861 7065 6c79      from shapely
+00044dc0: 2e67 656f 6d65 7472 7920 696d 706f 7274  .geometry import
+00044dd0: 2050 6f6c 7967 6f6e 2c20 506f 696e 740a   Polygon, Point.
+00044de0: 0a20 2020 2078 7920 3d20 6e70 2e61 7272  .    xy = np.arr
+00044df0: 6179 285b 782c 2079 5d29 2e54 0a0a 2020  ay([x, y]).T..  
+00044e00: 2020 6966 206d 6173 6b20 6973 204e 6f6e    if mask is Non
+00044e10: 653a 0a20 2020 2020 2020 2068 756c 6c20  e:.        hull 
+00044e20: 3d20 436f 6e76 6578 4875 6c6c 2878 7929  = ConvexHull(xy)
+00044e30: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00044e40: 2020 2068 756c 6c20 3d20 436f 6e76 6578     hull = Convex
+00044e50: 4875 6c6c 2878 795b 6d61 736b 2c20 3a5d  Hull(xy[mask, :]
+00044e60: 290a 0a20 2020 2070 7879 203d 2078 795b  )..    pxy = xy[
+00044e70: 6875 6c6c 2e76 6572 7469 6365 732c 203a  hull.vertices, :
+00044e80: 5d0a 2020 2020 706f 6c79 203d 2050 6f6c  ].    poly = Pol
+00044e90: 7967 6f6e 2870 7879 290a 0a20 2020 2069  ygon(pxy)..    i
+00044ea0: 6620 7061 645f 6973 5f61 6273 6f6c 7574  f pad_is_absolut
+00044eb0: 653a 0a20 2020 2020 2020 2062 7566 6620  e:.        buff 
+00044ec0: 3d20 2d70 6164 0a20 2020 2065 6c73 653a  = -pad.    else:
+00044ed0: 0a20 2020 2020 2020 2023 206c 696e 6561  .        # linea
+00044ee0: 7220 6469 6d65 6e73 696f 6e20 7e20 7371  r dimension ~ sq
+00044ef0: 7274 2861 7265 6129 0a20 2020 2020 2020  rt(area).       
+00044f00: 2062 7566 6620 3d20 2d70 6164 2a6e 702e   buff = -pad*np.
+00044f10: 7371 7274 2870 6f6c 792e 6172 6561 290a  sqrt(poly.area).
+00044f20: 0a20 2020 2070 6275 6666 203d 2070 6f6c  .    pbuff = pol
+00044f30: 792e 6275 6666 6572 2862 7566 6629 0a20  y.buffer(buff). 
+00044f40: 2020 2069 6e5f 6275 6666 203d 206e 702e     in_buff = np.
+00044f50: 6172 7261 7928 5b70 6275 6666 2e63 6f6e  array([pbuff.con
+00044f60: 7461 696e 7328 506f 696e 7428 5b78 5b69  tains(Point([x[i
+00044f70: 5d2c 2079 5b69 5d5d 2929 2066 6f72 2069  ], y[i]])) for i
+00044f80: 2069 6e20 7261 6e67 6528 6c65 6e28 7829   in range(len(x)
+00044f90: 295d 290a 0a20 2020 2072 6574 7572 6e20  )])..    return 
+00044fa0: 696e 5f62 7566 660a 0a0a 6465 6620 636f  in_buff...def co
+00044fb0: 6e76 6578 5f68 756c 6c5f 7772 6170 7065  nvex_hull_wrappe
+00044fc0: 7228 782c 2079 293a 0a20 2020 2022 2222  r(x, y):.    """
+00044fd0: 0a20 2020 2047 656e 6572 6174 6520 6120  .    Generate a 
+00044fe0: 636f 6e76 6578 2068 756c 6c20 6672 6f6d  convex hull from
+00044ff0: 2061 206c 6973 7420 6f66 2070 6f69 6e74   a list of point
+00045000: 730a 2020 2020 0a20 2020 2052 6574 7572  s.    .    Retur
+00045010: 6e73 3a0a 2020 2020 0a20 2020 2070 7879  ns:.    .    pxy
+00045020: 203a 2028 6172 7261 792c 2061 7272 6179   : (array, array
+00045030: 290a 2020 2020 2020 2020 5475 706c 6520  ).        Tuple 
+00045040: 6f66 2068 756c 6c20 7665 7274 6963 6573  of hull vertices
+00045050: 0a20 2020 200a 2020 2020 706f 6c79 203a  .    .    poly :
+00045060: 2060 7e73 6861 7065 6c79 2e67 656f 6d65   `~shapely.geome
+00045070: 7472 792e 506f 6c79 676f 6e60 0a20 2020  try.Polygon`.   
+00045080: 2020 2020 2050 6f6c 7967 6f6e 206f 626a       Polygon obj
+00045090: 6563 742e 0a20 2020 200a 2020 2020 6875  ect..    .    hu
+000450a0: 6c6c 203a 2060 7e73 6369 7079 2e73 7061  ll : `~scipy.spa
+000450b0: 7469 616c 2e43 6f6e 7665 7848 756c 6c60  tial.ConvexHull`
+000450c0: 0a20 2020 2020 2020 2054 6865 2068 756c  .        The hul
+000450d0: 6c20 6f62 6a65 6374 2e0a 2020 2020 2020  l object..      
+000450e0: 2020 0a20 2020 2022 2222 0a20 2020 2066    .    """.    f
+000450f0: 726f 6d20 7363 6970 792e 7370 6174 6961  rom scipy.spatia
+00045100: 6c20 696d 706f 7274 2043 6f6e 7665 7848  l import ConvexH
+00045110: 756c 6c0a 2020 2020 6672 6f6d 2073 6861  ull.    from sha
+00045120: 7065 6c79 2e67 656f 6d65 7472 7920 696d  pely.geometry im
+00045130: 706f 7274 2050 6f6c 7967 6f6e 2c20 506f  port Polygon, Po
+00045140: 696e 740a 0a20 2020 2078 7920 3d20 6e70  int..    xy = np
+00045150: 2e61 7272 6179 285b 782c 2079 5d29 2e54  .array([x, y]).T
+00045160: 0a20 2020 2068 756c 6c20 3d20 436f 6e76  .    hull = Conv
+00045170: 6578 4875 6c6c 2878 7929 0a20 2020 2070  exHull(xy).    p
+00045180: 7879 203d 2078 795b 6875 6c6c 2e76 6572  xy = xy[hull.ver
+00045190: 7469 6365 732c 203a 5d0a 2020 2020 706f  tices, :].    po
+000451a0: 6c79 203d 2050 6f6c 7967 6f6e 2870 7879  ly = Polygon(pxy
+000451b0: 290a 2020 2020 0a20 2020 2072 6574 7572  ).    .    retur
+000451c0: 6e20 7078 792c 2070 6f6c 792c 2068 756c  n pxy, poly, hul
+000451d0: 6c0a 0a0a 6465 6620 6875 6c6c 5f61 7265  l...def hull_are
+000451e0: 6128 782c 2079 293a 0a20 2020 2022 2222  a(x, y):.    """
+000451f0: 0a20 2020 2052 6574 7572 6e20 7468 6520  .    Return the 
+00045200: 6172 6561 206f 6620 6120 636f 6e76 6578  area of a convex
+00045210: 2068 756c 6c20 6f66 2061 206c 6973 7420   hull of a list 
+00045220: 6f66 2070 6f69 6e74 730a 2020 2020 2222  of points.    ""
+00045230: 220a 2020 2020 7078 792c 2070 6f6c 792c  ".    pxy, poly,
+00045240: 2068 756c 6c20 3d20 636f 6e76 6578 5f68   hull = convex_h
+00045250: 756c 6c5f 7772 6170 7065 7228 782c 2079  ull_wrapper(x, y
+00045260: 290a 0a20 2020 2072 6574 7572 6e20 706f  )..    return po
+00045270: 6c79 2e61 7265 610a 2020 2020 0a20 2020  ly.area.    .   
+00045280: 200a 6465 6620 7265 6d6f 7665 5f74 6578   .def remove_tex
+00045290: 745f 6c61 6265 6c73 2866 6967 293a 0a20  t_labels(fig):. 
+000452a0: 2020 2022 2222 0a20 2020 2052 656d 6f76     """.    Remov
+000452b0: 6520 616c 6c20 5465 7874 2061 6e6e 6f74  e all Text annot
+000452c0: 6174 696f 6e73 2066 726f 6d20 6060 6669  ations from ``fi
+000452d0: 672e 6178 6573 6060 2e0a 2020 2020 2222  g.axes``..    ""
+000452e0: 220a 2020 2020 696d 706f 7274 206d 6174  ".    import mat
+000452f0: 706c 6f74 6c69 620a 2020 2020 0a20 2020  plotlib.    .   
+00045300: 2066 6f72 2061 7820 696e 2066 6967 2e61   for ax in fig.a
+00045310: 7865 733a 0a20 2020 2020 2020 2066 6f72  xes:.        for
+00045320: 2063 6869 6c64 2069 6e20 6178 2e67 6574   child in ax.get
+00045330: 5f63 6869 6c64 7265 6e28 293a 0a20 2020  _children():.   
+00045340: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00045350: 7374 616e 6365 2863 6869 6c64 2c20 6d61  stance(child, ma
+00045360: 7470 6c6f 746c 6962 2e74 6578 742e 5465  tplotlib.text.Te
+00045370: 7874 293a 0a20 2020 2020 2020 2020 2020  xt):.           
+00045380: 2020 2020 2069 6620 6368 696c 642e 6765       if child.ge
+00045390: 745f 7465 7874 2829 3a20 2320 446f 6e27  t_text(): # Don'
+000453a0: 7420 7265 6d6f 7665 2065 6d70 7479 206c  t remove empty l
+000453b0: 6162 656c 730a 2020 2020 2020 2020 2020  abels.          
+000453c0: 2020 2020 2020 2020 2020 6368 696c 642e            child.
+000453d0: 7365 745f 7669 7369 626c 6528 4661 6c73  set_visible(Fals
+000453e0: 6529 0a0a 2020 2020 0a4c 4f47 4649 4c45  e)..    .LOGFILE
+000453f0: 203d 2027 2f74 6d70 2f67 7269 7a6c 692e   = '/tmp/grizli.
+00045400: 6c6f 6727 0a0a 0a64 6566 206c 6f67 5f66  log'...def log_f
+00045410: 756e 6374 696f 6e5f 6172 6775 6d65 6e74  unction_argument
+00045420: 7328 4c4f 4746 494c 452c 2066 7261 6d65  s(LOGFILE, frame
+00045430: 2c20 6675 6e63 3d27 6675 6e63 272c 2069  , func='func', i
+00045440: 676e 6f72 653d 5b5d 2c20 7665 7262 6f73  gnore=[], verbos
+00045450: 653d 5472 7565 293a 0a20 2020 2022 2222  e=True):.    """
+00045460: 0a20 2020 204c 6f67 206c 6f63 616c 2076  .    Log local v
+00045470: 6172 6961 626c 6573 2c20 652e 672e 2c20  ariables, e.g., 
+00045480: 7061 7261 6d65 7465 7220 6172 6775 656d  parameter arguem
+00045490: 656e 7473 2074 6f20 6120 6669 6c65 0a0a  ents to a file..
+000454a0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+000454b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+000454c0: 2020 4c4f 4746 494c 4520 3a20 7374 7220    LOGFILE : str 
+000454d0: 6f72 204e 6f6e 650a 2020 2020 2020 2020  or None.        
+000454e0: 4f75 7470 7574 2066 696c 652e 2020 4966  Output file.  If
+000454f0: 2060 4e6f 6e65 602c 2074 6865 6e20 666f   `None`, then fo
+00045500: 7263 6520 6076 6572 626f 7365 3d54 7275  rce `verbose=Tru
+00045510: 6560 2e0a 0a20 2020 2066 7261 6d65 203a  e`...    frame :
+00045520: 2060 7e69 6e73 7065 6374 2e63 7572 7265   `~inspect.curre
+00045530: 6e74 6672 616d 6528 2960 0a20 2020 2020  ntframe()`.     
+00045540: 2020 204e 616d 6573 7061 6365 206f 626a     Namespace obj
+00045550: 6563 742e 0a0a 2020 2020 6675 6e63 203a  ect...    func :
+00045560: 2073 7472 0a20 2020 2020 2020 2046 756e   str.        Fun
+00045570: 6374 696f 6e20 6e61 6d65 2074 6f20 7573  ction name to us
+00045580: 650a 2020 2020 0a20 2020 2069 676e 6f72  e.    .    ignor
+00045590: 6520 3a20 6c69 7374 0a20 2020 2020 2020  e : list.       
+000455a0: 2056 6172 6961 626c 6520 6e61 6d65 7320   Variable names 
+000455b0: 746f 2069 676e 6f72 650a 2020 2020 0a20  to ignore.    . 
+000455c0: 2020 2076 6572 626f 7365 203a 2062 6f6f     verbose : boo
+000455d0: 6c0a 2020 2020 2020 2020 5072 696e 7420  l.        Print 
+000455e0: 6d65 7373 6161 6765 2074 6f20 7374 646f  messaage to stdo
+000455f0: 7574 2e0a 0a20 2020 2022 2222 0a20 2020  ut...    """.   
+00045600: 2061 7267 7320 3d20 696e 7370 6563 742e   args = inspect.
+00045610: 6765 7461 7267 7661 6c75 6573 2866 7261  getargvalues(fra
+00045620: 6d65 292e 6c6f 6361 6c73 0a20 2020 2061  me).locals.    a
+00045630: 7267 732e 706f 7028 2766 7261 6d65 2729  rgs.pop('frame')
+00045640: 0a20 2020 2066 6f72 206b 2069 6e20 6c69  .    for k in li
+00045650: 7374 2861 7267 732e 6b65 7973 2829 293a  st(args.keys()):
+00045660: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
+00045670: 7474 7228 6172 6773 5b6b 5d2c 2027 5f5f  ttr(args[k], '__
+00045680: 6275 696c 7469 6e73 5f5f 2729 3a0a 2020  builtins__'):.  
+00045690: 2020 2020 2020 2020 2020 6172 6773 2e70            args.p
+000456a0: 6f70 286b 290a 2020 2020 0a20 2020 2066  op(k).    .    f
+000456b0: 6f72 206b 2069 6e20 6967 6e6f 7265 3a0a  or k in ignore:.
+000456c0: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
+000456d0: 6172 6773 3a0a 2020 2020 2020 2020 2020  args:.          
+000456e0: 2020 6172 6773 2e70 6f70 286b 290a 2020    args.pop(k).  
+000456f0: 2020 2020 2020 2020 2020 0a20 2020 2069            .    i
+00045700: 6620 6675 6e63 2069 7320 6e6f 7420 4e6f  f func is not No
+00045710: 6e65 3a0a 2020 2020 2020 2020 6c6f 6773  ne:.        logs
+00045720: 7472 203d 2027 5c6e 7b30 7d28 2a2a 7b31  tr = '\n{0}(**{1
+00045730: 7d29 5c6e 270a 2020 2020 656c 7365 3a0a  })\n'.    else:.
+00045740: 2020 2020 2020 2020 6c6f 6773 7472 203d          logstr =
+00045750: 2027 5c6e 7b31 7d27 0a0a 2020 2020 6c6f   '\n{1}'..    lo
+00045760: 6773 7472 203d 206c 6f67 7374 722e 666f  gstr = logstr.fo
+00045770: 726d 6174 2866 756e 632c 2061 7267 7329  rmat(func, args)
+00045780: 0a20 2020 206d 7367 203d 206c 6f67 5f63  .    msg = log_c
+00045790: 6f6d 6d65 6e74 284c 4f47 4649 4c45 2c20  omment(LOGFILE, 
+000457a0: 6c6f 6773 7472 2c20 7665 7262 6f73 653d  logstr, verbose=
+000457b0: 7665 7262 6f73 652c 2073 686f 775f 6461  verbose, show_da
+000457c0: 7465 3d54 7275 6529 0a0a 2020 2020 7265  te=True)..    re
+000457d0: 7475 726e 206d 7367 0a0a 0a64 6566 2063  turn msg...def c
+000457e0: 7469 6d65 5f74 6f5f 6973 6f28 6d74 696d  time_to_iso(mtim
+000457f0: 652c 2066 6f72 6d61 743d 2725 6120 2562  e, format='%a %b
+00045800: 2025 6420 2548 3a25 4d3a 2553 2025 5927   %d %H:%M:%S %Y'
+00045810: 2c20 7374 7269 705f 6465 6369 6d61 6c3d  , strip_decimal=
+00045820: 5472 7565 2c20 7665 7262 6f73 653d 5472  True, verbose=Tr
+00045830: 7565 293a 0a20 2020 2022 2222 0a20 2020  ue):.    """.   
+00045840: 2043 6f6e 7665 7274 2060 7469 6d65 2e63   Convert `time.c
+00045850: 7469 6d65 6020 7374 7269 6e67 7320 746f  time` strings to
+00045860: 2049 534f 2064 6174 6573 0a0a 2020 2020   ISO dates..    
+00045870: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00045880: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6d74  ---------.    mt
+00045890: 696d 6520 3a20 7374 720a 2020 2020 2020  ime : str.      
+000458a0: 2020 5469 6d65 2073 7472 696e 672c 2067    Time string, g
+000458b0: 656e 6572 616c 6c79 2061 7320 6f75 7470  enerally as outp
+000458c0: 7574 2066 726f 6d20 6074 696d 652e 6374  ut from `time.ct
+000458d0: 696d 6560 2c20 652e 672e 2c20 0a20 2020  ime`, e.g., .   
+000458e0: 2020 2020 2060 6027 4d6f 6e20 5365 7020       ``'Mon Sep 
+000458f0: 3136 2031 313a 3233 3a32 3720 3230 3139  16 11:23:27 2019
+00045900: 2760 600a 0a20 2020 2066 6f72 6d61 7420  '``..    format 
+00045910: 3a20 7374 720a 2020 2020 2020 2020 6064  : str.        `d
+00045920: 6174 6574 696d 652e 7374 7270 7469 6d65  atetime.strptime
+00045930: 6020 666f 726d 6174 2073 7472 696e 672c  ` format string,
+00045940: 2063 6f64 6573 2061 7420 0a20 2020 2020   codes at .     
+00045950: 2020 2068 7474 7073 3a2f 2f77 7777 2e70     https://www.p
+00045960: 726f 6772 616d 697a 2e63 6f6d 2f70 7974  rogramiz.com/pyt
+00045970: 686f 6e2d 7072 6f67 7261 6d6d 696e 672f  hon-programming/
+00045980: 6461 7465 7469 6d65 2f73 7472 7074 696d  datetime/strptim
+00045990: 650a 0a20 2020 2073 7472 6970 5f64 6563  e..    strip_dec
+000459a0: 696d 616c 203a 2062 6f6f 6c0a 2020 2020  imal : bool.    
+000459b0: 2020 2020 5374 7269 7020 6465 6369 6d61      Strip decima
+000459c0: 6c20 7365 636f 6e64 7320 6672 6f6d 2065  l seconds from e
+000459d0: 6e64 206f 6620 4953 4f20 7374 7269 6e67  nd of ISO string
+000459e0: 0a0a 2020 2020 7665 7262 6f73 6520 3a20  ..    verbose : 
+000459f0: 626f 6f6c 0a20 2020 2020 2020 2050 7269  bool.        Pri
+00045a00: 6e74 2061 206d 6573 7361 6765 2069 6620  nt a message if 
+00045a10: 636f 6e76 6572 7369 6f6e 2066 6169 6c73  conversion fails
+00045a20: 0a0a 2020 2020 5265 7475 726e 7320 0a20  ..    Returns . 
+00045a30: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2069     -------.    i
+00045a40: 736f 203a 2073 7472 0a20 2020 2020 2020  so : str.       
+00045a50: 2053 7472 696e 6720 696e 2028 736f 7274   String in (sort
+00045a60: 6162 6c65 2920 4953 4f20 666f 726d 6174  able) ISO format
+00045a70: 2c20 652e 672e 2c20 6060 2732 3031 392d  , e.g., ``'2019-
+00045a80: 3039 2d31 3620 3131 3a32 333a 3237 2e30  09-16 11:23:27.0
+00045a90: 3030 2760 600a 0a20 2020 2022 2222 0a20  00'``..    """. 
+00045aa0: 2020 2066 726f 6d20 6173 7472 6f70 792e     from astropy.
+00045ab0: 7469 6d65 2069 6d70 6f72 7420 5469 6d65  time import Time
+00045ac0: 0a20 2020 2066 726f 6d20 6461 7465 7469  .    from dateti
+00045ad0: 6d65 2069 6d70 6f72 7420 6461 7465 7469  me import dateti
+00045ae0: 6d65 0a0a 2020 2020 2320 4973 2061 6c72  me..    # Is alr
+00045af0: 6561 6479 2049 534f 2066 6f72 6d61 740a  eady ISO format.
+00045b00: 2020 2020 6966 206d 7469 6d65 2e63 6f75      if mtime.cou
+00045b10: 6e74 2827 2d27 2920 3d3d 2032 3a0a 2020  nt('-') == 2:.  
+00045b20: 2020 2020 2020 6973 6f20 3d20 6d74 696d        iso = mtim
+00045b30: 6520 2b20 2727 0a0a 2020 2020 656c 7365  e + ''..    else
+00045b40: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+00045b50: 2020 2020 2020 2020 2020 2069 736f 203d             iso =
+00045b60: 2054 696d 6528 6461 7465 7469 6d65 2e73   Time(datetime.s
+00045b70: 7472 7074 696d 6528 6d74 696d 652c 2066  trptime(mtime, f
+00045b80: 6f72 6d61 7429 2c20 0a20 2020 2020 2020  ormat), .       
+00045b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045ba0: 666f 726d 6174 3d27 6461 7465 7469 6d65  format='datetime
+00045bb0: 2729 2e69 736f 0a20 2020 2020 2020 2065  ').iso.        e
+00045bc0: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+00045bd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00045be0: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
+00045bf0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00045c00: 6627 436f 756c 646e 5c27 7420 636f 6e76  f'Couldn\'t conv
+00045c10: 6572 7420 5c27 7b6d 7469 6d65 7d5c 2720  ert \'{mtime}\' 
+00045c20: 7769 7468 2027 0a20 2020 2020 2020 2020  with '.         
+00045c30: 2020 2020 2020 2020 2020 2020 2066 2766               f'f
+00045c40: 6f72 6d61 7420 5c27 7b66 6f72 6d61 747d  ormat \'{format}
+00045c50: 5c27 2729 0a0a 2020 2020 2020 2020 2020  \'')..          
+00045c60: 2020 6973 6f20 3d20 6d74 696d 6520 2b20    iso = mtime + 
+00045c70: 2727 0a0a 2020 2020 6966 2073 7472 6970  ''..    if strip
+00045c80: 5f64 6563 696d 616c 3a0a 2020 2020 2020  _decimal:.      
+00045c90: 2020 6973 6f20 3d20 6973 6f2e 7370 6c69    iso = iso.spli
+00045ca0: 7428 272e 2729 5b30 5d0a 0a20 2020 2072  t('.')[0]..    r
+00045cb0: 6574 7572 6e20 6973 6f0a 0a0a 6465 6620  eturn iso...def 
+00045cc0: 6e6f 7774 696d 6528 6973 6f3d 5472 7565  nowtime(iso=True
+00045cd0: 293a 0a20 2020 2022 2222 0a20 2020 2057  ):.    """.    W
+00045ce0: 7261 7070 6572 2066 6f72 2060 6173 7472  rapper for `astr
+00045cf0: 6f70 792e 7469 6d65 2e6e 6f77 600a 0a20  opy.time.now`.. 
+00045d00: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00045d10: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00045d20: 2069 736f 203a 2062 6f6f 6c0a 2020 2020   iso : bool.    
+00045d30: 2020 2020 4966 2054 7275 652c 2072 6574      If True, ret
+00045d40: 7572 6e20 7469 6d65 2069 6e20 4953 4f20  urn time in ISO 
+00045d50: 7374 7269 6e67 2c20 656c 7365 2072 6574  string, else ret
+00045d60: 7572 6e20 5469 6d65 206f 626a 6563 740a  urn Time object.
+00045d70: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+00045d80: 202d 2d2d 2d2d 2d2d 0a20 2020 2074 6e6f   -------.    tno
+00045d90: 7720 3a20 7374 720a 2020 2020 2020 2020  w : str.        
+00045da0: 5365 6520 6069 736f 600a 0a20 2020 2022  See `iso`..    "
+00045db0: 2222 0a20 2020 2066 726f 6d20 6173 7472  "".    from astr
+00045dc0: 6f70 792e 7469 6d65 2069 6d70 6f72 7420  opy.time import 
+00045dd0: 5469 6d65 0a20 2020 2074 6e6f 7720 3d20  Time.    tnow = 
+00045de0: 5469 6d65 2e6e 6f77 2829 0a20 2020 2069  Time.now().    i
+00045df0: 6620 6973 6f3a 0a20 2020 2020 2020 2072  f iso:.        r
+00045e00: 6574 7572 6e20 746e 6f77 2e69 736f 0a20  eturn tnow.iso. 
+00045e10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00045e20: 2072 6574 7572 6e20 746e 6f77 0a0a 0a64   return tnow...d
+00045e30: 6566 2066 6967 7572 655f 7469 6d65 7374  ef figure_timest
+00045e40: 616d 7028 6669 672c 2078 3d30 2e39 372c  amp(fig, x=0.97,
+00045e50: 2079 3d30 2e30 322c 2069 736f 3d54 7275   y=0.02, iso=Tru
+00045e60: 652c 2068 613d 2772 6967 6874 272c 2076  e, ha='right', v
+00045e70: 613d 2762 6f74 746f 6d27 2c20 666f 6e74  a='bottom', font
+00045e80: 7369 7a65 3d35 2c20 636f 6c6f 723d 276b  size=5, color='k
+00045e90: 272c 2061 6c70 6861 3d31 2e29 3a0a 2020  ', alpha=1.):.  
+00045ea0: 2020 2222 220a 2020 2020 4164 6420 6120    """.    Add a 
+00045eb0: 7469 6d65 7374 616d 7020 746f 2061 2066  timestamp to a f
+00045ec0: 6967 7572 6520 6f75 7470 7574 0a20 2020  igure output.   
+00045ed0: 200a 2020 2020 5061 7261 6d65 7465 7273   .    Parameters
+00045ee0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00045ef0: 2020 2020 6669 6720 3a20 606d 6174 706c      fig : `matpl
+00045f00: 6f74 6c69 6260 2046 6967 7572 650a 2020  otlib` Figure.  
+00045f10: 2020 2020 2020 4669 6775 7265 206f 626a        Figure obj
+00045f20: 6563 740a 2020 2020 0a20 2020 2078 2c20  ect.    .    x, 
+00045f30: 7920 3a20 666c 6f61 740a 2020 2020 2020  y : float.      
+00045f40: 2020 4c61 6265 6c20 706f 7369 7469 6f6e    Label position
+00045f50: 2069 6e20 6066 6967 2e74 7261 6e73 4669   in `fig.transFi
+00045f60: 6775 7265 6020 636f 6f72 6469 6e61 7465  gure` coordinate
+00045f70: 7320 2869 2e65 2e2c 2030 203c 2078 2c79  s (i.e., 0 < x,y
+00045f80: 203c 2031 290a 2020 2020 0a20 2020 2069   < 1).    .    i
+00045f90: 736f 203a 2062 6f6f 6c0a 2020 2020 2020  so : bool.      
+00045fa0: 2020 5573 6520 4953 4f2d 666f 726d 6174    Use ISO-format
+00045fb0: 7465 6420 7469 6d65 2066 726f 6d20 607e  ted time from `~
+00045fc0: 6772 697a 6c69 2e75 7469 6c73 2e63 7469  grizli.utils.cti
+00045fd0: 6d65 5f74 6f5f 6973 6f60 2c20 6f74 6865  me_to_iso`, othe
+00045fe0: 7277 6973 6520 7573 650a 2020 2020 2020  rwise use.      
+00045ff0: 2020 6074 696d 652e 6374 696d 6528 2960    `time.ctime()`
+00046000: 0a20 2020 200a 2020 2020 6861 2c20 7661  .    .    ha, va
+00046010: 203a 2073 7472 0a20 2020 2020 2020 2048   : str.        H
+00046020: 6f72 697a 6f6e 7461 6c20 616e 6420 7665  orizontal and ve
+00046030: 7274 6963 616c 2061 6c69 676e 6d65 6e74  rtical alignment
+00046040: 0a20 2020 200a 2020 2020 666f 6e74 7369  .    .    fontsi
+00046050: 7a65 2c20 636f 6c6f 722c 2061 6c70 6861  ze, color, alpha
+00046060: 3a20 696e 742c 2073 7472 2c20 666c 6f61  : int, str, floa
+00046070: 740a 2020 2020 2020 2020 4c61 6265 6c20  t.        Label 
+00046080: 7072 6f70 6572 7469 6573 2028 696e 2060  properties (in `
+00046090: 6d61 7470 6c6f 746c 6962 2e46 6967 7572  matplotlib.Figur
+000460a0: 652e 7465 7874 6029 0a20 2020 200a 2020  e.text`).    .  
+000460b0: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+000460c0: 2d2d 2d2d 2d0a 2020 2020 4164 6473 2061  -----.    Adds a
+000460d0: 2074 696d 6573 7461 6d70 2074 6f20 7468   timestamp to th
+000460e0: 6520 6066 6967 6020 6f62 6a65 6374 0a20  e `fig` object. 
+000460f0: 2020 200a 2020 2020 2222 220a 2020 2020     .    """.    
+00046100: 696d 706f 7274 2074 696d 650a 2020 2020  import time.    
+00046110: 0a20 2020 2074 696d 655f 7374 7220 3d20  .    time_str = 
+00046120: 7469 6d65 2e63 7469 6d65 2829 0a20 2020  time.ctime().   
+00046130: 200a 2020 2020 6966 2069 736f 3a0a 2020   .    if iso:.  
+00046140: 2020 2020 2020 7469 6d65 5f73 7472 203d        time_str =
+00046150: 2063 7469 6d65 5f74 6f5f 6973 6f28 7469   ctime_to_iso(ti
+00046160: 6d65 5f73 7472 2c20 7665 7262 6f73 653d  me_str, verbose=
+00046170: 4661 6c73 6529 0a20 2020 2020 2020 200a  False).        .
+00046180: 2020 2020 6669 672e 7465 7874 2878 2c20      fig.text(x, 
+00046190: 792c 2074 696d 655f 7374 722c 0a20 2020  y, time_str,.   
+000461a0: 2020 2020 2020 2020 2020 6861 3d68 612c            ha=ha,
+000461b0: 2076 613d 7661 2c0a 2020 2020 2020 2020   va=va,.        
+000461c0: 2020 2020 2066 6f6e 7473 697a 653d 666f       fontsize=fo
+000461d0: 6e74 7369 7a65 2c0a 2020 2020 2020 2020  ntsize,.        
+000461e0: 2020 2020 2074 7261 6e73 666f 726d 3d66       transform=f
+000461f0: 6967 2e74 7261 6e73 4669 6775 7265 2c0a  ig.transFigure,.
+00046200: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00046210: 6f72 3d63 6f6c 6f72 2c20 616c 7068 613d  or=color, alpha=
+00046220: 616c 7068 6129 0a0a 0a64 6566 206c 6f67  alpha)...def log
+00046230: 5f63 6f6d 6d65 6e74 284c 4f47 4649 4c45  _comment(LOGFILE
+00046240: 2c20 636f 6d6d 656e 742c 2076 6572 626f  , comment, verbo
+00046250: 7365 3d46 616c 7365 2c20 7368 6f77 5f64  se=False, show_d
+00046260: 6174 653d 4661 6c73 652c 206d 6f64 653d  ate=False, mode=
+00046270: 2761 2729 3a0a 2020 2020 2222 220a 2020  'a'):.    """.  
+00046280: 2020 4c6f 6720 6120 6d65 7373 6167 6520    Log a message 
+00046290: 746f 2061 2066 696c 652c 206f 7074 696f  to a file, optio
+000462a0: 6e61 6c6c 7920 696e 636c 7564 696e 6720  nally including 
+000462b0: 6120 6461 7465 2074 6167 0a20 2020 2022  a date tag.    "
+000462c0: 2222 0a20 2020 2069 6d70 6f72 7420 7469  "".    import ti
+000462d0: 6d65 0a0a 2020 2020 6966 2073 686f 775f  me..    if show_
+000462e0: 6461 7465 3a0a 2020 2020 2020 2020 6d73  date:.        ms
+000462f0: 6720 3d20 2723 2028 7b30 7d29 5c6e 272e  g = '# ({0})\n'.
+00046300: 666f 726d 6174 286e 6f77 7469 6d65 2829  format(nowtime()
+00046310: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+00046320: 2020 2020 6d73 6720 3d20 2727 0a0a 2020      msg = ''..  
+00046330: 2020 6d73 6720 2b3d 2027 7b30 7d5c 6e27    msg += '{0}\n'
+00046340: 2e66 6f72 6d61 7428 636f 6d6d 656e 7429  .format(comment)
+00046350: 0a0a 2020 2020 6966 204c 4f47 4649 4c45  ..    if LOGFILE
+00046360: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00046370: 2020 2020 2020 6670 203d 206f 7065 6e28        fp = open(
+00046380: 4c4f 4746 494c 452c 206d 6f64 6529 0a20  LOGFILE, mode). 
+00046390: 2020 2020 2020 2066 702e 7772 6974 6528         fp.write(
+000463a0: 6d73 6729 0a20 2020 2020 2020 2066 702e  msg).        fp.
+000463b0: 636c 6f73 6528 290a 0a20 2020 2069 6620  close()..    if 
+000463c0: 7665 7262 6f73 653a 0a20 2020 2020 2020  verbose:.       
+000463d0: 2070 7269 6e74 286d 7367 5b3a 2d31 5d29   print(msg[:-1])
+000463e0: 0a0a 2020 2020 7265 7475 726e 206d 7367  ..    return msg
+000463f0: 0a0a 0a64 6566 206c 6f67 5f65 7863 6570  ...def log_excep
+00046400: 7469 6f6e 284c 4f47 4649 4c45 2c20 7472  tion(LOGFILE, tr
+00046410: 6163 6562 6163 6b2c 2076 6572 626f 7365  aceback, verbose
+00046420: 3d54 7275 652c 206d 6f64 653d 2761 2729  =True, mode='a')
+00046430: 3a0a 2020 2020 2222 220a 2020 2020 4c6f  :.    """.    Lo
+00046440: 6720 6578 6365 7074 696f 6e20 696e 666f  g exception info
+00046450: 726d 6174 696f 6e20 746f 2061 2066 696c  rmation to a fil
+00046460: 652c 206f 7220 7072 696e 7420 746f 2073  e, or print to s
+00046470: 6372 6565 6e0a 0a20 2020 2050 6172 616d  creen..    Param
+00046480: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00046490: 2d2d 2d2d 0a20 2020 204c 4f47 4649 4c45  ----.    LOGFILE
+000464a0: 203a 2073 7472 206f 7220 4e6f 6e65 0a20   : str or None. 
+000464b0: 2020 2020 2020 204f 7574 7075 7420 6669         Output fi
+000464c0: 6c65 2e20 2049 6620 604e 6f6e 6560 2c20  le.  If `None`, 
+000464d0: 7468 656e 2066 6f72 6365 2060 7665 7262  then force `verb
+000464e0: 6f73 653d 5472 7565 602e 0a0a 2020 2020  ose=True`...    
+000464f0: 7472 6163 6562 6163 6b20 3a20 6275 696c  traceback : buil
+00046500: 7469 6e20 7472 6163 6562 6163 6b20 6d6f  tin traceback mo
+00046510: 6475 6c65 0a20 2020 2020 2020 2045 7863  dule.        Exc
+00046520: 6570 7469 6f6e 2074 7261 6365 6261 636b  eption traceback
+00046530: 2c20 6672 6f6d 2067 6c6f 6261 6c20 6069  , from global `i
+00046540: 6d70 6f72 7420 7472 6163 6562 6163 6b60  mport traceback`
+00046550: 2e0a 0a20 2020 2076 6572 626f 7365 203a  ...    verbose :
+00046560: 2062 6f6f 6c0a 2020 2020 2020 2020 5072   bool.        Pr
+00046570: 696e 7420 6578 6365 7074 696f 6e20 746f  int exception to
+00046580: 2073 7464 6f75 742e 0a0a 2020 2020 6d6f   stdout...    mo
+00046590: 6465 203a 2027 6127 2c20 2777 270a 2020  de : 'a', 'w'.  
+000465a0: 2020 2020 2020 4669 6c65 206d 6f64 6520        File mode 
+000465b0: 6f6e 2060 6f70 656e 284c 4f47 4649 4c45  on `open(LOGFILE
+000465c0: 2c20 6d6f 6465 2960 2c20 692e 652e 2c20  , mode)`, i.e., 
+000465d0: 6170 7065 6e64 206f 7220 7772 6974 652e  append or write.
+000465e0: 0a0a 2020 2020 2222 220a 2020 2020 696d  ..    """.    im
+000465f0: 706f 7274 2074 696d 650a 0a20 2020 2074  port time..    t
+00046600: 7261 6365 203d 2074 7261 6365 6261 636b  race = traceback
+00046610: 2e66 6f72 6d61 745f 6578 6328 6c69 6d69  .format_exc(limi
+00046620: 743d 3229 0a20 2020 206c 6f67 203d 2027  t=2).    log = '
+00046630: 5c6e 2323 2323 2323 2323 2323 2323 2323  \n##############
+00046640: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00046650: 2323 2323 2323 2323 2323 2323 205c 6e27  ############ \n'
+00046660: 0a20 2020 206c 6f67 202b 3d20 2723 2021  .    log += '# !
+00046670: 2045 7863 6570 7469 6f6e 2028 7b30 7d29   Exception ({0})
+00046680: 5c6e 272e 666f 726d 6174 286e 6f77 7469  \n'.format(nowti
+00046690: 6d65 2829 290a 2020 2020 6c6f 6720 2b3d  me()).    log +=
+000466a0: 2027 235c 6e23 2021 272b 275c 6e23 2021   '#\n# !'+'\n# !
+000466b0: 272e 6a6f 696e 2874 7261 6365 2e73 706c  '.join(trace.spl
+000466c0: 6974 2827 5c6e 2729 290a 2020 2020 6c6f  it('\n')).    lo
+000466d0: 6720 2b3d 2027 5c6e 2323 2323 2323 2323  g += '\n########
+000466e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000466f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00046700: 2320 5c6e 5c6e 270a 2020 2020 6966 2076  # \n\n'.    if v
+00046710: 6572 626f 7365 207c 2028 4c4f 4746 494c  erbose | (LOGFIL
+00046720: 4520 6973 204e 6f6e 6529 3a0a 2020 2020  E is None):.    
+00046730: 2020 2020 7072 696e 7428 6c6f 6729 0a0a      print(log)..
+00046740: 2020 2020 6966 204c 4f47 4649 4c45 2069      if LOGFILE i
+00046750: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00046760: 2020 2020 6670 203d 206f 7065 6e28 4c4f      fp = open(LO
+00046770: 4746 494c 452c 206d 6f64 6529 0a20 2020  GFILE, mode).   
+00046780: 2020 2020 2066 702e 7772 6974 6528 6c6f       fp.write(lo
+00046790: 6729 0a20 2020 2020 2020 2066 702e 636c  g).        fp.cl
+000467a0: 6f73 6528 290a 0a64 6566 2073 696d 706c  ose()..def simpl
+000467b0: 655f 4c43 444d 284f 6d30 3d30 2e33 2c20  e_LCDM(Om0=0.3, 
+000467c0: 4f64 6530 3d30 2e37 2c20 4830 3d37 302c  Ode0=0.7, H0=70,
+000467d0: 204f 6230 3d30 2e30 3436 332c 2054 636d   Ob0=0.0463, Tcm
+000467e0: 6230 3d32 2e37 3235 2c20 6e61 6d65 3d4e  b0=2.725, name=N
+000467f0: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
+00046800: 2020 5369 6d70 6c65 204c 616d 6264 6143    Simple LambdaC
+00046810: 444d 2063 6f73 6d6f 6c6f 6779 0a20 2020  DM cosmology.   
+00046820: 200a 2020 2020 5061 7261 6d65 7465 7273   .    Parameters
+00046830: 2061 7265 2064 6566 696e 6564 2061 7320   are defined as 
+00046840: 696e 2060 7e61 7374 726f 7079 2e63 6f73  in `~astropy.cos
+00046850: 6d6f 6c6f 6779 2e4c 616d 6264 6143 444d  mology.LambdaCDM
+00046860: 602e 0a20 2020 200a 2020 2020 2222 220a  `..    .    """.
+00046870: 2020 2020 6672 6f6d 2061 7374 726f 7079      from astropy
+00046880: 2e63 6f73 6d6f 6c6f 6779 2069 6d70 6f72  .cosmology impor
+00046890: 7420 4c61 6d62 6461 4344 4d0a 2020 2020  t LambdaCDM.    
+000468a0: 636f 736d 6f6c 6f67 7920 3d20 4c61 6d62  cosmology = Lamb
+000468b0: 6461 4344 4d28 4830 2c20 4f6d 302c 204f  daCDM(H0, Om0, O
+000468c0: 6465 302c 2054 636d 6230 3d54 636d 6230  de0, Tcmb0=Tcmb0
+000468d0: 2c20 6e61 6d65 3d6e 616d 6529 0a20 2020  , name=name).   
+000468e0: 2072 6574 7572 6e20 636f 736d 6f6c 6f67   return cosmolog
+000468f0: 790a 0a0a 6465 6620 7069 7865 6c5f 706f  y...def pixel_po
+00046900: 6c79 676f 6e5f 6d61 736b 2870 6f6c 7967  lygon_mask(polyg
+00046910: 6f6e 2c20 7368 6170 652c 2077 6373 3d4e  on, shape, wcs=N
+00046920: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
+00046930: 2020 4d61 6b65 2061 206d 6173 6b20 706f    Make a mask po
+00046940: 696e 7473 2069 6e20 6120 3244 2061 7272  ints in a 2D arr
+00046950: 6179 2069 6e73 6964 6520 6120 706f 6c79  ay inside a poly
+00046960: 676f 6e0a 2020 2020 0a20 2020 2050 6172  gon.    .    Par
+00046970: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00046980: 2d2d 2d2d 2d2d 0a20 2020 2070 6f6c 7967  ------.    polyg
+00046990: 6f6e 203a 2073 7472 2c20 2832 2c4d 2920  on : str, (2,M) 
+000469a0: 6172 7261 790a 2020 2020 2020 2020 536f  array.        So
+000469b0: 6d65 7468 696e 6720 7468 6174 2060 6772  mething that `gr
+000469c0: 697a 6c69 2e75 7469 6c73 2e53 5265 6769  izli.utils.SRegi
+000469d0: 6f6e 6020 6361 6e20 7061 7273 6520 6173  on` can parse as
+000469e0: 2061 2070 6f6c 7967 6f6e 0a20 2020 200a   a polygon.    .
+000469f0: 2020 2020 7368 6170 6520 3a20 7475 706c      shape : tupl
+00046a00: 650a 2020 2020 2020 2020 322d 7475 706c  e.        2-tupl
+00046a10: 6520 6f66 2069 6d61 6765 2064 696d 656e  e of image dimen
+00046a20: 7369 6f6e 730a 2020 2020 0a20 2020 2077  sions.    .    w
+00046a30: 6373 203a 2060 6173 7472 6f70 792e 7763  cs : `astropy.wc
+00046a40: 732e 5743 5360 0a20 2020 2020 2020 2049  s.WCS`.        I
+00046a50: 6620 7370 6563 6966 6965 642c 2061 7373  f specified, ass
+00046a60: 756d 6520 6060 706f 6c79 676f 6e60 6020  ume ``polygon`` 
+00046a70: 6973 2073 6b79 2063 6f6f 7264 696e 6174  is sky coordinat
+00046a80: 6573 2061 6e64 2074 7261 6e73 666f 726d  es and transform
+00046a90: 2074 6f0a 2020 2020 2020 2020 696d 6167   to.        imag
+00046aa0: 652e 0a20 2020 200a 2020 2020 5265 7475  e..    .    Retu
+00046ab0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+00046ac0: 2020 2020 6d61 736b 203a 2061 7272 6179      mask : array
+00046ad0: 0a20 2020 2020 2020 2060 6062 6f6f 6c60  .        ``bool`
+00046ae0: 6020 6172 7261 7920 7769 7468 2060 6073  ` array with ``s
+00046af0: 6861 7065 6060 2074 6861 7420 6973 2060  hape`` that is `
+00046b00: 5472 7565 6020 696e 7369 6465 2060 706f  True` inside `po
+00046b10: 6c79 676f 6e60 0a20 2020 2022 2222 0a20  lygon`.    """. 
+00046b20: 2020 2073 7220 3d20 5352 6567 696f 6e28     sr = SRegion(
+00046b30: 706f 6c79 676f 6e2c 2077 7261 703d 4661  polygon, wrap=Fa
+00046b40: 6c73 6529 0a20 2020 200a 2020 2020 7970  lse).    .    yp
+00046b50: 2c20 7870 203d 206e 702e 696e 6469 6365  , xp = np.indice
+00046b60: 7328 7368 6170 6529 0a20 2020 2070 7473  s(shape).    pts
+00046b70: 203d 206e 702e 6172 7261 7928 5b78 702e   = np.array([xp.
+00046b80: 666c 6174 7465 6e28 292c 2079 702e 666c  flatten(), yp.fl
+00046b90: 6174 7465 6e28 295d 292e 540a 2020 2020  atten()]).T.    
+00046ba0: 0a20 2020 2069 6620 7763 7320 6973 206e  .    if wcs is n
+00046bb0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00046bc0: 2070 7473 203d 2077 6373 2e61 6c6c 5f70   pts = wcs.all_p
+00046bd0: 6978 3277 6f72 6c64 2870 7473 2c20 3029  ix2world(pts, 0)
+00046be0: 0a20 2020 2020 2020 200a 2020 2020 6d61  .        .    ma
+00046bf0: 736b 203d 206e 702e 7a65 726f 7328 7368  sk = np.zeros(sh
+00046c00: 6170 652c 2064 7479 7065 3d62 6f6f 6c29  ape, dtype=bool)
+00046c10: 2e66 6c61 7474 656e 2829 0a20 2020 2066  .flatten().    f
+00046c20: 6f72 2070 2069 6e20 7372 2e70 6174 683a  or p in sr.path:
+00046c30: 0a20 2020 2020 2020 206d 6173 6b20 7c3d  .        mask |=
+00046c40: 2070 2e63 6f6e 7461 696e 735f 706f 696e   p.contains_poin
+00046c50: 7473 2870 7473 290a 2020 2020 0a20 2020  ts(pts).    .   
+00046c60: 2072 6574 7572 6e20 6d61 736b 2e72 6573   return mask.res
+00046c70: 6861 7065 2873 6861 7065 290a 0a0a 6465  hape(shape)...de
+00046c80: 6620 6d61 6b65 5f66 696c 7465 725f 666f  f make_filter_fo
+00046c90: 6f74 7072 696e 7428 6669 6c74 6572 5f73  otprint(filter_s
+00046ca0: 697a 653d 3731 2c20 6669 6c74 6572 5f63  ize=71, filter_c
+00046cb0: 656e 7472 616c 3d30 2c20 2a2a 6b77 6172  entral=0, **kwar
+00046cc0: 6773 293a 0a20 2020 2022 2222 0a20 2020  gs):.    """.   
+00046cd0: 204d 616b 6520 6120 666f 6f74 7072 696e   Make a footprin
+00046ce0: 7420 666f 7220 696d 6167 6520 6669 6c74  t for image filt
+00046cf0: 6572 696e 670a 2020 2020 2222 220a 2020  ering.    """.  
+00046d00: 2020 6669 6c74 6572 5f66 6f6f 7470 7269    filter_footpri
+00046d10: 6e74 203d 206e 702e 6f6e 6573 2866 696c  nt = np.ones(fil
+00046d20: 7465 725f 7369 7a65 2c20 6474 7970 653d  ter_size, dtype=
+00046d30: 696e 7429 0a20 2020 200a 2020 2020 6966  int).    .    if
+00046d40: 2066 696c 7465 725f 6365 6e74 7261 6c20   filter_central 
+00046d50: 3e20 303a 0a20 2020 2020 2020 2066 3020  > 0:.        f0 
+00046d60: 3d20 2866 696c 7465 725f 7369 7a65 2d31  = (filter_size-1
+00046d70: 292f 2f32 0a20 2020 2020 2020 2066 696c  )//2.        fil
+00046d80: 7465 725f 666f 6f74 7072 696e 745b 6630  ter_footprint[f0
+00046d90: 2d66 696c 7465 725f 6365 6e74 7261 6c3a  -filter_central:
+00046da0: 6630 2b66 696c 7465 725f 6365 6e74 7261  f0+filter_centra
+00046db0: 6c5d 203d 2030 0a20 2020 200a 2020 2020  l] = 0.    .    
+00046dc0: 7265 7475 726e 2066 696c 7465 725f 666f  return filter_fo
+00046dd0: 6f74 7072 696e 740a 0a0a 6465 6620 7361  otprint...def sa
+00046de0: 6665 5f6e 616e 6d65 6469 616e 5f66 696c  fe_nanmedian_fil
+00046df0: 7465 7228 6461 7461 2c20 6669 6c74 6572  ter(data, filter
+00046e00: 5f6b 7761 7267 733d 7b7d 2c20 6669 6c74  _kwargs={}, filt
+00046e10: 6572 5f66 6f6f 7470 7269 6e74 3d4e 6f6e  er_footprint=Non
+00046e20: 652c 2061 7869 733d 312c 2063 6c65 616e  e, axis=1, clean
+00046e30: 3d54 7275 652c 2063 7661 6c3d 302e 3029  =True, cval=0.0)
+00046e40: 3a0a 2020 2020 2222 220a 2020 2020 5275  :.    """.    Ru
+00046e50: 6e20 6e61 6e6d 6564 6961 6e20 6669 6c74  n nanmedian filt
+00046e60: 6572 206f 6e20 6064 6174 6160 0a20 2020  er on `data`.   
+00046e70: 200a 2020 2020 5061 7261 6d65 7465 7273   .    Parameters
+00046e80: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00046e90: 2020 2020 6461 7461 203a 2061 7272 6179      data : array
+00046ea0: 2d6c 696b 650a 2020 2020 2020 2020 5468  -like.        Th
+00046eb0: 6520 3244 2064 6174 6120 746f 2066 696c  e 2D data to fil
+00046ec0: 7465 720a 2020 2020 0a20 2020 2066 696c  ter.    .    fil
+00046ed0: 7465 725f 6b77 6172 6773 203a 2064 6963  ter_kwargs : dic
+00046ee0: 740a 2020 2020 2020 2020 4172 6775 6d65  t.        Argume
+00046ef0: 6e74 7320 746f 2060 7e67 7269 7a6c 692e  nts to `~grizli.
+00046f00: 7574 696c 732e 6d61 6b65 5f66 696c 7465  utils.make_filte
+00046f10: 725f 666f 6f74 7072 696e 7460 2074 6f20  r_footprint` to 
+00046f20: 6d61 6b65 2061 2031 4420 6669 6c74 6572  make a 1D filter
+00046f30: 0a20 2020 200a 2020 2020 6669 6c74 6572  .    .    filter
+00046f40: 5f66 6f6f 7470 7269 6e74 203a 2061 7272  _footprint : arr
+00046f50: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
+00046f60: 5370 6563 6966 7920 7468 6520 6669 6c74  Specify the filt
+00046f70: 6572 2065 7870 6c69 6369 746c 792e 2020  er explicitly.  
+00046f80: 4966 2031 442c 2074 6865 6e20 7769 6c6c  If 1D, then will
+00046f90: 2061 7070 6c79 2074 6865 2066 696c 7465   apply the filte
+00046fa0: 7220 6f76 6572 0a20 2020 2020 2020 2060  r over.        `
+00046fb0: 6178 6973 3d31 6020 2869 2e65 2e2c 2060  axis=1` (i.e., `
+00046fc0: 7860 2920 6f66 2060 6064 6174 6160 600a  x`) of ``data``.
+00046fd0: 2020 2020 0a20 2020 2061 7869 7320 3a20      .    axis : 
+00046fe0: 3020 6f72 2031 0a20 2020 2020 2020 2020  0 or 1.         
+00046ff0: 4178 6973 206f 7665 7220 7768 6963 6820  Axis over which 
+00047000: 746f 2061 7070 6c79 2074 6865 2066 696c  to apply the fil
+00047010: 7465 7220 2860 6061 7869 733d 3160 6020  ter (``axis=1`` 
+00047020: 6669 6c74 6572 7320 6f6e 2072 6f77 7329  filters on rows)
+00047030: 0a20 2020 200a 2020 2020 636c 6561 6e2c  .    .    clean,
+00047040: 2063 7661 6c20 3a20 626f 6f6c 2c20 7363   cval : bool, sc
+00047050: 616c 6172 0a20 2020 2020 2020 2052 6570  alar.        Rep
+00047060: 6c61 6365 2060 7e6e 756d 7079 2e6e 616e  lace `~numpy.nan
+00047070: 6020 696e 2074 6865 206f 7574 7075 7420  ` in the output 
+00047080: 7769 7468 2060 6063 7661 6c60 600a 2020  with ``cval``.  
+00047090: 2020 0a20 2020 2052 6574 7572 6e73 0a20    .    Returns. 
+000470a0: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2066     -------.    f
+000470b0: 696c 7465 725f 6461 7461 203a 2061 7272  ilter_data : arr
+000470c0: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
+000470d0: 4669 6c74 6572 6564 2064 6174 610a 2020  Filtered data.  
+000470e0: 2020 0a20 2020 2066 696c 7465 725f 6e61    .    filter_na
+000470f0: 6d65 203a 2073 7472 0a20 2020 2020 2020  me : str.       
+00047100: 2054 6865 2074 7970 6520 6f66 2066 696c   The type of fil
+00047110: 7465 7220 7468 6174 2077 6173 2061 7070  ter that was app
+00047120: 6c69 6564 3a20 606e 6275 7469 6c73 2e6e  lied: `nbutils.n
+00047130: 616e 6d65 6469 616e 6020 6966 200a 2020  anmedian` if .  
+00047140: 2020 2020 2020 607e 6772 697a 6c69 2e6e        `~grizli.n
+00047150: 6275 7469 6c73 2e6e 616e 6d65 6469 616e  butils.nanmedian
+00047160: 6020 7761 7320 696d 706f 7274 6564 2073  ` was imported s
+00047170: 7563 6365 7373 6675 6c6c 7920 616e 6420  uccessfully and 
+00047180: 0a20 2020 2020 2020 2060 6d65 6469 616e  .        `median
+00047190: 5f66 696c 7465 7260 2066 6f72 2074 6865  _filter` for the
+000471a0: 2066 616c 6c62 6163 6b20 746f 2060 7363   fallback to `sc
+000471b0: 6970 2e6e 6469 6d61 6765 2e6d 6564 6961  ip.ndimage.media
+000471c0: 6e5f 6669 6c74 6572 6020 0a20 2020 2020  n_filter` .     
+000471d0: 2020 206f 7468 6572 7769 7365 2e0a 2020     otherwise..  
+000471e0: 2020 2222 220a 2020 2020 696d 706f 7274    """.    import
+000471f0: 2073 6369 7079 2e6e 6469 6d61 6765 2061   scipy.ndimage a
+00047200: 7320 6e64 0a20 2020 200a 2020 2020 7472  s nd.    .    tr
+00047210: 793a 0a20 2020 2020 2020 2066 726f 6d20  y:.        from 
+00047220: 2e20 696d 706f 7274 206e 6275 7469 6c73  . import nbutils
+00047230: 0a20 2020 2020 2020 205f 6669 6c74 6572  .        _filter
+00047240: 5f6e 616d 6520 3d20 276e 6275 7469 6c73  _name = 'nbutils
+00047250: 2e6e 616e 6d65 6469 616e 270a 2020 2020  .nanmedian'.    
+00047260: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00047270: 6e62 7574 696c 7320 3d20 4e6f 6e65 0a20  nbutils = None. 
+00047280: 2020 2020 2020 205f 6669 6c74 6572 5f6e         _filter_n
+00047290: 616d 6520 3d20 276d 6564 6961 6e5f 6669  ame = 'median_fi
+000472a0: 6c74 6572 270a 2020 2020 0a20 2020 2069  lter'.    .    i
+000472b0: 6620 6669 6c74 6572 5f66 6f6f 7470 7269  f filter_footpri
+000472c0: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
+000472d0: 2020 2020 5f66 696c 7465 725f 666f 6f74      _filter_foot
+000472e0: 7072 696e 7420 3d20 6d61 6b65 5f66 696c  print = make_fil
+000472f0: 7465 725f 666f 6f74 7072 696e 7428 2a2a  ter_footprint(**
+00047300: 6669 6c74 6572 5f6b 7761 7267 7329 0a20  filter_kwargs). 
+00047310: 2020 2020 2020 2069 6620 6178 6973 203d         if axis =
+00047320: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00047330: 205f 6669 6c74 6572 5f66 6f6f 7470 7269   _filter_footpri
+00047340: 6e74 203d 205f 6669 6c74 6572 5f66 6f6f  nt = _filter_foo
+00047350: 7470 7269 6e74 5b4e 6f6e 652c 3a5d 0a20  tprint[None,:]. 
+00047360: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00047370: 2020 2020 2020 2020 205f 6669 6c74 6572           _filter
+00047380: 5f66 6f6f 7470 7269 6e74 203d 205f 6669  _footprint = _fi
+00047390: 6c74 6572 5f66 6f6f 7470 7269 6e74 5b3a  lter_footprint[:
+000473a0: 2c4e 6f6e 655d 0a20 2020 2065 6c73 653a  ,None].    else:
+000473b0: 0a20 2020 2020 2020 2069 6620 6669 6c74  .        if filt
+000473c0: 6572 5f66 6f6f 7470 7269 6e74 2e6e 6469  er_footprint.ndi
+000473d0: 6d20 3d3d 2031 3a0a 2020 2020 2020 2020  m == 1:.        
+000473e0: 2020 2020 6966 2061 7869 7320 3d3d 2031      if axis == 1
+000473f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00047400: 2020 5f66 696c 7465 725f 666f 6f74 7072    _filter_footpr
+00047410: 696e 7420 3d20 6669 6c74 6572 5f66 6f6f  int = filter_foo
+00047420: 7470 7269 6e74 5b4e 6f6e 652c 3a5d 0a20  tprint[None,:]. 
+00047430: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00047440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047450: 205f 6669 6c74 6572 5f66 6f6f 7470 7269   _filter_footpri
+00047460: 6e74 203d 2066 696c 7465 725f 666f 6f74  nt = filter_foot
+00047470: 7072 696e 745b 3a2c 4e6f 6e65 5d0a 2020  print[:,None].  
+00047480: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00047490: 2020 2020 2020 2020 5f66 696c 7465 725f          _filter_
+000474a0: 666f 6f74 7072 696e 7420 3d20 6669 6c74  footprint = filt
+000474b0: 6572 5f66 6f6f 7470 7269 6e74 0a20 2020  er_footprint.   
+000474c0: 200a 2020 2020 6966 206e 6275 7469 6c73   .    if nbutils
+000474d0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000474e0: 2020 6669 6c74 6572 5f64 6174 6120 3d20    filter_data = 
+000474f0: 6e64 2e6d 6564 6961 6e5f 6669 6c74 6572  nd.median_filter
+00047500: 2864 6174 612c 2066 6f6f 7470 7269 6e74  (data, footprint
+00047510: 3d5f 6669 6c74 6572 5f66 6f6f 7470 7269  =_filter_footpri
+00047520: 6e74 290a 2020 2020 656c 7365 3a0a 2020  nt).    else:.  
+00047530: 2020 2020 2020 6669 6c74 6572 5f64 6174        filter_dat
+00047540: 6120 3d20 6e64 2e67 656e 6572 6963 5f66  a = nd.generic_f
+00047550: 696c 7465 7228 6461 7461 2c20 6e62 7574  ilter(data, nbut
+00047560: 696c 732e 6e61 6e6d 6564 6961 6e2c 0a20  ils.nanmedian,. 
+00047570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047590: 2020 2020 2020 2066 6f6f 7470 7269 6e74         footprint
+000475a0: 3d5f 6669 6c74 6572 5f66 6f6f 7470 7269  =_filter_footpri
+000475b0: 6e74 290a 2020 2020 2020 2020 6966 2063  nt).        if c
+000475c0: 6c65 616e 3a0a 2020 2020 2020 2020 2020  lean:.          
+000475d0: 2020 6669 6c74 6572 5f64 6174 615b 7e6e    filter_data[~n
+000475e0: 702e 6973 6669 6e69 7465 2866 696c 7465  p.isfinite(filte
+000475f0: 725f 6461 7461 295d 203d 2063 7661 6c0a  r_data)] = cval.
+00047600: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00047610: 2072 6574 7572 6e20 6669 6c74 6572 5f64   return filter_d
+00047620: 6174 612c 205f 6669 6c74 6572 5f6e 616d  ata, _filter_nam
+00047630: 650a 0a0a 6465 6620 6172 6776 5f74 6f5f  e...def argv_to_
+00047640: 6469 6374 2861 7267 762c 2064 6566 6175  dict(argv, defau
+00047650: 6c74 733d 7b7d 2c20 646f 745f 6469 6374  lts={}, dot_dict
+00047660: 3d54 7275 6529 3a0a 2020 2020 2222 220a  =True):.    """.
+00047670: 2020 2020 436f 6e76 6572 7420 6120 6c69      Convert a li
+00047680: 7374 206f 6620 2873 696d 706c 6529 2063  st of (simple) c
+00047690: 6f6d 6d61 6e64 2d6c 696e 6520 6172 6775  ommand-line argu
+000476a0: 6d65 6e74 7320 746f 2061 2064 6963 7469  ments to a dicti
+000476b0: 6f6e 6172 792e 0a20 2020 200a 2020 2020  onary..    .    
+000476c0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+000476d0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6172  ---------.    ar
+000476e0: 6776 203a 206c 6973 7420 6f66 2073 7472  gv : list of str
+000476f0: 696e 6773 0a20 2020 2020 2020 2045 2e67  ings.        E.g
+00047700: 2e2c 2060 6073 7973 2e61 7267 765b 313a  ., ``sys.argv[1:
+00047710: 5d60 602e 0a20 2020 200a 2020 2020 6465  ]``..    .    de
+00047720: 6661 756c 7473 203a 2064 6963 740a 2020  faults : dict.  
+00047730: 2020 2020 2020 4465 6661 756c 7420 6469        Default di
+00047740: 6374 696f 6e61 7279 0a20 2020 200a 2020  ctionary.    .  
+00047750: 2020 646f 745f 6469 6374 203a 2062 6f6f    dot_dict : boo
+00047760: 6c0a 2020 2020 2020 2020 4966 2074 7275  l.        If tru
+00047770: 652c 2074 6865 6e20 696e 7465 7072 6574  e, then intepret
+00047780: 206b 6579 776f 7264 7320 7769 7468 2027   keywords with '
+00047790: 2e27 2061 7320 6e65 7374 6564 2064 6963  .' as nested dic
+000477a0: 7469 6f6e 6172 7920 6b65 7973 2c20 0a20  tionary keys, . 
+000477b0: 2020 2020 2020 2065 2e67 2e2c 2060 602d         e.g., ``-
+000477c0: 2d64 2e6b 6579 3d76 616c 6060 203e 3e20  -d.key=val`` >> 
+000477d0: 7b27 6427 3a20 7b27 6b65 7927 3a20 2776  {'d': {'key': 'v
+000477e0: 616c 277d 7d0a 2020 2020 2020 2020 0a20  al'}}.        . 
+000477f0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+00047800: 2d2d 2d2d 2d2d 2d2d 0a20 2020 200a 2020  --------.    .  
+00047810: 2020 2020 2020 2320 2420 6d79 6675 6e63        # $ myfunc
+00047820: 2061 7267 3120 2d2d 7031 3d31 202d 2d6c   arg1 --p1=1 --l
+00047830: 313d 312c 322c 3320 2d2d 7064 6963 742e  1=1,2,3 --pdict.
+00047840: 6b31 3d31 202d 666c 6167 0a20 2020 2020  k1=1 -flag.     
+00047850: 2020 203e 3e3e 2061 7267 7620 3d20 2761     >>> argv = 'a
+00047860: 7267 3120 2d2d 7031 3d31 202d 2d6c 313d  rg1 --p1=1 --l1=
+00047870: 312c 322c 3320 2d2d 7064 6963 742e 6b31  1,2,3 --pdict.k1
+00047880: 3d31 202d 666c 6167 272e 7370 6c69 7428  =1 -flag'.split(
+00047890: 290a 2020 2020 2020 2020 3e3e 3e20 6172  ).        >>> ar
+000478a0: 6773 2c20 6b77 6172 6773 203d 2061 7267  gs, kwargs = arg
+000478b0: 765f 746f 5f64 6963 7428 6172 6776 290a  v_to_dict(argv).
+000478c0: 2020 2020 2020 2020 3e3e 3e20 7072 696e          >>> prin
+000478d0: 7428 6172 6773 290a 2020 2020 2020 2020  t(args).        
+000478e0: 5b27 6172 6731 275d 0a20 2020 2020 2020  ['arg1'].       
+000478f0: 203e 3e3e 2070 7269 6e74 286b 7761 7267   >>> print(kwarg
+00047900: 7329 0a20 2020 2020 2020 207b 2770 3127  s).        {'p1'
+00047910: 3a20 312c 2027 6c31 273a 205b 312c 2032  : 1, 'l1': [1, 2
+00047920: 2c20 335d 2c20 2770 6469 6374 273a 207b  , 3], 'pdict': {
+00047930: 276b 3127 3a20 317d 2c20 2766 6c61 6727  'k1': 1}, 'flag'
+00047940: 3a20 5472 7565 7d0a 2020 2020 2020 2020  : True}.        
+00047950: 0a20 2020 2020 2020 2023 2057 6974 6820  .        # With 
+00047960: 6465 6661 756c 7473 0a20 2020 2020 2020  defaults.       
+00047970: 2064 6566 6175 6c74 7320 3d20 7b27 7064   defaults = {'pd
+00047980: 6963 7427 3a7b 276b 3227 3a32 2e30 7d2c  ict':{'k2':2.0},
+00047990: 2027 7032 273a 322e 307d 0a20 2020 2020   'p2':2.0}.     
+000479a0: 2020 203e 3e3e 2061 7267 732c 206b 7761     >>> args, kwa
+000479b0: 7267 7320 3d20 6172 6776 5f74 6f5f 6469  rgs = argv_to_di
+000479c0: 6374 2861 7267 762c 2064 6566 6175 6c74  ct(argv, default
+000479d0: 733d 6465 6661 756c 7473 290a 2020 2020  s=defaults).    
+000479e0: 2020 2020 3e3e 3e20 7072 696e 7428 6b77      >>> print(kw
+000479f0: 6172 6773 290a 2020 2020 2020 2020 7b27  args).        {'
+00047a00: 7064 6963 7427 3a20 7b27 6b32 273a 2032  pdict': {'k2': 2
+00047a10: 2e30 2c20 276b 3127 3a20 317d 2c20 2770  .0, 'k1': 1}, 'p
+00047a20: 3227 3a20 322e 302c 2027 7031 273a 2031  2': 2.0, 'p1': 1
+00047a30: 2c20 276c 3127 3a20 5b31 2c20 322c 2033  , 'l1': [1, 2, 3
+00047a40: 5d2c 2027 666c 6167 273a 2054 7275 657d  ], 'flag': True}
+00047a50: 0a20 2020 2020 2020 200a 2020 2020 2222  .        .    ""
+00047a60: 220a 2020 2020 696d 706f 7274 2063 6f70  ".    import cop
+00047a70: 790a 2020 2020 696d 706f 7274 206a 736f  y.    import jso
+00047a80: 6e0a 2020 2020 0a20 2020 206b 7761 7267  n.    .    kwarg
+00047a90: 7320 3d20 636f 7079 2e64 6565 7063 6f70  s = copy.deepcop
+00047aa0: 7928 6465 6661 756c 7473 290a 2020 2020  y(defaults).    
+00047ab0: 6172 6773 203d 205b 5d0a 2020 2020 0a20  args = [].    . 
+00047ac0: 2020 2066 6f72 2069 2c20 6172 6720 696e     for i, arg in
+00047ad0: 2065 6e75 6d65 7261 7465 2861 7267 7629   enumerate(argv)
+00047ae0: 3a20 2020 2020 2020 200a 2020 2020 2020  :        .      
+00047af0: 2020 6966 206e 6f74 2061 7267 2e73 7461    if not arg.sta
+00047b00: 7274 7377 6974 6828 272d 2729 3a0a 2020  rtswith('-'):.  
+00047b10: 2020 2020 2020 2020 2020 2320 4172 6775            # Argu
+00047b20: 6d65 6e74 730a 2020 2020 2020 2020 2020  ments.          
+00047b30: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00047b40: 2020 2020 2020 2061 7267 732e 6170 7065         args.appe
+00047b50: 6e64 286a 736f 6e2e 6c6f 6164 7328 6172  nd(json.loads(ar
+00047b60: 6729 290a 2020 2020 2020 2020 2020 2020  g)).            
+00047b70: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00047b80: 2020 2020 2020 2020 6172 6773 2e61 7070          args.app
+00047b90: 656e 6428 6a73 6f6e 2e6c 6f61 6473 2866  end(json.loads(f
+00047ba0: 2722 7b61 7267 7d22 2729 290a 2020 2020  '"{arg}"')).    
+00047bb0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00047bc0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00047bd0: 650a 2020 2020 2020 2020 2020 2020 0a20  e.            . 
+00047be0: 2020 2020 2020 2073 706c 203d 2061 7267         spl = arg
+00047bf0: 2e73 7472 6970 2827 2d2d 2729 2e73 706c  .strip('--').spl
+00047c00: 6974 2827 3d27 290a 2020 2020 2020 2020  it('=').        
+00047c10: 6966 206c 656e 2873 706c 2920 3e20 313a  if len(spl) > 1:
+00047c20: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
+00047c30: 6172 616d 6574 6572 2076 616c 7565 730a  arameter values.
+00047c40: 2020 2020 2020 2020 2020 2020 6b65 792c              key,
+00047c50: 2076 616c 203d 2073 706c 0a20 2020 2020   val = spl.     
+00047c60: 2020 2020 2020 2076 616c 203d 2076 616c         val = val
+00047c70: 2e72 6570 6c61 6365 2827 5472 7565 272c  .replace('True',
+00047c80: 2774 7275 6527 292e 7265 706c 6163 6528  'true').replace(
+00047c90: 2746 616c 7365 272c 2766 616c 7365 2729  'False','false')
+00047ca0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00047cb0: 203d 2076 616c 2e72 6570 6c61 6365 2827   = val.replace('
+00047cc0: 4e6f 6e65 272c 276e 756c 6c27 290a 2020  None','null').  
+00047cd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00047ce0: 2020 2020 2020 2020 2320 5061 7261 6d65          # Parame
+00047cf0: 7465 7273 2c20 7365 7420 746f 2074 7275  ters, set to tru
+00047d00: 652c 2065 2e67 2e2c 202d 7365 745f 666c  e, e.g., -set_fl
+00047d10: 6167 0a20 2020 2020 2020 2020 2020 206b  ag.            k
+00047d20: 6579 2c20 7661 6c20 3d20 7370 6c5b 305d  ey, val = spl[0]
+00047d30: 2c20 2774 7275 6527 0a20 2020 2020 2020  , 'true'.       
+00047d40: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00047d50: 2020 2320 7369 6e67 6c65 202d 0a20 2020    # single -.   
+00047d60: 2020 2020 2020 2020 2069 6620 6b65 792e           if key.
+00047d70: 7374 6172 7473 7769 7468 2827 2d27 293a  startswith('-'):
+00047d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047d90: 206b 6579 203d 206b 6579 5b31 3a5d 0a20   key = key[1:]. 
+00047da0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00047db0: 2320 4c69 7374 2076 616c 7565 7320 2020  # List values   
+00047dc0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
+00047dd0: 2027 2c27 2069 6e20 7661 6c3a 0a20 2020   ',' in val:.   
+00047de0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00047df0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00047e00: 5472 7920 7061 7273 696e 6720 7769 7468  Try parsing with
+00047e10: 204a 534f 4e0a 2020 2020 2020 2020 2020   JSON.          
+00047e20: 2020 2020 2020 6a76 616c 203d 206a 736f        jval = jso
+00047e30: 6e2e 6c6f 6164 7328 6627 5b7b 7661 6c7d  n.loads(f'[{val}
+00047e40: 5d27 290a 2020 2020 2020 2020 2020 2020  ]').            
+00047e50: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00047e60: 2020 2020 2020 2020 2320 4173 7375 6d65          # Assume
+00047e70: 2073 7472 696e 6773 0a20 2020 2020 2020   strings.       
+00047e80: 2020 2020 2020 2020 2073 7472 5f76 616c           str_val
+00047e90: 203d 2027 2c27 2e6a 6f69 6e28 5b66 2722   = ','.join([f'"
+00047ea0: 7b76 7d22 2720 666f 7220 7620 696e 2076  {v}"' for v in v
+00047eb0: 616c 2e73 706c 6974 2827 2c27 295d 290a  al.split(',')]).
+00047ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047ed0: 6a76 616c 203d 206a 736f 6e2e 6c6f 6164  jval = json.load
+00047ee0: 7328 6627 5b7b 7374 725f 7661 6c7d 5d27  s(f'[{str_val}]'
+00047ef0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00047f00: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00047f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047f20: 206a 7661 6c20 3d20 6a73 6f6e 2e6c 6f61   jval = json.loa
+00047f30: 6473 2876 616c 290a 2020 2020 2020 2020  ds(val).        
+00047f40: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+00047f50: 2020 2020 2020 2020 2020 2020 2320 5374              # St
+00047f60: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
+00047f70: 2020 2020 206a 7661 6c20 3d20 7661 6c0a       jval = val.
+00047f80: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00047f90: 2023 2044 6963 7420 6b65 7973 2c20 706f   # Dict keys, po
+00047fa0: 7465 6e74 6961 6c6c 7920 6e65 7374 6564  tentially nested
+00047fb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00047fc0: 2069 6620 646f 745f 6469 6374 2026 2028   if dot_dict & (
+00047fd0: 272e 2720 696e 206b 6579 293a 0a20 2020  '.' in key):.   
+00047fe0: 2020 2020 2020 2020 206b 6579 7320 3d20           keys = 
+00047ff0: 6b65 792e 7370 6c69 7428 272e 2729 0a20  key.split('.'). 
+00048000: 2020 2020 2020 2020 2020 2064 203d 206b             d = k
+00048010: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
+00048020: 2020 666f 7220 6b20 696e 206b 6579 735b    for k in keys[
+00048030: 3a2d 315d 3a0a 2020 2020 2020 2020 2020  :-1]:.          
+00048040: 2020 2020 2020 6966 206b 206e 6f74 2069        if k not i
+00048050: 6e20 643a 0a20 2020 2020 2020 2020 2020  n d:.           
+00048060: 2020 2020 2020 2020 2064 5b6b 5d20 3d20           d[k] = 
+00048070: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
+00048080: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00048090: 2020 2020 6420 3d20 645b 6b5d 0a20 2020      d = d[k].   
+000480a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000480b0: 200a 2020 2020 2020 2020 2020 2020 645b   .            d[
+000480c0: 6b65 7973 5b2d 315d 5d20 3d20 6a76 616c  keys[-1]] = jval
+000480d0: 0a20 2020 2020 2020 2065 6c73 653a 2020  .        else:  
+000480e0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000480f0: 2020 2020 2020 206b 7761 7267 735b 6b65         kwargs[ke
+00048100: 795d 203d 206a 7661 6c0a 2020 2020 2020  y] = jval.      
+00048110: 2020 2020 2020 0a20 2020 200a 2020 2020        .    .    
+00048120: 7265 7475 726e 2061 7267 732c 206b 7761  return args, kwa
+00048130: 7267 730a 0a0a 636c 6173 7320 556e 6971  rgs...class Uniq
+00048140: 7565 286f 626a 6563 7429 3a0a 2020 2020  ue(object):.    
+00048150: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00048160: 662c 2061 7272 6179 2c20 7665 7262 6f73  f, array, verbos
+00048170: 653d 5472 7565 293a 0a20 2020 2020 2020  e=True):.       
+00048180: 2022 2222 0a20 2020 2020 2020 2048 656c   """.        Hel
+00048190: 7065 7220 666f 7220 756e 6971 7565 2069  per for unique i
+000481a0: 7465 6d73 2069 6e20 616e 2061 7272 6179  tems in an array
+000481b0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+000481c0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+000481d0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+000481e0: 2020 2020 2020 2020 6172 7261 7920 3a20          array : 
+000481f0: 6172 7261 792d 6c69 6b65 0a20 2020 2020  array-like.     
+00048200: 2020 2020 2020 2044 6174 6120 746f 2070         Data to p
+00048210: 6172 7365 2c20 6765 6e65 7261 6c6c 7920  arse, generally 
+00048220: 7374 7269 6e67 7320 6275 7420 6361 6e20  strings but can 
+00048230: 6265 2061 6e79 7468 696e 6720 7468 6174  be anything that
+00048240: 2063 616e 200a 2020 2020 2020 2020 2020   can .          
+00048250: 2020 6265 2070 6172 7365 6420 6279 2060    be parsed by `
+00048260: 6e75 6d70 792e 756e 6971 7565 600a 0a0a  numpy.unique`...
+00048270: 2020 2020 2020 2020 4174 7472 6962 7574          Attribut
+00048280: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+00048290: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6469  -----.        di
+000482a0: 6d20 3a20 696e 740a 2020 2020 2020 2020  m : int.        
+000482b0: 2020 2020 6060 7369 7a65 6060 206f 6620      ``size`` of 
+000482c0: 696e 7075 7420 6060 6172 7261 7960 600a  input ``array``.
+000482d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000482e0: 2076 616c 7565 7320 3a20 6c69 7374 0a20   values : list. 
+000482f0: 2020 2020 2020 2020 2020 2055 6e69 7175             Uniqu
+00048300: 6520 656c 656d 656e 7473 206f 6620 6060  e elements of ``
+00048310: 6172 7261 7960 600a 2020 2020 2020 2020  array``.        
+00048320: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
+00048330: 203a 206c 6973 740a 2020 2020 2020 2020   : list.        
+00048340: 2020 2020 496e 7465 6765 7220 6c69 7374      Integer list
+00048350: 206c 656e 6774 6820 6f66 2060 6061 7272   length of ``arr
+00048360: 6179 6060 2077 6974 6820 7468 6520 696e  ay`` with the in
+00048370: 6469 6365 7320 6f66 2060 6076 616c 7565  dices of ``value
+00048380: 7360 600a 2020 2020 2020 2020 2020 2020  s``.            
+00048390: 666f 7220 6561 6368 2065 6c65 6d65 6e74  for each element
+000483a0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+000483b0: 2020 636f 756e 7473 203a 206c 6973 740a    counts : list.
+000483c0: 2020 2020 2020 2020 2020 2020 436f 756e              Coun
+000483d0: 7473 206f 6620 6561 6368 2065 6c65 6d65  ts of each eleme
+000483e0: 6e74 206f 6620 6060 7661 6c75 6573 6060  nt of ``values``
+000483f0: 0a20 2020 2020 2020 200a 0a20 2020 2020  .        ..     
+00048400: 2020 204d 6574 686f 6473 0a20 2020 2020     Methods.     
+00048410: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+00048420: 2020 205f 5f67 6574 5f5f 286b 6579 290a     __get__(key).
+00048430: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
+00048440: 726e 2061 2060 626f 6f6c 6020 6172 7261  rn a `bool` arra
+00048450: 7920 7768 6572 6520 656e 7472 6965 7320  y where entries 
+00048460: 6f66 2060 6061 7272 6179 6060 206d 6174  of ``array`` mat
+00048470: 6368 2074 6865 200a 2020 2020 2020 2020  ch the .        
+00048480: 2020 2020 7370 6563 6966 6965 6420 6060      specified ``
+00048490: 6b65 7960 600a 2020 2020 2020 2020 0a20  key``.        . 
+000484a0: 2020 2020 2020 205f 5f69 7465 725f 5f0a         __iter__.
+000484b0: 2020 2020 2020 2020 2020 2020 4974 6572              Iter
+000484c0: 6174 6f72 206f 7665 7220 6060 7661 6c75  ator over ``valu
+000484d0: 6573 6060 0a20 2020 2020 2020 200a 2020  es``.        .  
+000484e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000484f0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00048500: 6172 7261 792c 206c 6973 7429 3a0a 2020  array, list):.  
+00048510: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00048520: 7272 6179 203d 206e 702e 6172 7261 7928  rray = np.array(
+00048530: 6172 7261 7929 0a20 2020 2020 2020 2065  array).        e
+00048540: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00048550: 2073 656c 662e 6172 7261 7920 3d20 6172   self.array = ar
+00048560: 7261 790a 2020 2020 2020 2020 0a20 2020  ray.        .   
+00048570: 2020 2020 205f 203d 206e 702e 756e 6971       _ = np.uniq
+00048580: 7565 2873 656c 662e 6172 7261 792c 2072  ue(self.array, r
+00048590: 6574 7572 6e5f 636f 756e 7473 3d54 7275  eturn_counts=Tru
+000485a0: 652c 2072 6574 7572 6e5f 696e 7665 7273  e, return_invers
+000485b0: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
+000485c0: 7365 6c66 2e64 696d 203d 2073 656c 662e  self.dim = self.
+000485d0: 6172 7261 792e 7369 7a65 0a20 2020 2020  array.size.     
+000485e0: 2020 2073 656c 662e 7a65 726f 7320 3d20     self.zeros = 
+000485f0: 6e70 2e7a 6572 6f73 2873 656c 662e 6172  np.zeros(self.ar
+00048600: 7261 792e 7368 6170 652c 2064 7479 7065  ray.shape, dtype
+00048610: 3d62 6f6f 6c29 0a20 2020 2020 2020 200a  =bool).        .
+00048620: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
+00048630: 7565 7320 3d20 5b6c 2066 6f72 206c 2069  ues = [l for l i
+00048640: 6e20 5f5b 305d 5d0a 2020 2020 2020 2020  n _[0]].        
+00048650: 7365 6c66 2e69 6e64 6963 6573 203d 205f  self.indices = _
+00048660: 5b31 5d0a 2020 2020 2020 2020 7365 6c66  [1].        self
+00048670: 2e63 6f75 6e74 7320 3d20 5f5b 325d 0a20  .counts = _[2]. 
+00048680: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
+00048690: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000486a0: 656c 662e 696e 666f 2873 6f72 745f 636f  elf.info(sort_co
+000486b0: 756e 7473 3d76 6572 626f 7365 290a 2020  unts=verbose).  
+000486c0: 2020 0a20 2020 200a 2020 2020 4070 726f    .    .    @pro
+000486d0: 7065 7274 790a 2020 2020 6465 6620 4e28  perty.    def N(
+000486e0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+000486f0: 2222 0a20 2020 2020 2020 204e 756d 6265  "".        Numbe
+00048700: 7220 6f66 2075 6e69 7175 6520 6060 7661  r of unique ``va
+00048710: 6c75 6573 6060 0a20 2020 2020 2020 2022  lues``.        "
+00048720: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00048730: 6e20 6c65 6e28 7365 6c66 2e76 616c 7565  n len(self.value
+00048740: 7329 0a0a 0a20 2020 2064 6566 2069 6e66  s)...    def inf
+00048750: 6f28 7365 6c66 2c20 736f 7274 5f63 6f75  o(self, sort_cou
+00048760: 6e74 733d 2d31 293a 0a20 2020 2020 2020  nts=-1):.       
+00048770: 2022 2222 0a20 2020 2020 2020 2050 7269   """.        Pri
+00048780: 6e74 2061 2073 756d 6d61 7279 0a20 2020  nt a summary.   
+00048790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000487a0: 2070 7269 6e74 2866 277b 224e 223a 3e34   print(f'{"N":>4
+000487b0: 7d20 207b 2276 616c 7565 223a 3130 7d27  }  {"value":10}'
+000487c0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+000487d0: 273d 3d3d 3d20 203d 3d3d 3d3d 3d3d 3d3d  '====  =========
+000487e0: 3d27 290a 2020 2020 2020 2020 6966 2073  =').        if s
+000487f0: 6f72 745f 636f 756e 7473 3a0a 2020 2020  ort_counts:.    
+00048800: 2020 2020 2020 2020 736f 203d 206e 702e          so = np.
+00048810: 6172 6773 6f72 7428 7365 6c66 2e63 6f75  argsort(self.cou
+00048820: 6e74 7329 5b3a 3a69 6e74 2873 6f72 745f  nts)[::int(sort_
+00048830: 636f 756e 7473 295d 0a20 2020 2020 2020  counts)].       
+00048840: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00048850: 2020 2073 6f20 3d20 6e70 2e61 7261 6e67     so = np.arang
+00048860: 6528 7365 6c66 2e4e 290a 2020 2020 2020  e(self.N).      
+00048870: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
+00048880: 6f72 2069 2069 6e20 736f 3a0a 2020 2020  or i in so:.    
+00048890: 2020 2020 2020 2020 762c 2063 203d 2073          v, c = s
+000488a0: 656c 662e 7661 6c75 6573 5b69 5d2c 2073  elf.values[i], s
+000488b0: 656c 662e 636f 756e 7473 5b69 5d0a 2020  elf.counts[i].  
+000488c0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000488d0: 6627 7b63 3a3e 347d 2020 7b76 3a31 307d  f'{c:>4}  {v:10}
+000488e0: 2729 0a0a 0a20 2020 2064 6566 2063 6f75  ')...    def cou
+000488f0: 6e74 2873 656c 662c 206b 6579 293a 0a20  nt(self, key):. 
+00048900: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00048910: 2020 2047 6574 206f 6363 7572 7265 6e63     Get occurrenc
+00048920: 6573 2063 6f75 6e74 206f 6620 6120 7061  es count of a pa
+00048930: 7274 6963 756c 6172 2060 6076 616c 7565  rticular ``value
+00048940: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
+00048950: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+00048960: 2073 656c 662e 7661 6c75 6573 3a0a 2020   self.values:.  
+00048970: 2020 2020 2020 2020 2020 6978 203d 2073            ix = s
+00048980: 656c 662e 7661 6c75 6573 2e69 6e64 6578  elf.values.index
+00048990: 286b 6579 290a 2020 2020 2020 2020 2020  (key).          
+000489a0: 2020 7265 7475 726e 2073 656c 662e 636f    return self.co
+000489b0: 756e 7473 5b69 785d 0a20 2020 2020 2020  unts[ix].       
+000489c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000489d0: 2020 2072 6574 7572 6e20 300a 2020 2020     return 0.    
+000489e0: 0a20 2020 200a 2020 2020 4070 726f 7065  .    .    @prope
+000489f0: 7274 790a 2020 2020 6465 6620 6c69 7374  rty.    def list
+00048a00: 5f69 6e64 6963 6573 2873 656c 6629 3a0a  _indices(self):.
 00048a10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00048a20: 2020 2020 696d 706f 7274 2061 7374 726f      import astro
-00048a30: 7079 2e74 696d 650a 2020 2020 2020 2020  py.time.        
-00048a40: 7430 203d 2061 7374 726f 7079 2e74 696d  t0 = astropy.tim
-00048a50: 652e 5469 6d65 2827 3139 3835 2d30 312d  e.Time('1985-01-
-00048a60: 3031 5430 303a 3030 3a30 305a 2729 0a20  01T00:00:00Z'). 
-00048a70: 2020 2020 2020 2072 6574 7572 6e20 7430         return t0
-00048a80: 0a0a 0a20 2020 2064 6566 205f 5f63 616c  ...    def __cal
-00048a90: 6c5f 5f28 7365 6c66 2c20 745f 696e 2c20  l__(self, t_in, 
-00048aa0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-00048ab0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-00048ac0: 6f6e 7665 7274 2069 6e70 7574 2074 696d  onvert input tim
-00048ad0: 6520 6060 745f 696e 6060 2074 6f20 7365  e ``t_in`` to se
-00048ae0: 636f 6e64 7320 7369 6e63 6520 312f 312f  conds since 1/1/
-00048af0: 3835 2061 6e64 2060 6065 7661 6c75 6174  85 and ``evaluat
-00048b00: 6560 602e 0a20 2020 2020 2020 2022 2222  e``..        """
-00048b10: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-00048b20: 6173 7472 6f70 792e 7469 6d65 0a20 2020  astropy.time.   
-00048b30: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00048b40: 7374 616e 6365 2874 5f69 6e2c 2061 7374  stance(t_in, ast
-00048b50: 726f 7079 2e74 696d 652e 5469 6d65 293a  ropy.time.Time):
-00048b60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00048b70: 7365 2056 616c 7565 4572 726f 7228 2774  se ValueError('t
-00048b80: 5f69 6e20 6d75 7374 2062 6520 6173 7472  _in must be astr
-00048b90: 6f70 792e 7469 6d65 2e54 696d 6520 6f62  opy.time.Time ob
-00048ba0: 6a65 6374 2729 0a0a 2020 2020 2020 2020  ject')..        
-00048bb0: 6474 203d 2074 5f69 6e20 2d20 7365 6c66  dt = t_in - self
-00048bc0: 2e5f 7431 3938 350a 2020 2020 2020 2020  ._t1985.        
-00048bd0: 7879 7a20 3d20 7365 6c66 2e65 7661 6c75  xyz = self.evalu
-00048be0: 6174 6528 6474 2e73 6563 2c20 2a2a 6b77  ate(dt.sec, **kw
-00048bf0: 6172 6773 290a 2020 2020 2020 2020 6966  args).        if
-00048c00: 2027 6173 5f74 6162 6c65 2720 696e 206b   'as_table' in k
-00048c10: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
-00048c20: 2020 2069 6620 6b77 6172 6773 5b27 6173     if kwargs['as
-00048c30: 5f74 6162 6c65 275d 3a0a 2020 2020 2020  _table']:.      
-00048c40: 2020 2020 2020 2020 2020 7879 7a5b 2774            xyz['t
-00048c50: 696d 6527 5d20 3d20 745f 696e 0a20 2020  ime'] = t_in.   
-00048c60: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00048c70: 2020 2020 2020 7265 7475 726e 2078 797a        return xyz
-00048c80: 0a0a 0a20 2020 2064 6566 205f 5f67 6574  ...    def __get
-00048c90: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-00048ca0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00048cb0: 6e20 7365 6c66 2e70 6172 616d 5f64 6963  n self.param_dic
-00048cc0: 745b 6b65 795d 0a0a 0a20 2020 2064 6566  t[key]...    def
-00048cd0: 2065 7661 6c75 6174 6528 7365 6c66 2c20   evaluate(self, 
-00048ce0: 6474 2c20 756e 6974 3d4e 6f6e 652c 2061  dt, unit=None, a
-00048cf0: 735f 7461 626c 653d 4661 6c73 6529 3a0a  s_table=False):.
-00048d00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00048d10: 2020 2020 4576 616c 7561 7465 2065 7175      Evaluate equ
-00048d20: 6174 696f 6e73 2074 6f20 6765 7420 706f  ations to get po
-00048d30: 7369 7469 6f6e 730a 2020 2020 2020 2020  sitions.        
-00048d40: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00048d50: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00048d60: 0a20 2020 2020 2020 2078 2c20 792c 207a  .        x, y, z
-00048d70: 2c20 723a 2066 6c6f 6174 0a20 2020 2020  , r: float.     
-00048d80: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
-00048d90: 6573 2c20 696e 206b 6d20 6f72 2060 6075  es, in km or ``u
-00048da0: 6e69 7460 602e 0a20 2020 2020 2020 2020  nit``..         
-00048db0: 2020 200a 2020 2020 2020 2020 2222 220a     .        """.
-00048dc0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00048dd0: 2069 6620 6e6f 7420 7365 6c66 2e70 6172   if not self.par
-00048de0: 616d 5f64 6963 743a 0a20 2020 2020 2020  am_dict:.       
-00048df0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00048e00: 4572 726f 7228 274f 7262 6974 616c 2070  Error('Orbital p
-00048e10: 6172 616d 6574 6572 7320 6e6f 7420 6465  arameters not de
-00048e20: 6669 6e65 6420 696e 2027 0a20 2020 2020  fined in '.     
-00048e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e40: 2020 2020 2020 2020 2773 656c 662e 7061          'self.pa
-00048e50: 7261 6d5f 6469 6374 2729 0a20 2020 2020  ram_dict').     
-00048e60: 2020 2020 2020 2020 2020 2020 2020 200a                 .
-00048e70: 2020 2020 2020 2020 7020 3d20 7365 6c66          p = self
-00048e80: 2e70 6172 616d 5f64 6963 740a 2020 2020  .param_dict.    
-00048e90: 2020 2020 0a20 2020 2020 2020 2074 203d      .        t =
-00048ea0: 206e 702e 6174 6c65 6173 745f 3164 2864   np.atleast_1d(d
-00048eb0: 7429 0a20 2020 2020 2020 200a 2020 2020  t).        .    
-00048ec0: 2020 2020 2320 4571 2e20 310a 2020 2020      # Eq. 1.    
-00048ed0: 2020 2020 6272 6163 6b65 7420 3d20 705b      bracket = p[
-00048ee0: 274d 2e27 5d2a 2874 2d70 5b27 7461 7527  'M.']*(t-p['tau'
-00048ef0: 5d29 202b 2030 2e35 2a70 5b27 4d2e 2e27  ]) + 0.5*p['M..'
-00048f00: 5d2a 2874 2d70 5b27 7461 7527 5d29 2a2a  ]*(t-p['tau'])**
-00048f10: 320a 2020 2020 2020 2020 4d20 3d20 705b  2.        M = p[
-00048f20: 274d 3027 5d20 2b20 322a 6e70 2e70 692a  'M0'] + 2*np.pi*
-00048f30: 6272 6163 6b65 740a 2020 2020 2020 2020  bracket.        
-00048f40: 0a20 2020 2020 2020 2023 2045 712e 2032  .        # Eq. 2
-00048f50: 0a20 2020 2020 2020 2073 696e 4d20 3d20  .        sinM = 
-00048f60: 6e70 2e73 696e 284d 290a 2020 2020 2020  np.sin(M).      
-00048f70: 2020 636f 734d 203d 206e 702e 636f 7328    cosM = np.cos(
-00048f80: 4d29 0a20 2020 2020 2020 2065 203d 2070  M).        e = p
-00048f90: 5b27 6527 5d0a 2020 2020 2020 2020 6e75  ['e'].        nu
-00048fa0: 203d 204d 202b 2073 696e 4d2a 2832 2a65   = M + sinM*(2*e
-00048fb0: 202b 2033 2a65 2a2a 332a 636f 734d 2a2a   + 3*e**3*cosM**
-00048fc0: 3220 2d20 342e 2f33 2a65 2a2a 332a 7369  2 - 4./3*e**3*si
-00048fd0: 6e4d 2a2a 3220 0a20 2020 2020 2020 2020  nM**2 .         
-00048fe0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00048ff0: 352e 2f32 2a65 2a2a 322a 636f 734d 290a  5./2*e**2*cosM).
-00049000: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00049010: 2023 2045 712e 2033 0a20 2020 2020 2020   # Eq. 3.       
-00049020: 2072 203d 2070 5b27 6128 312d 652a 2a32   r = p['a(1-e**2
-00049030: 2927 5d2f 2831 2b65 2a6e 702e 636f 7328  )']/(1+e*np.cos(
-00049040: 6e75 2929 0a20 2020 2020 2020 2023 2054  nu)).        # T
-00049050: 6f20 6b6d 0a20 2020 2020 2020 2072 202f  o km.        r /
-00049060: 3d20 3130 3030 2e0a 2020 2020 2020 2020  = 1000..        
-00049070: 0a20 2020 2020 2020 2023 2045 712e 2034  .        # Eq. 4
-00049080: 0a20 2020 2020 2020 204f 6d20 3d20 322a  .        Om = 2*
-00049090: 6e70 2e70 692a 2870 5b27 4f6d 3027 5d20  np.pi*(p['Om0'] 
-000490a0: 2b20 705b 274f 6d2e 275d 2a28 742d 705b  + p['Om.']*(t-p[
-000490b0: 2774 6175 275d 2929 0a20 2020 2020 2020  'tau'])).       
-000490c0: 200a 2020 2020 2020 2020 2320 4571 2e20   .        # Eq. 
-000490d0: 350a 2020 2020 2020 2020 7720 3d20 322a  5.        w = 2*
-000490e0: 6e70 2e70 692a 2870 5b27 7730 275d 202b  np.pi*(p['w0'] +
-000490f0: 2070 5b27 772e 275d 2a28 742d 705b 2774   p['w.']*(t-p['t
-00049100: 6175 275d 2929 0a20 2020 2020 2020 200a  au'])).        .
-00049110: 2020 2020 2020 2020 7365 6c66 2e63 616c          self.cal
-00049120: 635f 6469 6374 203d 207b 274d 273a 4d2c  c_dict = {'M':M,
-00049130: 2027 6e75 273a 6e75 2c20 0a20 2020 2020   'nu':nu, .     
-00049140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049150: 2020 2020 2027 6127 3a70 5b27 6127 5d2c       'a':p['a'],
-00049160: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00049170: 2020 2020 2020 2020 2020 2020 2769 273a              'i':
-00049180: 6e70 2e61 7263 7369 6e28 705b 2773 696e  np.arcsin(p['sin
-00049190: 6927 5d29 2c20 0a20 2020 2020 2020 2020  i']), .         
-000491a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000491b0: 2027 4f6d 273a 4f6d 2c0a 2020 2020 2020   'Om':Om,.      
-000491c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000491d0: 2020 2020 2777 273a 777d 0a20 2020 2020      'w':w}.     
-000491e0: 2020 200a 2020 2020 2020 2020 2320 4571     .        # Eq
-000491f0: 2e20 360a 2020 2020 2020 2020 636f 734f  . 6.        cosO
-00049200: 6d20 3d20 6e70 2e63 6f73 284f 6d29 0a20  m = np.cos(Om). 
-00049210: 2020 2020 2020 2073 696e 4f6d 203d 206e         sinOm = n
-00049220: 702e 7369 6e28 4f6d 290a 2020 2020 2020  p.sin(Om).      
-00049230: 2020 636f 7377 7620 3d20 6e70 2e63 6f73    coswv = np.cos
-00049240: 2877 2b6e 7529 0a20 2020 2020 2020 2073  (w+nu).        s
-00049250: 696e 7776 203d 206e 702e 7369 6e28 772b  inwv = np.sin(w+
-00049260: 6e75 290a 2020 2020 2020 2020 0a20 2020  nu).        .   
-00049270: 2020 2020 2069 6620 756e 6974 2069 7320       if unit is 
-00049280: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00049290: 2020 2020 2020 7220 3d20 2872 2a75 2e6b        r = (r*u.k
-000492a0: 6d29 2e74 6f28 756e 6974 290a 2020 2020  m).to(unit).    
-000492b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000492c0: 2078 203d 2072 2a28 636f 734f 6d2a 636f   x = r*(cosOm*co
-000492d0: 7377 7620 2d20 705b 2763 6f73 6927 5d2a  swv - p['cosi']*
-000492e0: 7369 6e4f 6d2a 7369 6e77 7629 0a20 2020  sinOm*sinwv).   
-000492f0: 2020 2020 2079 203d 2072 2a28 7369 6e4f       y = r*(sinO
-00049300: 6d2a 636f 7377 7620 2b20 705b 2763 6f73  m*coswv + p['cos
-00049310: 6927 5d2a 636f 734f 6d2a 7369 6e77 7629  i']*cosOm*sinwv)
-00049320: 0a20 2020 2020 2020 207a 203d 2072 2a70  .        z = r*p
-00049330: 5b27 7369 6e69 275d 2a73 696e 7776 0a20  ['sini']*sinwv. 
-00049340: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00049350: 6966 2061 735f 7461 626c 653a 0a20 2020  if as_table:.   
-00049360: 2020 2020 2020 2020 2074 6162 203d 2047           tab = G
-00049370: 5461 626c 6528 290a 2020 2020 2020 2020  Table().        
-00049380: 2020 2020 7461 625b 2764 7427 5d20 3d20      tab['dt'] = 
-00049390: 740a 2020 2020 2020 2020 2020 2020 7461  t.            ta
-000493a0: 625b 2778 275d 203d 2078 0a20 2020 2020  b['x'] = x.     
-000493b0: 2020 2020 2020 2074 6162 5b27 7927 5d20         tab['y'] 
-000493c0: 3d20 790a 2020 2020 2020 2020 2020 2020  = y.            
-000493d0: 7461 625b 277a 275d 203d 207a 0a20 2020  tab['z'] = z.   
-000493e0: 2020 2020 2020 2020 2074 6162 5b27 7227           tab['r'
-000493f0: 5d20 3d20 720a 2020 2020 2020 2020 2020  ] = r.          
-00049400: 2020 7265 7475 726e 2074 6162 0a20 2020    return tab.   
-00049410: 2020 2020 2065 6c73 653a 200a 2020 2020       else: .    
-00049420: 2020 2020 2020 2020 7265 7475 726e 2078          return x
-00049430: 2c20 792c 207a 2c20 720a 0a0a 2020 2020  , y, z, r...    
-00049440: 6465 6620 6672 6f6d 5f66 6c74 2873 656c  def from_flt(sel
-00049450: 662c 2066 6c74 5f66 696c 652c 202a 2a6b  f, flt_file, **k
-00049460: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00049470: 2222 220a 2020 2020 2020 2020 436f 6d70  """.        Comp
-00049480: 7574 6520 706f 7369 7469 6f6e 7320 6174  ute positions at
-00049490: 2065 7870 7374 6172 742c 2065 7870 6d69   expstart, expmi
-000494a0: 642c 2065 7870 656e 640a 2020 2020 2020  d, expend.      
-000494b0: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-000494c0: 706f 7274 2061 7374 726f 7079 2e74 696d  port astropy.tim
-000494d0: 650a 2020 2020 2020 2020 0a20 2020 2020  e.        .     
-000494e0: 2020 2066 6c74 203d 2070 7966 6974 732e     flt = pyfits.
-000494f0: 6f70 656e 2866 6c74 5f66 696c 6529 0a20  open(flt_file). 
-00049500: 2020 2020 2020 2065 7870 7374 6172 7420         expstart 
-00049510: 3d20 666c 745b 305d 2e68 6561 6465 725b  = flt[0].header[
-00049520: 2745 5850 5354 4152 5427 5d0a 2020 2020  'EXPSTART'].    
-00049530: 2020 2020 6578 7065 6e64 203d 2066 6c74      expend = flt
-00049540: 5b30 5d2e 6865 6164 6572 5b27 4558 5045  [0].header['EXPE
-00049550: 4e44 275d 0a20 2020 2020 2020 2065 7870  ND'].        exp
-00049560: 6d69 6420 3d20 2865 7870 7374 6172 742b  mid = (expstart+
-00049570: 6578 7065 6e64 292f 322e 0a20 2020 2020  expend)/2..     
-00049580: 2020 200a 2020 2020 2020 2020 745f 696e     .        t_in
-00049590: 203d 2061 7374 726f 7079 2e74 696d 652e   = astropy.time.
-000495a0: 5469 6d65 285b 6578 7073 7461 7274 2c20  Time([expstart, 
-000495b0: 6578 706d 6964 2c20 6578 7065 6e64 5d2c  expmid, expend],
-000495c0: 2066 6f72 6d61 743d 276d 6a64 2729 0a20   format='mjd'). 
-000495d0: 2020 2020 2020 2066 6c74 2e63 6c6f 7365         flt.close
-000495e0: 2829 0a20 2020 2020 2020 200a 2020 2020  ().        .    
-000495f0: 2020 2020 7265 7475 726e 2073 656c 6628      return self(
-00049600: 745f 696e 2c20 2a2a 6b77 6172 6773 290a  t_in, **kwargs).
-00049610: 0a0a 2020 2020 6465 6620 6465 6c74 6174  ..    def deltat
-00049620: 2873 656c 662c 2064 7429 3a0a 2020 2020  (self, dt):.    
-00049630: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00049640: 436f 6e76 6572 7420 6120 7469 6d65 2060  Convert a time `
-00049650: 6074 6060 2069 6e20 7365 636f 6e64 7320  `t`` in seconds 
-00049660: 6672 6f6d 2031 2f31 2f38 3520 746f 2061  from 1/1/85 to a
-00049670: 6e20 4953 4f20 7469 6d65 0a20 2020 2020  n ISO time.     
-00049680: 2020 2022 2222 2020 2020 0a20 2020 2020     """    .     
-00049690: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
-000496a0: 7228 6474 2c20 2775 6e69 7427 293a 0a20  r(dt, 'unit'):. 
-000496b0: 2020 2020 2020 2020 2020 2064 7473 6563             dtsec
-000496c0: 203d 2064 742a 752e 7365 636f 6e64 0a20   = dt*u.second. 
-000496d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000496e0: 2020 2020 2020 2020 2064 7473 6563 203d           dtsec =
-000496f0: 2064 740a 2020 2020 2020 2020 2020 2020   dt.            
-00049700: 0a20 2020 2020 2020 2074 203d 2073 656c  .        t = sel
-00049710: 662e 5f74 3139 3835 202b 2064 7473 6563  f._t1985 + dtsec
-00049720: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00049730: 740a 0a0a 2020 2020 6465 6620 7061 7273  t...    def pars
-00049740: 655f 6672 6f6d 5f73 7074 2873 656c 662c  e_from_spt(self,
-00049750: 2073 7074 5f66 696c 6529 3a0a 2020 2020   spt_file):.    
-00049760: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00049770: 4765 7420 6f72 6269 7461 6c20 656c 656d  Get orbital elem
-00049780: 656e 7473 2066 726f 6d20 5350 5420 6865  ents from SPT he
-00049790: 6164 6572 0a20 2020 2020 2020 2022 2222  ader.        """
-000497a0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-000497b0: 6173 7472 6f70 792e 696f 2e66 6974 7320  astropy.io.fits 
-000497c0: 6173 2070 7966 6974 730a 2020 2020 2020  as pyfits.      
-000497d0: 2020 696d 706f 7274 2061 7374 726f 7079    import astropy
-000497e0: 2e74 696d 650a 2020 2020 2020 2020 0a20  .time.        . 
-000497f0: 2020 2020 2020 2077 6974 6820 7079 6669         with pyfi
-00049800: 7473 2e6f 7065 6e28 7370 745f 6669 6c65  ts.open(spt_file
-00049810: 2920 6173 205f 696d 3a0a 2020 2020 2020  ) as _im:.      
-00049820: 2020 2020 2020 7370 7420 3d20 5f69 6d5b        spt = _im[
-00049830: 305d 2e68 6561 6465 722e 636f 7079 2829  0].header.copy()
-00049840: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00049850: 2020 7061 7261 6d5f 6469 6374 203d 207b    param_dict = {
-00049860: 7d0a 2020 2020 2020 2020 7061 7261 6d5f  }.        param_
-00049870: 6469 6374 5b27 7461 7527 5d20 3d20 7370  dict['tau'] = sp
-00049880: 745b 2745 5043 4854 494d 4527 5d0a 2020  t['EPCHTIME'].  
-00049890: 2020 2020 2020 7061 7261 6d5f 6469 6374        param_dict
-000498a0: 5b27 4d30 275d 203d 2073 7074 5b27 4d45  ['M0'] = spt['ME
-000498b0: 414e 414e 4f4d 275d 0a20 2020 2020 2020  ANANOM'].       
-000498c0: 2070 6172 616d 5f64 6963 745b 274d 2e27   param_dict['M.'
-000498d0: 5d20 3d20 7370 745b 2746 444d 4541 4e41  ] = spt['FDMEANA
-000498e0: 4e27 5d0a 2020 2020 2020 2020 7061 7261  N'].        para
-000498f0: 6d5f 6469 6374 5b27 4d2e 2e27 5d20 3d20  m_dict['M..'] = 
-00049900: 7370 745b 2753 444d 4541 4e41 4e27 5d0a  spt['SDMEANAN'].
-00049910: 2020 2020 2020 2020 7061 7261 6d5f 6469          param_di
-00049920: 6374 5b27 6527 5d20 3d20 7370 745b 2745  ct['e'] = spt['E
-00049930: 4343 454e 5452 5927 5d0a 2020 2020 2020  CCENTRY'].      
-00049940: 2020 7061 7261 6d5f 6469 6374 5b27 6128    param_dict['a(
-00049950: 312d 652a 2a32 2927 5d20 3d20 7370 745b  1-e**2)'] = spt[
-00049960: 2753 454d 494c 5245 4327 5d0a 2020 2020  'SEMILREC'].    
-00049970: 2020 2020 7061 7261 6d5f 6469 6374 5b27      param_dict['
-00049980: 6127 5d20 3d20 7061 7261 6d5f 6469 6374  a'] = param_dict
-00049990: 5b27 6128 312d 652a 2a32 2927 5d20 2f20  ['a(1-e**2)'] / 
-000499a0: 2831 2d70 6172 616d 5f64 6963 745b 2765  (1-param_dict['e
-000499b0: 275d 2a2a 3229 0a20 2020 2020 2020 2070  ']**2).        p
-000499c0: 6172 616d 5f64 6963 745b 274f 6d30 275d  aram_dict['Om0']
-000499d0: 203d 2073 7074 5b27 5241 5343 4153 434e   = spt['RASCASCN
-000499e0: 275d 0a20 2020 2020 2020 2070 6172 616d  '].        param
-000499f0: 5f64 6963 745b 274f 6d2e 275d 203d 2073  _dict['Om.'] = s
-00049a00: 7074 5b27 5243 4153 434e 5256 275d 0a20  pt['RCASCNRV']. 
-00049a10: 2020 2020 2020 2070 6172 616d 5f64 6963         param_dic
-00049a20: 745b 2777 3027 5d20 3d20 7370 745b 2741  t['w0'] = spt['A
-00049a30: 5247 5045 5249 4727 5d0a 2020 2020 2020  RGPERIG'].      
-00049a40: 2020 7061 7261 6d5f 6469 6374 5b27 772e    param_dict['w.
-00049a50: 275d 203d 2073 7074 5b27 5243 4152 4750  '] = spt['RCARGP
-00049a60: 4552 275d 0a20 2020 2020 2020 2070 6172  ER'].        par
-00049a70: 616d 5f64 6963 745b 2763 6f73 6927 5d20  am_dict['cosi'] 
-00049a80: 3d20 7370 745b 2743 4f53 494e 434c 4927  = spt['COSINCLI'
-00049a90: 5d0a 2020 2020 2020 2020 7061 7261 6d5f  ].        param_
-00049aa0: 6469 6374 5b27 7369 6e69 275d 203d 2073  dict['sini'] = s
-00049ab0: 7074 5b27 5349 4e45 494e 434c 275d 0a20  pt['SINEINCL']. 
-00049ac0: 2020 2020 2020 2070 6172 616d 5f64 6963         param_dic
-00049ad0: 745b 2756 6327 5d20 3d20 7370 745b 2743  t['Vc'] = spt['C
-00049ae0: 4952 5645 4c4f 4327 5d0a 2020 2020 2020  IRVELOC'].      
-00049af0: 2020 7061 7261 6d5f 6469 6374 5b27 7469    param_dict['ti
-00049b00: 6d65 6666 6563 275d 203d 2073 7074 5b27  meffec'] = spt['
-00049b10: 5449 4d45 4646 4543 275d 0a20 2020 2020  TIMEFFEC'].     
-00049b20: 2020 2070 6172 616d 5f64 6963 745b 2754     param_dict['T
-00049b30: 6f72 6227 5d20 3d20 7370 745b 2748 5354  orb'] = spt['HST
-00049b40: 484f 5242 275d 2a32 0a20 2020 2020 2020  HORB']*2.       
-00049b50: 2070 6172 616d 5f64 6963 745b 2774 7374   param_dict['tst
-00049b60: 6172 7427 5d20 3d20 7370 745b 274f 4253  art'] = spt['OBS
-00049b70: 5354 5254 5427 5d0a 2020 2020 2020 2020  STRTT'].        
-00049b80: 0a20 2020 2020 2020 2070 6172 616d 5f64  .        param_d
-00049b90: 6963 745b 2774 6175 5f74 696d 6527 5d20  ict['tau_time'] 
-00049ba0: 3d20 7365 6c66 2e64 656c 7461 7428 7061  = self.deltat(pa
-00049bb0: 7261 6d5f 6469 6374 5b27 7461 7527 5d29  ram_dict['tau'])
-00049bc0: 0a20 2020 2020 2020 2070 6172 616d 5f64  .        param_d
-00049bd0: 6963 745b 2774 7374 6172 745f 7469 6d65  ict['tstart_time
-00049be0: 275d 203d 2073 656c 662e 6465 6c74 6174  '] = self.deltat
-00049bf0: 2870 6172 616d 5f64 6963 745b 2774 7374  (param_dict['tst
-00049c00: 6172 7427 5d29 0a20 2020 2020 2020 2020  art']).         
-00049c10: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00049c20: 7265 7475 726e 2070 6172 616d 5f64 6963  return param_dic
-00049c30: 740a 2020 2020 0a20 2020 2040 7374 6174  t.    .    @stat
-00049c40: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00049c50: 2078 797a 5f74 6f5f 6c6f 6e6c 6174 2873   xyz_to_lonlat(s
-00049c60: 656c 662c 2078 2c20 792c 207a 2c20 7261  elf, x, y, z, ra
-00049c70: 6469 616e 733d 4661 6c73 6529 3a0a 2020  dians=False):.  
-00049c80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00049c90: 2020 436f 6d70 7574 6520 7375 626c 6f6e    Compute sublon
-00049ca0: 2c20 7375 626c 6174 2c20 616c 7420 6672  , sublat, alt fr
-00049cb0: 6f6d 2078 797a 2063 6f6f 7264 7320 7769  om xyz coords wi
-00049cc0: 7468 2070 7970 726f 6a0a 2020 2020 2020  th pyproj.      
-00049cd0: 2020 0a20 2020 2020 2020 2078 797a 206d    .        xyz m
-00049ce0: 7573 7420 6265 2069 6e20 6d65 7465 7273  ust be in meters
-00049cf0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00049d00: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-00049d10: 706f 7274 2070 7970 726f 6a0a 2020 2020  port pyproj.    
-00049d20: 2020 2020 6563 6566 203d 2070 7970 726f      ecef = pypro
-00049d30: 6a2e 5072 6f6a 2870 726f 6a3d 2767 656f  j.Proj(proj='geo
-00049d40: 6365 6e74 272c 2065 6c6c 7073 3d27 5747  cent', ellps='WG
-00049d50: 5338 3427 2c20 6461 7475 6d3d 2757 4753  S84', datum='WGS
-00049d60: 3834 2729 0a20 2020 2020 2020 206c 6c61  84').        lla
-00049d70: 203d 2070 7970 726f 6a2e 5072 6f6a 2870   = pyproj.Proj(p
-00049d80: 726f 6a3d 276c 6174 6c6f 6e67 272c 2065  roj='latlong', e
-00049d90: 6c6c 7073 3d27 5747 5338 3427 2c20 6461  llps='WGS84', da
-00049da0: 7475 6d3d 2757 4753 3834 2729 0a20 2020  tum='WGS84').   
-00049db0: 2020 2020 206c 6f6e 2c20 6c61 742c 2061       lon, lat, a
-00049dc0: 6c74 203d 2070 7970 726f 6a2e 7472 616e  lt = pyproj.tran
-00049dd0: 7366 6f72 6d28 6563 6566 2c20 6c6c 612c  sform(ecef, lla,
-00049de0: 2078 2c20 792c 207a 2c20 7261 6469 616e   x, y, z, radian
-00049df0: 733d 7261 6469 616e 7329 0a20 2020 2020  s=radians).     
-00049e00: 2020 2072 6574 7572 6e20 6c6f 6e2c 206c     return lon, l
-00049e10: 6174 2c20 616c 740a 0a0a 6465 6620 7061  at, alt...def pa
-00049e20: 7463 685f 7068 6f74 7574 696c 7328 293a  tch_photutils():
-00049e30: 0a20 2020 2022 2222 0a20 2020 2050 6174  .    """.    Pat
-00049e40: 6368 2074 6f20 6669 7820 696e 636f 6e73  ch to fix incons
-00049e50: 6973 7465 6e63 7920 7769 7468 2064 7269  istency with dri
-00049e60: 7a7a 6c65 7061 633d 332e 322e 3120 616e  zzlepac=3.2.1 an
-00049e70: 6420 7068 6f74 7574 696c 733e 312e 302c  d photutils>1.0,
-00049e80: 2077 6865 7265 200a 2020 2020 5468 6520   where .    The 
-00049e90: 6c61 7474 6572 2069 7320 6e65 6564 6564  latter is needed
-00049ea0: 2066 6f72 206a 7773 743d 312e 332e 320a   for jwst=1.3.2.
-00049eb0: 2020 2020 2222 220a 2020 2020 696d 706f      """.    impo
-00049ec0: 7274 206f 730a 0a20 2020 2074 7279 3a0a  rt os..    try:.
-00049ed0: 2020 2020 2020 2020 696d 706f 7274 2064          import d
-00049ee0: 7269 7a7a 6c65 7061 630a 2020 2020 6578  rizzlepac.    ex
-00049ef0: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-00049f00: 726f 723a 0a20 2020 200a 2020 2020 2020  ror:.    .      
-00049f10: 2020 696d 706f 7274 2070 686f 7475 7469    import photuti
-00049f20: 6c73 0a20 2020 2020 2020 2073 6974 655f  ls.        site_
-00049f30: 7061 636b 6167 6573 203d 206f 732e 7061  packages = os.pa
-00049f40: 7468 2e64 6972 6e61 6d65 2870 686f 7475  th.dirname(photu
-00049f50: 7469 6c73 2e5f 5f66 696c 655f 5f29 0a20  tils.__file__). 
-00049f60: 2020 2020 2020 2023 206d 616e 7561 6c20         # manual 
-00049f70: 6170 706c 7920 7061 7463 680a 2020 2020  apply patch.    
-00049f80: 2020 2020 7468 655f 6669 6c65 203d 2066      the_file = f
-00049f90: 277b 7369 7465 5f70 6163 6b61 6765 737d  '{site_packages}
-00049fa0: 2f2e 2e2f 6472 697a 7a6c 6570 6163 2f68  /../drizzlepac/h
-00049fb0: 6170 7574 696c 732f 616c 6967 6e5f 7574  aputils/align_ut
-00049fc0: 696c 732e 7079 270a 2020 2020 2020 2020  ils.py'.        
-00049fd0: 7769 7468 206f 7065 6e28 7468 655f 6669  with open(the_fi
-00049fe0: 6c65 2c27 7227 2920 6173 2066 703a 0a20  le,'r') as fp:. 
-00049ff0: 2020 2020 2020 2020 2020 206c 696e 6573             lines
-0004a000: 203d 2066 702e 7265 6164 6c69 6e65 7328   = fp.readlines(
-0004a010: 290a 2020 2020 0a20 2020 2020 2020 2070  ).    .        p
-0004a020: 7269 6e74 2873 6974 655f 7061 636b 6167  rint(site_packag
-0004a030: 6573 2c20 6c65 6e28 6c69 6e65 7329 290a  es, len(lines)).
-0004a040: 2020 2020 2020 2020 666f 7220 692c 206c          for i, l
-0004a050: 696e 6520 696e 2065 6e75 6d65 7261 7465  ine in enumerate
-0004a060: 286c 696e 6573 293a 0a20 2020 2020 2020  (lines):.       
-0004a070: 2020 2020 2069 6620 6c69 6e65 2e73 7461       if line.sta
-0004a080: 7274 7377 6974 6828 274e 6f44 6574 6563  rtswith('NoDetec
-0004a090: 7469 6f6e 7357 6172 6e69 6e67 2729 3a0a  tionsWarning'):.
-0004a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a0b0: 6272 6561 6b0a 2020 2020 0a20 2020 2020  break.    .     
-0004a0c0: 2020 2069 6620 2768 6173 6174 7472 2870     if 'hasattr(p
-0004a0d0: 686f 7475 7469 6c73 2e66 696e 6473 7461  hotutils.findsta
-0004a0e0: 7273 2720 696e 206c 696e 6573 5b69 2b31  rs' in lines[i+1
-0004a0f0: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
-0004a100: 7269 6e74 2866 2749 2066 6f75 6e64 2074  rint(f'I found t
-0004a110: 6865 2070 726f 626c 656d 206f 6e20 6c69  he problem on li
-0004a120: 6e65 7320 7b69 7d2d 7b69 2b32 7d3a 2027  nes {i}-{i+2}: '
-0004a130: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0004a140: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0004a150: 3d20 2222 220a 4c69 6e65 7320 7b30 7d2d  = """.Lines {0}-
-0004a160: 7b31 7d20 696e 207b 327d 2069 6d70 6f72  {1} in {2} impor
-0004a170: 7469 6e67 2070 686f 7475 7469 6c73 2077  ting photutils w
-0004a180: 6572 6520 6e6f 7420 6173 2065 7870 6563  ere not as expec
-0004a190: 7465 642e 2020 4920 666f 756e 6420 0a0a  ted.  I found ..
-0004a1a0: 7b33 7d0a 0a62 7574 2065 7870 6563 7465  {3}..but expecte
-0004a1b0: 6420 0a0a 2020 204e 6f44 6574 6563 7469  d ..   NoDetecti
-0004a1c0: 6f6e 7357 6172 6e69 6e67 203d 2070 686f  onsWarning = pho
-0004a1d0: 7475 7469 6c73 2e66 696e 6473 7461 7273  tutils.findstars
-0004a1e0: 2e4e 6f44 6574 6563 7469 6f6e 7357 6172  .NoDetectionsWar
-0004a1f0: 6e69 6e67 2069 6620 5c5c 0a20 2020 2020  ning if \\.     
-0004a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a210: 2020 2020 2020 6861 7361 7474 7228 7068        hasattr(ph
-0004a220: 6f74 7574 696c 732e 6669 6e64 7374 6172  otutils.findstar
-0004a230: 732c 2027 4e6f 4465 7465 6374 696f 6e73  s, 'NoDetections
-0004a240: 5761 726e 696e 6727 2920 656c 7365 205c  Warning') else \
-0004a250: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0004a260: 2020 2020 2020 2020 2020 2020 2070 686f               pho
-0004a270: 7475 7469 6c73 2e75 7469 6c73 2e4e 6f44  tutils.utils.NoD
-0004a280: 6574 6563 7469 6f6e 7357 6172 6e69 6e67  etectionsWarning
-0004a290: 0a0a 0a20 2020 2022 2222 2e66 6f72 6d61  ...    """.forma
-0004a2a0: 7428 692c 2069 2b32 2c20 7468 655f 6669  t(i, i+2, the_fi
-0004a2b0: 6c65 2c20 6c69 6e65 735b 693a 692b 335d  le, lines[i:i+3]
-0004a2c0: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
-0004a2d0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0004a2e0: 7565 4572 726f 7228 6d73 6729 0a20 2020  ueError(msg).   
-0004a2f0: 2020 2020 200a 2020 2020 2020 2020 6261       .        ba
-0004a300: 6420 3d20 5b27 2020 2027 2b6c 696e 6573  d = ['   '+lines
-0004a310: 2e70 6f70 2869 2b32 2d6a 2920 666f 7220  .pop(i+2-j) for 
-0004a320: 6a20 696e 2072 616e 6765 2833 295d 0a20  j in range(3)]. 
-0004a330: 2020 2020 2020 2070 7269 6e74 2827 272e         print(''.
-0004a340: 6a6f 696e 2862 6164 5b3a 3a2d 315d 2929  join(bad[::-1]))
-0004a350: 0a0a 2020 2020 2020 2020 2320 496e 7365  ..        # Inse
-0004a360: 7274 2074 6865 2066 6978 0a20 2020 2020  rt the fix.     
-0004a370: 2020 206c 696e 6573 5b69 5d20 3d20 2766     lines[i] = 'f
-0004a380: 726f 6d20 7068 6f74 7574 696c 732e 7574  rom photutils.ut
-0004a390: 696c 732e 6578 6365 7074 696f 6e73 2069  ils.exceptions i
-0004a3a0: 6d70 6f72 7420 4e6f 4465 7465 6374 696f  mport NoDetectio
-0004a3b0: 6e73 5761 726e 696e 675c 6e5c 6e27 0a20  nsWarning\n\n'. 
-0004a3c0: 2020 2020 2020 2023 2052 6577 7269 7465         # Rewrite
-0004a3d0: 2074 6865 2066 6965 0a20 2020 2020 2020   the fie.       
-0004a3e0: 2077 6974 6820 6f70 656e 2866 277b 7369   with open(f'{si
-0004a3f0: 7465 5f70 6163 6b61 6765 737d 2f2e 2e2f  te_packages}/../
-0004a400: 6472 697a 7a6c 6570 6163 2f68 6170 7574  drizzlepac/haput
-0004a410: 696c 732f 616c 6967 6e5f 7574 696c 732e  ils/align_utils.
-0004a420: 7079 272c 2777 2729 2061 7320 6670 3a0a  py','w') as fp:.
-0004a430: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
-0004a440: 7269 7465 6c69 6e65 7328 6c69 6e65 7329  ritelines(lines)
-0004a450: 0a20 2020 200a 2020 2020 2020 2020 7072  .    .        pr
-0004a460: 696e 7428 6627 5061 7463 6820 6170 706c  int(f'Patch appl
-0004a470: 6965 6420 746f 207b 7468 655f 6669 6c65  ied to {the_file
-0004a480: 7d21 2729 0a                             }!').
+00048a20: 2020 2020 4275 696c 6420 6c69 7374 206f      Build list o
+00048a30: 6620 6c69 7374 7320 6f66 2069 6e64 6963  f lists of indic
+00048a40: 6573 2074 6861 7420 6561 6368 2075 6e69  es that each uni
+00048a50: 7175 6520 7661 6c75 650a 2020 2020 2020  que value.      
+00048a60: 2020 2222 220a 2020 2020 0a20 2020 2020    """.    .     
+00048a70: 2020 2069 6e64 7320 3d20 5b5b 5d20 666f     inds = [[] fo
+00048a80: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
+00048a90: 662e 4e29 5d20 2020 200a 2020 2020 2020  f.N)]    .      
+00048aa0: 2020 736f 203d 206e 702e 6172 6773 6f72    so = np.argsor
+00048ab0: 7428 7365 6c66 2e69 6e64 6963 6573 290a  t(self.indices).
+00048ac0: 2020 2020 0a20 2020 2020 2020 2066 6f72      .        for
+00048ad0: 2069 2c20 6969 2069 6e20 7a69 7028 736f   i, ii in zip(so
+00048ae0: 2c20 7365 6c66 2e69 6e64 6963 6573 5b73  , self.indices[s
+00048af0: 6f5d 293a 0a20 2020 2020 2020 2020 2020  o]):.           
+00048b00: 2069 6e64 735b 6969 5d2e 6170 7065 6e64   inds[ii].append
+00048b10: 2869 290a 2020 2020 2020 2020 0a20 2020  (i).        .   
+00048b20: 2020 2020 2023 2053 6f72 7420 7468 6520       # Sort the 
+00048b30: 7375 626c 6973 7473 0a20 2020 2020 2020  sublists.       
+00048b40: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00048b50: 7365 6c66 2e4e 293a 0a20 2020 2020 2020  self.N):.       
+00048b60: 2020 2020 2069 6620 7365 6c66 2e63 6f75       if self.cou
+00048b70: 6e74 735b 695d 203e 2031 3a0a 2020 2020  nts[i] > 1:.    
+00048b80: 2020 2020 2020 2020 2020 2020 696e 6473              inds
+00048b90: 5b69 5d2e 736f 7274 2829 0a20 2020 200a  [i].sort().    .
+00048ba0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00048bb0: 6e64 730a 2020 2020 0a20 2020 200a 2020  nds.    .    .  
+00048bc0: 2020 6465 6620 756e 6971 7565 5f69 6e64    def unique_ind
+00048bd0: 6578 2873 656c 662c 2069 6e64 6578 3d30  ex(self, index=0
+00048be0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00048bf0: 2020 2020 2020 2052 6574 7572 6e20 6172         Return ar
+00048c00: 7261 7920 6f66 2069 6e64 6963 6573 206f  ray of indices o
+00048c10: 6620 7468 6520 7061 7265 6e74 2061 7272  f the parent arr
+00048c20: 6179 2074 6861 7420 6d61 6b65 7320 6120  ay that makes a 
+00048c30: 756e 6971 7565 206f 7574 7075 7420 6172  unique output ar
+00048c40: 7261 790a 2020 2020 2020 2020 0a20 2020  ray.        .   
+00048c50: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00048c60: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00048c70: 2020 2020 2075 6978 203a 206c 6973 740a       uix : list.
+00048c80: 2020 2020 2020 2020 2020 2020 4c69 7374              List
+00048c90: 206f 6620 756e 6971 7565 2069 6e64 6963   of unique indic
+00048ca0: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
+00048cb0: 2020 2020 2020 2075 6978 203d 205b 696e         uix = [in
+00048cc0: 645b 696e 6465 785d 2066 6f72 2069 6e64  d[index] for ind
+00048cd0: 2069 6e20 7365 6c66 2e6c 6973 745f 696e   in self.list_in
+00048ce0: 6469 6365 735d 0a20 2020 2020 2020 2020  dices].         
+00048cf0: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00048d00: 2020 2020 7265 7475 726e 2075 6978 0a20      return uix. 
+00048d10: 2020 200a 2020 2020 0a20 2020 2064 6566     .    .    def
+00048d20: 205f 5f69 7465 725f 5f28 7365 6c66 293a   __iter__(self):
+00048d30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00048d40: 2020 2020 2049 7465 7261 626c 6520 6f76       Iterable ov
+00048d50: 6572 2060 7661 6c75 6573 6020 6174 7472  er `values` attr
+00048d60: 6962 7574 650a 2020 2020 2020 2020 0a20  ibute.        . 
+00048d70: 2020 2020 2020 2052 6574 7572 6e73 2061         Returns a
+00048d80: 2074 7570 6c65 206f 6620 7468 6520 7661   tuple of the va
+00048d90: 6c75 6520 616e 6420 7468 6520 626f 6f6c  lue and the bool
+00048da0: 6561 6e20 7365 6c65 6374 696f 6e20 6172  ean selection ar
+00048db0: 7261 7920 666f 7220 7468 6174 200a 2020  ray for that .  
+00048dc0: 2020 2020 2020 7661 6c75 652e 0a20 2020        value..   
+00048dd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00048de0: 2069 203d 2030 0a20 2020 2020 2020 2077   i = 0.        w
+00048df0: 6869 6c65 2069 203c 2073 656c 662e 4e3a  hile i < self.N:
+00048e00: 0a20 2020 2020 2020 2020 2020 2076 6920  .            vi 
+00048e10: 3d20 7365 6c66 2e76 616c 7565 735b 695d  = self.values[i]
+00048e20: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
+00048e30: 6c64 2028 7669 2c20 7365 6c66 5b76 695d  ld (vi, self[vi]
+00048e40: 290a 2020 2020 2020 2020 2020 2020 6920  ).            i 
+00048e50: 2b3d 2031 0a0a 0a20 2020 2064 6566 205f  += 1...    def _
+00048e60: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
+00048e70: 206b 6579 293a 0a20 2020 2020 2020 2069   key):.        i
+00048e80: 6620 6b65 7920 696e 2073 656c 662e 7661  f key in self.va
+00048e90: 6c75 6573 3a0a 2020 2020 2020 2020 2020  lues:.          
+00048ea0: 2020 6978 203d 2073 656c 662e 7661 6c75    ix = self.valu
+00048eb0: 6573 2e69 6e64 6578 286b 6579 290a 2020  es.index(key).  
+00048ec0: 2020 2020 2020 2020 2020 7465 7374 203d            test =
+00048ed0: 2073 656c 662e 696e 6469 6365 7320 3d3d   self.indices ==
+00048ee0: 2069 780a 2020 2020 2020 2020 2020 2020   ix.            
+00048ef0: 7265 7475 726e 2074 6573 740a 2020 2020  return test.    
+00048f00: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00048f10: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00048f20: 662e 7a65 726f 730a 0a0a 2020 2020 6465  f.zeros...    de
+00048f30: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 293a  f __len__(self):
+00048f40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00048f50: 7365 6c66 2e4e 0a0a 0a63 6c61 7373 2048  self.N...class H
+00048f60: 7562 626c 6558 595a 286f 626a 6563 7429  ubbleXYZ(object)
+00048f70: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
+00048f80: 5f5f 2873 656c 662c 2073 7074 5f66 696c  __(self, spt_fil
+00048f90: 653d 2727 2c20 7061 7261 6d5f 6469 6374  e='', param_dict
+00048fa0: 3d7b 7d29 3a0a 2020 2020 2020 2020 2222  ={}):.        ""
+00048fb0: 220a 2020 2020 2020 2020 4865 6c70 6572  ".        Helper
+00048fc0: 2074 6f20 636f 6d70 7574 6520 4853 5420   to compute HST 
+00048fd0: 6765 6f63 656e 7472 6963 2063 6f6f 7264  geocentric coord
+00048fe0: 696e 6174 6573 2066 726f 6d20 6f72 6269  inates from orbi
+00048ff0: 7461 6c20 7061 7261 6d65 7465 7273 0a20  tal parameters. 
+00049000: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00049010: 2874 6573 7469 6e67 290a 2020 2020 2020  (testing).      
+00049020: 2020 0a20 2020 2020 2020 2042 6173 6564    .        Based
+00049030: 206f 6e20 6874 7470 3a2f 2f61 7274 6963   on http://artic
+00049040: 6c65 732e 6164 7361 6273 2e68 6172 7661  les.adsabs.harva
+00049050: 7264 2e65 6475 2f2f 6675 6c6c 2f31 3939  rd.edu//full/199
+00049060: 3541 5350 432e 2e2e 3737 2e2e 3436 3441  5ASPC...77..464A
+00049070: 2f0a 2020 2020 2020 2020 2222 220a 2020  /.        """.  
+00049080: 2020 2020 2020 6966 2073 7074 5f66 696c        if spt_fil
+00049090: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000490a0: 656c 662e 7061 7261 6d5f 6469 6374 203d  elf.param_dict =
+000490b0: 2073 656c 662e 7061 7273 655f 6672 6f6d   self.parse_from
+000490c0: 5f73 7074 2873 7074 5f66 696c 6529 0a20  _spt(spt_file). 
+000490d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000490e0: 656c 6966 2070 6172 616d 5f64 6963 743a  elif param_dict:
+000490f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00049100: 662e 7061 7261 6d5f 6469 6374 203d 2070  f.param_dict = p
+00049110: 6172 616d 5f64 6963 740a 2020 2020 2020  aram_dict.      
+00049120: 2020 0a20 2020 2020 2020 2065 6c73 653a    .        else:
+00049130: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00049140: 662e 7061 7261 6d5f 6469 6374 203d 207b  f.param_dict = {
+00049150: 7d0a 2020 2020 2020 2020 0a20 2020 2020  }.        .     
+00049160: 2020 2073 656c 662e 636f 6d70 7574 6564     self.computed
+00049170: 203d 207b 7d0a 0a0a 2020 2020 4070 726f   = {}...    @pro
+00049180: 7065 7274 7920 0a20 2020 2064 6566 205f  perty .    def _
+00049190: 7431 3938 3528 7365 6c66 293a 0a20 2020  t1985(self):.   
+000491a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000491b0: 2052 6566 6572 656e 6365 2074 696d 650a   Reference time.
+000491c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000491d0: 2020 2020 696d 706f 7274 2061 7374 726f      import astro
+000491e0: 7079 2e74 696d 650a 2020 2020 2020 2020  py.time.        
+000491f0: 7430 203d 2061 7374 726f 7079 2e74 696d  t0 = astropy.tim
+00049200: 652e 5469 6d65 2827 3139 3835 2d30 312d  e.Time('1985-01-
+00049210: 3031 5430 303a 3030 3a30 305a 2729 0a20  01T00:00:00Z'). 
+00049220: 2020 2020 2020 2072 6574 7572 6e20 7430         return t0
+00049230: 0a0a 0a20 2020 2064 6566 205f 5f63 616c  ...    def __cal
+00049240: 6c5f 5f28 7365 6c66 2c20 745f 696e 2c20  l__(self, t_in, 
+00049250: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+00049260: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+00049270: 6f6e 7665 7274 2069 6e70 7574 2074 696d  onvert input tim
+00049280: 6520 6060 745f 696e 6060 2074 6f20 7365  e ``t_in`` to se
+00049290: 636f 6e64 7320 7369 6e63 6520 312f 312f  conds since 1/1/
+000492a0: 3835 2061 6e64 2060 6065 7661 6c75 6174  85 and ``evaluat
+000492b0: 6560 602e 0a20 2020 2020 2020 2022 2222  e``..        """
+000492c0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+000492d0: 6173 7472 6f70 792e 7469 6d65 0a20 2020  astropy.time.   
+000492e0: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+000492f0: 7374 616e 6365 2874 5f69 6e2c 2061 7374  stance(t_in, ast
+00049300: 726f 7079 2e74 696d 652e 5469 6d65 293a  ropy.time.Time):
+00049310: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00049320: 7365 2056 616c 7565 4572 726f 7228 2774  se ValueError('t
+00049330: 5f69 6e20 6d75 7374 2062 6520 6173 7472  _in must be astr
+00049340: 6f70 792e 7469 6d65 2e54 696d 6520 6f62  opy.time.Time ob
+00049350: 6a65 6374 2729 0a0a 2020 2020 2020 2020  ject')..        
+00049360: 6474 203d 2074 5f69 6e20 2d20 7365 6c66  dt = t_in - self
+00049370: 2e5f 7431 3938 350a 2020 2020 2020 2020  ._t1985.        
+00049380: 7879 7a20 3d20 7365 6c66 2e65 7661 6c75  xyz = self.evalu
+00049390: 6174 6528 6474 2e73 6563 2c20 2a2a 6b77  ate(dt.sec, **kw
+000493a0: 6172 6773 290a 2020 2020 2020 2020 6966  args).        if
+000493b0: 2027 6173 5f74 6162 6c65 2720 696e 206b   'as_table' in k
+000493c0: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
+000493d0: 2020 2069 6620 6b77 6172 6773 5b27 6173     if kwargs['as
+000493e0: 5f74 6162 6c65 275d 3a0a 2020 2020 2020  _table']:.      
+000493f0: 2020 2020 2020 2020 2020 7879 7a5b 2774            xyz['t
+00049400: 696d 6527 5d20 3d20 745f 696e 0a20 2020  ime'] = t_in.   
+00049410: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00049420: 2020 2020 2020 7265 7475 726e 2078 797a        return xyz
+00049430: 0a0a 0a20 2020 2064 6566 205f 5f67 6574  ...    def __get
+00049440: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
+00049450: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00049460: 6e20 7365 6c66 2e70 6172 616d 5f64 6963  n self.param_dic
+00049470: 745b 6b65 795d 0a0a 0a20 2020 2064 6566  t[key]...    def
+00049480: 2065 7661 6c75 6174 6528 7365 6c66 2c20   evaluate(self, 
+00049490: 6474 2c20 756e 6974 3d4e 6f6e 652c 2061  dt, unit=None, a
+000494a0: 735f 7461 626c 653d 4661 6c73 6529 3a0a  s_table=False):.
+000494b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000494c0: 2020 2020 4576 616c 7561 7465 2065 7175      Evaluate equ
+000494d0: 6174 696f 6e73 2074 6f20 6765 7420 706f  ations to get po
+000494e0: 7369 7469 6f6e 730a 2020 2020 2020 2020  sitions.        
+000494f0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00049500: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00049510: 0a20 2020 2020 2020 2078 2c20 792c 207a  .        x, y, z
+00049520: 2c20 723a 2066 6c6f 6174 0a20 2020 2020  , r: float.     
+00049530: 2020 2020 2020 2043 6f6f 7264 696e 6174         Coordinat
+00049540: 6573 2c20 696e 206b 6d20 6f72 2060 6075  es, in km or ``u
+00049550: 6e69 7460 602e 0a20 2020 2020 2020 2020  nit``..         
+00049560: 2020 200a 2020 2020 2020 2020 2222 220a     .        """.
+00049570: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00049580: 2069 6620 6e6f 7420 7365 6c66 2e70 6172   if not self.par
+00049590: 616d 5f64 6963 743a 0a20 2020 2020 2020  am_dict:.       
+000495a0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000495b0: 4572 726f 7228 274f 7262 6974 616c 2070  Error('Orbital p
+000495c0: 6172 616d 6574 6572 7320 6e6f 7420 6465  arameters not de
+000495d0: 6669 6e65 6420 696e 2027 0a20 2020 2020  fined in '.     
+000495e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000495f0: 2020 2020 2020 2020 2773 656c 662e 7061          'self.pa
+00049600: 7261 6d5f 6469 6374 2729 0a20 2020 2020  ram_dict').     
+00049610: 2020 2020 2020 2020 2020 2020 2020 200a                 .
+00049620: 2020 2020 2020 2020 7020 3d20 7365 6c66          p = self
+00049630: 2e70 6172 616d 5f64 6963 740a 2020 2020  .param_dict.    
+00049640: 2020 2020 0a20 2020 2020 2020 2074 203d      .        t =
+00049650: 206e 702e 6174 6c65 6173 745f 3164 2864   np.atleast_1d(d
+00049660: 7429 0a20 2020 2020 2020 200a 2020 2020  t).        .    
+00049670: 2020 2020 2320 4571 2e20 310a 2020 2020      # Eq. 1.    
+00049680: 2020 2020 6272 6163 6b65 7420 3d20 705b      bracket = p[
+00049690: 274d 2e27 5d2a 2874 2d70 5b27 7461 7527  'M.']*(t-p['tau'
+000496a0: 5d29 202b 2030 2e35 2a70 5b27 4d2e 2e27  ]) + 0.5*p['M..'
+000496b0: 5d2a 2874 2d70 5b27 7461 7527 5d29 2a2a  ]*(t-p['tau'])**
+000496c0: 320a 2020 2020 2020 2020 4d20 3d20 705b  2.        M = p[
+000496d0: 274d 3027 5d20 2b20 322a 6e70 2e70 692a  'M0'] + 2*np.pi*
+000496e0: 6272 6163 6b65 740a 2020 2020 2020 2020  bracket.        
+000496f0: 0a20 2020 2020 2020 2023 2045 712e 2032  .        # Eq. 2
+00049700: 0a20 2020 2020 2020 2073 696e 4d20 3d20  .        sinM = 
+00049710: 6e70 2e73 696e 284d 290a 2020 2020 2020  np.sin(M).      
+00049720: 2020 636f 734d 203d 206e 702e 636f 7328    cosM = np.cos(
+00049730: 4d29 0a20 2020 2020 2020 2065 203d 2070  M).        e = p
+00049740: 5b27 6527 5d0a 2020 2020 2020 2020 6e75  ['e'].        nu
+00049750: 203d 204d 202b 2073 696e 4d2a 2832 2a65   = M + sinM*(2*e
+00049760: 202b 2033 2a65 2a2a 332a 636f 734d 2a2a   + 3*e**3*cosM**
+00049770: 3220 2d20 342e 2f33 2a65 2a2a 332a 7369  2 - 4./3*e**3*si
+00049780: 6e4d 2a2a 3220 0a20 2020 2020 2020 2020  nM**2 .         
+00049790: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000497a0: 352e 2f32 2a65 2a2a 322a 636f 734d 290a  5./2*e**2*cosM).
+000497b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000497c0: 2023 2045 712e 2033 0a20 2020 2020 2020   # Eq. 3.       
+000497d0: 2072 203d 2070 5b27 6128 312d 652a 2a32   r = p['a(1-e**2
+000497e0: 2927 5d2f 2831 2b65 2a6e 702e 636f 7328  )']/(1+e*np.cos(
+000497f0: 6e75 2929 0a20 2020 2020 2020 2023 2054  nu)).        # T
+00049800: 6f20 6b6d 0a20 2020 2020 2020 2072 202f  o km.        r /
+00049810: 3d20 3130 3030 2e0a 2020 2020 2020 2020  = 1000..        
+00049820: 0a20 2020 2020 2020 2023 2045 712e 2034  .        # Eq. 4
+00049830: 0a20 2020 2020 2020 204f 6d20 3d20 322a  .        Om = 2*
+00049840: 6e70 2e70 692a 2870 5b27 4f6d 3027 5d20  np.pi*(p['Om0'] 
+00049850: 2b20 705b 274f 6d2e 275d 2a28 742d 705b  + p['Om.']*(t-p[
+00049860: 2774 6175 275d 2929 0a20 2020 2020 2020  'tau'])).       
+00049870: 200a 2020 2020 2020 2020 2320 4571 2e20   .        # Eq. 
+00049880: 350a 2020 2020 2020 2020 7720 3d20 322a  5.        w = 2*
+00049890: 6e70 2e70 692a 2870 5b27 7730 275d 202b  np.pi*(p['w0'] +
+000498a0: 2070 5b27 772e 275d 2a28 742d 705b 2774   p['w.']*(t-p['t
+000498b0: 6175 275d 2929 0a20 2020 2020 2020 200a  au'])).        .
+000498c0: 2020 2020 2020 2020 7365 6c66 2e63 616c          self.cal
+000498d0: 635f 6469 6374 203d 207b 274d 273a 4d2c  c_dict = {'M':M,
+000498e0: 2027 6e75 273a 6e75 2c20 0a20 2020 2020   'nu':nu, .     
+000498f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049900: 2020 2020 2027 6127 3a70 5b27 6127 5d2c       'a':p['a'],
+00049910: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00049920: 2020 2020 2020 2020 2020 2020 2769 273a              'i':
+00049930: 6e70 2e61 7263 7369 6e28 705b 2773 696e  np.arcsin(p['sin
+00049940: 6927 5d29 2c20 0a20 2020 2020 2020 2020  i']), .         
+00049950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049960: 2027 4f6d 273a 4f6d 2c0a 2020 2020 2020   'Om':Om,.      
+00049970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049980: 2020 2020 2777 273a 777d 0a20 2020 2020      'w':w}.     
+00049990: 2020 200a 2020 2020 2020 2020 2320 4571     .        # Eq
+000499a0: 2e20 360a 2020 2020 2020 2020 636f 734f  . 6.        cosO
+000499b0: 6d20 3d20 6e70 2e63 6f73 284f 6d29 0a20  m = np.cos(Om). 
+000499c0: 2020 2020 2020 2073 696e 4f6d 203d 206e         sinOm = n
+000499d0: 702e 7369 6e28 4f6d 290a 2020 2020 2020  p.sin(Om).      
+000499e0: 2020 636f 7377 7620 3d20 6e70 2e63 6f73    coswv = np.cos
+000499f0: 2877 2b6e 7529 0a20 2020 2020 2020 2073  (w+nu).        s
+00049a00: 696e 7776 203d 206e 702e 7369 6e28 772b  inwv = np.sin(w+
+00049a10: 6e75 290a 2020 2020 2020 2020 0a20 2020  nu).        .   
+00049a20: 2020 2020 2069 6620 756e 6974 2069 7320       if unit is 
+00049a30: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00049a40: 2020 2020 2020 7220 3d20 2872 2a75 2e6b        r = (r*u.k
+00049a50: 6d29 2e74 6f28 756e 6974 290a 2020 2020  m).to(unit).    
+00049a60: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00049a70: 2078 203d 2072 2a28 636f 734f 6d2a 636f   x = r*(cosOm*co
+00049a80: 7377 7620 2d20 705b 2763 6f73 6927 5d2a  swv - p['cosi']*
+00049a90: 7369 6e4f 6d2a 7369 6e77 7629 0a20 2020  sinOm*sinwv).   
+00049aa0: 2020 2020 2079 203d 2072 2a28 7369 6e4f       y = r*(sinO
+00049ab0: 6d2a 636f 7377 7620 2b20 705b 2763 6f73  m*coswv + p['cos
+00049ac0: 6927 5d2a 636f 734f 6d2a 7369 6e77 7629  i']*cosOm*sinwv)
+00049ad0: 0a20 2020 2020 2020 207a 203d 2072 2a70  .        z = r*p
+00049ae0: 5b27 7369 6e69 275d 2a73 696e 7776 0a20  ['sini']*sinwv. 
+00049af0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00049b00: 6966 2061 735f 7461 626c 653a 0a20 2020  if as_table:.   
+00049b10: 2020 2020 2020 2020 2074 6162 203d 2047           tab = G
+00049b20: 5461 626c 6528 290a 2020 2020 2020 2020  Table().        
+00049b30: 2020 2020 7461 625b 2764 7427 5d20 3d20      tab['dt'] = 
+00049b40: 740a 2020 2020 2020 2020 2020 2020 7461  t.            ta
+00049b50: 625b 2778 275d 203d 2078 0a20 2020 2020  b['x'] = x.     
+00049b60: 2020 2020 2020 2074 6162 5b27 7927 5d20         tab['y'] 
+00049b70: 3d20 790a 2020 2020 2020 2020 2020 2020  = y.            
+00049b80: 7461 625b 277a 275d 203d 207a 0a20 2020  tab['z'] = z.   
+00049b90: 2020 2020 2020 2020 2074 6162 5b27 7227           tab['r'
+00049ba0: 5d20 3d20 720a 2020 2020 2020 2020 2020  ] = r.          
+00049bb0: 2020 7265 7475 726e 2074 6162 0a20 2020    return tab.   
+00049bc0: 2020 2020 2065 6c73 653a 200a 2020 2020       else: .    
+00049bd0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+00049be0: 2c20 792c 207a 2c20 720a 0a0a 2020 2020  , y, z, r...    
+00049bf0: 6465 6620 6672 6f6d 5f66 6c74 2873 656c  def from_flt(sel
+00049c00: 662c 2066 6c74 5f66 696c 652c 202a 2a6b  f, flt_file, **k
+00049c10: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00049c20: 2222 220a 2020 2020 2020 2020 436f 6d70  """.        Comp
+00049c30: 7574 6520 706f 7369 7469 6f6e 7320 6174  ute positions at
+00049c40: 2065 7870 7374 6172 742c 2065 7870 6d69   expstart, expmi
+00049c50: 642c 2065 7870 656e 640a 2020 2020 2020  d, expend.      
+00049c60: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
+00049c70: 706f 7274 2061 7374 726f 7079 2e74 696d  port astropy.tim
+00049c80: 650a 2020 2020 2020 2020 0a20 2020 2020  e.        .     
+00049c90: 2020 2066 6c74 203d 2070 7966 6974 732e     flt = pyfits.
+00049ca0: 6f70 656e 2866 6c74 5f66 696c 6529 0a20  open(flt_file). 
+00049cb0: 2020 2020 2020 2065 7870 7374 6172 7420         expstart 
+00049cc0: 3d20 666c 745b 305d 2e68 6561 6465 725b  = flt[0].header[
+00049cd0: 2745 5850 5354 4152 5427 5d0a 2020 2020  'EXPSTART'].    
+00049ce0: 2020 2020 6578 7065 6e64 203d 2066 6c74      expend = flt
+00049cf0: 5b30 5d2e 6865 6164 6572 5b27 4558 5045  [0].header['EXPE
+00049d00: 4e44 275d 0a20 2020 2020 2020 2065 7870  ND'].        exp
+00049d10: 6d69 6420 3d20 2865 7870 7374 6172 742b  mid = (expstart+
+00049d20: 6578 7065 6e64 292f 322e 0a20 2020 2020  expend)/2..     
+00049d30: 2020 200a 2020 2020 2020 2020 745f 696e     .        t_in
+00049d40: 203d 2061 7374 726f 7079 2e74 696d 652e   = astropy.time.
+00049d50: 5469 6d65 285b 6578 7073 7461 7274 2c20  Time([expstart, 
+00049d60: 6578 706d 6964 2c20 6578 7065 6e64 5d2c  expmid, expend],
+00049d70: 2066 6f72 6d61 743d 276d 6a64 2729 0a20   format='mjd'). 
+00049d80: 2020 2020 2020 2066 6c74 2e63 6c6f 7365         flt.close
+00049d90: 2829 0a20 2020 2020 2020 200a 2020 2020  ().        .    
+00049da0: 2020 2020 7265 7475 726e 2073 656c 6628      return self(
+00049db0: 745f 696e 2c20 2a2a 6b77 6172 6773 290a  t_in, **kwargs).
+00049dc0: 0a0a 2020 2020 6465 6620 6465 6c74 6174  ..    def deltat
+00049dd0: 2873 656c 662c 2064 7429 3a0a 2020 2020  (self, dt):.    
+00049de0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00049df0: 436f 6e76 6572 7420 6120 7469 6d65 2060  Convert a time `
+00049e00: 6074 6060 2069 6e20 7365 636f 6e64 7320  `t`` in seconds 
+00049e10: 6672 6f6d 2031 2f31 2f38 3520 746f 2061  from 1/1/85 to a
+00049e20: 6e20 4953 4f20 7469 6d65 0a20 2020 2020  n ISO time.     
+00049e30: 2020 2022 2222 2020 2020 0a20 2020 2020     """    .     
+00049e40: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00049e50: 7228 6474 2c20 2775 6e69 7427 293a 0a20  r(dt, 'unit'):. 
+00049e60: 2020 2020 2020 2020 2020 2064 7473 6563             dtsec
+00049e70: 203d 2064 742a 752e 7365 636f 6e64 0a20   = dt*u.second. 
+00049e80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00049e90: 2020 2020 2020 2020 2064 7473 6563 203d           dtsec =
+00049ea0: 2064 740a 2020 2020 2020 2020 2020 2020   dt.            
+00049eb0: 0a20 2020 2020 2020 2074 203d 2073 656c  .        t = sel
+00049ec0: 662e 5f74 3139 3835 202b 2064 7473 6563  f._t1985 + dtsec
+00049ed0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00049ee0: 740a 0a0a 2020 2020 6465 6620 7061 7273  t...    def pars
+00049ef0: 655f 6672 6f6d 5f73 7074 2873 656c 662c  e_from_spt(self,
+00049f00: 2073 7074 5f66 696c 6529 3a0a 2020 2020   spt_file):.    
+00049f10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00049f20: 4765 7420 6f72 6269 7461 6c20 656c 656d  Get orbital elem
+00049f30: 656e 7473 2066 726f 6d20 5350 5420 6865  ents from SPT he
+00049f40: 6164 6572 0a20 2020 2020 2020 2022 2222  ader.        """
+00049f50: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00049f60: 6173 7472 6f70 792e 696f 2e66 6974 7320  astropy.io.fits 
+00049f70: 6173 2070 7966 6974 730a 2020 2020 2020  as pyfits.      
+00049f80: 2020 696d 706f 7274 2061 7374 726f 7079    import astropy
+00049f90: 2e74 696d 650a 2020 2020 2020 2020 0a20  .time.        . 
+00049fa0: 2020 2020 2020 2077 6974 6820 7079 6669         with pyfi
+00049fb0: 7473 2e6f 7065 6e28 7370 745f 6669 6c65  ts.open(spt_file
+00049fc0: 2920 6173 205f 696d 3a0a 2020 2020 2020  ) as _im:.      
+00049fd0: 2020 2020 2020 7370 7420 3d20 5f69 6d5b        spt = _im[
+00049fe0: 305d 2e68 6561 6465 722e 636f 7079 2829  0].header.copy()
+00049ff0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0004a000: 2020 7061 7261 6d5f 6469 6374 203d 207b    param_dict = {
+0004a010: 7d0a 2020 2020 2020 2020 7061 7261 6d5f  }.        param_
+0004a020: 6469 6374 5b27 7461 7527 5d20 3d20 7370  dict['tau'] = sp
+0004a030: 745b 2745 5043 4854 494d 4527 5d0a 2020  t['EPCHTIME'].  
+0004a040: 2020 2020 2020 7061 7261 6d5f 6469 6374        param_dict
+0004a050: 5b27 4d30 275d 203d 2073 7074 5b27 4d45  ['M0'] = spt['ME
+0004a060: 414e 414e 4f4d 275d 0a20 2020 2020 2020  ANANOM'].       
+0004a070: 2070 6172 616d 5f64 6963 745b 274d 2e27   param_dict['M.'
+0004a080: 5d20 3d20 7370 745b 2746 444d 4541 4e41  ] = spt['FDMEANA
+0004a090: 4e27 5d0a 2020 2020 2020 2020 7061 7261  N'].        para
+0004a0a0: 6d5f 6469 6374 5b27 4d2e 2e27 5d20 3d20  m_dict['M..'] = 
+0004a0b0: 7370 745b 2753 444d 4541 4e41 4e27 5d0a  spt['SDMEANAN'].
+0004a0c0: 2020 2020 2020 2020 7061 7261 6d5f 6469          param_di
+0004a0d0: 6374 5b27 6527 5d20 3d20 7370 745b 2745  ct['e'] = spt['E
+0004a0e0: 4343 454e 5452 5927 5d0a 2020 2020 2020  CCENTRY'].      
+0004a0f0: 2020 7061 7261 6d5f 6469 6374 5b27 6128    param_dict['a(
+0004a100: 312d 652a 2a32 2927 5d20 3d20 7370 745b  1-e**2)'] = spt[
+0004a110: 2753 454d 494c 5245 4327 5d0a 2020 2020  'SEMILREC'].    
+0004a120: 2020 2020 7061 7261 6d5f 6469 6374 5b27      param_dict['
+0004a130: 6127 5d20 3d20 7061 7261 6d5f 6469 6374  a'] = param_dict
+0004a140: 5b27 6128 312d 652a 2a32 2927 5d20 2f20  ['a(1-e**2)'] / 
+0004a150: 2831 2d70 6172 616d 5f64 6963 745b 2765  (1-param_dict['e
+0004a160: 275d 2a2a 3229 0a20 2020 2020 2020 2070  ']**2).        p
+0004a170: 6172 616d 5f64 6963 745b 274f 6d30 275d  aram_dict['Om0']
+0004a180: 203d 2073 7074 5b27 5241 5343 4153 434e   = spt['RASCASCN
+0004a190: 275d 0a20 2020 2020 2020 2070 6172 616d  '].        param
+0004a1a0: 5f64 6963 745b 274f 6d2e 275d 203d 2073  _dict['Om.'] = s
+0004a1b0: 7074 5b27 5243 4153 434e 5256 275d 0a20  pt['RCASCNRV']. 
+0004a1c0: 2020 2020 2020 2070 6172 616d 5f64 6963         param_dic
+0004a1d0: 745b 2777 3027 5d20 3d20 7370 745b 2741  t['w0'] = spt['A
+0004a1e0: 5247 5045 5249 4727 5d0a 2020 2020 2020  RGPERIG'].      
+0004a1f0: 2020 7061 7261 6d5f 6469 6374 5b27 772e    param_dict['w.
+0004a200: 275d 203d 2073 7074 5b27 5243 4152 4750  '] = spt['RCARGP
+0004a210: 4552 275d 0a20 2020 2020 2020 2070 6172  ER'].        par
+0004a220: 616d 5f64 6963 745b 2763 6f73 6927 5d20  am_dict['cosi'] 
+0004a230: 3d20 7370 745b 2743 4f53 494e 434c 4927  = spt['COSINCLI'
+0004a240: 5d0a 2020 2020 2020 2020 7061 7261 6d5f  ].        param_
+0004a250: 6469 6374 5b27 7369 6e69 275d 203d 2073  dict['sini'] = s
+0004a260: 7074 5b27 5349 4e45 494e 434c 275d 0a20  pt['SINEINCL']. 
+0004a270: 2020 2020 2020 2070 6172 616d 5f64 6963         param_dic
+0004a280: 745b 2756 6327 5d20 3d20 7370 745b 2743  t['Vc'] = spt['C
+0004a290: 4952 5645 4c4f 4327 5d0a 2020 2020 2020  IRVELOC'].      
+0004a2a0: 2020 7061 7261 6d5f 6469 6374 5b27 7469    param_dict['ti
+0004a2b0: 6d65 6666 6563 275d 203d 2073 7074 5b27  meffec'] = spt['
+0004a2c0: 5449 4d45 4646 4543 275d 0a20 2020 2020  TIMEFFEC'].     
+0004a2d0: 2020 2070 6172 616d 5f64 6963 745b 2754     param_dict['T
+0004a2e0: 6f72 6227 5d20 3d20 7370 745b 2748 5354  orb'] = spt['HST
+0004a2f0: 484f 5242 275d 2a32 0a20 2020 2020 2020  HORB']*2.       
+0004a300: 2070 6172 616d 5f64 6963 745b 2774 7374   param_dict['tst
+0004a310: 6172 7427 5d20 3d20 7370 745b 274f 4253  art'] = spt['OBS
+0004a320: 5354 5254 5427 5d0a 2020 2020 2020 2020  STRTT'].        
+0004a330: 0a20 2020 2020 2020 2070 6172 616d 5f64  .        param_d
+0004a340: 6963 745b 2774 6175 5f74 696d 6527 5d20  ict['tau_time'] 
+0004a350: 3d20 7365 6c66 2e64 656c 7461 7428 7061  = self.deltat(pa
+0004a360: 7261 6d5f 6469 6374 5b27 7461 7527 5d29  ram_dict['tau'])
+0004a370: 0a20 2020 2020 2020 2070 6172 616d 5f64  .        param_d
+0004a380: 6963 745b 2774 7374 6172 745f 7469 6d65  ict['tstart_time
+0004a390: 275d 203d 2073 656c 662e 6465 6c74 6174  '] = self.deltat
+0004a3a0: 2870 6172 616d 5f64 6963 745b 2774 7374  (param_dict['tst
+0004a3b0: 6172 7427 5d29 0a20 2020 2020 2020 2020  art']).         
+0004a3c0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0004a3d0: 7265 7475 726e 2070 6172 616d 5f64 6963  return param_dic
+0004a3e0: 740a 2020 2020 0a20 2020 2040 7374 6174  t.    .    @stat
+0004a3f0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+0004a400: 2078 797a 5f74 6f5f 6c6f 6e6c 6174 2873   xyz_to_lonlat(s
+0004a410: 656c 662c 2078 2c20 792c 207a 2c20 7261  elf, x, y, z, ra
+0004a420: 6469 616e 733d 4661 6c73 6529 3a0a 2020  dians=False):.  
+0004a430: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0004a440: 2020 436f 6d70 7574 6520 7375 626c 6f6e    Compute sublon
+0004a450: 2c20 7375 626c 6174 2c20 616c 7420 6672  , sublat, alt fr
+0004a460: 6f6d 2078 797a 2063 6f6f 7264 7320 7769  om xyz coords wi
+0004a470: 7468 2070 7970 726f 6a0a 2020 2020 2020  th pyproj.      
+0004a480: 2020 0a20 2020 2020 2020 2078 797a 206d    .        xyz m
+0004a490: 7573 7420 6265 2069 6e20 6d65 7465 7273  ust be in meters
+0004a4a0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0004a4b0: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
+0004a4c0: 706f 7274 2070 7970 726f 6a0a 2020 2020  port pyproj.    
+0004a4d0: 2020 2020 6563 6566 203d 2070 7970 726f      ecef = pypro
+0004a4e0: 6a2e 5072 6f6a 2870 726f 6a3d 2767 656f  j.Proj(proj='geo
+0004a4f0: 6365 6e74 272c 2065 6c6c 7073 3d27 5747  cent', ellps='WG
+0004a500: 5338 3427 2c20 6461 7475 6d3d 2757 4753  S84', datum='WGS
+0004a510: 3834 2729 0a20 2020 2020 2020 206c 6c61  84').        lla
+0004a520: 203d 2070 7970 726f 6a2e 5072 6f6a 2870   = pyproj.Proj(p
+0004a530: 726f 6a3d 276c 6174 6c6f 6e67 272c 2065  roj='latlong', e
+0004a540: 6c6c 7073 3d27 5747 5338 3427 2c20 6461  llps='WGS84', da
+0004a550: 7475 6d3d 2757 4753 3834 2729 0a20 2020  tum='WGS84').   
+0004a560: 2020 2020 206c 6f6e 2c20 6c61 742c 2061       lon, lat, a
+0004a570: 6c74 203d 2070 7970 726f 6a2e 7472 616e  lt = pyproj.tran
+0004a580: 7366 6f72 6d28 6563 6566 2c20 6c6c 612c  sform(ecef, lla,
+0004a590: 2078 2c20 792c 207a 2c20 7261 6469 616e   x, y, z, radian
+0004a5a0: 733d 7261 6469 616e 7329 0a20 2020 2020  s=radians).     
+0004a5b0: 2020 2072 6574 7572 6e20 6c6f 6e2c 206c     return lon, l
+0004a5c0: 6174 2c20 616c 740a 0a0a 6465 6620 7061  at, alt...def pa
+0004a5d0: 7463 685f 7068 6f74 7574 696c 7328 293a  tch_photutils():
+0004a5e0: 0a20 2020 2022 2222 0a20 2020 2050 6174  .    """.    Pat
+0004a5f0: 6368 2074 6f20 6669 7820 696e 636f 6e73  ch to fix incons
+0004a600: 6973 7465 6e63 7920 7769 7468 2064 7269  istency with dri
+0004a610: 7a7a 6c65 7061 633d 332e 322e 3120 616e  zzlepac=3.2.1 an
+0004a620: 6420 7068 6f74 7574 696c 733e 312e 302c  d photutils>1.0,
+0004a630: 2077 6865 7265 200a 2020 2020 5468 6520   where .    The 
+0004a640: 6c61 7474 6572 2069 7320 6e65 6564 6564  latter is needed
+0004a650: 2066 6f72 206a 7773 743d 312e 332e 320a   for jwst=1.3.2.
+0004a660: 2020 2020 2222 220a 2020 2020 696d 706f      """.    impo
+0004a670: 7274 206f 730a 0a20 2020 2074 7279 3a0a  rt os..    try:.
+0004a680: 2020 2020 2020 2020 696d 706f 7274 2064          import d
+0004a690: 7269 7a7a 6c65 7061 630a 2020 2020 6578  rizzlepac.    ex
+0004a6a0: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
+0004a6b0: 726f 723a 0a20 2020 200a 2020 2020 2020  ror:.    .      
+0004a6c0: 2020 696d 706f 7274 2070 686f 7475 7469    import photuti
+0004a6d0: 6c73 0a20 2020 2020 2020 2073 6974 655f  ls.        site_
+0004a6e0: 7061 636b 6167 6573 203d 206f 732e 7061  packages = os.pa
+0004a6f0: 7468 2e64 6972 6e61 6d65 2870 686f 7475  th.dirname(photu
+0004a700: 7469 6c73 2e5f 5f66 696c 655f 5f29 0a20  tils.__file__). 
+0004a710: 2020 2020 2020 2023 206d 616e 7561 6c20         # manual 
+0004a720: 6170 706c 7920 7061 7463 680a 2020 2020  apply patch.    
+0004a730: 2020 2020 7468 655f 6669 6c65 203d 2066      the_file = f
+0004a740: 277b 7369 7465 5f70 6163 6b61 6765 737d  '{site_packages}
+0004a750: 2f2e 2e2f 6472 697a 7a6c 6570 6163 2f68  /../drizzlepac/h
+0004a760: 6170 7574 696c 732f 616c 6967 6e5f 7574  aputils/align_ut
+0004a770: 696c 732e 7079 270a 2020 2020 2020 2020  ils.py'.        
+0004a780: 7769 7468 206f 7065 6e28 7468 655f 6669  with open(the_fi
+0004a790: 6c65 2c27 7227 2920 6173 2066 703a 0a20  le,'r') as fp:. 
+0004a7a0: 2020 2020 2020 2020 2020 206c 696e 6573             lines
+0004a7b0: 203d 2066 702e 7265 6164 6c69 6e65 7328   = fp.readlines(
+0004a7c0: 290a 2020 2020 0a20 2020 2020 2020 2070  ).    .        p
+0004a7d0: 7269 6e74 2873 6974 655f 7061 636b 6167  rint(site_packag
+0004a7e0: 6573 2c20 6c65 6e28 6c69 6e65 7329 290a  es, len(lines)).
+0004a7f0: 2020 2020 2020 2020 666f 7220 692c 206c          for i, l
+0004a800: 696e 6520 696e 2065 6e75 6d65 7261 7465  ine in enumerate
+0004a810: 286c 696e 6573 293a 0a20 2020 2020 2020  (lines):.       
+0004a820: 2020 2020 2069 6620 6c69 6e65 2e73 7461       if line.sta
+0004a830: 7274 7377 6974 6828 274e 6f44 6574 6563  rtswith('NoDetec
+0004a840: 7469 6f6e 7357 6172 6e69 6e67 2729 3a0a  tionsWarning'):.
+0004a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a860: 6272 6561 6b0a 2020 2020 0a20 2020 2020  break.    .     
+0004a870: 2020 2069 6620 2768 6173 6174 7472 2870     if 'hasattr(p
+0004a880: 686f 7475 7469 6c73 2e66 696e 6473 7461  hotutils.findsta
+0004a890: 7273 2720 696e 206c 696e 6573 5b69 2b31  rs' in lines[i+1
+0004a8a0: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
+0004a8b0: 7269 6e74 2866 2749 2066 6f75 6e64 2074  rint(f'I found t
+0004a8c0: 6865 2070 726f 626c 656d 206f 6e20 6c69  he problem on li
+0004a8d0: 6e65 7320 7b69 7d2d 7b69 2b32 7d3a 2027  nes {i}-{i+2}: '
+0004a8e0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0004a8f0: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+0004a900: 3d20 2222 220a 4c69 6e65 7320 7b30 7d2d  = """.Lines {0}-
+0004a910: 7b31 7d20 696e 207b 327d 2069 6d70 6f72  {1} in {2} impor
+0004a920: 7469 6e67 2070 686f 7475 7469 6c73 2077  ting photutils w
+0004a930: 6572 6520 6e6f 7420 6173 2065 7870 6563  ere not as expec
+0004a940: 7465 642e 2020 4920 666f 756e 6420 0a0a  ted.  I found ..
+0004a950: 7b33 7d0a 0a62 7574 2065 7870 6563 7465  {3}..but expecte
+0004a960: 6420 0a0a 2020 204e 6f44 6574 6563 7469  d ..   NoDetecti
+0004a970: 6f6e 7357 6172 6e69 6e67 203d 2070 686f  onsWarning = pho
+0004a980: 7475 7469 6c73 2e66 696e 6473 7461 7273  tutils.findstars
+0004a990: 2e4e 6f44 6574 6563 7469 6f6e 7357 6172  .NoDetectionsWar
+0004a9a0: 6e69 6e67 2069 6620 5c5c 0a20 2020 2020  ning if \\.     
+0004a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a9c0: 2020 2020 2020 6861 7361 7474 7228 7068        hasattr(ph
+0004a9d0: 6f74 7574 696c 732e 6669 6e64 7374 6172  otutils.findstar
+0004a9e0: 732c 2027 4e6f 4465 7465 6374 696f 6e73  s, 'NoDetections
+0004a9f0: 5761 726e 696e 6727 2920 656c 7365 205c  Warning') else \
+0004aa00: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+0004aa10: 2020 2020 2020 2020 2020 2020 2070 686f               pho
+0004aa20: 7475 7469 6c73 2e75 7469 6c73 2e4e 6f44  tutils.utils.NoD
+0004aa30: 6574 6563 7469 6f6e 7357 6172 6e69 6e67  etectionsWarning
+0004aa40: 0a0a 0a20 2020 2022 2222 2e66 6f72 6d61  ...    """.forma
+0004aa50: 7428 692c 2069 2b32 2c20 7468 655f 6669  t(i, i+2, the_fi
+0004aa60: 6c65 2c20 6c69 6e65 735b 693a 692b 335d  le, lines[i:i+3]
+0004aa70: 290a 2020 2020 2020 2020 0a20 2020 2020  ).        .     
+0004aa80: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0004aa90: 7565 4572 726f 7228 6d73 6729 0a20 2020  ueError(msg).   
+0004aaa0: 2020 2020 200a 2020 2020 2020 2020 6261       .        ba
+0004aab0: 6420 3d20 5b27 2020 2027 2b6c 696e 6573  d = ['   '+lines
+0004aac0: 2e70 6f70 2869 2b32 2d6a 2920 666f 7220  .pop(i+2-j) for 
+0004aad0: 6a20 696e 2072 616e 6765 2833 295d 0a20  j in range(3)]. 
+0004aae0: 2020 2020 2020 2070 7269 6e74 2827 272e         print(''.
+0004aaf0: 6a6f 696e 2862 6164 5b3a 3a2d 315d 2929  join(bad[::-1]))
+0004ab00: 0a0a 2020 2020 2020 2020 2320 496e 7365  ..        # Inse
+0004ab10: 7274 2074 6865 2066 6978 0a20 2020 2020  rt the fix.     
+0004ab20: 2020 206c 696e 6573 5b69 5d20 3d20 2766     lines[i] = 'f
+0004ab30: 726f 6d20 7068 6f74 7574 696c 732e 7574  rom photutils.ut
+0004ab40: 696c 732e 6578 6365 7074 696f 6e73 2069  ils.exceptions i
+0004ab50: 6d70 6f72 7420 4e6f 4465 7465 6374 696f  mport NoDetectio
+0004ab60: 6e73 5761 726e 696e 675c 6e5c 6e27 0a20  nsWarning\n\n'. 
+0004ab70: 2020 2020 2020 2023 2052 6577 7269 7465         # Rewrite
+0004ab80: 2074 6865 2066 6965 0a20 2020 2020 2020   the fie.       
+0004ab90: 2077 6974 6820 6f70 656e 2866 277b 7369   with open(f'{si
+0004aba0: 7465 5f70 6163 6b61 6765 737d 2f2e 2e2f  te_packages}/../
+0004abb0: 6472 697a 7a6c 6570 6163 2f68 6170 7574  drizzlepac/haput
+0004abc0: 696c 732f 616c 6967 6e5f 7574 696c 732e  ils/align_utils.
+0004abd0: 7079 272c 2777 2729 2061 7320 6670 3a0a  py','w') as fp:.
+0004abe0: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
+0004abf0: 7269 7465 6c69 6e65 7328 6c69 6e65 7329  ritelines(lines)
+0004ac00: 0a20 2020 200a 2020 2020 2020 2020 7072  .    .        pr
+0004ac10: 696e 7428 6627 5061 7463 6820 6170 706c  int(f'Patch appl
+0004ac20: 6965 6420 746f 207b 7468 655f 6669 6c65  ied to {the_file
+0004ac30: 7d21 2729 0a                             }!').
```

### Comparing `grizli-1.9/grizli/utils_c/disperse.c` & `grizli-1.9.1/grizli/utils_c/disperse.c`

 * *Files 22% similar despite different names*

```diff
@@ -1,27 +1,27 @@
-/* Generated by Cython 0.29.36 */
+/* Generated by Cython 3.0.0 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "define_macros": [
             [
                 "NPY_NO_DEPRECATED_API",
                 "NPY_1_7_API_VERSION"
             ]
         ],
         "depends": [
-            "/tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
-            "/tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
-            "/tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
-            "/tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h"
+            "/tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
+            "/tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
+            "/tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/core/include/numpy/ndarrayobject.h",
+            "/tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/core/include/numpy/ndarraytypes.h",
+            "/tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/core/include/numpy/ufuncobject.h"
         ],
         "include_dirs": [
-            "/tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/core/include"
+            "/tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/core/include"
         ],
         "libraries": [
             "m"
         ],
         "name": "grizli.utils_c.disperse",
         "sources": [
             "grizli/utils_c/disperse.pyx"
@@ -30,28 +30,40 @@
     "module_name": "grizli.utils_c.disperse"
 }
 END: Cython Metadata */
 
 #ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
 #endif /* PY_SSIZE_T_CLEAN */
+#if defined(CYTHON_LIMITED_API) && 0
+  #ifndef Py_LIMITED_API
+    #if CYTHON_LIMITED_API+0 > 0x03030000
+      #define Py_LIMITED_API CYTHON_LIMITED_API
+    #else
+      #define Py_LIMITED_API 0x03030000
+    #endif
+  #endif
+#endif
+
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
-#elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
-    #error Cython requires Python 2.6+ or Python 3.3+.
+#elif PY_VERSION_HEX < 0x02070000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
+    #error Cython requires Python 2.7+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_36"
-#define CYTHON_HEX_VERSION 0x001D24F0
+#define CYTHON_ABI "3_0_0"
+#define __PYX_ABI_MODULE_NAME "_cython_" CYTHON_ABI
+#define __PYX_TYPE_MODULE_PREFIX __PYX_ABI_MODULE_NAME "."
+#define CYTHON_HEX_VERSION 0x030000F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
-#if !defined(WIN32) && !defined(MS_WINDOWS)
+#if !defined(_WIN32) && !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
   #endif
   #ifndef __cdecl
     #define __cdecl
   #endif
   #ifndef __fastcall
@@ -62,31 +74,90 @@
   #define DL_IMPORT(t) t
 #endif
 #ifndef DL_EXPORT
   #define DL_EXPORT(t) t
 #endif
 #define __PYX_COMMA ,
 #ifndef HAVE_LONG_LONG
-  #if PY_VERSION_HEX >= 0x02070000
-    #define HAVE_LONG_LONG
-  #endif
+  #define HAVE_LONG_LONG
 #endif
 #ifndef PY_LONG_LONG
   #define PY_LONG_LONG LONG_LONG
 #endif
 #ifndef Py_HUGE_VAL
   #define Py_HUGE_VAL HUGE_VAL
 #endif
-#ifdef PYPY_VERSION
+#if defined(GRAALVM_PYTHON)
+  /* For very preliminary testing purposes. Most variables are set the same as PyPy.
+     The existence of this section does not imply that anything works or is even tested */
+  #define CYTHON_COMPILING_IN_PYPY 0
+  #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 1
+  #define CYTHON_COMPILING_IN_NOGIL 0
+  #undef CYTHON_USE_TYPE_SLOTS
+  #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 0
+  #undef CYTHON_USE_PYTYPE_LOOKUP
+  #define CYTHON_USE_PYTYPE_LOOKUP 0
+  #if PY_VERSION_HEX < 0x03050000
+    #undef CYTHON_USE_ASYNC_SLOTS
+    #define CYTHON_USE_ASYNC_SLOTS 0
+  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
+    #define CYTHON_USE_ASYNC_SLOTS 1
+  #endif
+  #undef CYTHON_USE_PYLIST_INTERNALS
+  #define CYTHON_USE_PYLIST_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_INTERNALS
+  #define CYTHON_USE_UNICODE_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_WRITER
+  #define CYTHON_USE_UNICODE_WRITER 0
+  #undef CYTHON_USE_PYLONG_INTERNALS
+  #define CYTHON_USE_PYLONG_INTERNALS 0
+  #undef CYTHON_AVOID_BORROWED_REFS
+  #define CYTHON_AVOID_BORROWED_REFS 1
+  #undef CYTHON_ASSUME_SAFE_MACROS
+  #define CYTHON_ASSUME_SAFE_MACROS 0
+  #undef CYTHON_UNPACK_METHODS
+  #define CYTHON_UNPACK_METHODS 0
+  #undef CYTHON_FAST_THREAD_STATE
+  #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
+  #undef CYTHON_FAST_PYCALL
+  #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
+  #endif
+  #undef CYTHON_PEP489_MULTI_PHASE_INIT
+  #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 0
+  #undef CYTHON_USE_TP_FINALIZE
+  #define CYTHON_USE_TP_FINALIZE 0
+  #undef CYTHON_USE_DICT_VERSIONS
+  #define CYTHON_USE_DICT_VERSIONS 0
+  #undef CYTHON_USE_EXC_INFO_STACK
+  #define CYTHON_USE_EXC_INFO_STACK 0
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
+  #endif
+#elif defined(PYPY_VERSION)
   #define CYTHON_COMPILING_IN_PYPY 1
-  #define CYTHON_COMPILING_IN_PYSTON 0
   #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #undef CYTHON_USE_TYPE_SLOTS
   #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 0
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
   #if PY_VERSION_HEX < 0x03050000
     #undef CYTHON_USE_ASYNC_SLOTS
     #define CYTHON_USE_ASYNC_SLOTS 0
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
@@ -103,80 +174,102 @@
   #define CYTHON_AVOID_BORROWED_REFS 1
   #undef CYTHON_ASSUME_SAFE_MACROS
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
+  #endif
   #if PY_VERSION_HEX < 0x03090000
     #undef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT 0
   #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
     #define CYTHON_PEP489_MULTI_PHASE_INIT 1
   #endif
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 0
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1 && PYPY_VERSION_NUM >= 0x07030C00)
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
-#elif defined(PYSTON_VERSION)
+#elif defined(CYTHON_LIMITED_API)
   #define CYTHON_COMPILING_IN_PYPY 0
-  #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 1
+  #define CYTHON_COMPILING_IN_GRAAL 0
   #define CYTHON_COMPILING_IN_NOGIL 0
-  #ifndef CYTHON_USE_TYPE_SLOTS
-    #define CYTHON_USE_TYPE_SLOTS 1
-  #endif
+  #undef CYTHON_CLINE_IN_TRACEBACK
+  #define CYTHON_CLINE_IN_TRACEBACK 0
+  #undef CYTHON_USE_TYPE_SLOTS
+  #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 1
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
   #undef CYTHON_USE_ASYNC_SLOTS
   #define CYTHON_USE_ASYNC_SLOTS 0
   #undef CYTHON_USE_PYLIST_INTERNALS
   #define CYTHON_USE_PYLIST_INTERNALS 0
-  #ifndef CYTHON_USE_UNICODE_INTERNALS
-    #define CYTHON_USE_UNICODE_INTERNALS 1
+  #undef CYTHON_USE_UNICODE_INTERNALS
+  #define CYTHON_USE_UNICODE_INTERNALS 0
+  #ifndef CYTHON_USE_UNICODE_WRITER
+    #define CYTHON_USE_UNICODE_WRITER 0
   #endif
-  #undef CYTHON_USE_UNICODE_WRITER
-  #define CYTHON_USE_UNICODE_WRITER 0
   #undef CYTHON_USE_PYLONG_INTERNALS
   #define CYTHON_USE_PYLONG_INTERNALS 0
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
   #endif
-  #ifndef CYTHON_ASSUME_SAFE_MACROS
-    #define CYTHON_ASSUME_SAFE_MACROS 1
-  #endif
-  #ifndef CYTHON_UNPACK_METHODS
-    #define CYTHON_UNPACK_METHODS 1
-  #endif
+  #undef CYTHON_ASSUME_SAFE_MACROS
+  #define CYTHON_ASSUME_SAFE_MACROS 0
+  #undef CYTHON_UNPACK_METHODS
+  #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS 1
+  #endif
   #undef CYTHON_PEP489_MULTI_PHASE_INIT
   #define CYTHON_PEP489_MULTI_PHASE_INIT 0
-  #undef CYTHON_USE_TP_FINALIZE
-  #define CYTHON_USE_TP_FINALIZE 0
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 1
+  #ifndef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 1
+  #endif
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
 #elif defined(PY_NOGIL)
   #define CYTHON_COMPILING_IN_PYPY 0
-  #define CYTHON_COMPILING_IN_PYSTON 0
   #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
   #define CYTHON_COMPILING_IN_NOGIL 1
   #ifndef CYTHON_USE_TYPE_SLOTS
     #define CYTHON_USE_TYPE_SLOTS 1
   #endif
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
   #ifndef CYTHON_USE_ASYNC_SLOTS
@@ -212,37 +305,35 @@
   #endif
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
 #else
   #define CYTHON_COMPILING_IN_PYPY 0
-  #define CYTHON_COMPILING_IN_PYSTON 0
   #define CYTHON_COMPILING_IN_CPYTHON 1
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
   #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
     #define CYTHON_USE_TYPE_SLOTS 1
   #endif
-  #if PY_VERSION_HEX < 0x02070000
-    #undef CYTHON_USE_PYTYPE_LOOKUP
-    #define CYTHON_USE_PYTYPE_LOOKUP 0
-  #elif !defined(CYTHON_USE_PYTYPE_LOOKUP)
+  #ifndef CYTHON_USE_TYPE_SPECS
+    #define CYTHON_USE_TYPE_SPECS 0
+  #endif
+  #ifndef CYTHON_USE_PYTYPE_LOOKUP
     #define CYTHON_USE_PYTYPE_LOOKUP 1
   #endif
   #if PY_MAJOR_VERSION < 3
     #undef CYTHON_USE_ASYNC_SLOTS
     #define CYTHON_USE_ASYNC_SLOTS 0
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
-  #if PY_VERSION_HEX < 0x02070000
-    #undef CYTHON_USE_PYLONG_INTERNALS
-    #define CYTHON_USE_PYLONG_INTERNALS 0
-  #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
+  #ifndef CYTHON_USE_PYLONG_INTERNALS
+    #define CYTHON_USE_PYLONG_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -257,45 +348,67 @@
   #endif
   #ifndef CYTHON_ASSUME_SAFE_MACROS
     #define CYTHON_ASSUME_SAFE_MACROS 1
   #endif
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
-  #if PY_VERSION_HEX >= 0x030B00A4
-    #undef CYTHON_FAST_THREAD_STATE
-    #define CYTHON_FAST_THREAD_STATE 0
-  #elif !defined(CYTHON_FAST_THREAD_STATE)
+  #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
+  #ifndef CYTHON_FAST_GIL
+    #define CYTHON_FAST_GIL (PY_MAJOR_VERSION < 3 || PY_VERSION_HEX >= 0x03060000 && PY_VERSION_HEX < 0x030C00A6)
+  #endif
+  #ifndef CYTHON_METH_FASTCALL
+    #define CYTHON_METH_FASTCALL (PY_VERSION_HEX >= 0x030700A1)
+  #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030A0000)
+    #define CYTHON_FAST_PYCALL 1
   #endif
-  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
-    #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS 1
   #endif
-  #ifndef CYTHON_USE_TP_FINALIZE
-    #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
+  #if PY_VERSION_HEX < 0x03050000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
+  #ifndef CYTHON_USE_MODULE_STATE
+    #define CYTHON_USE_MODULE_STATE 0
+  #endif
+  #if PY_VERSION_HEX < 0x030400a1
+    #undef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 0
+  #elif !defined(CYTHON_USE_TP_FINALIZE)
+    #define CYTHON_USE_TP_FINALIZE 1
   #endif
-  #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
+  #if PY_VERSION_HEX < 0x030600B1
+    #undef CYTHON_USE_DICT_VERSIONS
+    #define CYTHON_USE_DICT_VERSIONS 0
+  #elif !defined(CYTHON_USE_DICT_VERSIONS)
+    #define CYTHON_USE_DICT_VERSIONS  (PY_VERSION_HEX < 0x030C00A5)
   #endif
-  #if PY_VERSION_HEX >= 0x030B00A4
+  #if PY_VERSION_HEX < 0x030700A3
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
-    #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
+    #define CYTHON_USE_EXC_INFO_STACK 1
   #endif
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 1
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
+#if !defined(CYTHON_VECTORCALL)
+#define CYTHON_VECTORCALL  (CYTHON_FAST_PYCCALL && PY_VERSION_HEX >= 0x030800B1)
+#endif
+#define CYTHON_BACKPORT_VECTORCALL (CYTHON_METH_FASTCALL && PY_VERSION_HEX < 0x030800B1)
 #if CYTHON_USE_PYLONG_INTERNALS
   #if PY_MAJOR_VERSION < 3
     #include "longintrepr.h"
   #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
@@ -317,78 +430,128 @@
   #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_RESTRICT restrict
   #else
     #define CYTHON_RESTRICT
   #endif
 #endif
 #ifndef CYTHON_UNUSED
+  #if defined(__cplusplus)
+    /* for clang __has_cpp_attribute(maybe_unused) is true even before C++17
+     * but leads to warnings with -pedantic, since it is a C++17 feature */
+    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
+      #if __has_cpp_attribute(maybe_unused)
+        #define CYTHON_UNUSED [[maybe_unused]]
+      #endif
+    #endif
+  #endif
+#endif
+#ifndef CYTHON_UNUSED
 # if defined(__GNUC__)
 #   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
 #     define CYTHON_UNUSED __attribute__ ((__unused__))
 #   else
 #     define CYTHON_UNUSED
 #   endif
 # elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
 #   define CYTHON_UNUSED __attribute__ ((__unused__))
 # else
 #   define CYTHON_UNUSED
 # endif
 #endif
-#ifndef CYTHON_MAYBE_UNUSED_VAR
+#ifndef CYTHON_UNUSED_VAR
 #  if defined(__cplusplus)
-     template<class T> void CYTHON_MAYBE_UNUSED_VAR( const T& ) { }
+     template<class T> void CYTHON_UNUSED_VAR( const T& ) { }
 #  else
-#    define CYTHON_MAYBE_UNUSED_VAR(x) (void)(x)
+#    define CYTHON_UNUSED_VAR(x) (void)(x)
 #  endif
 #endif
+#ifndef CYTHON_MAYBE_UNUSED_VAR
+  #define CYTHON_MAYBE_UNUSED_VAR(x) CYTHON_UNUSED_VAR(x)
+#endif
 #ifndef CYTHON_NCP_UNUSED
 # if CYTHON_COMPILING_IN_CPYTHON
 #  define CYTHON_NCP_UNUSED
 # else
 #  define CYTHON_NCP_UNUSED CYTHON_UNUSED
 # endif
 #endif
 #define __Pyx_void_to_None(void_result) ((void)(void_result), Py_INCREF(Py_None), Py_None)
 #ifdef _MSC_VER
     #ifndef _MSC_STDINT_H_
         #if _MSC_VER < 1300
-           typedef unsigned char     uint8_t;
-           typedef unsigned int      uint32_t;
+            typedef unsigned char     uint8_t;
+            typedef unsigned short    uint16_t;
+            typedef unsigned int      uint32_t;
         #else
-           typedef unsigned __int8   uint8_t;
-           typedef unsigned __int32  uint32_t;
+            typedef unsigned __int8   uint8_t;
+            typedef unsigned __int16  uint16_t;
+            typedef unsigned __int32  uint32_t;
+        #endif
+    #endif
+    #if _MSC_VER < 1300
+        #ifdef _WIN64
+            typedef unsigned long long  __pyx_uintptr_t;
+        #else
+            typedef unsigned int        __pyx_uintptr_t;
+        #endif
+    #else
+        #ifdef _WIN64
+            typedef unsigned __int64    __pyx_uintptr_t;
+        #else
+            typedef unsigned __int32    __pyx_uintptr_t;
         #endif
     #endif
 #else
-   #include <stdint.h>
+    #include <stdint.h>
+    typedef uintptr_t  __pyx_uintptr_t;
 #endif
 #ifndef CYTHON_FALLTHROUGH
-  #if defined(__cplusplus) && __cplusplus >= 201103L
-    #if __has_cpp_attribute(fallthrough)
-      #define CYTHON_FALLTHROUGH [[fallthrough]]
-    #elif __has_cpp_attribute(clang::fallthrough)
-      #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
-    #elif __has_cpp_attribute(gnu::fallthrough)
-      #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
+  #if defined(__cplusplus)
+    /* for clang __has_cpp_attribute(fallthrough) is true even before C++17
+     * but leads to warnings with -pedantic, since it is a C++17 feature */
+    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
+      #if __has_cpp_attribute(fallthrough)
+        #define CYTHON_FALLTHROUGH [[fallthrough]]
+      #endif
+    #endif
+    #ifndef CYTHON_FALLTHROUGH
+      #if __has_cpp_attribute(clang::fallthrough)
+        #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
+      #elif __has_cpp_attribute(gnu::fallthrough)
+        #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
+      #endif
     #endif
   #endif
   #ifndef CYTHON_FALLTHROUGH
     #if __has_attribute(fallthrough)
       #define CYTHON_FALLTHROUGH __attribute__((fallthrough))
     #else
       #define CYTHON_FALLTHROUGH
     #endif
   #endif
-  #if defined(__clang__ ) && defined(__apple_build_version__)
+  #if defined(__clang__) && defined(__apple_build_version__)
     #if __apple_build_version__ < 7000000
       #undef  CYTHON_FALLTHROUGH
       #define CYTHON_FALLTHROUGH
     #endif
   #endif
 #endif
+#ifdef __cplusplus
+  template <typename T>
+  struct __PYX_IS_UNSIGNED_IMPL {static const bool value = T(0) < T(-1);};
+  #define __PYX_IS_UNSIGNED(type) (__PYX_IS_UNSIGNED_IMPL<type>::value)
+#else
+  #define __PYX_IS_UNSIGNED(type) (((type)-1) > 0)
+#endif
+#if CYTHON_COMPILING_IN_PYPY == 1
+  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x030A0000)
+#else
+  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000)
+#endif
+#define __PYX_REINTERPRET_FUNCION(func_pointer, other_pointer) ((func_pointer)(void(*)(void))(other_pointer))
 
 #ifndef CYTHON_INLINE
   #if defined(__clang__)
     #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
   #elif defined(__GNUC__)
     #define CYTHON_INLINE __inline__
   #elif defined(_MSC_VER)
@@ -400,36 +563,36 @@
   #endif
 #endif
 
 #define __PYX_BUILD_PY_SSIZE_T "n"
 #define CYTHON_FORMAT_SSIZE_T "z"
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
   #define __Pyx_DefaultClassType PyType_Type
 #if PY_VERSION_HEX >= 0x030B00A1
-    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int p, int k, int l, int s, int f,
                                                     PyObject *code, PyObject *c, PyObject* n, PyObject *v,
                                                     PyObject *fv, PyObject *cell, PyObject* fn,
                                                     PyObject *name, int fline, PyObject *lnos) {
         PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
-        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *empty=NULL;
         const char *fn_cstr=NULL;
         const char *name_cstr=NULL;
-        PyCodeObject* co=NULL;
+        PyCodeObject *co=NULL, *result=NULL;
         PyObject *type, *value, *traceback;
         PyErr_Fetch(&type, &value, &traceback);
         if (!(kwds=PyDict_New())) goto end;
         if (!(argcount=PyLong_FromLong(a))) goto end;
         if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
-        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(p))) goto end;
         if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
         if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
         if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
         if (!(nlocals=PyLong_FromLong(l))) goto end;
         if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
         if (!(stacksize=PyLong_FromLong(s))) goto end;
         if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
@@ -441,109 +604,180 @@
         if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
         if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
         if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
         if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
         if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
         if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
         if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
-        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
-        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
-        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
-        Py_XDECREF((PyObject*)co);
-        co = (PyCodeObject*)call_result;
-        call_result = NULL;
-        if (0) {
-            cleanup_code_too:
-            Py_XDECREF((PyObject*)co);
-            co = NULL;
-        }
-        end:
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto end;
+        if (!(empty = PyTuple_New(0))) goto end;
+        result = (PyCodeObject*) PyObject_Call(replace, empty, kwds);
+    end:
+        Py_XDECREF((PyObject*) co);
         Py_XDECREF(kwds);
         Py_XDECREF(argcount);
         Py_XDECREF(posonlyargcount);
         Py_XDECREF(kwonlyargcount);
         Py_XDECREF(nlocals);
         Py_XDECREF(stacksize);
         Py_XDECREF(replace);
-        Py_XDECREF(call_result);
         Py_XDECREF(empty);
         if (type) {
             PyErr_Restore(type, value, traceback);
         }
-        return co;
+        return result;
     }
+#elif PY_VERSION_HEX >= 0x030800B2 && !CYTHON_COMPILING_IN_PYPY
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+          PyCode_NewWithPosOnlyArgs(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #else
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
-  #define __Pyx_DefaultClassType PyType_Type
 #endif
+#if PY_VERSION_HEX >= 0x030900A4 || defined(Py_IS_TYPE)
+  #define __Pyx_IS_TYPE(ob, type) Py_IS_TYPE(ob, type)
+#else
+  #define __Pyx_IS_TYPE(ob, type) (((const PyObject*)ob)->ob_type == (type))
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_Is)
+  #define __Pyx_Py_Is(x, y)  Py_Is(x, y)
+#else
+  #define __Pyx_Py_Is(x, y) ((x) == (y))
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsNone)
+  #define __Pyx_Py_IsNone(ob) Py_IsNone(ob)
+#else
+  #define __Pyx_Py_IsNone(ob) __Pyx_Py_Is((ob), Py_None)
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsTrue)
+  #define __Pyx_Py_IsTrue(ob) Py_IsTrue(ob)
+#else
+  #define __Pyx_Py_IsTrue(ob) __Pyx_Py_Is((ob), Py_True)
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsFalse)
+  #define __Pyx_Py_IsFalse(ob) Py_IsFalse(ob)
+#else
+  #define __Pyx_Py_IsFalse(ob) __Pyx_Py_Is((ob), Py_False)
+#endif
+#define __Pyx_NoneAsNull(obj)  (__Pyx_Py_IsNone(obj) ? NULL : (obj))
 #if PY_VERSION_HEX >= 0x030900F0 && !CYTHON_COMPILING_IN_PYPY
   #define __Pyx_PyObject_GC_IsFinalized(o) PyObject_GC_IsFinalized(o)
 #else
   #define __Pyx_PyObject_GC_IsFinalized(o) _PyGC_FINALIZED(o)
 #endif
+#ifndef CO_COROUTINE
+  #define CO_COROUTINE 0x80
+#endif
+#ifndef CO_ASYNC_GENERATOR
+  #define CO_ASYNC_GENERATOR 0x200
+#endif
 #ifndef Py_TPFLAGS_CHECKTYPES
   #define Py_TPFLAGS_CHECKTYPES 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_INDEX
   #define Py_TPFLAGS_HAVE_INDEX 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_NEWBUFFER
   #define Py_TPFLAGS_HAVE_NEWBUFFER 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_FINALIZE
   #define Py_TPFLAGS_HAVE_FINALIZE 0
 #endif
+#ifndef Py_TPFLAGS_SEQUENCE
+  #define Py_TPFLAGS_SEQUENCE 0
+#endif
+#ifndef Py_TPFLAGS_MAPPING
+  #define Py_TPFLAGS_MAPPING 0
+#endif
 #ifndef METH_STACKLESS
   #define METH_STACKLESS 0
 #endif
 #if PY_VERSION_HEX <= 0x030700A3 || !defined(METH_FASTCALL)
   #ifndef METH_FASTCALL
      #define METH_FASTCALL 0x80
   #endif
   typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject *const *args, Py_ssize_t nargs);
   typedef PyObject *(*__Pyx_PyCFunctionFastWithKeywords) (PyObject *self, PyObject *const *args,
                                                           Py_ssize_t nargs, PyObject *kwnames);
 #else
   #define __Pyx_PyCFunctionFast _PyCFunctionFast
   #define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
 #endif
-#if CYTHON_FAST_PYCCALL
-#define __Pyx_PyFastCFunction_Check(func)\
-    ((PyCFunction_Check(func) && (METH_FASTCALL == (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)))))
+#if CYTHON_METH_FASTCALL
+  #define __Pyx_METH_FASTCALL METH_FASTCALL
+  #define __Pyx_PyCFunction_FastCall __Pyx_PyCFunctionFast
+  #define __Pyx_PyCFunction_FastCallWithKeywords __Pyx_PyCFunctionFastWithKeywords
+#else
+  #define __Pyx_METH_FASTCALL METH_VARARGS
+  #define __Pyx_PyCFunction_FastCall PyCFunction
+  #define __Pyx_PyCFunction_FastCallWithKeywords PyCFunctionWithKeywords
+#endif
+#if CYTHON_VECTORCALL
+  #define __pyx_vectorcallfunc vectorcallfunc
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  PY_VECTORCALL_ARGUMENTS_OFFSET
+  #define __Pyx_PyVectorcall_NARGS(n)  PyVectorcall_NARGS((size_t)(n))
+#elif CYTHON_BACKPORT_VECTORCALL
+  typedef PyObject *(*__pyx_vectorcallfunc)(PyObject *callable, PyObject *const *args,
+                                            size_t nargsf, PyObject *kwnames);
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  ((size_t)1 << (8 * sizeof(size_t) - 1))
+  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(((size_t)(n)) & ~__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET))
+#else
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  0
+  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(n))
+#endif
+#if PY_VERSION_HEX < 0x030900B1
+  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  ((void)m, PyType_FromSpecWithBases(s, b))
+  typedef PyObject *(*__Pyx_PyCMethod)(PyObject *, PyTypeObject *, PyObject *const *, size_t, PyObject *);
 #else
-#define __Pyx_PyFastCFunction_Check(func) 0
+  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  PyType_FromModuleAndSpec(m, s, b)
+  #define __Pyx_PyCMethod  PyCMethod
+#endif
+#ifndef METH_METHOD
+  #define METH_METHOD 0x200
 #endif
 #if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Malloc)
   #define PyObject_Malloc(s)   PyMem_Malloc(s)
   #define PyObject_Free(p)     PyMem_Free(p)
   #define PyObject_Realloc(p)  PyMem_Realloc(p)
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030400A1
-  #define PyMem_RawMalloc(n)           PyMem_Malloc(n)
-  #define PyMem_RawRealloc(p, n)       PyMem_Realloc(p, n)
-  #define PyMem_RawFree(p)             PyMem_Free(p)
-#endif
-#if CYTHON_COMPILING_IN_PYSTON
-  #define __Pyx_PyCode_HasFreeVars(co)  PyCode_HasFreeVars(co)
-  #define __Pyx_PyFrame_SetLineNumber(frame, lineno) PyFrame_SetLineNumber(frame, lineno)
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
+  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)
 #else
   #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
   #define __Pyx_PyFrame_SetLineNumber(frame, lineno)  (frame)->f_lineno = (lineno)
 #endif
-#if !CYTHON_FAST_THREAD_STATE || PY_VERSION_HEX < 0x02070000
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyThreadState_Current PyThreadState_Get()
+#elif !CYTHON_FAST_THREAD_STATE
   #define __Pyx_PyThreadState_Current PyThreadState_GET()
 #elif PY_VERSION_HEX >= 0x03060000
   #define __Pyx_PyThreadState_Current _PyThreadState_UncheckedGet()
 #elif PY_VERSION_HEX >= 0x03000000
   #define __Pyx_PyThreadState_Current PyThreadState_GET()
 #else
   #define __Pyx_PyThreadState_Current _PyThreadState_Current
 #endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_INLINE void *__Pyx_PyModule_GetState(PyObject *op)
+{
+    void *result;
+    result = PyModule_GetState(op);
+    if (!result)
+        Py_FatalError("Couldn't find the module state");
+    return result;
+}
+#endif
+#define __Pyx_PyObject_GetSlot(obj, name, func_ctype)  __Pyx_PyType_GetSlot(Py_TYPE(obj), name, func_ctype)
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((func_ctype) PyType_GetSlot((type), Py_##name))
+#else
+  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((type)->name)
+#endif
 #if PY_VERSION_HEX < 0x030700A2 && !defined(PyThread_tss_create) && !defined(Py_tss_NEEDS_INIT)
 #include "pythread.h"
 #define Py_tss_NEEDS_INIT 0
 typedef int Py_tss_t;
 static CYTHON_INLINE int PyThread_tss_create(Py_tss_t *key) {
   *key = PyThread_create_key();
   return 0;
@@ -566,46 +800,120 @@
 static CYTHON_INLINE int PyThread_tss_set(Py_tss_t *key, void *value) {
   return PyThread_set_key_value(*key, value);
 }
 static CYTHON_INLINE void * PyThread_tss_get(Py_tss_t *key) {
   return PyThread_get_key_value(*key);
 }
 #endif
+#if PY_MAJOR_VERSION < 3
+    #if CYTHON_COMPILING_IN_PYPY
+        #if PYPY_VERSION_NUM < 0x07030600
+            #if defined(__cplusplus) && __cplusplus >= 201402L
+                [[deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")]]
+            #elif defined(__GNUC__) || defined(__clang__)
+                __attribute__ ((__deprecated__("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")))
+            #elif defined(_MSC_VER)
+                __declspec(deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6"))
+            #endif
+            static CYTHON_INLINE int PyGILState_Check(void) {
+                return 0;
+            }
+        #else  // PYPY_VERSION_NUM < 0x07030600
+        #endif  // PYPY_VERSION_NUM < 0x07030600
+    #else
+        static CYTHON_INLINE int PyGILState_Check(void) {
+            PyThreadState * tstate = _PyThreadState_Current;
+            return tstate && (tstate == PyGILState_GetThisThreadState());
+        }
+    #endif
+#endif
 #if CYTHON_COMPILING_IN_CPYTHON || defined(_PyDict_NewPresized)
 #define __Pyx_PyDict_NewPresized(n)  ((n <= 8) ? PyDict_New() : _PyDict_NewPresized(n))
 #else
 #define __Pyx_PyDict_NewPresized(n)  PyDict_New()
 #endif
 #if PY_MAJOR_VERSION >= 3 || CYTHON_FUTURE_DIVISION
   #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
   #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
 #else
   #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
   #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
-#define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX > 0x030600B4 && CYTHON_USE_UNICODE_INTERNALS
+#define __Pyx_PyDict_GetItemStrWithError(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
+static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStr(PyObject *dict, PyObject *name) {
+    PyObject *res = __Pyx_PyDict_GetItemStrWithError(dict, name);
+    if (res == NULL) PyErr_Clear();
+    return res;
+}
+#elif PY_MAJOR_VERSION >= 3 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07020000)
+#define __Pyx_PyDict_GetItemStrWithError  PyDict_GetItemWithError
+#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
+#else
+static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStrWithError(PyObject *dict, PyObject *name) {
+#if CYTHON_COMPILING_IN_PYPY
+    return PyDict_GetItem(dict, name);
 #else
-#define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
+    PyDictEntry *ep;
+    PyDictObject *mp = (PyDictObject*) dict;
+    long hash = ((PyStringObject *) name)->ob_shash;
+    assert(hash != -1);
+    ep = (mp->ma_lookup)(mp, name, hash);
+    if (ep == NULL) {
+        return NULL;
+    }
+    return ep->me_value;
 #endif
-#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
+}
+#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
+#endif
+#if CYTHON_USE_TYPE_SLOTS
+  #define __Pyx_PyType_GetFlags(tp)   (((PyTypeObject *)tp)->tp_flags)
+  #define __Pyx_PyType_HasFeature(type, feature)  ((__Pyx_PyType_GetFlags(type) & (feature)) != 0)
+  #define __Pyx_PyObject_GetIterNextFunc(obj)  (Py_TYPE(obj)->tp_iternext)
+#else
+  #define __Pyx_PyType_GetFlags(tp)   (PyType_GetFlags((PyTypeObject *)tp))
+  #define __Pyx_PyType_HasFeature(type, feature)  PyType_HasFeature(type, feature)
+  #define __Pyx_PyObject_GetIterNextFunc(obj)  PyIter_Next
+#endif
+#if CYTHON_USE_TYPE_SPECS && PY_VERSION_HEX >= 0x03080000
+#define __Pyx_PyHeapTypeObject_GC_Del(obj)  {\
+    PyTypeObject *type = Py_TYPE(obj);\
+    assert(__Pyx_PyType_HasFeature(type, Py_TPFLAGS_HEAPTYPE));\
+    PyObject_GC_Del(obj);\
+    Py_DECREF(type);\
+}
+#else
+#define __Pyx_PyHeapTypeObject_GC_Del(obj)  PyObject_GC_Del(obj)
+#endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define CYTHON_PEP393_ENABLED 1
+  #define __Pyx_PyUnicode_READY(op)       (0)
+  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GetLength(u)
+  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_ReadChar(u, i)
+  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((void)u, 1114111U)
+  #define __Pyx_PyUnicode_KIND(u)         ((void)u, (0))
+  #define __Pyx_PyUnicode_DATA(u)         ((void*)u)
+  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)k, PyUnicode_ReadChar((PyObject*)(d), i))
+  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GetLength(u))
+#elif PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
   #if PY_VERSION_HEX >= 0x030C0000
     #define __Pyx_PyUnicode_READY(op)       (0)
   #else
     #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
                                                 0 : _PyUnicode_Ready((PyObject *)(op)))
   #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
-  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
+  #define __Pyx_PyUnicode_KIND(u)         ((int)PyUnicode_KIND(u))
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
-  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
+  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, (Py_UCS4) ch)
   #if PY_VERSION_HEX >= 0x030C0000
     #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
     #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
     #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
     #else
     #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
@@ -615,37 +923,43 @@
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
-  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535 : 1114111)
-  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
+  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535U : 1114111U)
+  #define __Pyx_PyUnicode_KIND(u)         ((int)sizeof(Py_UNICODE))
   #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
   #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
-  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = ch)
+  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = (Py_UNICODE) ch)
   #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_SIZE(u))
 #endif
 #if CYTHON_COMPILING_IN_PYPY
   #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
   #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
 #else
   #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
   #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ?\
       PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
 #endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyUnicode_Contains)
-  #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
-#endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyByteArray_Check)
-  #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
-#endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Format)
-  #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
+#if CYTHON_COMPILING_IN_PYPY
+  #if !defined(PyUnicode_DecodeUnicodeEscape)
+    #define PyUnicode_DecodeUnicodeEscape(s, size, errors)  PyUnicode_Decode(s, size, "unicode_escape", errors)
+  #endif
+  #if !defined(PyUnicode_Contains) || (PY_MAJOR_VERSION == 2 && PYPY_VERSION_NUM < 0x07030500)
+    #undef PyUnicode_Contains
+    #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
+  #endif
+  #if !defined(PyByteArray_Check)
+    #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
+  #endif
+  #if !defined(PyObject_Format)
+    #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
+  #endif
 #endif
 #define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None || (PyString_Check(b) && !PyString_CheckExact(b)))) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
 #define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None || (PyUnicode_Check(b) && !PyUnicode_CheckExact(b)))) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
 #else
   #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
@@ -666,16 +980,22 @@
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
   #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
 #else
   #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
   #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
 #endif
+#if CYTHON_COMPILING_IN_CPYTHON
+  #define __Pyx_PySequence_ListKeepNew(obj)\
+    (likely(PyList_CheckExact(obj) && Py_REFCNT(obj) == 1) ? __Pyx_NewRef(obj) : PySequence_List(obj))
+#else
+  #define __Pyx_PySequence_ListKeepNew(obj)  PySequence_List(obj)
+#endif
 #ifndef PySet_CheckExact
-  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
+  #define PySet_CheckExact(obj)        __Pyx_IS_TYPE(obj, &PySet_Type)
 #endif
 #if PY_VERSION_HEX >= 0x030900A4
   #define __Pyx_SET_REFCNT(obj, refcnt) Py_SET_REFCNT(obj, refcnt)
   #define __Pyx_SET_SIZE(obj, size) Py_SET_SIZE(obj, size)
 #else
   #define __Pyx_SET_REFCNT(obj, refcnt) Py_REFCNT(obj) = (refcnt)
   #define __Pyx_SET_SIZE(obj, size) Py_SIZE(obj) = (size)
@@ -686,25 +1006,30 @@
   #define __Pyx_PySequence_SIZE(seq)  PySequence_Size(seq)
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define PyIntObject                  PyLongObject
   #define PyInt_Type                   PyLong_Type
   #define PyInt_Check(op)              PyLong_Check(op)
   #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
+  #define __Pyx_Py3Int_Check(op)       PyLong_Check(op)
+  #define __Pyx_Py3Int_CheckExact(op)  PyLong_CheckExact(op)
   #define PyInt_FromString             PyLong_FromString
   #define PyInt_FromUnicode            PyLong_FromUnicode
   #define PyInt_FromLong               PyLong_FromLong
   #define PyInt_FromSize_t             PyLong_FromSize_t
   #define PyInt_FromSsize_t            PyLong_FromSsize_t
   #define PyInt_AsLong                 PyLong_AsLong
   #define PyInt_AS_LONG                PyLong_AS_LONG
   #define PyInt_AsSsize_t              PyLong_AsSsize_t
   #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
   #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
   #define PyNumber_Int                 PyNumber_Long
+#else
+  #define __Pyx_Py3Int_Check(op)       (PyLong_Check(op) || PyInt_Check(op))
+  #define __Pyx_Py3Int_CheckExact(op)  (PyLong_CheckExact(op) || PyInt_CheckExact(op))
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define PyBoolObject                 PyLongObject
 #endif
 #if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
@@ -714,19 +1039,14 @@
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
   #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
   #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
-#if PY_MAJOR_VERSION >= 3
-  #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
-#else
-  #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
-#endif
 #if CYTHON_USE_ASYNC_SLOTS
   #if PY_VERSION_HEX >= 0x030500B1
     #define __Pyx_PyAsyncMethodsStruct PyAsyncMethods
     #define __Pyx_PyType_AsAsync(obj) (Py_TYPE(obj)->tp_as_async)
   #else
     #define __Pyx_PyType_AsAsync(obj) ((__Pyx_PyAsyncMethodsStruct*) (Py_TYPE(obj)->tp_reserved))
   #endif
@@ -763,35 +1083,44 @@
 #endif
 
 #define __PYX_MARK_ERR_POS(f_index, lineno) \
     { __pyx_filename = __pyx_f[f_index]; (void)__pyx_filename; __pyx_lineno = lineno; (void)__pyx_lineno; __pyx_clineno = __LINE__; (void)__pyx_clineno; }
 #define __PYX_ERR(f_index, lineno, Ln_error) \
     { __PYX_MARK_ERR_POS(f_index, lineno) goto Ln_error; }
 
-#ifndef __PYX_EXTERN_C
+#ifdef CYTHON_EXTERN_C
+    #undef __PYX_EXTERN_C
+    #define __PYX_EXTERN_C CYTHON_EXTERN_C
+#elif defined(__PYX_EXTERN_C)
+    #ifdef _MSC_VER
+    #pragma message ("Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.")
+    #else
+    #warning Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.
+    #endif
+#else
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
 #define __PYX_HAVE__grizli__utils_c__disperse
 #define __PYX_HAVE_API__grizli__utils_c__disperse
 /* Early includes */
 #include <string.h>
 #include <stdio.h>
+
+    /* Using NumPy API declarations from "numpy/__init__.cython-30.pxd" */
+    
 #include "numpy/arrayobject.h"
 #include "numpy/ndarrayobject.h"
 #include "numpy/ndarraytypes.h"
 #include "numpy/arrayscalars.h"
 #include "numpy/ufuncobject.h"
-
-    /* NumPy API declarations from "numpy/__init__.pxd" */
-    
 #include "math.h"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
@@ -853,29 +1182,40 @@
 #endif
 #define __Pyx_PyBytes_AsWritableString(s)     ((char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsWritableSString(s)    ((signed char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsWritableUString(s)    ((unsigned char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsString(s)     ((const char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsSString(s)    ((const signed char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsUString(s)    ((const unsigned char*) PyBytes_AS_STRING(s))
-#define __Pyx_PyObject_AsWritableString(s)    ((char*) __Pyx_PyObject_AsString(s))
-#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
-#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableString(s)    ((char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_AsSString(s)    ((const signed char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_AsUString(s)    ((const unsigned char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
 #define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
 #define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
 #define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
 #define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
-static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const wchar_t *u)
+{
+    const wchar_t *u_end = u;
+    while (*u_end++) ;
+    return (size_t)(u_end - u - 1);
+}
+#else
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
+{
     const Py_UNICODE *u_end = u;
     while (*u_end++) ;
     return (size_t)(u_end - u - 1);
 }
+#endif
+#define __Pyx_PyUnicode_FromOrdinal(o)       PyUnicode_FromOrdinal((int)o)
 #define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
 #define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
 #define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
 #define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
 #define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
@@ -893,15 +1233,60 @@
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
 #define __Pyx_PyNumber_Int(x) (PyLong_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Long(x))
 #else
 #define __Pyx_PyNumber_Int(x) (PyInt_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Int(x))
 #endif
-#define __Pyx_PyNumber_Float(x) (PyFloat_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Float(x))
+#if CYTHON_USE_PYLONG_INTERNALS
+  #if PY_VERSION_HEX >= 0x030C00A7
+  #ifndef _PyLong_SIGN_MASK
+    #define _PyLong_SIGN_MASK 3
+  #endif
+  #ifndef _PyLong_NON_SIZE_BITS
+    #define _PyLong_NON_SIZE_BITS 3
+  #endif
+  #define __Pyx_PyLong_Sign(x)  (((PyLongObject*)x)->long_value.lv_tag & _PyLong_SIGN_MASK)
+  #define __Pyx_PyLong_IsNeg(x)  ((__Pyx_PyLong_Sign(x) & 2) != 0)
+  #define __Pyx_PyLong_IsNonNeg(x)  (!__Pyx_PyLong_IsNeg(x))
+  #define __Pyx_PyLong_IsZero(x)  (__Pyx_PyLong_Sign(x) & 1)
+  #define __Pyx_PyLong_IsPos(x)  (__Pyx_PyLong_Sign(x) == 0)
+  #define __Pyx_PyLong_CompactValueUnsigned(x)  (__Pyx_PyLong_Digits(x)[0])
+  #define __Pyx_PyLong_DigitCount(x)  ((Py_ssize_t) (((PyLongObject*)x)->long_value.lv_tag >> _PyLong_NON_SIZE_BITS))
+  #define __Pyx_PyLong_SignedDigitCount(x)\
+        ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * __Pyx_PyLong_DigitCount(x))
+  #if defined(PyUnstable_Long_IsCompact) && defined(PyUnstable_Long_CompactValue)
+    #define __Pyx_PyLong_IsCompact(x)     PyUnstable_Long_IsCompact((PyLongObject*) x)
+    #define __Pyx_PyLong_CompactValue(x)  PyUnstable_Long_CompactValue((PyLongObject*) x)
+  #else
+    #define __Pyx_PyLong_IsCompact(x)     (((PyLongObject*)x)->long_value.lv_tag < (2 << _PyLong_NON_SIZE_BITS))
+    #define __Pyx_PyLong_CompactValue(x)  ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * (Py_ssize_t) __Pyx_PyLong_Digits(x)[0])
+  #endif
+  typedef Py_ssize_t  __Pyx_compact_pylong;
+  typedef size_t  __Pyx_compact_upylong;
+  #else  // Py < 3.12
+  #define __Pyx_PyLong_IsNeg(x)  (Py_SIZE(x) < 0)
+  #define __Pyx_PyLong_IsNonNeg(x)  (Py_SIZE(x) >= 0)
+  #define __Pyx_PyLong_IsZero(x)  (Py_SIZE(x) == 0)
+  #define __Pyx_PyLong_IsPos(x)  (Py_SIZE(x) > 0)
+  #define __Pyx_PyLong_CompactValueUnsigned(x)  ((Py_SIZE(x) == 0) ? 0 : __Pyx_PyLong_Digits(x)[0])
+  #define __Pyx_PyLong_DigitCount(x)  __Pyx_sst_abs(Py_SIZE(x))
+  #define __Pyx_PyLong_SignedDigitCount(x)  Py_SIZE(x)
+  #define __Pyx_PyLong_IsCompact(x)  (Py_SIZE(x) == 0 || Py_SIZE(x) == 1 || Py_SIZE(x) == -1)
+  #define __Pyx_PyLong_CompactValue(x)\
+        ((Py_SIZE(x) == 0) ? (sdigit) 0 : ((Py_SIZE(x) < 0) ? -(sdigit)__Pyx_PyLong_Digits(x)[0] : (sdigit)__Pyx_PyLong_Digits(x)[0]))
+  typedef sdigit  __Pyx_compact_pylong;
+  typedef digit  __Pyx_compact_upylong;
+  #endif
+  #if PY_VERSION_HEX >= 0x030C00A5
+  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->long_value.ob_digit)
+  #else
+  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->ob_digit)
+  #endif
+#endif
 #if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
 static int __Pyx_sys_getdefaultencoding_not_ascii;
 static int __Pyx_init_sys_getdefaultencoding_params(void) {
     PyObject* sys;
     PyObject* default_encoding = NULL;
     PyObject* ascii_chars_u = NULL;
     PyObject* ascii_chars_b = NULL;
@@ -915,15 +1300,15 @@
     if (!default_encoding_c) goto bad;
     if (strcmp(default_encoding_c, "ascii") == 0) {
         __Pyx_sys_getdefaultencoding_not_ascii = 0;
     } else {
         char ascii_chars[128];
         int c;
         for (c = 0; c < 128; c++) {
-            ascii_chars[c] = c;
+            ascii_chars[c] = (char) c;
         }
         __Pyx_sys_getdefaultencoding_not_ascii = 1;
         ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
         if (!ascii_chars_u) goto bad;
         ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
         if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
             PyErr_Format(
@@ -980,31 +1365,27 @@
   #define unlikely(x) __builtin_expect(!!(x), 0)
 #else /* !__GNUC__ or GCC < 2.95 */
   #define likely(x)   (x)
   #define unlikely(x) (x)
 #endif /* __GNUC__ */
 static CYTHON_INLINE void __Pyx_pretend_to_initialize(void* ptr) { (void)ptr; }
 
+#if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_m = NULL;
-static PyObject *__pyx_d;
-static PyObject *__pyx_b;
-static PyObject *__pyx_cython_runtime = NULL;
-static PyObject *__pyx_empty_tuple;
-static PyObject *__pyx_empty_bytes;
-static PyObject *__pyx_empty_unicode;
+#endif
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
-static const char * __pyx_cfilenm= __FILE__;
+static const char * __pyx_cfilenm = __FILE__;
 static const char *__pyx_filename;
 
 /* Header.proto */
 #if !defined(CYTHON_CCOMPLEX)
   #if defined(__cplusplus)
     #define CYTHON_CCOMPLEX 1
-  #elif defined(_Complex_I)
+  #elif (defined(_Complex_I) && !defined(_MSC_VER)) || ((defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L) && !defined(__STDC_NO_COMPLEX__))
     #define CYTHON_CCOMPLEX 1
   #else
     #define CYTHON_CCOMPLEX 0
   #endif
 #endif
 #if CYTHON_CCOMPLEX
   #ifdef __cplusplus
@@ -1014,22 +1395,23 @@
   #endif
 #endif
 #if CYTHON_CCOMPLEX && !defined(__cplusplus) && defined(__sun__) && defined(__GNUC__)
   #undef _Complex_I
   #define _Complex_I 1.0fj
 #endif
 
+/* #### Code section: filename_table ### */
 
 static const char *__pyx_f[] = {
   "grizli/utils_c/disperse.pyx",
-  "__init__.pxd",
+  "__init__.cython-30.pxd",
   "type.pxd",
 };
+/* #### Code section: utility_code_proto_before_types ### */
 /* BufferFormatStructs.proto */
-#define IS_UNSIGNED(type) (((type) -1) > 0)
 struct __Pyx_StructField_;
 #define __PYX_BUF_FLAGS_PACKED_STRUCT (1 << 0)
 typedef struct {
   const char* name;
   struct __Pyx_StructField_* fields;
   size_t size;
   size_t arraysize[8];
@@ -1056,196 +1438,197 @@
   int is_complex;
   char enc_type;
   char new_packmode;
   char enc_packmode;
   char is_valid_array;
 } __Pyx_BufFmt_Context;
 
+/* #### Code section: numeric_typedefs ### */
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":690
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":732
  * # in Cython to enable them only on the right systems.
  * 
  * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  */
 typedef npy_int8 __pyx_t_5numpy_int8_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":691
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":733
  * 
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t
  */
 typedef npy_int16 __pyx_t_5numpy_int16_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":692
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":734
  * ctypedef npy_int8       int8_t
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_int64      int64_t
  * #ctypedef npy_int96      int96_t
  */
 typedef npy_int32 __pyx_t_5numpy_int32_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":693
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":735
  * ctypedef npy_int16      int16_t
  * ctypedef npy_int32      int32_t
  * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_int96      int96_t
  * #ctypedef npy_int128     int128_t
  */
 typedef npy_int64 __pyx_t_5numpy_int64_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":697
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":739
  * #ctypedef npy_int128     int128_t
  * 
  * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  */
 typedef npy_uint8 __pyx_t_5numpy_uint8_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":698
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":740
  * 
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t
  */
 typedef npy_uint16 __pyx_t_5numpy_uint16_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":699
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":741
  * ctypedef npy_uint8      uint8_t
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uint64     uint64_t
  * #ctypedef npy_uint96     uint96_t
  */
 typedef npy_uint32 __pyx_t_5numpy_uint32_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":700
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":742
  * ctypedef npy_uint16     uint16_t
  * ctypedef npy_uint32     uint32_t
  * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_uint96     uint96_t
  * #ctypedef npy_uint128    uint128_t
  */
 typedef npy_uint64 __pyx_t_5numpy_uint64_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":704
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":746
  * #ctypedef npy_uint128    uint128_t
  * 
  * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
  * ctypedef npy_float64    float64_t
  * #ctypedef npy_float80    float80_t
  */
 typedef npy_float32 __pyx_t_5numpy_float32_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":705
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":747
  * 
  * ctypedef npy_float32    float32_t
  * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
  * #ctypedef npy_float80    float80_t
  * #ctypedef npy_float128   float128_t
  */
 typedef npy_float64 __pyx_t_5numpy_float64_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":714
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":756
  * # The int types are mapped a bit surprising --
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t
  */
 typedef npy_long __pyx_t_5numpy_int_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":715
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":757
  * # numpy.int corresponds to 'l' and numpy.long to 'q'
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longlong   longlong_t
  * 
  */
 typedef npy_longlong __pyx_t_5numpy_long_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":716
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":758
  * ctypedef npy_long       int_t
  * ctypedef npy_longlong   long_t
  * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_ulong      uint_t
  */
 typedef npy_longlong __pyx_t_5numpy_longlong_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":718
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":760
  * ctypedef npy_longlong   longlong_t
  * 
  * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t
  */
 typedef npy_ulong __pyx_t_5numpy_uint_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":719
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":761
  * 
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":720
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":762
  * ctypedef npy_ulong      uint_t
  * ctypedef npy_ulonglong  ulong_t
  * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_intp       intp_t
  */
 typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":722
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":764
  * ctypedef npy_ulonglong  ulonglong_t
  * 
  * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
  * ctypedef npy_uintp      uintp_t
  * 
  */
 typedef npy_intp __pyx_t_5numpy_intp_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":723
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":765
  * 
  * ctypedef npy_intp       intp_t
  * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_double     float_t
  */
 typedef npy_uintp __pyx_t_5numpy_uintp_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":725
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":767
  * ctypedef npy_uintp      uintp_t
  * 
  * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t
  */
 typedef npy_double __pyx_t_5numpy_float_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":726
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":768
  * 
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
  * ctypedef npy_longdouble longdouble_t
  * 
  */
 typedef npy_double __pyx_t_5numpy_double_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":727
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":769
  * ctypedef npy_double     float_t
  * ctypedef npy_double     double_t
  * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cfloat      cfloat_t
  */
 typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
@@ -1299,213 +1682,196 @@
  * ctypedef np.int32_t FINT_t
  * ctypedef np.float32_t FTYPE_t
  * ctypedef np.float64_t DTYPE_t             # <<<<<<<<<<<<<<
  * 
  * import cython
  */
 typedef __pyx_t_5numpy_float64_t __pyx_t_6grizli_7utils_c_8disperse_DTYPE_t;
+/* #### Code section: complex_type_declarations ### */
 /* Declarations.proto */
-#if CYTHON_CCOMPLEX
+#if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
   #ifdef __cplusplus
     typedef ::std::complex< float > __pyx_t_float_complex;
   #else
     typedef float _Complex __pyx_t_float_complex;
   #endif
 #else
     typedef struct { float real, imag; } __pyx_t_float_complex;
 #endif
 static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float, float);
 
 /* Declarations.proto */
-#if CYTHON_CCOMPLEX
+#if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
   #ifdef __cplusplus
     typedef ::std::complex< double > __pyx_t_double_complex;
   #else
     typedef double _Complex __pyx_t_double_complex;
   #endif
 #else
     typedef struct { double real, imag; } __pyx_t_double_complex;
 #endif
 static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double, double);
 
+/* #### Code section: type_declarations ### */
 
 /*--- Type declarations ---*/
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":729
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":771
  * ctypedef npy_longdouble longdouble_t
  * 
  * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t
  */
 typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":730
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":772
  * 
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
  * ctypedef npy_clongdouble clongdouble_t
  * 
  */
 typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":731
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":773
  * ctypedef npy_cfloat      cfloat_t
  * ctypedef npy_cdouble     cdouble_t
  * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
  * 
  * ctypedef npy_cdouble     complex_t
  */
 typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":733
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":775
  * ctypedef npy_clongdouble clongdouble_t
  * 
  * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  */
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
+/* #### Code section: utility_code_proto ### */
 
 /* --- Runtime support code (head) --- */
 /* Refnanny.proto */
 #ifndef CYTHON_REFNANNY
   #define CYTHON_REFNANNY 0
 #endif
 #if CYTHON_REFNANNY
   typedef struct {
-    void (*INCREF)(void*, PyObject*, int);
-    void (*DECREF)(void*, PyObject*, int);
-    void (*GOTREF)(void*, PyObject*, int);
-    void (*GIVEREF)(void*, PyObject*, int);
-    void* (*SetupContext)(const char*, int, const char*);
+    void (*INCREF)(void*, PyObject*, Py_ssize_t);
+    void (*DECREF)(void*, PyObject*, Py_ssize_t);
+    void (*GOTREF)(void*, PyObject*, Py_ssize_t);
+    void (*GIVEREF)(void*, PyObject*, Py_ssize_t);
+    void* (*SetupContext)(const char*, Py_ssize_t, const char*);
     void (*FinishContext)(void**);
   } __Pyx_RefNannyAPIStruct;
   static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
   static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
   #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
 #ifdef WITH_THREAD
   #define __Pyx_RefNannySetupContext(name, acquire_gil)\
           if (acquire_gil) {\
               PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
-              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
+              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
               PyGILState_Release(__pyx_gilstate_save);\
           } else {\
-              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
+              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
+          }
+  #define __Pyx_RefNannyFinishContextNogil() {\
+              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
+              __Pyx_RefNannyFinishContext();\
+              PyGILState_Release(__pyx_gilstate_save);\
           }
 #else
   #define __Pyx_RefNannySetupContext(name, acquire_gil)\
-          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
+          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__))
+  #define __Pyx_RefNannyFinishContextNogil() __Pyx_RefNannyFinishContext()
 #endif
+  #define __Pyx_RefNannyFinishContextNogil() {\
+              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
+              __Pyx_RefNannyFinishContext();\
+              PyGILState_Release(__pyx_gilstate_save);\
+          }
   #define __Pyx_RefNannyFinishContext()\
           __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
-  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
-  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
-  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
-  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
+  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_XINCREF(r)  do { if((r) == NULL); else {__Pyx_INCREF(r); }} while(0)
+  #define __Pyx_XDECREF(r)  do { if((r) == NULL); else {__Pyx_DECREF(r); }} while(0)
+  #define __Pyx_XGOTREF(r)  do { if((r) == NULL); else {__Pyx_GOTREF(r); }} while(0)
+  #define __Pyx_XGIVEREF(r) do { if((r) == NULL); else {__Pyx_GIVEREF(r);}} while(0)
 #else
   #define __Pyx_RefNannyDeclarations
   #define __Pyx_RefNannySetupContext(name, acquire_gil)
+  #define __Pyx_RefNannyFinishContextNogil()
   #define __Pyx_RefNannyFinishContext()
   #define __Pyx_INCREF(r) Py_INCREF(r)
   #define __Pyx_DECREF(r) Py_DECREF(r)
   #define __Pyx_GOTREF(r)
   #define __Pyx_GIVEREF(r)
   #define __Pyx_XINCREF(r) Py_XINCREF(r)
   #define __Pyx_XDECREF(r) Py_XDECREF(r)
   #define __Pyx_XGOTREF(r)
   #define __Pyx_XGIVEREF(r)
 #endif
+#define __Pyx_Py_XDECREF_SET(r, v) do {\
+        PyObject *tmp = (PyObject *) r;\
+        r = v; Py_XDECREF(tmp);\
+    } while (0)
 #define __Pyx_XDECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_XDECREF(tmp);\
     } while (0)
 #define __Pyx_DECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_DECREF(tmp);\
     } while (0)
 #define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
 #define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)
 
-/* PyObjectGetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
+/* PyErrExceptionMatches.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
 #else
-#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
 #endif
 
-/* GetBuiltinName.proto */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name);
-
-/* RaiseArgTupleInvalid.proto */
-static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
-    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
-
-/* RaiseDoubleKeywords.proto */
-static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
-
-/* ParseKeywords.proto */
-static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
-    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
-    const char* function_name);
-
-/* ArgTypeTest.proto */
-#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
-    ((likely((Py_TYPE(obj) == type) | (none_allowed && (obj == Py_None)))) ? 1 :\
-        __Pyx__ArgTypeTest(obj, type, name, exact))
-static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);
-
-/* IsLittleEndian.proto */
-static CYTHON_INLINE int __Pyx_Is_Little_Endian(void);
-
-/* BufferFormatCheck.proto */
-static const char* __Pyx_BufFmt_CheckString(__Pyx_BufFmt_Context* ctx, const char* ts);
-static void __Pyx_BufFmt_Init(__Pyx_BufFmt_Context* ctx,
-                              __Pyx_BufFmt_StackElem* stack,
-                              __Pyx_TypeInfo* type);
-
-/* BufferGetAndValidate.proto */
-#define __Pyx_GetBufferAndValidate(buf, obj, dtype, flags, nd, cast, stack)\
-    ((obj == Py_None || obj == NULL) ?\
-    (__Pyx_ZeroBuffer(buf), 0) :\
-    __Pyx__GetBufferAndValidate(buf, obj, dtype, flags, nd, cast, stack))
-static int  __Pyx__GetBufferAndValidate(Py_buffer* buf, PyObject* obj,
-    __Pyx_TypeInfo* dtype, int flags, int nd, int cast, __Pyx_BufFmt_StackElem* stack);
-static void __Pyx_ZeroBuffer(Py_buffer* buf);
-static CYTHON_INLINE void __Pyx_SafeReleaseBuffer(Py_buffer* info);
-static Py_ssize_t __Pyx_minusones[] = { -1, -1, -1, -1, -1, -1, -1, -1 };
-static Py_ssize_t __Pyx_zeros[] = { 0, 0, 0, 0, 0, 0, 0, 0 };
-
-#define __Pyx_BufPtrStrided1d(type, buf, i0, s0) (type)((char*)buf + i0 * s0)
-#define __Pyx_BufPtrStrided2d(type, buf, i0, s0, i1, s1) (type)((char*)buf + i0 * s0 + i1 * s1)
 /* PyThreadStateGet.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
 #define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
-#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
+#if PY_VERSION_HEX >= 0x030C00A6
+#define __Pyx_PyErr_Occurred()  (__pyx_tstate->current_exception != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->current_exception ? (PyObject*) Py_TYPE(__pyx_tstate->current_exception) : (PyObject*) NULL)
+#else
+#define __Pyx_PyErr_Occurred()  (__pyx_tstate->curexc_type != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->curexc_type)
+#endif
 #else
 #define __Pyx_PyThreadState_declare
 #define __Pyx_PyThreadState_assign
-#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
+#define __Pyx_PyErr_Occurred()  (PyErr_Occurred() != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  PyErr_Occurred()
 #endif
 
 /* PyErrFetchRestore.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
 #define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
 #define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
 static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
 static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A6
 #define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
 #else
 #define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
 #endif
 #else
 #define __Pyx_PyErr_Clear() PyErr_Clear()
 #define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
@@ -1513,38 +1879,43 @@
 #define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
 #endif
 
+/* PyObjectGetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
+#else
+#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+#endif
+
+/* PyObjectGetAttrStrNoError.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
+
+/* GetBuiltinName.proto */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name);
+
 /* GetTopmostException.proto */
-#if CYTHON_USE_EXC_INFO_STACK
+#if CYTHON_USE_EXC_INFO_STACK && CYTHON_FAST_THREAD_STATE
 static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
 #endif
 
 /* SaveResetException.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
 static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
 #define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
 static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
 #else
 #define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
 #define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
 #endif
 
-/* PyErrExceptionMatches.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
-#else
-#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
-#endif
-
 /* GetException.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
 static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
 #else
 static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
 #endif
@@ -1555,36 +1926,126 @@
 #else
 #define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
 #endif
 
 /* RaiseException.proto */
 static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
 
+/* TupleAndListFromArray.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
+static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
+#endif
+
+/* IncludeStringH.proto */
+#include <string.h>
+
+/* BytesEquals.proto */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* UnicodeEquals.proto */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* fastcall.proto */
+#define __Pyx_Arg_VARARGS(args, i) PyTuple_GET_ITEM(args, i)
+#define __Pyx_NumKwargs_VARARGS(kwds) PyDict_Size(kwds)
+#define __Pyx_KwValues_VARARGS(args, nargs) NULL
+#define __Pyx_GetKwValue_VARARGS(kw, kwvalues, s) __Pyx_PyDict_GetItemStrWithError(kw, s)
+#define __Pyx_KwargsAsDict_VARARGS(kw, kwvalues) PyDict_Copy(kw)
+#if CYTHON_METH_FASTCALL
+    #define __Pyx_Arg_FASTCALL(args, i) args[i]
+    #define __Pyx_NumKwargs_FASTCALL(kwds) PyTuple_GET_SIZE(kwds)
+    #define __Pyx_KwValues_FASTCALL(args, nargs) ((args) + (nargs))
+    static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s);
+    #define __Pyx_KwargsAsDict_FASTCALL(kw, kwvalues) _PyStack_AsDict(kwvalues, kw)
+#else
+    #define __Pyx_Arg_FASTCALL __Pyx_Arg_VARARGS
+    #define __Pyx_NumKwargs_FASTCALL __Pyx_NumKwargs_VARARGS
+    #define __Pyx_KwValues_FASTCALL __Pyx_KwValues_VARARGS
+    #define __Pyx_GetKwValue_FASTCALL __Pyx_GetKwValue_VARARGS
+    #define __Pyx_KwargsAsDict_FASTCALL __Pyx_KwargsAsDict_VARARGS
+#endif
+#if CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)
+#else
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)
+#endif
+
+/* RaiseArgTupleInvalid.proto */
+static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
+    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
+
+/* RaiseDoubleKeywords.proto */
+static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
+
+/* ParseKeywords.proto */
+static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
+    PyObject **argnames[],
+    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
+    const char* function_name);
+
+/* ArgTypeTest.proto */
+#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
+    ((likely(__Pyx_IS_TYPE(obj, type) | (none_allowed && (obj == Py_None)))) ? 1 :\
+        __Pyx__ArgTypeTest(obj, type, name, exact))
+static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);
+
+/* IsLittleEndian.proto */
+static CYTHON_INLINE int __Pyx_Is_Little_Endian(void);
+
+/* BufferFormatCheck.proto */
+static const char* __Pyx_BufFmt_CheckString(__Pyx_BufFmt_Context* ctx, const char* ts);
+static void __Pyx_BufFmt_Init(__Pyx_BufFmt_Context* ctx,
+                              __Pyx_BufFmt_StackElem* stack,
+                              __Pyx_TypeInfo* type);
+
+/* BufferGetAndValidate.proto */
+#define __Pyx_GetBufferAndValidate(buf, obj, dtype, flags, nd, cast, stack)\
+    ((obj == Py_None || obj == NULL) ?\
+    (__Pyx_ZeroBuffer(buf), 0) :\
+    __Pyx__GetBufferAndValidate(buf, obj, dtype, flags, nd, cast, stack))
+static int  __Pyx__GetBufferAndValidate(Py_buffer* buf, PyObject* obj,
+    __Pyx_TypeInfo* dtype, int flags, int nd, int cast, __Pyx_BufFmt_StackElem* stack);
+static void __Pyx_ZeroBuffer(Py_buffer* buf);
+static CYTHON_INLINE void __Pyx_SafeReleaseBuffer(Py_buffer* info);
+static Py_ssize_t __Pyx_minusones[] = { -1, -1, -1, -1, -1, -1, -1, -1 };
+static Py_ssize_t __Pyx_zeros[] = { 0, 0, 0, 0, 0, 0, 0, 0 };
+
+#define __Pyx_BufPtrStrided1d(type, buf, i0, s0) (type)((char*)buf + i0 * s0)
+#define __Pyx_BufPtrStrided2d(type, buf, i0, s0, i1, s1) (type)((char*)buf + i0 * s0 + i1 * s1)
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_36
-#define __PYX_HAVE_RT_ImportType_proto_0_29_36
-#if __STDC_VERSION__ >= 201112L
+#ifndef __PYX_HAVE_RT_ImportType_proto_3_0_0
+#define __PYX_HAVE_RT_ImportType_proto_3_0_0
+#if defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L
 #include <stdalign.h>
 #endif
-#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
-#define __PYX_GET_STRUCT_ALIGNMENT_0_29_36(s) alignof(s)
+#if (defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L) || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_0(s) alignof(s)
 #else
-#define __PYX_GET_STRUCT_ALIGNMENT_0_29_36(s) sizeof(void*)
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_0(s) sizeof(void*)
 #endif
-enum __Pyx_ImportType_CheckSize_0_29_36 {
-   __Pyx_ImportType_CheckSize_Error_0_29_36 = 0,
-   __Pyx_ImportType_CheckSize_Warn_0_29_36 = 1,
-   __Pyx_ImportType_CheckSize_Ignore_0_29_36 = 2
+enum __Pyx_ImportType_CheckSize_3_0_0 {
+   __Pyx_ImportType_CheckSize_Error_3_0_0 = 0,
+   __Pyx_ImportType_CheckSize_Warn_3_0_0 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_3_0_0 = 2
 };
-static PyTypeObject *__Pyx_ImportType_0_29_36(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_36 check_size);
+static PyTypeObject *__Pyx_ImportType_3_0_0(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_0 check_size);
 #endif
 
 /* Import.proto */
 static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
 
+/* ImportDottedModule.proto */
+static PyObject *__Pyx_ImportDottedModule(PyObject *name, PyObject *parts_tuple);
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx_ImportDottedModule_WalkParts(PyObject *module, PyObject *name, PyObject *parts_tuple);
+#endif
+
 /* PyDictVersioning.proto */
 #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
 #define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
 #define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
     (version_var) = __PYX_GET_DICT_VERSION(dict);\
     (cache_var) = (value);
@@ -1624,35 +2085,163 @@
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
+/* IncludeStructmemberH.proto */
+#include <structmember.h>
+
+/* FixUpExtensionType.proto */
+#if CYTHON_USE_TYPE_SPECS
+static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type);
+#endif
+
+/* FetchSharedCythonModule.proto */
+static PyObject *__Pyx_FetchSharedCythonABIModule(void);
+
+/* FetchCommonType.proto */
+#if !CYTHON_USE_TYPE_SPECS
+static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
+#else
+static PyTypeObject* __Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases);
+#endif
+
+/* PyMethodNew.proto */
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx_PyMethod_New(PyObject *func, PyObject *self, PyObject *typ) {
+    CYTHON_UNUSED_VAR(typ);
+    if (!self)
+        return __Pyx_NewRef(func);
+    return PyMethod_New(func, self);
+}
+#else
+    #define __Pyx_PyMethod_New PyMethod_New
+#endif
+
+/* PyVectorcallFastCallDict.proto */
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw);
+#endif
+
+/* CythonFunctionShared.proto */
+#define __Pyx_CyFunction_USED
+#define __Pyx_CYFUNCTION_STATICMETHOD  0x01
+#define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
+#define __Pyx_CYFUNCTION_CCLASS        0x04
+#define __Pyx_CYFUNCTION_COROUTINE     0x08
+#define __Pyx_CyFunction_GetClosure(f)\
+    (((__pyx_CyFunctionObject *) (f))->func_closure)
+#if PY_VERSION_HEX < 0x030900B1
+  #define __Pyx_CyFunction_GetClassObj(f)\
+      (((__pyx_CyFunctionObject *) (f))->func_classobj)
+#else
+  #define __Pyx_CyFunction_GetClassObj(f)\
+      ((PyObject*) ((PyCMethodObject *) (f))->mm_class)
+#endif
+#define __Pyx_CyFunction_SetClassObj(f, classobj)\
+    __Pyx__CyFunction_SetClassObj((__pyx_CyFunctionObject *) (f), (classobj))
+#define __Pyx_CyFunction_Defaults(type, f)\
+    ((type *)(((__pyx_CyFunctionObject *) (f))->defaults))
+#define __Pyx_CyFunction_SetDefaultsGetter(f, g)\
+    ((__pyx_CyFunctionObject *) (f))->defaults_getter = (g)
+typedef struct {
+#if PY_VERSION_HEX < 0x030900B1
+    PyCFunctionObject func;
+#else
+    PyCMethodObject func;
+#endif
+#if CYTHON_BACKPORT_VECTORCALL
+    __pyx_vectorcallfunc func_vectorcall;
+#endif
+#if PY_VERSION_HEX < 0x030500A0
+    PyObject *func_weakreflist;
+#endif
+    PyObject *func_dict;
+    PyObject *func_name;
+    PyObject *func_qualname;
+    PyObject *func_doc;
+    PyObject *func_globals;
+    PyObject *func_code;
+    PyObject *func_closure;
+#if PY_VERSION_HEX < 0x030900B1
+    PyObject *func_classobj;
+#endif
+    void *defaults;
+    int defaults_pyobjects;
+    size_t defaults_size;  // used by FusedFunction for copying defaults
+    int flags;
+    PyObject *defaults_tuple;
+    PyObject *defaults_kwdict;
+    PyObject *(*defaults_getter)(PyObject *);
+    PyObject *func_annotations;
+    PyObject *func_is_coroutine;
+} __pyx_CyFunctionObject;
+#define __Pyx_CyFunction_Check(obj)  __Pyx_TypeCheck(obj, __pyx_CyFunctionType)
+#define __Pyx_IsCyOrPyCFunction(obj)  __Pyx_TypeCheck2(obj, __pyx_CyFunctionType, &PyCFunction_Type)
+#define __Pyx_CyFunction_CheckExact(obj)  __Pyx_IS_TYPE(obj, __pyx_CyFunctionType)
+static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject* op, PyMethodDef *ml,
+                                      int flags, PyObject* qualname,
+                                      PyObject *closure,
+                                      PyObject *module, PyObject *globals,
+                                      PyObject* code);
+static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj);
+static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *m,
+                                                         size_t size,
+                                                         int pyobjects);
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *m,
+                                                            PyObject *tuple);
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *m,
+                                                             PyObject *dict);
+static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *m,
+                                                              PyObject *dict);
+static int __pyx_CyFunction_init(PyObject *module);
+#if CYTHON_METH_FASTCALL
+static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+#if CYTHON_BACKPORT_VECTORCALL
+#define __Pyx_CyFunction_func_vectorcall(f) (((__pyx_CyFunctionObject*)f)->func_vectorcall)
+#else
+#define __Pyx_CyFunction_func_vectorcall(f) (((PyCFunctionObject*)f)->vectorcall)
+#endif
+#endif
+
+/* CythonFunction.proto */
+static PyObject *__Pyx_CyFunction_New(PyMethodDef *ml,
+                                      int flags, PyObject* qualname,
+                                      PyObject *closure,
+                                      PyObject *module, PyObject *globals,
+                                      PyObject* code);
+
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
 #define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
 #else
 static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
 #endif
 
 /* CodeObjectCache.proto */
+#if !CYTHON_COMPILING_IN_LIMITED_API
 typedef struct {
     PyCodeObject* code_object;
     int code_line;
 } __Pyx_CodeObjectCacheEntry;
 struct __Pyx_CodeObjectCache {
     int count;
     int max_count;
     __Pyx_CodeObjectCacheEntry* entries;
 };
 static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
 static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
 static PyCodeObject *__pyx_find_code_object(int code_line);
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
+#endif
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
 /* BufferStructDeclare.proto */
 typedef struct {
@@ -1674,15 +2263,15 @@
 #else
     #define __Pyx_GetBuffer PyObject_GetBuffer
     #define __Pyx_ReleaseBuffer PyBuffer_Release
 #endif
 
 
 /* GCCDiagnostics.proto */
-#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#if !defined(__INTEL_COMPILER) && defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
 #define __Pyx_HAS_GCC_DIAGNOSTIC
 #endif
 
 /* RealImag.proto */
 #if CYTHON_CCOMPLEX
   #ifdef __cplusplus
     #define __Pyx_CREAL(z) ((z).real())
@@ -1701,15 +2290,15 @@
     #define __Pyx_SET_CIMAG(z,y) ((z).imag(y))
 #else
     #define __Pyx_SET_CREAL(z,x) __Pyx_CREAL(z) = (x)
     #define __Pyx_SET_CIMAG(z,y) __Pyx_CIMAG(z) = (y)
 #endif
 
 /* Arithmetic.proto */
-#if CYTHON_CCOMPLEX
+#if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
     #define __Pyx_c_eq_float(a, b)   ((a)==(b))
     #define __Pyx_c_sum_float(a, b)  ((a)+(b))
     #define __Pyx_c_diff_float(a, b) ((a)-(b))
     #define __Pyx_c_prod_float(a, b) ((a)*(b))
     #define __Pyx_c_quot_float(a, b) ((a)/(b))
     #define __Pyx_c_neg_float(a)     (-(a))
   #ifdef __cplusplus
@@ -1739,15 +2328,15 @@
     #if 1
         static CYTHON_INLINE float __Pyx_c_abs_float(__pyx_t_float_complex);
         static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_pow_float(__pyx_t_float_complex, __pyx_t_float_complex);
     #endif
 #endif
 
 /* Arithmetic.proto */
-#if CYTHON_CCOMPLEX
+#if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
     #define __Pyx_c_eq_double(a, b)   ((a)==(b))
     #define __Pyx_c_sum_double(a, b)  ((a)+(b))
     #define __Pyx_c_diff_double(a, b) ((a)-(b))
     #define __Pyx_c_prod_double(a, b) ((a)*(b))
     #define __Pyx_c_quot_double(a, b) ((a)/(b))
     #define __Pyx_c_neg_double(a)     (-(a))
   #ifdef __cplusplus
@@ -1791,100 +2380,111 @@
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE unsigned int __Pyx_PyInt_As_unsigned_int(PyObject *);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);
 
+/* FormatTypeName.proto */
+#if CYTHON_COMPILING_IN_LIMITED_API
+typedef PyObject *__Pyx_TypeName;
+#define __Pyx_FMT_TYPENAME "%U"
+static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
+#define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
+#else
+typedef const char *__Pyx_TypeName;
+#define __Pyx_FMT_TYPENAME "%.200s"
+#define __Pyx_PyType_GetName(tp) ((tp)->tp_name)
+#define __Pyx_DECREF_TypeName(obj)
+#endif
+
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);
 
 /* FastTypeChecks.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 #define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
+#define __Pyx_TypeCheck2(obj, type1, type2) __Pyx_IsAnySubtype2(Py_TYPE(obj), (PyTypeObject *)type1, (PyTypeObject *)type2)
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
+static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *type1, PyObject *type2);
 #else
 #define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
+#define __Pyx_TypeCheck2(obj, type1, type2) (PyObject_TypeCheck(obj, (PyTypeObject *)type1) || PyObject_TypeCheck(obj, (PyTypeObject *)type2))
 #define __Pyx_PyErr_GivenExceptionMatches(err, type) PyErr_GivenExceptionMatches(err, type)
 #define __Pyx_PyErr_GivenExceptionMatches2(err, type1, type2) (PyErr_GivenExceptionMatches(err, type1) || PyErr_GivenExceptionMatches(err, type2))
 #endif
+#define __Pyx_PyErr_ExceptionMatches2(err1, err2)  __Pyx_PyErr_GivenExceptionMatches2(__Pyx_PyErr_CurrentExceptionType(), err1, err2)
 #define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)
 
 /* CheckBinaryVersion.proto */
 static int __Pyx_check_binary_version(void);
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
+/* #### Code section: module_declarations ### */
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_7ndarray_4base_base(PyArrayObject *__pyx_v_self); /* proto*/
+static CYTHON_INLINE PyArray_Descr *__pyx_f_5numpy_7ndarray_5descr_descr(PyArrayObject *__pyx_v_self); /* proto*/
+static CYTHON_INLINE int __pyx_f_5numpy_7ndarray_4ndim_ndim(PyArrayObject *__pyx_v_self); /* proto*/
+static CYTHON_INLINE npy_intp *__pyx_f_5numpy_7ndarray_5shape_shape(PyArrayObject *__pyx_v_self); /* proto*/
+static CYTHON_INLINE npy_intp *__pyx_f_5numpy_7ndarray_7strides_strides(PyArrayObject *__pyx_v_self); /* proto*/
+static CYTHON_INLINE npy_intp __pyx_f_5numpy_7ndarray_4size_size(PyArrayObject *__pyx_v_self); /* proto*/
+static CYTHON_INLINE char *__pyx_f_5numpy_7ndarray_4data_data(PyArrayObject *__pyx_v_self); /* proto*/
 
-/* Module declarations from 'cpython.buffer' */
+/* Module declarations from "libc.string" */
 
-/* Module declarations from 'libc.string' */
+/* Module declarations from "libc.stdio" */
 
-/* Module declarations from 'libc.stdio' */
+/* Module declarations from "__builtin__" */
 
-/* Module declarations from '__builtin__' */
+/* Module declarations from "cpython.type" */
 
-/* Module declarations from 'cpython.type' */
-static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;
+/* Module declarations from "cpython" */
 
-/* Module declarations from 'cpython' */
+/* Module declarations from "cpython.object" */
 
-/* Module declarations from 'cpython.object' */
+/* Module declarations from "cpython.ref" */
 
-/* Module declarations from 'cpython.ref' */
+/* Module declarations from "numpy" */
 
-/* Module declarations from 'cpython.mem' */
+/* Module declarations from "numpy" */
 
-/* Module declarations from 'numpy' */
+/* Module declarations from "cython" */
 
-/* Module declarations from 'numpy' */
-static PyTypeObject *__pyx_ptype_5numpy_dtype = 0;
-static PyTypeObject *__pyx_ptype_5numpy_flatiter = 0;
-static PyTypeObject *__pyx_ptype_5numpy_broadcast = 0;
-static PyTypeObject *__pyx_ptype_5numpy_ndarray = 0;
-static PyTypeObject *__pyx_ptype_5numpy_generic = 0;
-static PyTypeObject *__pyx_ptype_5numpy_number = 0;
-static PyTypeObject *__pyx_ptype_5numpy_integer = 0;
-static PyTypeObject *__pyx_ptype_5numpy_signedinteger = 0;
-static PyTypeObject *__pyx_ptype_5numpy_unsignedinteger = 0;
-static PyTypeObject *__pyx_ptype_5numpy_inexact = 0;
-static PyTypeObject *__pyx_ptype_5numpy_floating = 0;
-static PyTypeObject *__pyx_ptype_5numpy_complexfloating = 0;
-static PyTypeObject *__pyx_ptype_5numpy_flexible = 0;
-static PyTypeObject *__pyx_ptype_5numpy_character = 0;
-static PyTypeObject *__pyx_ptype_5numpy_ufunc = 0;
-
-/* Module declarations from 'cython' */
-
-/* Module declarations from 'grizli.utils_c.disperse' */
+/* Module declarations from "grizli.utils_c.disperse" */
+/* #### Code section: typeinfo ### */
 static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t = { "FTYPE_t", NULL, sizeof(__pyx_t_6grizli_7utils_c_8disperse_FTYPE_t), { 0 }, 0, 'R', 0, 0 };
-static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t = { "LINT_t", NULL, sizeof(__pyx_t_6grizli_7utils_c_8disperse_LINT_t), { 0 }, 0, IS_UNSIGNED(__pyx_t_6grizli_7utils_c_8disperse_LINT_t) ? 'U' : 'I', IS_UNSIGNED(__pyx_t_6grizli_7utils_c_8disperse_LINT_t), 0 };
+static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t = { "LINT_t", NULL, sizeof(__pyx_t_6grizli_7utils_c_8disperse_LINT_t), { 0 }, 0, __PYX_IS_UNSIGNED(__pyx_t_6grizli_7utils_c_8disperse_LINT_t) ? 'U' : 'I', __PYX_IS_UNSIGNED(__pyx_t_6grizli_7utils_c_8disperse_LINT_t), 0 };
 static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_DTYPE_t = { "DTYPE_t", NULL, sizeof(__pyx_t_6grizli_7utils_c_8disperse_DTYPE_t), { 0 }, 0, 'R', 0, 0 };
+/* #### Code section: before_global_var ### */
 #define __Pyx_MODULE_NAME "grizli.utils_c.disperse"
 extern int __pyx_module_is_main_grizli__utils_c__disperse;
 int __pyx_module_is_main_grizli__utils_c__disperse = 0;
 
-/* Implementation of 'grizli.utils_c.disperse' */
+/* Implementation of "grizli.utils_c.disperse" */
+/* #### Code section: global_var ### */
 static PyObject *__pyx_builtin_range;
 static PyObject *__pyx_builtin_ImportError;
+/* #### Code section: string_decls ### */
 static const char __pyx_k_i[] = "i";
 static const char __pyx_k_j[] = "j";
 static const char __pyx_k_k[] = "k";
+static const char __pyx_k__3[] = "*";
 static const char __pyx_k_k1[] = "k1";
 static const char __pyx_k_k2[] = "k2";
 static const char __pyx_k_nk[] = "nk";
 static const char __pyx_k_nl[] = "nl";
 static const char __pyx_k_np[] = "np";
 static const char __pyx_k_x0[] = "x0";
+static const char __pyx_k__10[] = "?";
 static const char __pyx_k_shd[] = "shd";
 static const char __pyx_k_shg[] = "shg";
 static const char __pyx_k_shx[] = "shx";
 static const char __pyx_k_shy[] = "shy";
 static const char __pyx_k_area[] = "area";
 static const char __pyx_k_flam[] = "flam";
 static const char __pyx_k_full[] = "full";
@@ -1892,14 +2492,15 @@
 static const char __pyx_k_imax[] = "imax";
 static const char __pyx_k_imin[] = "imin";
 static const char __pyx_k_jmax[] = "jmax";
 static const char __pyx_k_jmin[] = "jmin";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_name[] = "__name__";
 static const char __pyx_k_segm[] = "segm";
+static const char __pyx_k_spec[] = "__spec__";
 static const char __pyx_k_test[] = "__test__";
 static const char __pyx_k_DTYPE[] = "DTYPE";
 static const char __pyx_k_ITYPE[] = "ITYPE";
 static const char __pyx_k_denom[] = "denom";
 static const char __pyx_k_fl_ij[] = "fl_ij";
 static const char __pyx_k_int64[] = "int64";
 static const char __pyx_k_numpy[] = "numpy";
@@ -1911,229 +2512,1946 @@
 static const char __pyx_k_jnumer[] = "jnumer";
 static const char __pyx_k_seg_id[] = "seg_id";
 static const char __pyx_k_wht_ij[] = "wht_ij";
 static const char __pyx_k_float64[] = "float64";
 static const char __pyx_k_seg_flux[] = "seg_flux";
 static const char __pyx_k_sh_thumb[] = "sh_thumb";
 static const char __pyx_k_ImportError[] = "ImportError";
+static const char __pyx_k_initializing[] = "_initializing";
+static const char __pyx_k_is_coroutine[] = "_is_coroutine";
+static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_disperse_grism_object[] = "disperse_grism_object";
 static const char __pyx_k_grizli_utils_c_disperse[] = "grizli.utils_c.disperse";
 static const char __pyx_k_compute_segmentation_limits[] = "compute_segmentation_limits";
 static const char __pyx_k_grizli_utils_c_disperse_pyx[] = "grizli/utils_c/disperse.pyx";
 static const char __pyx_k_numpy_core_multiarray_failed_to[] = "numpy.core.multiarray failed to import";
 static const char __pyx_k_numpy_core_umath_failed_to_impor[] = "numpy.core.umath failed to import";
-static PyObject *__pyx_n_s_DTYPE;
-static PyObject *__pyx_n_s_ITYPE;
-static PyObject *__pyx_n_s_ImportError;
-static PyObject *__pyx_n_s_area;
-static PyObject *__pyx_n_s_cline_in_traceback;
-static PyObject *__pyx_n_s_compute_segmentation_limits;
-static PyObject *__pyx_n_s_denom;
-static PyObject *__pyx_n_s_disperse_grism_object;
-static PyObject *__pyx_n_s_fl_ij;
-static PyObject *__pyx_n_s_flam;
-static PyObject *__pyx_n_s_float64;
-static PyObject *__pyx_n_s_full;
-static PyObject *__pyx_n_s_grizli_utils_c_disperse;
-static PyObject *__pyx_kp_s_grizli_utils_c_disperse_pyx;
-static PyObject *__pyx_n_s_i;
-static PyObject *__pyx_n_s_idxl;
-static PyObject *__pyx_n_s_imax;
-static PyObject *__pyx_n_s_imin;
-static PyObject *__pyx_n_s_import;
-static PyObject *__pyx_n_s_int64;
-static PyObject *__pyx_n_s_inumer;
-static PyObject *__pyx_n_s_j;
-static PyObject *__pyx_n_s_jmax;
-static PyObject *__pyx_n_s_jmin;
-static PyObject *__pyx_n_s_jnumer;
-static PyObject *__pyx_n_s_k;
-static PyObject *__pyx_n_s_k1;
-static PyObject *__pyx_n_s_k2;
-static PyObject *__pyx_n_s_main;
-static PyObject *__pyx_n_s_name;
-static PyObject *__pyx_n_s_nk;
-static PyObject *__pyx_n_s_nl;
-static PyObject *__pyx_n_s_np;
-static PyObject *__pyx_n_s_numpy;
-static PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
-static PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
-static PyObject *__pyx_n_s_range;
-static PyObject *__pyx_n_s_seg_flux;
-static PyObject *__pyx_n_s_seg_id;
-static PyObject *__pyx_n_s_segm;
-static PyObject *__pyx_n_s_sh_thumb;
-static PyObject *__pyx_n_s_shd;
-static PyObject *__pyx_n_s_shg;
-static PyObject *__pyx_n_s_shx;
-static PyObject *__pyx_n_s_shy;
-static PyObject *__pyx_n_s_test;
-static PyObject *__pyx_n_s_wht_ij;
-static PyObject *__pyx_n_s_x0;
-static PyObject *__pyx_n_s_yfrac;
-static PyObject *__pyx_n_s_ysens;
+/* #### Code section: decls ### */
 static PyObject *__pyx_pf_6grizli_7utils_c_8disperse_disperse_grism_object(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_flam, PyArrayObject *__pyx_v_segm, __pyx_t_6grizli_7utils_c_8disperse_FTYPE_t __pyx_v_seg_id, PyArrayObject *__pyx_v_idxl, PyArrayObject *__pyx_v_yfrac, PyArrayObject *__pyx_v_ysens, PyArrayObject *__pyx_v_full, PyArrayObject *__pyx_v_x0, PyArrayObject *__pyx_v_shd, PyArrayObject *__pyx_v_sh_thumb, PyArrayObject *__pyx_v_shg); /* proto */
 static PyObject *__pyx_pf_6grizli_7utils_c_8disperse_2compute_segmentation_limits(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_segm, int __pyx_v_seg_id, PyArrayObject *__pyx_v_flam, PyArrayObject *__pyx_v_shd); /* proto */
 static PyObject *__pyx_pf_6grizli_7utils_c_8disperse_4seg_flux(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyArrayObject *__pyx_v_flam, CYTHON_UNUSED PyArrayObject *__pyx_v_idxl, CYTHON_UNUSED PyArrayObject *__pyx_v_yfrac, CYTHON_UNUSED PyArrayObject *__pyx_v_ysens, CYTHON_UNUSED PyArrayObject *__pyx_v_full, CYTHON_UNUSED PyArrayObject *__pyx_v_x0, CYTHON_UNUSED PyArrayObject *__pyx_v_shd, CYTHON_UNUSED PyArrayObject *__pyx_v_shg); /* proto */
-static PyObject *__pyx_tuple_;
-static PyObject *__pyx_tuple__2;
-static PyObject *__pyx_tuple__3;
-static PyObject *__pyx_tuple__5;
-static PyObject *__pyx_tuple__7;
-static PyObject *__pyx_codeobj__4;
-static PyObject *__pyx_codeobj__6;
-static PyObject *__pyx_codeobj__8;
-/* Late includes */
+/* #### Code section: late_includes ### */
+/* #### Code section: module_state ### */
+typedef struct {
+  PyObject *__pyx_d;
+  PyObject *__pyx_b;
+  PyObject *__pyx_cython_runtime;
+  PyObject *__pyx_empty_tuple;
+  PyObject *__pyx_empty_bytes;
+  PyObject *__pyx_empty_unicode;
+  #ifdef __Pyx_CyFunction_USED
+  PyTypeObject *__pyx_CyFunctionType;
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  PyTypeObject *__pyx_FusedFunctionType;
+  #endif
+  #ifdef __Pyx_Generator_USED
+  PyTypeObject *__pyx_GeneratorType;
+  #endif
+  #ifdef __Pyx_IterableCoroutine_USED
+  PyTypeObject *__pyx_IterableCoroutineType;
+  #endif
+  #ifdef __Pyx_Coroutine_USED
+  PyTypeObject *__pyx_CoroutineAwaitType;
+  #endif
+  #ifdef __Pyx_Coroutine_USED
+  PyTypeObject *__pyx_CoroutineType;
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  PyTypeObject *__pyx_ptype_7cpython_4type_type;
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  PyTypeObject *__pyx_ptype_5numpy_dtype;
+  PyTypeObject *__pyx_ptype_5numpy_flatiter;
+  PyTypeObject *__pyx_ptype_5numpy_broadcast;
+  PyTypeObject *__pyx_ptype_5numpy_ndarray;
+  PyTypeObject *__pyx_ptype_5numpy_generic;
+  PyTypeObject *__pyx_ptype_5numpy_number;
+  PyTypeObject *__pyx_ptype_5numpy_integer;
+  PyTypeObject *__pyx_ptype_5numpy_signedinteger;
+  PyTypeObject *__pyx_ptype_5numpy_unsignedinteger;
+  PyTypeObject *__pyx_ptype_5numpy_inexact;
+  PyTypeObject *__pyx_ptype_5numpy_floating;
+  PyTypeObject *__pyx_ptype_5numpy_complexfloating;
+  PyTypeObject *__pyx_ptype_5numpy_flexible;
+  PyTypeObject *__pyx_ptype_5numpy_character;
+  PyTypeObject *__pyx_ptype_5numpy_ufunc;
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  PyObject *__pyx_n_s_DTYPE;
+  PyObject *__pyx_n_s_ITYPE;
+  PyObject *__pyx_n_s_ImportError;
+  PyObject *__pyx_n_s__10;
+  PyObject *__pyx_n_s__3;
+  PyObject *__pyx_n_s_area;
+  PyObject *__pyx_n_s_asyncio_coroutines;
+  PyObject *__pyx_n_s_cline_in_traceback;
+  PyObject *__pyx_n_s_compute_segmentation_limits;
+  PyObject *__pyx_n_s_denom;
+  PyObject *__pyx_n_s_disperse_grism_object;
+  PyObject *__pyx_n_s_fl_ij;
+  PyObject *__pyx_n_s_flam;
+  PyObject *__pyx_n_s_float64;
+  PyObject *__pyx_n_s_full;
+  PyObject *__pyx_n_s_grizli_utils_c_disperse;
+  PyObject *__pyx_kp_s_grizli_utils_c_disperse_pyx;
+  PyObject *__pyx_n_s_i;
+  PyObject *__pyx_n_s_idxl;
+  PyObject *__pyx_n_s_imax;
+  PyObject *__pyx_n_s_imin;
+  PyObject *__pyx_n_s_import;
+  PyObject *__pyx_n_s_initializing;
+  PyObject *__pyx_n_s_int64;
+  PyObject *__pyx_n_s_inumer;
+  PyObject *__pyx_n_s_is_coroutine;
+  PyObject *__pyx_n_s_j;
+  PyObject *__pyx_n_s_jmax;
+  PyObject *__pyx_n_s_jmin;
+  PyObject *__pyx_n_s_jnumer;
+  PyObject *__pyx_n_s_k;
+  PyObject *__pyx_n_s_k1;
+  PyObject *__pyx_n_s_k2;
+  PyObject *__pyx_n_s_main;
+  PyObject *__pyx_n_s_name;
+  PyObject *__pyx_n_s_nk;
+  PyObject *__pyx_n_s_nl;
+  PyObject *__pyx_n_s_np;
+  PyObject *__pyx_n_s_numpy;
+  PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
+  PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
+  PyObject *__pyx_n_s_range;
+  PyObject *__pyx_n_s_seg_flux;
+  PyObject *__pyx_n_s_seg_id;
+  PyObject *__pyx_n_s_segm;
+  PyObject *__pyx_n_s_sh_thumb;
+  PyObject *__pyx_n_s_shd;
+  PyObject *__pyx_n_s_shg;
+  PyObject *__pyx_n_s_shx;
+  PyObject *__pyx_n_s_shy;
+  PyObject *__pyx_n_s_spec;
+  PyObject *__pyx_n_s_test;
+  PyObject *__pyx_n_s_wht_ij;
+  PyObject *__pyx_n_s_x0;
+  PyObject *__pyx_n_s_yfrac;
+  PyObject *__pyx_n_s_ysens;
+  PyObject *__pyx_tuple_;
+  PyObject *__pyx_tuple__2;
+  PyObject *__pyx_tuple__4;
+  PyObject *__pyx_tuple__6;
+  PyObject *__pyx_tuple__8;
+  PyObject *__pyx_codeobj__5;
+  PyObject *__pyx_codeobj__7;
+  PyObject *__pyx_codeobj__9;
+} __pyx_mstate;
+
+#if CYTHON_USE_MODULE_STATE
+#ifdef __cplusplus
+namespace {
+  extern struct PyModuleDef __pyx_moduledef;
+} /* anonymous namespace */
+#else
+static struct PyModuleDef __pyx_moduledef;
+#endif
+
+#define __pyx_mstate(o) ((__pyx_mstate *)__Pyx_PyModule_GetState(o))
+
+#define __pyx_mstate_global (__pyx_mstate(PyState_FindModule(&__pyx_moduledef)))
+
+#define __pyx_m (PyState_FindModule(&__pyx_moduledef))
+#else
+static __pyx_mstate __pyx_mstate_global_static =
+#ifdef __cplusplus
+    {};
+#else
+    {0};
+#endif
+static __pyx_mstate *__pyx_mstate_global = &__pyx_mstate_global_static;
+#endif
+/* #### Code section: module_state_clear ### */
+#if CYTHON_USE_MODULE_STATE
+static int __pyx_m_clear(PyObject *m) {
+  __pyx_mstate *clear_module_state = __pyx_mstate(m);
+  if (!clear_module_state) return 0;
+  Py_CLEAR(clear_module_state->__pyx_d);
+  Py_CLEAR(clear_module_state->__pyx_b);
+  Py_CLEAR(clear_module_state->__pyx_cython_runtime);
+  Py_CLEAR(clear_module_state->__pyx_empty_tuple);
+  Py_CLEAR(clear_module_state->__pyx_empty_bytes);
+  Py_CLEAR(clear_module_state->__pyx_empty_unicode);
+  #ifdef __Pyx_CyFunction_USED
+  Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
+  #endif
+  Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4type_type);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_dtype);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_flatiter);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_broadcast);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_ndarray);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_generic);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_number);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_integer);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_signedinteger);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_unsignedinteger);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_inexact);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_floating);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_complexfloating);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_flexible);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_character);
+  Py_CLEAR(clear_module_state->__pyx_ptype_5numpy_ufunc);
+  Py_CLEAR(clear_module_state->__pyx_n_s_DTYPE);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ITYPE);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ImportError);
+  Py_CLEAR(clear_module_state->__pyx_n_s__10);
+  Py_CLEAR(clear_module_state->__pyx_n_s__3);
+  Py_CLEAR(clear_module_state->__pyx_n_s_area);
+  Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
+  Py_CLEAR(clear_module_state->__pyx_n_s_compute_segmentation_limits);
+  Py_CLEAR(clear_module_state->__pyx_n_s_denom);
+  Py_CLEAR(clear_module_state->__pyx_n_s_disperse_grism_object);
+  Py_CLEAR(clear_module_state->__pyx_n_s_fl_ij);
+  Py_CLEAR(clear_module_state->__pyx_n_s_flam);
+  Py_CLEAR(clear_module_state->__pyx_n_s_float64);
+  Py_CLEAR(clear_module_state->__pyx_n_s_full);
+  Py_CLEAR(clear_module_state->__pyx_n_s_grizli_utils_c_disperse);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_grizli_utils_c_disperse_pyx);
+  Py_CLEAR(clear_module_state->__pyx_n_s_i);
+  Py_CLEAR(clear_module_state->__pyx_n_s_idxl);
+  Py_CLEAR(clear_module_state->__pyx_n_s_imax);
+  Py_CLEAR(clear_module_state->__pyx_n_s_imin);
+  Py_CLEAR(clear_module_state->__pyx_n_s_import);
+  Py_CLEAR(clear_module_state->__pyx_n_s_initializing);
+  Py_CLEAR(clear_module_state->__pyx_n_s_int64);
+  Py_CLEAR(clear_module_state->__pyx_n_s_inumer);
+  Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
+  Py_CLEAR(clear_module_state->__pyx_n_s_j);
+  Py_CLEAR(clear_module_state->__pyx_n_s_jmax);
+  Py_CLEAR(clear_module_state->__pyx_n_s_jmin);
+  Py_CLEAR(clear_module_state->__pyx_n_s_jnumer);
+  Py_CLEAR(clear_module_state->__pyx_n_s_k);
+  Py_CLEAR(clear_module_state->__pyx_n_s_k1);
+  Py_CLEAR(clear_module_state->__pyx_n_s_k2);
+  Py_CLEAR(clear_module_state->__pyx_n_s_main);
+  Py_CLEAR(clear_module_state->__pyx_n_s_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_nk);
+  Py_CLEAR(clear_module_state->__pyx_n_s_nl);
+  Py_CLEAR(clear_module_state->__pyx_n_s_np);
+  Py_CLEAR(clear_module_state->__pyx_n_s_numpy);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_numpy_core_multiarray_failed_to);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_numpy_core_umath_failed_to_impor);
+  Py_CLEAR(clear_module_state->__pyx_n_s_range);
+  Py_CLEAR(clear_module_state->__pyx_n_s_seg_flux);
+  Py_CLEAR(clear_module_state->__pyx_n_s_seg_id);
+  Py_CLEAR(clear_module_state->__pyx_n_s_segm);
+  Py_CLEAR(clear_module_state->__pyx_n_s_sh_thumb);
+  Py_CLEAR(clear_module_state->__pyx_n_s_shd);
+  Py_CLEAR(clear_module_state->__pyx_n_s_shg);
+  Py_CLEAR(clear_module_state->__pyx_n_s_shx);
+  Py_CLEAR(clear_module_state->__pyx_n_s_shy);
+  Py_CLEAR(clear_module_state->__pyx_n_s_spec);
+  Py_CLEAR(clear_module_state->__pyx_n_s_test);
+  Py_CLEAR(clear_module_state->__pyx_n_s_wht_ij);
+  Py_CLEAR(clear_module_state->__pyx_n_s_x0);
+  Py_CLEAR(clear_module_state->__pyx_n_s_yfrac);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ysens);
+  Py_CLEAR(clear_module_state->__pyx_tuple_);
+  Py_CLEAR(clear_module_state->__pyx_tuple__2);
+  Py_CLEAR(clear_module_state->__pyx_tuple__4);
+  Py_CLEAR(clear_module_state->__pyx_tuple__6);
+  Py_CLEAR(clear_module_state->__pyx_tuple__8);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__5);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__7);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__9);
+  return 0;
+}
+#endif
+/* #### Code section: module_state_traverse ### */
+#if CYTHON_USE_MODULE_STATE
+static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
+  __pyx_mstate *traverse_module_state = __pyx_mstate(m);
+  if (!traverse_module_state) return 0;
+  Py_VISIT(traverse_module_state->__pyx_d);
+  Py_VISIT(traverse_module_state->__pyx_b);
+  Py_VISIT(traverse_module_state->__pyx_cython_runtime);
+  Py_VISIT(traverse_module_state->__pyx_empty_tuple);
+  Py_VISIT(traverse_module_state->__pyx_empty_bytes);
+  Py_VISIT(traverse_module_state->__pyx_empty_unicode);
+  #ifdef __Pyx_CyFunction_USED
+  Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
+  #endif
+  Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4type_type);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_dtype);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_flatiter);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_broadcast);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_ndarray);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_generic);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_number);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_integer);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_signedinteger);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_unsignedinteger);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_inexact);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_floating);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_complexfloating);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_flexible);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_character);
+  Py_VISIT(traverse_module_state->__pyx_ptype_5numpy_ufunc);
+  Py_VISIT(traverse_module_state->__pyx_n_s_DTYPE);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ITYPE);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ImportError);
+  Py_VISIT(traverse_module_state->__pyx_n_s__10);
+  Py_VISIT(traverse_module_state->__pyx_n_s__3);
+  Py_VISIT(traverse_module_state->__pyx_n_s_area);
+  Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
+  Py_VISIT(traverse_module_state->__pyx_n_s_compute_segmentation_limits);
+  Py_VISIT(traverse_module_state->__pyx_n_s_denom);
+  Py_VISIT(traverse_module_state->__pyx_n_s_disperse_grism_object);
+  Py_VISIT(traverse_module_state->__pyx_n_s_fl_ij);
+  Py_VISIT(traverse_module_state->__pyx_n_s_flam);
+  Py_VISIT(traverse_module_state->__pyx_n_s_float64);
+  Py_VISIT(traverse_module_state->__pyx_n_s_full);
+  Py_VISIT(traverse_module_state->__pyx_n_s_grizli_utils_c_disperse);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_grizli_utils_c_disperse_pyx);
+  Py_VISIT(traverse_module_state->__pyx_n_s_i);
+  Py_VISIT(traverse_module_state->__pyx_n_s_idxl);
+  Py_VISIT(traverse_module_state->__pyx_n_s_imax);
+  Py_VISIT(traverse_module_state->__pyx_n_s_imin);
+  Py_VISIT(traverse_module_state->__pyx_n_s_import);
+  Py_VISIT(traverse_module_state->__pyx_n_s_initializing);
+  Py_VISIT(traverse_module_state->__pyx_n_s_int64);
+  Py_VISIT(traverse_module_state->__pyx_n_s_inumer);
+  Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
+  Py_VISIT(traverse_module_state->__pyx_n_s_j);
+  Py_VISIT(traverse_module_state->__pyx_n_s_jmax);
+  Py_VISIT(traverse_module_state->__pyx_n_s_jmin);
+  Py_VISIT(traverse_module_state->__pyx_n_s_jnumer);
+  Py_VISIT(traverse_module_state->__pyx_n_s_k);
+  Py_VISIT(traverse_module_state->__pyx_n_s_k1);
+  Py_VISIT(traverse_module_state->__pyx_n_s_k2);
+  Py_VISIT(traverse_module_state->__pyx_n_s_main);
+  Py_VISIT(traverse_module_state->__pyx_n_s_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_nk);
+  Py_VISIT(traverse_module_state->__pyx_n_s_nl);
+  Py_VISIT(traverse_module_state->__pyx_n_s_np);
+  Py_VISIT(traverse_module_state->__pyx_n_s_numpy);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_numpy_core_multiarray_failed_to);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_numpy_core_umath_failed_to_impor);
+  Py_VISIT(traverse_module_state->__pyx_n_s_range);
+  Py_VISIT(traverse_module_state->__pyx_n_s_seg_flux);
+  Py_VISIT(traverse_module_state->__pyx_n_s_seg_id);
+  Py_VISIT(traverse_module_state->__pyx_n_s_segm);
+  Py_VISIT(traverse_module_state->__pyx_n_s_sh_thumb);
+  Py_VISIT(traverse_module_state->__pyx_n_s_shd);
+  Py_VISIT(traverse_module_state->__pyx_n_s_shg);
+  Py_VISIT(traverse_module_state->__pyx_n_s_shx);
+  Py_VISIT(traverse_module_state->__pyx_n_s_shy);
+  Py_VISIT(traverse_module_state->__pyx_n_s_spec);
+  Py_VISIT(traverse_module_state->__pyx_n_s_test);
+  Py_VISIT(traverse_module_state->__pyx_n_s_wht_ij);
+  Py_VISIT(traverse_module_state->__pyx_n_s_x0);
+  Py_VISIT(traverse_module_state->__pyx_n_s_yfrac);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ysens);
+  Py_VISIT(traverse_module_state->__pyx_tuple_);
+  Py_VISIT(traverse_module_state->__pyx_tuple__2);
+  Py_VISIT(traverse_module_state->__pyx_tuple__4);
+  Py_VISIT(traverse_module_state->__pyx_tuple__6);
+  Py_VISIT(traverse_module_state->__pyx_tuple__8);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__5);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__7);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__9);
+  return 0;
+}
+#endif
+/* #### Code section: module_state_defines ### */
+#define __pyx_d __pyx_mstate_global->__pyx_d
+#define __pyx_b __pyx_mstate_global->__pyx_b
+#define __pyx_cython_runtime __pyx_mstate_global->__pyx_cython_runtime
+#define __pyx_empty_tuple __pyx_mstate_global->__pyx_empty_tuple
+#define __pyx_empty_bytes __pyx_mstate_global->__pyx_empty_bytes
+#define __pyx_empty_unicode __pyx_mstate_global->__pyx_empty_unicode
+#ifdef __Pyx_CyFunction_USED
+#define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
+#endif
+#ifdef __Pyx_FusedFunction_USED
+#define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
+#endif
+#ifdef __Pyx_Generator_USED
+#define __pyx_GeneratorType __pyx_mstate_global->__pyx_GeneratorType
+#endif
+#ifdef __Pyx_IterableCoroutine_USED
+#define __pyx_IterableCoroutineType __pyx_mstate_global->__pyx_IterableCoroutineType
+#endif
+#ifdef __Pyx_Coroutine_USED
+#define __pyx_CoroutineAwaitType __pyx_mstate_global->__pyx_CoroutineAwaitType
+#endif
+#ifdef __Pyx_Coroutine_USED
+#define __pyx_CoroutineType __pyx_mstate_global->__pyx_CoroutineType
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#define __pyx_ptype_7cpython_4type_type __pyx_mstate_global->__pyx_ptype_7cpython_4type_type
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#define __pyx_ptype_5numpy_dtype __pyx_mstate_global->__pyx_ptype_5numpy_dtype
+#define __pyx_ptype_5numpy_flatiter __pyx_mstate_global->__pyx_ptype_5numpy_flatiter
+#define __pyx_ptype_5numpy_broadcast __pyx_mstate_global->__pyx_ptype_5numpy_broadcast
+#define __pyx_ptype_5numpy_ndarray __pyx_mstate_global->__pyx_ptype_5numpy_ndarray
+#define __pyx_ptype_5numpy_generic __pyx_mstate_global->__pyx_ptype_5numpy_generic
+#define __pyx_ptype_5numpy_number __pyx_mstate_global->__pyx_ptype_5numpy_number
+#define __pyx_ptype_5numpy_integer __pyx_mstate_global->__pyx_ptype_5numpy_integer
+#define __pyx_ptype_5numpy_signedinteger __pyx_mstate_global->__pyx_ptype_5numpy_signedinteger
+#define __pyx_ptype_5numpy_unsignedinteger __pyx_mstate_global->__pyx_ptype_5numpy_unsignedinteger
+#define __pyx_ptype_5numpy_inexact __pyx_mstate_global->__pyx_ptype_5numpy_inexact
+#define __pyx_ptype_5numpy_floating __pyx_mstate_global->__pyx_ptype_5numpy_floating
+#define __pyx_ptype_5numpy_complexfloating __pyx_mstate_global->__pyx_ptype_5numpy_complexfloating
+#define __pyx_ptype_5numpy_flexible __pyx_mstate_global->__pyx_ptype_5numpy_flexible
+#define __pyx_ptype_5numpy_character __pyx_mstate_global->__pyx_ptype_5numpy_character
+#define __pyx_ptype_5numpy_ufunc __pyx_mstate_global->__pyx_ptype_5numpy_ufunc
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#define __pyx_n_s_DTYPE __pyx_mstate_global->__pyx_n_s_DTYPE
+#define __pyx_n_s_ITYPE __pyx_mstate_global->__pyx_n_s_ITYPE
+#define __pyx_n_s_ImportError __pyx_mstate_global->__pyx_n_s_ImportError
+#define __pyx_n_s__10 __pyx_mstate_global->__pyx_n_s__10
+#define __pyx_n_s__3 __pyx_mstate_global->__pyx_n_s__3
+#define __pyx_n_s_area __pyx_mstate_global->__pyx_n_s_area
+#define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
+#define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
+#define __pyx_n_s_compute_segmentation_limits __pyx_mstate_global->__pyx_n_s_compute_segmentation_limits
+#define __pyx_n_s_denom __pyx_mstate_global->__pyx_n_s_denom
+#define __pyx_n_s_disperse_grism_object __pyx_mstate_global->__pyx_n_s_disperse_grism_object
+#define __pyx_n_s_fl_ij __pyx_mstate_global->__pyx_n_s_fl_ij
+#define __pyx_n_s_flam __pyx_mstate_global->__pyx_n_s_flam
+#define __pyx_n_s_float64 __pyx_mstate_global->__pyx_n_s_float64
+#define __pyx_n_s_full __pyx_mstate_global->__pyx_n_s_full
+#define __pyx_n_s_grizli_utils_c_disperse __pyx_mstate_global->__pyx_n_s_grizli_utils_c_disperse
+#define __pyx_kp_s_grizli_utils_c_disperse_pyx __pyx_mstate_global->__pyx_kp_s_grizli_utils_c_disperse_pyx
+#define __pyx_n_s_i __pyx_mstate_global->__pyx_n_s_i
+#define __pyx_n_s_idxl __pyx_mstate_global->__pyx_n_s_idxl
+#define __pyx_n_s_imax __pyx_mstate_global->__pyx_n_s_imax
+#define __pyx_n_s_imin __pyx_mstate_global->__pyx_n_s_imin
+#define __pyx_n_s_import __pyx_mstate_global->__pyx_n_s_import
+#define __pyx_n_s_initializing __pyx_mstate_global->__pyx_n_s_initializing
+#define __pyx_n_s_int64 __pyx_mstate_global->__pyx_n_s_int64
+#define __pyx_n_s_inumer __pyx_mstate_global->__pyx_n_s_inumer
+#define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
+#define __pyx_n_s_j __pyx_mstate_global->__pyx_n_s_j
+#define __pyx_n_s_jmax __pyx_mstate_global->__pyx_n_s_jmax
+#define __pyx_n_s_jmin __pyx_mstate_global->__pyx_n_s_jmin
+#define __pyx_n_s_jnumer __pyx_mstate_global->__pyx_n_s_jnumer
+#define __pyx_n_s_k __pyx_mstate_global->__pyx_n_s_k
+#define __pyx_n_s_k1 __pyx_mstate_global->__pyx_n_s_k1
+#define __pyx_n_s_k2 __pyx_mstate_global->__pyx_n_s_k2
+#define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
+#define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
+#define __pyx_n_s_nk __pyx_mstate_global->__pyx_n_s_nk
+#define __pyx_n_s_nl __pyx_mstate_global->__pyx_n_s_nl
+#define __pyx_n_s_np __pyx_mstate_global->__pyx_n_s_np
+#define __pyx_n_s_numpy __pyx_mstate_global->__pyx_n_s_numpy
+#define __pyx_kp_u_numpy_core_multiarray_failed_to __pyx_mstate_global->__pyx_kp_u_numpy_core_multiarray_failed_to
+#define __pyx_kp_u_numpy_core_umath_failed_to_impor __pyx_mstate_global->__pyx_kp_u_numpy_core_umath_failed_to_impor
+#define __pyx_n_s_range __pyx_mstate_global->__pyx_n_s_range
+#define __pyx_n_s_seg_flux __pyx_mstate_global->__pyx_n_s_seg_flux
+#define __pyx_n_s_seg_id __pyx_mstate_global->__pyx_n_s_seg_id
+#define __pyx_n_s_segm __pyx_mstate_global->__pyx_n_s_segm
+#define __pyx_n_s_sh_thumb __pyx_mstate_global->__pyx_n_s_sh_thumb
+#define __pyx_n_s_shd __pyx_mstate_global->__pyx_n_s_shd
+#define __pyx_n_s_shg __pyx_mstate_global->__pyx_n_s_shg
+#define __pyx_n_s_shx __pyx_mstate_global->__pyx_n_s_shx
+#define __pyx_n_s_shy __pyx_mstate_global->__pyx_n_s_shy
+#define __pyx_n_s_spec __pyx_mstate_global->__pyx_n_s_spec
+#define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
+#define __pyx_n_s_wht_ij __pyx_mstate_global->__pyx_n_s_wht_ij
+#define __pyx_n_s_x0 __pyx_mstate_global->__pyx_n_s_x0
+#define __pyx_n_s_yfrac __pyx_mstate_global->__pyx_n_s_yfrac
+#define __pyx_n_s_ysens __pyx_mstate_global->__pyx_n_s_ysens
+#define __pyx_tuple_ __pyx_mstate_global->__pyx_tuple_
+#define __pyx_tuple__2 __pyx_mstate_global->__pyx_tuple__2
+#define __pyx_tuple__4 __pyx_mstate_global->__pyx_tuple__4
+#define __pyx_tuple__6 __pyx_mstate_global->__pyx_tuple__6
+#define __pyx_tuple__8 __pyx_mstate_global->__pyx_tuple__8
+#define __pyx_codeobj__5 __pyx_mstate_global->__pyx_codeobj__5
+#define __pyx_codeobj__7 __pyx_mstate_global->__pyx_codeobj__7
+#define __pyx_codeobj__9 __pyx_mstate_global->__pyx_codeobj__9
+/* #### Code section: module_code ### */
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":246
+ * 
+ *         @property
+ *         cdef inline PyObject* base(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns a borrowed reference to the object owning the data/memory.
+ *             """
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_7ndarray_4base_base(PyArrayObject *__pyx_v_self) {
+  PyObject *__pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":249
+ *             """Returns a borrowed reference to the object owning the data/memory.
+ *             """
+ *             return PyArray_BASE(self)             # <<<<<<<<<<<<<<
+ * 
+ *         @property
+ */
+  __pyx_r = PyArray_BASE(__pyx_v_self);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":246
+ * 
+ *         @property
+ *         cdef inline PyObject* base(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns a borrowed reference to the object owning the data/memory.
+ *             """
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":252
+ * 
+ *         @property
+ *         cdef inline dtype descr(self):             # <<<<<<<<<<<<<<
+ *             """Returns an owned reference to the dtype of the array.
+ *             """
+ */
+
+static CYTHON_INLINE PyArray_Descr *__pyx_f_5numpy_7ndarray_5descr_descr(PyArrayObject *__pyx_v_self) {
+  PyArray_Descr *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyArray_Descr *__pyx_t_1;
+  __Pyx_RefNannySetupContext("descr", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":255
+ *             """Returns an owned reference to the dtype of the array.
+ *             """
+ *             return <dtype>PyArray_DESCR(self)             # <<<<<<<<<<<<<<
+ * 
+ *         @property
+ */
+  __Pyx_XDECREF((PyObject *)__pyx_r);
+  __pyx_t_1 = PyArray_DESCR(__pyx_v_self);
+  __Pyx_INCREF((PyObject *)((PyArray_Descr *)__pyx_t_1));
+  __pyx_r = ((PyArray_Descr *)__pyx_t_1);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":252
+ * 
+ *         @property
+ *         cdef inline dtype descr(self):             # <<<<<<<<<<<<<<
+ *             """Returns an owned reference to the dtype of the array.
+ *             """
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":258
+ * 
+ *         @property
+ *         cdef inline int ndim(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns the number of dimensions in the array.
+ *             """
+ */
+
+static CYTHON_INLINE int __pyx_f_5numpy_7ndarray_4ndim_ndim(PyArrayObject *__pyx_v_self) {
+  int __pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":261
+ *             """Returns the number of dimensions in the array.
+ *             """
+ *             return PyArray_NDIM(self)             # <<<<<<<<<<<<<<
+ * 
+ *         @property
+ */
+  __pyx_r = PyArray_NDIM(__pyx_v_self);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":258
+ * 
+ *         @property
+ *         cdef inline int ndim(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns the number of dimensions in the array.
+ *             """
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":264
+ * 
+ *         @property
+ *         cdef inline npy_intp *shape(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns a pointer to the dimensions/shape of the array.
+ *             The number of elements matches the number of dimensions of the array (ndim).
+ */
+
+static CYTHON_INLINE npy_intp *__pyx_f_5numpy_7ndarray_5shape_shape(PyArrayObject *__pyx_v_self) {
+  npy_intp *__pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":269
+ *             Can return NULL for 0-dimensional arrays.
+ *             """
+ *             return PyArray_DIMS(self)             # <<<<<<<<<<<<<<
+ * 
+ *         @property
+ */
+  __pyx_r = PyArray_DIMS(__pyx_v_self);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":264
+ * 
+ *         @property
+ *         cdef inline npy_intp *shape(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns a pointer to the dimensions/shape of the array.
+ *             The number of elements matches the number of dimensions of the array (ndim).
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":272
+ * 
+ *         @property
+ *         cdef inline npy_intp *strides(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns a pointer to the strides of the array.
+ *             The number of elements matches the number of dimensions of the array (ndim).
+ */
+
+static CYTHON_INLINE npy_intp *__pyx_f_5numpy_7ndarray_7strides_strides(PyArrayObject *__pyx_v_self) {
+  npy_intp *__pyx_r;
 
-/* "grizli/utils_c/disperse.pyx":26
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":276
+ *             The number of elements matches the number of dimensions of the array (ndim).
+ *             """
+ *             return PyArray_STRIDES(self)             # <<<<<<<<<<<<<<
+ * 
+ *         @property
+ */
+  __pyx_r = PyArray_STRIDES(__pyx_v_self);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":272
+ * 
+ *         @property
+ *         cdef inline npy_intp *strides(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns a pointer to the strides of the array.
+ *             The number of elements matches the number of dimensions of the array (ndim).
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":279
+ * 
+ *         @property
+ *         cdef inline npy_intp size(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns the total size (in number of elements) of the array.
+ *             """
+ */
+
+static CYTHON_INLINE npy_intp __pyx_f_5numpy_7ndarray_4size_size(PyArrayObject *__pyx_v_self) {
+  npy_intp __pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":282
+ *             """Returns the total size (in number of elements) of the array.
+ *             """
+ *             return PyArray_SIZE(self)             # <<<<<<<<<<<<<<
+ * 
+ *         @property
+ */
+  __pyx_r = PyArray_SIZE(__pyx_v_self);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":279
+ * 
+ *         @property
+ *         cdef inline npy_intp size(self) nogil:             # <<<<<<<<<<<<<<
+ *             """Returns the total size (in number of elements) of the array.
+ *             """
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":285
+ * 
+ *         @property
+ *         cdef inline char* data(self) nogil:             # <<<<<<<<<<<<<<
+ *             """The pointer to the data buffer as a char*.
+ *             This is provided for legacy reasons to avoid direct struct field access.
+ */
+
+static CYTHON_INLINE char *__pyx_f_5numpy_7ndarray_4data_data(PyArrayObject *__pyx_v_self) {
+  char *__pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":291
+ *             of `PyArray_DATA()` instead, which returns a 'void*'.
+ *             """
+ *             return PyArray_BYTES(self)             # <<<<<<<<<<<<<<
+ * 
+ *     ctypedef unsigned char      npy_bool
+ */
+  __pyx_r = PyArray_BYTES(__pyx_v_self);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":285
+ * 
+ *         @property
+ *         cdef inline char* data(self) nogil:             # <<<<<<<<<<<<<<
+ *             """The pointer to the data buffer as a char*.
+ *             This is provided for legacy reasons to avoid direct struct field access.
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":777
+ * ctypedef npy_cdouble     complex_t
+ * 
+ * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(1, <void*>a)
+ * 
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew1(PyObject *__pyx_v_a) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":778
+ * 
+ * cdef inline object PyArray_MultiIterNew1(a):
+ *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline object PyArray_MultiIterNew2(a, b):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 778, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":777
+ * ctypedef npy_cdouble     complex_t
+ * 
+ * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(1, <void*>a)
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew1", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":780
+ *     return PyArray_MultiIterNew(1, <void*>a)
+ * 
+ * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
+ * 
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew2(PyObject *__pyx_v_a, PyObject *__pyx_v_b) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":781
+ * 
+ * cdef inline object PyArray_MultiIterNew2(a, b):
+ *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline object PyArray_MultiIterNew3(a, b, c):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 781, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":780
+ *     return PyArray_MultiIterNew(1, <void*>a)
+ * 
+ * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew2", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":783
+ *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
+ * 
+ * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
+ * 
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew3(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":784
+ * 
+ * cdef inline object PyArray_MultiIterNew3(a, b, c):
+ *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 784, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":783
+ *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
+ * 
+ * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew3", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":786
+ *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
+ * 
+ * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
+ * 
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew4(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":787
+ * 
+ * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
+ *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 787, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":786
+ *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
+ * 
+ * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew4", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":789
+ *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
+ * 
+ * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
+ * 
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew5(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d, PyObject *__pyx_v_e) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":790
+ * 
+ * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
+ *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline tuple PyDataType_SHAPE(dtype d):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 790, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":789
+ *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
+ * 
+ * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
+ *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew5", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":792
+ *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
+ * 
+ * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
+ *     if PyDataType_HASSUBARRAY(d):
+ *         return <tuple>d.subarray.shape
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":793
+ * 
+ * cdef inline tuple PyDataType_SHAPE(dtype d):
+ *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
+ *         return <tuple>d.subarray.shape
+ *     else:
+ */
+  __pyx_t_1 = PyDataType_HASSUBARRAY(__pyx_v_d);
+  if (__pyx_t_1) {
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":794
+ * cdef inline tuple PyDataType_SHAPE(dtype d):
+ *     if PyDataType_HASSUBARRAY(d):
+ *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
+ *     else:
+ *         return ()
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
+    __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
+    goto __pyx_L0;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":793
+ * 
+ * cdef inline tuple PyDataType_SHAPE(dtype d):
+ *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
+ *         return <tuple>d.subarray.shape
+ *     else:
+ */
+  }
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":796
+ *         return <tuple>d.subarray.shape
+ *     else:
+ *         return ()             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  /*else*/ {
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_empty_tuple);
+    __pyx_r = __pyx_empty_tuple;
+    goto __pyx_L0;
+  }
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":792
+ *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
+ * 
+ * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
+ *     if PyDataType_HASSUBARRAY(d):
+ *         return <tuple>d.subarray.shape
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":971
+ *     int _import_umath() except -1
+ * 
+ * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
+ *     Py_INCREF(base) # important to do this before stealing the reference below!
+ *     PyArray_SetBaseObject(arr, base)
+ */
+
+static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("set_array_base", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":972
+ * 
+ * cdef inline void set_array_base(ndarray arr, object base):
+ *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
+ *     PyArray_SetBaseObject(arr, base)
+ * 
+ */
+  Py_INCREF(__pyx_v_base);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":973
+ * cdef inline void set_array_base(ndarray arr, object base):
+ *     Py_INCREF(base) # important to do this before stealing the reference below!
+ *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline object get_array_base(ndarray arr):
+ */
+  (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":971
+ *     int _import_umath() except -1
+ * 
+ * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
+ *     Py_INCREF(base) # important to do this before stealing the reference below!
+ *     PyArray_SetBaseObject(arr, base)
+ */
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":975
+ *     PyArray_SetBaseObject(arr, base)
+ * 
+ * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
+ *     base = PyArray_BASE(arr)
+ *     if base is NULL:
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
+  PyObject *__pyx_v_base;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  __Pyx_RefNannySetupContext("get_array_base", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":976
+ * 
+ * cdef inline object get_array_base(ndarray arr):
+ *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
+ *     if base is NULL:
+ *         return None
+ */
+  __pyx_v_base = PyArray_BASE(__pyx_v_arr);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":977
+ * cdef inline object get_array_base(ndarray arr):
+ *     base = PyArray_BASE(arr)
+ *     if base is NULL:             # <<<<<<<<<<<<<<
+ *         return None
+ *     return <object>base
+ */
+  __pyx_t_1 = (__pyx_v_base == NULL);
+  if (__pyx_t_1) {
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":978
+ *     base = PyArray_BASE(arr)
+ *     if base is NULL:
+ *         return None             # <<<<<<<<<<<<<<
+ *     return <object>base
+ * 
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+    goto __pyx_L0;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":977
+ * cdef inline object get_array_base(ndarray arr):
+ *     base = PyArray_BASE(arr)
+ *     if base is NULL:             # <<<<<<<<<<<<<<
+ *         return None
+ *     return <object>base
+ */
+  }
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":979
+ *     if base is NULL:
+ *         return None
+ *     return <object>base             # <<<<<<<<<<<<<<
+ * 
+ * # Versions of the import_* functions which are more suitable for
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_base));
+  __pyx_r = ((PyObject *)__pyx_v_base);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":975
+ *     PyArray_SetBaseObject(arr, base)
+ * 
+ * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
+ *     base = PyArray_BASE(arr)
+ *     if base is NULL:
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":983
+ * # Versions of the import_* functions which are more suitable for
+ * # Cython code.
+ * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
+ *     try:
+ *         __pyx_import_array()
+ */
+
+static CYTHON_INLINE int __pyx_f_5numpy_import_array(void) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("import_array", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":984
+ * # Cython code.
+ * cdef inline int import_array() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         __pyx_import_array()
+ *     except Exception:
+ */
+  {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
+    __Pyx_XGOTREF(__pyx_t_1);
+    __Pyx_XGOTREF(__pyx_t_2);
+    __Pyx_XGOTREF(__pyx_t_3);
+    /*try:*/ {
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":985
+ * cdef inline int import_array() except -1:
+ *     try:
+ *         __pyx_import_array()             # <<<<<<<<<<<<<<
+ *     except Exception:
+ *         raise ImportError("numpy.core.multiarray failed to import")
+ */
+      __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 985, __pyx_L3_error)
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":984
+ * # Cython code.
+ * cdef inline int import_array() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         __pyx_import_array()
+ *     except Exception:
+ */
+    }
+    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    goto __pyx_L8_try_end;
+    __pyx_L3_error:;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":986
+ *     try:
+ *         __pyx_import_array()
+ *     except Exception:             # <<<<<<<<<<<<<<
+ *         raise ImportError("numpy.core.multiarray failed to import")
+ * 
+ */
+    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
+    if (__pyx_t_4) {
+      __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 986, __pyx_L5_except_error)
+      __Pyx_XGOTREF(__pyx_t_5);
+      __Pyx_XGOTREF(__pyx_t_6);
+      __Pyx_XGOTREF(__pyx_t_7);
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":987
+ *         __pyx_import_array()
+ *     except Exception:
+ *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline int import_umath() except -1:
+ */
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 987, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_8);
+      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      __PYX_ERR(1, 987, __pyx_L5_except_error)
+    }
+    goto __pyx_L5_except_error;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":984
+ * # Cython code.
+ * cdef inline int import_array() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         __pyx_import_array()
+ *     except Exception:
+ */
+    __pyx_L5_except_error:;
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L1_error;
+    __pyx_L8_try_end:;
+  }
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":983
+ * # Versions of the import_* functions which are more suitable for
+ * # Cython code.
+ * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
+ *     try:
+ *         __pyx_import_array()
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":989
+ *         raise ImportError("numpy.core.multiarray failed to import")
+ * 
+ * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
+ *     try:
+ *         _import_umath()
+ */
+
+static CYTHON_INLINE int __pyx_f_5numpy_import_umath(void) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("import_umath", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":990
+ * 
+ * cdef inline int import_umath() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         _import_umath()
+ *     except Exception:
+ */
+  {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
+    __Pyx_XGOTREF(__pyx_t_1);
+    __Pyx_XGOTREF(__pyx_t_2);
+    __Pyx_XGOTREF(__pyx_t_3);
+    /*try:*/ {
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":991
+ * cdef inline int import_umath() except -1:
+ *     try:
+ *         _import_umath()             # <<<<<<<<<<<<<<
+ *     except Exception:
+ *         raise ImportError("numpy.core.umath failed to import")
+ */
+      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 991, __pyx_L3_error)
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":990
+ * 
+ * cdef inline int import_umath() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         _import_umath()
+ *     except Exception:
+ */
+    }
+    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    goto __pyx_L8_try_end;
+    __pyx_L3_error:;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":992
+ *     try:
+ *         _import_umath()
+ *     except Exception:             # <<<<<<<<<<<<<<
+ *         raise ImportError("numpy.core.umath failed to import")
+ * 
+ */
+    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
+    if (__pyx_t_4) {
+      __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 992, __pyx_L5_except_error)
+      __Pyx_XGOTREF(__pyx_t_5);
+      __Pyx_XGOTREF(__pyx_t_6);
+      __Pyx_XGOTREF(__pyx_t_7);
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":993
+ *         _import_umath()
+ *     except Exception:
+ *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline int import_ufunc() except -1:
+ */
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 993, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_8);
+      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      __PYX_ERR(1, 993, __pyx_L5_except_error)
+    }
+    goto __pyx_L5_except_error;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":990
+ * 
+ * cdef inline int import_umath() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         _import_umath()
+ *     except Exception:
+ */
+    __pyx_L5_except_error:;
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L1_error;
+    __pyx_L8_try_end:;
+  }
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":989
+ *         raise ImportError("numpy.core.multiarray failed to import")
+ * 
+ * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
+ *     try:
+ *         _import_umath()
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":995
+ *         raise ImportError("numpy.core.umath failed to import")
+ * 
+ * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
+ *     try:
+ *         _import_umath()
+ */
+
+static CYTHON_INLINE int __pyx_f_5numpy_import_ufunc(void) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("import_ufunc", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":996
+ * 
+ * cdef inline int import_ufunc() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         _import_umath()
+ *     except Exception:
+ */
+  {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
+    __Pyx_XGOTREF(__pyx_t_1);
+    __Pyx_XGOTREF(__pyx_t_2);
+    __Pyx_XGOTREF(__pyx_t_3);
+    /*try:*/ {
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":997
+ * cdef inline int import_ufunc() except -1:
+ *     try:
+ *         _import_umath()             # <<<<<<<<<<<<<<
+ *     except Exception:
+ *         raise ImportError("numpy.core.umath failed to import")
+ */
+      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 997, __pyx_L3_error)
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":996
+ * 
+ * cdef inline int import_ufunc() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         _import_umath()
+ *     except Exception:
+ */
+    }
+    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    goto __pyx_L8_try_end;
+    __pyx_L3_error:;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":998
+ *     try:
+ *         _import_umath()
+ *     except Exception:             # <<<<<<<<<<<<<<
+ *         raise ImportError("numpy.core.umath failed to import")
+ * 
+ */
+    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
+    if (__pyx_t_4) {
+      __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 998, __pyx_L5_except_error)
+      __Pyx_XGOTREF(__pyx_t_5);
+      __Pyx_XGOTREF(__pyx_t_6);
+      __Pyx_XGOTREF(__pyx_t_7);
+
+      /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":999
+ *         _import_umath()
+ *     except Exception:
+ *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 999, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_8);
+      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      __PYX_ERR(1, 999, __pyx_L5_except_error)
+    }
+    goto __pyx_L5_except_error;
+
+    /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":996
+ * 
+ * cdef inline int import_ufunc() except -1:
+ *     try:             # <<<<<<<<<<<<<<
+ *         _import_umath()
+ *     except Exception:
+ */
+    __pyx_L5_except_error:;
+    __Pyx_XGIVEREF(__pyx_t_1);
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
+    goto __pyx_L1_error;
+    __pyx_L8_try_end:;
+  }
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":995
+ *         raise ImportError("numpy.core.umath failed to import")
+ * 
+ * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
+ *     try:
+ *         _import_umath()
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1002
+ * 
+ * 
+ * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
+ *     """
+ *     Cython equivalent of `isinstance(obj, np.timedelta64)`
+ */
+
+static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1014
+ *     bool
+ *     """
+ *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1002
+ * 
+ * 
+ * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
+ *     """
+ *     Cython equivalent of `isinstance(obj, np.timedelta64)`
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1017
+ * 
+ * 
+ * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
+ *     """
+ *     Cython equivalent of `isinstance(obj, np.datetime64)`
+ */
+
+static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("is_datetime64_object", 0);
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1029
+ *     bool
+ *     """
+ *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1017
+ * 
+ * 
+ * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
+ *     """
+ *     Cython equivalent of `isinstance(obj, np.datetime64)`
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1032
+ * 
+ * 
+ * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
+ *     """
+ *     returns the int64 value underlying scalar numpy datetime64 object
+ */
+
+static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
+  npy_datetime __pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1039
+ *     also needed.  That can be found using `get_datetime64_unit`.
+ *     """
+ *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1032
+ * 
+ * 
+ * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
+ *     """
+ *     returns the int64 value underlying scalar numpy datetime64 object
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1042
+ * 
+ * 
+ * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
+ *     """
+ *     returns the int64 value underlying scalar numpy timedelta64 object
+ */
+
+static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
+  npy_timedelta __pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1046
+ *     returns the int64 value underlying scalar numpy timedelta64 object
+ *     """
+ *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1042
+ * 
+ * 
+ * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
+ *     """
+ *     returns the int64 value underlying scalar numpy timedelta64 object
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1049
+ * 
+ * 
+ * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
+ *     """
+ *     returns the unit part of the dtype for a numpy datetime64 object.
+ */
+
+static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
+  NPY_DATETIMEUNIT __pyx_r;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1053
+ *     returns the unit part of the dtype for a numpy datetime64 object.
+ *     """
+ *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
+ */
+  __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
+  goto __pyx_L0;
+
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":1049
+ * 
+ * 
+ * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
+ *     """
+ *     returns the unit part of the dtype for a numpy datetime64 object.
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "grizli/utils_c/disperse.pyx":23
+ *     double exp(double x)
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def disperse_grism_object(np.ndarray[FTYPE_t, ndim=2] flam,             # <<<<<<<<<<<<<<
- *                           np.ndarray[FTYPE_t, ndim=2] segm,
- *                           FTYPE_t seg_id,
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_1disperse_grism_object(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6grizli_7utils_c_8disperse_disperse_grism_object[] = "disperse_grism_object(ndarray flam, ndarray segm, FTYPE_t seg_id, ndarray idxl, ndarray yfrac, ndarray ysens, ndarray full, ndarray x0, ndarray shd, ndarray sh_thumb, ndarray shg)\nCompute a dispersed 2D spectrum\n    \n    Parameters\n    ----------\n    xxx\n    ";
-static PyMethodDef __pyx_mdef_6grizli_7utils_c_8disperse_1disperse_grism_object = {"disperse_grism_object", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6grizli_7utils_c_8disperse_1disperse_grism_object, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6grizli_7utils_c_8disperse_disperse_grism_object};
-static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_1disperse_grism_object(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_1disperse_grism_object(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+PyDoc_STRVAR(__pyx_doc_6grizli_7utils_c_8disperse_disperse_grism_object, "disperse_grism_object(ndarray flam, ndarray segm, FTYPE_t seg_id, ndarray idxl, ndarray yfrac, ndarray ysens, ndarray full, ndarray x0, ndarray shd, ndarray sh_thumb, ndarray shg)\nCompute a dispersed 2D spectrum\n    \n    Parameters\n    ----------\n    xxx\n    ");
+static PyMethodDef __pyx_mdef_6grizli_7utils_c_8disperse_1disperse_grism_object = {"disperse_grism_object", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6grizli_7utils_c_8disperse_1disperse_grism_object, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6grizli_7utils_c_8disperse_disperse_grism_object};
+static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_1disperse_grism_object(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
   PyArrayObject *__pyx_v_flam = 0;
   PyArrayObject *__pyx_v_segm = 0;
   __pyx_t_6grizli_7utils_c_8disperse_FTYPE_t __pyx_v_seg_id;
   PyArrayObject *__pyx_v_idxl = 0;
   PyArrayObject *__pyx_v_yfrac = 0;
   PyArrayObject *__pyx_v_ysens = 0;
   PyArrayObject *__pyx_v_full = 0;
   PyArrayObject *__pyx_v_x0 = 0;
   PyArrayObject *__pyx_v_shd = 0;
   PyArrayObject *__pyx_v_sh_thumb = 0;
   PyArrayObject *__pyx_v_shg = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("disperse_grism_object (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_flam,&__pyx_n_s_segm,&__pyx_n_s_seg_id,&__pyx_n_s_idxl,&__pyx_n_s_yfrac,&__pyx_n_s_ysens,&__pyx_n_s_full,&__pyx_n_s_x0,&__pyx_n_s_shd,&__pyx_n_s_sh_thumb,&__pyx_n_s_shg,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_flam,&__pyx_n_s_segm,&__pyx_n_s_seg_id,&__pyx_n_s_idxl,&__pyx_n_s_yfrac,&__pyx_n_s_ysens,&__pyx_n_s_full,&__pyx_n_s_x0,&__pyx_n_s_shd,&__pyx_n_s_sh_thumb,&__pyx_n_s_shg,0};
     PyObject* values[11] = {0,0,0,0,0,0,0,0,0,0,0};
-    if (unlikely(__pyx_kwds)) {
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case 11: values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
+      switch (__pyx_nargs) {
+        case 11: values[10] = __Pyx_Arg_FASTCALL(__pyx_args, 10);
         CYTHON_FALLTHROUGH;
-        case 10: values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
+        case 10: values[9] = __Pyx_Arg_FASTCALL(__pyx_args, 9);
         CYTHON_FALLTHROUGH;
-        case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
+        case  9: values[8] = __Pyx_Arg_FASTCALL(__pyx_args, 8);
         CYTHON_FALLTHROUGH;
-        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
+        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
-        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
+        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
-        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
+        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
-        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
+        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
-        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
-        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_flam)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flam)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_segm)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_segm)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 1); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 1); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
-        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_seg_id)) != 0)) kw_args--;
+        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_seg_id)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 2); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 2); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
-        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_idxl)) != 0)) kw_args--;
+        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_idxl)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 3); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 3); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
-        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yfrac)) != 0)) kw_args--;
+        if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_yfrac)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 4); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 4); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
-        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ysens)) != 0)) kw_args--;
+        if (likely((values[5] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ysens)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 5); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 5); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
-        if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_full)) != 0)) kw_args--;
+        if (likely((values[6] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_full)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 6); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 6); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
-        if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x0)) != 0)) kw_args--;
+        if (likely((values[7] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x0)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 7); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 7); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  8:
-        if (likely((values[8] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shd)) != 0)) kw_args--;
+        if (likely((values[8] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_shd)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 8); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 8); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  9:
-        if (likely((values[9] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_sh_thumb)) != 0)) kw_args--;
+        if (likely((values[9] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sh_thumb)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 9); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 9); __PYX_ERR(0, 23, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case 10:
-        if (likely((values[10] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shg)) != 0)) kw_args--;
+        if (likely((values[10] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_shg)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 10); __PYX_ERR(0, 26, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, 10); __PYX_ERR(0, 23, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "disperse_grism_object") < 0)) __PYX_ERR(0, 26, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "disperse_grism_object") < 0)) __PYX_ERR(0, 23, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 11) {
+    } else if (unlikely(__pyx_nargs != 11)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
-      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-      values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
-      values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
-      values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
-      values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
-      values[9] = PyTuple_GET_ITEM(__pyx_args, 9);
-      values[10] = PyTuple_GET_ITEM(__pyx_args, 10);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+      values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
+      values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
+      values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
+      values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
+      values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
+      values[8] = __Pyx_Arg_FASTCALL(__pyx_args, 8);
+      values[9] = __Pyx_Arg_FASTCALL(__pyx_args, 9);
+      values[10] = __Pyx_Arg_FASTCALL(__pyx_args, 10);
     }
     __pyx_v_flam = ((PyArrayObject *)values[0]);
     __pyx_v_segm = ((PyArrayObject *)values[1]);
     __pyx_v_seg_id = __pyx_PyFloat_AsFloat(values[2]); if (unlikely((__pyx_v_seg_id == ((npy_float32)-1)) && PyErr_Occurred())) __PYX_ERR(0, 28, __pyx_L3_error)
     __pyx_v_idxl = ((PyArrayObject *)values[3]);
     __pyx_v_yfrac = ((PyArrayObject *)values[4]);
     __pyx_v_ysens = ((PyArrayObject *)values[5]);
@@ -2141,15 +4459,15 @@
     __pyx_v_x0 = ((PyArrayObject *)values[7]);
     __pyx_v_shd = ((PyArrayObject *)values[8]);
     __pyx_v_sh_thumb = ((PyArrayObject *)values[9]);
     __pyx_v_shg = ((PyArrayObject *)values[10]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 26, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("disperse_grism_object", 1, 11, 11, __pyx_nargs); __PYX_ERR(0, 23, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("grizli.utils_c.disperse.disperse_grism_object", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_flam), __pyx_ptype_5numpy_ndarray, 1, "flam", 0))) __PYX_ERR(0, 26, __pyx_L1_error)
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_segm), __pyx_ptype_5numpy_ndarray, 1, "segm", 0))) __PYX_ERR(0, 27, __pyx_L1_error)
@@ -2265,60 +4583,60 @@
   __pyx_pybuffernd_sh_thumb.rcbuffer = &__pyx_pybuffer_sh_thumb;
   __pyx_pybuffer_shg.pybuffer.buf = NULL;
   __pyx_pybuffer_shg.refcount = 0;
   __pyx_pybuffernd_shg.data = NULL;
   __pyx_pybuffernd_shg.rcbuffer = &__pyx_pybuffer_shg;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_flam.rcbuffer->pybuffer, (PyObject*)__pyx_v_flam, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_flam.rcbuffer->pybuffer, (PyObject*)__pyx_v_flam, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_flam.diminfo[0].strides = __pyx_pybuffernd_flam.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_flam.diminfo[0].shape = __pyx_pybuffernd_flam.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_flam.diminfo[1].strides = __pyx_pybuffernd_flam.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_flam.diminfo[1].shape = __pyx_pybuffernd_flam.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_segm.rcbuffer->pybuffer, (PyObject*)__pyx_v_segm, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_segm.rcbuffer->pybuffer, (PyObject*)__pyx_v_segm, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_segm.diminfo[0].strides = __pyx_pybuffernd_segm.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_segm.diminfo[0].shape = __pyx_pybuffernd_segm.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_segm.diminfo[1].strides = __pyx_pybuffernd_segm.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_segm.diminfo[1].shape = __pyx_pybuffernd_segm.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_idxl.rcbuffer->pybuffer, (PyObject*)__pyx_v_idxl, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_idxl.rcbuffer->pybuffer, (PyObject*)__pyx_v_idxl, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_idxl.diminfo[0].strides = __pyx_pybuffernd_idxl.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_idxl.diminfo[0].shape = __pyx_pybuffernd_idxl.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_yfrac.rcbuffer->pybuffer, (PyObject*)__pyx_v_yfrac, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_yfrac.rcbuffer->pybuffer, (PyObject*)__pyx_v_yfrac, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_yfrac.diminfo[0].strides = __pyx_pybuffernd_yfrac.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_yfrac.diminfo[0].shape = __pyx_pybuffernd_yfrac.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ysens.rcbuffer->pybuffer, (PyObject*)__pyx_v_ysens, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ysens.rcbuffer->pybuffer, (PyObject*)__pyx_v_ysens, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_ysens.diminfo[0].strides = __pyx_pybuffernd_ysens.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ysens.diminfo[0].shape = __pyx_pybuffernd_ysens.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_full.rcbuffer->pybuffer, (PyObject*)__pyx_v_full, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_full.rcbuffer->pybuffer, (PyObject*)__pyx_v_full, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_full.diminfo[0].strides = __pyx_pybuffernd_full.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_full.diminfo[0].shape = __pyx_pybuffernd_full.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x0.rcbuffer->pybuffer, (PyObject*)__pyx_v_x0, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x0.rcbuffer->pybuffer, (PyObject*)__pyx_v_x0, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_x0.diminfo[0].strides = __pyx_pybuffernd_x0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_x0.diminfo[0].shape = __pyx_pybuffernd_x0.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shd.rcbuffer->pybuffer, (PyObject*)__pyx_v_shd, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shd.rcbuffer->pybuffer, (PyObject*)__pyx_v_shd, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_shd.diminfo[0].strides = __pyx_pybuffernd_shd.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_shd.diminfo[0].shape = __pyx_pybuffernd_shd.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_sh_thumb.rcbuffer->pybuffer, (PyObject*)__pyx_v_sh_thumb, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_sh_thumb.rcbuffer->pybuffer, (PyObject*)__pyx_v_sh_thumb, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_sh_thumb.diminfo[0].strides = __pyx_pybuffernd_sh_thumb.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_sh_thumb.diminfo[0].shape = __pyx_pybuffernd_sh_thumb.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shg.rcbuffer->pybuffer, (PyObject*)__pyx_v_shg, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 26, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shg.rcbuffer->pybuffer, (PyObject*)__pyx_v_shg, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 23, __pyx_L1_error)
   }
   __pyx_pybuffernd_shg.diminfo[0].strides = __pyx_pybuffernd_shg.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_shg.diminfo[0].shape = __pyx_pybuffernd_shg.rcbuffer->pybuffer.shape[0];
 
   /* "grizli/utils_c/disperse.pyx":47
  *     cdef double fl_ij
  * 
  *     nk = len(idxl)             # <<<<<<<<<<<<<<
@@ -2358,15 +4676,15 @@
  *         if (x0[1]+i < 0) | (x0[1]+i >= shd[1]):             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     __pyx_t_6 = 1;
     __pyx_t_7 = 1;
     __pyx_t_8 = 1;
-    __pyx_t_9 = (((((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_i) < 0) | (((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_i) >= (*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_shd.rcbuffer->pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_shd.diminfo[0].strides)))) != 0);
+    __pyx_t_9 = ((((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_i) < 0) | (((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_i) >= (*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_shd.rcbuffer->pybuffer.buf, __pyx_t_8, __pyx_pybuffernd_shd.diminfo[0].strides))));
     if (__pyx_t_9) {
 
       /* "grizli/utils_c/disperse.pyx":52
  *     for i in range(0-sh_thumb[1], sh_thumb[1]):
  *         if (x0[1]+i < 0) | (x0[1]+i >= shd[1]):
  *             continue             # <<<<<<<<<<<<<<
  * 
@@ -2403,15 +4721,15 @@
  *             if (x0[0]+j < 0) | (x0[0]+j >= shd[0]):             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
       __pyx_t_7 = 0;
       __pyx_t_6 = 0;
       __pyx_t_13 = 0;
-      __pyx_t_9 = (((((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_j) < 0) | (((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_j) >= (*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_shd.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_shd.diminfo[0].strides)))) != 0);
+      __pyx_t_9 = ((((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_7, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_j) < 0) | (((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_j) >= (*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_shd.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_shd.diminfo[0].strides))));
       if (__pyx_t_9) {
 
         /* "grizli/utils_c/disperse.pyx":56
  *         for j in range(0-sh_thumb[0], sh_thumb[0]):
  *             if (x0[0]+j < 0) | (x0[0]+j >= shd[0]):
  *                 continue             # <<<<<<<<<<<<<<
  * 
@@ -2448,15 +4766,15 @@
  *                 continue
  * 
  */
       __pyx_t_6 = 0;
       __pyx_t_13 = 1;
       __pyx_t_15 = ((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_6, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_j);
       __pyx_t_14 = ((*__Pyx_BufPtrStrided1d(__pyx_t_6grizli_7utils_c_8disperse_LINT_t *, __pyx_pybuffernd_x0.rcbuffer->pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_x0.diminfo[0].strides)) + __pyx_v_i);
-      __pyx_t_9 = (((__pyx_v_fl_ij == 0.0) | ((*__Pyx_BufPtrStrided2d(__pyx_t_6grizli_7utils_c_8disperse_FTYPE_t *, __pyx_pybuffernd_segm.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_segm.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_segm.diminfo[1].strides)) != __pyx_v_seg_id)) != 0);
+      __pyx_t_9 = ((__pyx_v_fl_ij == 0.0) | ((*__Pyx_BufPtrStrided2d(__pyx_t_6grizli_7utils_c_8disperse_FTYPE_t *, __pyx_pybuffernd_segm.rcbuffer->pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_segm.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_segm.diminfo[1].strides)) != __pyx_v_seg_id));
       if (__pyx_t_9) {
 
         /* "grizli/utils_c/disperse.pyx":60
  *             fl_ij = flam[x0[0]+j, x0[1]+i] #/1.e-17
  *             if (fl_ij == 0) | (segm[x0[0]+j, x0[1]+i] != seg_id):
  *                 continue             # <<<<<<<<<<<<<<
  * 
@@ -2499,15 +4817,15 @@
         /* "grizli/utils_c/disperse.pyx":64
  *             for k in range(nk):
  *                 k1 = idxl[k]+j*shg[1]+i
  *                 if (k1 >= 0) & (k1 < nl):             # <<<<<<<<<<<<<<
  *                     full[k1] += ysens[k]*fl_ij*yfrac[k]
  * 
  */
-        __pyx_t_9 = (((__pyx_v_k1 >= 0) & (__pyx_v_k1 < __pyx_v_nl)) != 0);
+        __pyx_t_9 = ((__pyx_v_k1 >= 0) & (__pyx_v_k1 < __pyx_v_nl));
         if (__pyx_t_9) {
 
           /* "grizli/utils_c/disperse.pyx":65
  *                 k1 = idxl[k]+j*shg[1]+i
  *                 if (k1 >= 0) & (k1 < nl):
  *                     full[k1] += ysens[k]*fl_ij*yfrac[k]             # <<<<<<<<<<<<<<
  * 
@@ -2541,15 +4859,15 @@
         /* "grizli/utils_c/disperse.pyx":68
  * 
  *                 k2 = idxl[k]+(j-1)*shg[1]+i
  *                 if (k2 >= 0) & (k2 < nl):             # <<<<<<<<<<<<<<
  *                     full[k2] += ysens[k]*fl_ij*(1-yfrac[k])
  * 
  */
-        __pyx_t_9 = (((__pyx_v_k2 >= 0) & (__pyx_v_k2 < __pyx_v_nl)) != 0);
+        __pyx_t_9 = ((__pyx_v_k2 >= 0) & (__pyx_v_k2 < __pyx_v_nl));
         if (__pyx_t_9) {
 
           /* "grizli/utils_c/disperse.pyx":69
  *                 k2 = idxl[k]+(j-1)*shg[1]+i
  *                 if (k2 >= 0) & (k2 < nl):
  *                     full[k2] += ysens[k]*fl_ij*(1-yfrac[k])             # <<<<<<<<<<<<<<
  * 
@@ -2582,20 +4900,20 @@
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(Py_True);
   __pyx_r = Py_True;
   goto __pyx_L0;
 
-  /* "grizli/utils_c/disperse.pyx":26
+  /* "grizli/utils_c/disperse.pyx":23
+ *     double exp(double x)
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def disperse_grism_object(np.ndarray[FTYPE_t, ndim=2] flam,             # <<<<<<<<<<<<<<
- *                           np.ndarray[FTYPE_t, ndim=2] segm,
- *                           FTYPE_t seg_id,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
@@ -2627,98 +4945,118 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ysens.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "grizli/utils_c/disperse.pyx":76
+/* "grizli/utils_c/disperse.pyx":73
+ *     return True
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def compute_segmentation_limits(np.ndarray[FTYPE_t, ndim=2] segm,             # <<<<<<<<<<<<<<
- *                                 int seg_id,
- *                                 np.ndarray[FTYPE_t, ndim=2] flam,
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_3compute_segmentation_limits(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6grizli_7utils_c_8disperse_2compute_segmentation_limits[] = "compute_segmentation_limits(ndarray segm, int seg_id, ndarray flam, ndarray shd)\nFind pixel limits of a segmentation region\n    \n    Parameters\n    ----------\n    segm: ndarray (np.float32)\n        segmentation array\n    \n    seg_id: int\n        ID to test\n    \n    flam: ndarray (float)\n        Flux array to compute weighted centroid within segmentation region\n        \n    shd: [int, int]\n        Shape of segm\n    ";
-static PyMethodDef __pyx_mdef_6grizli_7utils_c_8disperse_3compute_segmentation_limits = {"compute_segmentation_limits", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6grizli_7utils_c_8disperse_3compute_segmentation_limits, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6grizli_7utils_c_8disperse_2compute_segmentation_limits};
-static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_3compute_segmentation_limits(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_3compute_segmentation_limits(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+PyDoc_STRVAR(__pyx_doc_6grizli_7utils_c_8disperse_2compute_segmentation_limits, "compute_segmentation_limits(ndarray segm, int seg_id, ndarray flam, ndarray shd)\nFind pixel limits of a segmentation region\n    \n    Parameters\n    ----------\n    segm: ndarray (np.float32)\n        segmentation array\n    \n    seg_id: int\n        ID to test\n    \n    flam: ndarray (float)\n        Flux array to compute weighted centroid within segmentation region\n        \n    shd: [int, int]\n        Shape of segm\n    ");
+static PyMethodDef __pyx_mdef_6grizli_7utils_c_8disperse_3compute_segmentation_limits = {"compute_segmentation_limits", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6grizli_7utils_c_8disperse_3compute_segmentation_limits, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6grizli_7utils_c_8disperse_2compute_segmentation_limits};
+static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_3compute_segmentation_limits(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
   PyArrayObject *__pyx_v_segm = 0;
   int __pyx_v_seg_id;
   PyArrayObject *__pyx_v_flam = 0;
   PyArrayObject *__pyx_v_shd = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("compute_segmentation_limits (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_segm,&__pyx_n_s_seg_id,&__pyx_n_s_flam,&__pyx_n_s_shd,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_segm,&__pyx_n_s_seg_id,&__pyx_n_s_flam,&__pyx_n_s_shd,0};
     PyObject* values[4] = {0,0,0,0};
-    if (unlikely(__pyx_kwds)) {
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+      switch (__pyx_nargs) {
+        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
-        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_segm)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_segm)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_seg_id)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_seg_id)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, 1); __PYX_ERR(0, 76, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, 1); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
-        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_flam)) != 0)) kw_args--;
+        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flam)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, 2); __PYX_ERR(0, 76, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, 2); __PYX_ERR(0, 73, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
-        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shd)) != 0)) kw_args--;
+        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_shd)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, 3); __PYX_ERR(0, 76, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, 3); __PYX_ERR(0, 73, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "compute_segmentation_limits") < 0)) __PYX_ERR(0, 76, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_segmentation_limits") < 0)) __PYX_ERR(0, 73, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
+    } else if (unlikely(__pyx_nargs != 4)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+      values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
     }
     __pyx_v_segm = ((PyArrayObject *)values[0]);
     __pyx_v_seg_id = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_seg_id == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 77, __pyx_L3_error)
     __pyx_v_flam = ((PyArrayObject *)values[2]);
     __pyx_v_shd = ((PyArrayObject *)values[3]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 76, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("compute_segmentation_limits", 1, 4, 4, __pyx_nargs); __PYX_ERR(0, 73, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("grizli.utils_c.disperse.compute_segmentation_limits", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_segm), __pyx_ptype_5numpy_ndarray, 1, "segm", 0))) __PYX_ERR(0, 76, __pyx_L1_error)
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_flam), __pyx_ptype_5numpy_ndarray, 1, "flam", 0))) __PYX_ERR(0, 78, __pyx_L1_error)
@@ -2786,25 +5124,25 @@
   __pyx_pybuffernd_flam.rcbuffer = &__pyx_pybuffer_flam;
   __pyx_pybuffer_shd.pybuffer.buf = NULL;
   __pyx_pybuffer_shd.refcount = 0;
   __pyx_pybuffernd_shd.data = NULL;
   __pyx_pybuffernd_shd.rcbuffer = &__pyx_pybuffer_shd;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_segm.rcbuffer->pybuffer, (PyObject*)__pyx_v_segm, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 76, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_segm.rcbuffer->pybuffer, (PyObject*)__pyx_v_segm, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 73, __pyx_L1_error)
   }
   __pyx_pybuffernd_segm.diminfo[0].strides = __pyx_pybuffernd_segm.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_segm.diminfo[0].shape = __pyx_pybuffernd_segm.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_segm.diminfo[1].strides = __pyx_pybuffernd_segm.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_segm.diminfo[1].shape = __pyx_pybuffernd_segm.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_flam.rcbuffer->pybuffer, (PyObject*)__pyx_v_flam, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 76, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_flam.rcbuffer->pybuffer, (PyObject*)__pyx_v_flam, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 73, __pyx_L1_error)
   }
   __pyx_pybuffernd_flam.diminfo[0].strides = __pyx_pybuffernd_flam.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_flam.diminfo[0].shape = __pyx_pybuffernd_flam.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_flam.diminfo[1].strides = __pyx_pybuffernd_flam.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_flam.diminfo[1].shape = __pyx_pybuffernd_flam.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shd.rcbuffer->pybuffer, (PyObject*)__pyx_v_shd, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 76, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shd.rcbuffer->pybuffer, (PyObject*)__pyx_v_shd, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 73, __pyx_L1_error)
   }
   __pyx_pybuffernd_shd.diminfo[0].strides = __pyx_pybuffernd_shd.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_shd.diminfo[0].shape = __pyx_pybuffernd_shd.rcbuffer->pybuffer.shape[0];
 
   /* "grizli/utils_c/disperse.pyx":99
  *     cdef double inumer, jnumer, denom, wht_ij
  * 
  *     area = 0             # <<<<<<<<<<<<<<
@@ -2909,15 +5247,15 @@
  *         for j in range(shd[1]):
  *             if segm[i,j] != seg_id:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
       __pyx_t_1 = __pyx_v_i;
       __pyx_t_8 = __pyx_v_j;
-      __pyx_t_9 = (((*__Pyx_BufPtrStrided2d(__pyx_t_6grizli_7utils_c_8disperse_FTYPE_t *, __pyx_pybuffernd_segm.rcbuffer->pybuffer.buf, __pyx_t_1, __pyx_pybuffernd_segm.diminfo[0].strides, __pyx_t_8, __pyx_pybuffernd_segm.diminfo[1].strides)) != __pyx_v_seg_id) != 0);
+      __pyx_t_9 = ((*__Pyx_BufPtrStrided2d(__pyx_t_6grizli_7utils_c_8disperse_FTYPE_t *, __pyx_pybuffernd_segm.rcbuffer->pybuffer.buf, __pyx_t_1, __pyx_pybuffernd_segm.diminfo[0].strides, __pyx_t_8, __pyx_pybuffernd_segm.diminfo[1].strides)) != __pyx_v_seg_id);
       if (__pyx_t_9) {
 
         /* "grizli/utils_c/disperse.pyx":113
  *         for j in range(shd[1]):
  *             if segm[i,j] != seg_id:
  *                 continue             # <<<<<<<<<<<<<<
  * 
@@ -2984,15 +5322,15 @@
       /* "grizli/utils_c/disperse.pyx":121
  *             denom += wht_ij
  * 
  *             if i < imin:             # <<<<<<<<<<<<<<
  *                 imin = i
  *             if i > imax:
  */
-      __pyx_t_9 = ((__pyx_v_i < __pyx_v_imin) != 0);
+      __pyx_t_9 = (__pyx_v_i < __pyx_v_imin);
       if (__pyx_t_9) {
 
         /* "grizli/utils_c/disperse.pyx":122
  * 
  *             if i < imin:
  *                 imin = i             # <<<<<<<<<<<<<<
  *             if i > imax:
@@ -3012,15 +5350,15 @@
       /* "grizli/utils_c/disperse.pyx":123
  *             if i < imin:
  *                 imin = i
  *             if i > imax:             # <<<<<<<<<<<<<<
  *                 imax = i
  * 
  */
-      __pyx_t_9 = ((__pyx_v_i > __pyx_v_imax) != 0);
+      __pyx_t_9 = (__pyx_v_i > __pyx_v_imax);
       if (__pyx_t_9) {
 
         /* "grizli/utils_c/disperse.pyx":124
  *                 imin = i
  *             if i > imax:
  *                 imax = i             # <<<<<<<<<<<<<<
  * 
@@ -3040,15 +5378,15 @@
       /* "grizli/utils_c/disperse.pyx":126
  *                 imax = i
  * 
  *             if j < jmin:             # <<<<<<<<<<<<<<
  *                 jmin = j
  *             if j > jmax:
  */
-      __pyx_t_9 = ((__pyx_v_j < __pyx_v_jmin) != 0);
+      __pyx_t_9 = (__pyx_v_j < __pyx_v_jmin);
       if (__pyx_t_9) {
 
         /* "grizli/utils_c/disperse.pyx":127
  * 
  *             if j < jmin:
  *                 jmin = j             # <<<<<<<<<<<<<<
  *             if j > jmax:
@@ -3068,15 +5406,15 @@
       /* "grizli/utils_c/disperse.pyx":128
  *             if j < jmin:
  *                 jmin = j
  *             if j > jmax:             # <<<<<<<<<<<<<<
  *                 jmax = j
  * 
  */
-      __pyx_t_9 = ((__pyx_v_j > __pyx_v_jmax) != 0);
+      __pyx_t_9 = (__pyx_v_j > __pyx_v_jmax);
       if (__pyx_t_9) {
 
         /* "grizli/utils_c/disperse.pyx":129
  *                 jmin = j
  *             if j > jmax:
  *                 jmax = j             # <<<<<<<<<<<<<<
  * 
@@ -3099,15 +5437,15 @@
   /* "grizli/utils_c/disperse.pyx":132
  * 
  *     ### No matched pixels
  *     if denom == 0:             # <<<<<<<<<<<<<<
  *         denom = -99
  * 
  */
-  __pyx_t_9 = ((__pyx_v_denom == 0.0) != 0);
+  __pyx_t_9 = (__pyx_v_denom == 0.0);
   if (__pyx_t_9) {
 
     /* "grizli/utils_c/disperse.pyx":133
  *     ### No matched pixels
  *     if denom == 0:
  *         denom = -99             # <<<<<<<<<<<<<<
  * 
@@ -3182,20 +5520,20 @@
   __pyx_t_15 = 0;
   __pyx_t_16 = 0;
   __pyx_t_17 = 0;
   __pyx_r = __pyx_t_18;
   __pyx_t_18 = 0;
   goto __pyx_L0;
 
-  /* "grizli/utils_c/disperse.pyx":76
+  /* "grizli/utils_c/disperse.pyx":73
+ *     return True
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def compute_segmentation_limits(np.ndarray[FTYPE_t, ndim=2] segm,             # <<<<<<<<<<<<<<
- *                                 int seg_id,
- *                                 np.ndarray[FTYPE_t, ndim=2] flam,
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_12);
@@ -3222,141 +5560,166 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_shd.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "grizli/utils_c/disperse.pyx":142
+/* "grizli/utils_c/disperse.pyx":139
+ * 
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def seg_flux(np.ndarray[FTYPE_t, ndim=2] flam, np.ndarray[LINT_t, ndim=1] idxl, np.ndarray[FTYPE_t, ndim=1] yfrac, np.ndarray[FTYPE_t, ndim=1] ysens, np.ndarray[FTYPE_t, ndim=1] full, np.ndarray[LINT_t, ndim=1] x0, np.ndarray[LINT_t, ndim=1] shd, np.ndarray[LINT_t, ndim=1] shg):             # <<<<<<<<<<<<<<
- *     pass
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_5seg_flux(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6grizli_7utils_c_8disperse_4seg_flux[] = "seg_flux(ndarray flam, ndarray idxl, ndarray yfrac, ndarray ysens, ndarray full, ndarray x0, ndarray shd, ndarray shg)";
-static PyMethodDef __pyx_mdef_6grizli_7utils_c_8disperse_5seg_flux = {"seg_flux", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6grizli_7utils_c_8disperse_5seg_flux, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6grizli_7utils_c_8disperse_4seg_flux};
-static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_5seg_flux(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_5seg_flux(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+PyDoc_STRVAR(__pyx_doc_6grizli_7utils_c_8disperse_4seg_flux, "seg_flux(ndarray flam, ndarray idxl, ndarray yfrac, ndarray ysens, ndarray full, ndarray x0, ndarray shd, ndarray shg)");
+static PyMethodDef __pyx_mdef_6grizli_7utils_c_8disperse_5seg_flux = {"seg_flux", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6grizli_7utils_c_8disperse_5seg_flux, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6grizli_7utils_c_8disperse_4seg_flux};
+static PyObject *__pyx_pw_6grizli_7utils_c_8disperse_5seg_flux(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
   CYTHON_UNUSED PyArrayObject *__pyx_v_flam = 0;
   CYTHON_UNUSED PyArrayObject *__pyx_v_idxl = 0;
   CYTHON_UNUSED PyArrayObject *__pyx_v_yfrac = 0;
   CYTHON_UNUSED PyArrayObject *__pyx_v_ysens = 0;
   CYTHON_UNUSED PyArrayObject *__pyx_v_full = 0;
   CYTHON_UNUSED PyArrayObject *__pyx_v_x0 = 0;
   CYTHON_UNUSED PyArrayObject *__pyx_v_shd = 0;
   CYTHON_UNUSED PyArrayObject *__pyx_v_shg = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("seg_flux (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_flam,&__pyx_n_s_idxl,&__pyx_n_s_yfrac,&__pyx_n_s_ysens,&__pyx_n_s_full,&__pyx_n_s_x0,&__pyx_n_s_shd,&__pyx_n_s_shg,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_flam,&__pyx_n_s_idxl,&__pyx_n_s_yfrac,&__pyx_n_s_ysens,&__pyx_n_s_full,&__pyx_n_s_x0,&__pyx_n_s_shd,&__pyx_n_s_shg,0};
     PyObject* values[8] = {0,0,0,0,0,0,0,0};
-    if (unlikely(__pyx_kwds)) {
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
+      switch (__pyx_nargs) {
+        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
-        case  7: values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
+        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
         CYTHON_FALLTHROUGH;
-        case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
+        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
-        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
+        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
-        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
-        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_flam)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flam)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_idxl)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_idxl)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 1); __PYX_ERR(0, 142, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 1); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
-        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yfrac)) != 0)) kw_args--;
+        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_yfrac)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 2); __PYX_ERR(0, 142, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 2); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
-        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ysens)) != 0)) kw_args--;
+        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ysens)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 3); __PYX_ERR(0, 142, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 3); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
-        if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_full)) != 0)) kw_args--;
+        if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_full)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 4); __PYX_ERR(0, 142, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 4); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
-        if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_x0)) != 0)) kw_args--;
+        if (likely((values[5] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x0)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 5); __PYX_ERR(0, 142, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 5); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
-        if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shd)) != 0)) kw_args--;
+        if (likely((values[6] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_shd)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 6); __PYX_ERR(0, 142, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 6); __PYX_ERR(0, 139, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  7:
-        if (likely((values[7] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_shg)) != 0)) kw_args--;
+        if (likely((values[7] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_shg)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 7); __PYX_ERR(0, 142, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, 7); __PYX_ERR(0, 139, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "seg_flux") < 0)) __PYX_ERR(0, 142, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "seg_flux") < 0)) __PYX_ERR(0, 139, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 8) {
+    } else if (unlikely(__pyx_nargs != 8)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
-      values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-      values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
-      values[6] = PyTuple_GET_ITEM(__pyx_args, 6);
-      values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+      values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
+      values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
+      values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
+      values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
+      values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
     }
     __pyx_v_flam = ((PyArrayObject *)values[0]);
     __pyx_v_idxl = ((PyArrayObject *)values[1]);
     __pyx_v_yfrac = ((PyArrayObject *)values[2]);
     __pyx_v_ysens = ((PyArrayObject *)values[3]);
     __pyx_v_full = ((PyArrayObject *)values[4]);
     __pyx_v_x0 = ((PyArrayObject *)values[5]);
     __pyx_v_shd = ((PyArrayObject *)values[6]);
     __pyx_v_shg = ((PyArrayObject *)values[7]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 142, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("seg_flux", 1, 8, 8, __pyx_nargs); __PYX_ERR(0, 139, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("grizli.utils_c.disperse.seg_flux", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_flam), __pyx_ptype_5numpy_ndarray, 1, "flam", 0))) __PYX_ERR(0, 142, __pyx_L1_error)
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_idxl), __pyx_ptype_5numpy_ndarray, 1, "idxl", 0))) __PYX_ERR(0, 142, __pyx_L1_error)
@@ -3430,50 +5793,50 @@
   __pyx_pybuffernd_shd.rcbuffer = &__pyx_pybuffer_shd;
   __pyx_pybuffer_shg.pybuffer.buf = NULL;
   __pyx_pybuffer_shg.refcount = 0;
   __pyx_pybuffernd_shg.data = NULL;
   __pyx_pybuffernd_shg.rcbuffer = &__pyx_pybuffer_shg;
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_flam.rcbuffer->pybuffer, (PyObject*)__pyx_v_flam, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_flam.rcbuffer->pybuffer, (PyObject*)__pyx_v_flam, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_flam.diminfo[0].strides = __pyx_pybuffernd_flam.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_flam.diminfo[0].shape = __pyx_pybuffernd_flam.rcbuffer->pybuffer.shape[0]; __pyx_pybuffernd_flam.diminfo[1].strides = __pyx_pybuffernd_flam.rcbuffer->pybuffer.strides[1]; __pyx_pybuffernd_flam.diminfo[1].shape = __pyx_pybuffernd_flam.rcbuffer->pybuffer.shape[1];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_idxl.rcbuffer->pybuffer, (PyObject*)__pyx_v_idxl, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_idxl.rcbuffer->pybuffer, (PyObject*)__pyx_v_idxl, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_idxl.diminfo[0].strides = __pyx_pybuffernd_idxl.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_idxl.diminfo[0].shape = __pyx_pybuffernd_idxl.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_yfrac.rcbuffer->pybuffer, (PyObject*)__pyx_v_yfrac, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_yfrac.rcbuffer->pybuffer, (PyObject*)__pyx_v_yfrac, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_yfrac.diminfo[0].strides = __pyx_pybuffernd_yfrac.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_yfrac.diminfo[0].shape = __pyx_pybuffernd_yfrac.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ysens.rcbuffer->pybuffer, (PyObject*)__pyx_v_ysens, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_ysens.rcbuffer->pybuffer, (PyObject*)__pyx_v_ysens, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_ysens.diminfo[0].strides = __pyx_pybuffernd_ysens.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_ysens.diminfo[0].shape = __pyx_pybuffernd_ysens.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_full.rcbuffer->pybuffer, (PyObject*)__pyx_v_full, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_full.rcbuffer->pybuffer, (PyObject*)__pyx_v_full, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_FTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_full.diminfo[0].strides = __pyx_pybuffernd_full.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_full.diminfo[0].shape = __pyx_pybuffernd_full.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x0.rcbuffer->pybuffer, (PyObject*)__pyx_v_x0, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_x0.rcbuffer->pybuffer, (PyObject*)__pyx_v_x0, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_x0.diminfo[0].strides = __pyx_pybuffernd_x0.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_x0.diminfo[0].shape = __pyx_pybuffernd_x0.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shd.rcbuffer->pybuffer, (PyObject*)__pyx_v_shd, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shd.rcbuffer->pybuffer, (PyObject*)__pyx_v_shd, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_shd.diminfo[0].strides = __pyx_pybuffernd_shd.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_shd.diminfo[0].shape = __pyx_pybuffernd_shd.rcbuffer->pybuffer.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shg.rcbuffer->pybuffer, (PyObject*)__pyx_v_shg, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 142, __pyx_L1_error)
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_pybuffernd_shg.rcbuffer->pybuffer, (PyObject*)__pyx_v_shg, &__Pyx_TypeInfo_nn___pyx_t_6grizli_7utils_c_8disperse_LINT_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) __PYX_ERR(0, 139, __pyx_L1_error)
   }
   __pyx_pybuffernd_shg.diminfo[0].strides = __pyx_pybuffernd_shg.rcbuffer->pybuffer.strides[0]; __pyx_pybuffernd_shg.diminfo[0].shape = __pyx_pybuffernd_shg.rcbuffer->pybuffer.shape[0];
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -3504,1210 +5867,202 @@
   __Pyx_SafeReleaseBuffer(&__pyx_pybuffernd_ysens.rcbuffer->pybuffer);
   __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":735
- * ctypedef npy_cdouble     complex_t
- * 
- * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew1(PyObject *__pyx_v_a) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":736
- * 
- * cdef inline object PyArray_MultiIterNew1(a):
- *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 736, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":735
- * ctypedef npy_cdouble     complex_t
- * 
- * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew1", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":738
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew2(PyObject *__pyx_v_a, PyObject *__pyx_v_b) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":739
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 739, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":738
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew2", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":741
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew3(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":742
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 742, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":741
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew3", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":744
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew4(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":745
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 745, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":744
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew4", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":747
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew5(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d, PyObject *__pyx_v_e) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":748
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 748, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":747
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew5", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":750
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":751
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
- *         return <tuple>d.subarray.shape
- *     else:
- */
-  __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
-  if (__pyx_t_1) {
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":752
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
- *     else:
- *         return ()
- */
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
-    __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
-    goto __pyx_L0;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":751
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
- *         return <tuple>d.subarray.shape
- *     else:
- */
-  }
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":754
- *         return <tuple>d.subarray.shape
- *     else:
- *         return ()             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  /*else*/ {
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_empty_tuple);
-    __pyx_r = __pyx_empty_tuple;
-    goto __pyx_L0;
-  }
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":750
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":929
- *     int _import_umath() except -1
- * 
- * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)
- */
-
-static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("set_array_base", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":930
- * 
- * cdef inline void set_array_base(ndarray arr, object base):
- *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
- *     PyArray_SetBaseObject(arr, base)
- * 
- */
-  Py_INCREF(__pyx_v_base);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":931
- * cdef inline void set_array_base(ndarray arr, object base):
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object get_array_base(ndarray arr):
- */
-  (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":929
- *     int _import_umath() except -1
- * 
- * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)
- */
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":933
- *     PyArray_SetBaseObject(arr, base)
- * 
- * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
-  PyObject *__pyx_v_base;
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  __Pyx_RefNannySetupContext("get_array_base", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":934
- * 
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
- *     if base is NULL:
- *         return None
- */
-  __pyx_v_base = PyArray_BASE(__pyx_v_arr);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":935
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)
- *     if base is NULL:             # <<<<<<<<<<<<<<
- *         return None
- *     return <object>base
- */
-  __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
-  if (__pyx_t_1) {
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":936
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- *         return None             # <<<<<<<<<<<<<<
- *     return <object>base
- * 
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-    goto __pyx_L0;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":935
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)
- *     if base is NULL:             # <<<<<<<<<<<<<<
- *         return None
- *     return <object>base
- */
-  }
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":937
- *     if base is NULL:
- *         return None
- *     return <object>base             # <<<<<<<<<<<<<<
- * 
- * # Versions of the import_* functions which are more suitable for
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_base));
-  __pyx_r = ((PyObject *)__pyx_v_base);
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":933
- *     PyArray_SetBaseObject(arr, base)
- * 
- * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":941
- * # Versions of the import_* functions which are more suitable for
- * # Cython code.
- * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         __pyx_import_array()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_array(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_array", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":942
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":943
- * cdef inline int import_array() except -1:
- *     try:
- *         __pyx_import_array()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")
- */
-      __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 943, __pyx_L3_error)
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":942
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-    }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":944
- *     try:
- *         __pyx_import_array()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 944, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":945
- *         __pyx_import_array()
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_umath() except -1:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 945, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 945, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":942
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":941
- * # Versions of the import_* functions which are more suitable for
- * # Cython code.
- * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         __pyx_import_array()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":947
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_umath(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_umath", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":948
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":949
- * cdef inline int import_umath() except -1:
- *     try:
- *         _import_umath()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")
- */
-      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 949, __pyx_L3_error)
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":948
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":950
- *     try:
- *         _import_umath()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 950, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":951
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_ufunc() except -1:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 951, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 951, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":948
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":947
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":953
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_ufunc(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_ufunc", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":954
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":955
- * cdef inline int import_ufunc() except -1:
- *     try:
- *         _import_umath()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")
- */
-      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 955, __pyx_L3_error)
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":954
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":956
- *     try:
- *         _import_umath()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 956, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":957
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef extern from *:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 957, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 957, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":954
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":953
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":967
- * 
- * 
- * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.timedelta64)`
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_is_timedelta64_object(PyObject *__pyx_v_obj) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("is_timedelta64_object", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":979
- *     bool
- *     """
- *     return PyObject_TypeCheck(obj, &PyTimedeltaArrType_Type)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyTimedeltaArrType_Type));
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":967
- * 
- * 
- * cdef inline bint is_timedelta64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.timedelta64)`
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":982
- * 
- * 
- * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.datetime64)`
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_is_datetime64_object(PyObject *__pyx_v_obj) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("is_datetime64_object", 0);
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":994
- *     bool
- *     """
- *     return PyObject_TypeCheck(obj, &PyDatetimeArrType_Type)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = PyObject_TypeCheck(__pyx_v_obj, (&PyDatetimeArrType_Type));
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":982
- * 
- * 
- * cdef inline bint is_datetime64_object(object obj):             # <<<<<<<<<<<<<<
- *     """
- *     Cython equivalent of `isinstance(obj, np.datetime64)`
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":997
- * 
- * 
- * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy datetime64 object
- */
-
-static CYTHON_INLINE npy_datetime __pyx_f_5numpy_get_datetime64_value(PyObject *__pyx_v_obj) {
-  npy_datetime __pyx_r;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1004
- *     also needed.  That can be found using `get_datetime64_unit`.
- *     """
- *     return (<PyDatetimeScalarObject*>obj).obval             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = ((PyDatetimeScalarObject *)__pyx_v_obj)->obval;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":997
- * 
- * 
- * cdef inline npy_datetime get_datetime64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy datetime64 object
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1007
- * 
- * 
- * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy timedelta64 object
- */
-
-static CYTHON_INLINE npy_timedelta __pyx_f_5numpy_get_timedelta64_value(PyObject *__pyx_v_obj) {
-  npy_timedelta __pyx_r;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1011
- *     returns the int64 value underlying scalar numpy timedelta64 object
- *     """
- *     return (<PyTimedeltaScalarObject*>obj).obval             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = ((PyTimedeltaScalarObject *)__pyx_v_obj)->obval;
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1007
- * 
- * 
- * cdef inline npy_timedelta get_timedelta64_value(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the int64 value underlying scalar numpy timedelta64 object
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  return __pyx_r;
-}
-
-/* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1014
- * 
- * 
- * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the unit part of the dtype for a numpy datetime64 object.
- */
-
-static CYTHON_INLINE NPY_DATETIMEUNIT __pyx_f_5numpy_get_datetime64_unit(PyObject *__pyx_v_obj) {
-  NPY_DATETIMEUNIT __pyx_r;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1018
- *     returns the unit part of the dtype for a numpy datetime64 object.
- *     """
- *     return <NPY_DATETIMEUNIT>(<PyDatetimeScalarObject*>obj).obmeta.base             # <<<<<<<<<<<<<<
- */
-  __pyx_r = ((NPY_DATETIMEUNIT)((PyDatetimeScalarObject *)__pyx_v_obj)->obmeta.base);
-  goto __pyx_L0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1014
- * 
- * 
- * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the unit part of the dtype for a numpy datetime64 object.
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  return __pyx_r;
-}
-
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
-
-#if PY_MAJOR_VERSION >= 3
-#if CYTHON_PEP489_MULTI_PHASE_INIT
-static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec_disperse(PyObject* module); /*proto*/
-static PyModuleDef_Slot __pyx_moduledef_slots[] = {
-  {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec_disperse},
-  {0, NULL}
-};
-#endif
-
-static struct PyModuleDef __pyx_moduledef = {
-    PyModuleDef_HEAD_INIT,
-    "disperse",
-    0, /* m_doc */
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-    0, /* m_size */
-  #else
-    -1, /* m_size */
-  #endif
-    __pyx_methods /* m_methods */,
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-    __pyx_moduledef_slots, /* m_slots */
-  #else
-    NULL, /* m_reload */
-  #endif
-    NULL, /* m_traverse */
-    NULL, /* m_clear */
-    NULL /* m_free */
-};
-#endif
 #ifndef CYTHON_SMALL_CODE
 #if defined(__clang__)
     #define CYTHON_SMALL_CODE
 #elif defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 3))
     #define CYTHON_SMALL_CODE __attribute__((cold))
 #else
     #define CYTHON_SMALL_CODE
 #endif
 #endif
+/* #### Code section: pystring_table ### */
 
-static __Pyx_StringTabEntry __pyx_string_tab[] = {
-  {&__pyx_n_s_DTYPE, __pyx_k_DTYPE, sizeof(__pyx_k_DTYPE), 0, 0, 1, 1},
-  {&__pyx_n_s_ITYPE, __pyx_k_ITYPE, sizeof(__pyx_k_ITYPE), 0, 0, 1, 1},
-  {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
-  {&__pyx_n_s_area, __pyx_k_area, sizeof(__pyx_k_area), 0, 0, 1, 1},
-  {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {&__pyx_n_s_compute_segmentation_limits, __pyx_k_compute_segmentation_limits, sizeof(__pyx_k_compute_segmentation_limits), 0, 0, 1, 1},
-  {&__pyx_n_s_denom, __pyx_k_denom, sizeof(__pyx_k_denom), 0, 0, 1, 1},
-  {&__pyx_n_s_disperse_grism_object, __pyx_k_disperse_grism_object, sizeof(__pyx_k_disperse_grism_object), 0, 0, 1, 1},
-  {&__pyx_n_s_fl_ij, __pyx_k_fl_ij, sizeof(__pyx_k_fl_ij), 0, 0, 1, 1},
-  {&__pyx_n_s_flam, __pyx_k_flam, sizeof(__pyx_k_flam), 0, 0, 1, 1},
-  {&__pyx_n_s_float64, __pyx_k_float64, sizeof(__pyx_k_float64), 0, 0, 1, 1},
-  {&__pyx_n_s_full, __pyx_k_full, sizeof(__pyx_k_full), 0, 0, 1, 1},
-  {&__pyx_n_s_grizli_utils_c_disperse, __pyx_k_grizli_utils_c_disperse, sizeof(__pyx_k_grizli_utils_c_disperse), 0, 0, 1, 1},
-  {&__pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_k_grizli_utils_c_disperse_pyx, sizeof(__pyx_k_grizli_utils_c_disperse_pyx), 0, 0, 1, 0},
-  {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
-  {&__pyx_n_s_idxl, __pyx_k_idxl, sizeof(__pyx_k_idxl), 0, 0, 1, 1},
-  {&__pyx_n_s_imax, __pyx_k_imax, sizeof(__pyx_k_imax), 0, 0, 1, 1},
-  {&__pyx_n_s_imin, __pyx_k_imin, sizeof(__pyx_k_imin), 0, 0, 1, 1},
-  {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
-  {&__pyx_n_s_int64, __pyx_k_int64, sizeof(__pyx_k_int64), 0, 0, 1, 1},
-  {&__pyx_n_s_inumer, __pyx_k_inumer, sizeof(__pyx_k_inumer), 0, 0, 1, 1},
-  {&__pyx_n_s_j, __pyx_k_j, sizeof(__pyx_k_j), 0, 0, 1, 1},
-  {&__pyx_n_s_jmax, __pyx_k_jmax, sizeof(__pyx_k_jmax), 0, 0, 1, 1},
-  {&__pyx_n_s_jmin, __pyx_k_jmin, sizeof(__pyx_k_jmin), 0, 0, 1, 1},
-  {&__pyx_n_s_jnumer, __pyx_k_jnumer, sizeof(__pyx_k_jnumer), 0, 0, 1, 1},
-  {&__pyx_n_s_k, __pyx_k_k, sizeof(__pyx_k_k), 0, 0, 1, 1},
-  {&__pyx_n_s_k1, __pyx_k_k1, sizeof(__pyx_k_k1), 0, 0, 1, 1},
-  {&__pyx_n_s_k2, __pyx_k_k2, sizeof(__pyx_k_k2), 0, 0, 1, 1},
-  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
-  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {&__pyx_n_s_nk, __pyx_k_nk, sizeof(__pyx_k_nk), 0, 0, 1, 1},
-  {&__pyx_n_s_nl, __pyx_k_nl, sizeof(__pyx_k_nl), 0, 0, 1, 1},
-  {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
-  {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
-  {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
-  {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
-  {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {&__pyx_n_s_seg_flux, __pyx_k_seg_flux, sizeof(__pyx_k_seg_flux), 0, 0, 1, 1},
-  {&__pyx_n_s_seg_id, __pyx_k_seg_id, sizeof(__pyx_k_seg_id), 0, 0, 1, 1},
-  {&__pyx_n_s_segm, __pyx_k_segm, sizeof(__pyx_k_segm), 0, 0, 1, 1},
-  {&__pyx_n_s_sh_thumb, __pyx_k_sh_thumb, sizeof(__pyx_k_sh_thumb), 0, 0, 1, 1},
-  {&__pyx_n_s_shd, __pyx_k_shd, sizeof(__pyx_k_shd), 0, 0, 1, 1},
-  {&__pyx_n_s_shg, __pyx_k_shg, sizeof(__pyx_k_shg), 0, 0, 1, 1},
-  {&__pyx_n_s_shx, __pyx_k_shx, sizeof(__pyx_k_shx), 0, 0, 1, 1},
-  {&__pyx_n_s_shy, __pyx_k_shy, sizeof(__pyx_k_shy), 0, 0, 1, 1},
-  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
-  {&__pyx_n_s_wht_ij, __pyx_k_wht_ij, sizeof(__pyx_k_wht_ij), 0, 0, 1, 1},
-  {&__pyx_n_s_x0, __pyx_k_x0, sizeof(__pyx_k_x0), 0, 0, 1, 1},
-  {&__pyx_n_s_yfrac, __pyx_k_yfrac, sizeof(__pyx_k_yfrac), 0, 0, 1, 1},
-  {&__pyx_n_s_ysens, __pyx_k_ysens, sizeof(__pyx_k_ysens), 0, 0, 1, 1},
-  {0, 0, 0, 0, 0, 0, 0}
-};
+static int __Pyx_CreateStringTabAndInitStrings(void) {
+  __Pyx_StringTabEntry __pyx_string_tab[] = {
+    {&__pyx_n_s_DTYPE, __pyx_k_DTYPE, sizeof(__pyx_k_DTYPE), 0, 0, 1, 1},
+    {&__pyx_n_s_ITYPE, __pyx_k_ITYPE, sizeof(__pyx_k_ITYPE), 0, 0, 1, 1},
+    {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
+    {&__pyx_n_s__10, __pyx_k__10, sizeof(__pyx_k__10), 0, 0, 1, 1},
+    {&__pyx_n_s__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 0, 1, 1},
+    {&__pyx_n_s_area, __pyx_k_area, sizeof(__pyx_k_area), 0, 0, 1, 1},
+    {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
+    {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
+    {&__pyx_n_s_compute_segmentation_limits, __pyx_k_compute_segmentation_limits, sizeof(__pyx_k_compute_segmentation_limits), 0, 0, 1, 1},
+    {&__pyx_n_s_denom, __pyx_k_denom, sizeof(__pyx_k_denom), 0, 0, 1, 1},
+    {&__pyx_n_s_disperse_grism_object, __pyx_k_disperse_grism_object, sizeof(__pyx_k_disperse_grism_object), 0, 0, 1, 1},
+    {&__pyx_n_s_fl_ij, __pyx_k_fl_ij, sizeof(__pyx_k_fl_ij), 0, 0, 1, 1},
+    {&__pyx_n_s_flam, __pyx_k_flam, sizeof(__pyx_k_flam), 0, 0, 1, 1},
+    {&__pyx_n_s_float64, __pyx_k_float64, sizeof(__pyx_k_float64), 0, 0, 1, 1},
+    {&__pyx_n_s_full, __pyx_k_full, sizeof(__pyx_k_full), 0, 0, 1, 1},
+    {&__pyx_n_s_grizli_utils_c_disperse, __pyx_k_grizli_utils_c_disperse, sizeof(__pyx_k_grizli_utils_c_disperse), 0, 0, 1, 1},
+    {&__pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_k_grizli_utils_c_disperse_pyx, sizeof(__pyx_k_grizli_utils_c_disperse_pyx), 0, 0, 1, 0},
+    {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
+    {&__pyx_n_s_idxl, __pyx_k_idxl, sizeof(__pyx_k_idxl), 0, 0, 1, 1},
+    {&__pyx_n_s_imax, __pyx_k_imax, sizeof(__pyx_k_imax), 0, 0, 1, 1},
+    {&__pyx_n_s_imin, __pyx_k_imin, sizeof(__pyx_k_imin), 0, 0, 1, 1},
+    {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
+    {&__pyx_n_s_initializing, __pyx_k_initializing, sizeof(__pyx_k_initializing), 0, 0, 1, 1},
+    {&__pyx_n_s_int64, __pyx_k_int64, sizeof(__pyx_k_int64), 0, 0, 1, 1},
+    {&__pyx_n_s_inumer, __pyx_k_inumer, sizeof(__pyx_k_inumer), 0, 0, 1, 1},
+    {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
+    {&__pyx_n_s_j, __pyx_k_j, sizeof(__pyx_k_j), 0, 0, 1, 1},
+    {&__pyx_n_s_jmax, __pyx_k_jmax, sizeof(__pyx_k_jmax), 0, 0, 1, 1},
+    {&__pyx_n_s_jmin, __pyx_k_jmin, sizeof(__pyx_k_jmin), 0, 0, 1, 1},
+    {&__pyx_n_s_jnumer, __pyx_k_jnumer, sizeof(__pyx_k_jnumer), 0, 0, 1, 1},
+    {&__pyx_n_s_k, __pyx_k_k, sizeof(__pyx_k_k), 0, 0, 1, 1},
+    {&__pyx_n_s_k1, __pyx_k_k1, sizeof(__pyx_k_k1), 0, 0, 1, 1},
+    {&__pyx_n_s_k2, __pyx_k_k2, sizeof(__pyx_k_k2), 0, 0, 1, 1},
+    {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
+    {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
+    {&__pyx_n_s_nk, __pyx_k_nk, sizeof(__pyx_k_nk), 0, 0, 1, 1},
+    {&__pyx_n_s_nl, __pyx_k_nl, sizeof(__pyx_k_nl), 0, 0, 1, 1},
+    {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
+    {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
+    {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
+    {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
+    {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
+    {&__pyx_n_s_seg_flux, __pyx_k_seg_flux, sizeof(__pyx_k_seg_flux), 0, 0, 1, 1},
+    {&__pyx_n_s_seg_id, __pyx_k_seg_id, sizeof(__pyx_k_seg_id), 0, 0, 1, 1},
+    {&__pyx_n_s_segm, __pyx_k_segm, sizeof(__pyx_k_segm), 0, 0, 1, 1},
+    {&__pyx_n_s_sh_thumb, __pyx_k_sh_thumb, sizeof(__pyx_k_sh_thumb), 0, 0, 1, 1},
+    {&__pyx_n_s_shd, __pyx_k_shd, sizeof(__pyx_k_shd), 0, 0, 1, 1},
+    {&__pyx_n_s_shg, __pyx_k_shg, sizeof(__pyx_k_shg), 0, 0, 1, 1},
+    {&__pyx_n_s_shx, __pyx_k_shx, sizeof(__pyx_k_shx), 0, 0, 1, 1},
+    {&__pyx_n_s_shy, __pyx_k_shy, sizeof(__pyx_k_shy), 0, 0, 1, 1},
+    {&__pyx_n_s_spec, __pyx_k_spec, sizeof(__pyx_k_spec), 0, 0, 1, 1},
+    {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
+    {&__pyx_n_s_wht_ij, __pyx_k_wht_ij, sizeof(__pyx_k_wht_ij), 0, 0, 1, 1},
+    {&__pyx_n_s_x0, __pyx_k_x0, sizeof(__pyx_k_x0), 0, 0, 1, 1},
+    {&__pyx_n_s_yfrac, __pyx_k_yfrac, sizeof(__pyx_k_yfrac), 0, 0, 1, 1},
+    {&__pyx_n_s_ysens, __pyx_k_ysens, sizeof(__pyx_k_ysens), 0, 0, 1, 1},
+    {0, 0, 0, 0, 0, 0, 0}
+  };
+  return __Pyx_InitStrings(__pyx_string_tab);
+}
+/* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
   __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 50, __pyx_L1_error)
-  __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 945, __pyx_L1_error)
+  __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 987, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
+/* #### Code section: cached_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":945
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":987
  *         __pyx_import_array()
  *     except Exception:
  *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_umath() except -1:
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple_)) __PYX_ERR(1, 945, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple_)) __PYX_ERR(1, 987, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":951
+  /* "../../../../../tmp/build-env-fungk2bg/lib/python3.10/site-packages/numpy/__init__.cython-30.pxd":993
  *         _import_umath()
  *     except Exception:
  *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
  * 
  * cdef inline int import_ufunc() except -1:
  */
-  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(1, 951, __pyx_L1_error)
+  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(1, 993, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__2);
   __Pyx_GIVEREF(__pyx_tuple__2);
 
-  /* "grizli/utils_c/disperse.pyx":26
+  /* "grizli/utils_c/disperse.pyx":23
+ *     double exp(double x)
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def disperse_grism_object(np.ndarray[FTYPE_t, ndim=2] flam,             # <<<<<<<<<<<<<<
- *                           np.ndarray[FTYPE_t, ndim=2] segm,
- *                           FTYPE_t seg_id,
- */
-  __pyx_tuple__3 = PyTuple_Pack(21, __pyx_n_s_flam, __pyx_n_s_segm, __pyx_n_s_seg_id, __pyx_n_s_idxl, __pyx_n_s_yfrac, __pyx_n_s_ysens, __pyx_n_s_full, __pyx_n_s_x0, __pyx_n_s_shd, __pyx_n_s_sh_thumb, __pyx_n_s_shg, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k1, __pyx_n_s_k2, __pyx_n_s_nl, __pyx_n_s_nk, __pyx_n_s_k, __pyx_n_s_shx, __pyx_n_s_shy, __pyx_n_s_fl_ij); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 26, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__3);
-  __Pyx_GIVEREF(__pyx_tuple__3);
-  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(11, 0, 21, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__3, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_n_s_disperse_grism_object, 26, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 26, __pyx_L1_error)
+ */
+  __pyx_tuple__4 = PyTuple_Pack(21, __pyx_n_s_flam, __pyx_n_s_segm, __pyx_n_s_seg_id, __pyx_n_s_idxl, __pyx_n_s_yfrac, __pyx_n_s_ysens, __pyx_n_s_full, __pyx_n_s_x0, __pyx_n_s_shd, __pyx_n_s_sh_thumb, __pyx_n_s_shg, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k1, __pyx_n_s_k2, __pyx_n_s_nl, __pyx_n_s_nk, __pyx_n_s_k, __pyx_n_s_shx, __pyx_n_s_shy, __pyx_n_s_fl_ij); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__4);
+  __Pyx_GIVEREF(__pyx_tuple__4);
+  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(11, 0, 0, 21, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__4, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_n_s_disperse_grism_object, 23, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 23, __pyx_L1_error)
 
-  /* "grizli/utils_c/disperse.pyx":76
+  /* "grizli/utils_c/disperse.pyx":73
+ *     return True
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def compute_segmentation_limits(np.ndarray[FTYPE_t, ndim=2] segm,             # <<<<<<<<<<<<<<
- *                                 int seg_id,
- *                                 np.ndarray[FTYPE_t, ndim=2] flam,
- */
-  __pyx_tuple__5 = PyTuple_Pack(15, __pyx_n_s_segm, __pyx_n_s_seg_id, __pyx_n_s_flam, __pyx_n_s_shd, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_imin, __pyx_n_s_imax, __pyx_n_s_jmin, __pyx_n_s_jmax, __pyx_n_s_area, __pyx_n_s_inumer, __pyx_n_s_jnumer, __pyx_n_s_denom, __pyx_n_s_wht_ij); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 76, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__5);
-  __Pyx_GIVEREF(__pyx_tuple__5);
-  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(4, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__5, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_n_s_compute_segmentation_limits, 76, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 76, __pyx_L1_error)
+ */
+  __pyx_tuple__6 = PyTuple_Pack(15, __pyx_n_s_segm, __pyx_n_s_seg_id, __pyx_n_s_flam, __pyx_n_s_shd, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_imin, __pyx_n_s_imax, __pyx_n_s_jmin, __pyx_n_s_jmax, __pyx_n_s_area, __pyx_n_s_inumer, __pyx_n_s_jnumer, __pyx_n_s_denom, __pyx_n_s_wht_ij); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 73, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__6);
+  __Pyx_GIVEREF(__pyx_tuple__6);
+  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_n_s_compute_segmentation_limits, 73, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 73, __pyx_L1_error)
 
-  /* "grizli/utils_c/disperse.pyx":142
+  /* "grizli/utils_c/disperse.pyx":139
+ * 
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def seg_flux(np.ndarray[FTYPE_t, ndim=2] flam, np.ndarray[LINT_t, ndim=1] idxl, np.ndarray[FTYPE_t, ndim=1] yfrac, np.ndarray[FTYPE_t, ndim=1] ysens, np.ndarray[FTYPE_t, ndim=1] full, np.ndarray[LINT_t, ndim=1] x0, np.ndarray[LINT_t, ndim=1] shd, np.ndarray[LINT_t, ndim=1] shg):             # <<<<<<<<<<<<<<
- *     pass
  */
-  __pyx_tuple__7 = PyTuple_Pack(8, __pyx_n_s_flam, __pyx_n_s_idxl, __pyx_n_s_yfrac, __pyx_n_s_ysens, __pyx_n_s_full, __pyx_n_s_x0, __pyx_n_s_shd, __pyx_n_s_shg); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 142, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__7);
-  __Pyx_GIVEREF(__pyx_tuple__7);
-  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(8, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__7, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_n_s_seg_flux, 142, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 142, __pyx_L1_error)
+  __pyx_tuple__8 = PyTuple_Pack(8, __pyx_n_s_flam, __pyx_n_s_idxl, __pyx_n_s_yfrac, __pyx_n_s_ysens, __pyx_n_s_full, __pyx_n_s_x0, __pyx_n_s_shd, __pyx_n_s_shg); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 139, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__8);
+  __Pyx_GIVEREF(__pyx_tuple__8);
+  __pyx_codeobj__9 = (PyObject*)__Pyx_PyCode_New(8, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__8, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_grizli_utils_c_disperse_pyx, __pyx_n_s_seg_flux, 139, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 139, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
+/* #### Code section: init_constants ### */
+
+static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
+  if (__Pyx_CreateStringTabAndInitStrings() < 0) __PYX_ERR(0, 2, __pyx_L1_error);
+  return 0;
+  __pyx_L1_error:;
+  return -1;
+}
+/* #### Code section: init_globals ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  /* NumpyImportArray.init */
+  /*
+ * Cython has automatically inserted a call to _import_array since
+ * you didn't include one when you cimported numpy. To disable this
+ * add the line
+ *   <void>numpy._import_array
+ */
+#ifdef NPY_FEATURE_VERSION
+#if !NO_IMPORT_ARRAY
+if (unlikely(_import_array() == -1)) {
+    PyErr_SetString(PyExc_ImportError, "numpy.core.multiarray failed to import "
+    "(auto-generated because you didn't call 'numpy.import_array()' after cimporting numpy; "
+    "use '<void>numpy._import_array' to disable if you are certain you don't need it).");
+}
+#endif
+#endif
+
+if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2, __pyx_L1_error)
+
   return 0;
   __pyx_L1_error:;
   return -1;
 }
+/* #### Code section: init_module ### */
 
 static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_export_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_function_export_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_type_init_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_type_import_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
@@ -4751,39 +6106,41 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_36(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_3_0_0(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyTypeObject),
+  #elif CYTHON_COMPILING_IN_LIMITED_API
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(2, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(2, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 200, __pyx_L1_error)
+  __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 203, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_36); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 200, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_36); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 223, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_36); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 227, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_36); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 239, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 771, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 773, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 775, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 777, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 779, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 781, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 783, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 785, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 787, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_36); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 789, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_36(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_36(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_36); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 827, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_3_0_0); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 203, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_3_0_0); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_3_0_0); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 230, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_3_0_0); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 239, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 813, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 815, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 817, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 819, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 821, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 823, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 825, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 827, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 829, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyObject),__Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 831, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_3_0_0(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_3_0_0); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 869, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -4802,14 +6159,63 @@
   __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
   /*--- Function import code ---*/
   __Pyx_RefNannyFinishContext();
   return 0;
 }
 
 
+#if PY_MAJOR_VERSION >= 3
+#if CYTHON_PEP489_MULTI_PHASE_INIT
+static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
+static int __pyx_pymod_exec_disperse(PyObject* module); /*proto*/
+static PyModuleDef_Slot __pyx_moduledef_slots[] = {
+  {Py_mod_create, (void*)__pyx_pymod_create},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_disperse},
+  {0, NULL}
+};
+#endif
+
+#ifdef __cplusplus
+namespace {
+  struct PyModuleDef __pyx_moduledef =
+  #else
+  static struct PyModuleDef __pyx_moduledef =
+  #endif
+  {
+      PyModuleDef_HEAD_INIT,
+      "disperse",
+      0, /* m_doc */
+    #if CYTHON_PEP489_MULTI_PHASE_INIT
+      0, /* m_size */
+    #elif CYTHON_USE_MODULE_STATE
+      sizeof(__pyx_mstate), /* m_size */
+    #else
+      -1, /* m_size */
+    #endif
+      __pyx_methods /* m_methods */,
+    #if CYTHON_PEP489_MULTI_PHASE_INIT
+      __pyx_moduledef_slots, /* m_slots */
+    #else
+      NULL, /* m_reload */
+    #endif
+    #if CYTHON_USE_MODULE_STATE
+      __pyx_m_traverse, /* m_traverse */
+      __pyx_m_clear, /* m_clear */
+      NULL /* m_free */
+    #else
+      NULL, /* m_traverse */
+      NULL, /* m_clear */
+      NULL /* m_free */
+    #endif
+  };
+  #ifdef __cplusplus
+} /* anonymous namespace */
+#endif
+#endif
+
 #ifndef CYTHON_NO_PYINIT_EXPORT
 #define __Pyx_PyMODINIT_FUNC PyMODINIT_FUNC
 #elif PY_MAJOR_VERSION < 3
 #ifdef __cplusplus
 #define __Pyx_PyMODINIT_FUNC extern "C" void
 #else
 #define __Pyx_PyMODINIT_FUNC void
@@ -4852,42 +6258,56 @@
         PyErr_SetString(
             PyExc_ImportError,
             "Interpreter change detected - this module can only be loaded into one interpreter per process.");
         return -1;
     }
     return 0;
 }
-static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *module, const char* from_name, const char* to_name, int allow_none)
+#else
+static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none)
+#endif
+{
     PyObject *value = PyObject_GetAttrString(spec, from_name);
     int result = 0;
     if (likely(value)) {
         if (allow_none || value != Py_None) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+            result = PyModule_AddObject(module, to_name, value);
+#else
             result = PyDict_SetItemString(moddict, to_name, value);
+#endif
         }
         Py_DECREF(value);
     } else if (PyErr_ExceptionMatches(PyExc_AttributeError)) {
         PyErr_Clear();
     } else {
         result = -1;
     }
     return result;
 }
-static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, CYTHON_UNUSED PyModuleDef *def) {
+static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def) {
     PyObject *module = NULL, *moddict, *modname;
+    CYTHON_UNUSED_VAR(def);
     if (__Pyx_check_single_interpreter())
         return NULL;
     if (__pyx_m)
         return __Pyx_NewRef(__pyx_m);
     modname = PyObject_GetAttrString(spec, "name");
     if (unlikely(!modname)) goto bad;
     module = PyModule_NewObject(modname);
     Py_DECREF(modname);
     if (unlikely(!module)) goto bad;
+#if CYTHON_COMPILING_IN_LIMITED_API
+    moddict = module;
+#else
     moddict = PyModule_GetDict(module);
     if (unlikely(!moddict)) goto bad;
+#endif
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "loader", "__loader__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "origin", "__file__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "parent", "__package__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "submodule_search_locations", "__path__", 0) < 0)) goto bad;
     return module;
 bad:
     Py_XDECREF(module);
@@ -4895,29 +6315,63 @@
 }
 
 
 static CYTHON_SMALL_CODE int __pyx_pymod_exec_disperse(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
+  int stringtab_initialized = 0;
+  #if CYTHON_USE_MODULE_STATE
+  int pystate_addmodule_run = 0;
+  #endif
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
     PyErr_SetString(PyExc_RuntimeError, "Module 'disperse' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
+  /*--- Module creation code ---*/
+  #if CYTHON_PEP489_MULTI_PHASE_INIT
+  __pyx_m = __pyx_pyinit_module;
+  Py_INCREF(__pyx_m);
+  #else
+  #if PY_MAJOR_VERSION < 3
+  __pyx_m = Py_InitModule4("disperse", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  if (unlikely(!__pyx_m)) __PYX_ERR(0, 2, __pyx_L1_error)
+  #elif CYTHON_USE_MODULE_STATE
+  __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
+  {
+    int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
+    __pyx_t_1 = 0; /* transfer ownership from __pyx_t_1 to disperse pseudovariable */
+    if (unlikely((add_module_result < 0))) __PYX_ERR(0, 2, __pyx_L1_error)
+    pystate_addmodule_run = 1;
+  }
+  #else
+  __pyx_m = PyModule_Create(&__pyx_moduledef);
+  if (unlikely(!__pyx_m)) __PYX_ERR(0, 2, __pyx_L1_error)
+  #endif
+  #endif
+  CYTHON_UNUSED_VAR(__pyx_t_1);
+  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 2, __pyx_L1_error)
+  Py_INCREF(__pyx_d);
+  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 2, __pyx_L1_error)
+  Py_INCREF(__pyx_b);
+  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 2, __pyx_L1_error)
+  Py_INCREF(__pyx_cython_runtime);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #if CYTHON_REFNANNY
 __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
@@ -4928,208 +6382,210 @@
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 2, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 2, __pyx_L1_error)
   #ifdef __Pyx_CyFunction_USED
-  if (__pyx_CyFunction_init() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (__pyx_CyFunction_init(__pyx_m) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   #ifdef __Pyx_FusedFunction_USED
-  if (__pyx_FusedFunction_init() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (__pyx_FusedFunction_init(__pyx_m) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   #ifdef __Pyx_Coroutine_USED
-  if (__pyx_Coroutine_init() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (__pyx_Coroutine_init(__pyx_m) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   #ifdef __Pyx_Generator_USED
-  if (__pyx_Generator_init() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (__pyx_Generator_init(__pyx_m) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   #ifdef __Pyx_AsyncGen_USED
-  if (__pyx_AsyncGen_init() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (__pyx_AsyncGen_init(__pyx_m) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   #ifdef __Pyx_StopAsyncIteration_USED
-  if (__pyx_StopAsyncIteration_init() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (__pyx_StopAsyncIteration_init(__pyx_m) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   /*--- Library function declarations ---*/
   /*--- Threads initialization code ---*/
   #if defined(WITH_THREAD) && PY_VERSION_HEX < 0x030700F0 && defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
   PyEval_InitThreads();
   #endif
-  /*--- Module creation code ---*/
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-  __pyx_m = __pyx_pyinit_module;
-  Py_INCREF(__pyx_m);
-  #else
-  #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("disperse", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
-  #else
-  __pyx_m = PyModule_Create(&__pyx_moduledef);
-  #endif
-  if (unlikely(!__pyx_m)) __PYX_ERR(0, 2, __pyx_L1_error)
-  #endif
-  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 2, __pyx_L1_error)
-  Py_INCREF(__pyx_d);
-  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 2, __pyx_L1_error)
-  Py_INCREF(__pyx_b);
-  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 2, __pyx_L1_error)
-  Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   /*--- Initialize various global constants etc. ---*/
+  if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  stringtab_initialized = 1;
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
   if (__pyx_module_is_main_grizli__utils_c__disperse) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 2, __pyx_L1_error)
     if (!PyDict_GetItemString(modules, "grizli.utils_c.disperse")) {
-      if (unlikely(PyDict_SetItemString(modules, "grizli.utils_c.disperse", __pyx_m) < 0)) __PYX_ERR(0, 2, __pyx_L1_error)
+      if (unlikely((PyDict_SetItemString(modules, "grizli.utils_c.disperse", __pyx_m) < 0))) __PYX_ERR(0, 2, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   /*--- Global type/function init code ---*/
   (void)__Pyx_modinit_global_init_code();
   (void)__Pyx_modinit_variable_export_code();
   (void)__Pyx_modinit_function_export_code();
   (void)__Pyx_modinit_type_init_code();
-  if (unlikely(__Pyx_modinit_type_import_code() < 0)) __PYX_ERR(0, 2, __pyx_L1_error)
+  if (unlikely((__Pyx_modinit_type_import_code() < 0))) __PYX_ERR(0, 2, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 2, __pyx_L1_error)
   #endif
 
   /* "grizli/utils_c/disperse.pyx":4
  * from __future__ import division
  * 
  * import numpy as np             # <<<<<<<<<<<<<<
  * cimport numpy as np
  * 
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 4, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_numpy, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_2) < 0) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "grizli/utils_c/disperse.pyx":7
  * cimport numpy as np
  * 
  * DTYPE = np.float64             # <<<<<<<<<<<<<<
  * ITYPE = np.int64
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 7, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_float64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 7, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 7, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_DTYPE, __pyx_t_2) < 0) __PYX_ERR(0, 7, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_float64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 7, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_DTYPE, __pyx_t_3) < 0) __PYX_ERR(0, 7, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "grizli/utils_c/disperse.pyx":8
  * 
  * DTYPE = np.float64
  * ITYPE = np.int64             # <<<<<<<<<<<<<<
  * 
  * ctypedef np.uint_t UINT_t
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 8, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 8, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 8, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 8, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ITYPE, __pyx_t_2) < 0) __PYX_ERR(0, 8, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ITYPE, __pyx_t_1) < 0) __PYX_ERR(0, 8, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "grizli/utils_c/disperse.pyx":26
+  /* "grizli/utils_c/disperse.pyx":23
+ *     double exp(double x)
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def disperse_grism_object(np.ndarray[FTYPE_t, ndim=2] flam,             # <<<<<<<<<<<<<<
- *                           np.ndarray[FTYPE_t, ndim=2] segm,
- *                           FTYPE_t seg_id,
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6grizli_7utils_c_8disperse_1disperse_grism_object, NULL, __pyx_n_s_grizli_utils_c_disperse); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 26, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_disperse_grism_object, __pyx_t_1) < 0) __PYX_ERR(0, 26, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6grizli_7utils_c_8disperse_1disperse_grism_object, 0, __pyx_n_s_disperse_grism_object, NULL, __pyx_n_s_grizli_utils_c_disperse, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_disperse_grism_object, __pyx_t_2) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "grizli/utils_c/disperse.pyx":76
+  /* "grizli/utils_c/disperse.pyx":73
+ *     return True
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def compute_segmentation_limits(np.ndarray[FTYPE_t, ndim=2] segm,             # <<<<<<<<<<<<<<
- *                                 int seg_id,
- *                                 np.ndarray[FTYPE_t, ndim=2] flam,
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6grizli_7utils_c_8disperse_3compute_segmentation_limits, NULL, __pyx_n_s_grizli_utils_c_disperse); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 76, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_segmentation_limits, __pyx_t_1) < 0) __PYX_ERR(0, 76, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6grizli_7utils_c_8disperse_3compute_segmentation_limits, 0, __pyx_n_s_compute_segmentation_limits, NULL, __pyx_n_s_grizli_utils_c_disperse, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 73, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_segmentation_limits, __pyx_t_2) < 0) __PYX_ERR(0, 73, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "grizli/utils_c/disperse.pyx":142
+  /* "grizli/utils_c/disperse.pyx":139
+ * 
+ * 
+ * @cython.boundscheck(False)             # <<<<<<<<<<<<<<
  * @cython.wraparound(False)
  * @cython.embedsignature(True)
- * def seg_flux(np.ndarray[FTYPE_t, ndim=2] flam, np.ndarray[LINT_t, ndim=1] idxl, np.ndarray[FTYPE_t, ndim=1] yfrac, np.ndarray[FTYPE_t, ndim=1] ysens, np.ndarray[FTYPE_t, ndim=1] full, np.ndarray[LINT_t, ndim=1] x0, np.ndarray[LINT_t, ndim=1] shd, np.ndarray[LINT_t, ndim=1] shg):             # <<<<<<<<<<<<<<
- *     pass
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_6grizli_7utils_c_8disperse_5seg_flux, NULL, __pyx_n_s_grizli_utils_c_disperse); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 142, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_seg_flux, __pyx_t_1) < 0) __PYX_ERR(0, 142, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6grizli_7utils_c_8disperse_5seg_flux, 0, __pyx_n_s_seg_flux, NULL, __pyx_n_s_grizli_utils_c_disperse, __pyx_d, ((PyObject *)__pyx_codeobj__9)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 139, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_seg_flux, __pyx_t_2) < 0) __PYX_ERR(0, 139, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "grizli/utils_c/disperse.pyx":2
  * 
  * from __future__ import division             # <<<<<<<<<<<<<<
  * 
  * import numpy as np
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "../../../../../tmp/build-env-84denjl2/lib/python3.10/site-packages/numpy/__init__.pxd":1014
- * 
- * 
- * cdef inline NPY_DATETIMEUNIT get_datetime64_unit(object obj) nogil:             # <<<<<<<<<<<<<<
- *     """
- *     returns the unit part of the dtype for a numpy datetime64 object.
- */
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 2, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   if (__pyx_m) {
-    if (__pyx_d) {
+    if (__pyx_d && stringtab_initialized) {
       __Pyx_AddTraceback("init grizli.utils_c.disperse", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
+    #if !CYTHON_USE_MODULE_STATE
     Py_CLEAR(__pyx_m);
+    #else
+    Py_DECREF(__pyx_m);
+    if (pystate_addmodule_run) {
+      PyObject *tp, *value, *tb;
+      PyErr_Fetch(&tp, &value, &tb);
+      PyState_RemoveModule(&__pyx_moduledef);
+      PyErr_Restore(tp, value, tb);
+    }
+    #endif
   } else if (!PyErr_Occurred()) {
     PyErr_SetString(PyExc_ImportError, "init grizli.utils_c.disperse");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
   #else
   return;
   #endif
 }
+/* #### Code section: cleanup_globals ### */
+/* #### Code section: cleanup_module ### */
+/* #### Code section: main_method ### */
+/* #### Code section: utility_code_pragmas ### */
+#ifdef _MSC_VER
+#pragma warning( push )
+/* Warning 4127: conditional expression is constant
+ * Cython uses constant conditional expressions to allow in inline functions to be optimized at
+ * compile-time, so this warning is not useful
+ */
+#pragma warning( disable : 4127 )
+#endif
+
+
+
+/* #### Code section: utility_code_def ### */
 
 /* --- Runtime support code --- */
 /* Refnanny */
 #if CYTHON_REFNANNY
 static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
     PyObject *m = NULL, *p = NULL;
     void *r = NULL;
@@ -5141,42 +6597,729 @@
 end:
     Py_XDECREF(p);
     Py_XDECREF(m);
     return (__Pyx_RefNannyAPIStruct *)r;
 }
 #endif
 
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    int result;
+    PyObject *exc_type;
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject *current_exception = tstate->current_exception;
+    if (unlikely(!current_exception)) return 0;
+    exc_type = (PyObject*) Py_TYPE(current_exception);
+    if (exc_type == err) return 1;
+#else
+    exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+#endif
+    #if CYTHON_AVOID_BORROWED_REFS
+    Py_INCREF(exc_type);
+    #endif
+    if (unlikely(PyTuple_Check(err))) {
+        result = __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
+    } else {
+        result = __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
+    }
+    #if CYTHON_AVOID_BORROWED_REFS
+    Py_DECREF(exc_type);
+    #endif
+    return result;
+}
+#endif
+
+/* PyErrFetchRestore */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject *tmp_value;
+    assert(type == NULL || (value != NULL && type == (PyObject*) Py_TYPE(value)));
+    if (value) {
+        #if CYTHON_COMPILING_IN_CPYTHON
+        if (unlikely(((PyBaseExceptionObject*) value)->traceback != tb))
+        #endif
+            PyException_SetTraceback(value, tb);
+    }
+    tmp_value = tstate->current_exception;
+    tstate->current_exception = value;
+    Py_XDECREF(tmp_value);
+#else
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    tmp_type = tstate->curexc_type;
+    tmp_value = tstate->curexc_value;
+    tmp_tb = tstate->curexc_traceback;
+    tstate->curexc_type = type;
+    tstate->curexc_value = value;
+    tstate->curexc_traceback = tb;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#endif
+}
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject* exc_value;
+    exc_value = tstate->current_exception;
+    tstate->current_exception = 0;
+    *value = exc_value;
+    *type = NULL;
+    *tb = NULL;
+    if (exc_value) {
+        *type = (PyObject*) Py_TYPE(exc_value);
+        Py_INCREF(*type);
+        #if CYTHON_COMPILING_IN_CPYTHON
+        *tb = ((PyBaseExceptionObject*) exc_value)->traceback;
+        Py_XINCREF(*tb);
+        #else
+        *tb = PyException_GetTraceback(exc_value);
+        #endif
+    }
+#else
+    *type = tstate->curexc_type;
+    *value = tstate->curexc_value;
+    *tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+#endif
+}
+#endif
+
 /* PyObjectGetAttrStr */
 #if CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
     PyTypeObject* tp = Py_TYPE(obj);
     if (likely(tp->tp_getattro))
         return tp->tp_getattro(obj, attr_name);
 #if PY_MAJOR_VERSION < 3
     if (likely(tp->tp_getattr))
         return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
 #endif
     return PyObject_GetAttr(obj, attr_name);
 }
 #endif
 
+/* PyObjectGetAttrStrNoError */
+static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
+        __Pyx_PyErr_Clear();
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
+    PyObject *result;
+#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
+        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
+    }
+#endif
+    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
+    if (unlikely(!result)) {
+        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
+    }
+    return result;
+}
+
 /* GetBuiltinName */
 static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
-    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
-    if (unlikely(!result)) {
+    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
+    if (unlikely(!result) && !PyErr_Occurred()) {
         PyErr_Format(PyExc_NameError,
 #if PY_MAJOR_VERSION >= 3
             "name '%U' is not defined", name);
 #else
             "name '%.200s' is not defined", PyString_AS_STRING(name));
 #endif
     }
     return result;
 }
 
+/* GetTopmostException */
+#if CYTHON_USE_EXC_INFO_STACK && CYTHON_FAST_THREAD_STATE
+static _PyErr_StackItem *
+__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
+{
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    while ((exc_info->exc_value == NULL || exc_info->exc_value == Py_None) &&
+           exc_info->previous_item != NULL)
+    {
+        exc_info = exc_info->previous_item;
+    }
+    return exc_info;
+}
+#endif
+
+/* SaveResetException */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+  #if CYTHON_USE_EXC_INFO_STACK && PY_VERSION_HEX >= 0x030B00a4
+    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
+    PyObject *exc_value = exc_info->exc_value;
+    if (exc_value == NULL || exc_value == Py_None) {
+        *value = NULL;
+        *type = NULL;
+        *tb = NULL;
+    } else {
+        *value = exc_value;
+        Py_INCREF(*value);
+        *type = (PyObject*) Py_TYPE(exc_value);
+        Py_INCREF(*type);
+        *tb = PyException_GetTraceback(exc_value);
+    }
+  #elif CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
+    *type = exc_info->exc_type;
+    *value = exc_info->exc_value;
+    *tb = exc_info->exc_traceback;
+    Py_XINCREF(*type);
+    Py_XINCREF(*value);
+    Py_XINCREF(*tb);
+  #else
+    *type = tstate->exc_type;
+    *value = tstate->exc_value;
+    *tb = tstate->exc_traceback;
+    Py_XINCREF(*type);
+    Py_XINCREF(*value);
+    Py_XINCREF(*tb);
+  #endif
+}
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+  #if CYTHON_USE_EXC_INFO_STACK && PY_VERSION_HEX >= 0x030B00a4
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    PyObject *tmp_value = exc_info->exc_value;
+    exc_info->exc_value = value;
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(type);
+    Py_XDECREF(tb);
+  #else
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    tmp_type = exc_info->exc_type;
+    tmp_value = exc_info->exc_value;
+    tmp_tb = exc_info->exc_traceback;
+    exc_info->exc_type = type;
+    exc_info->exc_value = value;
+    exc_info->exc_traceback = tb;
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = type;
+    tstate->exc_value = value;
+    tstate->exc_traceback = tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+  #endif
+}
+#endif
+
+/* GetException */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
+#endif
+{
+    PyObject *local_type = NULL, *local_value, *local_tb = NULL;
+#if CYTHON_FAST_THREAD_STATE
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+  #if PY_VERSION_HEX >= 0x030C00A6
+    local_value = tstate->current_exception;
+    tstate->current_exception = 0;
+    if (likely(local_value)) {
+        local_type = (PyObject*) Py_TYPE(local_value);
+        Py_INCREF(local_type);
+        local_tb = PyException_GetTraceback(local_value);
+    }
+  #else
+    local_type = tstate->curexc_type;
+    local_value = tstate->curexc_value;
+    local_tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+  #endif
+#else
+    PyErr_Fetch(&local_type, &local_value, &local_tb);
+#endif
+    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
+#if CYTHON_FAST_THREAD_STATE && PY_VERSION_HEX >= 0x030C00A6
+    if (unlikely(tstate->current_exception))
+#elif CYTHON_FAST_THREAD_STATE
+    if (unlikely(tstate->curexc_type))
+#else
+    if (unlikely(PyErr_Occurred()))
+#endif
+        goto bad;
+    #if PY_MAJOR_VERSION >= 3
+    if (local_tb) {
+        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
+            goto bad;
+    }
+    #endif
+    Py_XINCREF(local_tb);
+    Py_XINCREF(local_type);
+    Py_XINCREF(local_value);
+    *type = local_type;
+    *value = local_value;
+    *tb = local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    #if CYTHON_USE_EXC_INFO_STACK
+    {
+        _PyErr_StackItem *exc_info = tstate->exc_info;
+      #if PY_VERSION_HEX >= 0x030B00a4
+        tmp_value = exc_info->exc_value;
+        exc_info->exc_value = local_value;
+        tmp_type = NULL;
+        tmp_tb = NULL;
+        Py_XDECREF(local_type);
+        Py_XDECREF(local_tb);
+      #else
+        tmp_type = exc_info->exc_type;
+        tmp_value = exc_info->exc_value;
+        tmp_tb = exc_info->exc_traceback;
+        exc_info->exc_type = local_type;
+        exc_info->exc_value = local_value;
+        exc_info->exc_traceback = local_tb;
+      #endif
+    }
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = local_type;
+    tstate->exc_value = local_value;
+    tstate->exc_traceback = local_tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#else
+    PyErr_SetExcInfo(local_type, local_value, local_tb);
+#endif
+    return 0;
+bad:
+    *type = 0;
+    *value = 0;
+    *tb = 0;
+    Py_XDECREF(local_type);
+    Py_XDECREF(local_value);
+    Py_XDECREF(local_tb);
+    return -1;
+}
+
+/* PyObjectCall */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    PyObject *result;
+    ternaryfunc call = Py_TYPE(func)->tp_call;
+    if (unlikely(!call))
+        return PyObject_Call(func, arg, kw);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = (*call)(func, arg, kw);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
+    }
+    return result;
+}
+#endif
+
+/* RaiseException */
+#if PY_MAJOR_VERSION < 3
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    __Pyx_PyThreadState_declare
+    CYTHON_UNUSED_VAR(cause);
+    Py_XINCREF(type);
+    if (!value || value == Py_None)
+        value = NULL;
+    else
+        Py_INCREF(value);
+    if (!tb || tb == Py_None)
+        tb = NULL;
+    else {
+        Py_INCREF(tb);
+        if (!PyTraceBack_Check(tb)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: arg 3 must be a traceback or None");
+            goto raise_error;
+        }
+    }
+    if (PyType_Check(type)) {
+#if CYTHON_COMPILING_IN_PYPY
+        if (!value) {
+            Py_INCREF(Py_None);
+            value = Py_None;
+        }
+#endif
+        PyErr_NormalizeException(&type, &value, &tb);
+    } else {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto raise_error;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(type);
+        Py_INCREF(type);
+        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: exception class must be a subclass of BaseException");
+            goto raise_error;
+        }
+    }
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrRestore(type, value, tb);
+    return;
+raise_error:
+    Py_XDECREF(value);
+    Py_XDECREF(type);
+    Py_XDECREF(tb);
+    return;
+}
+#else
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    PyObject* owned_instance = NULL;
+    if (tb == Py_None) {
+        tb = 0;
+    } else if (tb && !PyTraceBack_Check(tb)) {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: arg 3 must be a traceback or None");
+        goto bad;
+    }
+    if (value == Py_None)
+        value = 0;
+    if (PyExceptionInstance_Check(type)) {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto bad;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(value);
+    } else if (PyExceptionClass_Check(type)) {
+        PyObject *instance_class = NULL;
+        if (value && PyExceptionInstance_Check(value)) {
+            instance_class = (PyObject*) Py_TYPE(value);
+            if (instance_class != type) {
+                int is_subclass = PyObject_IsSubclass(instance_class, type);
+                if (!is_subclass) {
+                    instance_class = NULL;
+                } else if (unlikely(is_subclass == -1)) {
+                    goto bad;
+                } else {
+                    type = instance_class;
+                }
+            }
+        }
+        if (!instance_class) {
+            PyObject *args;
+            if (!value)
+                args = PyTuple_New(0);
+            else if (PyTuple_Check(value)) {
+                Py_INCREF(value);
+                args = value;
+            } else
+                args = PyTuple_Pack(1, value);
+            if (!args)
+                goto bad;
+            owned_instance = PyObject_Call(type, args, NULL);
+            Py_DECREF(args);
+            if (!owned_instance)
+                goto bad;
+            value = owned_instance;
+            if (!PyExceptionInstance_Check(value)) {
+                PyErr_Format(PyExc_TypeError,
+                             "calling %R should have returned an instance of "
+                             "BaseException, not %R",
+                             type, Py_TYPE(value));
+                goto bad;
+            }
+        }
+    } else {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: exception class must be a subclass of BaseException");
+        goto bad;
+    }
+    if (cause) {
+        PyObject *fixed_cause;
+        if (cause == Py_None) {
+            fixed_cause = NULL;
+        } else if (PyExceptionClass_Check(cause)) {
+            fixed_cause = PyObject_CallObject(cause, NULL);
+            if (fixed_cause == NULL)
+                goto bad;
+        } else if (PyExceptionInstance_Check(cause)) {
+            fixed_cause = cause;
+            Py_INCREF(fixed_cause);
+        } else {
+            PyErr_SetString(PyExc_TypeError,
+                            "exception causes must derive from "
+                            "BaseException");
+            goto bad;
+        }
+        PyException_SetCause(value, fixed_cause);
+    }
+    PyErr_SetObject(type, value);
+    if (tb) {
+      #if PY_VERSION_HEX >= 0x030C00A6
+        PyException_SetTraceback(value, tb);
+      #elif CYTHON_FAST_THREAD_STATE
+        PyThreadState *tstate = __Pyx_PyThreadState_Current;
+        PyObject* tmp_tb = tstate->curexc_traceback;
+        if (tb != tmp_tb) {
+            Py_INCREF(tb);
+            tstate->curexc_traceback = tb;
+            Py_XDECREF(tmp_tb);
+        }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
+#endif
+    }
+bad:
+    Py_XDECREF(owned_instance);
+    return;
+}
+#endif
+
+/* TupleAndListFromArray */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE void __Pyx_copy_object_array(PyObject *const *CYTHON_RESTRICT src, PyObject** CYTHON_RESTRICT dest, Py_ssize_t length) {
+    PyObject *v;
+    Py_ssize_t i;
+    for (i = 0; i < length; i++) {
+        v = dest[i] = src[i];
+        Py_INCREF(v);
+    }
+}
+static CYTHON_INLINE PyObject *
+__Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n)
+{
+    PyObject *res;
+    if (n <= 0) {
+        Py_INCREF(__pyx_empty_tuple);
+        return __pyx_empty_tuple;
+    }
+    res = PyTuple_New(n);
+    if (unlikely(res == NULL)) return NULL;
+    __Pyx_copy_object_array(src, ((PyTupleObject*)res)->ob_item, n);
+    return res;
+}
+static CYTHON_INLINE PyObject *
+__Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n)
+{
+    PyObject *res;
+    if (n <= 0) {
+        return PyList_New(0);
+    }
+    res = PyList_New(n);
+    if (unlikely(res == NULL)) return NULL;
+    __Pyx_copy_object_array(src, ((PyListObject*)res)->ob_item, n);
+    return res;
+}
+#endif
+
+/* BytesEquals */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
+#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
+    return PyObject_RichCompareBool(s1, s2, equals);
+#else
+    if (s1 == s2) {
+        return (equals == Py_EQ);
+    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
+        const char *ps1, *ps2;
+        Py_ssize_t length = PyBytes_GET_SIZE(s1);
+        if (length != PyBytes_GET_SIZE(s2))
+            return (equals == Py_NE);
+        ps1 = PyBytes_AS_STRING(s1);
+        ps2 = PyBytes_AS_STRING(s2);
+        if (ps1[0] != ps2[0]) {
+            return (equals == Py_NE);
+        } else if (length == 1) {
+            return (equals == Py_EQ);
+        } else {
+            int result;
+#if CYTHON_USE_UNICODE_INTERNALS && (PY_VERSION_HEX < 0x030B0000)
+            Py_hash_t hash1, hash2;
+            hash1 = ((PyBytesObject*)s1)->ob_shash;
+            hash2 = ((PyBytesObject*)s2)->ob_shash;
+            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
+                return (equals == Py_NE);
+            }
+#endif
+            result = memcmp(ps1, ps2, (size_t)length);
+            return (equals == Py_EQ) ? (result == 0) : (result != 0);
+        }
+    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
+        return (equals == Py_NE);
+    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
+        return (equals == Py_NE);
+    } else {
+        int result;
+        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
+        if (!py_result)
+            return -1;
+        result = __Pyx_PyObject_IsTrue(py_result);
+        Py_DECREF(py_result);
+        return result;
+    }
+#endif
+}
+
+/* UnicodeEquals */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
+#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
+    return PyObject_RichCompareBool(s1, s2, equals);
+#else
+#if PY_MAJOR_VERSION < 3
+    PyObject* owned_ref = NULL;
+#endif
+    int s1_is_unicode, s2_is_unicode;
+    if (s1 == s2) {
+        goto return_eq;
+    }
+    s1_is_unicode = PyUnicode_CheckExact(s1);
+    s2_is_unicode = PyUnicode_CheckExact(s2);
+#if PY_MAJOR_VERSION < 3
+    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
+        owned_ref = PyUnicode_FromObject(s2);
+        if (unlikely(!owned_ref))
+            return -1;
+        s2 = owned_ref;
+        s2_is_unicode = 1;
+    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
+        owned_ref = PyUnicode_FromObject(s1);
+        if (unlikely(!owned_ref))
+            return -1;
+        s1 = owned_ref;
+        s1_is_unicode = 1;
+    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
+        return __Pyx_PyBytes_Equals(s1, s2, equals);
+    }
+#endif
+    if (s1_is_unicode & s2_is_unicode) {
+        Py_ssize_t length;
+        int kind;
+        void *data1, *data2;
+        if (unlikely(__Pyx_PyUnicode_READY(s1) < 0) || unlikely(__Pyx_PyUnicode_READY(s2) < 0))
+            return -1;
+        length = __Pyx_PyUnicode_GET_LENGTH(s1);
+        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
+            goto return_ne;
+        }
+#if CYTHON_USE_UNICODE_INTERNALS
+        {
+            Py_hash_t hash1, hash2;
+        #if CYTHON_PEP393_ENABLED
+            hash1 = ((PyASCIIObject*)s1)->hash;
+            hash2 = ((PyASCIIObject*)s2)->hash;
+        #else
+            hash1 = ((PyUnicodeObject*)s1)->hash;
+            hash2 = ((PyUnicodeObject*)s2)->hash;
+        #endif
+            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
+                goto return_ne;
+            }
+        }
+#endif
+        kind = __Pyx_PyUnicode_KIND(s1);
+        if (kind != __Pyx_PyUnicode_KIND(s2)) {
+            goto return_ne;
+        }
+        data1 = __Pyx_PyUnicode_DATA(s1);
+        data2 = __Pyx_PyUnicode_DATA(s2);
+        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
+            goto return_ne;
+        } else if (length == 1) {
+            goto return_eq;
+        } else {
+            int result = memcmp(data1, data2, (size_t)(length * kind));
+            #if PY_MAJOR_VERSION < 3
+            Py_XDECREF(owned_ref);
+            #endif
+            return (equals == Py_EQ) ? (result == 0) : (result != 0);
+        }
+    } else if ((s1 == Py_None) & s2_is_unicode) {
+        goto return_ne;
+    } else if ((s2 == Py_None) & s1_is_unicode) {
+        goto return_ne;
+    } else {
+        int result;
+        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
+        #if PY_MAJOR_VERSION < 3
+        Py_XDECREF(owned_ref);
+        #endif
+        if (!py_result)
+            return -1;
+        result = __Pyx_PyObject_IsTrue(py_result);
+        Py_DECREF(py_result);
+        return result;
+    }
+return_eq:
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(owned_ref);
+    #endif
+    return (equals == Py_EQ);
+return_ne:
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(owned_ref);
+    #endif
+    return (equals == Py_NE);
+#endif
+}
+
+/* fastcall */
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s)
+{
+    Py_ssize_t i, n = PyTuple_GET_SIZE(kwnames);
+    for (i = 0; i < n; i++)
+    {
+        if (s == PyTuple_GET_ITEM(kwnames, i)) return kwvalues[i];
+    }
+    for (i = 0; i < n; i++)
+    {
+        int eq = __Pyx_PyUnicode_Equals(s, PyTuple_GET_ITEM(kwnames, i), Py_EQ);
+        if (unlikely(eq != 0)) {
+            if (unlikely(eq < 0)) return NULL;  // error
+            return kwvalues[i];
+        }
+    }
+    return NULL;  // not found (no exception set)
+}
+#endif
+
 /* RaiseArgTupleInvalid */
 static void __Pyx_RaiseArgtupleInvalid(
     const char* func_name,
     int exact,
     Py_ssize_t num_min,
     Py_ssize_t num_max,
     Py_ssize_t num_found)
@@ -5212,25 +7355,37 @@
         PyString_AsString(kw_name));
         #endif
 }
 
 /* ParseKeywords */
 static int __Pyx_ParseOptionalKeywords(
     PyObject *kwds,
+    PyObject *const *kwvalues,
     PyObject **argnames[],
     PyObject *kwds2,
     PyObject *values[],
     Py_ssize_t num_pos_args,
     const char* function_name)
 {
     PyObject *key = 0, *value = 0;
     Py_ssize_t pos = 0;
     PyObject*** name;
     PyObject*** first_kw_arg = argnames + num_pos_args;
-    while (PyDict_Next(kwds, &pos, &key, &value)) {
+    int kwds_is_tuple = CYTHON_METH_FASTCALL && likely(PyTuple_Check(kwds));
+    while (1) {
+        if (kwds_is_tuple) {
+            if (pos >= PyTuple_GET_SIZE(kwds)) break;
+            key = PyTuple_GET_ITEM(kwds, pos);
+            value = kwvalues[pos];
+            pos++;
+        }
+        else
+        {
+            if (!PyDict_Next(kwds, &pos, &key, &value)) break;
+        }
         name = first_kw_arg;
         while (*name && (**name != key)) name++;
         if (*name) {
             values[name-argnames] = value;
             continue;
         }
         name = first_kw_arg;
@@ -5256,19 +7411,20 @@
                     argname++;
                 }
             }
         } else
         #endif
         if (likely(PyUnicode_Check(key))) {
             while (*name) {
-                int cmp = (**name == key) ? 0 :
+                int cmp = (
                 #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                     (__Pyx_PyUnicode_GET_LENGTH(**name) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
                 #endif
-                    PyUnicode_Compare(**name, key);
+                    PyUnicode_Compare(**name, key)
+                );
                 if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                 if (cmp == 0) {
                     values[name-argnames] = value;
                     break;
                 }
                 name++;
             }
@@ -5299,44 +7455,51 @@
     __Pyx_RaiseDoubleKeywordsError(function_name, key);
     goto bad;
 invalid_keyword_type:
     PyErr_Format(PyExc_TypeError,
         "%.200s() keywords must be strings", function_name);
     goto bad;
 invalid_keyword:
-    PyErr_Format(PyExc_TypeError,
     #if PY_MAJOR_VERSION < 3
+    PyErr_Format(PyExc_TypeError,
         "%.200s() got an unexpected keyword argument '%.200s'",
         function_name, PyString_AsString(key));
     #else
+    PyErr_Format(PyExc_TypeError,
         "%s() got an unexpected keyword argument '%U'",
         function_name, key);
     #endif
 bad:
     return -1;
 }
 
 /* ArgTypeTest */
 static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
 {
+    __Pyx_TypeName type_name;
+    __Pyx_TypeName obj_type_name;
     if (unlikely(!type)) {
         PyErr_SetString(PyExc_SystemError, "Missing type object");
         return 0;
     }
     else if (exact) {
         #if PY_MAJOR_VERSION == 2
         if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
         #endif
     }
     else {
         if (likely(__Pyx_TypeCheck(obj, type))) return 1;
     }
+    type_name = __Pyx_PyType_GetName(type);
+    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
     PyErr_Format(PyExc_TypeError,
-        "Argument '%.200s' has incorrect type (expected %.200s, got %.200s)",
-        name, type->tp_name, Py_TYPE(obj)->tp_name);
+        "Argument '%.200s' has incorrect type (expected " __Pyx_FMT_TYPENAME
+        ", got " __Pyx_FMT_TYPENAME ")", name, type_name, obj_type_name);
+    __Pyx_DECREF_TypeName(type_name);
+    __Pyx_DECREF_TypeName(obj_type_name);
     return 0;
 }
 
 /* IsLittleEndian */
 static CYTHON_INLINE int __Pyx_Is_Little_Endian(void)
 {
   union {
@@ -5419,15 +7582,15 @@
     case 'd': return (is_complex ? "'complex double'" : "'double'");
     case 'g': return (is_complex ? "'complex long double'" : "'long double'");
     case 'T': return "a struct";
     case 'O': return "Python object";
     case 'P': return "a pointer";
     case 's': case 'p': return "a string";
     case 0: return "end";
-    default: return "unparseable format string";
+    default: return "unparsable format string";
   }
 }
 static size_t __Pyx_BufFmt_TypeCharToStandardSize(char ch, int is_complex) {
   switch (ch) {
     case '?': case 'c': case 'b': case 'B': case 's': case 'p': return 1;
     case 'h': case 'H': return 2;
     case 'i': case 'I': case 'l': case 'L': return 4;
@@ -5469,15 +7632,16 @@
 typedef struct { char c; float x; } __Pyx_st_float;
 typedef struct { char c; double x; } __Pyx_st_double;
 typedef struct { char c; long double x; } __Pyx_st_longdouble;
 typedef struct { char c; void *x; } __Pyx_st_void_p;
 #ifdef HAVE_LONG_LONG
 typedef struct { char c; PY_LONG_LONG x; } __Pyx_st_longlong;
 #endif
-static size_t __Pyx_BufFmt_TypeCharToAlignment(char ch, CYTHON_UNUSED int is_complex) {
+static size_t __Pyx_BufFmt_TypeCharToAlignment(char ch, int is_complex) {
+  CYTHON_UNUSED_VAR(is_complex);
   switch (ch) {
     case '?': case 'c': case 'b': case 'B': case 's': case 'p': return 1;
     case 'h': case 'H': return sizeof(__Pyx_st_short) - sizeof(short);
     case 'i': case 'I': return sizeof(__Pyx_st_int) - sizeof(int);
     case 'l': case 'L': return sizeof(__Pyx_st_long) - sizeof(long);
 #ifdef HAVE_LONG_LONG
     case 'q': case 'Q': return sizeof(__Pyx_st_longlong) - sizeof(PY_LONG_LONG);
@@ -5501,15 +7665,16 @@
 typedef struct { float x; char c; } __Pyx_pad_float;
 typedef struct { double x; char c; } __Pyx_pad_double;
 typedef struct { long double x; char c; } __Pyx_pad_longdouble;
 typedef struct { void *x; char c; } __Pyx_pad_void_p;
 #ifdef HAVE_LONG_LONG
 typedef struct { PY_LONG_LONG x; char c; } __Pyx_pad_longlong;
 #endif
-static size_t __Pyx_BufFmt_TypeCharToPadding(char ch, CYTHON_UNUSED int is_complex) {
+static size_t __Pyx_BufFmt_TypeCharToPadding(char ch, int is_complex) {
+  CYTHON_UNUSED_VAR(is_complex);
   switch (ch) {
     case '?': case 'c': case 'b': case 'B': case 's': case 'p': return 1;
     case 'h': case 'H': return sizeof(__Pyx_pad_short) - sizeof(short);
     case 'i': case 'I': return sizeof(__Pyx_pad_int) - sizeof(int);
     case 'l': case 'L': return sizeof(__Pyx_pad_long) - sizeof(long);
 #ifdef HAVE_LONG_LONG
     case 'q': case 'Q': return sizeof(__Pyx_pad_longlong) - sizeof(PY_LONG_LONG);
@@ -5892,396 +8057,38 @@
   if (buf->suboffsets == NULL) buf->suboffsets = __Pyx_minusones;
   return 0;
 fail:;
   __Pyx_SafeReleaseBuffer(buf);
   return -1;
 }
 
-/* PyErrFetchRestore */
-  #if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    tmp_type = tstate->curexc_type;
-    tmp_value = tstate->curexc_value;
-    tmp_tb = tstate->curexc_traceback;
-    tstate->curexc_type = type;
-    tstate->curexc_value = value;
-    tstate->curexc_traceback = tb;
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    *type = tstate->curexc_type;
-    *value = tstate->curexc_value;
-    *tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-}
-#endif
-
-/* GetTopmostException */
-  #if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem *
-__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
-{
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
-           exc_info->previous_item != NULL)
-    {
-        exc_info = exc_info->previous_item;
-    }
-    return exc_info;
-}
-#endif
-
-/* SaveResetException */
-  #if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
-    *type = exc_info->exc_type;
-    *value = exc_info->exc_value;
-    *tb = exc_info->exc_traceback;
-    #else
-    *type = tstate->exc_type;
-    *value = tstate->exc_value;
-    *tb = tstate->exc_traceback;
-    #endif
-    Py_XINCREF(*type);
-    Py_XINCREF(*value);
-    Py_XINCREF(*tb);
-}
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = type;
-    exc_info->exc_value = value;
-    exc_info->exc_traceback = tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = type;
-    tstate->exc_value = value;
-    tstate->exc_traceback = tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-#endif
-
-/* PyErrExceptionMatches */
-  #if CYTHON_FAST_THREAD_STATE
-static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
-    Py_ssize_t i, n;
-    n = PyTuple_GET_SIZE(tuple);
-#if PY_MAJOR_VERSION >= 3
-    for (i=0; i<n; i++) {
-        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
-    }
-#endif
-    for (i=0; i<n; i++) {
-        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
-    }
-    return 0;
-}
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
-    PyObject *exc_type = tstate->curexc_type;
-    if (exc_type == err) return 1;
-    if (unlikely(!exc_type)) return 0;
-    if (unlikely(PyTuple_Check(err)))
-        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
-    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
-}
-#endif
-
-/* GetException */
-  #if CYTHON_FAST_THREAD_STATE
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
-#endif
-{
-    PyObject *local_type, *local_value, *local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    local_type = tstate->curexc_type;
-    local_value = tstate->curexc_value;
-    local_tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-#else
-    PyErr_Fetch(&local_type, &local_value, &local_tb);
-#endif
-    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
-#if CYTHON_FAST_THREAD_STATE
-    if (unlikely(tstate->curexc_type))
-#else
-    if (unlikely(PyErr_Occurred()))
-#endif
-        goto bad;
-    #if PY_MAJOR_VERSION >= 3
-    if (local_tb) {
-        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
-            goto bad;
-    }
-    #endif
-    Py_XINCREF(local_tb);
-    Py_XINCREF(local_type);
-    Py_XINCREF(local_value);
-    *type = local_type;
-    *value = local_value;
-    *tb = local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    #if CYTHON_USE_EXC_INFO_STACK
-    {
-        _PyErr_StackItem *exc_info = tstate->exc_info;
-        tmp_type = exc_info->exc_type;
-        tmp_value = exc_info->exc_value;
-        tmp_tb = exc_info->exc_traceback;
-        exc_info->exc_type = local_type;
-        exc_info->exc_value = local_value;
-        exc_info->exc_traceback = local_tb;
-    }
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = local_type;
-    tstate->exc_value = local_value;
-    tstate->exc_traceback = local_tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-#else
-    PyErr_SetExcInfo(local_type, local_value, local_tb);
-#endif
-    return 0;
-bad:
-    *type = 0;
-    *value = 0;
-    *tb = 0;
-    Py_XDECREF(local_type);
-    Py_XDECREF(local_value);
-    Py_XDECREF(local_tb);
-    return -1;
-}
-
-/* PyObjectCall */
-  #if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
-    PyObject *result;
-    ternaryfunc call = Py_TYPE(func)->tp_call;
-    if (unlikely(!call))
-        return PyObject_Call(func, arg, kw);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = (*call)(func, arg, kw);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
-/* RaiseException */
-  #if PY_MAJOR_VERSION < 3
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
-                        CYTHON_UNUSED PyObject *cause) {
-    __Pyx_PyThreadState_declare
-    Py_XINCREF(type);
-    if (!value || value == Py_None)
-        value = NULL;
-    else
-        Py_INCREF(value);
-    if (!tb || tb == Py_None)
-        tb = NULL;
-    else {
-        Py_INCREF(tb);
-        if (!PyTraceBack_Check(tb)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: arg 3 must be a traceback or None");
-            goto raise_error;
-        }
-    }
-    if (PyType_Check(type)) {
-#if CYTHON_COMPILING_IN_PYPY
-        if (!value) {
-            Py_INCREF(Py_None);
-            value = Py_None;
-        }
-#endif
-        PyErr_NormalizeException(&type, &value, &tb);
-    } else {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto raise_error;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(type);
-        Py_INCREF(type);
-        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: exception class must be a subclass of BaseException");
-            goto raise_error;
-        }
-    }
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrRestore(type, value, tb);
-    return;
-raise_error:
-    Py_XDECREF(value);
-    Py_XDECREF(type);
-    Py_XDECREF(tb);
-    return;
-}
-#else
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
-    PyObject* owned_instance = NULL;
-    if (tb == Py_None) {
-        tb = 0;
-    } else if (tb && !PyTraceBack_Check(tb)) {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: arg 3 must be a traceback or None");
-        goto bad;
-    }
-    if (value == Py_None)
-        value = 0;
-    if (PyExceptionInstance_Check(type)) {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto bad;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(value);
-    } else if (PyExceptionClass_Check(type)) {
-        PyObject *instance_class = NULL;
-        if (value && PyExceptionInstance_Check(value)) {
-            instance_class = (PyObject*) Py_TYPE(value);
-            if (instance_class != type) {
-                int is_subclass = PyObject_IsSubclass(instance_class, type);
-                if (!is_subclass) {
-                    instance_class = NULL;
-                } else if (unlikely(is_subclass == -1)) {
-                    goto bad;
-                } else {
-                    type = instance_class;
-                }
-            }
-        }
-        if (!instance_class) {
-            PyObject *args;
-            if (!value)
-                args = PyTuple_New(0);
-            else if (PyTuple_Check(value)) {
-                Py_INCREF(value);
-                args = value;
-            } else
-                args = PyTuple_Pack(1, value);
-            if (!args)
-                goto bad;
-            owned_instance = PyObject_Call(type, args, NULL);
-            Py_DECREF(args);
-            if (!owned_instance)
-                goto bad;
-            value = owned_instance;
-            if (!PyExceptionInstance_Check(value)) {
-                PyErr_Format(PyExc_TypeError,
-                             "calling %R should have returned an instance of "
-                             "BaseException, not %R",
-                             type, Py_TYPE(value));
-                goto bad;
-            }
-        }
-    } else {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: exception class must be a subclass of BaseException");
-        goto bad;
-    }
-    if (cause) {
-        PyObject *fixed_cause;
-        if (cause == Py_None) {
-            fixed_cause = NULL;
-        } else if (PyExceptionClass_Check(cause)) {
-            fixed_cause = PyObject_CallObject(cause, NULL);
-            if (fixed_cause == NULL)
-                goto bad;
-        } else if (PyExceptionInstance_Check(cause)) {
-            fixed_cause = cause;
-            Py_INCREF(fixed_cause);
-        } else {
-            PyErr_SetString(PyExc_TypeError,
-                            "exception causes must derive from "
-                            "BaseException");
-            goto bad;
-        }
-        PyException_SetCause(value, fixed_cause);
-    }
-    PyErr_SetObject(type, value);
-    if (tb) {
-#if CYTHON_FAST_THREAD_STATE
-        PyThreadState *tstate = __Pyx_PyThreadState_Current;
-        PyObject* tmp_tb = tstate->curexc_traceback;
-        if (tb != tmp_tb) {
-            Py_INCREF(tb);
-            tstate->curexc_traceback = tb;
-            Py_XDECREF(tmp_tb);
-        }
-#else
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#endif
-    }
-bad:
-    Py_XDECREF(owned_instance);
-    return;
-}
-#endif
-
 /* TypeImport */
-  #ifndef __PYX_HAVE_RT_ImportType_0_29_36
-#define __PYX_HAVE_RT_ImportType_0_29_36
-static PyTypeObject *__Pyx_ImportType_0_29_36(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_36 check_size)
+  #ifndef __PYX_HAVE_RT_ImportType_3_0_0
+#define __PYX_HAVE_RT_ImportType_3_0_0
+static PyTypeObject *__Pyx_ImportType_3_0_0(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_0 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
     Py_ssize_t itemsize;
-#ifdef Py_LIMITED_API
+#if CYTHON_COMPILING_IN_LIMITED_API
     PyObject *py_basicsize;
     PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
-#ifndef Py_LIMITED_API
+#if !CYTHON_COMPILING_IN_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
     itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
@@ -6305,25 +8112,26 @@
         if (itemsize < (Py_ssize_t)alignment)
             itemsize = (Py_ssize_t)alignment;
     }
     if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
+            module_name, class_name, size, basicsize+itemsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_36 && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_3_0_0 &&
+            ((size_t)basicsize > size || (size_t)(basicsize + itemsize) < size)) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
+            "Expected %zd from C header, got %zd-%zd from PyObject",
+            module_name, class_name, size, basicsize, basicsize+itemsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_36 && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_3_0_0 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -6331,77 +8139,208 @@
     Py_XDECREF(result);
     return NULL;
 }
 #endif
 
 /* Import */
   static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
-    PyObject *empty_list = 0;
     PyObject *module = 0;
-    PyObject *global_dict = 0;
     PyObject *empty_dict = 0;
-    PyObject *list;
+    PyObject *empty_list = 0;
     #if PY_MAJOR_VERSION < 3
     PyObject *py_import;
     py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
-    if (!py_import)
+    if (unlikely(!py_import))
         goto bad;
-    #endif
-    if (from_list)
-        list = from_list;
-    else {
+    if (!from_list) {
         empty_list = PyList_New(0);
-        if (!empty_list)
+        if (unlikely(!empty_list))
             goto bad;
-        list = empty_list;
+        from_list = empty_list;
     }
-    global_dict = PyModule_GetDict(__pyx_m);
-    if (!global_dict)
-        goto bad;
+    #endif
     empty_dict = PyDict_New();
-    if (!empty_dict)
+    if (unlikely(!empty_dict))
         goto bad;
     {
         #if PY_MAJOR_VERSION >= 3
         if (level == -1) {
             if ((1) && (strchr(__Pyx_MODULE_NAME, '.'))) {
+                #if CYTHON_COMPILING_IN_LIMITED_API
+                module = PyImport_ImportModuleLevelObject(
+                    name, empty_dict, empty_dict, from_list, 1);
+                #else
                 module = PyImport_ImportModuleLevelObject(
-                    name, global_dict, empty_dict, list, 1);
-                if (!module) {
-                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
+                    name, __pyx_d, empty_dict, from_list, 1);
+                #endif
+                if (unlikely(!module)) {
+                    if (unlikely(!PyErr_ExceptionMatches(PyExc_ImportError)))
                         goto bad;
                     PyErr_Clear();
                 }
             }
             level = 0;
         }
         #endif
         if (!module) {
             #if PY_MAJOR_VERSION < 3
             PyObject *py_level = PyInt_FromLong(level);
-            if (!py_level)
+            if (unlikely(!py_level))
                 goto bad;
             module = PyObject_CallFunctionObjArgs(py_import,
-                name, global_dict, empty_dict, list, py_level, (PyObject *)NULL);
+                name, __pyx_d, empty_dict, from_list, py_level, (PyObject *)NULL);
             Py_DECREF(py_level);
             #else
+            #if CYTHON_COMPILING_IN_LIMITED_API
+            module = PyImport_ImportModuleLevelObject(
+                name, empty_dict, empty_dict, from_list, level);
+            #else
             module = PyImport_ImportModuleLevelObject(
-                name, global_dict, empty_dict, list, level);
+                name, __pyx_d, empty_dict, from_list, level);
+            #endif
             #endif
         }
     }
 bad:
+    Py_XDECREF(empty_dict);
+    Py_XDECREF(empty_list);
     #if PY_MAJOR_VERSION < 3
     Py_XDECREF(py_import);
     #endif
-    Py_XDECREF(empty_list);
-    Py_XDECREF(empty_dict);
     return module;
 }
 
+/* ImportDottedModule */
+  #if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx__ImportDottedModule_Error(PyObject *name, PyObject *parts_tuple, Py_ssize_t count) {
+    PyObject *partial_name = NULL, *slice = NULL, *sep = NULL;
+    if (unlikely(PyErr_Occurred())) {
+        PyErr_Clear();
+    }
+    if (likely(PyTuple_GET_SIZE(parts_tuple) == count)) {
+        partial_name = name;
+    } else {
+        slice = PySequence_GetSlice(parts_tuple, 0, count);
+        if (unlikely(!slice))
+            goto bad;
+        sep = PyUnicode_FromStringAndSize(".", 1);
+        if (unlikely(!sep))
+            goto bad;
+        partial_name = PyUnicode_Join(sep, slice);
+    }
+    PyErr_Format(
+#if PY_MAJOR_VERSION < 3
+        PyExc_ImportError,
+        "No module named '%s'", PyString_AS_STRING(partial_name));
+#else
+#if PY_VERSION_HEX >= 0x030600B1
+        PyExc_ModuleNotFoundError,
+#else
+        PyExc_ImportError,
+#endif
+        "No module named '%U'", partial_name);
+#endif
+bad:
+    Py_XDECREF(sep);
+    Py_XDECREF(slice);
+    Py_XDECREF(partial_name);
+    return NULL;
+}
+#endif
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx__ImportDottedModule_Lookup(PyObject *name) {
+    PyObject *imported_module;
+#if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
+    PyObject *modules = PyImport_GetModuleDict();
+    if (unlikely(!modules))
+        return NULL;
+    imported_module = __Pyx_PyDict_GetItemStr(modules, name);
+    Py_XINCREF(imported_module);
+#else
+    imported_module = PyImport_GetModule(name);
+#endif
+    return imported_module;
+}
+#endif
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx_ImportDottedModule_WalkParts(PyObject *module, PyObject *name, PyObject *parts_tuple) {
+    Py_ssize_t i, nparts;
+    nparts = PyTuple_GET_SIZE(parts_tuple);
+    for (i=1; i < nparts && module; i++) {
+        PyObject *part, *submodule;
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        part = PyTuple_GET_ITEM(parts_tuple, i);
+#else
+        part = PySequence_ITEM(parts_tuple, i);
+#endif
+        submodule = __Pyx_PyObject_GetAttrStrNoError(module, part);
+#if !(CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS)
+        Py_DECREF(part);
+#endif
+        Py_DECREF(module);
+        module = submodule;
+    }
+    if (unlikely(!module)) {
+        return __Pyx__ImportDottedModule_Error(name, parts_tuple, i);
+    }
+    return module;
+}
+#endif
+static PyObject *__Pyx__ImportDottedModule(PyObject *name, PyObject *parts_tuple) {
+#if PY_MAJOR_VERSION < 3
+    PyObject *module, *from_list, *star = __pyx_n_s__3;
+    CYTHON_UNUSED_VAR(parts_tuple);
+    from_list = PyList_New(1);
+    if (unlikely(!from_list))
+        return NULL;
+    Py_INCREF(star);
+    PyList_SET_ITEM(from_list, 0, star);
+    module = __Pyx_Import(name, from_list, 0);
+    Py_DECREF(from_list);
+    return module;
+#else
+    PyObject *imported_module;
+    PyObject *module = __Pyx_Import(name, NULL, 0);
+    if (!parts_tuple || unlikely(!module))
+        return module;
+    imported_module = __Pyx__ImportDottedModule_Lookup(name);
+    if (likely(imported_module)) {
+        Py_DECREF(module);
+        return imported_module;
+    }
+    PyErr_Clear();
+    return __Pyx_ImportDottedModule_WalkParts(module, name, parts_tuple);
+#endif
+}
+static PyObject *__Pyx_ImportDottedModule(PyObject *name, PyObject *parts_tuple) {
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030400B1
+    PyObject *module = __Pyx__ImportDottedModule_Lookup(name);
+    if (likely(module)) {
+        PyObject *spec = __Pyx_PyObject_GetAttrStrNoError(module, __pyx_n_s_spec);
+        if (likely(spec)) {
+            PyObject *unsafe = __Pyx_PyObject_GetAttrStrNoError(spec, __pyx_n_s_initializing);
+            if (likely(!unsafe || !__Pyx_PyObject_IsTrue(unsafe))) {
+                Py_DECREF(spec);
+                spec = NULL;
+            }
+            Py_XDECREF(unsafe);
+        }
+        if (likely(!spec)) {
+            PyErr_Clear();
+            return module;
+        }
+        Py_DECREF(spec);
+        Py_DECREF(module);
+    } else if (PyErr_Occurred()) {
+        PyErr_Clear();
+    }
+#endif
+    return __Pyx__ImportDottedModule(name, parts_tuple);
+}
+
 /* PyDictVersioning */
   #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
     PyObject *dict = Py_TYPE(obj)->tp_dict;
     return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
 }
 static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
@@ -6437,14 +8376,22 @@
     result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
     __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
     if (likely(result)) {
         return __Pyx_NewRef(result);
     } else if (unlikely(PyErr_Occurred())) {
         return NULL;
     }
+#elif CYTHON_COMPILING_IN_LIMITED_API
+    if (unlikely(!__pyx_m)) {
+        return NULL;
+    }
+    result = PyObject_GetAttr(__pyx_m, name);
+    if (likely(result)) {
+        return result;
+    }
 #else
     result = PyDict_GetItem(__pyx_d, name);
     __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
     if (likely(result)) {
         return __Pyx_NewRef(result);
     }
 #endif
@@ -6455,36 +8402,1159 @@
         return __Pyx_NewRef(result);
     }
     PyErr_Clear();
 #endif
     return __Pyx_GetBuiltinName(name);
 }
 
+/* FixUpExtensionType */
+  #if CYTHON_USE_TYPE_SPECS
+static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type) {
+#if PY_VERSION_HEX > 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
+    CYTHON_UNUSED_VAR(spec);
+    CYTHON_UNUSED_VAR(type);
+#else
+    const PyType_Slot *slot = spec->slots;
+    while (slot && slot->slot && slot->slot != Py_tp_members)
+        slot++;
+    if (slot && slot->slot == Py_tp_members) {
+        int changed = 0;
+#if !(PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON)
+        const
+#endif
+            PyMemberDef *memb = (PyMemberDef*) slot->pfunc;
+        while (memb && memb->name) {
+            if (memb->name[0] == '_' && memb->name[1] == '_') {
+#if PY_VERSION_HEX < 0x030900b1
+                if (strcmp(memb->name, "__weaklistoffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+                    type->tp_weaklistoffset = memb->offset;
+                    changed = 1;
+                }
+                else if (strcmp(memb->name, "__dictoffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+                    type->tp_dictoffset = memb->offset;
+                    changed = 1;
+                }
+#if CYTHON_METH_FASTCALL
+                else if (strcmp(memb->name, "__vectorcalloffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+#if PY_VERSION_HEX >= 0x030800b4
+                    type->tp_vectorcall_offset = memb->offset;
+#else
+                    type->tp_print = (printfunc) memb->offset;
+#endif
+                    changed = 1;
+                }
+#endif
+#else
+                if ((0));
+#endif
+#if PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON
+                else if (strcmp(memb->name, "__module__") == 0) {
+                    PyObject *descr;
+                    assert(memb->type == T_OBJECT);
+                    assert(memb->flags == 0 || memb->flags == READONLY);
+                    descr = PyDescr_NewMember(type, memb);
+                    if (unlikely(!descr))
+                        return -1;
+                    if (unlikely(PyDict_SetItem(type->tp_dict, PyDescr_NAME(descr), descr) < 0)) {
+                        Py_DECREF(descr);
+                        return -1;
+                    }
+                    Py_DECREF(descr);
+                    changed = 1;
+                }
+#endif
+            }
+            memb++;
+        }
+        if (changed)
+            PyType_Modified(type);
+    }
+#endif
+    return 0;
+}
+#endif
+
+/* FetchSharedCythonModule */
+  static PyObject *__Pyx_FetchSharedCythonABIModule(void) {
+    PyObject *abi_module = PyImport_AddModule((char*) __PYX_ABI_MODULE_NAME);
+    if (unlikely(!abi_module)) return NULL;
+    Py_INCREF(abi_module);
+    return abi_module;
+}
+
+/* FetchCommonType */
+  static int __Pyx_VerifyCachedType(PyObject *cached_type,
+                               const char *name,
+                               Py_ssize_t basicsize,
+                               Py_ssize_t expected_basicsize) {
+    if (!PyType_Check(cached_type)) {
+        PyErr_Format(PyExc_TypeError,
+            "Shared Cython type %.200s is not a type object", name);
+        return -1;
+    }
+    if (basicsize != expected_basicsize) {
+        PyErr_Format(PyExc_TypeError,
+            "Shared Cython type %.200s has the wrong size, try recompiling",
+            name);
+        return -1;
+    }
+    return 0;
+}
+#if !CYTHON_USE_TYPE_SPECS
+static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
+    PyObject* abi_module;
+    const char* object_name;
+    PyTypeObject *cached_type = NULL;
+    abi_module = __Pyx_FetchSharedCythonABIModule();
+    if (!abi_module) return NULL;
+    object_name = strrchr(type->tp_name, '.');
+    object_name = object_name ? object_name+1 : type->tp_name;
+    cached_type = (PyTypeObject*) PyObject_GetAttrString(abi_module, object_name);
+    if (cached_type) {
+        if (__Pyx_VerifyCachedType(
+              (PyObject *)cached_type,
+              object_name,
+              cached_type->tp_basicsize,
+              type->tp_basicsize) < 0) {
+            goto bad;
+        }
+        goto done;
+    }
+    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
+    PyErr_Clear();
+    if (PyType_Ready(type) < 0) goto bad;
+    if (PyObject_SetAttrString(abi_module, object_name, (PyObject *)type) < 0)
+        goto bad;
+    Py_INCREF(type);
+    cached_type = type;
+done:
+    Py_DECREF(abi_module);
+    return cached_type;
+bad:
+    Py_XDECREF(cached_type);
+    cached_type = NULL;
+    goto done;
+}
+#else
+static PyTypeObject *__Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases) {
+    PyObject *abi_module, *cached_type = NULL;
+    const char* object_name = strrchr(spec->name, '.');
+    object_name = object_name ? object_name+1 : spec->name;
+    abi_module = __Pyx_FetchSharedCythonABIModule();
+    if (!abi_module) return NULL;
+    cached_type = PyObject_GetAttrString(abi_module, object_name);
+    if (cached_type) {
+        Py_ssize_t basicsize;
+#if CYTHON_COMPILING_IN_LIMITED_API
+        PyObject *py_basicsize;
+        py_basicsize = PyObject_GetAttrString(cached_type, "__basicsize__");
+        if (unlikely(!py_basicsize)) goto bad;
+        basicsize = PyLong_AsSsize_t(py_basicsize);
+        Py_DECREF(py_basicsize);
+        py_basicsize = 0;
+        if (unlikely(basicsize == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
+#else
+        basicsize = likely(PyType_Check(cached_type)) ? ((PyTypeObject*) cached_type)->tp_basicsize : -1;
+#endif
+        if (__Pyx_VerifyCachedType(
+              cached_type,
+              object_name,
+              basicsize,
+              spec->basicsize) < 0) {
+            goto bad;
+        }
+        goto done;
+    }
+    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
+    PyErr_Clear();
+    CYTHON_UNUSED_VAR(module);
+    cached_type = __Pyx_PyType_FromModuleAndSpec(abi_module, spec, bases);
+    if (unlikely(!cached_type)) goto bad;
+    if (unlikely(__Pyx_fix_up_extension_type_from_spec(spec, (PyTypeObject *) cached_type) < 0)) goto bad;
+    if (PyObject_SetAttrString(abi_module, object_name, cached_type) < 0) goto bad;
+done:
+    Py_DECREF(abi_module);
+    assert(cached_type == NULL || PyType_Check(cached_type));
+    return (PyTypeObject *) cached_type;
+bad:
+    Py_XDECREF(cached_type);
+    cached_type = NULL;
+    goto done;
+}
+#endif
+
+/* PyVectorcallFastCallDict */
+  #if CYTHON_METH_FASTCALL
+static PyObject *__Pyx_PyVectorcall_FastCallDict_kw(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
+{
+    PyObject *res = NULL;
+    PyObject *kwnames;
+    PyObject **newargs;
+    PyObject **kwvalues;
+    Py_ssize_t i, pos;
+    size_t j;
+    PyObject *key, *value;
+    unsigned long keys_are_strings;
+    Py_ssize_t nkw = PyDict_GET_SIZE(kw);
+    newargs = (PyObject **)PyMem_Malloc((nargs + (size_t)nkw) * sizeof(args[0]));
+    if (unlikely(newargs == NULL)) {
+        PyErr_NoMemory();
+        return NULL;
+    }
+    for (j = 0; j < nargs; j++) newargs[j] = args[j];
+    kwnames = PyTuple_New(nkw);
+    if (unlikely(kwnames == NULL)) {
+        PyMem_Free(newargs);
+        return NULL;
+    }
+    kwvalues = newargs + nargs;
+    pos = i = 0;
+    keys_are_strings = Py_TPFLAGS_UNICODE_SUBCLASS;
+    while (PyDict_Next(kw, &pos, &key, &value)) {
+        keys_are_strings &= Py_TYPE(key)->tp_flags;
+        Py_INCREF(key);
+        Py_INCREF(value);
+        PyTuple_SET_ITEM(kwnames, i, key);
+        kwvalues[i] = value;
+        i++;
+    }
+    if (unlikely(!keys_are_strings)) {
+        PyErr_SetString(PyExc_TypeError, "keywords must be strings");
+        goto cleanup;
+    }
+    res = vc(func, newargs, nargs, kwnames);
+cleanup:
+    Py_DECREF(kwnames);
+    for (i = 0; i < nkw; i++)
+        Py_DECREF(kwvalues[i]);
+    PyMem_Free(newargs);
+    return res;
+}
+static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
+{
+    if (likely(kw == NULL) || PyDict_GET_SIZE(kw) == 0) {
+        return vc(func, args, nargs, NULL);
+    }
+    return __Pyx_PyVectorcall_FastCallDict_kw(func, vc, args, nargs, kw);
+}
+#endif
+
+/* CythonFunctionShared */
+  static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj) {
+#if PY_VERSION_HEX < 0x030900B1
+    __Pyx_Py_XDECREF_SET(
+        __Pyx_CyFunction_GetClassObj(f),
+            ((classobj) ? __Pyx_NewRef(classobj) : NULL));
+#else
+    __Pyx_Py_XDECREF_SET(
+        ((PyCMethodObject *) (f))->mm_class,
+        (PyTypeObject*)((classobj) ? __Pyx_NewRef(classobj) : NULL));
+#endif
+}
+static PyObject *
+__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, void *closure)
+{
+    CYTHON_UNUSED_VAR(closure);
+    if (unlikely(op->func_doc == NULL)) {
+        if (((PyCFunctionObject*)op)->m_ml->ml_doc) {
+#if PY_MAJOR_VERSION >= 3
+            op->func_doc = PyUnicode_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
+#else
+            op->func_doc = PyString_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
+#endif
+            if (unlikely(op->func_doc == NULL))
+                return NULL;
+        } else {
+            Py_INCREF(Py_None);
+            return Py_None;
+        }
+    }
+    Py_INCREF(op->func_doc);
+    return op->func_doc;
+}
+static int
+__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (value == NULL) {
+        value = Py_None;
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_doc, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(op->func_name == NULL)) {
+#if PY_MAJOR_VERSION >= 3
+        op->func_name = PyUnicode_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
+#else
+        op->func_name = PyString_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
+#endif
+        if (unlikely(op->func_name == NULL))
+            return NULL;
+    }
+    Py_INCREF(op->func_name);
+    return op->func_name;
+}
+static int
+__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+#if PY_MAJOR_VERSION >= 3
+    if (unlikely(value == NULL || !PyUnicode_Check(value)))
+#else
+    if (unlikely(value == NULL || !PyString_Check(value)))
+#endif
+    {
+        PyErr_SetString(PyExc_TypeError,
+                        "__name__ must be set to a string object");
+        return -1;
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_name, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(op->func_qualname);
+    return op->func_qualname;
+}
+static int
+__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+#if PY_MAJOR_VERSION >= 3
+    if (unlikely(value == NULL || !PyUnicode_Check(value)))
+#else
+    if (unlikely(value == NULL || !PyString_Check(value)))
+#endif
+    {
+        PyErr_SetString(PyExc_TypeError,
+                        "__qualname__ must be set to a string object");
+        return -1;
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_qualname, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(op->func_dict == NULL)) {
+        op->func_dict = PyDict_New();
+        if (unlikely(op->func_dict == NULL))
+            return NULL;
+    }
+    Py_INCREF(op->func_dict);
+    return op->func_dict;
+}
+static int
+__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(value == NULL)) {
+        PyErr_SetString(PyExc_TypeError,
+               "function's dictionary may not be deleted");
+        return -1;
+    }
+    if (unlikely(!PyDict_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+               "setting function's dictionary to a non-dict");
+        return -1;
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_dict, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_globals(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(op->func_globals);
+    return op->func_globals;
+}
+static PyObject *
+__Pyx_CyFunction_get_closure(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(op);
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(Py_None);
+    return Py_None;
+}
+static PyObject *
+__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op, void *context)
+{
+    PyObject* result = (op->func_code) ? op->func_code : Py_None;
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(result);
+    return result;
+}
+static int
+__Pyx_CyFunction_init_defaults(__pyx_CyFunctionObject *op) {
+    int result = 0;
+    PyObject *res = op->defaults_getter((PyObject *) op);
+    if (unlikely(!res))
+        return -1;
+    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    op->defaults_tuple = PyTuple_GET_ITEM(res, 0);
+    Py_INCREF(op->defaults_tuple);
+    op->defaults_kwdict = PyTuple_GET_ITEM(res, 1);
+    Py_INCREF(op->defaults_kwdict);
+    #else
+    op->defaults_tuple = PySequence_ITEM(res, 0);
+    if (unlikely(!op->defaults_tuple)) result = -1;
+    else {
+        op->defaults_kwdict = PySequence_ITEM(res, 1);
+        if (unlikely(!op->defaults_kwdict)) result = -1;
+    }
+    #endif
+    Py_DECREF(res);
+    return result;
+}
+static int
+__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
+    if (!value) {
+        value = Py_None;
+    } else if (unlikely(value != Py_None && !PyTuple_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+                        "__defaults__ must be set to a tuple object");
+        return -1;
+    }
+    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__defaults__ will not "
+                 "currently affect the values used in function calls", 1);
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->defaults_tuple, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op, void *context) {
+    PyObject* result = op->defaults_tuple;
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(!result)) {
+        if (op->defaults_getter) {
+            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
+            result = op->defaults_tuple;
+        } else {
+            result = Py_None;
+        }
+    }
+    Py_INCREF(result);
+    return result;
+}
+static int
+__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
+    if (!value) {
+        value = Py_None;
+    } else if (unlikely(value != Py_None && !PyDict_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+                        "__kwdefaults__ must be set to a dict object");
+        return -1;
+    }
+    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__kwdefaults__ will not "
+                 "currently affect the values used in function calls", 1);
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->defaults_kwdict, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op, void *context) {
+    PyObject* result = op->defaults_kwdict;
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(!result)) {
+        if (op->defaults_getter) {
+            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
+            result = op->defaults_kwdict;
+        } else {
+            result = Py_None;
+        }
+    }
+    Py_INCREF(result);
+    return result;
+}
+static int
+__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
+    if (!value || value == Py_None) {
+        value = NULL;
+    } else if (unlikely(!PyDict_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+                        "__annotations__ must be set to a dict object");
+        return -1;
+    }
+    Py_XINCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_annotations, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op, void *context) {
+    PyObject* result = op->func_annotations;
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(!result)) {
+        result = PyDict_New();
+        if (unlikely(!result)) return NULL;
+        op->func_annotations = result;
+    }
+    Py_INCREF(result);
+    return result;
+}
+static PyObject *
+__Pyx_CyFunction_get_is_coroutine(__pyx_CyFunctionObject *op, void *context) {
+    int is_coroutine;
+    CYTHON_UNUSED_VAR(context);
+    if (op->func_is_coroutine) {
+        return __Pyx_NewRef(op->func_is_coroutine);
+    }
+    is_coroutine = op->flags & __Pyx_CYFUNCTION_COROUTINE;
+#if PY_VERSION_HEX >= 0x03050000
+    if (is_coroutine) {
+        PyObject *module, *fromlist, *marker = __pyx_n_s_is_coroutine;
+        fromlist = PyList_New(1);
+        if (unlikely(!fromlist)) return NULL;
+        Py_INCREF(marker);
+        PyList_SET_ITEM(fromlist, 0, marker);
+        module = PyImport_ImportModuleLevelObject(__pyx_n_s_asyncio_coroutines, NULL, NULL, fromlist, 0);
+        Py_DECREF(fromlist);
+        if (unlikely(!module)) goto ignore;
+        op->func_is_coroutine = __Pyx_PyObject_GetAttrStr(module, marker);
+        Py_DECREF(module);
+        if (likely(op->func_is_coroutine)) {
+            return __Pyx_NewRef(op->func_is_coroutine);
+        }
+ignore:
+        PyErr_Clear();
+    }
+#endif
+    op->func_is_coroutine = __Pyx_PyBool_FromLong(is_coroutine);
+    return __Pyx_NewRef(op->func_is_coroutine);
+}
+static PyGetSetDef __pyx_CyFunction_getsets[] = {
+    {(char *) "func_doc", (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
+    {(char *) "__doc__",  (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
+    {(char *) "func_name", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
+    {(char *) "__name__", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
+    {(char *) "__qualname__", (getter)__Pyx_CyFunction_get_qualname, (setter)__Pyx_CyFunction_set_qualname, 0, 0},
+    {(char *) "func_dict", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
+    {(char *) "__dict__", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
+    {(char *) "func_globals", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
+    {(char *) "__globals__", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
+    {(char *) "func_closure", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
+    {(char *) "__closure__", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
+    {(char *) "func_code", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
+    {(char *) "__code__", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
+    {(char *) "func_defaults", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
+    {(char *) "__defaults__", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
+    {(char *) "__kwdefaults__", (getter)__Pyx_CyFunction_get_kwdefaults, (setter)__Pyx_CyFunction_set_kwdefaults, 0, 0},
+    {(char *) "__annotations__", (getter)__Pyx_CyFunction_get_annotations, (setter)__Pyx_CyFunction_set_annotations, 0, 0},
+    {(char *) "_is_coroutine", (getter)__Pyx_CyFunction_get_is_coroutine, 0, 0, 0},
+    {0, 0, 0, 0, 0}
+};
+static PyMemberDef __pyx_CyFunction_members[] = {
+    {(char *) "__module__", T_OBJECT, offsetof(PyCFunctionObject, m_module), 0, 0},
+#if CYTHON_USE_TYPE_SPECS
+    {(char *) "__dictoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_dict), READONLY, 0},
+#if CYTHON_METH_FASTCALL
+#if CYTHON_BACKPORT_VECTORCALL
+    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_vectorcall), READONLY, 0},
+#else
+    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(PyCFunctionObject, vectorcall), READONLY, 0},
+#endif
+#endif
+#if PY_VERSION_HEX < 0x030500A0
+    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_weakreflist), READONLY, 0},
+#else
+    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(PyCFunctionObject, m_weakreflist), READONLY, 0},
+#endif
+#endif
+    {0, 0, 0,  0, 0}
+};
+static PyObject *
+__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, PyObject *args)
+{
+    CYTHON_UNUSED_VAR(args);
+#if PY_MAJOR_VERSION >= 3
+    Py_INCREF(m->func_qualname);
+    return m->func_qualname;
+#else
+    return PyString_FromString(((PyCFunctionObject*)m)->m_ml->ml_name);
+#endif
+}
+static PyMethodDef __pyx_CyFunction_methods[] = {
+    {"__reduce__", (PyCFunction)__Pyx_CyFunction_reduce, METH_VARARGS, 0},
+    {0, 0, 0, 0}
+};
+#if PY_VERSION_HEX < 0x030500A0
+#define __Pyx_CyFunction_weakreflist(cyfunc) ((cyfunc)->func_weakreflist)
+#else
+#define __Pyx_CyFunction_weakreflist(cyfunc) (((PyCFunctionObject*)cyfunc)->m_weakreflist)
+#endif
+static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject *op, PyMethodDef *ml, int flags, PyObject* qualname,
+                                       PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
+    PyCFunctionObject *cf = (PyCFunctionObject*) op;
+    if (unlikely(op == NULL))
+        return NULL;
+    op->flags = flags;
+    __Pyx_CyFunction_weakreflist(op) = NULL;
+    cf->m_ml = ml;
+    cf->m_self = (PyObject *) op;
+    Py_XINCREF(closure);
+    op->func_closure = closure;
+    Py_XINCREF(module);
+    cf->m_module = module;
+    op->func_dict = NULL;
+    op->func_name = NULL;
+    Py_INCREF(qualname);
+    op->func_qualname = qualname;
+    op->func_doc = NULL;
+#if PY_VERSION_HEX < 0x030900B1
+    op->func_classobj = NULL;
+#else
+    ((PyCMethodObject*)op)->mm_class = NULL;
+#endif
+    op->func_globals = globals;
+    Py_INCREF(op->func_globals);
+    Py_XINCREF(code);
+    op->func_code = code;
+    op->defaults_pyobjects = 0;
+    op->defaults_size = 0;
+    op->defaults = NULL;
+    op->defaults_tuple = NULL;
+    op->defaults_kwdict = NULL;
+    op->defaults_getter = NULL;
+    op->func_annotations = NULL;
+    op->func_is_coroutine = NULL;
+#if CYTHON_METH_FASTCALL
+    switch (ml->ml_flags & (METH_VARARGS | METH_FASTCALL | METH_NOARGS | METH_O | METH_KEYWORDS | METH_METHOD)) {
+    case METH_NOARGS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_NOARGS;
+        break;
+    case METH_O:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_O;
+        break;
+    case METH_METHOD | METH_FASTCALL | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD;
+        break;
+    case METH_FASTCALL | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS;
+        break;
+    case METH_VARARGS | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = NULL;
+        break;
+    default:
+        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
+        Py_DECREF(op);
+        return NULL;
+    }
+#endif
+    return (PyObject *) op;
+}
+static int
+__Pyx_CyFunction_clear(__pyx_CyFunctionObject *m)
+{
+    Py_CLEAR(m->func_closure);
+    Py_CLEAR(((PyCFunctionObject*)m)->m_module);
+    Py_CLEAR(m->func_dict);
+    Py_CLEAR(m->func_name);
+    Py_CLEAR(m->func_qualname);
+    Py_CLEAR(m->func_doc);
+    Py_CLEAR(m->func_globals);
+    Py_CLEAR(m->func_code);
+#if PY_VERSION_HEX < 0x030900B1
+    Py_CLEAR(__Pyx_CyFunction_GetClassObj(m));
+#else
+    {
+        PyObject *cls = (PyObject*) ((PyCMethodObject *) (m))->mm_class;
+        ((PyCMethodObject *) (m))->mm_class = NULL;
+        Py_XDECREF(cls);
+    }
+#endif
+    Py_CLEAR(m->defaults_tuple);
+    Py_CLEAR(m->defaults_kwdict);
+    Py_CLEAR(m->func_annotations);
+    Py_CLEAR(m->func_is_coroutine);
+    if (m->defaults) {
+        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
+        int i;
+        for (i = 0; i < m->defaults_pyobjects; i++)
+            Py_XDECREF(pydefaults[i]);
+        PyObject_Free(m->defaults);
+        m->defaults = NULL;
+    }
+    return 0;
+}
+static void __Pyx__CyFunction_dealloc(__pyx_CyFunctionObject *m)
+{
+    if (__Pyx_CyFunction_weakreflist(m) != NULL)
+        PyObject_ClearWeakRefs((PyObject *) m);
+    __Pyx_CyFunction_clear(m);
+    __Pyx_PyHeapTypeObject_GC_Del(m);
+}
+static void __Pyx_CyFunction_dealloc(__pyx_CyFunctionObject *m)
+{
+    PyObject_GC_UnTrack(m);
+    __Pyx__CyFunction_dealloc(m);
+}
+static int __Pyx_CyFunction_traverse(__pyx_CyFunctionObject *m, visitproc visit, void *arg)
+{
+    Py_VISIT(m->func_closure);
+    Py_VISIT(((PyCFunctionObject*)m)->m_module);
+    Py_VISIT(m->func_dict);
+    Py_VISIT(m->func_name);
+    Py_VISIT(m->func_qualname);
+    Py_VISIT(m->func_doc);
+    Py_VISIT(m->func_globals);
+    Py_VISIT(m->func_code);
+    Py_VISIT(__Pyx_CyFunction_GetClassObj(m));
+    Py_VISIT(m->defaults_tuple);
+    Py_VISIT(m->defaults_kwdict);
+    Py_VISIT(m->func_is_coroutine);
+    if (m->defaults) {
+        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
+        int i;
+        for (i = 0; i < m->defaults_pyobjects; i++)
+            Py_VISIT(pydefaults[i]);
+    }
+    return 0;
+}
+static PyObject*
+__Pyx_CyFunction_repr(__pyx_CyFunctionObject *op)
+{
+#if PY_MAJOR_VERSION >= 3
+    return PyUnicode_FromFormat("<cyfunction %U at %p>",
+                                op->func_qualname, (void *)op);
+#else
+    return PyString_FromFormat("<cyfunction %s at %p>",
+                               PyString_AsString(op->func_qualname), (void *)op);
+#endif
+}
+static PyObject * __Pyx_CyFunction_CallMethod(PyObject *func, PyObject *self, PyObject *arg, PyObject *kw) {
+    PyCFunctionObject* f = (PyCFunctionObject*)func;
+    PyCFunction meth = f->m_ml->ml_meth;
+    Py_ssize_t size;
+    switch (f->m_ml->ml_flags & (METH_VARARGS | METH_KEYWORDS | METH_NOARGS | METH_O)) {
+    case METH_VARARGS:
+        if (likely(kw == NULL || PyDict_Size(kw) == 0))
+            return (*meth)(self, arg);
+        break;
+    case METH_VARARGS | METH_KEYWORDS:
+        return (*(PyCFunctionWithKeywords)(void*)meth)(self, arg, kw);
+    case METH_NOARGS:
+        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
+            size = PyTuple_GET_SIZE(arg);
+            if (likely(size == 0))
+                return (*meth)(self, NULL);
+            PyErr_Format(PyExc_TypeError,
+                "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
+                f->m_ml->ml_name, size);
+            return NULL;
+        }
+        break;
+    case METH_O:
+        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
+            size = PyTuple_GET_SIZE(arg);
+            if (likely(size == 1)) {
+                PyObject *result, *arg0;
+                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+                arg0 = PyTuple_GET_ITEM(arg, 0);
+                #else
+                arg0 = PySequence_ITEM(arg, 0); if (unlikely(!arg0)) return NULL;
+                #endif
+                result = (*meth)(self, arg0);
+                #if !(CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS)
+                Py_DECREF(arg0);
+                #endif
+                return result;
+            }
+            PyErr_Format(PyExc_TypeError,
+                "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
+                f->m_ml->ml_name, size);
+            return NULL;
+        }
+        break;
+    default:
+        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
+        return NULL;
+    }
+    PyErr_Format(PyExc_TypeError, "%.200s() takes no keyword arguments",
+                 f->m_ml->ml_name);
+    return NULL;
+}
+static CYTHON_INLINE PyObject *__Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    return __Pyx_CyFunction_CallMethod(func, ((PyCFunctionObject*)func)->m_self, arg, kw);
+}
+static PyObject *__Pyx_CyFunction_CallAsMethod(PyObject *func, PyObject *args, PyObject *kw) {
+    PyObject *result;
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *) func;
+#if CYTHON_METH_FASTCALL
+     __pyx_vectorcallfunc vc = __Pyx_CyFunction_func_vectorcall(cyfunc);
+    if (vc) {
+#if CYTHON_ASSUME_SAFE_MACROS
+        return __Pyx_PyVectorcall_FastCallDict(func, vc, &PyTuple_GET_ITEM(args, 0), (size_t)PyTuple_GET_SIZE(args), kw);
+#else
+        (void) &__Pyx_PyVectorcall_FastCallDict;
+        return PyVectorcall_Call(func, args, kw);
+#endif
+    }
+#endif
+    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
+        Py_ssize_t argc;
+        PyObject *new_args;
+        PyObject *self;
+        argc = PyTuple_GET_SIZE(args);
+        new_args = PyTuple_GetSlice(args, 1, argc);
+        if (unlikely(!new_args))
+            return NULL;
+        self = PyTuple_GetItem(args, 0);
+        if (unlikely(!self)) {
+            Py_DECREF(new_args);
+#if PY_MAJOR_VERSION > 2
+            PyErr_Format(PyExc_TypeError,
+                         "unbound method %.200S() needs an argument",
+                         cyfunc->func_qualname);
+#else
+            PyErr_SetString(PyExc_TypeError,
+                            "unbound method needs an argument");
+#endif
+            return NULL;
+        }
+        result = __Pyx_CyFunction_CallMethod(func, self, new_args, kw);
+        Py_DECREF(new_args);
+    } else {
+        result = __Pyx_CyFunction_Call(func, args, kw);
+    }
+    return result;
+}
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE int __Pyx_CyFunction_Vectorcall_CheckArgs(__pyx_CyFunctionObject *cyfunc, Py_ssize_t nargs, PyObject *kwnames)
+{
+    int ret = 0;
+    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
+        if (unlikely(nargs < 1)) {
+            PyErr_Format(PyExc_TypeError, "%.200s() needs an argument",
+                         ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
+            return -1;
+        }
+        ret = 1;
+    }
+    if (unlikely(kwnames) && unlikely(PyTuple_GET_SIZE(kwnames))) {
+        PyErr_Format(PyExc_TypeError,
+                     "%.200s() takes no keyword arguments", ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
+        return -1;
+    }
+    return ret;
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    if (unlikely(nargs != 0)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
+            def->ml_name, nargs);
+        return NULL;
+    }
+    return def->ml_meth(self, NULL);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    if (unlikely(nargs != 1)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
+            def->ml_name, nargs);
+        return NULL;
+    }
+    return def->ml_meth(self, args[0]);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    return ((_PyCFunctionFastWithKeywords)(void(*)(void))def->ml_meth)(self, args, nargs, kwnames);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+    PyTypeObject *cls = (PyTypeObject *) __Pyx_CyFunction_GetClassObj(cyfunc);
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    return ((__Pyx_PyCMethod)(void(*)(void))def->ml_meth)(self, cls, args, (size_t)nargs, kwnames);
+}
+#endif
+#if CYTHON_USE_TYPE_SPECS
+static PyType_Slot __pyx_CyFunctionType_slots[] = {
+    {Py_tp_dealloc, (void *)__Pyx_CyFunction_dealloc},
+    {Py_tp_repr, (void *)__Pyx_CyFunction_repr},
+    {Py_tp_call, (void *)__Pyx_CyFunction_CallAsMethod},
+    {Py_tp_traverse, (void *)__Pyx_CyFunction_traverse},
+    {Py_tp_clear, (void *)__Pyx_CyFunction_clear},
+    {Py_tp_methods, (void *)__pyx_CyFunction_methods},
+    {Py_tp_members, (void *)__pyx_CyFunction_members},
+    {Py_tp_getset, (void *)__pyx_CyFunction_getsets},
+    {Py_tp_descr_get, (void *)__Pyx_PyMethod_New},
+    {0, 0},
+};
+static PyType_Spec __pyx_CyFunctionType_spec = {
+    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
+    sizeof(__pyx_CyFunctionObject),
+    0,
+#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
+    Py_TPFLAGS_METHOD_DESCRIPTOR |
+#endif
+#if (defined(_Py_TPFLAGS_HAVE_VECTORCALL) && CYTHON_METH_FASTCALL)
+    _Py_TPFLAGS_HAVE_VECTORCALL |
+#endif
+    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
+    __pyx_CyFunctionType_slots
+};
+#else
+static PyTypeObject __pyx_CyFunctionType_type = {
+    PyVarObject_HEAD_INIT(0, 0)
+    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
+    sizeof(__pyx_CyFunctionObject),
+    0,
+    (destructor) __Pyx_CyFunction_dealloc,
+#if !CYTHON_METH_FASTCALL
+    0,
+#elif CYTHON_BACKPORT_VECTORCALL
+    (printfunc)offsetof(__pyx_CyFunctionObject, func_vectorcall),
+#else
+    offsetof(PyCFunctionObject, vectorcall),
+#endif
+    0,
+    0,
+#if PY_MAJOR_VERSION < 3
+    0,
+#else
+    0,
+#endif
+    (reprfunc) __Pyx_CyFunction_repr,
+    0,
+    0,
+    0,
+    0,
+    __Pyx_CyFunction_CallAsMethod,
+    0,
+    0,
+    0,
+    0,
+#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
+    Py_TPFLAGS_METHOD_DESCRIPTOR |
+#endif
+#ifdef _Py_TPFLAGS_HAVE_VECTORCALL
+    _Py_TPFLAGS_HAVE_VECTORCALL |
+#endif
+    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
+    0,
+    (traverseproc) __Pyx_CyFunction_traverse,
+    (inquiry) __Pyx_CyFunction_clear,
+    0,
+#if PY_VERSION_HEX < 0x030500A0
+    offsetof(__pyx_CyFunctionObject, func_weakreflist),
+#else
+    offsetof(PyCFunctionObject, m_weakreflist),
+#endif
+    0,
+    0,
+    __pyx_CyFunction_methods,
+    __pyx_CyFunction_members,
+    __pyx_CyFunction_getsets,
+    0,
+    0,
+    __Pyx_PyMethod_New,
+    0,
+    offsetof(__pyx_CyFunctionObject, func_dict),
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+#if PY_VERSION_HEX >= 0x030400a1
+    0,
+#endif
+#if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
+    0,
+#endif
+#if __PYX_NEED_TP_PRINT_SLOT
+    0,
+#endif
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
+    0,
+#endif
+};
+#endif
+static int __pyx_CyFunction_init(PyObject *module) {
+#if CYTHON_USE_TYPE_SPECS
+    __pyx_CyFunctionType = __Pyx_FetchCommonTypeFromSpec(module, &__pyx_CyFunctionType_spec, NULL);
+#else
+    CYTHON_UNUSED_VAR(module);
+    __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
+#endif
+    if (unlikely(__pyx_CyFunctionType == NULL)) {
+        return -1;
+    }
+    return 0;
+}
+static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *func, size_t size, int pyobjects) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->defaults = PyObject_Malloc(size);
+    if (unlikely(!m->defaults))
+        return PyErr_NoMemory();
+    memset(m->defaults, 0, size);
+    m->defaults_pyobjects = pyobjects;
+    m->defaults_size = size;
+    return m->defaults;
+}
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *func, PyObject *tuple) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->defaults_tuple = tuple;
+    Py_INCREF(tuple);
+}
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *func, PyObject *dict) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->defaults_kwdict = dict;
+    Py_INCREF(dict);
+}
+static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *func, PyObject *dict) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->func_annotations = dict;
+    Py_INCREF(dict);
+}
+
+/* CythonFunction */
+  static PyObject *__Pyx_CyFunction_New(PyMethodDef *ml, int flags, PyObject* qualname,
+                                      PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
+    PyObject *op = __Pyx_CyFunction_Init(
+        PyObject_GC_New(__pyx_CyFunctionObject, __pyx_CyFunctionType),
+        ml, flags, qualname, closure, module, globals, code
+    );
+    if (likely(op)) {
+        PyObject_GC_Track(op);
+    }
+    return op;
+}
+
 /* CLineInTraceback */
   #ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_UNUSED PyThreadState *tstate, int c_line) {
+static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
+    CYTHON_MAYBE_UNUSED_VAR(tstate);
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
     }
     __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
 #if CYTHON_COMPILING_IN_CPYTHON
     cython_runtime_dict = _PyObject_GetDictPtr(__pyx_cython_runtime);
     if (likely(cython_runtime_dict)) {
         __PYX_PY_DICT_LOOKUP_IF_MODIFIED(
             use_cline, *cython_runtime_dict,
             __Pyx_PyDict_GetItemStr(*cython_runtime_dict, __pyx_n_s_cline_in_traceback))
     } else
 #endif
     {
-      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
+      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStrNoError(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
       if (use_cline_obj) {
         use_cline = PyObject_Not(use_cline_obj) ? Py_False : Py_True;
         Py_DECREF(use_cline_obj);
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
@@ -6498,15 +9568,16 @@
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
 #endif
 
 /* CodeObjectCache */
-  static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
     int start = 0, mid = 0, end = count - 1;
     if (end >= 0 && code_line > entries[end].code_line) {
         return count;
     }
     while (start < end) {
         mid = start + (end - start) / 2;
         if (code_line < entries[mid].code_line) {
@@ -6576,25 +9647,36 @@
         entries[i] = entries[i-1];
     }
     entries[pos].code_line = code_line;
     entries[pos].code_object = code_object;
     __pyx_code_cache.count++;
     Py_INCREF(code_object);
 }
+#endif
 
 /* AddTraceback */
   #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 #if PY_VERSION_HEX >= 0x030b00a6
   #ifndef Py_BUILD_CORE
     #define Py_BUILD_CORE 1
   #endif
   #include "internal/pycore_frame.h"
 #endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+static void __Pyx_AddTraceback(const char *funcname, int c_line,
+                               int py_line, const char *filename) {
+    if (c_line) {
+        (void) __pyx_cfilenm;
+        (void) __Pyx_CLineForTraceback(__Pyx_PyThreadState_Current, c_line);
+    }
+    _PyTraceback_Add(funcname, filename, py_line);
+}
+#else
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
     PyCodeObject *py_code = NULL;
     PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
     PyObject *py_srcfile = NULL;
@@ -6621,14 +9703,15 @@
     #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
+        0,
         __pyx_empty_bytes, /*PyObject *code,*/
         __pyx_empty_tuple, /*PyObject *consts,*/
         __pyx_empty_tuple, /*PyObject *names,*/
         __pyx_empty_tuple, /*PyObject *varnames,*/
         __pyx_empty_tuple, /*PyObject *freevars,*/
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
@@ -6683,19 +9766,25 @@
     if (!py_frame) goto bad;
     __Pyx_PyFrame_SetLineNumber(py_frame, py_line);
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
+#endif
 
 #if PY_MAJOR_VERSION < 3
 static int __Pyx_GetBuffer(PyObject *obj, Py_buffer *view, int flags) {
+    __Pyx_TypeName obj_type_name;
     if (PyObject_CheckBuffer(obj)) return PyObject_GetBuffer(obj, view, flags);
-    PyErr_Format(PyExc_TypeError, "'%.200s' does not have the buffer interface", Py_TYPE(obj)->tp_name);
+    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
+    PyErr_Format(PyExc_TypeError,
+                 "'" __Pyx_FMT_TYPENAME "' does not have the buffer interface",
+                 obj_type_name);
+    __Pyx_DECREF_TypeName(obj_type_name);
     return -1;
 }
 static void __Pyx_ReleaseBuffer(Py_buffer *view) {
     PyObject *obj = view->obj;
     if (!obj) return;
     if (PyObject_CheckBuffer(obj)) {
         PyBuffer_Release(view);
@@ -6727,15 +9816,15 @@
                     goto raise_overflow;\
             }\
         }\
         return (target_type) value;\
     }
 
 /* Declarations */
-  #if CYTHON_CCOMPLEX
+  #if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
   #ifdef __cplusplus
     static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
       return ::std::complex< float >(x, y);
     }
   #else
     static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
       return x + y*(__pyx_t_float_complex)_Complex_I;
@@ -6747,15 +9836,15 @@
       z.real = x;
       z.imag = y;
       return z;
     }
 #endif
 
 /* Arithmetic */
-  #if CYTHON_CCOMPLEX
+  #if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
 #else
     static CYTHON_INLINE int __Pyx_c_eq_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
        return (a.real == b.real) && (a.imag == b.imag);
     }
     static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_sum_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
         __pyx_t_float_complex z;
         z.real = a.real + b.real;
@@ -6881,15 +9970,15 @@
             z.imag = z_r * sinf(z_theta);
             return z;
         }
     #endif
 #endif
 
 /* Declarations */
-  #if CYTHON_CCOMPLEX
+  #if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
   #ifdef __cplusplus
     static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
       return ::std::complex< double >(x, y);
     }
   #else
     static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
       return x + y*(__pyx_t_double_complex)_Complex_I;
@@ -6901,15 +9990,15 @@
       z.real = x;
       z.imag = y;
       return z;
     }
 #endif
 
 /* Arithmetic */
-  #if CYTHON_CCOMPLEX
+  #if CYTHON_CCOMPLEX && (1) && (!0 || __cplusplus)
 #else
     static CYTHON_INLINE int __Pyx_c_eq_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
        return (a.real == b.real) && (a.imag == b.imag);
     }
     static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_sum_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
         __pyx_t_double_complex z;
         z.real = a.real + b.real;
@@ -7047,59 +10136,64 @@
     const int neg_one = (int) -1, const_zero = (int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
 #endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(int) < sizeof(long)) {
+        if ((sizeof(int) < sizeof(long))) {
             __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
             return (int) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 2 * PyLong_SHIFT) {
-                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 2 * PyLong_SHIFT)) {
+                                return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 3 * PyLong_SHIFT) {
-                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 3 * PyLong_SHIFT)) {
+                                return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
-                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 4 * PyLong_SHIFT)) {
+                                return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
@@ -7107,117 +10201,189 @@
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
                     return (int) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(int) <= sizeof(unsigned long)) {
+            if ((sizeof(int) <= sizeof(unsigned long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
+            } else if ((sizeof(int) <= sizeof(unsigned PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(int) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(int) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
-                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(int) <= sizeof(long)) {
+            if ((sizeof(int) <= sizeof(long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
+            } else if ((sizeof(int) <= sizeof(PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
             int val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (int) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (int) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (int) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (int) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (int) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(int) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((int) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(int) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((int) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((int) 1) << (sizeof(int) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
             return (int) -1;
         }
     } else {
         int val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
         if (!tmp) return (int) -1;
         val = __Pyx_PyInt_As_int(tmp);
@@ -7319,59 +10485,64 @@
     const unsigned int neg_one = (unsigned int) -1, const_zero = (unsigned int) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
 #endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(unsigned int) < sizeof(long)) {
+        if ((sizeof(unsigned int) < sizeof(long))) {
             __PYX_VERIFY_RETURN_INT(unsigned int, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
             return (unsigned int) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (unsigned int) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(unsigned int, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(unsigned int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) >= 2 * PyLong_SHIFT) {
-                            return (unsigned int) (((((unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(unsigned int, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(unsigned int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) >= 2 * PyLong_SHIFT)) {
+                                return (unsigned int) (((((unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(unsigned int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) >= 3 * PyLong_SHIFT) {
-                            return (unsigned int) (((((((unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(unsigned int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) >= 3 * PyLong_SHIFT)) {
+                                return (unsigned int) (((((((unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(unsigned int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) >= 4 * PyLong_SHIFT) {
-                            return (unsigned int) (((((((((unsigned int)digits[3]) << PyLong_SHIFT) | (unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(unsigned int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) >= 4 * PyLong_SHIFT)) {
+                                return (unsigned int) (((((((((unsigned int)digits[3]) << PyLong_SHIFT) | (unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
@@ -7379,117 +10550,189 @@
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
                     return (unsigned int) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(unsigned int) <= sizeof(unsigned long)) {
+            if ((sizeof(unsigned int) <= sizeof(unsigned long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(unsigned int, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(unsigned int) <= sizeof(unsigned PY_LONG_LONG)) {
+            } else if ((sizeof(unsigned int) <= sizeof(unsigned PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(unsigned int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (unsigned int) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(unsigned int, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(unsigned int,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(unsigned int) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) - 1 > 2 * PyLong_SHIFT) {
-                            return (unsigned int) (((unsigned int)-1)*(((((unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(unsigned int, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(unsigned int) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (unsigned int) (((unsigned int)-1)*(((((unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(unsigned int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) - 1 > 2 * PyLong_SHIFT) {
-                            return (unsigned int) ((((((unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(unsigned int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (unsigned int) ((((((unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(unsigned int) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) - 1 > 3 * PyLong_SHIFT) {
-                            return (unsigned int) (((unsigned int)-1)*(((((((unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(unsigned int) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (unsigned int) (((unsigned int)-1)*(((((((unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(unsigned int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) - 1 > 3 * PyLong_SHIFT) {
-                            return (unsigned int) ((((((((unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(unsigned int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (unsigned int) ((((((((unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(unsigned int) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) - 1 > 4 * PyLong_SHIFT) {
-                            return (unsigned int) (((unsigned int)-1)*(((((((((unsigned int)digits[3]) << PyLong_SHIFT) | (unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(unsigned int) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (unsigned int) (((unsigned int)-1)*(((((((((unsigned int)digits[3]) << PyLong_SHIFT) | (unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(unsigned int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(unsigned int) - 1 > 4 * PyLong_SHIFT) {
-                            return (unsigned int) ((((((((((unsigned int)digits[3]) << PyLong_SHIFT) | (unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(unsigned int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(unsigned int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(unsigned int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (unsigned int) ((((((((((unsigned int)digits[3]) << PyLong_SHIFT) | (unsigned int)digits[2]) << PyLong_SHIFT) | (unsigned int)digits[1]) << PyLong_SHIFT) | (unsigned int)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(unsigned int) <= sizeof(long)) {
+            if ((sizeof(unsigned int) <= sizeof(long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(unsigned int, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(unsigned int) <= sizeof(PY_LONG_LONG)) {
+            } else if ((sizeof(unsigned int) <= sizeof(PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(unsigned int, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
             unsigned int val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (unsigned int) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (unsigned int) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (unsigned int) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (unsigned int) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (unsigned int) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(unsigned int) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((unsigned int) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(unsigned int) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((unsigned int) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((unsigned int) 1) << (sizeof(unsigned int) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
             return (unsigned int) -1;
         }
     } else {
         unsigned int val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
         if (!tmp) return (unsigned int) -1;
         val = __Pyx_PyInt_As_unsigned_int(tmp);
@@ -7540,14 +10783,29 @@
         int one = 1; int little = (int)*(unsigned char *)&one;
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(int),
                                      little, !is_unsigned);
     }
 }
 
+/* FormatTypeName */
+  #if CYTHON_COMPILING_IN_LIMITED_API
+static __Pyx_TypeName
+__Pyx_PyType_GetName(PyTypeObject* tp)
+{
+    PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
+                                               __pyx_n_s_name);
+    if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
+        PyErr_Clear();
+        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__10));
+    }
+    return name;
+}
+#endif
+
 /* CIntToPy */
   static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
@@ -7591,59 +10849,64 @@
     const long neg_one = (long) -1, const_zero = (long) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic pop
 #endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(long) < sizeof(long)) {
+        if ((sizeof(long) < sizeof(long))) {
             __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
             return (long) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (long) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(long, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 2 * PyLong_SHIFT) {
-                            return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 2 * PyLong_SHIFT)) {
+                                return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 3 * PyLong_SHIFT) {
-                            return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 3 * PyLong_SHIFT)) {
+                                return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
-                            return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 4 * PyLong_SHIFT)) {
+                                return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
 #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
@@ -7651,117 +10914,189 @@
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
                     return (long) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(long) <= sizeof(unsigned long)) {
+            if ((sizeof(long) <= sizeof(unsigned long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
+            } else if ((sizeof(long) <= sizeof(unsigned PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (long) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(long, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(long,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(long) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(long) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                            return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                                return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                            return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                                return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                            return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
+                                return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(long) <= sizeof(long)) {
+            if ((sizeof(long) <= sizeof(long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
+            } else if ((sizeof(long) <= sizeof(PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
             long val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (long) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (long) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (long) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (long) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (long) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(long) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((long) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(long) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((long) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((long) 1) << (sizeof(long) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
             return (long) -1;
         }
     } else {
         long val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
         if (!tmp) return (long) -1;
         val = __Pyx_PyInt_As_long(tmp);
@@ -7778,15 +11113,15 @@
     return (long) -1;
 }
 
 /* FastTypeChecks */
   #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
-        a = a->tp_base;
+        a = __Pyx_PyType_GetSlot(a, tp_base, PyTypeObject*);
         if (a == b)
             return 1;
     }
     return b == &PyBaseObject_Type;
 }
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b) {
     PyObject *mro;
@@ -7799,14 +11134,30 @@
             if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)
                 return 1;
         }
         return 0;
     }
     return __Pyx_InBases(a, b);
 }
+static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b) {
+    PyObject *mro;
+    if (cls == a || cls == b) return 1;
+    mro = cls->tp_mro;
+    if (likely(mro)) {
+        Py_ssize_t i, n;
+        n = PyTuple_GET_SIZE(mro);
+        for (i = 0; i < n; i++) {
+            PyObject *base = PyTuple_GET_ITEM(mro, i);
+            if (base == (PyObject *)a || base == (PyObject *)b)
+                return 1;
+        }
+        return 0;
+    }
+    return __Pyx_InBases(cls, a) || __Pyx_InBases(cls, b);
+}
 #if PY_MAJOR_VERSION == 2
 static int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject* exc_type2) {
     PyObject *exception, *value, *tb;
     int res;
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&exception, &value, &tb);
@@ -7823,19 +11174,19 @@
         }
     }
     __Pyx_ErrRestore(exception, value, tb);
     return res;
 }
 #else
 static CYTHON_INLINE int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject *exc_type2) {
-    int res = exc_type1 ? __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type1) : 0;
-    if (!res) {
-        res = __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
+    if (exc_type1) {
+        return __Pyx_IsAnySubtype2((PyTypeObject*)err, (PyTypeObject*)exc_type1, (PyTypeObject*)exc_type2);
+    } else {
+        return __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
     }
-    return res;
 }
 #endif
 static int __Pyx_PyErr_GivenExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
     Py_ssize_t i, n;
     assert(PyExceptionClass_Check(exc_type));
     n = PyTuple_GET_SIZE(tuple);
 #if PY_MAJOR_VERSION >= 3
@@ -7904,50 +11255,60 @@
                 found_dot = 1;
             } else if (rt_from_call[i] < '0' || rt_from_call[i] > '9') {
                 break;
             }
             rtversion[i] = rt_from_call[i];
         }
         PyOS_snprintf(message, sizeof(message),
-                      "compiletime version %s of module '%.100s' "
+                      "compile time version %s of module '%.100s' "
                       "does not match runtime version %s",
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* InitStrings */
-  static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
+  #if PY_MAJOR_VERSION >= 3
+static int __Pyx_InitString(__Pyx_StringTabEntry t, PyObject **str) {
+    if (t.is_unicode | t.is_str) {
+        if (t.intern) {
+            *str = PyUnicode_InternFromString(t.s);
+        } else if (t.encoding) {
+            *str = PyUnicode_Decode(t.s, t.n - 1, t.encoding, NULL);
+        } else {
+            *str = PyUnicode_FromStringAndSize(t.s, t.n - 1);
+        }
+    } else {
+        *str = PyBytes_FromStringAndSize(t.s, t.n - 1);
+    }
+    if (!*str)
+        return -1;
+    if (PyObject_Hash(*str) == -1)
+        return -1;
+    return 0;
+}
+#endif
+static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
     while (t->p) {
-        #if PY_MAJOR_VERSION < 3
+        #if PY_MAJOR_VERSION >= 3
+        __Pyx_InitString(*t, t->p);
+        #else
         if (t->is_unicode) {
             *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
         } else if (t->intern) {
             *t->p = PyString_InternFromString(t->s);
         } else {
             *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
         }
-        #else
-        if (t->is_unicode | t->is_str) {
-            if (t->intern) {
-                *t->p = PyUnicode_InternFromString(t->s);
-            } else if (t->encoding) {
-                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
-            } else {
-                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
-            }
-        } else {
-            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
-        }
-        #endif
         if (!*t->p)
             return -1;
         if (PyObject_Hash(*t->p) == -1)
             return -1;
+        #endif
         ++t;
     }
     return 0;
 }
 
 static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
     return __Pyx_PyUnicode_FromStringAndSize(c_str, (Py_ssize_t)strlen(c_str));
@@ -8001,15 +11362,15 @@
 #if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
             __Pyx_sys_getdefaultencoding_not_ascii &&
 #endif
             PyUnicode_Check(o)) {
         return __Pyx_PyUnicode_AsStringAndSize(o, length);
     } else
 #endif
-#if (!CYTHON_COMPILING_IN_PYPY) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
+#if (!CYTHON_COMPILING_IN_PYPY && !CYTHON_COMPILING_IN_LIMITED_API) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
     if (PyByteArray_Check(o)) {
         *length = PyByteArray_GET_SIZE(o);
         return PyByteArray_AS_STRING(o);
     } else
 #endif
     {
         char* result;
@@ -8030,30 +11391,34 @@
     int retval;
     if (unlikely(!x)) return -1;
     retval = __Pyx_PyObject_IsTrue(x);
     Py_DECREF(x);
     return retval;
 }
 static PyObject* __Pyx_PyNumber_IntOrLongWrongResultType(PyObject* result, const char* type_name) {
+    __Pyx_TypeName result_type_name = __Pyx_PyType_GetName(Py_TYPE(result));
 #if PY_MAJOR_VERSION >= 3
     if (PyLong_Check(result)) {
         if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,
-                "__int__ returned non-int (type %.200s).  "
-                "The ability to return an instance of a strict subclass of int "
-                "is deprecated, and may be removed in a future version of Python.",
-                Py_TYPE(result)->tp_name)) {
+                "__int__ returned non-int (type " __Pyx_FMT_TYPENAME ").  "
+                "The ability to return an instance of a strict subclass of int is deprecated, "
+                "and may be removed in a future version of Python.",
+                result_type_name)) {
+            __Pyx_DECREF_TypeName(result_type_name);
             Py_DECREF(result);
             return NULL;
         }
+        __Pyx_DECREF_TypeName(result_type_name);
         return result;
     }
 #endif
     PyErr_Format(PyExc_TypeError,
-                 "__%.4s__ returned non-%.4s (type %.200s)",
-                 type_name, type_name, Py_TYPE(result)->tp_name);
+                 "__%.4s__ returned non-%.4s (type " __Pyx_FMT_TYPENAME ")",
+                 type_name, type_name, result_type_name);
+    __Pyx_DECREF_TypeName(result_type_name);
     Py_DECREF(result);
     return NULL;
 }
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x) {
 #if CYTHON_USE_TYPE_SLOTS
   PyNumberMethods *m;
 #endif
@@ -8111,21 +11476,19 @@
         return PyInt_AS_LONG(b);
     else
         return PyInt_AsSsize_t(b);
   }
 #endif
   if (likely(PyLong_CheckExact(b))) {
     #if CYTHON_USE_PYLONG_INTERNALS
-    const digit* digits = ((PyLongObject*)b)->ob_digit;
-    const Py_ssize_t size = Py_SIZE(b);
-    if (likely(__Pyx_sst_abs(size) <= 1)) {
-        ival = likely(size) ? digits[0] : 0;
-        if (size == -1) ival = -ival;
-        return ival;
+    if (likely(__Pyx_PyLong_IsCompact(b))) {
+        return __Pyx_PyLong_CompactValue(b);
     } else {
+      const digit* digits = __Pyx_PyLong_Digits(b);
+      const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(b);
       switch (size) {
          case 2:
            if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
              return (Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
            }
            break;
          case -2:
@@ -8185,8 +11548,16 @@
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
 
 
+/* #### Code section: utility_code_pragmas_end ### */
+#ifdef _MSC_VER
+#pragma warning( pop )
+#endif
+
+
+
+/* #### Code section: end ### */
 #endif /* Py_PYTHON_H */
```

### Comparing `grizli-1.9/grizli/utils_c/disperse.pyx` & `grizli-1.9.1/grizli/utils_c/disperse.pyx`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli/utils_c/interp.pyx` & `grizli-1.9.1/grizli/utils_c/interp.pyx`

 * *Files identical despite different names*

### Comparing `grizli-1.9/grizli.egg-info/PKG-INFO` & `grizli-1.9.1/grizli.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: grizli
-Version: 1.9
+Version: 1.9.1
 Summary: Grism redshift and line analysis software
 Home-page: https://github.com/gbrammer/grizli
 Author: G. Brammer
 Author-email: gbrammer@gmail.com
 License: MIT
 Project-URL: Documentation, https://grizli.readthedocs.io/
 Project-URL: Source, https://github.com/gbrammer/grizli
```

### Comparing `grizli-1.9/grizli.egg-info/SOURCES.txt` & `grizli-1.9.1/grizli.egg-info/SOURCES.txt`

 * *Files 0% similar despite different names*

```diff
@@ -67,14 +67,15 @@
 grizli/aws/__init__.py
 grizli/aws/aws_drizzler.py
 grizli/aws/db.py
 grizli/aws/field_tiles.py
 grizli/aws/fit_redshift_lambda.py
 grizli/aws/lambda_handler.py
 grizli/aws/tile_mosaic.py
+grizli/aws/utils.py
 grizli/aws/visit_processor.py
 grizli/data/auto_script_defaults.yml
 grizli/data/db.yml
 grizli/data/gaia_dr2_vizier_columns.txt
 grizli/data/hst_encircled_energy.fits
 grizli/data/jwst_bp_info.yml
 grizli/data/nircam_wisp.yml
```

### Comparing `grizli-1.9/setup.cfg` & `grizli-1.9.1/setup.cfg`

 * *Files identical despite different names*

### Comparing `grizli-1.9/setup.py` & `grizli-1.9.1/setup.py`

 * *Files identical despite different names*

### Comparing `grizli-1.9/test_pipeline_hst.py` & `grizli-1.9.1/test_pipeline_hst.py`

 * *Files identical despite different names*

