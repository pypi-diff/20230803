# Comparing `tmp/gdsfactory-6.99.0.tar.gz` & `tmp/gdsfactory-7.0.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "gdsfactory-6.99.0.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
+gzip compressed data, was "gdsfactory-7.0.0.tar", last modified: Fri Jan  1 00:00:00 2016, max compression
```

## Comparing `gdsfactory-6.99.0.tar` & `gdsfactory-7.0.0.tar`

### file list

```diff
@@ -1,701 +1,525 @@
--rw-r--r--   0        0        0     1072 2023-05-29 17:46:56.493329 gdsfactory-6.99.0/LICENSE
--rw-r--r--   0        0        0    14381 2023-05-29 17:46:56.493329 gdsfactory-6.99.0/README.md
--rw-r--r--   0        0        0     3583 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/__init__.py
--rw-r--r--   0        0        0     2104 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_keepout.py
--rw-r--r--   0        0        0    12629 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_labels.py
--rw-r--r--   0        0        0     3711 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_loopback.py
--rw-r--r--   0        0        0     5054 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_padding.py
--rw-r--r--   0        0        0    15639 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_pins.py
--rw-r--r--   0        0        0    14700 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_ports.py
--rw-r--r--   0        0        0     2884 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_tapers.py
--rw-r--r--   0        0        0     2257 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_tapers_cross_section.py
--rw-r--r--   0        0        0     1831 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/add_termination.py
--rw-r--r--   0        0        0     1856 2023-05-29 17:46:56.501329 gdsfactory-6.99.0/gdsfactory/asserts.py
--rw-r--r--   0        0        0    14287 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/cell.py
--rw-r--r--   0        0        0    16040 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/circuitviz.py
--rw-r--r--   0        0        0     5718 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/cli.py
--rw-r--r--   0        0        0   100723 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/component.py
--rw-r--r--   0        0        0    23424 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/component_layout.py
--rw-r--r--   0        0        0    29879 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/component_reference.py
--rw-r--r--   0        0        0     1205 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/C.py
--rw-r--r--   0        0        0     1144 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/L.py
--rw-r--r--   0        0        0    20964 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/__init__.py
--rw-r--r--   0        0        0     2621 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/add_fiducials.py
--rw-r--r--   0        0        0    14087 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/add_grating_couplers.py
--rw-r--r--   0        0        0     2014 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/add_trenches.py
--rw-r--r--   0        0        0     3207 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/align.py
--rw-r--r--   0        0        0     2622 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/array_component.py
--rw-r--r--   0        0        0     4705 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/array_with_fanout.py
--rw-r--r--   0        0        0     4322 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/array_with_via.py
--rw-r--r--   0        0        0     4042 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/awg.py
--rw-r--r--   0        0        0     1269 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/bbox.py
--rw-r--r--   0        0        0     2851 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/bend_circular.py
--rw-r--r--   0        0        0     2649 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/bend_circular_heater.py
--rw-r--r--   0        0        0     7903 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/bend_euler.py
--rw-r--r--   0        0        0     2682 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/bend_port.py
--rw-r--r--   0        0        0     3787 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/bend_s.py
--rw-r--r--   0        0        0     5373 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/bezier.py
--rw-r--r--   0        0        0     1605 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cavity.py
--rw-r--r--   0        0        0     5766 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cdc.py
--rw-r--r--   0        0        0     2929 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cdsem_all.py
--rw-r--r--   0        0        0     1788 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cdsem_bend180.py
--rw-r--r--   0        0        0     1631 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cdsem_coupler.py
--rw-r--r--   0        0        0     1412 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cdsem_straight.py
--rw-r--r--   0        0        0     1565 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cdsem_straight_density.py
--rw-r--r--   0        0        0      793 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/circle.py
--rw-r--r--   0        0        0     5722 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coh_rx_dual_pol.py
--rw-r--r--   0        0        0     8922 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coh_rx_single_pol.py
--rw-r--r--   0        0        0     5043 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coh_tx_dual_pol.py
--rw-r--r--   0        0        0     6118 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coh_tx_single_pol.py
--rw-r--r--   0        0        0     2548 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/compass.py
--rw-r--r--   0        0        0     9876 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/component_lattice.py
--rw-r--r--   0        0        0     7174 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/component_sequence.py
--rw-r--r--   0        0        0      812 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/copy_layers.py
--rw-r--r--   0        0        0     3460 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler.py
--rw-r--r--   0        0        0     2113 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler90.py
--rw-r--r--   0        0        0     1802 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler90bend.py
--rw-r--r--   0        0        0     4666 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler_adiabatic.py
--rw-r--r--   0        0        0     1909 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler_asymmetric.py
--rw-r--r--   0        0        0     3970 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler_full.py
--rw-r--r--   0        0        0     3414 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler_ring.py
--rw-r--r--   0        0        0     1060 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler_straight.py
--rw-r--r--   0        0        0     1164 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler_straight_asymmetric.py
--rw-r--r--   0        0        0     2192 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/coupler_symmetric.py
--rw-r--r--   0        0        0     1848 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cross.py
--rw-r--r--   0        0        0    12873 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/crossing_waveguide.py
--rw-r--r--   0        0        0      500 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
--rw-r--r--   0        0        0     1014 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
--rw-r--r--   0        0        0    19749 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
--rw-r--r--   0        0        0    19751 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
--rw-r--r--   0        0        0    19749 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
--rw-r--r--   0        0        0    19751 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
--rw-r--r--   0        0        0    19775 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
--rw-r--r--   0        0        0     3143 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
--rw-r--r--   0        0        0     5272 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cutback_2x2.py
--rw-r--r--   0        0        0     6450 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cutback_bend.py
--rw-r--r--   0        0        0     3765 2023-05-29 17:46:56.505329 gdsfactory-6.99.0/gdsfactory/components/cutback_component.py
--rw-r--r--   0        0        0     2721 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/cutback_splitter.py
--rw-r--r--   0        0        0     2971 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/dbr.py
--rw-r--r--   0        0        0     4288 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/dbr_tapered.py
--rw-r--r--   0        0        0     2486 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/delay_snake.py
--rw-r--r--   0        0        0     3177 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/delay_snake2.py
--rw-r--r--   0        0        0     3245 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/delay_snake3.py
--rw-r--r--   0        0        0     4319 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/delay_snake_sbend.py
--rw-r--r--   0        0        0     1226 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/dicing_lane.py
--rw-r--r--   0        0        0     3471 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/die.py
--rw-r--r--   0        0        0     2975 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/die_bbox.py
--rw-r--r--   0        0        0     2863 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/die_bbox_frame.py
--rw-r--r--   0        0        0     8015 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/disk.py
--rw-r--r--   0        0        0     4112 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/edge_coupler_array.py
--rw-r--r--   0        0        0     1214 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ellipse.py
--rw-r--r--   0        0        0     1800 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/extend_ports_list.py
--rw-r--r--   0        0        0     7988 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/extension.py
--rw-r--r--   0        0        0      981 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/fiber.py
--rw-r--r--   0        0        0     1432 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/fiber_array.py
--rw-r--r--   0        0        0      722 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/fiducial_squares.py
--rw-r--r--   0        0        0     3290 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ge_detector_straight_si_contacts.py
--rw-r--r--   0        0        0     1063 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_array.py
--rw-r--r--   0        0        0     4682 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_dual_pol.py
--rw-r--r--   0        0        0     7110 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical.py
--rw-r--r--   0        0        0     7222 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
--rw-r--r--   0        0        0     4961 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py
--rw-r--r--   0        0        0     4592 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical_trenches.py
--rw-r--r--   0        0        0     1773 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_functions.py
--rw-r--r--   0        0        0     9058 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_loss.py
--rw-r--r--   0        0        0     1786 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_loss_fiber_single.py
--rw-r--r--   0        0        0     4142 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_rectangular.py
--rw-r--r--   0        0        0     4685 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
--rw-r--r--   0        0        0     3887 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
--rw-r--r--   0        0        0     1579 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/grating_coupler_tree.py
--rw-r--r--   0        0        0     8811 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/greek_cross.py
--rw-r--r--   0        0        0     1019 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/hline.py
--rw-r--r--   0        0        0     3687 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/interdigital_capacitor.py
--rw-r--r--   0        0        0     1825 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/litho_calipers.py
--rw-r--r--   0        0        0     1244 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/litho_ruler.py
--rw-r--r--   0        0        0     1304 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/litho_steps.py
--rw-r--r--   0        0        0      650 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/logo.py
--rw-r--r--   0        0        0     1679 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/loop_mirror.py
--rw-r--r--   0        0        0     3873 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mmi1x2.py
--rw-r--r--   0        0        0     2769 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mmi1x2_with_sbend.py
--rw-r--r--   0        0        0     3858 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mmi2x2.py
--rw-r--r--   0        0        0     3168 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mmi2x2_with_sbend.py
--rw-r--r--   0        0        0     4947 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mmi_90degree_hybrid.py
--rw-r--r--   0        0        0     3265 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mode_converter.py
--rw-r--r--   0        0        0     7661 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzi.py
--rw-r--r--   0        0        0     2499 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzi_arm.py
--rw-r--r--   0        0        0     5835 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzi_arms.py
--rw-r--r--   0        0        0    12214 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzi_lattice.py
--rw-r--r--   0        0        0     4025 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzi_pads_center.py
--rw-r--r--   0        0        0     1064 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzi_phase_shifter.py
--rw-r--r--   0        0        0     6342 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzit.py
--rw-r--r--   0        0        0     3502 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzit_lattice.py
--rw-r--r--   0        0        0     6047 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/mzm.py
--rw-r--r--   0        0        0     3518 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/nxn.py
--rw-r--r--   0        0        0     1940 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/optimal_90deg.py
--rw-r--r--   0        0        0     3876 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/optimal_hairpin.py
--rw-r--r--   0        0        0     6131 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/optimal_step.py
--rw-r--r--   0        0        0     6327 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/pack_doe.py
--rw-r--r--   0        0        0     3860 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/pad.py
--rw-r--r--   0        0        0     1890 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/pad_gsg.py
--rw-r--r--   0        0        0     1157 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/pads_shorted.py
--rw-r--r--   0        0        0     3833 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/polarization_splitter_rotator.py
--rw-r--r--   0        0        0     1147 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ramp.py
--rw-r--r--   0        0        0     1508 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/rectangle.py
--rw-r--r--   0        0        0     2972 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/rectangle_with_slits.py
--rw-r--r--   0        0        0     1508 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/regular_polygon.py
--rw-r--r--   0        0        0     3302 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/resistance_meander.py
--rw-r--r--   0        0        0     2642 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/resistance_sheet.py
--rw-r--r--   0        0        0     1273 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring.py
--rw-r--r--   0        0        0     4143 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_crow.py
--rw-r--r--   0        0        0     3272 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_crow_couplers.py
--rw-r--r--   0        0        0     2267 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_double.py
--rw-r--r--   0        0        0     2846 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_double_bend_coupler.py
--rw-r--r--   0        0        0     3846 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_double_heater.py
--rw-r--r--   0        0        0     7757 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_double_pn.py
--rw-r--r--   0        0        0    12137 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_section_based.py
--rw-r--r--   0        0        0     2740 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_single.py
--rw-r--r--   0        0        0     1968 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_single_array.py
--rw-r--r--   0        0        0     6868 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_single_bend_coupler.py
--rw-r--r--   0        0        0     2714 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_single_dut.py
--rw-r--r--   0        0        0     4018 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_single_heater.py
--rw-r--r--   0        0        0     5317 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/ring_single_pn.py
--rw-r--r--   0        0        0     2282 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/seal_ring.py
--rw-r--r--   0        0        0     3758 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/snspd.py
--rw-r--r--   0        0        0     2059 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/spiral_double.py
--rw-r--r--   0        0        0     5871 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/spiral_external_io.py
--rw-r--r--   0        0        0    16692 2023-05-29 17:46:56.509329 gdsfactory-6.99.0/gdsfactory/components/spiral_heater.py
--rw-r--r--   0        0        0     9181 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/spiral_inner_io.py
--rw-r--r--   0        0        0     1733 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/splitter_chain.py
--rw-r--r--   0        0        0     5327 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/splitter_tree.py
--rw-r--r--   0        0        0     2507 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight.py
--rw-r--r--   0        0        0     1033 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_array.py
--rw-r--r--   0        0        0     7914 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_heater_doped_rib.py
--rw-r--r--   0        0        0     1922 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_heater_doped_strip.py
--rw-r--r--   0        0        0     7891 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_heater_meander.py
--rw-r--r--   0        0        0     8090 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_heater_meander_doped.py
--rw-r--r--   0        0        0     5686 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_heater_metal.py
--rw-r--r--   0        0        0     2809 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_pin.py
--rw-r--r--   0        0        0     3974 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_pin_slot.py
--rw-r--r--   0        0        0      655 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/straight_rib.py
--rw-r--r--   0        0        0      820 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/switch_tree.py
--rw-r--r--   0        0        0     7730 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/taper.py
--rw-r--r--   0        0        0     3530 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/taper_adiabatic.py
--rw-r--r--   0        0        0     2576 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/taper_cross_section.py
--rw-r--r--   0        0        0     2363 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/taper_from_csv.py
--rw-r--r--   0        0        0     1235 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/taper_parabolic.py
--rw-r--r--   0        0        0     1635 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/terminator.py
--rw-r--r--   0        0        0     2913 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/text.py
--rw-r--r--   0        0        0     3886 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/text_freetype.py
--rw-r--r--   0        0        0     3160 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/text_rectangular.py
--rw-r--r--   0        0        0     3943 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/text_rectangular_font.py
--rw-r--r--   0        0        0     2536 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/triangles.py
--rw-r--r--   0        0        0      715 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/verniers.py
--rw-r--r--   0        0        0     2468 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/version_stamp.py
--rw-r--r--   0        0        0     2436 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/via.py
--rw-r--r--   0        0        0     3060 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/via_corner.py
--rw-r--r--   0        0        0     5342 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/via_cutback.py
--rw-r--r--   0        0        0    15612 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/via_stack.py
--rw-r--r--   0        0        0     4430 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/via_stack_slot.py
--rw-r--r--   0        0        0     4944 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/via_stack_with_offset.py
--rw-r--r--   0        0        0     1088 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/wafer.py
--rw-r--r--   0        0        0     2542 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/wire.py
--rw-r--r--   0        0        0      978 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/components/wire_sbend.py
--rw-r--r--   0        0        0     8159 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/config.py
--rw-r--r--   0        0        0      481 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/conftest.py
--rw-r--r--   0        0        0    38409 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/constants.py
--rw-r--r--   0        0        0     1476 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/containers.py
--rw-r--r--   0        0        0    83118 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/cross_section.py
--rw-r--r--   0        0        0     2982 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/decorators.py
--rw-r--r--   0        0        0     7008 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/difftest.py
--rw-r--r--   0        0        0     1020 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/events.py
--rw-r--r--   0        0        0      267 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/export/__init__.py
--rw-r--r--   0        0        0     3353 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/export/to_3d.py
--rw-r--r--   0        0        0     7599 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/export/to_gerber.py
--rw-r--r--   0        0        0     1940 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/export/to_np.py
--rw-r--r--   0        0        0     3058 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/export/to_stl.py
--rw-r--r--   0        0        0     2976 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/filestorage.py
--rw-r--r--   0        0        0    11908 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/fill.py
--rw-r--r--   0        0        0     7799 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/font.py
--rw-r--r--   0        0        0     8073 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/functions.py
--rw-r--r--   0        0        0       20 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/.gitattributes
--rw-r--r--   0        0        0       83 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/.gitconfig
--rw-r--r--   0        0        0       72 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/__init__.py
--rw-r--r--   0        0        0     1069 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/gds_diff_git.py
--rw-r--r--   0        0        0     2935 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/gdsdiff.py
--rw-r--r--   0        0        0      708 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/install.py
--rw-r--r--   0        0        0      271 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/sample.py
--rw-r--r--   0        0        0     1111 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/gdsdiff/test_xor.py
--rw-r--r--   0        0        0     1100 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/README.md
--rw-r--r--   0        0        0     1722 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/__init__.py
--rw-r--r--   0        0        0      169 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/generic_tech.sh
--rw-r--r--   0        0        0     8142 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/get_klayout_pyxs.py
--rw-r--r--   0        0        0      161 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/README.md
--rw-r--r--   0        0        0      104 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/drc/Makefile
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/drc/__init__.py
--rw-r--r--   0        0        0     2842 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/drc/errors.py
--rw-r--r--   0        0        0     6193 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/grain.xml
--rw-r--r--   0        0        0    10140 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/icon_128x128.png
--rw-r--r--   0        0        0     4248 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/icon_64x64.png
--rw-r--r--   0        0        0       27 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/.gitignore
--rw-r--r--   0        0        0      494 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/Makefile
--rw-r--r--   0        0        0     4062 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/README.md
--rw-r--r--   0        0        0     2419 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
--rw-r--r--   0        0        0     9696 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
--rw-r--r--   0        0        0    12379 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
--rw-r--r--   0        0        0     7235 2023-05-29 17:46:56.513329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
--rw-r--r--   0        0        0     3446 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
--rw-r--r--   0        0        0      479 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
--rw-r--r--   0        0        0      582 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
--rw-r--r--   0        0        0      108 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
--rw-r--r--   0        0        0      186 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
--rw-r--r--   0        0        0      398 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
--rw-r--r--   0        0        0      574 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
--rw-r--r--   0        0        0     6034 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
--rw-r--r--   0        0        0    10704 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
--rw-r--r--   0        0        0      477 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
--rw-r--r--   0        0        0     4337 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
--rw-r--r--   0        0        0      926 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
--rw-r--r--   0        0        0    10945 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
--rw-r--r--   0        0        0      710 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
--rw-r--r--   0        0        0      538 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/python/__init__.py
--rw-r--r--   0        0        0      114 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
--rw-r--r--   0        0        0     4311 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
--rw-r--r--   0        0        0      269 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/Makefile
--rw-r--r--   0        0        0     1854 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
--rw-r--r--   0        0        0     1519 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack
--rw-r--r--   0        0        0    41073 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
--rw-r--r--   0        0        0    40616 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/layers.lyp
--rw-r--r--   0        0        0     5977 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/tech.lyt
--rw-r--r--   0        0        0     4258 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
--rw-r--r--   0        0        0     4537 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
--rw-r--r--   0        0        0     4690 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
--rw-r--r--   0        0        0     5508 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
--rw-r--r--   0        0        0     1883 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/layer_map.py
--rw-r--r--   0        0        0     6511 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/layer_stack.py
--rw-r--r--   0        0        0    10780 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/layer_views.yaml
--rw-r--r--   0        0        0      158 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/generic_tech/simulation_settings.py
--rw-r--r--   0        0        0     1431 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/__init__.py
--rw-r--r--   0        0        0     4917 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/boolean.py
--rw-r--r--   0        0        0     3814 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/boolean_klayout.py
--rw-r--r--   0        0        0     1904 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/boolean_polygons.py
--rw-r--r--   0        0        0      598 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/check_duplicated_cells.py
--rw-r--r--   0        0        0     2719 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/check_exclusion.py
--rw-r--r--   0        0        0     2829 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/check_inclusion.py
--rw-r--r--   0        0        0     3566 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/check_space.py
--rw-r--r--   0        0        0     1904 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/check_width.py
--rw-r--r--   0        0        0     5010 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/fill_klayout.py
--rw-r--r--   0        0        0     7034 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/fill_tiled.py
--rw-r--r--   0        0        0     1697 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/fillet.py
--rw-r--r--   0        0        0     6664 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/functions.py
--rw-r--r--   0        0        0     2167 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/invert.py
--rw-r--r--   0        0        0     3685 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/layer_priority.py
--rw-r--r--   0        0        0     3054 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/manhattanize.py
--rw-r--r--   0        0        0     4192 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/maskprep.py
--rw-r--r--   0        0        0     4814 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/maskprep_flat.py
--rw-r--r--   0        0        0     3250 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/offset.py
--rw-r--r--   0        0        0     3842 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/outline.py
--rw-r--r--   0        0        0     2510 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/trim.py
--rw-r--r--   0        0        0     2948 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/union.py
--rw-r--r--   0        0        0     3609 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/write_connectivity.py
--rw-r--r--   0        0        0    10532 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/write_drc.py
--rw-r--r--   0        0        0     1783 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/geometry/xor_diff.py
--rw-r--r--   0        0        0     1158 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/get_factories.py
--rw-r--r--   0        0        0    23569 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/get_netlist.py
--rw-r--r--   0        0        0    14446 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/get_netlist_flat.py
--rw-r--r--   0        0        0      682 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/get_netlist_klayout.py
--rw-r--r--   0        0        0     9745 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/grid.py
--rw-r--r--   0        0        0     4393 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/install.py
--rw-r--r--   0        0        0     1970 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/klive.py
--rw-r--r--   0        0        0      585 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/labels/__init__.py
--rw-r--r--   0        0        0     3563 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/labels/add_label_yaml.py
--rw-r--r--   0        0        0     3847 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/labels/ehva.py
--rw-r--r--   0        0        0     3810 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/labels/merge_test_metadata.py
--rw-r--r--   0        0        0     4668 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/labels/siepic.py
--rw-r--r--   0        0        0     4847 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/labels/write_labels.py
--rw-r--r--   0        0        0     1149 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/materials.py
--rw-r--r--   0        0        0     5247 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/name.py
--rw-r--r--   0        0        0    11586 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/pack.py
--rw-r--r--   0        0        0    51631 2023-05-29 17:46:56.517329 gdsfactory-6.99.0/gdsfactory/path.py
--rw-r--r--   0        0        0    27294 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/pdk.py
--rw-r--r--   0        0        0     6220 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/picmodel.py
--rw-r--r--   0        0        0     5068 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/pixelate.py
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/dagster/__init__.py
--rw-r--r--   0        0        0      976 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/dagster/workflow.py
--rw-r--r--   0        0        0      566 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/database/README.md
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/database/__init__.py
--rw-r--r--   0        0        0     6216 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/database/db_upload.py
--rw-r--r--   0        0        0    16143 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/database/models.py
--rw-r--r--   0        0        0       32 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/Makefile
--rw-r--r--   0        0        0       23 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/__init__.py
--rw-r--r--   0        0        0     4080 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/main.py
--rwxr-xr-x   0        0        0     7511 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/server.py
--rwxr-xr-x   0        0        0      594 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/server_jupyter.py
--rw-r--r--   0        0        0     1299 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/static/client.css
--rw-r--r--   0        0        0     9637 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/static/client.js
--rw-r--r--   0        0        0      840 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/templates/client.html
--rw-r--r--   0        0        0      236 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/templates/footer.html
--rw-r--r--   0        0        0      229 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/templates/gdspaths.html
--rw-r--r--   0        0        0      572 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/templates/header.html
--rw-r--r--   0        0        0      253 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/templates/index.html
--rw-r--r--   0        0        0      964 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/templates/navbar.html
--rw-r--r--   0        0        0     1837 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/plugins/web/templates/viewer.html
--rw-r--r--   0        0        0    32235 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/port.py
--rw-r--r--   0        0        0    37817 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/quickplotter.py
--rw-r--r--   0        0        0      696 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/__init__.py
--rw-r--r--   0        0        0     1639 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/from_dphox.py
--rw-r--r--   0        0        0     1285 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/from_gdspaths.py
--rw-r--r--   0        0        0     1953 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/from_np.py
--rw-r--r--   0        0        0     2813 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/from_phidl.py
--rw-r--r--   0        0        0    38082 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/from_yaml.py
--rw-r--r--   0        0        0     5897 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/from_yaml_template.py
--rw-r--r--   0        0        0     5688 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/import_gds.py
--rw-r--r--   0        0        0     3407 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/read/labels.py
--rw-r--r--   0        0        0     3769 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/__init__.py
--rw-r--r--   0        0        0     2920 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/add_electrical_pads_shortest.py
--rw-r--r--   0        0        0     3015 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/add_electrical_pads_top.py
--rw-r--r--   0        0        0     3035 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/add_electrical_pads_top_dc.py
--rw-r--r--   0        0        0     8715 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/add_fiber_array.py
--rw-r--r--   0        0        0    10624 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/add_fiber_single.py
--rw-r--r--   0        0        0     8967 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/add_pads.py
--rw-r--r--   0        0        0    38948 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/all_angle.py
--rw-r--r--   0        0        0     3916 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/auto_taper.py
--rw-r--r--   0        0        0      982 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/factories.py
--rw-r--r--   0        0        0     4415 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/fanout.py
--rw-r--r--   0        0        0     2800 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/fanout2x2.py
--rw-r--r--   0        0        0    24342 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_bundle.py
--rw-r--r--   0        0        0     8652 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_bundle_corner.py
--rw-r--r--   0        0        0     6910 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_bundle_from_steps.py
--rw-r--r--   0        0        0    12949 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_bundle_from_waypoints.py
--rw-r--r--   0        0        0     5284 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_bundle_path_length_match.py
--rw-r--r--   0        0        0     1937 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_bundle_sbend.py
--rw-r--r--   0        0        0    17064 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_bundle_u.py
--rw-r--r--   0        0        0     1510 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_input_labels.py
--rw-r--r--   0        0        0     9283 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_route.py
--rw-r--r--   0        0        0    10872 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_route_astar.py
--rw-r--r--   0        0        0     6119 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_route_from_steps.py
--rw-r--r--   0        0        0     2766 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_route_sbend.py
--rw-r--r--   0        0        0     3311 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_routes_bend180.py
--rw-r--r--   0        0        0     1854 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/get_routes_straight.py
--rw-r--r--   0        0        0    34199 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/manhattan.py
--rw-r--r--   0        0        0    10081 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/path_length_matching.py
--rw-r--r--   0        0        0    22568 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/route_fiber_array.py
--rw-r--r--   0        0        0     8679 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/route_fiber_single.py
--rw-r--r--   0        0        0    18132 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/route_ports_to_side.py
--rw-r--r--   0        0        0     4379 2023-05-29 17:46:56.521329 gdsfactory-6.99.0/gdsfactory/routing/route_quad.py
--rw-r--r--   0        0        0    14370 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/routing/route_sharp.py
--rw-r--r--   0        0        0    10167 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/routing/route_south.py
--rw-r--r--   0        0        0     5072 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/routing/sort_ports.py
--rw-r--r--   0        0        0     2477 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/routing/utils.py
--rw-r--r--   0        0        0     2897 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell.py
--rw-r--r--   0        0        0      646 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
--rw-r--r--   0        0        0     1109 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell_with_pins.py
--rw-r--r--   0        0        0      664 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
--rw-r--r--   0        0        0      347 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/02_component_autoname.py
--rw-r--r--   0        0        0      887 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/03_move.py
--rw-r--r--   0        0        0      881 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/04_connect.py
--rw-r--r--   0        0        0      710 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/05_remove_layers.py
--rw-r--r--   0        0        0      931 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/06_remapping_layers.py
--rw-r--r--   0        0        0     1082 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/07_flattening_device.py
--rw-r--r--   0        0        0      475 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/08_group.py
--rw-r--r--   0        0        0     1631 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/11_component_layout.py
--rw-r--r--   0        0        0     2245 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/12_component_refs.py
--rw-r--r--   0        0        0      955 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/13_component_netlist.py
--rw-r--r--   0        0        0     2592 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/14_component_connectivity.py
--rw-r--r--   0        0        0     1636 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/15_component_sequence1.py
--rw-r--r--   0        0        0     1680 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/16_component_sequence2.py
--rw-r--r--   0        0        0      965 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/17_ports.py
--rw-r--r--   0        0        0      489 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/18_port_markers.py
--rw-r--r--   0        0        0      361 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/19_references.py
--rw-r--r--   0        0        0      533 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/20_components.py
--rw-r--r--   0        0        0      459 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/21_add_fiber_array.py
--rw-r--r--   0        0        0      445 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/22_add_fiber_single.py
--rw-r--r--   0        0        0      569 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/22_add_pads.py
--rw-r--r--   0        0        0      848 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/23_reticle.py
--rw-r--r--   0        0        0     1588 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/23_reticle_passives.py
--rw-r--r--   0        0        0      457 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/24_doe.py
--rw-r--r--   0        0        0      687 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/24_doe_2.py
--rw-r--r--   0        0        0      692 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/24_doe_3.py
--rw-r--r--   0        0        0      306 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/25_slot_cross_section.py
--rw-r--r--   0        0        0     1363 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/30_lidar.py
--rw-r--r--   0        0        0     1412 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/30_lidar_pcell.py
--rw-r--r--   0        0        0     1943 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/30_lidar_with_pads.py
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/__init__.py
--rw-r--r--   0        0        0     1307 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing.py
--rw-r--r--   0        0        0      558 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
--rw-r--r--   0        0        0     6062 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
--rw-r--r--   0        0        0      444 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
--rw-r--r--   0        0        0      463 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
--rw-r--r--   0        0        0     1552 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
--rw-r--r--   0        0        0     1315 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
--rw-r--r--   0        0        0      602 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
--rw-r--r--   0        0        0     3317 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
--rw-r--r--   0        0        0     1484 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
--rw-r--r--   0        0        0     3045 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
--rw-r--r--   0        0        0     3782 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
--rw-r--r--   0        0        0     1988 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/big_device.py
--rw-r--r--   0        0        0       19 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/Makefile
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/__init__.py
--rw-r--r--   0        0        0     1129 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/benchmark/fill_demo.py
--rw-r--r--   0        0        0      343 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
--rw-r--r--   0        0        0      637 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/mask.pic.yml
--rw-r--r--   0        0        0      622 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
--rw-r--r--   0        0        0      569 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
--rw-r--r--   0        0        0      453 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/pads.pic.yml
--rw-r--r--   0        0        0      287 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/rectangles.pic.yml
--rw-r--r--   0        0        0     2260 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/drc_errors.py
--rw-r--r--   0        0        0     1014 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/drc_write.py
--rw-r--r--   0        0        0     4530 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/layers.py
--rw-r--r--   0        0        0      158 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/layers_sky130.py
--rw-r--r--   0        0        0      364 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/layers_xsection.py
--rw-r--r--   0        0        0     1065 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/lvs.py
--rw-r--r--   0        0        0      574 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/demo/pcell.py
--rw-r--r--   0        0        0     4174 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/netlists/mzi.yml
--rw-r--r--   0        0        0     5840 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/netlists/mzi_full.yml
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/__init__.py
--rw-r--r--   0        0        0     4235 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/fab_c.py
--rw-r--r--   0        0        0      475 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/fab_d/__init__.py
--rw-r--r--   0        0        0     1880 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py
--rw-r--r--   0        0        0     1715 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c.py
--rw-r--r--   0        0        0       50 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
--rw-r--r--   0        0        0       93 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
--rw-r--r--   0        0        0       85 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
--rw-r--r--   0        0        0      139 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
--rw-r--r--   0        0        0       90 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
--rw-r--r--   0        0        0      126 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
--rw-r--r--   0        0        0       48 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
--rw-r--r--   0        0        0     1023 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
--rw-r--r--   0        0        0     2206 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
--rw-r--r--   0        0        0     1879 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
--rw-r--r--   0        0        0     1283 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
--rw-r--r--   0        0        0     1632 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
--rw-r--r--   0        0        0     1061 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
--rw-r--r--   0        0        0     1054 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
--rw-r--r--   0        0        0     1617 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
--rw-r--r--   0        0        0     4497 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
--rw-r--r--   0        0        0     3625 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
--rw-r--r--   0        0        0     3603 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
--rw-r--r--   0        0        0     4455 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
--rw-r--r--   0        0        0      840 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
--rw-r--r--   0        0        0     2297 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
--rw-r--r--   0        0        0      316 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/schematic.py
--rw-r--r--   0        0        0    17862 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/schematic_editor.py
--rw-r--r--   0        0        0     4462 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/serialization.py
--rw-r--r--   0        0        0     1612 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/show.py
--rw-r--r--   0        0        0      724 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/__init__.py
--rw-r--r--   0        0        0     4369 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/add_simulation_markers.py
--rw-r--r--   0        0        0     2476 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/convert_sparameters.py
--rw-r--r--   0        0        0      597 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/devsim/__init__.py
--rw-r--r--   0        0        0     2559 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/devsim/doping.py
--rw-r--r--   0        0        0    11977 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/devsim/get_simulation.py
--rw-r--r--   0        0        0    28856 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/devsim/get_simulation_xsection.py
--rw-r--r--   0        0        0    19756 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/devsim/get_solver.py
--rw-r--r--   0        0        0     1610 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/devsim/test_devsim.py
--rw-r--r--   0        0        0      189 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/disable_print.py
--rw-r--r--   0        0        0       79 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/eme/__init__.py
--rw-r--r--   0        0        0    14784 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/eme/meow_eme.py
--rw-r--r--   0        0        0     1787 2023-05-29 17:46:56.525329 gdsfactory-6.99.0/gdsfactory/simulation/eme/test_meow_simulation.py
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/fem/__init__.py
--rw-r--r--   0        0        0     8968 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/fem/mode_solver.py
--rw-r--r--   0        0        0     2221 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/fem/test_mode_solver.py
--rw-r--r--   0        0        0     3455 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/get_effective_indices.py
--rw-r--r--   0        0        0     3109 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/get_modes_path.py
--rw-r--r--   0        0        0     3888 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/get_sparameters_path.py
--rw-r--r--   0        0        0     2003 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/__init__.py
--rw-r--r--   0        0        0     3194 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/get_material.py
--rw-r--r--   0        0        0     6137 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/get_meep_geometry.py
--rw-r--r--   0        0        0     6054 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/get_port_eigenmode.py
--rw-r--r--   0        0        0    11014 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/get_simulation.py
--rw-r--r--   0        0        0    15915 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py
--rw-r--r--   0        0        0    18182 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py
--rw-r--r--   0        0        0    12312 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py
--rw-r--r--   0        0        0    11914 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_eigenmode.py
--rw-r--r--   0        0        0      832 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_materials.py
--rw-r--r--   0        0        0    10128 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0     6642 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py
--rw-r--r--   0        0        0    10128 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0    10093 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv
--rw-r--r--   0        0        0    10085 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv
--rw-r--r--   0        0        0    34701 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv
--rw-r--r--   0        0        0    10123 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv
--rw-r--r--   0        0        0     9966 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv
--rw-r--r--   0        0        0     9966 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv
--rw-r--r--   0        0        0    10129 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv
--rw-r--r--   0        0        0    14053 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/write_sparameters_grating.py
--rw-r--r--   0        0        0    21281 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/write_sparameters_meep.py
--rw-r--r--   0        0        0     8143 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py
--rw-r--r--   0        0        0     9577 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py
--rw-r--r--   0        0        0     1246 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/__init__.py
--rw-r--r--   0        0        0     6653 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/break_geometry.py
--rw-r--r--   0        0        0    11250 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/mesh.py
--rw-r--r--   0        0        0    11824 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/meshtracker.py
--rw-r--r--   0        0        0     7752 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/parse_component.py
--rw-r--r--   0        0        0     3644 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/parse_gds.py
--rw-r--r--   0        0        0     3605 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/parse_layerstack.py
--rw-r--r--   0        0        0     2990 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/refine.py
--rw-r--r--   0        0        0    10851 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/scratch/mesh3D.py
--rw-r--r--   0        0        0     2513 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/tests/test_meshing.py
--rw-r--r--   0        0        0    14168 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/uz_xsection_mesh.py
--rw-r--r--   0        0        0     7441 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/xy_xsection_mesh.py
--rw-r--r--   0        0        0    16334 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gmsh/xyz_mesh.py
--rw-r--r--   0        0        0     1624 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/__init__.py
--rw-r--r--   0        0        0     4368 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/get_results.py
--rw-r--r--   0        0        0    20009 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/get_simulation.py
--rw-r--r--   0        0        0    21071 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py
--rw-r--r--   0        0        0     3486 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/materials.py
--rw-r--r--   0        0        0    27762 2023-05-29 17:46:56.529329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/modes.py
--rw-r--r--   0        0        0     8941 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/sim_run.yaml
--rw-r--r--   0        0        0     8114 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml
--rw-r--r--   0        0        0     8114 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml
--rw-r--r--   0        0        0      744 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/test_modes.py
--rw-r--r--   0        0        0      262 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/test_modes/test_sweep_width.csv
--rw-r--r--   0        0        0      879 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/test_results.py
--rw-r--r--   0        0        0     1505 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/test_simulation.py
--rw-r--r--   0        0        0     1655 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py
--rw-r--r--   0        0        0     9297 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv
--rw-r--r--   0        0        0     1732 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0     1224 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/utils.py
--rw-r--r--   0        0        0    10841 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/write_sparameters.py
--rw-r--r--   0        0        0     7695 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0      588 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/lumerical/__init__.py
--rw-r--r--   0        0        0    16091 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/lumerical/interconnect.py
--rw-r--r--   0        0        0     4286 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/lumerical/read.py
--rw-r--r--   0        0        0     3569 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/lumerical/settings.py
--rw-r--r--   0        0        0     2368 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/lumerical/test_read_sparameters.py
--rw-r--r--   0        0        0    19865 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py
--rw-r--r--   0        0        0     1504 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py
--rw-r--r--   0        0        0      932 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/__init__.py
--rw-r--r--   0        0        0     1618 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/coupler.py
--rw-r--r--   0        0        0     4166 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/find_coupling_vs_gap.py
--rw-r--r--   0        0        0     2773 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/find_mode_dispersion.py
--rw-r--r--   0        0        0     8924 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/find_modes.py
--rwxr-xr-x   0        0        0     7032 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/find_modes_cross_section.py
--rw-r--r--   0        0        0     4458 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py
--rw-r--r--   0        0        0     2728 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/find_neff_vs_width.py
--rw-r--r--   0        0        0     7148 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/get_mode_solver_coupler.py
--rwxr-xr-x   0        0        0     4462 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/get_mode_solver_cross_section.py
--rw-r--r--   0        0        0     5411 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/get_mode_solver_rib.py
--rw-r--r--   0        0        0     1110 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv
--rw-r--r--   0        0        0     1102 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv
--rw-r--r--   0        0        0     1110 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv
--rw-r--r--   0        0        0     8023 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/neff_convergence_test.py
--rw-r--r--   0        0        0      267 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/neff_vs_width.csv
--rw-r--r--   0        0        0     2469 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/overlap.py
--rw-r--r--   0        0        0      418 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/tests/test_dw_dh.py
--rw-r--r--   0        0        0       83 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh.csv
--rw-r--r--   0        0        0      548 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv
--rw-r--r--   0        0        0     1137 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/tests/test_find_modes.py
--rw-r--r--   0        0        0      649 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py
--rw-r--r--   0        0        0      354 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/tests/test_neff_vs_width.py
--rw-r--r--   0        0        0      113 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/tests/test_neff_vs_width/test_neff_vs_width.csv
--rw-r--r--   0        0        0    15492 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/types.py
--rw-r--r--   0        0        0     1169 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/modes/waveguide.py
--rw-r--r--   0        0        0     2013 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/photonic_circuit_models/__init__.py
--rw-r--r--   0        0        0      597 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/photonic_circuit_models/coupler.py
--rw-r--r--   0        0        0      377 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/photonic_circuit_models/fsr.py
--rw-r--r--   0        0        0      418 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/photonic_circuit_models/heater.py
--rw-r--r--   0        0        0     3069 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/photonic_circuit_models/mzi.py
--rw-r--r--   0        0        0     2616 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/photonic_circuit_models/ring.py
--rw-r--r--   0        0        0     7332 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/plot.py
--rw-r--r--   0        0        0     2480 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/plot_csv.py
--rw-r--r--   0        0        0      613 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/port_symmetries.py
--rw-r--r--   0        0        0     4685 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/diffusion.py
--rw-r--r--   0        0        0     5317 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/implant_tables.py
--rw-r--r--   0        0        0     6800 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/pysrim.py
--rw-r--r--   0        0        0     2182 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/silicon.py
--rw-r--r--   0        0        0     1861 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/skew/antimony_si_skew.csv
--rw-r--r--   0        0        0     1050 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/skew/arsenic_si_skew.csv
--rw-r--r--   0        0        0     1468 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/skew/boron_si_skew.csv
--rw-r--r--   0        0        0     1118 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv
--rw-r--r--   0        0        0      191 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/__init__.py
--rw-r--r--   0        0        0    14848 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/build_model.py
--rw-r--r--   0        0        0     7449 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/femwell_waveguide_model.py
--rw-r--r--   0        0        0     1571 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/interpolators.py
--rw-r--r--   0        0        0     6755 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/meep_FDTD_model.py
--rw-r--r--   0        0        0     4528 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/meow_eme_model.py
--rw-r--r--   0        0        0     5613 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/mlp.py
--rw-r--r--   0        0        0     7358 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/models.py
--rw-r--r--   0        0        0    13894 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/parameter.py
--rwxr-xr-x   0        0        0     2225 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/plot_model.py
--rw-r--r--   0        0        0     6805 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/read.py
--rw-r--r--   0        0        0     1350 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/tests/test_mzi.py
--rw-r--r--   0        0        0     2220 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/tests/test_mzi_lattice.py
--rw-r--r--   0        0        0     1405 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/sax/tests/test_parameters.py
--rw-r--r--   0        0        0     1357 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/__init__.py
--rw-r--r--   0        0        0     1573 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/add_gc.py
--rw-r--r--   0        0        0     3383 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/circuit.py
--rw-r--r--   0        0        0      891 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/__init__.py
--rw-r--r--   0        0        0     1295 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/bend_circular.py
--rw-r--r--   0        0        0     1388 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/bend_euler.py
--rw-r--r--   0        0        0     2560 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/coupler.py
--rw-r--r--   0        0        0     1046 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/coupler_fdtd.py
--rw-r--r--   0        0        0     1848 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/coupler_ring.py
--rw-r--r--   0        0        0     1329 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py
--rw-r--r--   0        0        0      589 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py
--rw-r--r--   0        0        0      913 2023-05-29 17:46:56.533329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/gc.py
--rw-r--r--   0        0        0     2032 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/mmi1x2.py
--rw-r--r--   0        0        0     1910 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/mmi2x2.py
--rw-r--r--   0        0        0     2618 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/mzi.py
--rw-r--r--   0        0        0     1759 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/mzi_siepic.py
--rw-r--r--   0        0        0      487 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/mzi_thermal.py
--rw-r--r--   0        0        0     2597 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/ring_double.py
--rw-r--r--   0        0        0     1665 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/ring_double_siepic.py
--rw-r--r--   0        0        0     1782 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/ring_single.py
--rw-r--r--   0        0        0     1416 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/ring_single_siepic.py
--rw-r--r--   0        0        0     1099 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/components/straight.py
--rw-r--r--   0        0        0      800 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/get_transmission.py
--rw-r--r--   0        0        0     2516 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/model_from_gdsfactory.py
--rw-r--r--   0        0        0     3841 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/model_from_sparameters.py
--rw-r--r--   0        0        0     2438 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/plot_circuit.py
--rw-r--r--   0        0        0     1798 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py
--rw-r--r--   0        0        0     2773 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/plot_model.py
--rw-r--r--   0        0        0     1261 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_circuit.py
--rw-r--r--   0        0        0       90 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_circuit/test_circuit_transmission.yml
--rw-r--r--   0        0        0     1109 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components.py
--rw-r--r--   0        0        0       66 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_mzi_.yml
--rw-r--r--   0        0        0       69 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_double_.yml
--rw-r--r--   0        0        0       69 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_single_.yml
--rw-r--r--   0        0        0       92 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_circular_.yml
--rw-r--r--   0        0        0       92 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_euler_.yml
--rw-r--r--   0        0        0      412 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_.yml
--rw-r--r--   0        0        0      412 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_ring_.yml
--rw-r--r--   0        0        0      114 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_gc1550te_.yml
--rw-r--r--   0        0        0      256 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi1x2_.yml
--rw-r--r--   0        0        0      460 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi2x2_.yml
--rw-r--r--   0        0        0      104 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_straight_.yml
--rw-r--r--   0        0        0      166 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/simphony/types.py
--rw-r--r--   0        0        0      471 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/sipann/__init__.py
--rw-r--r--   0        0        0     1376 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/sipann/bend_circular.py
--rw-r--r--   0        0        0     1465 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/sipann/bend_euler.py
--rw-r--r--   0        0        0     2508 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/sipann/coupler.py
--rw-r--r--   0        0        0     1892 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/sipann/coupler_ring.py
--rw-r--r--   0        0        0      736 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/sipann/straight.py
--rw-r--r--   0        0        0      100 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/thermal/__init__.py
--rw-r--r--   0        0        0     7789 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/simulation/thermal/heater.py
--rw-r--r--   0        0        0     1744 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/snap.py
--rw-r--r--   0        0        0     4245 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/symbols.py
--rw-r--r--   0        0        0      524 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/technology/__init__.py
--rw-r--r--   0        0        0     7607 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/technology/klayout_tech.py
--rw-r--r--   0        0        0     1078 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/technology/layer_map.py
--rw-r--r--   0        0        0    16139 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/technology/layer_stack.py
--rw-r--r--   0        0        0    42126 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/technology/layer_views.py
--rw-r--r--   0        0        0     1984 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/technology/simulation_settings.py
--rw-r--r--   0        0        0     1635 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/types.py
--rw-r--r--   0        0        0    10008 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/typings.py
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/utils/__init__.py
--rw-r--r--   0        0        0     1342 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/utils/async_utils.py
--rw-r--r--   0        0        0      376 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/utils/color_utils.py
--rw-r--r--   0        0        0      558 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/utils/file_utils.py
--rw-r--r--   0        0        0      185 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/utils/function_utils.py
--rw-r--r--   0        0        0      684 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/utils/xml_utils.py
--rw-r--r--   0        0        0     1453 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/utils/yaml_utils.py
--rw-r--r--   0        0        0     4865 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/watch.py
--rw-r--r--   0        0        0        0 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/widgets/__init__.py
--rw-r--r--   0        0        0     7969 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/widgets/layout_viewer.py
--rw-r--r--   0        0        0     7480 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/gdsfactory/write_cells.py
--rw-r--r--   0        0        0     4943 2023-05-29 17:46:56.537329 gdsfactory-6.99.0/pyproject.toml
--rw-r--r--   0        0        0    18875 1970-01-01 00:00:00.000000 gdsfactory-6.99.0/PKG-INFO
+-rw-r--r--   0        0        0     1072 2023-08-02 20:27:28.513507 gdsfactory-7.0.0/LICENSE
+-rw-r--r--   0        0        0     9595 2023-08-02 20:27:28.513507 gdsfactory-7.0.0/README.md
+-rw-r--r--   0        0        0     3417 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/__init__.py
+-rw-r--r--   0        0        0     1870 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_keepout.py
+-rw-r--r--   0        0        0    12537 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_labels.py
+-rw-r--r--   0        0        0     3682 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_loopback.py
+-rw-r--r--   0        0        0     5016 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_padding.py
+-rw-r--r--   0        0        0    16012 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_pins.py
+-rw-r--r--   0        0        0    14682 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_ports.py
+-rw-r--r--   0        0        0     2864 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_tapers.py
+-rw-r--r--   0        0        0     2253 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_tapers_cross_section.py
+-rw-r--r--   0        0        0     1791 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/add_termination.py
+-rw-r--r--   0        0        0     1856 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/asserts.py
+-rw-r--r--   0        0        0    14884 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/cell.py
+-rw-r--r--   0        0        0     5959 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/cli.py
+-rw-r--r--   0        0        0   102115 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/component.py
+-rw-r--r--   0        0        0    24269 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/component_layout.py
+-rw-r--r--   0        0        0    30803 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/component_reference.py
+-rw-r--r--   0        0        0     1179 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/C.py
+-rw-r--r--   0        0        0     1105 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/L.py
+-rw-r--r--   0        0        0    21495 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/__init__.py
+-rw-r--r--   0        0        0     2599 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/add_fiducials.py
+-rw-r--r--   0        0        0    13939 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/add_grating_couplers.py
+-rw-r--r--   0        0        0     2014 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/add_trenches.py
+-rw-r--r--   0        0        0     3168 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/align.py
+-rw-r--r--   0        0        0     2528 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/array_component.py
+-rw-r--r--   0        0        0     4664 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/array_with_fanout.py
+-rw-r--r--   0        0        0     4319 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/array_with_via.py
+-rw-r--r--   0        0        0     4042 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/awg.py
+-rw-r--r--   0        0        0     1636 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/bbox.py
+-rw-r--r--   0        0        0     3048 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/bend_circular.py
+-rw-r--r--   0        0        0     2614 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/bend_circular_heater.py
+-rw-r--r--   0        0        0     8029 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/bend_euler.py
+-rw-r--r--   0        0        0     2663 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/bend_port.py
+-rw-r--r--   0        0        0     3807 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/bend_s.py
+-rw-r--r--   0        0        0     5338 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/bezier.py
+-rw-r--r--   0        0        0     1605 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/cavity.py
+-rw-r--r--   0        0        0     5740 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/cdc.py
+-rw-r--r--   0        0        0     2888 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/cdsem_all.py
+-rw-r--r--   0        0        0     1788 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/cdsem_bend180.py
+-rw-r--r--   0        0        0     1593 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/cdsem_coupler.py
+-rw-r--r--   0        0        0     1374 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/cdsem_straight.py
+-rw-r--r--   0        0        0     1552 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/cdsem_straight_density.py
+-rw-r--r--   0        0        0      793 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/circle.py
+-rw-r--r--   0        0        0     5933 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coh_rx_dual_pol.py
+-rw-r--r--   0        0        0     8880 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coh_rx_single_pol.py
+-rw-r--r--   0        0        0     5005 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coh_tx_dual_pol.py
+-rw-r--r--   0        0        0     6080 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coh_tx_single_pol.py
+-rw-r--r--   0        0        0     2514 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/compass.py
+-rw-r--r--   0        0        0     9898 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/component_lattice.py
+-rw-r--r--   0        0        0    11731 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/component_lattice_generic.py
+-rw-r--r--   0        0        0     7130 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/component_sequence.py
+-rw-r--r--   0        0        0      812 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/copy_layers.py
+-rw-r--r--   0        0        0     3460 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler.py
+-rw-r--r--   0        0        0     2128 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler90.py
+-rw-r--r--   0        0        0     1802 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler90bend.py
+-rw-r--r--   0        0        0     4666 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_adiabatic.py
+-rw-r--r--   0        0        0     1909 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_asymmetric.py
+-rw-r--r--   0        0        0     4667 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_bent.py
+-rw-r--r--   0        0        0     3970 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_full.py
+-rw-r--r--   0        0        0     5829 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_ring.py
+-rw-r--r--   0        0        0     1060 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_straight.py
+-rw-r--r--   0        0        0     1164 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_straight_asymmetric.py
+-rw-r--r--   0        0        0     2192 2023-08-02 20:27:28.517501 gdsfactory-7.0.0/gdsfactory/components/coupler_symmetric.py
+-rw-r--r--   0        0        0     1816 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/cross.py
+-rw-r--r--   0        0        0    13157 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/crossing_waveguide.py
+-rw-r--r--   0        0        0      500 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
+-rw-r--r--   0        0        0     1014 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
+-rw-r--r--   0        0        0    19749 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
+-rw-r--r--   0        0        0    19751 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
+-rw-r--r--   0        0        0    19749 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
+-rw-r--r--   0        0        0    19751 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
+-rw-r--r--   0        0        0    19775 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
+-rw-r--r--   0        0        0     3143 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
+-rw-r--r--   0        0        0     5256 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/cutback_2x2.py
+-rw-r--r--   0        0        0     6743 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/cutback_bend.py
+-rw-r--r--   0        0        0     3759 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/cutback_component.py
+-rw-r--r--   0        0        0     2708 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/cutback_splitter.py
+-rw-r--r--   0        0        0     2971 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/dbr.py
+-rw-r--r--   0        0        0     4262 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/dbr_tapered.py
+-rw-r--r--   0        0        0     2481 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/delay_snake.py
+-rw-r--r--   0        0        0     3176 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/delay_snake2.py
+-rw-r--r--   0        0        0     3245 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/delay_snake3.py
+-rw-r--r--   0        0        0     4313 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/delay_snake_sbend.py
+-rw-r--r--   0        0        0     1254 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/dicing_lane.py
+-rw-r--r--   0        0        0     3578 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/die.py
+-rw-r--r--   0        0        0     2968 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/die_bbox.py
+-rw-r--r--   0        0        0     2816 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/die_bbox_frame.py
+-rw-r--r--   0        0        0     7984 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/disk.py
+-rw-r--r--   0        0        0     4121 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/edge_coupler_array.py
+-rw-r--r--   0        0        0     1188 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/ellipse.py
+-rw-r--r--   0        0        0     1756 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/extend_ports_list.py
+-rw-r--r--   0        0        0     7046 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/extension.py
+-rw-r--r--   0        0        0      981 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/fiber.py
+-rw-r--r--   0        0        0     1432 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/fiber_array.py
+-rw-r--r--   0        0        0      722 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/fiducial_squares.py
+-rw-r--r--   0        0        0     3225 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/ge_detector_straight_si_contacts.py
+-rw-r--r--   0        0        0     2458 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_array.py
+-rw-r--r--   0        0        0     4651 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_dual_pol.py
+-rw-r--r--   0        0        0     7137 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical.py
+-rw-r--r--   0        0        0     7209 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
+-rw-r--r--   0        0        0     4942 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py
+-rw-r--r--   0        0        0     4694 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical_trenches.py
+-rw-r--r--   0        0        0     1747 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_functions.py
+-rw-r--r--   0        0        0     9054 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_loss.py
+-rw-r--r--   0        0        0     1814 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_loss_fiber_single.py
+-rw-r--r--   0        0        0     4110 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_rectangular.py
+-rw-r--r--   0        0        0     4650 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
+-rw-r--r--   0        0        0     3855 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
+-rw-r--r--   0        0        0     1579 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/grating_coupler_tree.py
+-rw-r--r--   0        0        0     8722 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/greek_cross.py
+-rw-r--r--   0        0        0     1019 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/hline.py
+-rw-r--r--   0        0        0     3643 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/interdigital_capacitor.py
+-rw-r--r--   0        0        0     1799 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/litho_calipers.py
+-rw-r--r--   0        0        0     1218 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/litho_ruler.py
+-rw-r--r--   0        0        0     1278 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/litho_steps.py
+-rw-r--r--   0        0        0      650 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/logo.py
+-rw-r--r--   0        0        0     1679 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/loop_mirror.py
+-rw-r--r--   0        0        0     5005 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mmi.py
+-rw-r--r--   0        0        0     3978 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mmi1x2.py
+-rw-r--r--   0        0        0     2769 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mmi1x2_with_sbend.py
+-rw-r--r--   0        0        0     3801 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mmi2x2.py
+-rw-r--r--   0        0        0     3192 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mmi2x2_with_sbend.py
+-rw-r--r--   0        0        0     4944 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mmi_90degree_hybrid.py
+-rw-r--r--   0        0        0     3293 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mode_converter.py
+-rw-r--r--   0        0        0     7610 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzi.py
+-rw-r--r--   0        0        0     2464 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzi_arm.py
+-rw-r--r--   0        0        0     5822 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzi_arms.py
+-rw-r--r--   0        0        0    12188 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzi_lattice.py
+-rw-r--r--   0        0        0     4020 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzi_pads_center.py
+-rw-r--r--   0        0        0     1264 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzi_phase_shifter.py
+-rw-r--r--   0        0        0     6310 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzit.py
+-rw-r--r--   0        0        0     3476 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzit_lattice.py
+-rw-r--r--   0        0        0     6016 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/mzm.py
+-rw-r--r--   0        0        0     3518 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/nxn.py
+-rw-r--r--   0        0        0     1940 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/optimal_90deg.py
+-rw-r--r--   0        0        0     3876 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/optimal_hairpin.py
+-rw-r--r--   0        0        0     6131 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/optimal_step.py
+-rw-r--r--   0        0        0     6289 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/pack_doe.py
+-rw-r--r--   0        0        0     3833 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/pad.py
+-rw-r--r--   0        0        0     1915 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/pad_gsg.py
+-rw-r--r--   0        0        0     1157 2023-08-02 20:27:28.521496 gdsfactory-7.0.0/gdsfactory/components/pads_shorted.py
+-rw-r--r--   0        0        0     3799 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/polarization_splitter_rotator.py
+-rw-r--r--   0        0        0     1115 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ramp.py
+-rw-r--r--   0        0        0     1475 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/rectangle.py
+-rw-r--r--   0        0        0     2933 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/rectangle_with_slits.py
+-rw-r--r--   0        0        0     1059 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/rectangular_ring.py
+-rw-r--r--   0        0        0     1476 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/regular_polygon.py
+-rw-r--r--   0        0        0     3276 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/resistance_meander.py
+-rw-r--r--   0        0        0     2629 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/resistance_sheet.py
+-rw-r--r--   0        0        0     1260 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring.py
+-rw-r--r--   0        0        0     4118 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_crow.py
+-rw-r--r--   0        0        0     3247 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_crow_couplers.py
+-rw-r--r--   0        0        0     2348 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_double.py
+-rw-r--r--   0        0        0     2846 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_double_bend_coupler.py
+-rw-r--r--   0        0        0     5102 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_double_heater.py
+-rw-r--r--   0        0        0     7747 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_double_pn.py
+-rw-r--r--   0        0        0    12046 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_section_based.py
+-rw-r--r--   0        0        0     2909 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_single.py
+-rw-r--r--   0        0        0     1923 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_single_array.py
+-rw-r--r--   0        0        0     6868 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_single_bend_coupler.py
+-rw-r--r--   0        0        0     2743 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_single_dut.py
+-rw-r--r--   0        0        0     4231 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_single_heater.py
+-rw-r--r--   0        0        0     5307 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/ring_single_pn.py
+-rw-r--r--   0        0        0     2281 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/seal_ring.py
+-rw-r--r--   0        0        0     3745 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/snspd.py
+-rw-r--r--   0        0        0     2059 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/spiral_double.py
+-rw-r--r--   0        0        0     5832 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/spiral_external_io.py
+-rw-r--r--   0        0        0    16624 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/spiral_heater.py
+-rw-r--r--   0        0        0     9155 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/spiral_inner_io.py
+-rw-r--r--   0        0        0     1733 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/splitter_chain.py
+-rw-r--r--   0        0        0     5289 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/splitter_tree.py
+-rw-r--r--   0        0        0     2640 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight.py
+-rw-r--r--   0        0        0     1033 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_array.py
+-rw-r--r--   0        0        0     7863 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_heater_doped_rib.py
+-rw-r--r--   0        0        0     1922 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_heater_doped_strip.py
+-rw-r--r--   0        0        0     8266 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_heater_meander.py
+-rw-r--r--   0        0        0     8519 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_heater_meander_doped.py
+-rw-r--r--   0        0        0     6044 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_heater_metal.py
+-rw-r--r--   0        0        0     2805 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_pin.py
+-rw-r--r--   0        0        0     3955 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_pin_slot.py
+-rw-r--r--   0        0        0      656 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/straight_rib.py
+-rw-r--r--   0        0        0      821 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/switch_tree.py
+-rw-r--r--   0        0        0     7973 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/taper.py
+-rw-r--r--   0        0        0     3539 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/taper_adiabatic.py
+-rw-r--r--   0        0        0     2801 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/taper_cross_section.py
+-rw-r--r--   0        0        0     2363 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/taper_from_csv.py
+-rw-r--r--   0        0        0     1235 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/taper_parabolic.py
+-rw-r--r--   0        0        0     1787 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/terminator.py
+-rw-r--r--   0        0        0     2887 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/text.py
+-rw-r--r--   0        0        0     3886 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/text_freetype.py
+-rw-r--r--   0        0        0     3186 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/text_rectangular.py
+-rw-r--r--   0        0        0     3897 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/text_rectangular_font.py
+-rw-r--r--   0        0        0     2536 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/triangles.py
+-rw-r--r--   0        0        0      715 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/verniers.py
+-rw-r--r--   0        0        0     2430 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/version_stamp.py
+-rw-r--r--   0        0        0     2413 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/via.py
+-rw-r--r--   0        0        0     3034 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/via_corner.py
+-rw-r--r--   0        0        0     5342 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/via_cutback.py
+-rw-r--r--   0        0        0    15895 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/via_stack.py
+-rw-r--r--   0        0        0     4516 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/via_stack_slot.py
+-rw-r--r--   0        0        0     4918 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/via_stack_with_offset.py
+-rw-r--r--   0        0        0     1065 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/wafer.py
+-rw-r--r--   0        0        0     7181 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/wire.py
+-rw-r--r--   0        0        0      978 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/components/wire_sbend.py
+-rw-r--r--   0        0        0    10085 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/config.py
+-rw-r--r--   0        0        0    38409 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/constants.py
+-rw-r--r--   0        0        0    83618 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/cross_section.py
+-rw-r--r--   0        0        0     2963 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/decorators.py
+-rw-r--r--   0        0        0     8406 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/difftest.py
+-rw-r--r--   0        0        0      668 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/difftest_git.py
+-rw-r--r--   0        0        0     1029 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/events.py
+-rw-r--r--   0        0        0      267 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/export/__init__.py
+-rw-r--r--   0        0        0     3308 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/export/to_3d.py
+-rw-r--r--   0        0        0     7531 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/export/to_gerber.py
+-rw-r--r--   0        0        0     1908 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/export/to_np.py
+-rw-r--r--   0        0        0     3095 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/export/to_stl.py
+-rw-r--r--   0        0        0    11831 2023-08-02 20:27:28.525490 gdsfactory-7.0.0/gdsfactory/fill.py
+-rw-r--r--   0        0        0     7780 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/font.py
+-rw-r--r--   0        0        0     8067 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/functions.py
+-rw-r--r--   0        0        0     1025 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/README.md
+-rw-r--r--   0        0        0     1957 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/__init__.py
+-rw-r--r--   0        0        0     1008 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/containers.py
+-rw-r--r--   0        0        0      169 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/generic_tech.sh
+-rw-r--r--   0        0        0     8117 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/get_klayout_pyxs.py
+-rw-r--r--   0        0        0      161 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/README.md
+-rw-r--r--   0        0        0      104 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/drc/Makefile
+-rw-r--r--   0        0        0        0 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/drc/__init__.py
+-rw-r--r--   0        0        0     2842 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/drc/errors.py
+-rw-r--r--   0        0        0     6192 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/grain.xml
+-rw-r--r--   0        0        0    10140 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/icon_128x128.png
+-rw-r--r--   0        0        0     4248 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/icon_64x64.png
+-rw-r--r--   0        0        0       27 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/.gitignore
+-rw-r--r--   0        0        0      494 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/Makefile
+-rw-r--r--   0        0        0     4062 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/README.md
+-rw-r--r--   0        0        0     2419 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md
+-rw-r--r--   0        0        0     9696 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc
+-rw-r--r--   0        0        0    12379 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py
+-rw-r--r--   0        0        0     7235 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs
+-rw-r--r--   0        0        0     3446 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs
+-rw-r--r--   0        0        0      479 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/devices_connections.lvs
+-rw-r--r--   0        0        0      582 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs
+-rw-r--r--   0        0        0      108 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_derivations.lvs
+-rw-r--r--   0        0        0      186 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_connections.lvs
+-rw-r--r--   0        0        0      398 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_derivations.lvs
+-rw-r--r--   0        0        0      574 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs
+-rw-r--r--   0        0        0     6034 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs
+-rw-r--r--   0        0        0    10697 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py
+-rw-r--r--   0        0        0      477 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/README.md
+-rw-r--r--   0        0        0     4338 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py
+-rw-r--r--   0        0        0      926 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice
+-rw-r--r--   0        0        0    10945 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
+-rw-r--r--   0        0        0      709 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
+-rw-r--r--   0        0        0      538 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
+-rw-r--r--   0        0        0        0 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/python/__init__.py
+-rw-r--r--   0        0        0      114 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
+-rw-r--r--   0        0        0     4312 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
+-rw-r--r--   0        0        0      269 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/Makefile
+-rw-r--r--   0        0        0     1800 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25
+-rw-r--r--   0        0        0     1519 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack
+-rw-r--r--   0        0        0    41073 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
+-rw-r--r--   0        0        0    40616 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/layers.lyp
+-rw-r--r--   0        0        0     5977 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/tech.lyt
+-rw-r--r--   0        0        0     4258 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
+-rw-r--r--   0        0        0     4537 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
+-rw-r--r--   0        0        0     4690 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
+-rw-r--r--   0        0        0     5508 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
+-rw-r--r--   0        0        0     1857 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/layer_map.py
+-rw-r--r--   0        0        0     6511 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/layer_stack.py
+-rw-r--r--   0        0        0    10780 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/layer_views.yaml
+-rw-r--r--   0        0        0     2463 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/generic_tech/simulation_settings.py
+-rw-r--r--   0        0        0     1431 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/__init__.py
+-rw-r--r--   0        0        0     4869 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/boolean.py
+-rw-r--r--   0        0        0     3789 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/boolean_klayout.py
+-rw-r--r--   0        0        0     1862 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/boolean_polygons.py
+-rw-r--r--   0        0        0      567 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/check_duplicated_cells.py
+-rw-r--r--   0        0        0     2693 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/check_exclusion.py
+-rw-r--r--   0        0        0     2803 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/check_inclusion.py
+-rw-r--r--   0        0        0     3540 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/check_space.py
+-rw-r--r--   0        0        0     1867 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/check_width.py
+-rw-r--r--   0        0        0     4954 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/fill_klayout.py
+-rw-r--r--   0        0        0     7017 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/fill_tiled.py
+-rw-r--r--   0        0        0     1655 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/fillet.py
+-rw-r--r--   0        0        0     6614 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/functions.py
+-rw-r--r--   0        0        0     2167 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/invert.py
+-rw-r--r--   0        0        0     3686 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/layer_priority.py
+-rw-r--r--   0        0        0     3055 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/manhattanize.py
+-rw-r--r--   0        0        0     4184 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/maskprep.py
+-rw-r--r--   0        0        0     4759 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/maskprep_flat.py
+-rw-r--r--   0        0        0     3248 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/offset.py
+-rw-r--r--   0        0        0     3810 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/outline.py
+-rw-r--r--   0        0        0     2465 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/trim.py
+-rw-r--r--   0        0        0     2952 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/union.py
+-rw-r--r--   0        0        0     3626 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/write_connectivity.py
+-rw-r--r--   0        0        0    10476 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/write_drc.py
+-rw-r--r--   0        0        0     1783 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/geometry/xor_diff.py
+-rw-r--r--   0        0        0     1152 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/get_factories.py
+-rw-r--r--   0        0        0    23637 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/get_netlist.py
+-rw-r--r--   0        0        0    14481 2023-08-02 20:27:28.529485 gdsfactory-7.0.0/gdsfactory/get_netlist_flat.py
+-rw-r--r--   0        0        0     9689 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/grid.py
+-rw-r--r--   0        0        0     5083 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/install.py
+-rw-r--r--   0        0        0     1855 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/klive.py
+-rw-r--r--   0        0        0      585 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/labels/__init__.py
+-rw-r--r--   0        0        0     3519 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/labels/add_label_yaml.py
+-rw-r--r--   0        0        0     3818 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/labels/ehva.py
+-rw-r--r--   0        0        0     3796 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/labels/merge_test_metadata.py
+-rw-r--r--   0        0        0     4644 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/labels/siepic.py
+-rw-r--r--   0        0        0     4840 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/labels/write_labels.py
+-rw-r--r--   0        0        0     5247 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/name.py
+-rw-r--r--   0        0        0    11574 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/pack.py
+-rw-r--r--   0        0        0    52172 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/path.py
+-rw-r--r--   0        0        0    30164 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/pdk.py
+-rw-r--r--   0        0        0     6092 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/picmodel.py
+-rw-r--r--   0        0        0     5029 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/pixelate.py
+-rw-r--r--   0        0        0      303 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/plugins/__init__.py
+-rw-r--r--   0        0        0     4262 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/polygon.py
+-rw-r--r--   0        0        0    32988 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/port.py
+-rw-r--r--   0        0        0    37674 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/quickplotter.py
+-rw-r--r--   0        0        0      696 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/__init__.py
+-rw-r--r--   0        0        0     1639 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/from_dphox.py
+-rw-r--r--   0        0        0     1259 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/from_gdspaths.py
+-rw-r--r--   0        0        0     1927 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/from_np.py
+-rw-r--r--   0        0        0     2773 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/from_phidl.py
+-rw-r--r--   0        0        0     4222 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/from_updk.py
+-rw-r--r--   0        0        0    37973 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/from_yaml.py
+-rw-r--r--   0        0        0     5997 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/from_yaml_template.py
+-rw-r--r--   0        0        0     5632 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/import_gds.py
+-rw-r--r--   0        0        0     3369 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/read/labels.py
+-rw-r--r--   0        0        0     1474 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/route_info.py
+-rw-r--r--   0        0        0     3767 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/__init__.py
+-rw-r--r--   0        0        0     2907 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/add_electrical_pads_shortest.py
+-rw-r--r--   0        0        0     3002 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/add_electrical_pads_top.py
+-rw-r--r--   0        0        0     3031 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/add_electrical_pads_top_dc.py
+-rw-r--r--   0        0        0     8726 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/add_fiber_array.py
+-rw-r--r--   0        0        0    10573 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/add_fiber_single.py
+-rw-r--r--   0        0        0     9220 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/add_pads.py
+-rw-r--r--   0        0        0    38995 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/all_angle.py
+-rw-r--r--   0        0        0     3879 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/auto_taper.py
+-rw-r--r--   0        0        0      981 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/factories.py
+-rw-r--r--   0        0        0     4324 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/fanout.py
+-rw-r--r--   0        0        0     2796 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/fanout2x2.py
+-rw-r--r--   0        0        0    25075 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_bundle.py
+-rw-r--r--   0        0        0     8642 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_bundle_corner.py
+-rw-r--r--   0        0        0     6904 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_bundle_from_steps.py
+-rw-r--r--   0        0        0    12925 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_bundle_from_waypoints.py
+-rw-r--r--   0        0        0     5258 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_bundle_path_length_match.py
+-rw-r--r--   0        0        0     1912 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_bundle_sbend.py
+-rw-r--r--   0        0        0    17052 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_bundle_u.py
+-rw-r--r--   0        0        0     1486 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_input_labels.py
+-rw-r--r--   0        0        0     9226 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_route.py
+-rw-r--r--   0        0        0    10829 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_route_astar.py
+-rw-r--r--   0        0        0     6090 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_route_from_steps.py
+-rw-r--r--   0        0        0     2766 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_route_sbend.py
+-rw-r--r--   0        0        0     3246 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_routes_bend180.py
+-rw-r--r--   0        0        0     1773 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/get_routes_straight.py
+-rw-r--r--   0        0        0    34260 2023-08-02 20:27:28.533480 gdsfactory-7.0.0/gdsfactory/routing/manhattan.py
+-rw-r--r--   0        0        0    10037 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/path_length_matching.py
+-rw-r--r--   0        0        0    22673 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/route_fiber_array.py
+-rw-r--r--   0        0        0     8643 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/route_fiber_single.py
+-rw-r--r--   0        0        0    18074 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/route_ports_to_side.py
+-rw-r--r--   0        0        0     4341 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/route_quad.py
+-rw-r--r--   0        0        0    14296 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/route_sharp.py
+-rw-r--r--   0        0        0    10141 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/route_south.py
+-rw-r--r--   0        0        0     5040 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/sort_ports.py
+-rw-r--r--   0        0        0     2433 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/routing/utils.py
+-rw-r--r--   0        0        0     2767 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell.py
+-rw-r--r--   0        0        0      646 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
+-rw-r--r--   0        0        0      974 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell_with_pins.py
+-rw-r--r--   0        0        0      664 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
+-rw-r--r--   0        0        0      347 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/02_component_autoname.py
+-rw-r--r--   0        0        0      887 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/03_move.py
+-rw-r--r--   0        0        0      881 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/04_connect.py
+-rw-r--r--   0        0        0      698 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/05_remove_layers.py
+-rw-r--r--   0        0        0      925 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/06_remapping_layers.py
+-rw-r--r--   0        0        0     1081 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/07_flattening_device.py
+-rw-r--r--   0        0        0      475 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/08_group.py
+-rw-r--r--   0        0        0     1621 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/11_component_layout.py
+-rw-r--r--   0        0        0     2225 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/12_component_refs.py
+-rw-r--r--   0        0        0     1013 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/13_component_netlist.py
+-rw-r--r--   0        0        0     2592 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/14_component_connectivity.py
+-rw-r--r--   0        0        0     1683 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/15_component_sequence1.py
+-rw-r--r--   0        0        0     1733 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/16_component_sequence2.py
+-rw-r--r--   0        0        0     1030 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/17_ports.py
+-rw-r--r--   0        0        0      272 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/18_port_markers.py
+-rw-r--r--   0        0        0      361 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/19_references.py
+-rw-r--r--   0        0        0      561 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/20_components.py
+-rw-r--r--   0        0        0      565 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/21_add_fiber_array.py
+-rw-r--r--   0        0        0      550 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/22_add_fiber_single.py
+-rw-r--r--   0        0        0      632 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/22_add_pads.py
+-rw-r--r--   0        0        0      847 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/23_reticle.py
+-rw-r--r--   0        0        0      924 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/23_reticle_passives_grid.py
+-rw-r--r--   0        0        0     1177 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/23_reticle_passives_pack.py
+-rw-r--r--   0        0        0      381 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/24_doe.py
+-rw-r--r--   0        0        0      715 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/24_doe_2.py
+-rw-r--r--   0        0        0      720 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/24_doe_3.py
+-rw-r--r--   0        0        0      306 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/25_slot_cross_section.py
+-rw-r--r--   0        0        0     1363 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/30_lidar.py
+-rw-r--r--   0        0        0     1434 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/30_lidar_pcell.py
+-rw-r--r--   0        0        0     1943 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/30_lidar_with_pads.py
+-rw-r--r--   0        0        0        0 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/__init__.py
+-rw-r--r--   0        0        0     1308 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing.py
+-rw-r--r--   0        0        0      558 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
+-rw-r--r--   0        0        0     6062 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
+-rw-r--r--   0        0        0      444 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
+-rw-r--r--   0        0        0      463 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
+-rw-r--r--   0        0        0     1552 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
+-rw-r--r--   0        0        0     1315 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
+-rw-r--r--   0        0        0      602 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
+-rw-r--r--   0        0        0     3317 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
+-rw-r--r--   0        0        0     1484 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
+-rw-r--r--   0        0        0     3045 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
+-rw-r--r--   0        0        0     3782 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
+-rw-r--r--   0        0        0     2393 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/big_device.py
+-rw-r--r--   0        0        0       19 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/Makefile
+-rw-r--r--   0        0        0        0 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/__init__.py
+-rw-r--r--   0        0        0     1129 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/benchmark/fill_demo.py
+-rw-r--r--   0        0        0      343 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
+-rw-r--r--   0        0        0      637 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/mask.pic.yml
+-rw-r--r--   0        0        0      622 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
+-rw-r--r--   0        0        0      569 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
+-rw-r--r--   0        0        0      453 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/pads.pic.yml
+-rw-r--r--   0        0        0      287 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/rectangles.pic.yml
+-rw-r--r--   0        0        0     2296 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/drc_errors.py
+-rw-r--r--   0        0        0      989 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/drc_write.py
+-rw-r--r--   0        0        0     4494 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/layers.py
+-rw-r--r--   0        0        0      158 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/layers_sky130.py
+-rw-r--r--   0        0        0      363 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/layers_xsection.py
+-rw-r--r--   0        0        0     1065 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/lvs.py
+-rw-r--r--   0        0        0      574 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/demo/pcell.py
+-rw-r--r--   0        0        0     4174 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/netlists/mzi.yml
+-rw-r--r--   0        0        0     5840 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/netlists/mzi_full.yml
+-rw-r--r--   0        0        0        0 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/.gitignore
+-rw-r--r--   0        0        0    10181 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/00_geometry.py
+-rw-r--r--   0        0        0    13583 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/01_references.py
+-rw-r--r--   0        0        0     5845 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/02_movement.py
+-rw-r--r--   0        0        0    29824 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/03_Path_CrossSection.py
+-rw-r--r--   0        0        0     6881 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/03_cells_autoname_and_cache.py
+-rw-r--r--   0        0        0    16888 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/03_layer_stack.py
+-rw-r--r--   0        0        0    11362 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/04_components_geometry.py
+-rw-r--r--   0        0        0     5789 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/04_components_hierarchy.py
+-rw-r--r--   0        0        0     7287 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/04_components_pack.py
+-rw-r--r--   0        0        0     8093 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/04_components_shapes.py
+-rw-r--r--   0        0        0    27801 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/04_routing.py
+-rw-r--r--   0        0        0    10894 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/04_routing_electrical.py
+-rw-r--r--   0        0        0    17498 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/04_routing_non_manhattan.py
+-rw-r--r--   0        0        0    12399 2023-08-02 20:27:28.537474 gdsfactory-7.0.0/gdsfactory/samples/notebooks/07_mask.py
+-rw-r--r--   0        0        0    15157 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/08_pdk.py
+-rw-r--r--   0        0        0    11094 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/08_pdk_examples.py
+-rw-r--r--   0        0        0     8585 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/09_pdk_import.py
+-rw-r--r--   0        0        0    17564 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/10_yaml_component.py
+-rw-r--r--   0        0        0     4684 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/11_get_netlist.py
+-rw-r--r--   0        0        0     2114 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/11_get_netlist_spice.py
+-rw-r--r--   0        0        0     4477 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/21_drc.py
+-rw-r--r--   0        0        0      437 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/Makefile
+-rw-r--r--   0        0        0     6217 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/_0_python.py
+-rw-r--r--   0        0        0    16372 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/_1_git.py
+-rw-r--r--   0        0        0     1092 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/_2_klayout.py
+-rw-r--r--   0        0        0     1384 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/_3_vscode.py
+-rw-r--r--   0        0        0     8163 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/_4_gdsfactory.py
+-rw-r--r--   0        0        0     4412 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/common_mistakes.py
+-rw-r--r--   0        0        0     4018 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/dataprep.py
+-rw-r--r--   0        0        0     2660 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/declarative_cell.py
+-rw-r--r--   0        0        0    13148 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/images/inkscape_align.png
+-rw-r--r--   0        0        0    14726 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/images/inkscape_distribute.png
+-rw-r--r--   0        0        0    71039 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/images/pathlength_report.png
+-rw-r--r--   0        0        0    67563 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/images/pathlength_report_highlighted.png
+-rw-r--r--   0        0        0     6558 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/rib_strip_autotransition.py
+-rw-r--r--   0        0        0      591 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_around_the_back.pic.yml
+-rw-r--r--   0        0        0      726 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_around_the_back2.pic.yml
+-rw-r--r--   0        0        0      822 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_around_the_back3.pic.yml
+-rw-r--r--   0        0        0     1417 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_bundles01.pic.yml
+-rw-r--r--   0        0        0     1508 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_bundles02.pic.yml
+-rw-r--r--   0        0        0     1405 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_bundles03.pic.yml
+-rw-r--r--   0        0        0      600 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_indirect.pic.yml
+-rw-r--r--   0        0        0      614 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_simple.pic.yml
+-rw-r--r--   0        0        0     1152 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_steps01.pic.yml
+-rw-r--r--   0        0        0     1066 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_steps02_final.pic.yml
+-rw-r--r--   0        0        0      778 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_steps02_initial.pic.yml
+-rw-r--r--   0        0        0     1423 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_steps03.pic.yml
+-rw-r--r--   0        0        0      857 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/notebooks/yaml_pics/aar_wonky_connector.pic.yml
+-rw-r--r--   0        0        0        0 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/__init__.py
+-rw-r--r--   0        0        0     4361 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/fab_c.py
+-rw-r--r--   0        0        0      233 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/fab_c_to_updk.py
+-rw-r--r--   0        0        0      475 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/fab_d/__init__.py
+-rw-r--r--   0        0        0     1893 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py
+-rw-r--r--   0        0        0     1745 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c.py
+-rw-r--r--   0        0        0       50 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
+-rw-r--r--   0        0        0       93 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
+-rw-r--r--   0        0        0       85 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
+-rw-r--r--   0        0        0      139 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
+-rw-r--r--   0        0        0       90 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
+-rw-r--r--   0        0        0      126 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
+-rw-r--r--   0        0        0       48 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
+-rw-r--r--   0        0        0     1023 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
+-rw-r--r--   0        0        0     2483 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
+-rw-r--r--   0        0        0     1997 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
+-rw-r--r--   0        0        0     1283 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
+-rw-r--r--   0        0        0     1830 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
+-rw-r--r--   0        0        0     1061 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
+-rw-r--r--   0        0        0     1054 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
+-rw-r--r--   0        0        0     1815 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
+-rw-r--r--   0        0        0     5043 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
+-rw-r--r--   0        0        0     3625 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
+-rw-r--r--   0        0        0     3603 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
+-rw-r--r--   0        0        0     5001 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
+-rw-r--r--   0        0        0      840 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
+-rw-r--r--   0        0        0     2604 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
+-rw-r--r--   0        0        0     4876 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/serialization.py
+-rw-r--r--   0        0        0     1569 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/show.py
+-rw-r--r--   0        0        0      525 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/simulation/__init__.py
+-rw-r--r--   0        0        0     1689 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/snap.py
+-rw-r--r--   0        0        0     4254 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/symbols.py
+-rw-r--r--   0        0        0      308 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/technology/__init__.py
+-rw-r--r--   0        0        0      343 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/technology/color_utils.py
+-rw-r--r--   0        0        0     7550 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/technology/klayout_tech.py
+-rw-r--r--   0        0        0     1041 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/technology/layer_map.py
+-rw-r--r--   0        0        0    19086 2023-08-02 20:27:28.541469 gdsfactory-7.0.0/gdsfactory/technology/layer_stack.py
+-rw-r--r--   0        0        0    41893 2023-08-02 20:27:28.545464 gdsfactory-7.0.0/gdsfactory/technology/layer_views.py
+-rw-r--r--   0        0        0      674 2023-08-02 20:27:28.545464 gdsfactory-7.0.0/gdsfactory/technology/xml_utils.py
+-rw-r--r--   0        0        0     1413 2023-08-02 20:27:28.545464 gdsfactory-7.0.0/gdsfactory/technology/yaml_utils.py
+-rw-r--r--   0        0        0    11084 2023-08-02 20:27:28.545464 gdsfactory-7.0.0/gdsfactory/typings.py
+-rw-r--r--   0        0        0     5489 2023-08-02 20:27:28.545464 gdsfactory-7.0.0/gdsfactory/watch.py
+-rw-r--r--   0        0        0     7419 2023-08-02 20:27:28.545464 gdsfactory-7.0.0/gdsfactory/write_cells.py
+-rw-r--r--   0        0        0     4321 2023-08-02 20:27:28.545464 gdsfactory-7.0.0/pyproject.toml
+-rw-r--r--   0        0        0    11819 1970-01-01 00:00:00.000000 gdsfactory-7.0.0/PKG-INFO
```

### Comparing `gdsfactory-6.99.0/LICENSE` & `gdsfactory-7.0.0/LICENSE`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/__init__.py` & `gdsfactory-7.0.0/gdsfactory/__init__.py`

 * *Files 10% similar despite different names*

```diff
@@ -9,19 +9,17 @@
     - Port
     - TECH
 
 modules:
 
     - c: components
     - routing
-
-isort:skip_file
 """
+# isort: skip_file
 from __future__ import annotations
-import warnings
 from functools import partial
 from toolz import compose
 from gdsfactory.component_layout import Group
 from gdsfactory.path import Path
 
 
 # NOTE: import order matters. Only change the order if you know what you are doing
@@ -32,14 +30,17 @@
 from gdsfactory.cell import declarative_cell
 from gdsfactory.cell import cell_without_validator
 from gdsfactory.cell import clear_cache
 from gdsfactory.show import show
 from gdsfactory.read.import_gds import import_gds
 from gdsfactory.cross_section import CrossSection, Section, xsection
 from gdsfactory.component_layout import Label
+from gdsfactory.polygon import Polygon
+from gdsfactory.difftest import difftest, diff
+
 from gdsfactory import decorators
 from gdsfactory import cross_section
 from gdsfactory import labels
 from gdsfactory import asserts
 from gdsfactory import components
 from gdsfactory import routing
 from gdsfactory import typings
@@ -76,24 +77,14 @@
 )
 from gdsfactory.get_factories import get_cells
 from gdsfactory.cross_section import get_cross_section_factories
 
 c = components
 
 
-def __getattr__(name):
-    if name == "types":
-        warnings.warn(
-            "gdsfactory.types has been renamed to gdsfactory.typings and will be deprecated soon.",
-            stacklevel=3,
-        )
-        return typings
-    raise AttributeError(f"No module named {name}")
-
-
 __all__ = (
     "CONF",
     "Component",
     "ComponentReference",
     "CrossSection",
     "Group",
     "LAYER",
@@ -116,14 +107,16 @@
     "declarative_cell",
     "cell_without_validator",
     "clear_cache",
     "components",
     "compose",
     "cross_section",
     "decorators",
+    "diff",
+    "difftest",
     "fill",
     "fill_rectangle",
     "functions",
     "geometry",
     "get_active_pdk",
     "get_cell",
     "get_cells",
@@ -137,19 +130,22 @@
     "grid",
     "grid_with_text",
     "import_gds",
     "labels",
     "logger",
     "pack",
     "partial",
+    "Polygon",
     "path",
     "read",
     "routing",
     "show",
     "snap",
     "typings",
     "technology",
     "write_cells",
     "xsection",
     "PATH",
 )
-__version__ = "6.99.0"
+
+
+__version__ = "7.0.0"
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_keepout.py` & `gdsfactory-7.0.0/gdsfactory/add_keepout.py`

 * *Files 13% similar despite different names*

```diff
@@ -43,29 +43,22 @@
 def test_add_keepout() -> None:
     from gdsfactory.components.straight import straight
 
     c = straight()
     polygons = len(c.get_polygons())
     target_layers = [LAYER.WG]
     keepout_layers = [LAYER.NO_TILE_SI]
-    # print(len(c.get_polygons()))
 
     assert len(c.get_polygons()) == polygons
-    c = add_keepout(
+    assert add_keepout(
         component=c, target_layers=target_layers, keepout_layers=keepout_layers
     )
-    # print(len(c.get_polygons()))
-    # assert (
-    #     len(c.get_polygons()) == polygons + 1
-    # ), f"{len(c.get_polygons())} != {polygons + 1}"
-    # return c
 
 
 if __name__ == "__main__":
-    test_add_keepout()
-    # from gdsfactory.components.straight import straight
+    from gdsfactory.components.straight import straight
 
-    # c = straight()
-    # target_layers = [LAYER.WG]
-    # keepout_layers = [LAYER.SLAB150]
-    # c = add_keepout(c, target_layers, keepout_layers)
-    # c.show(show_ports=True)
+    c = straight()
+    target_layers = [LAYER.WG]
+    keepout_layers = [LAYER.SLAB150]
+    c = add_keepout(c, target_layers, keepout_layers)
+    c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_labels.py` & `gdsfactory-7.0.0/gdsfactory/add_labels.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,51 +1,51 @@
 """Add Label to each component port."""
 
 from __future__ import annotations
 
+from collections.abc import Callable
 from functools import partial
-from typing import Callable, Dict, List, Optional, Union
 
 import gdsfactory as gf
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.component_layout import _parse_layer
 from gdsfactory.port import Port
 from gdsfactory.typings import ComponentOrReference, Label, LayerSpec
 
 
 def get_input_label_text_dash(
     port: Port,
-    gc: Union[ComponentReference, Component],
-    gc_index: Optional[int] = None,
-    component_name: Optional[str] = None,
+    gc: ComponentReference | Component,
+    gc_index: int | None = None,
+    component_name: str | None = None,
     prefix: str = "",
     suffix: str = "",
 ) -> str:
     """Returns text with `GratingName-ComponentName-PortName`."""
     gc_name = gc.name if isinstance(gc, Component) else gc.parent.name
     return f"{prefix}{gc_name}-{component_name or port.parent.name}-{port.name}{suffix}"
 
 
 def get_input_label_text_dash_loopback(
     port: Port,
-    gc: Union[ComponentReference, Component],
-    gc_index: Optional[int] = None,
-    component_name: Optional[str] = None,
+    gc: ComponentReference | Component,
+    gc_index: int | None = None,
+    component_name: str | None = None,
     prefix: str = "",
 ) -> str:
     """Returns text with `GratingName-ComponentName-Loopback`."""
     gc_name = gc.name if isinstance(gc, Component) else gc.parent.name
     return f"{prefix}{gc_name}-{component_name or port.parent.name}-loopback_{gc_index}"
 
 
 def get_input_label_text(
     port: Port,
-    gc: Union[ComponentReference, Component],
-    gc_index: Optional[int] = None,
-    component_name: Optional[str] = None,
+    gc: ComponentReference | Component,
+    gc_index: int | None = None,
+    component_name: str | None = None,
     component_prefix: str = "",
     prefix: str = "opt",
     suffix: str = "",
 ) -> str:
     """Returns text string for an optical port based on grating coupler.
 
     {label_prefix}_{polarization}_{wavelength_nm}_({prefix}{component_name})
@@ -59,15 +59,15 @@
         prefix: prefix to add to the label.
     """
     polarization = gc.info.get("polarization") or gc.metadata_child.get("polarization")
     wavelength = gc.info.get("wavelength") or gc.metadata_child.get("wavelength")
 
     if polarization not in ["te", "tm"]:
         raise ValueError(f"polarization {polarization!r} needs to be [te, tm]")
-    if not isinstance(wavelength, (int, float)) or not 0.5 < wavelength < 5.0:
+    if not isinstance(wavelength, int | float) or not 0.5 < wavelength < 5.0:
         raise ValueError(
             f"{wavelength} needs to be > 0.5um and < 5um. Make sure it's in um"
         )
 
     component_name = component_name or port.parent.metadata_child.get("name")
 
     text = f"{prefix}_{polarization}_{int(wavelength*1e3)}_({component_prefix}{component_name}){suffix}"
@@ -81,18 +81,18 @@
 
 get_input_label_text_loopback = partial(get_input_label_text, prefix="loopback_")
 
 
 def get_input_label(
     port: Port,
     gc: ComponentReference,
-    gc_index: Optional[int] = None,
+    gc_index: int | None = None,
     gc_port_name: str = "o1",
     layer_label: LayerSpec = "LABEL",
-    component_name: Optional[str] = None,
+    component_name: str | None = None,
     get_input_label_text_function=get_input_label_text,
 ) -> Label:
     """Returns a label with component info for a given grating coupler.
 
     Test equipment to extract grating coupler coordinates and match it to the component.
 
     Args:
@@ -125,17 +125,17 @@
     get_input_label, get_input_label_text_function=get_input_label_text_dash
 )
 
 
 def get_input_label_electrical(
     port: Port,
     gc_index: int = 0,
-    component_name: Optional[str] = None,
+    component_name: str | None = None,
     layer_label: LayerSpec = "LABEL",
-    gc: Optional[ComponentReference] = None,
+    gc: ComponentReference | None = None,
 ) -> Label:
     """Returns a label to test component info for a given electrical port.
 
     This is the label used by T&M to extract grating coupler coordinates
     and match it to the component.
 
     Args:
@@ -164,15 +164,15 @@
     )
 
 
 def add_labels(
     component: Component,
     get_label_function: Callable = get_input_label_electrical,
     layer_label: LayerSpec = "LABEL",
-    gc: Optional[Component] = None,
+    gc: Component | None = None,
     **kwargs,
 ) -> Component:
     """Returns component with labels on ports.
 
     Args:
         component: to add labels to.
         get_label_function: function to get label.
@@ -208,15 +208,15 @@
 
 
 def add_siepic_labels(
     component: Component,
     model: str = "auto",
     library: str = "auto",
     label_layer: LayerSpec = "DEVREC",
-    spice_params: Optional[Union[Dict, List, str]] = None,
+    spice_params: dict | list | str | None = None,
     label_spacing: float = 0.2,
 ) -> Component:
     """Adds labels and returns the same component.
 
     Args:
         component: component.
         model: Lumerical Interconnect model.
@@ -256,15 +256,15 @@
         )
     return c
 
 
 def add_labels_to_ports(
     component: Component,
     label_layer: LayerSpec = "LABEL",
-    port_type: Optional[str] = None,
+    port_type: str | None = None,
     **kwargs,
 ) -> Component:
     """Add labels to component ports.
 
     Args:
         component: to add labels.
         label_layer: layer spec for the label.
@@ -286,15 +286,15 @@
 
     return component
 
 
 def add_labels_to_ports_x_y(
     component: Component,
     label_layer: LayerSpec = "LABEL",
-    port_type: Optional[str] = None,
+    port_type: str | None = None,
     **kwargs,
 ) -> Component:
     """Add labels to component ports. Prepends -x-y coordinates
 
     Args:
         component: to add labels.
         label_layer: layer spec for the label.
@@ -337,18 +337,18 @@
 add_labels_to_ports_opt = partial(add_labels_to_ports, prefix="opt", port_type=None)
 
 
 def get_labels(
     component: ComponentOrReference,
     get_label_function: Callable = get_input_label_electrical,
     layer_label: LayerSpec = "LABEL",
-    gc: Optional[Component] = None,
-    component_name: Optional[str] = None,
+    gc: Component | None = None,
+    component_name: str | None = None,
     **kwargs,
-) -> List[Label]:
+) -> list[Label]:
     """Returns component labels on ports.
 
     Args:
         component: to add labels to.
         get_label_function: function to get label.
         layer_label: layer_label.
         gc: Optional grating coupler.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_loopback.py` & `gdsfactory-7.0.0/gdsfactory/add_loopback.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,10 @@
-"""Add reference for a grating coupler array."""
+"""Add loopback reference for a grating coupler array."""
 from __future__ import annotations
 
-from typing import List, Optional
-
 import gdsfactory as gf
 from gdsfactory.component import ComponentReference
 from gdsfactory.port import Port
 from gdsfactory.routing.manhattan import round_corners
 from gdsfactory.typings import ComponentSpec
 
 
@@ -14,18 +12,18 @@
     port1: Port,
     port2: Port,
     grating: ComponentSpec,
     grating_separation: float = 127.0,
     grating_rotation: int = -90,
     grating_port_name: str = "o1",
     bend: ComponentSpec = gf.components.bend_euler,
-    south_waveguide_spacing: Optional[float] = None,
+    south_waveguide_spacing: float | None = None,
     inside: bool = True,
     **kwargs,
-) -> List[ComponentReference]:
+) -> list[ComponentReference]:
     """Return loopback (grating coupler align reference) references.
 
     Input grating generated on the left of port1
     Output grating generated on the right of port2
 
     Args:
         port1: start port.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_padding.py` & `gdsfactory-7.0.0/gdsfactory/add_padding.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 from __future__ import annotations
 
-from typing import List, Optional, Tuple
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.typings import ComponentSpec, LayerSpec
 
 
 def get_padding_points(
     component: Component,
     default: float = 50.0,
-    top: Optional[float] = None,
-    bottom: Optional[float] = None,
-    right: Optional[float] = None,
-    left: Optional[float] = None,
-) -> List[float]:
+    top: float | None = None,
+    bottom: float | None = None,
+    right: float | None = None,
+    left: float | None = None,
+) -> list[float]:
     """Returns padding points for a component outline.
 
     Args:
         component: to add padding.
         default: default padding in um.
         top: north padding in um.
         bottom: south padding in um.
@@ -37,15 +37,15 @@
         [c.xmax + right, c.ymax + top],
         [c.xmin - left, c.ymax + top],
     ]
 
 
 def add_padding(
     component: ComponentSpec = "mmi2x2",
-    layers: Tuple[LayerSpec, ...] = ("PADDING",),
+    layers: tuple[LayerSpec, ...] = ("PADDING",),
     **kwargs,
 ) -> Component:
     """Adds padding layers to component. Returns same component.
 
     Args:
         component: to add padding.
         layers: list of layers.
@@ -64,15 +64,15 @@
         component.add_polygon(points, layer=layer)
     return component
 
 
 @cell
 def add_padding_container(
     component: ComponentSpec,
-    layers: Tuple[LayerSpec, ...] = ("PADDING",),
+    layers: tuple[LayerSpec, ...] = ("PADDING",),
     **kwargs,
 ) -> Component:
     """Returns new component with padding added.
 
     Args:
         component: to add padding.
         layers: list of layers.
@@ -96,17 +96,17 @@
     c.ports = cref.ports
     c.copy_child_info(component)
     return c
 
 
 def add_padding_to_size(
     component: ComponentSpec,
-    layers: Tuple[LayerSpec, ...] = ("PADDING",),
-    xsize: Optional[float] = None,
-    ysize: Optional[float] = None,
+    layers: tuple[LayerSpec, ...] = ("PADDING",),
+    xsize: float | None = None,
+    ysize: float | None = None,
     left: float = 0,
     bottom: float = 0,
 ) -> Component:
     """Returns component with padding layers on each side.
 
     New size is multiple of grid size.
 
@@ -135,17 +135,17 @@
 
     return component
 
 
 @cell
 def add_padding_to_size_container(
     component: ComponentSpec,
-    layers: Tuple[LayerSpec, ...] = ("PADDING",),
-    xsize: Optional[float] = None,
-    ysize: Optional[float] = None,
+    layers: tuple[LayerSpec, ...] = ("PADDING",),
+    xsize: float | None = None,
+    ysize: float | None = None,
     left: float = 0,
     bottom: float = 0,
 ) -> Component:
     """Returns new component with padding layers on each side. New size is.
 
     multiple of grid size.
 
@@ -178,10 +178,10 @@
     c.copy_child_info(component)
     return c
 
 
 if __name__ == "__main__":
     # test_container()
 
-    p = gf.partial(add_padding, layers=["SLAB150"])
+    p = partial(add_padding, layers=["SLAB150"])
     c = gf.components.straight(length=10, decorator=p)
     c.show()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_pins.py` & `gdsfactory-7.0.0/gdsfactory/add_pins.py`

 * *Files 6% similar despite different names*

```diff
@@ -6,40 +6,62 @@
 Some functions modify a component without changing its name.
 Make sure these functions are inside a new Component or called as a decorator
 They without modifying the cell name
 """
 from __future__ import annotations
 
 import json
+from collections.abc import Callable
 from functools import partial
-from typing import TYPE_CHECKING, Callable, List, Optional, Tuple, Union
+from typing import TYPE_CHECKING
 
 import gdstk
 import numpy as np
 from numpy import ndarray
 from omegaconf import OmegaConf
 
-from gdsfactory.snap import snap_to_grid
-
 if TYPE_CHECKING:
     from gdsfactory.component import Component
     from gdsfactory.component_reference import ComponentReference
     from gdsfactory.port import Port
 
-Layer = Tuple[int, int]
-Layers = Tuple[Layer, ...]
-LayerSpec = Optional[Union[Layer, str, int]]
-LayerSpecs = Tuple[LayerSpec, ...]
+Layer = tuple[int, int]
+Layers = tuple[Layer, ...]
+LayerSpec = Layer | str | int | None
+LayerSpecs = tuple[LayerSpec, ...]
 nm = 1e-3
 
 
 def _rotate(v: ndarray, m: ndarray) -> ndarray:
     return np.dot(m, v)
 
 
+def add_bbox(
+    component: Component,
+    bbox_layer: LayerSpec = "DEVREC",
+) -> Component:
+    """Add bbox on outline.
+
+    Args:
+        component: component to add bbox.
+        bbox_layer: bbox layer.
+    """
+    from gdsfactory.pdk import get_layer
+
+    bbox_layer = get_layer(bbox_layer)
+    polygons = component.get_polygons(as_array=False)
+    polygons_ = gdstk.boolean(
+        polygons, [], "or", layer=bbox_layer[0], datatype=bbox_layer[1]
+    )
+
+    component.add(polygons_)
+
+    return component
+
+
 def add_bbox_siepic(
     component: Component,
     bbox_layer: LayerSpec = "DEVREC",
     remove_layers: LayerSpecs = ("PORT", "PORTE"),
 ) -> Component:
     """Add bounding box device recognition layer.
 
@@ -59,15 +81,15 @@
     if bbox_layer:
         component.add_padding(default=0, layers=(bbox_layer,))
     return component
 
 
 def get_pin_triangle_polygon_tip(
     port: Port,
-) -> Tuple[List[float], Tuple[float, float]]:
+) -> tuple[list[float], tuple[float, float]]:
     """Returns triangle polygon and tip position."""
     p = port
     port_face = p.info.get("face", None)
 
     orientation = p.orientation
 
     if orientation is None:
@@ -157,15 +179,15 @@
     ca = np.cos(a * np.pi / 180)
     sa = np.sin(a * np.pi / 180)
     rot_mat = np.array([[ca, -sa], [sa, ca]])
 
     d = p.width / 2
 
     dbot = np.array([0, -d])
-    dtop = np.array([0, d])
+    dtop = np.array([0, +d])
     dbotin = np.array([-pin_length, -d])
     dtopin = np.array([-pin_length, +d])
 
     p0 = p.center + _rotate(dbot, rot_mat)
     p1 = p.center + _rotate(dtop, rot_mat)
     ptopin = p.center + _rotate(dtopin, rot_mat)
     pbotin = p.center + _rotate(dbotin, rot_mat)
@@ -310,15 +332,15 @@
 
 
 def add_pin_path(
     component: Component,
     port: Port,
     pin_length: float = 2 * nm,
     layer: LayerSpec = "PORT",
-    layer_label: Optional[LayerSpec] = None,
+    layer_label: LayerSpec | None = None,
 ) -> None:
     """Add half out path pin to a component.
 
     This port type is compatible with SiEPIC pdk.
 
     Args:
         component: to add pin.
@@ -370,15 +392,15 @@
     component.add_label(
         text=str(p.name), position=p.center, layer=layer_label, anchor="sw"
     )
 
 
 def add_outline(
     component: Component,
-    reference: Optional[ComponentReference] = None,
+    reference: ComponentReference | None = None,
     layer: LayerSpec = "DEVREC",
     **kwargs,
 ) -> None:
     """Adds devices outline bounding box in layer.
 
     Args:
         component: where to add the markers.
@@ -434,17 +456,17 @@
 add_pins_siepic_electrical = partial(
     add_pins_siepic, port_type="electrical", layer_pin="PORTE"
 )
 
 
 def add_pins(
     component: Component,
-    reference: Optional[ComponentReference] = None,
+    reference: ComponentReference | None = None,
     function: Callable = add_pin_rectangle_inside,
-    select_ports: Optional[Callable] = None,
+    select_ports: Callable | None = None,
     **kwargs,
 ) -> Component:
     """Add Pin port markers.
 
     Be careful with this function as it modifies the component.
 
     Args:
@@ -497,39 +519,37 @@
         position=reference.center, text=settings_string, layer=layer_label
     )
 
 
 def add_instance_label(
     component: Component,
     reference: ComponentReference,
-    instance_name: Optional[str] = None,
+    instance_name: str | None = None,
     layer: LayerSpec = "LABEL_INSTANCE",
 ) -> None:
     """Adds label to a reference in a component."""
     instance_name = (
         instance_name
         or f"{reference.parent.name},{int(reference.x)},{int(reference.y)}"
     )
-    x = snap_to_grid(reference.x)
-    y = snap_to_grid(reference.y)
 
     component.add_label(
         text=instance_name,
-        position=(x, y),
+        position=reference.center,
         layer=layer,
     )
 
 
 def add_pins_and_outline(
     component: Component,
-    reference: Optional[ComponentReference] = None,
-    add_outline_function: Optional[Callable] = add_outline,
-    add_pins_function: Optional[Callable] = add_pins,
-    add_settings_function: Optional[Callable] = add_settings_label,
-    add_instance_label_function: Optional[Callable] = add_settings_label,
+    reference: ComponentReference | None = None,
+    add_outline_function: Callable | None = add_outline,
+    add_pins_function: Callable | None = add_pins,
+    add_settings_function: Callable | None = add_settings_label,
+    add_instance_label_function: Callable | None = add_settings_label,
 ) -> None:
     """Add markers.
 
     - outline
     - pins for the ports
     - label for the name
     - label for the settings
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_ports.py` & `gdsfactory-7.0.0/gdsfactory/add_ports.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,32 +1,31 @@
 """Add ports from pin markers or labels."""
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional, Tuple
 
 import numpy as np
 from numpy import arctan2, degrees, isclose
 
 from gdsfactory.component import Component
 from gdsfactory.port import Port, read_port_markers, sort_ports_clockwise
 from gdsfactory.snap import snap_to_grid
 from gdsfactory.typings import LayerSpec
 
 
 def add_ports_from_markers_square(
     component: Component,
     pin_layer: LayerSpec = "DEVREC",
-    port_layer: Optional[LayerSpec] = None,
-    orientation: Optional[int] = 90,
+    port_layer: LayerSpec | None = None,
+    orientation: int | None = 90,
     min_pin_area_um2: float = 0,
     max_pin_area_um2: float = 150 * 150,
     pin_extra_width: float = 0.0,
-    port_names: Optional[Tuple[str, ...]] = None,
-    port_name_prefix: Optional[str] = None,
+    port_names: tuple[str, ...] | None = None,
+    port_name_prefix: str | None = None,
     port_type: str = "optical",
 ) -> Component:
     """Add ports from square markers at the port center in port_layer.
 
     Args:
         component: to read polygons from and to write ports to.
         pin_layer: for port markers.
@@ -65,41 +64,37 @@
             )
     return component
 
 
 def add_ports_from_markers_center(
     component: Component,
     pin_layer: LayerSpec = "PORT",
-    port_layer: Optional[LayerSpec] = None,
+    port_layer: LayerSpec | None = None,
     inside: bool = False,
     tol: float = 0.1,
     pin_extra_width: float = 0.0,
-    min_pin_area_um2: Optional[float] = None,
+    min_pin_area_um2: float | None = None,
     max_pin_area_um2: float = 150.0 * 150.0,
     skip_square_ports: bool = False,
-    xcenter: Optional[float] = None,
-    ycenter: Optional[float] = None,
-    port_name_prefix: Optional[str] = None,
+    xcenter: float | None = None,
+    ycenter: float | None = None,
+    port_name_prefix: str | None = None,
     port_type: str = "optical",
     short_ports: bool = False,
     auto_rename_ports: bool = True,
     debug: bool = False,
 ) -> Component:
-    """Add ports from rectangular pin markers.
-
-    markers at port center, so half of the marker goes inside and half outside the port.
-
-    guess port orientation from the component center (xcenter)
+    """Add ports from pins guessing port orientation from component boundary.
 
     Args:
         component: to read polygons from and to write ports to.
         pin_layer: GDS layer for maker [int, int].
         port_layer: for the new created port.
         inside: True-> markers  inside. False-> markers at center.
-        tol: tolerance for comparing how rectangular is the pin.
+        tol: tolerance area to search ports at component boundaries xmin, ymin, xmax, xmax.
         pin_extra_width: 2*offset from pin to straight.
         min_pin_area_um2: ignores pins with area smaller than min_pin_area_um2.
         max_pin_area_um2: ignore pins for area above certain size.
         skip_square_ports: skips square ports (hard to guess orientation).
         xcenter: for guessing orientation of rectangular ports.
         ycenter: for guessing orientation of rectangular ports.
         port_name_prefix: defaults to 'o' for optical and 'e' for electrical ports.
@@ -161,85 +156,85 @@
     ports = {}
 
     port_name_prefix_default = "o" if port_type == "optical" else "e"
     port_name_prefix = port_name_prefix or port_name_prefix_default
 
     for i, p in enumerate(port_markers.polygons):
         port_name = f"{port_name_prefix}{i+1}" if port_name_prefix else str(i)
-        (xmin, ymin), (xmax, ymax) = p.bounding_box()
+        (pxmin, pymin), (pxmax, pymax) = p.bounding_box()
         x, y = np.sum(p.bounding_box(), 0) / 2
 
-        dy = ymax - ymin
-        dx = xmax - xmin
+        dy = pymax - pymin
+        dx = pxmax - pxmin
 
         if min_pin_area_um2 and dx * dy < min_pin_area_um2:
             if debug:
                 print(f"skipping port at ({x}, {y}) with min_pin_area_um2 {dx * dy}")
             continue
 
         if max_pin_area_um2 and dx * dy > max_pin_area_um2:
             continue
 
         if skip_square_ports and snap_to_grid(dx) == snap_to_grid(dy):
             if debug:
                 print(f"skipping square port at ({x}, {y})")
             continue
 
-        pxmax = xmax
-        pxmin = xmin
-        pymax = ymax
-        pymin = ymin
-
-        orientation = 0
+        orientation = -1
 
+        # rectangular ports orientation is easier to detect
         if dy < dx if short_ports else dx < dy:
             if x > xc:  # east
                 orientation = 0
                 width = dy
-                x = xmax if inside else x
+                x = pxmax if inside else x
             elif x < xc:  # west
                 orientation = 180
                 width = dy
-                x = xmin if inside else x
+                x = pxmin if inside else x
         elif dy > dx if short_ports else dx > dy:
             if y > yc:  # north
                 orientation = 90
                 width = dx
-                y = ymax if inside else y
+                y = pymax if inside else y
             elif y < yc:  # south
                 orientation = 270
                 width = dx
-                y = ymin if inside else y
+                y = pymin if inside else y
 
+        # square ports ports are harder to detect orientation
         elif pxmax > xmax - tol:  # east
             orientation = 0
             width = dy
-            x = xmax if inside else x
+            x = pxmax if inside else x
         elif pxmin < xmin + tol:  # west
             orientation = 180
             width = dy
-            x = xmin if inside else x
+            x = pxmin if inside else x
         elif pymax > ymax - tol:  # north
             orientation = 90
             width = dx
-            y = ymax if inside else y
+            y = pymax if inside else y
         elif pymin < ymin + tol:  # south
             orientation = 270
             width = dx
-            y = ymin if inside else y
+            y = pymin if inside else y
 
         elif pxmax > xc:
             orientation = 0
             width = dy
-            x = xmax if inside else x
+            x = pxmax if inside else x
 
         elif pxmax < xc:
             orientation = 180
             width = dy
-            x = xmin if inside else x
+            x = pxmin if inside else x
+
+        if orientation == -1:
+            raise ValueError(f"Unable to detector port at ({x}, {y})")
 
         x = snap_to_grid(x)
         y = snap_to_grid(y)
         width = np.round(width - pin_extra_width, 3)
 
         if (x, y) not in port_locations:
             port_locations.append((x, y))
@@ -272,21 +267,21 @@
 add_ports_from_markers_inside = partial(add_ports_from_markers_center, inside=True)
 
 
 def add_ports_from_labels(
     component: Component,
     port_width: float,
     port_layer: LayerSpec,
-    xcenter: Optional[float] = None,
-    port_name_prefix: Optional[str] = None,
+    xcenter: float | None = None,
+    port_name_prefix: str | None = None,
     port_type: str = "optical",
     get_name_from_label: bool = False,
-    layer_label: Optional[LayerSpec] = None,
+    layer_label: LayerSpec | None = None,
     fail_on_duplicates: bool = False,
-    port_orientation: Optional[float] = None,
+    port_orientation: float | None = None,
     guess_port_orientation: bool = True,
 ) -> Component:
     """Add ports from labels.
 
     Assumes that all ports have a label at the port center.
     because labels do not have width, you have to manually specify the ports width
 
@@ -359,17 +354,17 @@
         )
     return component
 
 
 def add_ports_from_siepic_pins(
     component: Component,
     pin_layer_optical: LayerSpec = "PORT",
-    port_layer_optical: Optional[LayerSpec] = None,
+    port_layer_optical: LayerSpec | None = None,
     pin_layer_electrical: LayerSpec = "PORTE",
-    port_layer_electrical: Optional[LayerSpec] = None,
+    port_layer_electrical: LayerSpec | None = None,
 ) -> Component:
     """Add ports from SiEPIC-type cells, where the pins are defined as paths.
 
     Looks for label, path pairs.
 
     Args:
         component: component.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_tapers.py` & `gdsfactory-7.0.0/gdsfactory/add_tapers.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Tuple
+from collections.abc import Callable
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.port import Port, select_ports_optical
 from gdsfactory.typings import ComponentSpec
 
 
 def get_ports_and_tapers(
     component: ComponentSpec,
     taper: ComponentSpec = taper_function,
-    select_ports: Optional[Callable] = select_ports_optical,
-) -> Tuple[List[Port], List[ComponentReference]]:
+    select_ports: Callable | None = select_ports_optical,
+) -> tuple[list[Port], list[ComponentReference]]:
     """Returns ports and taper elements for a component."""
     elements = []
 
     taper = gf.call_if_func(taper)
     component = gf.pdk.get_component(component)
     ports = select_ports(component.ports) if select_ports else component.ports
 
@@ -31,15 +31,15 @@
     return ports, elements
 
 
 @cell
 def add_tapers(
     component: ComponentSpec,
     taper: ComponentSpec = taper_function,
-    select_ports: Optional[Callable] = select_ports_optical,
+    select_ports: Callable | None = select_ports_optical,
     taper_port_name1: str = "o1",
     taper_port_name2: str = "o2",
 ) -> Component:
     """Returns new component with taper in all optical ports.
 
     Args:
         component: spec for the component to add tapers to.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_tapers_cross_section.py` & `gdsfactory-7.0.0/gdsfactory/add_tapers_cross_section.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 from __future__ import annotations
 
-from typing import Callable, Optional
+from collections.abc import Callable
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.taper_cross_section import taper_cross_section
 from gdsfactory.cross_section import strip
 from gdsfactory.port import select_ports_optical
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @cell
 def add_tapers(
     component: Component,
     taper: ComponentSpec = taper_cross_section,
-    select_ports: Optional[Callable] = select_ports_optical,
+    select_ports: Callable | None = select_ports_optical,
     taper_port_name1: str = "o1",
     taper_port_name2: str = "o2",
     cross_section2: CrossSectionSpec = strip,
     **kwargs,
 ) -> Component:
     """Returns new component with taper in all optical ports.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/add_termination.py` & `gdsfactory-7.0.0/gdsfactory/add_termination.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,28 +1,27 @@
 from __future__ import annotations
 
 from functools import partial
-from typing import List, Optional
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.port import Port
 from gdsfactory.typings import ComponentSpec
 
 terminator_function = partial(taper_function, width2=0.1)
 
 
 @cell
 def add_termination(
     component: Component,
-    ports: Optional[List[Port]] = None,
+    ports: list[Port] | None = None,
     terminator: ComponentSpec = terminator_function,
-    port_name: Optional[str] = None,
+    port_name: str | None = None,
     port_type: str = "optical",
     **kwargs,
 ) -> Component:
     """Returns component with terminator on some ports.
 
     Args:
         component: to add terminator.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/asserts.py` & `gdsfactory-7.0.0/gdsfactory/asserts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/cell.py` & `gdsfactory-7.0.0/gdsfactory/cell.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,25 +1,26 @@
 """Cell decorator for functions that return a Component."""
 from __future__ import annotations
 
 import functools
 import hashlib
 import inspect
+from collections.abc import Callable
 from dataclasses import dataclass
 from functools import wraps
-from typing import Any, Callable, Dict, Optional, Tuple, TypeVar, Type
+from typing import Any, TypeVar
 
 import toolz
 from pydantic import BaseModel, validate_arguments
 
 from gdsfactory.component import Component
 from gdsfactory.name import clean_name, get_name_short
 from gdsfactory.serialization import clean_dict, clean_value_name
 
-CACHE: Dict[str, Component] = {}
+CACHE: dict[str, Component] = {}
 
 INFO_VERSION = 2
 
 _F = TypeVar("_F", bound=Callable)
 
 
 class CellReturnTypeError(ValueError):
@@ -47,25 +48,25 @@
     else:
         raise ValueError(f"{func!r} needs to be callable")
     return source
 
 
 class Settings(BaseModel):
     name: str
-    module: str
-    function_name: str
+    function_name: str | None = None
+    module: str | None = None
 
-    info: Dict[str, Any]  # derived properties (length, resistance)
+    info: dict[str, Any] = {}  # derived properties (length, resistance)
     info_version: int = INFO_VERSION
 
-    full: Dict[str, Any]
-    changed: Dict[str, Any]
-    default: Dict[str, Any]
+    full: dict[str, Any] = {}
+    changed: dict[str, Any] = {}
+    default: dict[str, Any] = {}
 
-    child: Optional[Dict[str, Any]] = None
+    child: dict[str, Any] | None = None
 
 
 def cell_without_validator(func: _F) -> _F:
     """Decorator for Component functions.
 
     Similar to cell decorator but does not enforce argument types.
 
@@ -90,14 +91,17 @@
             func.__name__
             if cell_decorator_settings.prefix is None
             else cell_decorator_settings.prefix,
         )
         max_name_length = kwargs.pop(
             "max_name_length", cell_decorator_settings.max_name_length
         )
+        include_module = kwargs.pop(
+            "include_module", cell_decorator_settings.include_module
+        )
 
         sig = inspect.signature(func)
         args_as_kwargs = dict(zip(sig.parameters.keys(), args))
         args_as_kwargs.update(kwargs)
 
         default = {
             p.name: p.default
@@ -126,24 +130,31 @@
         changed_arg_list = sorted(changed_arg_set)
 
         # if any args were different from default, append a hash of those args.
         # else, keep only the base name
         named_args_string = "_".join(changed_arg_list)
         # print(named_args_string)
 
-        if changed_arg_list:
-            named_args_string = (
-                hashlib.md5(named_args_string.encode()).hexdigest()[:8]
+        if changed_arg_list or include_module:
+            if include_module and changed_arg_list:
+                named_args_module_string = f"{named_args_string}_{func.__module__}"
+            elif include_module:
+                named_args_module_string = func.__module__
+            elif changed_arg_list:
+                named_args_module_string = named_args_string
+
+            named_args_module_string = (
+                hashlib.md5(named_args_module_string.encode()).hexdigest()[:8]
                 if with_hash
-                or len(named_args_string) > 28
-                or "'" in named_args_string
-                or "{" in named_args_string
-                else named_args_string
+                or len(named_args_module_string) > 28
+                or "'" in named_args_module_string
+                or "{" in named_args_module_string
+                else named_args_module_string
             )
-            name_signature = clean_name(f"{prefix}_{named_args_string}")
+            name_signature = clean_name(f"{prefix}_{named_args_module_string}")
         else:
             name_signature = prefix
 
         # filter the changed dictionary to only keep entries which have truly changed
         changed_arg_names = [carg.split("=")[0] for carg in changed_arg_list]
         changed = {k: changed[k] for k in changed_arg_names}
         default_decorator = active_pdk.default_decorator if active_pdk else None
@@ -186,15 +197,15 @@
 
         if not isinstance(component, Component):
             raise CellReturnTypeError(
                 f"function {func.__name__!r} return type = {type(component)}",
                 "make sure that functions with @cell decorator return a Component",
             )
 
-        if metadata_child and component.get_child_name:
+        if metadata_child and component._get_child_name:
             component_name = f"{metadata_child.get('name')}_{name}"
             component_name = get_name_short(
                 component_name, max_name_length=max_name_length
             )
         else:
             component_name = name
 
@@ -205,22 +216,23 @@
             component.info = {}
 
         component.info.update(**info)
 
         if not hasattr(component, "imported_gds"):
             component.settings = Settings(
                 name=component_name,
-                module=func.__module__,
                 function_name=func.__name__,
+                module=func.__module__,
                 changed=clean_dict(changed),
                 default=clean_dict(default),
                 full=clean_dict(full),
                 info=component.info,
                 child=metadata_child,
             )
+            component.__doc__ = func.__doc__
 
         if decorator:
             if not callable(decorator):
                 raise ValueError(f"decorator = {type(decorator)} needs to be callable")
             component_new = decorator(component)
             # if component_new is not component:
             #     component_new.name = name
@@ -294,15 +306,15 @@
 
         mzi_with_bend_decorated = gf.cell(mzi_with_bend)
 
     """
     return cell_without_validator(validate_arguments(func))
 
 
-def declarative_cell(cls: Type[Any]) -> Callable[..., Component]:
+def declarative_cell(cls: type[Any]) -> Callable[..., Component]:
     """
     TODO:
 
     - add placements
     - add routes
 
     """
@@ -342,15 +354,15 @@
         CACHE[component_name] = comp
         return comp
 
     return cell
 
 
 @cell
-def wg(length: int = 3, layer: Tuple[int, int] = (1, 0)) -> Component:
+def wg(length: int = 3, layer: tuple[int, int] = (1, 0)) -> Component:
     """Dummy component for testing."""
     c = Component()
     width = 0.5
     w = width / 2
     c.add_polygon([(0, -w), (length, -w), (length, w), (0, w)], layer=layer)
     c.add_port(name="o1", center=[0, 0], width=width, orientation=180, layer=layer)
     c.add_port(name="o2", center=[length, 0], width=width, orientation=0, layer=layer)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/cli.py` & `gdsfactory-7.0.0/gdsfactory/cli.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,33 +1,30 @@
 """Command line interface. Type `gf` into a terminal."""
 
 from __future__ import annotations
 
 import pathlib
-from typing import Optional
 
 from click.core import Context, Option
 
 import gdsfactory
-from gdsfactory.config import cwd, print_config
+from gdsfactory.config import cwd, print_config, print_version_pdks, print_version_raw
 from gdsfactory.config import print_version as _print_version
-from gdsfactory.config import print_version_raw
-from gdsfactory.config import print_version_pdks
 from gdsfactory.generic_tech import LAYER
 from gdsfactory.install import install_gdsdiff, install_klayout_package
 from gdsfactory.technology import lyp_to_dataclass
 from gdsfactory.typings import PathType
 from gdsfactory.write_cells import write_cells as write_cells_to_separate_gds
 
 try:
     import rich_click as click
 except ImportError:
     import click
 
-VERSION = "6.99.0"
+VERSION = "7.0.0"
 LAYER_LABEL = LAYER.LABEL
 
 
 def print_version(ctx: Context, param: Option, value: bool) -> None:
     """Prints the version."""
     if not value or ctx.resilient_parsing:
         return
@@ -83,17 +80,15 @@
     """Write each all level cells into separate GDS files."""
     write_cells_to_separate_gds(gdspath=gdspath, dirpath=dirpath)
 
 
 @click.command(name="merge_gds")
 @click.argument("dirpath", required=False, default=None)
 @click.argument("gdspath", required=False, default=None)
-def merge_gds(
-    dirpath: Optional[PathType] = None, gdspath: Optional[PathType] = None
-) -> None:
+def merge_gds(dirpath: PathType | None = None, gdspath: PathType | None = None) -> None:
     """Merges GDS cells from a directory into a single GDS."""
     dirpath = dirpath or pathlib.Path.cwd()
     gdspath = gdspath or pathlib.Path.cwd() / "merged.gds"
 
     dirpath = pathlib.Path(dirpath)
 
     c = gdsfactory.read.from_gdsdir(dirpath=dirpath)
@@ -131,18 +126,19 @@
 @click.command()
 def web(
     pdk: str,
     host: str,
     port: int,
 ) -> None:
     """Opens web viewer."""
-    import uvicorn
-    from gdsfactory.plugins.web.main import app
     import os
 
+    import uvicorn
+    from gplugins.web.main import app
+
     os.environ["PDK"] = pdk
 
     uvicorn.run(app, host=host, port=port)
 
 
 @click.argument("path", type=click.Path(exists=True), required=False, default=cwd)
 @click.command()
@@ -151,38 +147,57 @@
     from gdsfactory.watch import watch
 
     path = pathlib.Path(path)
     path = path.parent if path.is_dir() else path
     watch(str(path))
 
 
+# INIT
+@click.group()
+def init() -> None:
+    """Commands for initializing projects."""
+    pass
+
+
+@click.command()
+def notebooks() -> None:
+    """Convert notebooks in py to ipynb."""
+    from gdsfactory.install import convert_py_to_ipynb
+
+    convert_py_to_ipynb()
+
+
 # EXTRA
 @click.command()
 @click.argument("filename")
 def show(filename: str) -> None:
     """Show a GDS file using klive."""
     gdsfactory.show(filename)
 
 
 @click.command()
 @click.argument("gdspath1")
 @click.argument("gdspath2")
 @click.option("--xor", "-x", default=False, help="include xor", is_flag=True)
 def diff(gdspath1: str, gdspath2: str, xor: bool = False) -> None:
     """Show boolean difference between two GDS files."""
-    from gdsfactory.gdsdiff.gdsdiff import gdsdiff
+    from gdsfactory.difftest import diff
 
-    diff = gdsdiff(gdspath1, gdspath2, xor=xor)
-    diff.show()
+    diff(gdspath1, gdspath2, xor=xor)
 
 
 @click.command()
-def klayout_integration() -> None:
-    """Install generic Klayout layermap, klive and git diff."""
+def klayout_genericpdk() -> None:
+    """Install Klayout generic PDK."""
     install_klayout_package()
+
+
+@click.command()
+def git_diff() -> None:
+    """Install git diff."""
     install_gdsdiff()
 
 
 @click.command()
 def raw() -> None:
     """Show installed plugin versions."""
     print_version_raw()
@@ -199,34 +214,38 @@
     "--version",
     is_flag=True,
     callback=print_version,
     expose_value=False,
     is_eager=True,
     help="Show the version number.",
 )
-def cli(name="gf") -> None:
+def cli() -> None:
     """`gf` is the gdsfactory command line tool."""
 
 
 gds.add_command(layermap_to_dataclass)
 gds.add_command(write_cells)
 gds.add_command(merge_gds)
 gds.add_command(show)
 gds.add_command(diff)
 
-install.add_command(klayout_integration)
+install.add_command(klayout_genericpdk)
+install.add_command(git_diff)
 
 version.add_command(raw)
 version.add_command(pdks)
 
+init.add_command(notebooks)
+
 cli.add_command(web)
 # watch.add_command(watch_yaml)
 
 cli.add_command(gds)
 cli.add_command(install)
 cli.add_command(watch)
 cli.add_command(version)
+cli.add_command(init)
 
 
 if __name__ == "__main__":
     # cli()
     print_version()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/component.py` & `gdsfactory-7.0.0/gdsfactory/component.py`

 * *Files 6% similar despite different names*

```diff
@@ -5,6292 +5,6379 @@
 00000040: 3a2f 2f67 6974 6875 622e 636f 6d2f 616d  ://github.com/am
 00000050: 6363 6175 6768 2f70 6869 646c 2f20 6279  ccaugh/phidl/ by
 00000060: 2041 6461 6d20 4d63 4361 7567 6861 6e0a   Adam McCaughan.
 00000070: 2222 220a 6672 6f6d 205f 5f66 7574 7572  """.from __futur
 00000080: 655f 5f20 696d 706f 7274 2061 6e6e 6f74  e__ import annot
 00000090: 6174 696f 6e73 0a0a 696d 706f 7274 2064  ations..import d
 000000a0: 6174 6574 696d 650a 696d 706f 7274 2068  atetime.import h
-000000b0: 6173 686c 6962 0a69 6d70 6f72 7420 6974  ashlib.import it
-000000c0: 6572 746f 6f6c 730a 696d 706f 7274 206d  ertools.import m
-000000d0: 6174 680a 696d 706f 7274 2070 6174 686c  ath.import pathl
-000000e0: 6962 0a69 6d70 6f72 7420 7575 6964 0a69  ib.import uuid.i
-000000f0: 6d70 6f72 7420 7761 726e 696e 6773 0a66  mport warnings.f
-00000100: 726f 6d20 636f 7079 2069 6d70 6f72 7420  rom copy import 
-00000110: 6465 6570 636f 7079 0a66 726f 6d20 636f  deepcopy.from co
-00000120: 6c6c 6563 7469 6f6e 7320 696d 706f 7274  llections import
-00000130: 2043 6f75 6e74 6572 0a66 726f 6d20 636f   Counter.from co
-00000140: 6c6c 6563 7469 6f6e 732e 6162 6320 696d  llections.abc im
-00000150: 706f 7274 2049 7465 7261 626c 650a 6672  port Iterable.fr
-00000160: 6f6d 2070 6174 686c 6962 2069 6d70 6f72  om pathlib impor
-00000170: 7420 5061 7468 0a66 726f 6d20 7479 7069  t Path.from typi
-00000180: 6e67 2069 6d70 6f72 7420 416e 792c 2044  ng import Any, D
-00000190: 6963 742c 204c 6973 742c 204f 7074 696f  ict, List, Optio
-000001a0: 6e61 6c2c 2053 6574 2c20 5475 706c 652c  nal, Set, Tuple,
-000001b0: 2055 6e69 6f6e 0a0a 696d 706f 7274 2067   Union..import g
-000001c0: 6473 746b 0a69 6d70 6f72 7420 6e75 6d70  dstk.import nump
-000001d0: 7920 6173 206e 700a 696d 706f 7274 2079  y as np.import y
-000001e0: 616d 6c0a 6672 6f6d 206f 6d65 6761 636f  aml.from omegaco
-000001f0: 6e66 2069 6d70 6f72 7420 4469 6374 436f  nf import DictCo
-00000200: 6e66 6967 2c20 4f6d 6567 6143 6f6e 660a  nfig, OmegaConf.
-00000210: 6672 6f6d 2074 7970 696e 675f 6578 7465  from typing_exte
-00000220: 6e73 696f 6e73 2069 6d70 6f72 7420 4c69  nsions import Li
-00000230: 7465 7261 6c0a 0a66 726f 6d20 6764 7366  teral..from gdsf
-00000240: 6163 746f 7279 2e63 6f6d 706f 6e65 6e74  actory.component
-00000250: 5f6c 6179 6f75 7420 696d 706f 7274 2028  _layout import (
-00000260: 0a20 2020 204c 6162 656c 2c0a 2020 2020  .    Label,.    
-00000270: 506f 6c79 676f 6e2c 0a20 2020 205f 616c  Polygon,.    _al
-00000280: 6967 6e2c 0a20 2020 205f 6469 7374 7269  ign,.    _distri
-00000290: 6275 7465 2c0a 2020 2020 5f47 656f 6d65  bute,.    _Geome
-000002a0: 7472 7948 656c 7065 722c 0a20 2020 205f  tryHelper,.    _
-000002b0: 7061 7273 655f 6c61 7965 722c 0a20 2020  parse_layer,.   
-000002c0: 2067 6574 5f70 6f6c 7967 6f6e 732c 0a29   get_polygons,.)
-000002d0: 0a66 726f 6d20 6764 7366 6163 746f 7279  .from gdsfactory
-000002e0: 2e63 6f6d 706f 6e65 6e74 5f72 6566 6572  .component_refer
-000002f0: 656e 6365 2069 6d70 6f72 7420 436f 6d70  ence import Comp
-00000300: 6f6e 656e 7452 6566 6572 656e 6365 2c20  onentReference, 
-00000310: 436f 6f72 6469 6e61 7465 2c20 5369 7a65  Coordinate, Size
-00000320: 496e 666f 0a66 726f 6d20 6764 7366 6163  Info.from gdsfac
-00000330: 746f 7279 2e63 6f6e 6669 6720 696d 706f  tory.config impo
-00000340: 7274 2043 4f4e 462c 206c 6f67 6765 722c  rt CONF, logger,
-00000350: 2047 4453 4449 525f 5445 4d50 0a66 726f   GDSDIR_TEMP.fro
-00000360: 6d20 6764 7366 6163 746f 7279 2e63 726f  m gdsfactory.cro
-00000370: 7373 5f73 6563 7469 6f6e 2069 6d70 6f72  ss_section impor
-00000380: 7420 4372 6f73 7353 6563 7469 6f6e 0a66  t CrossSection.f
-00000390: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
-000003a0: 6f72 7420 696d 706f 7274 2028 0a20 2020  ort import (.   
-000003b0: 2050 6f72 742c 0a20 2020 2061 7574 6f5f   Port,.    auto_
-000003c0: 7265 6e61 6d65 5f70 6f72 7473 2c0a 2020  rename_ports,.  
-000003d0: 2020 6175 746f 5f72 656e 616d 655f 706f    auto_rename_po
-000003e0: 7274 735f 636f 756e 7465 725f 636c 6f63  rts_counter_cloc
-000003f0: 6b77 6973 652c 0a20 2020 2061 7574 6f5f  kwise,.    auto_
-00000400: 7265 6e61 6d65 5f70 6f72 7473 5f6c 6179  rename_ports_lay
-00000410: 6572 5f6f 7269 656e 7461 7469 6f6e 2c0a  er_orientation,.
-00000420: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
-00000430: 706f 7274 735f 6f72 6965 6e74 6174 696f  ports_orientatio
-00000440: 6e2c 0a20 2020 206d 6170 5f70 6f72 7473  n,.    map_ports
-00000450: 5f6c 6179 6572 5f74 6f5f 6f72 6965 6e74  _layer_to_orient
-00000460: 6174 696f 6e2c 0a20 2020 206d 6170 5f70  ation,.    map_p
-00000470: 6f72 7473 5f74 6f5f 6f72 6965 6e74 6174  orts_to_orientat
-00000480: 696f 6e5f 6363 772c 0a20 2020 206d 6170  ion_ccw,.    map
-00000490: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
-000004a0: 6174 696f 6e5f 6377 2c0a 2020 2020 7365  ation_cw,.    se
-000004b0: 6c65 6374 5f70 6f72 7473 2c0a 290a 6672  lect_ports,.).fr
-000004c0: 6f6d 2067 6473 6661 6374 6f72 792e 7365  om gdsfactory.se
-000004d0: 7269 616c 697a 6174 696f 6e20 696d 706f  rialization impo
-000004e0: 7274 2063 6c65 616e 5f64 6963 740a 6672  rt clean_dict.fr
-000004f0: 6f6d 2067 6473 6661 6374 6f72 792e 736e  om gdsfactory.sn
-00000500: 6170 2069 6d70 6f72 7420 736e 6170 5f74  ap import snap_t
-00000510: 6f5f 6772 6964 0a66 726f 6d20 6764 7366  o_grid.from gdsf
-00000520: 6163 746f 7279 2e74 6563 686e 6f6c 6f67  actory.technolog
-00000530: 7920 696d 706f 7274 204c 6179 6572 5669  y import LayerVi
-00000540: 6577 2c20 4c61 7965 7256 6965 7773 2c20  ew, LayerViews, 
-00000550: 4c61 7965 7253 7461 636b 0a66 726f 6d20  LayerStack.from 
-00000560: 6764 7366 6163 746f 7279 2e67 656e 6572  gdsfactory.gener
-00000570: 6963 5f74 6563 6820 696d 706f 7274 204c  ic_tech import L
-00000580: 4159 4552 0a0a 506c 6f74 7465 7220 3d20  AYER..Plotter = 
-00000590: 4c69 7465 7261 6c5b 2268 6f6c 6f76 6965  Literal["holovie
-000005a0: 7773 222c 2022 6d61 7470 6c6f 746c 6962  ws", "matplotlib
-000005b0: 222c 2022 7174 222c 2022 6b6c 6179 6f75  ", "qt", "klayou
-000005c0: 7422 5d0a 4178 6973 203d 204c 6974 6572  t"].Axis = Liter
-000005d0: 616c 5b22 7822 2c20 2279 225d 0a0a 0a63  al["x", "y"]...c
-000005e0: 6c61 7373 2055 6e63 6163 6865 6443 6f6d  lass UncachedCom
-000005f0: 706f 6e65 6e74 5761 726e 696e 6728 5573  ponentWarning(Us
-00000600: 6572 5761 726e 696e 6729 3a0a 2020 2020  erWarning):.    
-00000610: 7061 7373 0a0a 0a63 6c61 7373 2055 6e63  pass...class Unc
-00000620: 6163 6865 6443 6f6d 706f 6e65 6e74 4572  achedComponentEr
-00000630: 726f 7228 5661 6c75 6545 7272 6f72 293a  ror(ValueError):
-00000640: 0a20 2020 2070 6173 730a 0a0a 636c 6173  .    pass...clas
-00000650: 7320 4d75 7461 6269 6c69 7479 4572 726f  s MutabilityErro
-00000660: 7228 5661 6c75 6545 7272 6f72 293a 0a20  r(ValueError):. 
-00000670: 2020 2070 6173 730a 0a0a 6465 6620 5f67     pass...def _g
-00000680: 6574 5f64 6570 656e 6465 6e63 6965 7328  et_dependencies(
-00000690: 636f 6d70 6f6e 656e 742c 2072 6566 6572  component, refer
-000006a0: 656e 6365 735f 7365 7429 202d 3e20 4e6f  ences_set) -> No
-000006b0: 6e65 3a0a 2020 2020 666f 7220 7265 6620  ne:.    for ref 
-000006c0: 696e 2063 6f6d 706f 6e65 6e74 2e72 6566  in component.ref
-000006d0: 6572 656e 6365 733a 0a20 2020 2020 2020  erences:.       
-000006e0: 2072 6566 6572 656e 6365 735f 7365 742e   references_set.
-000006f0: 6164 6428 7265 662e 7265 665f 6365 6c6c  add(ref.ref_cell
-00000700: 290a 2020 2020 2020 2020 5f67 6574 5f64  ).        _get_d
-00000710: 6570 656e 6465 6e63 6965 7328 7265 662e  ependencies(ref.
-00000720: 7265 665f 6365 6c6c 2c20 7265 6665 7265  ref_cell, refere
-00000730: 6e63 6573 5f73 6574 290a 0a0a 6d75 7461  nces_set)...muta
-00000740: 6269 6c69 7479 5f65 7272 6f72 5f6d 6573  bility_error_mes
-00000750: 7361 6765 203d 2022 2222 0a59 6f75 2063  sage = """.You c
-00000760: 616e 6e6f 7420 6d6f 6469 6679 2061 2043  annot modify a C
-00000770: 6f6d 706f 6e65 6e74 2061 6674 6572 2063  omponent after c
-00000780: 7265 6174 696f 6e20 6173 2069 7420 7769  reation as it wi
-00000790: 6c6c 2061 6666 6563 7420 616c 6c20 6f66  ll affect all of
-000007a0: 2069 7473 2069 6e73 7461 6e63 6573 2e0a   its instances..
-000007b0: 0a43 7265 6174 6520 6120 6e65 7720 436f  .Create a new Co
-000007c0: 6d70 6f6e 656e 7420 616e 6420 6164 6420  mponent and add 
-000007d0: 6120 7265 6665 7265 6e63 6520 746f 2069  a reference to i
-000007e0: 742e 0a0a 466f 7220 6578 616d 706c 653a  t...For example:
-000007f0: 0a0a 2320 4241 440a 6320 3d20 6766 2e63  ..# BAD.c = gf.c
-00000800: 6f6d 706f 6e65 6e74 732e 6265 6e64 5f65  omponents.bend_e
-00000810: 756c 6572 2829 0a63 2e61 6464 5f72 6566  uler().c.add_ref
-00000820: 2867 662e 636f 6d70 6f6e 656e 7473 2e6d  (gf.components.m
-00000830: 7a69 2829 290a 0a23 2047 4f4f 440a 6320  zi())..# GOOD.c 
-00000840: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
-00000850: 0a63 2e61 6464 5f72 6566 2867 662e 636f  .c.add_ref(gf.co
-00000860: 6d70 6f6e 656e 7473 2e62 656e 645f 6575  mponents.bend_eu
-00000870: 6c65 7228 2929 0a63 2e61 6464 5f72 6566  ler()).c.add_ref
-00000880: 2867 662e 636f 6d70 6f6e 656e 7473 2e6d  (gf.components.m
-00000890: 7a69 2829 290a 2222 220a 0a6d 6f76 655f  zi())."""..move_
-000008a0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-000008b0: 2222 220a 596f 7520 6361 6e6e 6f74 206d  """.You cannot m
-000008c0: 6f76 6520 6120 436f 6d70 6f6e 656e 742e  ove a Component.
-000008d0: 2059 6f75 2063 616e 2063 7265 6174 6520   You can create 
-000008e0: 6120 6e65 7720 436f 6d70 6f6e 656e 742c  a new Component,
-000008f0: 2061 6464 2061 2072 6566 6572 656e 6365   add a reference
-00000900: 2074 6f20 7468 6520 6f74 6865 7220 436f   to the other Co
-00000910: 6d70 6f6e 656e 7420 616e 6420 7468 656e  mponent and then
-00000920: 206d 6f76 6520 7468 6520 7265 6665 7265   move the refere
-00000930: 6e63 652e 0a0a 466f 7220 6578 616d 706c  nce...For exampl
-00000940: 653a 0a0a 2320 4241 440a 6320 3d20 6766  e:..# BAD.c = gf
-00000950: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
-00000960: 6967 6874 2829 0a63 2e78 6d69 6e20 3d20  ight().c.xmin = 
-00000970: 3130 0a0a 2320 474f 4f44 0a63 203d 2067  10..# GOOD.c = g
-00000980: 662e 436f 6d70 6f6e 656e 7428 290a 7265  f.Component().re
-00000990: 6620 3d20 632e 6164 645f 7265 6628 6766  f = c.add_ref(gf
-000009a0: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
-000009b0: 6967 6874 2829 2920 2320 6f72 2072 6566  ight()) # or ref
-000009c0: 203d 2063 203c 3c20 6766 2e63 6f6d 706f   = c << gf.compo
-000009d0: 6e65 6e74 732e 7374 7261 6967 6874 2829  nents.straight()
-000009e0: 0a72 6566 2e78 6d69 6e20 3d20 3130 0a22  .ref.xmin = 10."
-000009f0: 2222 0a0a 5061 7468 5479 7065 203d 2055  ""..PathType = U
-00000a00: 6e69 6f6e 5b73 7472 2c20 5061 7468 5d0a  nion[str, Path].
-00000a10: 466c 6f61 7432 203d 2054 7570 6c65 5b66  Float2 = Tuple[f
-00000a20: 6c6f 6174 2c20 666c 6f61 745d 0a4c 6179  loat, float].Lay
-00000a30: 6572 203d 2054 7570 6c65 5b69 6e74 2c20  er = Tuple[int, 
-00000a40: 696e 745d 0a4c 6179 6572 7320 3d20 5475  int].Layers = Tu
-00000a50: 706c 655b 4c61 7965 722c 202e 2e2e 5d0a  ple[Layer, ...].
-00000a60: 4c61 7965 7253 7065 6320 3d20 556e 696f  LayerSpec = Unio
-00000a70: 6e5b 7374 722c 2069 6e74 2c20 4c61 7965  n[str, int, Laye
-00000a80: 722c 204e 6f6e 655d 0a0a 5f74 696d 6573  r, None].._times
-00000a90: 7461 6d70 3230 3139 203d 2064 6174 6574  tamp2019 = datet
-00000aa0: 696d 652e 6461 7465 7469 6d65 2e66 726f  ime.datetime.fro
-00000ab0: 6d74 696d 6573 7461 6d70 2831 3537 3230  mtimestamp(15720
-00000ac0: 3134 3139 322e 3832 3733 290a 4d41 585f  14192.8273).MAX_
-00000ad0: 4e41 4d45 5f4c 454e 4754 4820 3d20 3332  NAME_LENGTH = 32
-00000ae0: 0a0a 0a64 6566 205f 726e 6428 6172 722c  ...def _rnd(arr,
-00000af0: 2070 7265 6369 7369 6f6e 3d31 652d 3429   precision=1e-4)
-00000b00: 3a0a 2020 2020 6172 7220 3d20 6e70 2e61  :.    arr = np.a
-00000b10: 7363 6f6e 7469 6775 6f75 7361 7272 6179  scontiguousarray
-00000b20: 2861 7272 290a 2020 2020 6e64 6967 6974  (arr).    ndigit
-00000b30: 7320 3d20 726f 756e 6428 2d6d 6174 682e  s = round(-math.
-00000b40: 6c6f 6731 3028 7072 6563 6973 696f 6e29  log10(precision)
-00000b50: 290a 2020 2020 7265 7475 726e 206e 702e  ).    return np.
-00000b60: 6173 636f 6e74 6967 756f 7573 6172 7261  ascontiguousarra
-00000b70: 7928 6172 722e 726f 756e 6428 6e64 6967  y(arr.round(ndig
-00000b80: 6974 7329 202f 2070 7265 6369 7369 6f6e  its) / precision
-00000b90: 2c20 6474 7970 653d 6e70 2e69 6e74 3634  , dtype=np.int64
-00000ba0: 290a 0a0a 636c 6173 7320 436f 6d70 6f6e  )...class Compon
-00000bb0: 656e 7428 5f47 656f 6d65 7472 7948 656c  ent(_GeometryHel
-00000bc0: 7065 7229 3a0a 2020 2020 2222 2241 2043  per):.    """A C
-00000bd0: 6f6d 706f 6e65 6e74 2069 7320 616e 2065  omponent is an e
-00000be0: 6d70 7479 2063 616e 7661 7320 7768 6572  mpty canvas wher
-00000bf0: 6520 796f 7520 6164 6420 706f 6c79 676f  e you add polygo
-00000c00: 6e73 2c20 7265 6665 7265 6e63 6573 2061  ns, references a
-00000c10: 6e64 2070 6f72 7473 205c 0a20 2020 2020  nd ports \.     
-00000c20: 2020 2020 2020 2028 746f 2063 6f6e 6e65         (to conne
-00000c30: 6374 2074 6f20 6f74 6865 7220 636f 6d70  ct to other comp
-00000c40: 6f6e 656e 7473 292e 0a0a 2020 2020 2d20  onents)...    - 
-00000c50: 7374 6f72 6573 2073 6574 7469 6e67 7320  stores settings 
-00000c60: 7468 6174 2079 6f75 2075 7365 2074 6f20  that you use to 
-00000c70: 6275 696c 6420 7468 6520 636f 6d70 6f6e  build the compon
-00000c80: 656e 740a 2020 2020 2d20 7374 6f72 6573  ent.    - stores
-00000c90: 2069 6e66 6f20 7468 6174 2079 6f75 2077   info that you w
-00000ca0: 616e 7420 746f 2075 7365 0a20 2020 202d  ant to use.    -
-00000cb0: 2063 616e 2072 6574 7572 6e20 706f 7274   can return port
-00000cc0: 7320 6279 2074 7970 6520 286f 7074 6963  s by type (optic
-00000cd0: 616c 2c20 656c 6563 7472 6963 616c 202e  al, electrical .
-00000ce0: 2e2e 290a 2020 2020 2d20 6361 6e20 7265  ..).    - can re
-00000cf0: 7475 726e 206e 6574 6c69 7374 2066 6f72  turn netlist for
-00000d00: 2063 6972 6375 6974 2073 696d 756c 6174   circuit simulat
-00000d10: 696f 6e0a 2020 2020 2d20 6361 6e20 7772  ion.    - can wr
-00000d20: 6974 6520 746f 2047 4453 2c20 4f41 5349  ite to GDS, OASI
-00000d30: 530a 2020 2020 2d20 6361 6e20 7368 6f77  S.    - can show
-00000d40: 2069 6e20 4b4c 6179 6f75 742c 206d 6174   in KLayout, mat
-00000d50: 706c 6f74 6c69 622c 2033 442c 2051 5420  plotlib, 3D, QT 
-00000d60: 7669 6577 6572 2c20 686f 6c6f 7669 6577  viewer, holoview
-00000d70: 730a 2020 2020 2d20 6361 6e20 7265 7475  s.    - can retu
-00000d80: 726e 2063 6f70 792c 206d 6972 726f 722c  rn copy, mirror,
-00000d90: 2066 6c61 7474 656e 6564 2028 6e6f 2072   flattened (no r
-00000da0: 6566 6572 656e 6365 7329 0a0a 2020 2020  eferences)..    
-00000db0: 4172 6773 3a0a 2020 2020 2020 2020 6e61  Args:.        na
-00000dc0: 6d65 3a20 636f 6d70 6f6e 656e 745f 6e61  me: component_na
-00000dd0: 6d65 2e20 5573 6520 4063 656c 6c20 6465  me. Use @cell de
-00000de0: 636f 7261 746f 7220 666f 7220 6175 746f  corator for auto
-00000df0: 2d6e 616d 696e 672e 0a20 2020 2020 2020  -naming..       
-00000e00: 2077 6974 685f 7575 6964 3a20 6164 6473   with_uuid: adds
-00000e10: 2075 6e69 7175 6520 6964 656e 7469 6669   unique identifi
-00000e20: 6572 2e0a 0a20 2020 2050 726f 7065 7274  er...    Propert
-00000e30: 6965 733a 0a20 2020 2020 2020 2069 6e66  ies:.        inf
-00000e40: 6f3a 2064 6963 7469 6f6e 6172 7920 7468  o: dictionary th
-00000e50: 6174 2069 6e63 6c75 6465 730a 2020 2020  at includes.    
-00000e60: 2020 2020 2020 2020 2d20 6465 7269 7665          - derive
-00000e70: 6420 7072 6f70 6572 7469 6573 0a20 2020  d properties.   
-00000e80: 2020 2020 2020 2020 202d 2065 7874 6572           - exter
-00000e90: 6e61 6c20 6d65 7461 6461 7461 2028 7465  nal metadata (te
-00000ea0: 7374 5f70 726f 746f 636f 6c2c 2064 6f63  st_protocol, doc
-00000eb0: 732c 202e 2e2e 290a 2020 2020 2020 2020  s, ...).        
-00000ec0: 2020 2020 2d20 7369 6d75 6c61 7469 6f6e      - simulation
-00000ed0: 5f73 6574 7469 6e67 730a 2020 2020 2020  _settings.      
-00000ee0: 2020 2020 2020 2d20 6675 6e63 7469 6f6e        - function
-00000ef0: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
-00000f00: 2020 2d20 6e61 6d65 3a20 666f 7220 7468    - name: for th
-00000f10: 6520 636f 6d70 6f6e 656e 740a 0a20 2020  e component..   
-00000f20: 2020 2020 2073 6574 7469 6e67 733a 0a20       settings:. 
-00000f30: 2020 2020 2020 2020 2020 2066 756c 6c3a             full:
-00000f40: 2066 756c 6c20 7365 7474 696e 6773 2070   full settings p
-00000f50: 6173 7365 6420 746f 2074 6865 2066 756e  assed to the fun
-00000f60: 6374 696f 6e20 746f 2063 7265 6174 6520  ction to create 
-00000f70: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
-00000f80: 2020 2020 2020 2063 6861 6e67 6564 3a20         changed: 
-00000f90: 6368 616e 6765 6420 7365 7474 696e 6773  changed settings
-00000fa0: 2e0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00000fb0: 6661 756c 743a 2064 6566 6175 6c74 2063  fault: default c
-00000fc0: 6f6d 706f 6e65 6e74 2073 6574 7469 6e67  omponent setting
-00000fd0: 732e 0a20 2020 2020 2020 2020 2020 2063  s..            c
-00000fe0: 6869 6c64 3a20 6469 6374 2069 6e66 6f20  hild: dict info 
-00000ff0: 6672 6f6d 2074 6865 2063 6869 6c64 7265  from the childre
-00001000: 6e2c 2069 6620 616e 792e 0a20 2020 2022  n, if any..    "
-00001010: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00001020: 6974 5f5f 280a 2020 2020 2020 2020 7365  it__(.        se
-00001030: 6c66 2c0a 2020 2020 2020 2020 6e61 6d65  lf,.        name
-00001040: 3a20 7374 7220 3d20 2255 6e6e 616d 6564  : str = "Unnamed
-00001050: 222c 0a20 2020 2020 2020 2077 6974 685f  ",.        with_
-00001060: 7575 6964 3a20 626f 6f6c 203d 2046 616c  uuid: bool = Fal
-00001070: 7365 2c0a 2020 2020 2920 2d3e 204e 6f6e  se,.    ) -> Non
-00001080: 653a 0a20 2020 2020 2020 2022 2222 496e  e:.        """In
-00001090: 6974 6961 6c69 7a65 2074 6865 2043 6f6d  itialize the Com
-000010a0: 706f 6e65 6e74 206f 626a 6563 742e 2222  ponent object.""
-000010b0: 220a 2020 2020 2020 2020 7365 6c66 2e75  ".        self.u
-000010c0: 6964 203d 2073 7472 2875 7569 642e 7575  id = str(uuid.uu
-000010d0: 6964 3428 2929 5b3a 385d 0a20 2020 2020  id4())[:8].     
-000010e0: 2020 2069 6620 7769 7468 5f75 7569 6420     if with_uuid 
-000010f0: 6f72 206e 616d 6520 3d3d 2022 556e 6e61  or name == "Unna
-00001100: 6d65 6422 3a0a 2020 2020 2020 2020 2020  med":.          
-00001110: 2020 6e61 6d65 202b 3d20 6622 5f7b 7365    name += f"_{se
-00001120: 6c66 2e75 6964 7d22 0a0a 2020 2020 2020  lf.uid}"..      
-00001130: 2020 7365 6c66 2e5f 6365 6c6c 203d 2067    self._cell = g
-00001140: 6473 746b 2e43 656c 6c28 6e61 6d65 3d6e  dstk.Cell(name=n
-00001150: 616d 6529 0a20 2020 2020 2020 2073 656c  ame).        sel
-00001160: 662e 6e61 6d65 203d 206e 616d 650a 2020  f.name = name.  
-00001170: 2020 2020 2020 7365 6c66 2e69 6e66 6f3a        self.info:
-00001180: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
-00001190: 3d20 7b7d 0a0a 2020 2020 2020 2020 7365  = {}..        se
-000011a0: 6c66 2e73 6574 7469 6e67 733a 2044 6963  lf.settings: Dic
-000011b0: 745b 7374 722c 2041 6e79 5d20 3d20 7b7d  t[str, Any] = {}
-000011c0: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-000011d0: 6f63 6b65 6420 3d20 4661 6c73 650a 2020  ocked = False.  
-000011e0: 2020 2020 2020 7365 6c66 2e67 6574 5f63        self.get_c
-000011f0: 6869 6c64 5f6e 616d 6520 3d20 4661 6c73  hild_name = Fals
-00001200: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-00001210: 7265 6665 7265 6e63 655f 6e61 6d65 735f  reference_names_
-00001220: 636f 756e 7465 7220 3d20 436f 756e 7465  counter = Counte
-00001230: 7228 290a 2020 2020 2020 2020 7365 6c66  r().        self
-00001240: 2e5f 7265 6665 7265 6e63 655f 6e61 6d65  ._reference_name
-00001250: 735f 7573 6564 203d 2073 6574 2829 0a20  s_used = set(). 
-00001260: 2020 2020 2020 2073 656c 662e 5f6e 616d         self._nam
-00001270: 6564 5f72 6566 6572 656e 6365 7320 3d20  ed_references = 
-00001280: 7b7d 0a20 2020 2020 2020 2073 656c 662e  {}.        self.
-00001290: 5f72 6566 6572 656e 6365 7320 3d20 5b5d  _references = []
-000012a0: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-000012b0: 6f72 7473 203d 207b 7d0a 0a20 2020 2040  orts = {}..    @
-000012c0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-000012d0: 2072 6566 6572 656e 6365 7328 7365 6c66   references(self
-000012e0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000012f0: 6e20 7365 6c66 2e5f 7265 6665 7265 6e63  n self._referenc
-00001300: 6573 0a0a 2020 2020 4070 726f 7065 7274  es..    @propert
-00001310: 790a 2020 2020 6465 6620 706f 6c79 676f  y.    def polygo
-00001320: 6e73 2873 656c 6629 202d 3e20 4c69 7374  ns(self) -> List
-00001330: 5b50 6f6c 7967 6f6e 5d3a 0a20 2020 2020  [Polygon]:.     
-00001340: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00001350: 6365 6c6c 2e70 6f6c 7967 6f6e 730a 0a20  cell.polygons.. 
-00001360: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00001370: 2064 6566 2061 7265 6128 7365 6c66 2920   def area(self) 
-00001380: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
-00001390: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
-000013a0: 656c 6c2e 6172 6561 0a0a 2020 2020 4070  ell.area..    @p
-000013b0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-000013c0: 6c61 6265 6c73 2873 656c 6629 202d 3e20  labels(self) -> 
-000013d0: 4c69 7374 5b4c 6162 656c 5d3a 0a20 2020  List[Label]:.   
-000013e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000013f0: 2e5f 6365 6c6c 2e6c 6162 656c 730a 0a20  ._cell.labels.. 
-00001400: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00001410: 2064 6566 2070 6174 6873 2873 656c 6629   def paths(self)
-00001420: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00001430: 2073 656c 662e 5f63 656c 6c2e 7061 7468   self._cell.path
-00001440: 730a 0a20 2020 2040 7072 6f70 6572 7479  s..    @property
-00001450: 0a20 2020 2064 6566 206e 616d 6528 7365  .    def name(se
-00001460: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
-00001470: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00001480: 5f63 656c 6c2e 6e61 6d65 0a0a 2020 2020  _cell.name..    
-00001490: 406e 616d 652e 7365 7474 6572 0a20 2020  @name.setter.   
-000014a0: 2064 6566 206e 616d 6528 7365 6c66 2c20   def name(self, 
-000014b0: 7661 6c75 6529 202d 3e20 4e6f 6e65 3a0a  value) -> None:.
-000014c0: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
-000014d0: 6c6c 2e6e 616d 6520 3d20 7661 6c75 650a  ll.name = value.
-000014e0: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
-000014f0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00001500: 2022 2222 596f 7520 6361 6e20 6974 6572   """You can iter
-00001510: 6174 6520 6f76 6572 2070 6f6c 7967 6f6e  ate over polygon
-00001520: 732c 2070 6174 6873 2c20 6c61 6265 6c73  s, paths, labels
-00001530: 2061 6e64 2072 6566 6572 656e 6365 732e   and references.
-00001540: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00001550: 726e 2069 7465 7274 6f6f 6c73 2e63 6861  rn itertools.cha
-00001560: 696e 2873 656c 662e 706f 6c79 676f 6e73  in(self.polygons
-00001570: 2c20 7365 6c66 2e70 6174 6873 2c20 7365  , self.paths, se
-00001580: 6c66 2e6c 6162 656c 732c 2073 656c 662e  lf.labels, self.
-00001590: 7265 6665 7265 6e63 6573 290a 0a20 2020  references)..   
-000015a0: 2064 6566 2067 6574 5f70 6f6c 7967 6f6e   def get_polygon
-000015b0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-000015c0: 0a20 2020 2020 2020 2062 795f 7370 6563  .        by_spec
-000015d0: 3a20 556e 696f 6e5b 626f 6f6c 2c20 5475  : Union[bool, Tu
-000015e0: 706c 655b 696e 742c 2069 6e74 5d5d 203d  ple[int, int]] =
-000015f0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00001600: 6465 7074 683a 204f 7074 696f 6e61 6c5b  depth: Optional[
-00001610: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-00001620: 2020 2020 2069 6e63 6c75 6465 5f70 6174       include_pat
-00001630: 6873 3a20 626f 6f6c 203d 2054 7275 652c  hs: bool = True,
-00001640: 0a20 2020 2020 2020 2061 735f 6172 7261  .        as_arra
-00001650: 793a 2062 6f6f 6c20 3d20 5472 7565 2c0a  y: bool = True,.
-00001660: 2020 2020 2920 2d3e 2055 6e69 6f6e 5b4c      ) -> Union[L
-00001670: 6973 745b 506f 6c79 676f 6e5d 2c20 4469  ist[Polygon], Di
-00001680: 6374 5b54 7570 6c65 5b69 6e74 2c20 696e  ct[Tuple[int, in
-00001690: 745d 2c20 4c69 7374 5b50 6f6c 7967 6f6e  t], List[Polygon
-000016a0: 5d5d 5d3a 0a20 2020 2020 2020 2022 2222  ]]]:.        """
-000016b0: 5265 7475 726e 2061 206c 6973 7420 6f66  Return a list of
-000016c0: 2070 6f6c 7967 6f6e 7320 696e 2074 6869   polygons in thi
-000016d0: 7320 6365 6c6c 2e0a 0a20 2020 2020 2020  s cell...       
-000016e0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-000016f0: 2020 2062 795f 7370 6563 3a20 626f 6f6c     by_spec: bool
-00001700: 206f 7220 6c61 7965 720a 2020 2020 2020   or layer.      
-00001710: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00001720: 652c 2074 6865 2072 6574 7572 6e20 7661  e, the return va
-00001730: 6c75 6520 6973 2061 2064 6963 7469 6f6e  lue is a diction
-00001740: 6172 7920 7769 7468 2074 6865 0a20 2020  ary with the.   
-00001750: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-00001760: 7967 6f6e 7320 6f66 2065 6163 6820 696e  ygons of each in
-00001770: 6469 7669 6475 616c 2070 6169 7220 286c  dividual pair (l
-00001780: 6179 6572 2c20 6461 7461 7479 7065 292c  ayer, datatype),
-00001790: 2077 6869 6368 0a20 2020 2020 2020 2020   which.         
-000017a0: 2020 2020 2020 2061 7265 2075 7365 6420         are used 
-000017b0: 6173 206b 6579 732e 2020 4966 2073 6574  as keys.  If set
-000017c0: 2074 6f20 6120 7475 706c 6520 6f66 2028   to a tuple of (
-000017d0: 6c61 7965 722c 2064 6174 6174 7970 6529  layer, datatype)
-000017e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000017f0: 2020 6f6e 6c79 2070 6f6c 7967 6f6e 7320    only polygons 
-00001800: 7769 7468 2074 6861 7420 7370 6563 6966  with that specif
-00001810: 6963 6174 696f 6e20 6172 6520 7265 7475  ication are retu
-00001820: 726e 6564 2e0a 2020 2020 2020 2020 2020  rned..          
-00001830: 2020 6465 7074 683a 2069 6e74 6567 6572    depth: integer
-00001840: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-00001850: 2020 2020 2020 2020 2049 6620 6e6f 7420           If not 
-00001860: 4e6f 6e65 2c20 6465 6669 6e65 7320 6672  None, defines fr
-00001870: 6f6d 2068 6f77 206d 616e 7920 7265 6665  om how many refe
-00001880: 7265 6e63 6520 6c65 7665 6c73 2074 6f0a  rence levels to.
-00001890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018a0: 7265 7472 6965 7665 2070 6f6c 7967 6f6e  retrieve polygon
-000018b0: 732e 2020 5265 6665 7265 6e63 6573 2062  s.  References b
-000018c0: 656c 6f77 2074 6869 7320 6c65 7665 6c20  elow this level 
-000018d0: 7769 6c6c 2072 6573 756c 740a 2020 2020  will result.    
-000018e0: 2020 2020 2020 2020 2020 2020 696e 2061              in a
-000018f0: 2062 6f75 6e64 696e 6720 626f 782e 2020   bounding box.  
-00001900: 4966 2060 6279 5f73 7065 6360 2069 7320  If `by_spec` is 
-00001910: 5472 7565 2074 6865 206b 6579 2077 696c  True the key wil
-00001920: 6c20 6265 2074 6865 0a20 2020 2020 2020  l be the.       
-00001930: 2020 2020 2020 2020 206e 616d 6520 6f66           name of
-00001940: 2074 6869 7320 6365 6c6c 2e0a 2020 2020   this cell..    
-00001950: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-00001960: 7061 7468 733a 2049 6620 5472 7565 2c20  paths: If True, 
-00001970: 706f 6c79 676f 6e61 6c20 7265 7072 6573  polygonal repres
-00001980: 656e 7461 7469 6f6e 206f 6620 7061 7468  entation of path
-00001990: 7320 6172 6520 616c 736f 2069 6e63 6c75  s are also inclu
-000019a0: 6465 6420 696e 2074 6865 2072 6573 756c  ded in the resul
-000019b0: 742e 0a20 2020 2020 2020 2020 2020 2061  t..            a
-000019c0: 735f 6172 7261 793a 2077 6865 6e20 6173  s_array: when as
-000019d0: 5f61 7272 6179 3d66 616c 7365 2c20 7265  _array=false, re
-000019e0: 7475 726e 2074 6865 2050 6f6c 7967 6f6e  turn the Polygon
-000019f0: 206f 626a 6563 7473 2069 6e73 7465 6164   objects instead
-00001a00: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001a10: 2020 706f 6c79 676f 6e20 6f62 6a65 6374    polygon object
-00001a20: 7320 6861 7665 206d 6f72 6520 696e 666f  s have more info
-00001a30: 726d 6174 696f 6e20 2865 7370 6563 6961  rmation (especia
-00001a40: 6c6c 7920 7768 656e 2062 795f 7370 6563  lly when by_spec
-00001a50: 3d46 616c 7365 2920 616e 6420 6172 6520  =False) and are 
-00001a60: 6661 7374 6572 2074 6f20 7265 7472 6965  faster to retrie
-00001a70: 7665 2e0a 0a20 2020 2020 2020 2052 6574  ve...        Ret
-00001a80: 7572 6e73 0a20 2020 2020 2020 2020 2020  urns.           
-00001a90: 206f 7574 3a20 6c69 7374 206f 6620 6172   out: list of ar
-00001aa0: 7261 792d 6c69 6b65 5b4e 5d5b 325d 206f  ray-like[N][2] o
-00001ab0: 7220 6469 6374 696f 6e61 7279 0a20 2020  r dictionary.   
-00001ac0: 2020 2020 2020 2020 2020 2020 204c 6973               Lis
-00001ad0: 7420 636f 6e74 6169 6e69 6e67 2074 6865  t containing the
-00001ae0: 2063 6f6f 7264 696e 6174 6573 206f 6620   coordinates of 
-00001af0: 7468 6520 7665 7274 6963 6573 206f 6620  the vertices of 
-00001b00: 6561 6368 0a20 2020 2020 2020 2020 2020  each.           
-00001b10: 2020 2020 2070 6f6c 7967 6f6e 2c20 6f72       polygon, or
-00001b20: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
-00001b30: 2077 6974 6820 7468 6520 6c69 7374 206f   with the list o
-00001b40: 6620 706f 6c79 676f 6e73 2028 6966 0a20  f polygons (if. 
-00001b50: 2020 2020 2020 2020 2020 2020 2020 2060                 `
-00001b60: 6279 5f73 7065 6360 2069 7320 5472 7565  by_spec` is True
-00001b70: 292e 0a0a 2020 2020 2020 2020 4e6f 7465  )...        Note
-00001b80: 3a0a 2020 2020 2020 2020 2020 2020 496e  :.            In
-00001b90: 7374 616e 6365 7320 6f66 2060 466c 6578  stances of `Flex
-00001ba0: 5061 7468 6020 616e 6420 6052 6f62 7573  Path` and `Robus
-00001bb0: 7450 6174 6860 2061 7265 2061 6c73 6f20  tPath` are also 
-00001bc0: 696e 636c 7564 6564 2069 6e0a 2020 2020  included in.    
-00001bd0: 2020 2020 2020 2020 7468 6520 7265 7375          the resu
-00001be0: 6c74 2062 7920 636f 6d70 7574 696e 6720  lt by computing 
-00001bf0: 7468 6569 7220 706f 6c79 676f 6e61 6c20  their polygonal 
-00001c00: 626f 756e 6461 7279 2e0a 2020 2020 2020  boundary..      
-00001c10: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00001c20: 7475 726e 2067 6574 5f70 6f6c 7967 6f6e  turn get_polygon
-00001c30: 7328 0a20 2020 2020 2020 2020 2020 2069  s(.            i
-00001c40: 6e73 7461 6e63 653d 7365 6c66 2c0a 2020  nstance=self,.  
-00001c50: 2020 2020 2020 2020 2020 6279 5f73 7065            by_spe
-00001c60: 633d 6279 5f73 7065 632c 0a20 2020 2020  c=by_spec,.     
-00001c70: 2020 2020 2020 2064 6570 7468 3d64 6570         depth=dep
-00001c80: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00001c90: 696e 636c 7564 655f 7061 7468 733d 696e  include_paths=in
-00001ca0: 636c 7564 655f 7061 7468 732c 0a20 2020  clude_paths,.   
-00001cb0: 2020 2020 2020 2020 2061 735f 6172 7261           as_arra
-00001cc0: 793d 6173 5f61 7272 6179 2c0a 2020 2020  y=as_array,.    
-00001cd0: 2020 2020 290a 0a20 2020 2064 6566 2067      )..    def g
-00001ce0: 6574 5f64 6570 656e 6465 6e63 6965 7328  et_dependencies(
-00001cf0: 7365 6c66 2c20 7265 6375 7273 6976 653a  self, recursive:
-00001d00: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
-00001d10: 3e20 4c69 7374 5b43 6f6d 706f 6e65 6e74  > List[Component
-00001d20: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
-00001d30: 7475 726e 2061 206c 6973 7420 6f66 2043  turn a list of C
-00001d40: 6f6d 706f 6e65 6e74 7320 7265 6665 7265  omponents refere
-00001d50: 6e63 6564 2062 7920 7468 6973 2043 6f6d  nced by this Com
-00001d60: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00001d70: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00001d80: 2020 2072 6563 7572 7369 7665 3a20 4966     recursive: If
-00001d90: 2054 7275 6520 7265 7475 726e 7320 6465   True returns de
-00001da0: 7065 6e64 656e 6369 6573 2072 6563 7572  pendencies recur
-00001db0: 7369 7665 6c79 2e0a 0a20 2020 2020 2020  sively...       
-00001dc0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00001dd0: 6e6f 7420 7265 6375 7273 6976 653a 0a20  not recursive:. 
-00001de0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00001df0: 6e20 6c69 7374 287b 7265 662e 7061 7265  n list({ref.pare
-00001e00: 6e74 2066 6f72 2072 6566 2069 6e20 7365  nt for ref in se
-00001e10: 6c66 2e72 6566 6572 656e 6365 737d 290a  lf.references}).
-00001e20: 0a20 2020 2020 2020 2072 6566 6572 656e  .        referen
-00001e30: 6365 735f 7365 7420 3d20 7365 7428 290a  ces_set = set().
-00001e40: 2020 2020 2020 2020 5f67 6574 5f64 6570          _get_dep
-00001e50: 656e 6465 6e63 6965 7328 7365 6c66 2c20  endencies(self, 
-00001e60: 7265 6665 7265 6e63 6573 5f73 6574 3d72  references_set=r
-00001e70: 6566 6572 656e 6365 735f 7365 7429 0a20  eferences_set). 
-00001e80: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
-00001e90: 7374 2872 6566 6572 656e 6365 735f 7365  st(references_se
-00001ea0: 7429 0a0a 2020 2020 6465 6620 6765 745f  t)..    def get_
-00001eb0: 636f 6d70 6f6e 656e 745f 7370 6563 2873  component_spec(s
-00001ec0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00001ed0: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
-00001ee0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-00001ef0: 2020 2020 2022 636f 6d70 6f6e 656e 7422       "component"
-00001f00: 3a20 7365 6c66 2e73 6574 7469 6e67 732e  : self.settings.
-00001f10: 6675 6e63 7469 6f6e 5f6e 616d 652c 0a20  function_name,. 
-00001f20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00001f30: 7365 7474 696e 6773 223a 2073 656c 662e  settings": self.
-00001f40: 7365 7474 696e 6773 2e63 6861 6e67 6564  settings.changed
-00001f50: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
-00001f60: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00001f70: 656c 662e 7365 7474 696e 6773 0a20 2020  elf.settings.   
-00001f80: 2020 2020 2020 2020 2065 6c73 6520 7b22           else {"
-00001f90: 636f 6d70 6f6e 656e 7422 3a20 7365 6c66  component": self
-00001fa0: 2e6e 616d 652c 2022 7365 7474 696e 6773  .name, "settings
-00001fb0: 223a 207b 7d7d 0a20 2020 2020 2020 2029  ": {}}.        )
-00001fc0: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
-00001fd0: 7465 6d5f 5f28 7365 6c66 2c20 6b65 7929  tem__(self, key)
-00001fe0: 3a0a 2020 2020 2020 2020 2222 2241 6363  :.        """Acc
-00001ff0: 6573 7320 7265 6665 7265 6e63 6520 706f  ess reference po
-00002000: 7274 732e 2222 220a 2020 2020 2020 2020  rts.""".        
-00002010: 6966 206b 6579 206e 6f74 2069 6e20 7365  if key not in se
-00002020: 6c66 2e70 6f72 7473 3a0a 2020 2020 2020  lf.ports:.      
-00002030: 2020 2020 2020 706f 7274 7320 3d20 6c69        ports = li
-00002040: 7374 2873 656c 662e 706f 7274 732e 6b65  st(self.ports.ke
-00002050: 7973 2829 290a 2020 2020 2020 2020 2020  ys()).          
-00002060: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00002070: 6f72 2866 227b 6b65 7921 727d 206e 6f74  or(f"{key!r} not
-00002080: 2069 6e20 7b70 6f72 7473 7d22 290a 0a20   in {ports}").. 
-00002090: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000020a0: 6c66 2e70 6f72 7473 5b6b 6579 5d0a 0a20  lf.ports[key].. 
-000020b0: 2020 2064 6566 205f 5f6c 7368 6966 745f     def __lshift_
-000020c0: 5f28 7365 6c66 2c20 656c 656d 656e 7429  _(self, element)
-000020d0: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
-000020e0: 7665 6e69 656e 6365 206f 7065 7261 746f  venience operato
-000020f0: 7220 6571 7569 7661 6c65 6e74 2074 6f20  r equivalent to 
-00002100: 6164 645f 7265 6628 292e 2222 220a 2020  add_ref().""".  
-00002110: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00002120: 662e 6164 645f 7265 6628 656c 656d 656e  f.add_ref(elemen
-00002130: 7429 0a0a 2020 2020 6465 6620 756e 6c6f  t)..    def unlo
-00002140: 636b 2873 656c 6629 202d 3e20 4e6f 6e65  ck(self) -> None
-00002150: 3a0a 2020 2020 2020 2020 2222 224f 6e6c  :.        """Onl
-00002160: 7920 646f 2074 6869 7320 6966 2079 6f75  y do this if you
-00002170: 206b 6e6f 7720 7768 6174 2079 6f75 2061   know what you a
-00002180: 7265 2064 6f69 6e67 2e22 2222 0a20 2020  re doing.""".   
-00002190: 2020 2020 2073 656c 662e 5f6c 6f63 6b65       self._locke
-000021a0: 6420 3d20 4661 6c73 650a 0a20 2020 2064  d = False..    d
-000021b0: 6566 206c 6f63 6b28 7365 6c66 2920 2d3e  ef lock(self) ->
-000021c0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000021d0: 2222 4d61 6b65 7320 7375 7265 2063 6f6d  ""Makes sure com
-000021e0: 706f 6e65 6e74 7320 6361 6e27 7420 6164  ponents can't ad
-000021f0: 6420 6e65 7720 656c 656d 656e 7473 206f  d new elements o
-00002200: 7220 6d6f 7665 2065 7869 7374 696e 6720  r move existing 
-00002210: 6f6e 6573 2e0a 0a20 2020 2020 2020 2043  ones...        C
-00002220: 6f6d 706f 6e65 6e74 7320 6c6f 636b 2061  omponents lock a
-00002230: 7574 6f6d 6174 6963 616c 6c79 2077 6865  utomatically whe
-00002240: 6e20 676f 696e 6720 696e 746f 2074 6865  n going into the
-00002250: 2043 4143 4845 2074 6f0a 2020 2020 2020   CACHE to.      
-00002260: 2020 656e 7375 7265 206f 6e65 2063 6f6d    ensure one com
-00002270: 706f 6e65 6e74 2064 6f65 7320 6e6f 7420  ponent does not 
-00002280: 6368 616e 6765 206f 7468 6572 730a 2020  change others.  
-00002290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000022a0: 2020 7365 6c66 2e5f 6c6f 636b 6564 203d    self._locked =
-000022b0: 2054 7275 650a 0a20 2020 2064 6566 205f   True..    def _
-000022c0: 5f73 6574 6974 656d 5f5f 2873 656c 662c  _setitem__(self,
-000022d0: 206b 6579 2c20 656c 656d 656e 7429 3a0a   key, element):.
-000022e0: 2020 2020 2020 2020 2222 2241 6c6c 6f77          """Allow
-000022f0: 2061 6464 696e 6720 706f 6c79 676f 6e73   adding polygons
-00002300: 2061 6e64 2063 656c 6c20 7265 6665 7265   and cell refere
-00002310: 6e63 6573 2e0a 0a20 2020 2020 2020 206c  nces...        l
-00002320: 696b 6520 445b 2761 7263 3327 5d20 3d20  ike D['arc3'] = 
-00002330: 7067 2e61 7263 2829 0a0a 2020 2020 2020  pg.arc()..      
-00002340: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00002350: 2020 2020 6b65 793a 2041 6c69 6173 206e      key: Alias n
-00002360: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-00002370: 2065 6c65 6d65 6e74 3a20 4f62 6a65 6374   element: Object
-00002380: 2074 6861 7420 7769 6c6c 2062 6520 6163   that will be ac
-00002390: 6365 7373 6962 6c65 2062 7920 616c 6961  cessible by alia
-000023a0: 7320 6e61 6d65 2e0a 0a20 2020 2020 2020  s name...       
-000023b0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-000023c0: 6973 696e 7374 616e 6365 2865 6c65 6d65  isinstance(eleme
-000023d0: 6e74 2c20 2843 6f6d 706f 6e65 6e74 5265  nt, (ComponentRe
-000023e0: 6665 7265 6e63 652c 2050 6f6c 7967 6f6e  ference, Polygon
-000023f0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-00002400: 7365 6c66 2e6e 616d 6564 5f72 6566 6572  self.named_refer
-00002410: 656e 6365 735b 6b65 795d 203d 2065 6c65  ences[key] = ele
-00002420: 6d65 6e74 0a20 2020 2020 2020 2065 6c73  ment.        els
-00002430: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00002440: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00002450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002460: 2066 2254 7269 6564 2074 6f20 6173 7369   f"Tried to assi
-00002470: 676e 2061 6c69 6173 207b 6b65 7921 727d  gn alias {key!r}
-00002480: 2069 6e20 436f 6d70 6f6e 656e 7420 7b73   in Component {s
-00002490: 656c 662e 6e61 6d65 2172 7d2c 220a 2020  elf.name!r},".  
-000024a0: 2020 2020 2020 2020 2020 2020 2020 2262                "b
-000024b0: 7574 2066 6169 6c65 6420 6265 6361 7573  ut failed becaus
-000024c0: 6520 7468 6520 6974 656d 2077 6173 206e  e the item was n
-000024d0: 6f74 2061 2043 6f6d 706f 6e65 6e74 5265  ot a ComponentRe
-000024e0: 6665 7265 6e63 6522 0a20 2020 2020 2020  ference".       
-000024f0: 2020 2020 2029 0a0a 2020 2020 4063 6c61       )..    @cla
-00002500: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00002510: 205f 5f67 6574 5f76 616c 6964 6174 6f72   __get_validator
-00002520: 735f 5f28 636c 7329 3a0a 2020 2020 2020  s__(cls):.      
-00002530: 2020 2222 2247 6574 2076 616c 6964 6174    """Get validat
-00002540: 6f72 7320 666f 7220 7468 6520 436f 6d70  ors for the Comp
-00002550: 6f6e 656e 7420 6f62 6a65 6374 2e22 2222  onent object."""
-00002560: 0a20 2020 2020 2020 2079 6965 6c64 2063  .        yield c
-00002570: 6c73 2e76 616c 6964 6174 650a 0a20 2020  ls.validate..   
-00002580: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00002590: 2020 6465 6620 7661 6c69 6461 7465 2863    def validate(c
-000025a0: 6c73 2c20 7629 3a0a 2020 2020 2020 2020  ls, v):.        
-000025b0: 2222 2250 7964 616e 7469 6320 6173 7375  """Pydantic assu
-000025c0: 6d65 7320 636f 6d70 6f6e 656e 7420 6973  mes component is
-000025d0: 2076 616c 6964 2069 6620 7468 6520 666f   valid if the fo
-000025e0: 6c6c 6f77 696e 6720 6172 6520 7472 7565  llowing are true
-000025f0: 2e0a 0a20 2020 2020 2020 202d 206e 616d  ...        - nam
-00002600: 6520 6368 6172 6163 7465 7273 203c 204d  e characters < M
-00002610: 4158 5f4e 414d 455f 4c45 4e47 5448 0a20  AX_NAME_LENGTH. 
-00002620: 2020 2020 2020 202d 2069 7320 6e6f 7420         - is not 
-00002630: 656d 7074 7920 2868 6173 2072 6566 6572  empty (has refer
-00002640: 656e 6365 7320 6f72 2070 6f6c 7967 6f6e  ences or polygon
-00002650: 7329 0a20 2020 2020 2020 2022 2222 0a20  s).        """. 
-00002660: 2020 2020 2020 204d 4158 5f4e 414d 455f         MAX_NAME_
-00002670: 4c45 4e47 5448 203d 2039 390a 2020 2020  LENGTH = 99.    
-00002680: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
-00002690: 7461 6e63 6528 0a20 2020 2020 2020 2020  tance(.         
-000026a0: 2020 2076 2c20 436f 6d70 6f6e 656e 740a     v, Component.
-000026b0: 2020 2020 2020 2020 292c 2066 2254 7970          ), f"Typ
-000026c0: 6545 7272 6f72 2c20 476f 7420 7b74 7970  eError, Got {typ
-000026d0: 6528 7629 7d2c 2065 7870 6563 7469 6e67  e(v)}, expecting
-000026e0: 2043 6f6d 706f 6e65 6e74 220a 2020 2020   Component".    
-000026f0: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
-00002700: 2020 2020 2020 2020 206c 656e 2876 2e6e           len(v.n
-00002710: 616d 6529 203c 3d20 4d41 585f 4e41 4d45  ame) <= MAX_NAME
-00002720: 5f4c 454e 4754 480a 2020 2020 2020 2020  _LENGTH.        
-00002730: 292c 2066 226e 616d 6520 607b 762e 6e61  ), f"name `{v.na
-00002740: 6d65 7d60 207b 6c65 6e28 762e 6e61 6d65  me}` {len(v.name
-00002750: 297d 203e 207b 4d41 585f 4e41 4d45 5f4c  )} > {MAX_NAME_L
-00002760: 454e 4754 487d 2022 0a20 2020 2020 2020  ENGTH} ".       
-00002770: 2072 6574 7572 6e20 760a 0a20 2020 2040   return v..    @
-00002780: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00002790: 206e 616d 6564 5f72 6566 6572 656e 6365   named_reference
-000027a0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-000027b0: 2072 6574 7572 6e20 7365 6c66 2e5f 6e61   return self._na
-000027c0: 6d65 645f 7265 6665 7265 6e63 6573 0a0a  med_references..
-000027d0: 2020 2020 6465 6620 6164 645f 6c61 6265      def add_labe
-000027e0: 6c28 0a20 2020 2020 2020 2073 656c 662c  l(.        self,
-000027f0: 0a20 2020 2020 2020 2074 6578 743a 2073  .        text: s
-00002800: 7472 203d 2022 6865 6c6c 6f22 2c0a 2020  tr = "hello",.  
-00002810: 2020 2020 2020 706f 7369 7469 6f6e 3a20        position: 
-00002820: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
-00002830: 6174 5d20 3d20 2830 2e30 2c20 302e 3029  at] = (0.0, 0.0)
-00002840: 2c0a 2020 2020 2020 2020 6d61 676e 6966  ,.        magnif
-00002850: 6963 6174 696f 6e3a 2066 6c6f 6174 203d  ication: float =
-00002860: 2031 2e30 2c0a 2020 2020 2020 2020 726f   1.0,.        ro
-00002870: 7461 7469 6f6e 3a20 666c 6f61 7420 3d20  tation: float = 
-00002880: 302c 0a20 2020 2020 2020 2061 6e63 686f  0,.        ancho
-00002890: 723a 2073 7472 203d 2022 6f22 2c0a 2020  r: str = "o",.  
-000028a0: 2020 2020 2020 6c61 7965 723d 2254 4558        layer="TEX
-000028b0: 5422 2c0a 2020 2020 2020 2020 785f 7265  T",.        x_re
-000028c0: 666c 6563 7469 6f6e 3d46 616c 7365 2c0a  flection=False,.
-000028d0: 2020 2020 2920 2d3e 204c 6162 656c 3a0a      ) -> Label:.
-000028e0: 2020 2020 2020 2020 2222 2241 6464 7320          """Adds 
-000028f0: 4c61 6265 6c20 746f 2074 6865 2043 6f6d  Label to the Com
-00002900: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00002910: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00002920: 2020 2074 6578 743a 204c 6162 656c 2074     text: Label t
-00002930: 6578 742e 0a20 2020 2020 2020 2020 2020  ext..           
-00002940: 2070 6f73 6974 696f 6e3a 2078 2d2c 2079   position: x-, y
-00002950: 2d63 6f6f 7264 696e 6174 6573 206f 6620  -coordinates of 
-00002960: 7468 6520 4c61 6265 6c20 6c6f 6361 7469  the Label locati
-00002970: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00002980: 6d61 676e 6966 6963 6174 696f 6e3a 204d  magnification: M
-00002990: 6167 6e69 6669 6361 7469 6f6e 2066 6163  agnification fac
-000029a0: 746f 7220 666f 7220 7468 6520 4c61 6265  tor for the Labe
-000029b0: 6c20 7465 7874 2e0a 2020 2020 2020 2020  l text..        
-000029c0: 2020 2020 726f 7461 7469 6f6e 3a20 416e      rotation: An
-000029d0: 676c 6520 726f 7461 7469 6f6e 206f 6620  gle rotation of 
-000029e0: 7468 6520 4c61 6265 6c20 7465 7874 2e0a  the Label text..
-000029f0: 2020 2020 2020 2020 2020 2020 616e 6368              anch
-00002a00: 6f72 3a20 7b27 6e27 2c20 2765 272c 2027  or: {'n', 'e', '
-00002a10: 7327 2c20 2777 272c 2027 6f27 2c20 276e  s', 'w', 'o', 'n
-00002a20: 6527 2c20 276e 7727 2c20 2e2e 2e7d 0a20  e', 'nw', ...}. 
-00002a30: 2020 2020 2020 2020 2020 2020 2020 2050                 P
-00002a40: 6f73 6974 696f 6e20 6f66 2074 6865 2061  osition of the a
-00002a50: 6e63 686f 7220 7265 6c61 7469 7665 2074  nchor relative t
-00002a60: 6f20 7468 6520 7465 7874 2e0a 2020 2020  o the text..    
-00002a70: 2020 2020 2020 2020 6c61 7965 723a 2053          layer: S
-00002a80: 7065 6369 6669 6320 6c61 7965 7228 7329  pecific layer(s)
-00002a90: 2074 6f20 7075 7420 4c61 6265 6c20 6f6e   to put Label on
-00002aa0: 2e0a 2020 2020 2020 2020 2020 2020 785f  ..            x_
-00002ab0: 7265 666c 6563 7469 6f6e 3a20 5472 7565  reflection: True
-00002ac0: 2072 6566 6c65 6374 7320 6163 726f 7373   reflects across
-00002ad0: 2074 6865 2068 6f72 697a 6f6e 7461 6c20   the horizontal 
-00002ae0: 6178 6973 2062 6566 6f72 6520 726f 7461  axis before rota
-00002af0: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
-00002b00: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
-00002b10: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
-00002b20: 706f 7274 2067 6574 5f6c 6179 6572 0a0a  port get_layer..
-00002b30: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
-00002b40: 6765 745f 6c61 7965 7228 6c61 7965 7229  get_layer(layer)
-00002b50: 0a0a 2020 2020 2020 2020 6764 735f 6c61  ..        gds_la
-00002b60: 7965 722c 2067 6473 5f64 6174 6174 7970  yer, gds_datatyp
-00002b70: 6520 3d20 6c61 7965 720a 0a20 2020 2020  e = layer..     
-00002b80: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00002b90: 616e 6365 2874 6578 742c 2073 7472 293a  ance(text, str):
-00002ba0: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
-00002bb0: 7420 3d20 7465 7874 0a20 2020 2020 2020  t = text.       
-00002bc0: 206c 6162 656c 203d 204c 6162 656c 280a   label = Label(.
-00002bd0: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00002be0: 3d74 6578 742c 0a20 2020 2020 2020 2020  =text,.         
-00002bf0: 2020 206f 7269 6769 6e3d 706f 7369 7469     origin=positi
-00002c00: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00002c10: 616e 6368 6f72 3d61 6e63 686f 722c 0a20  anchor=anchor,. 
-00002c20: 2020 2020 2020 2020 2020 206d 6167 6e69             magni
-00002c30: 6669 6361 7469 6f6e 3d6d 6167 6e69 6669  fication=magnifi
-00002c40: 6361 7469 6f6e 2c0a 2020 2020 2020 2020  cation,.        
-00002c50: 2020 2020 726f 7461 7469 6f6e 3d72 6f74      rotation=rot
-00002c60: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-00002c70: 2020 206c 6179 6572 3d67 6473 5f6c 6179     layer=gds_lay
-00002c80: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00002c90: 7465 7874 7479 7065 3d67 6473 5f64 6174  texttype=gds_dat
-00002ca0: 6174 7970 652c 0a20 2020 2020 2020 2020  atype,.         
-00002cb0: 2020 2078 5f72 6566 6c65 6374 696f 6e3d     x_reflection=
-00002cc0: 785f 7265 666c 6563 7469 6f6e 2c0a 2020  x_reflection,.  
-00002cd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00002ce0: 7365 6c66 2e61 6464 286c 6162 656c 290a  self.add(label).
-00002cf0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-00002d00: 6162 656c 0a0a 2020 2020 4070 726f 7065  abel..    @prope
-00002d10: 7274 790a 2020 2020 6465 6620 6262 6f78  rty.    def bbox
-00002d20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00002d30: 2222 2252 6574 7572 6e73 2074 6865 2062  """Returns the b
-00002d40: 6f75 6e64 696e 6720 626f 7820 6f66 2074  ounding box of t
-00002d50: 6865 2043 6f6d 706f 6e65 6e74 5265 6665  he ComponentRefe
-00002d60: 7265 6e63 652e 0a0a 2020 2020 2020 2020  rence...        
-00002d70: 6974 2073 6e61 7073 2074 6f20 3320 6465  it snaps to 3 de
-00002d80: 6369 6d61 6c73 2069 6e20 756d 2028 302e  cimals in um (0.
-00002d90: 3030 3175 6d20 3d20 316e 6d20 7072 6563  001um = 1nm prec
-00002da0: 6973 696f 6e29 0a20 2020 2020 2020 2022  ision).        "
-00002db0: 2222 0a20 2020 2020 2020 2062 626f 7820  "".        bbox 
-00002dc0: 3d20 7365 6c66 2e5f 6365 6c6c 2e62 6f75  = self._cell.bou
-00002dd0: 6e64 696e 675f 626f 7828 290a 2020 2020  nding_box().    
-00002de0: 2020 2020 6966 2062 626f 7820 6973 204e      if bbox is N
-00002df0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00002e00: 2062 626f 7820 3d20 2828 302c 2030 292c   bbox = ((0, 0),
-00002e10: 2028 302c 2030 2929 0a20 2020 2020 2020   (0, 0)).       
-00002e20: 2072 6574 7572 6e20 6e70 2e72 6f75 6e64   return np.round
-00002e30: 2862 626f 782c 2033 290a 0a20 2020 2040  (bbox, 3)..    @
-00002e40: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00002e50: 2070 6f72 7473 5f6c 6179 6572 2873 656c   ports_layer(sel
-00002e60: 6629 202d 3e20 4469 6374 5b73 7472 2c20  f) -> Dict[str, 
-00002e70: 7374 725d 3a0a 2020 2020 2020 2020 2222  str]:.        ""
-00002e80: 2252 6574 7572 6e73 2061 206d 6170 7069  "Returns a mappi
-00002e90: 6e67 2066 726f 6d20 6c61 7965 7230 5f6c  ng from layer0_l
-00002ea0: 6179 6572 315f 4530 3a20 706f 7274 4e61  ayer1_E0: portNa
-00002eb0: 6d65 2e22 2222 0a20 2020 2020 2020 2072  me.""".        r
-00002ec0: 6574 7572 6e20 6d61 705f 706f 7274 735f  eturn map_ports_
-00002ed0: 6c61 7965 725f 746f 5f6f 7269 656e 7461  layer_to_orienta
-00002ee0: 7469 6f6e 2873 656c 662e 706f 7274 7329  tion(self.ports)
-00002ef0: 0a0a 2020 2020 6465 6620 706f 7274 5f62  ..    def port_b
-00002f00: 795f 6f72 6965 6e74 6174 696f 6e5f 6377  y_orientation_cw
-00002f10: 2873 656c 662c 206b 6579 3a20 7374 722c  (self, key: str,
-00002f20: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00002f30: 2020 2020 2222 2252 6574 7572 6e73 2070      """Returns p
-00002f40: 6f72 7420 6279 2069 6e64 6578 696e 6720  ort by indexing 
-00002f50: 7468 656d 2063 6c6f 636b 7769 7365 2e22  them clockwise."
-00002f60: 2222 0a20 2020 2020 2020 206d 203d 206d  "".        m = m
-00002f70: 6170 5f70 6f72 7473 5f74 6f5f 6f72 6965  ap_ports_to_orie
-00002f80: 6e74 6174 696f 6e5f 6377 2873 656c 662e  ntation_cw(self.
-00002f90: 706f 7274 732c 202a 2a6b 7761 7267 7329  ports, **kwargs)
-00002fa0: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
-00002fb0: 6e6f 7420 696e 206d 3a0a 2020 2020 2020  not in m:.      
-00002fc0: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
-00002fd0: 7272 6f72 2866 227b 6b65 797d 206e 6f74  rror(f"{key} not
-00002fe0: 2069 6e20 7b6c 6973 7428 6d2e 6b65 7973   in {list(m.keys
-00002ff0: 2829 297d 2229 0a20 2020 2020 2020 206b  ())}").        k
-00003000: 6579 3220 3d20 6d5b 6b65 795d 0a20 2020  ey2 = m[key].   
-00003010: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00003020: 2e70 6f72 7473 5b6b 6579 325d 0a0a 2020  .ports[key2]..  
-00003030: 2020 6465 6620 706f 7274 5f62 795f 6f72    def port_by_or
-00003040: 6965 6e74 6174 696f 6e5f 6363 7728 7365  ientation_ccw(se
-00003050: 6c66 2c20 6b65 793a 2073 7472 2c20 2a2a  lf, key: str, **
-00003060: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-00003070: 2022 2222 5265 7475 726e 7320 706f 7274   """Returns port
-00003080: 2062 7920 696e 6465 7869 6e67 2074 6865   by indexing the
-00003090: 6d20 636c 6f63 6b77 6973 652e 2222 220a  m clockwise.""".
-000030a0: 2020 2020 2020 2020 6d20 3d20 6d61 705f          m = map_
-000030b0: 706f 7274 735f 746f 5f6f 7269 656e 7461  ports_to_orienta
-000030c0: 7469 6f6e 5f63 6377 2873 656c 662e 706f  tion_ccw(self.po
-000030d0: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
-000030e0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
-000030f0: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
-00003100: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
-00003110: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
-00003120: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
-00003130: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
-00003140: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
-00003150: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
-00003160: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
-00003170: 6465 6620 6765 745f 706f 7274 735f 7873  def get_ports_xs
-00003180: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
-00003190: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
-000031a0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-000031b0: 2078 6469 7374 616e 6365 2066 726f 6d20   xdistance from 
-000031c0: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
-000031d0: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
-000031e0: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-000031f0: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
-00003200: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
-00003210: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00003220: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
-00003230: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-00003240: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
-00003250: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
-00003260: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
-00003270: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
-00003280: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
-00003290: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
-000032a0: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
-000032b0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
-000032c0: 745f 7479 7065 3a20 6f70 7469 6361 6c2c  t_type: optical,
-000032d0: 2065 6c65 6374 7269 6361 6c2c 202e 2e2e   electrical, ...
-000032e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000032f0: 2020 2020 2070 6f72 7473 5f63 7720 3d20       ports_cw = 
-00003300: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
-00003310: 6973 7428 636c 6f63 6b77 6973 653d 5472  ist(clockwise=Tr
-00003320: 7565 2c20 2a2a 6b77 6172 6773 290a 2020  ue, **kwargs).  
-00003330: 2020 2020 2020 706f 7274 735f 6363 7720        ports_ccw 
-00003340: 3d20 7365 6c66 2e67 6574 5f70 6f72 7473  = self.get_ports
-00003350: 5f6c 6973 7428 636c 6f63 6b77 6973 653d  _list(clockwise=
-00003360: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
-00003370: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003380: 736e 6170 5f74 6f5f 6772 6964 2870 6f72  snap_to_grid(por
-00003390: 7473 5f63 6377 5b30 5d2e 7820 2d20 706f  ts_ccw[0].x - po
-000033a0: 7274 735f 6377 5b30 5d2e 7829 0a0a 2020  rts_cw[0].x)..  
-000033b0: 2020 6465 6620 6765 745f 706f 7274 735f    def get_ports_
-000033c0: 7973 697a 6528 7365 6c66 2c20 2a2a 6b77  ysize(self, **kw
-000033d0: 6172 6773 2920 2d3e 2066 6c6f 6174 3a0a  args) -> float:.
-000033e0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-000033f0: 6e73 2079 6469 7374 616e 6365 2066 726f  ns ydistance fro
-00003400: 6d20 6561 7374 2074 6f20 7765 7374 2070  m east to west p
-00003410: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
-00003420: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-00003430: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
-00003440: 706f 7274 2047 4453 206c 6179 6572 2e0a  port GDS layer..
-00003450: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00003460: 6978 3a20 7769 7468 2069 6e20 706f 7274  ix: with in port
-00003470: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
-00003480: 2020 206f 7269 656e 7461 7469 6f6e 3a20     orientation: 
-00003490: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
-000034a0: 2020 2020 2020 2020 7769 6474 683a 2070          width: p
-000034b0: 6f72 7420 7769 6474 6820 2875 6d29 2e0a  ort width (um)..
-000034c0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-000034d0: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
-000034e0: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
-000034f0: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
-00003500: 2020 2020 706f 7274 5f74 7970 653a 206f      port_type: o
-00003510: 7074 6963 616c 2c20 656c 6563 7472 6963  ptical, electric
-00003520: 616c 2c20 2e2e 2e0a 2020 2020 2020 2020  al, ....        
-00003530: 2222 220a 2020 2020 2020 2020 706f 7274  """.        port
-00003540: 735f 6377 203d 2073 656c 662e 6765 745f  s_cw = self.get_
-00003550: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
-00003560: 7769 7365 3d54 7275 652c 202a 2a6b 7761  wise=True, **kwa
-00003570: 7267 7329 0a20 2020 2020 2020 2070 6f72  rgs).        por
-00003580: 7473 5f63 6377 203d 2073 656c 662e 6765  ts_ccw = self.ge
-00003590: 745f 706f 7274 735f 6c69 7374 2863 6c6f  t_ports_list(clo
-000035a0: 636b 7769 7365 3d46 616c 7365 2c20 2a2a  ckwise=False, **
-000035b0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-000035c0: 7265 7475 726e 2073 6e61 705f 746f 5f67  return snap_to_g
-000035d0: 7269 6428 706f 7274 735f 6363 775b 305d  rid(ports_ccw[0]
-000035e0: 2e79 202d 2070 6f72 7473 5f63 775b 305d  .y - ports_cw[0]
-000035f0: 2e79 290a 0a20 2020 2064 6566 2070 6c6f  .y)..    def plo
-00003600: 745f 6e65 746c 6973 7428 0a20 2020 2020  t_netlist(.     
-00003610: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
-00003620: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
-00003630: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
-00003640: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
-00003650: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
-00003660: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
-00003670: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
-00003680: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
-00003690: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-000036a0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-000036b0: 6c61 6265 6c73 3a20 6164 6420 6c61 6265  labels: add labe
-000036c0: 6c20 746f 2065 6163 6820 6e6f 6465 2e0a  l to each node..
-000036d0: 2020 2020 2020 2020 2020 2020 666f 6e74              font
-000036e0: 5f77 6569 6768 743a 206e 6f72 6d61 6c2c  _weight: normal,
-000036f0: 2062 6f6c 642e 0a20 2020 2020 2020 2020   bold..         
-00003700: 2020 202a 2a6b 7761 7267 733a 206b 6579     **kwargs: key
-00003710: 776f 7264 2061 7267 756d 656e 7473 2066  word arguments f
-00003720: 6f72 2074 6865 2067 6574 5f6e 6574 6c69  or the get_netli
-00003730: 7374 2066 756e 6374 696f 6e0a 2020 2020  st function.    
-00003740: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00003750: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
-00003760: 622e 7079 706c 6f74 2061 7320 706c 740a  b.pyplot as plt.
-00003770: 2020 2020 2020 2020 696d 706f 7274 206e          import n
-00003780: 6574 776f 726b 7820 6173 206e 780a 0a20  etworkx as nx.. 
-00003790: 2020 2020 2020 2070 6c74 2e66 6967 7572         plt.figur
-000037a0: 6528 290a 2020 2020 2020 2020 6e65 746c  e().        netl
-000037b0: 6973 7420 3d20 7365 6c66 2e67 6574 5f6e  ist = self.get_n
-000037c0: 6574 6c69 7374 282a 2a6b 7761 7267 7329  etlist(**kwargs)
-000037d0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-000037e0: 696f 6e73 203d 206e 6574 6c69 7374 5b22  ions = netlist["
-000037f0: 636f 6e6e 6563 7469 6f6e 7322 5d0a 2020  connections"].  
-00003800: 2020 2020 2020 706c 6163 656d 656e 7473        placements
-00003810: 203d 206e 6574 6c69 7374 5b22 706c 6163   = netlist["plac
-00003820: 656d 656e 7473 225d 0a20 2020 2020 2020  ements"].       
-00003830: 2047 203d 206e 782e 4772 6170 6828 290a   G = nx.Graph().
-00003840: 2020 2020 2020 2020 472e 6164 645f 6564          G.add_ed
-00003850: 6765 735f 6672 6f6d 280a 2020 2020 2020  ges_from(.      
-00003860: 2020 2020 2020 5b0a 2020 2020 2020 2020        [.        
-00003870: 2020 2020 2020 2020 2822 2c22 2e6a 6f69          (",".joi
-00003880: 6e28 6b2e 7370 6c69 7428 222c 2229 5b3a  n(k.split(",")[:
-00003890: 2d31 5d29 2c20 222c 222e 6a6f 696e 2876  -1]), ",".join(v
-000038a0: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
-000038b0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-000038c0: 2020 2066 6f72 206b 2c20 7620 696e 2063     for k, v in c
-000038d0: 6f6e 6e65 6374 696f 6e73 2e69 7465 6d73  onnections.items
-000038e0: 2829 0a20 2020 2020 2020 2020 2020 205d  ().            ]
-000038f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00003900: 2020 2070 6f73 203d 207b 6b3a 2028 765b     pos = {k: (v[
-00003910: 2278 225d 2c20 765b 2279 225d 2920 666f  "x"], v["y"]) fo
-00003920: 7220 6b2c 2076 2069 6e20 706c 6163 656d  r k, v in placem
-00003930: 656e 7473 2e69 7465 6d73 2829 7d0a 2020  ents.items()}.  
-00003940: 2020 2020 2020 6c61 6265 6c73 203d 207b        labels = {
-00003950: 6b3a 2022 2c22 2e6a 6f69 6e28 6b2e 7370  k: ",".join(k.sp
-00003960: 6c69 7428 222c 2229 5b3a 315d 2920 666f  lit(",")[:1]) fo
-00003970: 7220 6b20 696e 2070 6c61 6365 6d65 6e74  r k in placement
-00003980: 732e 6b65 7973 2829 7d0a 2020 2020 2020  s.keys()}.      
-00003990: 2020 6e78 2e64 7261 7728 0a20 2020 2020    nx.draw(.     
-000039a0: 2020 2020 2020 2047 2c0a 2020 2020 2020         G,.      
-000039b0: 2020 2020 2020 7769 7468 5f6c 6162 656c        with_label
-000039c0: 733d 7769 7468 5f6c 6162 656c 732c 0a20  s=with_labels,. 
-000039d0: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
-000039e0: 7765 6967 6874 3d66 6f6e 745f 7765 6967  weight=font_weig
-000039f0: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
-00003a00: 6c61 6265 6c73 3d6c 6162 656c 732c 0a20  labels=labels,. 
-00003a10: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
-00003a20: 6f73 2c0a 2020 2020 2020 2020 290a 2020  os,.        ).  
-00003a30: 2020 2020 2020 7265 7475 726e 2047 0a0a        return G..
-00003a40: 2020 2020 6465 6620 706c 6f74 5f6e 6574      def plot_net
-00003a50: 6c69 7374 5f66 6c61 7428 0a20 2020 2020  list_flat(.     
-00003a60: 2020 2073 656c 662c 2077 6974 685f 6c61     self, with_la
-00003a70: 6265 6c73 3a20 626f 6f6c 203d 2054 7275  bels: bool = Tru
-00003a80: 652c 2066 6f6e 745f 7765 6967 6874 3a20  e, font_weight: 
-00003a90: 7374 7220 3d20 226e 6f72 6d61 6c22 2c20  str = "normal", 
-00003aa0: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
-00003ab0: 2020 2020 2020 2020 2222 2250 6c6f 7473          """Plots
-00003ac0: 2061 206e 6574 6c69 7374 2067 7261 7068   a netlist graph
-00003ad0: 2077 6974 6820 6e65 7477 6f72 6b78 2e0a   with networkx..
-00003ae0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-00003af0: 2020 2020 2020 2020 2020 2066 6c61 743a             flat:
-00003b00: 2069 6620 7472 7565 2c20 7769 6c6c 2070   if true, will p
-00003b10: 6c6f 7420 7468 6520 666c 6174 206e 6574  lot the flat net
-00003b20: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-00003b30: 2077 6974 685f 6c61 6265 6c73 3a20 6164   with_labels: ad
-00003b40: 6420 6c61 6265 6c20 746f 2065 6163 6820  d label to each 
-00003b50: 6e6f 6465 2e0a 2020 2020 2020 2020 2020  node..          
-00003b60: 2020 666f 6e74 5f77 6569 6768 743a 206e    font_weight: n
-00003b70: 6f72 6d61 6c2c 2062 6f6c 642e 0a20 2020  ormal, bold..   
-00003b80: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
-00003b90: 733a 206b 6579 776f 7264 2061 7267 756d  s: keyword argum
-00003ba0: 656e 7473 2066 6f72 2074 6865 2067 6574  ents for the get
-00003bb0: 5f6e 6574 6c69 7374 2066 756e 6374 696f  _netlist functio
-00003bc0: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-00003bd0: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
-00003be0: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
-00003bf0: 7320 706c 740a 2020 2020 2020 2020 696d  s plt.        im
-00003c00: 706f 7274 206e 6574 776f 726b 7820 6173  port networkx as
-00003c10: 206e 780a 0a20 2020 2020 2020 2070 6c74   nx..        plt
-00003c20: 2e66 6967 7572 6528 290a 2020 2020 2020  .figure().      
-00003c30: 2020 6e65 746c 6973 7420 3d20 7365 6c66    netlist = self
-00003c40: 2e67 6574 5f6e 6574 6c69 7374 5f66 6c61  .get_netlist_fla
-00003c50: 7428 2a2a 6b77 6172 6773 290a 2020 2020  t(**kwargs).    
-00003c60: 2020 2020 636f 6e6e 6563 7469 6f6e 7320      connections 
-00003c70: 3d20 6e65 746c 6973 745b 2263 6f6e 6e65  = netlist["conne
-00003c80: 6374 696f 6e73 225d 0a20 2020 2020 2020  ctions"].       
-00003c90: 2070 6c61 6365 6d65 6e74 7320 3d20 6e65   placements = ne
-00003ca0: 746c 6973 745b 2270 6c61 6365 6d65 6e74  tlist["placement
-00003cb0: 7322 5d0a 2020 2020 2020 2020 636f 6e6e  s"].        conn
-00003cc0: 6563 7469 6f6e 735f 6c69 7374 203d 205b  ections_list = [
-00003cd0: 5d0a 2020 2020 2020 2020 666f 7220 6b2c  ].        for k,
-00003ce0: 2076 5f6c 6973 7420 696e 2063 6f6e 6e65   v_list in conne
-00003cf0: 6374 696f 6e73 2e69 7465 6d73 2829 3a0a  ctions.items():.
-00003d00: 2020 2020 2020 2020 2020 2020 636f 6e6e              conn
-00003d10: 6563 7469 6f6e 735f 6c69 7374 2e65 7874  ections_list.ext
-00003d20: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-00003d30: 2020 2020 2028 222c 222e 6a6f 696e 286b       (",".join(k
-00003d40: 2e73 706c 6974 2822 2c22 295b 3a2d 315d  .split(",")[:-1]
-00003d50: 292c 2022 2c22 2e6a 6f69 6e28 762e 7370  ), ",".join(v.sp
-00003d60: 6c69 7428 222c 2229 5b3a 2d31 5d29 290a  lit(",")[:-1])).
-00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d80: 666f 7220 7620 696e 2076 5f6c 6973 740a  for v in v_list.
-00003d90: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00003da0: 2020 2020 2020 4720 3d20 6e78 2e47 7261        G = nx.Gra
-00003db0: 7068 2829 0a20 2020 2020 2020 2047 2e61  ph().        G.a
-00003dc0: 6464 5f65 6467 6573 5f66 726f 6d28 636f  dd_edges_from(co
-00003dd0: 6e6e 6563 7469 6f6e 735f 6c69 7374 290a  nnections_list).
-00003de0: 2020 2020 2020 2020 706f 7320 3d20 7b6b          pos = {k
-00003df0: 3a20 2876 5b22 7822 5d2c 2076 5b22 7922  : (v["x"], v["y"
-00003e00: 5d29 2066 6f72 206b 2c20 7620 696e 2070  ]) for k, v in p
-00003e10: 6c61 6365 6d65 6e74 732e 6974 656d 7328  lacements.items(
-00003e20: 297d 0a20 2020 2020 2020 206c 6162 656c  )}.        label
-00003e30: 7320 3d20 7b6b 3a20 222c 222e 6a6f 696e  s = {k: ",".join
-00003e40: 286b 2e73 706c 6974 2822 2c22 295b 3a31  (k.split(",")[:1
-00003e50: 5d29 2066 6f72 206b 2069 6e20 706c 6163  ]) for k in plac
-00003e60: 656d 656e 7473 2e6b 6579 7328 297d 0a20  ements.keys()}. 
-00003e70: 2020 2020 2020 206e 782e 6472 6177 280a         nx.draw(.
-00003e80: 2020 2020 2020 2020 2020 2020 472c 0a20              G,. 
-00003e90: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-00003ea0: 6c61 6265 6c73 3d77 6974 685f 6c61 6265  labels=with_labe
-00003eb0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
-00003ec0: 666f 6e74 5f77 6569 6768 743d 666f 6e74  font_weight=font
-00003ed0: 5f77 6569 6768 742c 0a20 2020 2020 2020  _weight,.       
-00003ee0: 2020 2020 206c 6162 656c 733d 6c61 6265       labels=labe
-00003ef0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
-00003f00: 706f 733d 706f 732c 0a20 2020 2020 2020  pos=pos,.       
-00003f10: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00003f20: 6e20 470a 0a20 2020 2064 6566 2067 6574  n G..    def get
-00003f30: 5f6e 6574 6c69 7374 5f79 616d 6c28 7365  _netlist_yaml(se
-00003f40: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
-00003f50: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
-00003f60: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-00003f70: 7366 6163 746f 7279 2e67 6574 5f6e 6574  sfactory.get_net
-00003f80: 6c69 7374 2069 6d70 6f72 7420 6765 745f  list import get_
-00003f90: 6e65 746c 6973 745f 7961 6d6c 0a0a 2020  netlist_yaml..  
-00003fa0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
-00003fb0: 5f6e 6574 6c69 7374 5f79 616d 6c28 7365  _netlist_yaml(se
-00003fc0: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
-00003fd0: 2020 2064 6566 2077 7269 7465 5f6e 6574     def write_net
-00003fe0: 6c69 7374 2873 656c 662c 2066 696c 6570  list(self, filep
-00003ff0: 6174 683a 2073 7472 2920 2d3e 204e 6f6e  ath: str) -> Non
-00004000: 653a 0a20 2020 2020 2020 2022 2222 5772  e:.        """Wr
-00004010: 6974 6520 6e65 746c 6973 7420 696e 2059  ite netlist in Y
-00004020: 414d 4c2e 2222 220a 2020 2020 2020 2020  AML.""".        
-00004030: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
-00004040: 6574 5f6e 6574 6c69 7374 2829 0a20 2020  et_netlist().   
-00004050: 2020 2020 206e 6574 6c69 7374 203d 2063       netlist = c
-00004060: 6c65 616e 5f64 6963 7428 6e65 746c 6973  lean_dict(netlis
-00004070: 7429 0a20 2020 2020 2020 204f 6d65 6761  t).        Omega
-00004080: 436f 6e66 2e73 6176 6528 6e65 746c 6973  Conf.save(netlis
-00004090: 742c 2066 696c 6570 6174 6829 0a0a 2020  t, filepath)..  
-000040a0: 2020 6465 6620 7772 6974 655f 6e65 746c    def write_netl
-000040b0: 6973 745f 646f 7428 7365 6c66 2c20 6669  ist_dot(self, fi
-000040c0: 6c65 7061 7468 3a20 4f70 7469 6f6e 616c  lepath: Optional
-000040d0: 5b73 7472 5d20 3d20 4e6f 6e65 2920 2d3e  [str] = None) ->
-000040e0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000040f0: 2222 5772 6974 6520 6e65 746c 6973 7420  ""Write netlist 
-00004100: 6772 6170 6820 696e 2044 4f54 2066 6f72  graph in DOT for
-00004110: 6d61 742e 2222 220a 2020 2020 2020 2020  mat.""".        
-00004120: 6672 6f6d 206e 6574 776f 726b 782e 6472  from networkx.dr
-00004130: 6177 696e 672e 6e78 5f61 6772 6170 6820  awing.nx_agraph 
-00004140: 696d 706f 7274 2077 7269 7465 5f64 6f74  import write_dot
-00004150: 0a0a 2020 2020 2020 2020 6669 6c65 7061  ..        filepa
-00004160: 7468 203d 2066 696c 6570 6174 6820 6f72  th = filepath or
-00004170: 2066 227b 7365 6c66 2e6e 616d 657d 2e64   f"{self.name}.d
-00004180: 6f74 220a 0a20 2020 2020 2020 2047 203d  ot"..        G =
-00004190: 2073 656c 662e 706c 6f74 5f6e 6574 6c69   self.plot_netli
-000041a0: 7374 2829 0a20 2020 2020 2020 2077 7269  st().        wri
-000041b0: 7465 5f64 6f74 2847 2c20 6669 6c65 7061  te_dot(G, filepa
-000041c0: 7468 290a 0a20 2020 2064 6566 2067 6574  th)..    def get
-000041d0: 5f6e 6574 6c69 7374 2873 656c 662c 202a  _netlist(self, *
-000041e0: 2a6b 7761 7267 7329 202d 3e20 4469 6374  *kwargs) -> Dict
-000041f0: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
-00004200: 2020 2020 2222 2246 726f 6d20 436f 6d70      """From Comp
-00004210: 6f6e 656e 7420 7265 7475 726e 7320 696e  onent returns in
-00004220: 7374 616e 6365 732c 2063 6f6e 6e65 6374  stances, connect
-00004230: 696f 6e73 2061 6e64 2070 6c61 6365 6d65  ions and placeme
-00004240: 6e74 7320 6469 6374 2e0a 0a20 2020 2020  nts dict...     
-00004250: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
-00004260: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-00004270: 706f 6e65 6e74 3a20 746f 2065 7874 7261  ponent: to extra
-00004280: 6374 206e 6574 6c69 7374 2e0a 2020 2020  ct netlist..    
-00004290: 2020 2020 2020 2020 6675 6c6c 5f73 6574          full_set
-000042a0: 7469 6e67 733a 2054 7275 6520 7265 7475  tings: True retu
-000042b0: 726e 7320 616c 6c2c 2066 616c 7365 2063  rns all, false c
-000042c0: 6861 6e67 6564 2073 6574 7469 6e67 732e  hanged settings.
-000042d0: 0a20 2020 2020 2020 2020 2020 2074 6f6c  .            tol
-000042e0: 6572 616e 6365 3a20 746f 6c65 7261 6e63  erance: toleranc
-000042f0: 6520 696e 206e 6d20 746f 2063 6f6e 7369  e in nm to consi
-00004300: 6465 7220 7477 6f20 706f 7274 7320 636f  der two ports co
-00004310: 6e6e 6563 7465 642e 0a20 2020 2020 2020  nnected..       
-00004320: 2020 2020 2065 7863 6c75 6465 5f70 6f72       exclude_por
-00004330: 745f 7479 7065 733a 206f 7074 696f 6e61  t_types: optiona
-00004340: 6c20 6c69 7374 206f 6620 706f 7274 2074  l list of port t
-00004350: 7970 6573 2074 6f20 6578 636c 7564 6520  ypes to exclude 
-00004360: 6672 6f6d 206e 6574 6c69 7374 696e 672e  from netlisting.
-00004370: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
-00004380: 5f69 6e73 7461 6e63 655f 6e61 6d65 3a20  _instance_name: 
-00004390: 6675 6e63 7469 6f6e 2074 6f20 6765 7420  function to get 
-000043a0: 696e 7374 616e 6365 206e 616d 652e 0a20  instance name.. 
-000043b0: 2020 2020 2020 2020 2020 2061 6c6c 6f77             allow
-000043c0: 5f6d 756c 7469 706c 653a 2046 616c 7365  _multiple: False
-000043d0: 2074 6f20 7261 6973 6520 616e 2065 7272   to raise an err
-000043e0: 6f72 2069 6620 6d6f 7265 2074 6861 6e20  or if more than 
-000043f0: 7477 6f20 706f 7274 7320 7368 6172 6520  two ports share 
-00004400: 7468 6520 7361 6d65 2063 6f6e 6e65 6374  the same connect
-00004410: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-00004420: 2020 2020 2069 6620 5472 7565 2c20 7769       if True, wi
-00004430: 6c6c 2072 6574 7572 6e20 6b65 793a 205b  ll return key: [
-00004440: 7661 6c75 655d 2070 6169 7273 2077 6974  value] pairs wit
-00004450: 6820 5b76 616c 7565 5d20 6120 6c69 7374  h [value] a list
-00004460: 206f 6620 616c 6c20 636f 6e6e 6563 7465   of all connecte
-00004470: 6420 696e 7374 616e 6365 732e 0a0a 2020  d instances...  
-00004480: 2020 2020 2020 5265 7475 726e 733a 0a20        Returns:. 
-00004490: 2020 2020 2020 2020 2020 204e 6574 6c69             Netli
-000044a0: 7374 2064 6963 7420 2869 6e73 7461 6e63  st dict (instanc
-000044b0: 6573 2c20 636f 6e6e 6563 7469 6f6e 732c  es, connections,
-000044c0: 2070 6c61 6365 6d65 6e74 732c 2070 6f72   placements, por
-000044d0: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-000044e0: 2020 2020 696e 7374 616e 6365 733a 2044      instances: D
-000044f0: 6963 7420 6f66 2069 6e73 7461 6e63 6520  ict of instance 
-00004500: 6e61 6d65 2061 6e64 2073 6574 7469 6e67  name and setting
-00004510: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
-00004520: 2020 2063 6f6e 6e65 6374 696f 6e73 3a20     connections: 
-00004530: 4469 6374 206f 6620 496e 7374 616e 6365  Dict of Instance
-00004540: 314e 616d 652c 706f 7274 4e61 6d65 3a20  1Name,portName: 
-00004550: 496e 7374 616e 6365 324e 616d 652c 706f  Instance2Name,po
-00004560: 7274 4e61 6d65 2e0a 2020 2020 2020 2020  rtName..        
-00004570: 2020 2020 2020 2020 706c 6163 656d 656e          placemen
-00004580: 7473 3a20 4469 6374 206f 6620 696e 7374  ts: Dict of inst
-00004590: 616e 6365 206e 616d 6573 2061 6e64 2070  ance names and p
-000045a0: 6c61 6365 6d65 6e74 7320 2878 2c20 792c  lacements (x, y,
-000045b0: 2072 6f74 6174 696f 6e29 2e0a 2020 2020   rotation)..    
-000045c0: 2020 2020 2020 2020 2020 2020 706f 7274              port
-000045d0: 733a 2044 6963 7420 706f 7274 4e61 6d65  s: Dict portName
-000045e0: 3a20 436f 6d70 6f6e 656e 744e 616d 652c  : ComponentName,
-000045f0: 706f 7274 2e0a 2020 2020 2020 2020 2020  port..          
-00004600: 2020 2020 2020 6e61 6d65 3a20 6e61 6d65        name: name
-00004610: 206f 6620 636f 6d70 6f6e 656e 742e 0a20   of component.. 
-00004620: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00004630: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-00004640: 7279 2e67 6574 5f6e 6574 6c69 7374 2069  ry.get_netlist i
-00004650: 6d70 6f72 7420 6765 745f 6e65 746c 6973  mport get_netlis
-00004660: 740a 0a20 2020 2020 2020 2072 6574 7572  t..        retur
-00004670: 6e20 6765 745f 6e65 746c 6973 7428 636f  n get_netlist(co
-00004680: 6d70 6f6e 656e 743d 7365 6c66 2c20 2a2a  mponent=self, **
-00004690: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
-000046a0: 2067 6574 5f6e 6574 6c69 7374 5f72 6563   get_netlist_rec
-000046b0: 7572 7369 7665 2873 656c 662c 202a 2a6b  ursive(self, **k
-000046c0: 7761 7267 7329 202d 3e20 4469 6374 5b73  wargs) -> Dict[s
-000046d0: 7472 2c20 4469 6374 436f 6e66 6967 5d3a  tr, DictConfig]:
-000046e0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-000046f0: 726e 7320 7265 6375 7273 6976 6520 6e65  rns recursive ne
-00004700: 746c 6973 7420 666f 7220 6120 636f 6d70  tlist for a comp
-00004710: 6f6e 656e 7420 616e 6420 7375 6263 6f6d  onent and subcom
-00004720: 706f 6e65 6e74 732e 0a0a 2020 2020 2020  ponents...      
-00004730: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
-00004740: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00004750: 6f6e 656e 743a 2074 6f20 6578 7472 6163  onent: to extrac
-00004760: 7420 6e65 746c 6973 742e 0a20 2020 2020  t netlist..     
-00004770: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00004780: 5f73 7566 6669 783a 2073 7566 6669 7820  _suffix: suffix 
-00004790: 746f 2061 7070 656e 6420 746f 2065 6163  to append to eac
-000047a0: 6820 636f 6d70 6f6e 656e 7420 6e61 6d65  h component name
-000047b0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000047c0: 2020 7573 6566 756c 2069 6620 746f 2073    useful if to s
-000047d0: 6176 6520 616e 6420 7265 6c6f 6164 2061  ave and reload a
-000047e0: 2062 6163 6b2d 616e 6e6f 7461 7465 6420   back-annotated 
-000047f0: 6e65 746c 6973 742e 0a20 2020 2020 2020  netlist..       
-00004800: 2020 2020 2067 6574 5f6e 6574 6c69 7374       get_netlist
-00004810: 5f66 756e 633a 2066 756e 6374 696f 6e20  _func: function 
-00004820: 746f 2065 7874 7261 6374 2069 6e64 6976  to extract indiv
-00004830: 6964 7561 6c20 6e65 746c 6973 7473 2e0a  idual netlists..
-00004840: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
-00004850: 5f73 6574 7469 6e67 733a 2054 7275 6520  _settings: True 
-00004860: 7265 7475 726e 7320 616c 6c2c 2066 616c  returns all, fal
-00004870: 7365 2063 6861 6e67 6564 2073 6574 7469  se changed setti
-00004880: 6e67 732e 0a20 2020 2020 2020 2020 2020  ngs..           
-00004890: 2074 6f6c 6572 616e 6365 3a20 746f 6c65   tolerance: tole
-000048a0: 7261 6e63 6520 696e 206e 6d20 746f 2063  rance in nm to c
-000048b0: 6f6e 7369 6465 7220 7477 6f20 706f 7274  onsider two port
-000048c0: 7320 636f 6e6e 6563 7465 642e 0a20 2020  s connected..   
-000048d0: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
-000048e0: 5f70 6f72 745f 7479 7065 733a 206f 7074  _port_types: opt
-000048f0: 696f 6e61 6c20 6c69 7374 206f 6620 706f  ional list of po
-00004900: 7274 2074 7970 6573 2074 6f20 6578 636c  rt types to excl
-00004910: 7564 6520 6672 6f6d 206e 6574 6c69 7374  ude from netlist
-00004920: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-00004930: 2067 6574 5f69 6e73 7461 6e63 655f 6e61   get_instance_na
-00004940: 6d65 3a20 6675 6e63 7469 6f6e 2074 6f20  me: function to 
-00004950: 6765 7420 696e 7374 616e 6365 206e 616d  get instance nam
-00004960: 652e 0a20 2020 2020 2020 2020 2020 2061  e..            a
-00004970: 6c6c 6f77 5f6d 756c 7469 706c 653a 2046  llow_multiple: F
-00004980: 616c 7365 2074 6f20 7261 6973 6520 616e  alse to raise an
-00004990: 2065 7272 6f72 2069 6620 6d6f 7265 2074   error if more t
-000049a0: 6861 6e20 7477 6f20 706f 7274 7320 7368  han two ports sh
-000049b0: 6172 6520 7468 6520 7361 6d65 2063 6f6e  are the same con
-000049c0: 6e65 6374 696f 6e2e 0a20 2020 2020 2020  nection..       
-000049d0: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-000049e0: 2c20 7769 6c6c 2072 6574 7572 6e20 6b65  , will return ke
-000049f0: 793a 205b 7661 6c75 655d 2070 6169 7273  y: [value] pairs
-00004a00: 2077 6974 6820 5b76 616c 7565 5d20 6120   with [value] a 
-00004a10: 6c69 7374 206f 6620 616c 6c20 636f 6e6e  list of all conn
-00004a20: 6563 7465 6420 696e 7374 616e 6365 732e  ected instances.
-00004a30: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00004a40: 733a 0a20 2020 2020 2020 2020 2020 2044  s:.            D
-00004a50: 6963 7469 6f6e 6172 7920 6f66 206e 6574  ictionary of net
-00004a60: 6c69 7374 732c 206b 6579 6564 2062 7920  lists, keyed by 
-00004a70: 7468 6520 6e61 6d65 206f 6620 6561 6368  the name of each
-00004a80: 2063 6f6d 706f 6e65 6e74 2e0a 2020 2020   component..    
-00004a90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00004aa0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-00004ab0: 6765 745f 6e65 746c 6973 7420 696d 706f  get_netlist impo
-00004ac0: 7274 2067 6574 5f6e 6574 6c69 7374 5f72  rt get_netlist_r
-00004ad0: 6563 7572 7369 7665 0a0a 2020 2020 2020  ecursive..      
-00004ae0: 2020 7265 7475 726e 2067 6574 5f6e 6574    return get_net
-00004af0: 6c69 7374 5f72 6563 7572 7369 7665 2863  list_recursive(c
-00004b00: 6f6d 706f 6e65 6e74 3d73 656c 662c 202a  omponent=self, *
-00004b10: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
-00004b20: 6620 6765 745f 6e65 746c 6973 745f 666c  f get_netlist_fl
-00004b30: 6174 2873 656c 662c 202a 2a6b 7761 7267  at(self, **kwarg
-00004b40: 7329 202d 3e20 4469 6374 5b73 7472 2c20  s) -> Dict[str, 
-00004b50: 4469 6374 436f 6e66 6967 5d3a 0a20 2020  DictConfig]:.   
-00004b60: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00004b70: 6120 6e65 746c 6973 7420 7768 6572 6520  a netlist where 
-00004b80: 616c 6c20 7375 6269 6e73 7461 6e63 6573  all subinstances
-00004b90: 2061 7265 2065 7870 6f73 6564 2061 6e64   are exposed and
-00004ba0: 2069 6e64 6570 656e 6465 6e74 6c79 206e   independently n
-00004bb0: 616d 6564 2e0a 0a20 2020 2020 2020 204b  amed...        K
-00004bc0: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-00004bd0: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
-00004be0: 6e74 3a20 746f 2065 7874 7261 6374 206e  nt: to extract n
-00004bf0: 6574 6c69 7374 2e0a 2020 2020 2020 2020  etlist..        
-00004c00: 2020 2020 636f 6d70 6f6e 656e 745f 7375      component_su
-00004c10: 6666 6978 3a20 7375 6666 6978 2074 6f20  ffix: suffix to 
-00004c20: 6170 7065 6e64 2074 6f20 6561 6368 2063  append to each c
-00004c30: 6f6d 706f 6e65 6e74 206e 616d 652e 0a20  omponent name.. 
-00004c40: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00004c50: 7365 6675 6c20 6966 2074 6f20 7361 7665  seful if to save
-00004c60: 2061 6e64 2072 656c 6f61 6420 6120 6261   and reload a ba
-00004c70: 636b 2d61 6e6e 6f74 6174 6564 206e 6574  ck-annotated net
-00004c80: 6c69 7374 2e0a 2020 2020 2020 2020 2020  list..          
-00004c90: 2020 6765 745f 6e65 746c 6973 745f 6675    get_netlist_fu
-00004ca0: 6e63 3a20 6675 6e63 7469 6f6e 2074 6f20  nc: function to 
-00004cb0: 6578 7472 6163 7420 696e 6469 7669 6475  extract individu
-00004cc0: 616c 206e 6574 6c69 7374 732e 0a20 2020  al netlists..   
-00004cd0: 2020 2020 2020 2020 2066 756c 6c5f 7365           full_se
-00004ce0: 7474 696e 6773 3a20 5472 7565 2072 6574  ttings: True ret
-00004cf0: 7572 6e73 2061 6c6c 2c20 6661 6c73 6520  urns all, false 
-00004d00: 6368 616e 6765 6420 7365 7474 696e 6773  changed settings
-00004d10: 2e0a 2020 2020 2020 2020 2020 2020 746f  ..            to
-00004d20: 6c65 7261 6e63 653a 2074 6f6c 6572 616e  lerance: toleran
-00004d30: 6365 2069 6e20 6e6d 2074 6f20 636f 6e73  ce in nm to cons
-00004d40: 6964 6572 2074 776f 2070 6f72 7473 2063  ider two ports c
-00004d50: 6f6e 6e65 6374 6564 2e0a 2020 2020 2020  onnected..      
-00004d60: 2020 2020 2020 6578 636c 7564 655f 706f        exclude_po
-00004d70: 7274 5f74 7970 6573 3a20 6f70 7469 6f6e  rt_types: option
-00004d80: 616c 206c 6973 7420 6f66 2070 6f72 7420  al list of port 
-00004d90: 7479 7065 7320 746f 2065 7863 6c75 6465  types to exclude
-00004da0: 2066 726f 6d20 6e65 746c 6973 7469 6e67   from netlisting
-00004db0: 2e0a 2020 2020 2020 2020 2020 2020 6765  ..            ge
-00004dc0: 745f 696e 7374 616e 6365 5f6e 616d 653a  t_instance_name:
-00004dd0: 2066 756e 6374 696f 6e20 746f 2067 6574   function to get
-00004de0: 2069 6e73 7461 6e63 6520 6e61 6d65 2e0a   instance name..
-00004df0: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
-00004e00: 775f 6d75 6c74 6970 6c65 3a20 4661 6c73  w_multiple: Fals
-00004e10: 6520 746f 2072 6169 7365 2061 6e20 6572  e to raise an er
-00004e20: 726f 7220 6966 206d 6f72 6520 7468 616e  ror if more than
-00004e30: 2074 776f 2070 6f72 7473 2073 6861 7265   two ports share
-00004e40: 2074 6865 2073 616d 6520 636f 6e6e 6563   the same connec
-00004e50: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
-00004e60: 2020 2020 2020 6966 2054 7275 652c 2077        if True, w
-00004e70: 696c 6c20 7265 7475 726e 206b 6579 3a20  ill return key: 
-00004e80: 5b76 616c 7565 5d20 7061 6972 7320 7769  [value] pairs wi
-00004e90: 7468 205b 7661 6c75 655d 2061 206c 6973  th [value] a lis
-00004ea0: 7420 6f66 2061 6c6c 2063 6f6e 6e65 6374  t of all connect
-00004eb0: 6564 2069 6e73 7461 6e63 6573 2e0a 0a20  ed instances... 
-00004ec0: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-00004ed0: 2020 2020 2020 2020 2020 2020 4469 6374              Dict
-00004ee0: 696f 6e61 7279 206f 6620 6e65 746c 6973  ionary of netlis
-00004ef0: 7473 2c20 6b65 7965 6420 6279 2074 6865  ts, keyed by the
-00004f00: 206e 616d 6520 6f66 2065 6163 6820 636f   name of each co
-00004f10: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
-00004f20: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00004f30: 6d20 6764 7366 6163 746f 7279 2e67 6574  m gdsfactory.get
-00004f40: 5f6e 6574 6c69 7374 5f66 6c61 7420 696d  _netlist_flat im
-00004f50: 706f 7274 2067 6574 5f6e 6574 6c69 7374  port get_netlist
-00004f60: 5f66 6c61 740a 0a20 2020 2020 2020 2072  _flat..        r
-00004f70: 6574 7572 6e20 6765 745f 6e65 746c 6973  eturn get_netlis
-00004f80: 745f 666c 6174 2863 6f6d 706f 6e65 6e74  t_flat(component
-00004f90: 3d73 656c 662c 202a 2a6b 7761 7267 7329  =self, **kwargs)
-00004fa0: 0a0a 2020 2020 6465 6620 6173 7365 7274  ..    def assert
-00004fb0: 5f70 6f72 7473 5f6f 6e5f 6772 6964 2873  _ports_on_grid(s
-00004fc0: 656c 662c 206e 6d3a 2069 6e74 203d 2031  elf, nm: int = 1
-00004fd0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00004fe0: 2020 2022 2222 4173 7365 7274 7320 7468     """Asserts th
-00004ff0: 6174 2061 6c6c 2070 6f72 7473 2061 7265  at all ports are
-00005000: 206f 6e20 6772 6964 2e22 2222 0a20 2020   on grid.""".   
-00005010: 2020 2020 2066 6f72 2070 6f72 7420 696e       for port in
-00005020: 2073 656c 662e 706f 7274 732e 7661 6c75   self.ports.valu
-00005030: 6573 2829 3a0a 2020 2020 2020 2020 2020  es():.          
-00005040: 2020 706f 7274 2e61 7373 6572 745f 6f6e    port.assert_on
-00005050: 5f67 7269 6428 6e6d 3d6e 6d29 0a0a 2020  _grid(nm=nm)..  
-00005060: 2020 6465 6620 6765 745f 706f 7274 7328    def get_ports(
-00005070: 7365 6c66 2c20 6465 7074 683d 4e6f 6e65  self, depth=None
-00005080: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-00005090: 7475 726e 7320 636f 7069 6573 206f 6620  turns copies of 
-000050a0: 616c 6c20 7468 6520 706f 7274 7320 6f66  all the ports of
-000050b0: 2074 6865 2043 6f6d 706f 6e65 6e74 2c20   the Component, 
-000050c0: 726f 7461 7465 6420 616e 6420 5c0a 2020  rotated and \.  
-000050d0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-000050e0: 616e 736c 6174 6564 2073 6f20 7468 6174  anslated so that
-000050f0: 2074 6865 7927 7265 2069 6e20 7468 6569   they're in thei
-00005100: 7220 746f 702d 6c65 7665 6c20 706f 7369  r top-level posi
-00005110: 7469 6f6e 2e0a 0a20 2020 2020 2020 2054  tion...        T
-00005120: 6865 2050 6f72 7473 2072 6574 7572 6e65  he Ports returne
-00005130: 6420 6172 6520 636f 7069 6573 206f 6620  d are copies of 
-00005140: 7468 6520 6f72 6967 696e 616c 732c 2062  the originals, b
-00005150: 7574 2065 6163 6820 636f 7079 2068 6173  ut each copy has
-00005160: 2074 6865 2073 616d 650a 2020 2020 2020   the same.      
-00005170: 2020 6060 7569 6460 6020 6173 2074 6865    ``uid`` as the
-00005180: 206f 7269 6769 6e61 6c20 736f 2074 6861   original so tha
-00005190: 7420 7468 6579 2063 616e 2062 6520 7472  t they can be tr
-000051a0: 6163 6564 2062 6163 6b20 746f 2074 6865  aced back to the
-000051b0: 206f 7269 6769 6e61 6c20 6966 206e 6565   original if nee
-000051c0: 6465 642e 0a0a 2020 2020 2020 2020 4172  ded...        Ar
-000051d0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-000051e0: 6465 7074 6820 3a20 696e 7420 6f72 204e  depth : int or N
-000051f0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00005200: 2020 2020 4966 206e 6f74 204e 6f6e 652c      If not None,
-00005210: 2064 6566 696e 6573 2066 726f 6d20 686f   defines from ho
-00005220: 7720 6d61 6e79 2072 6566 6572 656e 6365  w many reference
-00005230: 206c 6576 656c 7320 746f 0a20 2020 2020   levels to.     
-00005240: 2020 2020 2020 2020 2020 2072 6574 7269             retri
-00005250: 6576 6520 506f 7274 7320 6672 6f6d 2e0a  eve Ports from..
-00005260: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00005270: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
-00005280: 7274 5f6c 6973 7420 3a20 6c69 7374 206f  rt_list : list o
-00005290: 6620 506f 7274 204c 6973 7420 6f66 2061  f Port List of a
-000052a0: 6c6c 2050 6f72 7473 2069 6e20 7468 6520  ll Ports in the 
-000052b0: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
-000052c0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-000052d0: 6f72 745f 6c69 7374 203d 205b 702e 5f63  ort_list = [p._c
-000052e0: 6f70 7928 2920 666f 7220 7020 696e 2073  opy() for p in s
-000052f0: 656c 662e 706f 7274 732e 7661 6c75 6573  elf.ports.values
-00005300: 2829 5d0a 0a20 2020 2020 2020 2069 6620  ()]..        if 
-00005310: 6465 7074 6820 6973 204e 6f6e 6520 6f72  depth is None or
-00005320: 2064 6570 7468 203e 2030 3a0a 2020 2020   depth > 0:.    
-00005330: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
-00005340: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
-00005350: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005360: 2020 6e65 775f 6465 7074 6820 3d20 4e6f    new_depth = No
-00005370: 6e65 2069 6620 6465 7074 6820 6973 204e  ne if depth is N
-00005380: 6f6e 6520 656c 7365 2064 6570 7468 202d  one else depth -
-00005390: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-000053a0: 2020 2072 6566 5f70 6f72 7473 203d 2072     ref_ports = r
-000053b0: 2e70 6172 656e 742e 6765 745f 706f 7274  .parent.get_port
-000053c0: 7328 6465 7074 683d 6e65 775f 6465 7074  s(depth=new_dept
-000053d0: 6829 0a0a 2020 2020 2020 2020 2020 2020  h)..            
-000053e0: 2020 2020 2320 5472 616e 7366 6f72 6d20      # Transform 
-000053f0: 706f 7274 7320 7468 6174 2063 616d 6520  ports that came 
-00005400: 6672 6f6d 2061 2072 6566 6572 656e 6365  from a reference
-00005410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005420: 2072 6566 5f70 6f72 7473 5f74 7261 6e73   ref_ports_trans
-00005430: 666f 726d 6564 203d 205b 5d0a 2020 2020  formed = [].    
-00005440: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00005450: 7270 2069 6e20 7265 665f 706f 7274 733a  rp in ref_ports:
-00005460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005470: 2020 2020 206e 6577 5f70 6f72 7420 3d20       new_port = 
-00005480: 7270 2e5f 636f 7079 2829 0a20 2020 2020  rp._copy().     
-00005490: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000054a0: 6577 5f63 656e 7465 722c 206e 6577 5f6f  ew_center, new_o
-000054b0: 7269 656e 7461 7469 6f6e 203d 2072 2e5f  rientation = r._
-000054c0: 7472 616e 7366 6f72 6d5f 706f 7274 280a  transform_port(.
-000054d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054e0: 2020 2020 2020 2020 7270 2e63 656e 7465          rp.cente
-000054f0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00005500: 2020 2020 2020 2020 2020 2072 702e 6f72             rp.or
-00005510: 6965 6e74 6174 696f 6e2c 0a20 2020 2020  ientation,.     
-00005520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005530: 2020 2072 2e6f 7269 6769 6e2c 0a20 2020     r.origin,.   
-00005540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005550: 2020 2020 2072 2e72 6f74 6174 696f 6e2c       r.rotation,
-00005560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005570: 2020 2020 2020 2020 2072 2e78 5f72 6566           r.x_ref
-00005580: 6c65 6374 696f 6e2c 0a20 2020 2020 2020  lection,.       
-00005590: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055b0: 2020 206e 6577 5f70 6f72 742e 6365 6e74     new_port.cent
-000055c0: 6572 203d 206e 6577 5f63 656e 7465 720a  er = new_center.
-000055d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055e0: 2020 2020 6e65 775f 706f 7274 2e6e 6577      new_port.new
-000055f0: 5f6f 7269 656e 7461 7469 6f6e 203d 206e  _orientation = n
-00005600: 6577 5f6f 7269 656e 7461 7469 6f6e 0a20  ew_orientation. 
-00005610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005620: 2020 2072 6566 5f70 6f72 7473 5f74 7261     ref_ports_tra
-00005630: 6e73 666f 726d 6564 2e61 7070 656e 6428  nsformed.append(
-00005640: 6e65 775f 706f 7274 290a 2020 2020 2020  new_port).      
-00005650: 2020 2020 2020 2020 2020 706f 7274 5f6c            port_l
-00005660: 6973 7420 2b3d 2072 6566 5f70 6f72 7473  ist += ref_ports
-00005670: 5f74 7261 6e73 666f 726d 6564 0a0a 2020  _transformed..  
-00005680: 2020 2020 2020 7265 7475 726e 2070 6f72        return por
-00005690: 745f 6c69 7374 0a0a 2020 2020 6465 6620  t_list..    def 
-000056a0: 6765 745f 706f 7274 735f 6469 6374 2873  get_ports_dict(s
-000056b0: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-000056c0: 3e20 4469 6374 5b73 7472 2c20 506f 7274  > Dict[str, Port
-000056d0: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
-000056e0: 7475 726e 7320 6120 6469 6374 206f 6620  turns a dict of 
-000056f0: 706f 7274 732e 0a0a 2020 2020 2020 2020  ports...        
-00005700: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
-00005710: 2020 2020 2020 2020 2020 6c61 7965 723a            layer:
-00005720: 2070 6f72 7420 4744 5320 6c61 7965 722e   port GDS layer.
-00005730: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00005740: 6669 783a 2073 656c 6563 7420 706f 7274  fix: select port
-00005750: 7320 7769 7468 2070 7265 6669 7820 696e  s with prefix in
-00005760: 2070 6f72 7420 6e61 6d65 2e0a 2020 2020   port name..    
-00005770: 2020 2020 2020 2020 7375 6666 6978 3a20          suffix: 
-00005780: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
-00005790: 6820 706f 7274 206e 616d 6520 7375 6666  h port name suff
-000057a0: 6978 2e0a 2020 2020 2020 2020 2020 2020  ix..            
-000057b0: 6f72 6965 6e74 6174 696f 6e3a 2073 656c  orientation: sel
-000057c0: 6563 7420 706f 7274 7320 7769 7468 206f  ect ports with o
-000057d0: 7269 656e 7461 7469 6f6e 2069 6e20 6465  rientation in de
-000057e0: 6772 6565 732e 0a20 2020 2020 2020 2020  grees..         
-000057f0: 2020 2077 6964 7468 3a20 7365 6c65 6374     width: select
-00005800: 2070 6f72 7473 2077 6974 6820 706f 7274   ports with port
-00005810: 2077 6964 7468 2e0a 2020 2020 2020 2020   width..        
-00005820: 2020 2020 6c61 7965 7273 5f65 7863 6c75      layers_exclu
-00005830: 6465 643a 204c 6973 7420 6f66 206c 6179  ded: List of lay
-00005840: 6572 7320 746f 2065 7863 6c75 6465 2e0a  ers to exclude..
-00005850: 2020 2020 2020 2020 2020 2020 706f 7274              port
-00005860: 5f74 7970 653a 2073 656c 6563 7420 706f  _type: select po
-00005870: 7274 7320 7769 7468 2070 6f72 745f 7479  rts with port_ty
-00005880: 7065 2028 6f70 7469 6361 6c2c 2065 6c65  pe (optical, ele
-00005890: 6374 7269 6361 6c2c 2076 6572 7469 6361  ctrical, vertica
-000058a0: 6c5f 7465 292e 0a20 2020 2020 2020 2020  l_te)..         
-000058b0: 2020 2063 6c6f 636b 7769 7365 3a20 6966     clockwise: if
-000058c0: 2054 7275 652c 2073 6f72 7420 706f 7274   True, sort port
-000058d0: 7320 636c 6f63 6b77 6973 652c 2046 616c  s clockwise, Fal
-000058e0: 7365 3a20 636f 756e 7465 722d 636c 6f63  se: counter-cloc
-000058f0: 6b77 6973 652e 0a20 2020 2020 2020 2022  kwise..        "
-00005900: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00005910: 6e20 7365 6c65 6374 5f70 6f72 7473 2873  n select_ports(s
-00005920: 656c 662e 706f 7274 732c 202a 2a6b 7761  elf.ports, **kwa
-00005930: 7267 7329 0a0a 2020 2020 6465 6620 6765  rgs)..    def ge
-00005940: 745f 706f 7274 735f 6c69 7374 2873 656c  t_ports_list(sel
-00005950: 662c 202a 2a6b 7761 7267 7329 202d 3e20  f, **kwargs) -> 
-00005960: 4c69 7374 5b50 6f72 745d 3a0a 2020 2020  List[Port]:.    
-00005970: 2020 2020 2222 2252 6574 7572 6e73 206c      """Returns l
-00005980: 6973 7420 6f66 2070 6f72 7473 2e0a 0a20  ist of ports... 
-00005990: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
-000059a0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000059b0: 206c 6179 6572 3a20 7365 6c65 6374 2070   layer: select p
-000059c0: 6f72 7473 2077 6974 6820 4744 5320 6c61  orts with GDS la
-000059d0: 7965 722e 0a20 2020 2020 2020 2020 2020  yer..           
-000059e0: 2070 7265 6669 783a 2073 656c 6563 7420   prefix: select 
-000059f0: 706f 7274 7320 7769 7468 2070 7265 6669  ports with prefi
-00005a00: 7820 696e 2070 6f72 7420 6e61 6d65 2e0a  x in port name..
-00005a10: 2020 2020 2020 2020 2020 2020 7375 6666              suff
-00005a20: 6978 3a20 7365 6c65 6374 2070 6f72 7473  ix: select ports
-00005a30: 2077 6974 6820 706f 7274 206e 616d 6520   with port name 
-00005a40: 7375 6666 6978 2e0a 2020 2020 2020 2020  suffix..        
-00005a50: 2020 2020 6f72 6965 6e74 6174 696f 6e3a      orientation:
-00005a60: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
-00005a70: 7468 206f 7269 656e 7461 7469 6f6e 2069  th orientation i
-00005a80: 6e20 6465 6772 6565 732e 0a20 2020 2020  n degrees..     
-00005a90: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
-00005aa0: 6f6e 3a20 7365 6c65 6374 2070 6f72 7473  on: select ports
-00005ab0: 2077 6974 6820 6f72 6965 6e74 6174 696f   with orientatio
-00005ac0: 6e20 696e 2064 6567 7265 6573 2e0a 2020  n in degrees..  
-00005ad0: 2020 2020 2020 2020 2020 7769 6474 683a            width:
-00005ae0: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
-00005af0: 7468 2070 6f72 7420 7769 6474 682e 0a20  th port width.. 
-00005b00: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00005b10: 735f 6578 636c 7564 6564 3a20 4c69 7374  s_excluded: List
-00005b20: 206f 6620 6c61 7965 7273 2074 6f20 6578   of layers to ex
-00005b30: 636c 7564 652e 0a20 2020 2020 2020 2020  clude..         
-00005b40: 2020 2070 6f72 745f 7479 7065 3a20 7365     port_type: se
-00005b50: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
-00005b60: 706f 7274 5f74 7970 6520 286f 7074 6963  port_type (optic
-00005b70: 616c 2c20 656c 6563 7472 6963 616c 2c20  al, electrical, 
-00005b80: 7665 7274 6963 616c 5f74 6529 2e0a 2020  vertical_te)..  
-00005b90: 2020 2020 2020 2020 2020 636c 6f63 6b77            clockw
-00005ba0: 6973 653a 2069 6620 5472 7565 2c20 736f  ise: if True, so
-00005bb0: 7274 2070 6f72 7473 2063 6c6f 636b 7769  rt ports clockwi
-00005bc0: 7365 2c20 4661 6c73 653a 2063 6f75 6e74  se, False: count
-00005bd0: 6572 2d63 6c6f 636b 7769 7365 2e0a 2020  er-clockwise..  
-00005be0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00005bf0: 2020 7265 7475 726e 206c 6973 7428 7365    return list(se
-00005c00: 6c65 6374 5f70 6f72 7473 2873 656c 662e  lect_ports(self.
-00005c10: 706f 7274 732c 202a 2a6b 7761 7267 7329  ports, **kwargs)
-00005c20: 2e76 616c 7565 7328 2929 0a0a 2020 2020  .values())..    
-00005c30: 6465 6620 6765 745f 706f 7274 735f 7061  def get_ports_pa
-00005c40: 6e64 6173 2873 656c 6629 3a0a 2020 2020  ndas(self):.    
-00005c50: 2020 2020 696d 706f 7274 2070 616e 6461      import panda
-00005c60: 7320 6173 2070 640a 0a20 2020 2020 2020  s as pd..       
-00005c70: 2063 6f6c 5f73 7065 6320 3d20 5b0a 2020   col_spec = [.  
-00005c80: 2020 2020 2020 2020 2020 226e 616d 6522            "name"
-00005c90: 2c0a 2020 2020 2020 2020 2020 2020 2277  ,.            "w
-00005ca0: 6964 7468 222c 0a20 2020 2020 2020 2020  idth",.         
-00005cb0: 2020 2022 6365 6e74 6572 222c 0a20 2020     "center",.   
-00005cc0: 2020 2020 2020 2020 2022 6f72 6965 6e74           "orient
-00005cd0: 6174 696f 6e22 2c0a 2020 2020 2020 2020  ation",.        
-00005ce0: 2020 2020 226c 6179 6572 222c 0a20 2020      "layer",.   
-00005cf0: 2020 2020 2020 2020 2022 706f 7274 5f74           "port_t
-00005d00: 7970 6522 2c0a 2020 2020 2020 2020 2020  ype",.          
-00005d10: 2020 2273 6865 6172 5f61 6e67 6c65 222c    "shear_angle",
-00005d20: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
-00005d30: 2020 2020 7265 7475 726e 2070 642e 4461      return pd.Da
-00005d40: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
-00005d50: 2020 2020 205b 706f 7274 2e74 6f5f 6469       [port.to_di
-00005d60: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
-00005d70: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
-00005d80: 6c69 7374 2829 5d2c 2063 6f6c 756d 6e73  list()], columns
-00005d90: 3d63 6f6c 5f73 7065 630a 2020 2020 2020  =col_spec.      
-00005da0: 2020 290a 0a20 2020 2064 6566 2067 6574    )..    def get
-00005db0: 5f70 6f72 7473 5f70 6f6c 6172 7328 7365  _ports_polars(se
-00005dc0: 6c66 293a 0a20 2020 2020 2020 2069 6d70  lf):.        imp
-00005dd0: 6f72 7420 706f 6c61 7273 2061 7320 706c  ort polars as pl
-00005de0: 0a0a 2020 2020 2020 2020 636f 6c5f 7370  ..        col_sp
-00005df0: 6563 203d 207b 0a20 2020 2020 2020 2020  ec = {.         
-00005e00: 2020 2022 6e61 6d65 223a 2070 6c2e 5574     "name": pl.Ut
-00005e10: 6638 2c0a 2020 2020 2020 2020 2020 2020  f8,.            
-00005e20: 2277 6964 7468 223a 2070 6c2e 466c 6f61  "width": pl.Floa
-00005e30: 7436 342c 0a20 2020 2020 2020 2020 2020  t64,.           
-00005e40: 2022 6365 6e74 6572 223a 2070 6c2e 4c69   "center": pl.Li
-00005e50: 7374 2870 6c2e 466c 6f61 7436 3429 2c0a  st(pl.Float64),.
-00005e60: 2020 2020 2020 2020 2020 2020 226f 7269              "ori
-00005e70: 656e 7461 7469 6f6e 223a 2070 6c2e 466c  entation": pl.Fl
-00005e80: 6f61 7436 342c 0a20 2020 2020 2020 2020  oat64,.         
-00005e90: 2020 2022 6c61 7965 7222 3a20 706c 2e4c     "layer": pl.L
-00005ea0: 6973 7428 706c 2e55 496e 7431 3629 2c0a  ist(pl.UInt16),.
-00005eb0: 2020 2020 2020 2020 2020 2020 2270 6f72              "por
-00005ec0: 745f 7479 7065 223a 2070 6c2e 5574 6638  t_type": pl.Utf8
-00005ed0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00005ee0: 6865 6172 5f61 6e67 6c65 223a 2070 6c2e  hear_angle": pl.
-00005ef0: 466c 6f61 7436 342c 0a20 2020 2020 2020  Float64,.       
-00005f00: 207d 0a0a 2020 2020 2020 2020 7265 7475   }..        retu
-00005f10: 726e 2070 6c2e 4461 7461 4672 616d 6528  rn pl.DataFrame(
-00005f20: 0a20 2020 2020 2020 2020 2020 205b 706f  .            [po
-00005f30: 7274 2e74 6f5f 6469 6374 2829 2066 6f72  rt.to_dict() for
-00005f40: 2070 6f72 7420 696e 2073 656c 662e 6765   port in self.ge
-00005f50: 745f 706f 7274 735f 6c69 7374 2829 5d2c  t_ports_list()],
-00005f60: 2073 6368 656d 613d 636f 6c5f 7370 6563   schema=col_spec
-00005f70: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00005f80: 6465 6620 7265 6628 0a20 2020 2020 2020  def ref(.       
-00005f90: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-00005fa0: 6f73 6974 696f 6e3a 2043 6f6f 7264 696e  osition: Coordin
-00005fb0: 6174 6520 3d20 2830 2c20 3029 2c0a 2020  ate = (0, 0),.  
-00005fc0: 2020 2020 2020 706f 7274 5f69 643a 204f        port_id: O
-00005fd0: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00005fe0: 6f6e 652c 0a20 2020 2020 2020 2072 6f74  one,.        rot
-00005ff0: 6174 696f 6e3a 2066 6c6f 6174 203d 2030  ation: float = 0
-00006000: 2c0a 2020 2020 2020 2020 685f 6d69 7272  ,.        h_mirr
-00006010: 6f72 3a20 626f 6f6c 203d 2046 616c 7365  or: bool = False
-00006020: 2c0a 2020 2020 2020 2020 765f 6d69 7272  ,.        v_mirr
-00006030: 6f72 3a20 626f 6f6c 203d 2046 616c 7365  or: bool = False
-00006040: 2c0a 2020 2020 2920 2d3e 2043 6f6d 706f  ,.    ) -> Compo
-00006050: 6e65 6e74 5265 6665 7265 6e63 653a 0a20  nentReference:. 
-00006060: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00006070: 7320 436f 6d70 6f6e 656e 7420 7265 6665  s Component refe
-00006080: 7265 6e63 652e 0a0a 2020 2020 2020 2020  rence...        
-00006090: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-000060a0: 2020 706f 7369 7469 6f6e 3a20 782c 2079    position: x, y
-000060b0: 2070 6f73 6974 696f 6e2e 0a20 2020 2020   position..     
-000060c0: 2020 2020 2020 2070 6f72 745f 6964 3a20         port_id: 
-000060d0: 6e61 6d65 206f 6620 7468 6520 706f 7274  name of the port
-000060e0: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-000060f0: 7461 7469 6f6e 3a20 696e 2064 6567 7265  tation: in degre
-00006100: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00006110: 685f 6d69 7272 6f72 3a20 686f 7269 7a6f  h_mirror: horizo
-00006120: 6e74 616c 206d 6972 726f 7220 7573 696e  ntal mirror usin
-00006130: 6720 7920 6178 6973 2028 782c 2031 2920  g y axis (x, 1) 
-00006140: 2831 2c20 3029 2e0a 2020 2020 2020 2020  (1, 0)..        
-00006150: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-00006160: 7468 6520 6d6f 7374 2063 6f6d 6d6f 6e20  the most common 
-00006170: 6d69 7272 6f72 2e0a 2020 2020 2020 2020  mirror..        
-00006180: 2020 2020 765f 6d69 7272 6f72 3a20 7665      v_mirror: ve
-00006190: 7274 6963 616c 206d 6972 726f 7220 7573  rtical mirror us
-000061a0: 696e 6720 7820 6178 6973 2028 312c 2079  ing x axis (1, y
-000061b0: 2920 2830 2c20 7929 2e0a 2020 2020 2020  ) (0, y)..      
-000061c0: 2020 2222 220a 2020 2020 2020 2020 5f72    """.        _r
-000061d0: 6566 203d 2043 6f6d 706f 6e65 6e74 5265  ef = ComponentRe
-000061e0: 6665 7265 6e63 6528 7365 6c66 290a 0a20  ference(self).. 
-000061f0: 2020 2020 2020 2069 6620 706f 7274 5f69         if port_i
-00006200: 6420 616e 6420 706f 7274 5f69 6420 6e6f  d and port_id no
-00006210: 7420 696e 2073 656c 662e 706f 7274 733a  t in self.ports:
-00006220: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00006230: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-00006240: 706f 7274 207b 706f 7274 5f69 647d 206e  port {port_id} n
-00006250: 6f74 2069 6e20 7b73 656c 662e 706f 7274  ot in {self.port
-00006260: 732e 6b65 7973 2829 7d22 290a 0a20 2020  s.keys()}")..   
-00006270: 2020 2020 206f 7269 6769 6e20 3d20 7365       origin = se
-00006280: 6c66 2e70 6f72 7473 5b70 6f72 745f 6964  lf.ports[port_id
-00006290: 5d2e 6365 6e74 6572 2069 6620 706f 7274  ].center if port
-000062a0: 5f69 6420 656c 7365 2028 302c 2030 290a  _id else (0, 0).
-000062b0: 2020 2020 2020 2020 6966 2068 5f6d 6972          if h_mir
-000062c0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-000062d0: 205f 7265 662e 6d69 7272 6f72 5f78 2870   _ref.mirror_x(p
-000062e0: 6f72 745f 6964 290a 0a20 2020 2020 2020  ort_id)..       
-000062f0: 2069 6620 765f 6d69 7272 6f72 3a0a 2020   if v_mirror:.  
-00006300: 2020 2020 2020 2020 2020 5f72 6566 2e6d            _ref.m
-00006310: 6972 726f 725f 7928 706f 7274 5f69 6429  irror_y(port_id)
-00006320: 0a0a 2020 2020 2020 2020 6966 2072 6f74  ..        if rot
-00006330: 6174 696f 6e20 213d 2030 3a0a 2020 2020  ation != 0:.    
-00006340: 2020 2020 2020 2020 5f72 6566 2e72 6f74          _ref.rot
-00006350: 6174 6528 726f 7461 7469 6f6e 2c20 6f72  ate(rotation, or
-00006360: 6967 696e 290a 2020 2020 2020 2020 5f72  igin).        _r
-00006370: 6566 2e6d 6f76 6528 6f72 6967 696e 2c20  ef.move(origin, 
-00006380: 706f 7369 7469 6f6e 290a 0a20 2020 2020  position)..     
-00006390: 2020 2072 6574 7572 6e20 5f72 6566 0a0a     return _ref..
-000063a0: 2020 2020 6465 6620 7265 665f 6365 6e74      def ref_cent
-000063b0: 6572 2873 656c 662c 2070 6f73 6974 696f  er(self, positio
-000063c0: 6e3d 2830 2c20 3029 293a 0a20 2020 2020  n=(0, 0)):.     
-000063d0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-000063e0: 7265 6665 7265 6e63 6520 6f66 2074 6865  reference of the
-000063f0: 2063 6f6d 706f 6e65 6e74 2063 656e 7465   component cente
-00006400: 7265 6420 6174 2028 783d 302c 2079 3d30  red at (x=0, y=0
-00006410: 292e 2222 220a 2020 2020 2020 2020 7369  ).""".        si
-00006420: 203d 2073 656c 662e 7369 7a65 5f69 6e66   = self.size_inf
-00006430: 6f0a 2020 2020 2020 2020 7963 203d 2073  o.        yc = s
-00006440: 692e 736f 7574 6820 2b20 7369 2e68 6569  i.south + si.hei
-00006450: 6768 7420 2f20 320a 2020 2020 2020 2020  ght / 2.        
-00006460: 7863 203d 2073 692e 7765 7374 202b 2073  xc = si.west + s
-00006470: 692e 7769 6474 6820 2f20 320a 2020 2020  i.width / 2.    
-00006480: 2020 2020 6365 6e74 6572 203d 2028 7863      center = (xc
-00006490: 2c20 7963 290a 2020 2020 2020 2020 5f72  , yc).        _r
-000064a0: 6566 203d 2043 6f6d 706f 6e65 6e74 5265  ef = ComponentRe
-000064b0: 6665 7265 6e63 6528 7365 6c66 290a 2020  ference(self).  
-000064c0: 2020 2020 2020 5f72 6566 2e6d 6f76 6528        _ref.move(
-000064d0: 6365 6e74 6572 2c20 706f 7369 7469 6f6e  center, position
-000064e0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000064f0: 205f 7265 660a 0a20 2020 2064 6566 205f   _ref..    def _
-00006500: 5f72 6570 725f 5f28 7365 6c66 2920 2d3e  _repr__(self) ->
-00006510: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
-00006520: 2252 6574 7572 6e20 6120 7374 7269 6e67  "Return a string
-00006530: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
-00006540: 6f66 2074 6865 206f 626a 6563 742e 2222  of the object.""
-00006550: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00006560: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
-00006570: 227b 7365 6c66 2e6e 616d 657d 3a20 7569  "{self.name}: ui
-00006580: 6420 7b73 656c 662e 7569 647d 2c20 220a  d {self.uid}, ".
-00006590: 2020 2020 2020 2020 2020 2020 6622 706f              f"po
-000065a0: 7274 7320 7b6c 6973 7428 7365 6c66 2e70  rts {list(self.p
-000065b0: 6f72 7473 2e6b 6579 7328 2929 7d2c 2022  orts.keys())}, "
-000065c0: 0a20 2020 2020 2020 2020 2020 2066 2272  .            f"r
-000065d0: 6566 6572 656e 6365 7320 7b6c 6973 7428  eferences {list(
-000065e0: 7365 6c66 2e6e 616d 6564 5f72 6566 6572  self.named_refer
-000065f0: 656e 6365 732e 6b65 7973 2829 297d 2c20  ences.keys())}, 
-00006600: 220a 2020 2020 2020 2020 2020 2020 6622  ".            f"
-00006610: 7b6c 656e 2873 656c 662e 706f 6c79 676f  {len(self.polygo
-00006620: 6e73 297d 2070 6f6c 7967 6f6e 7322 0a20  ns)} polygons". 
-00006630: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00006640: 6620 7070 7269 6e74 2873 656c 6629 202d  f pprint(self) -
-00006650: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00006660: 2222 2250 7269 6e74 7320 636f 6d70 6f6e  """Prints compon
-00006670: 656e 7420 696e 666f 2e22 2222 0a20 2020  ent info.""".   
-00006680: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00006690: 2020 2020 2020 6672 6f6d 2072 6963 6820        from rich 
-000066a0: 696d 706f 7274 2070 7265 7474 790a 0a20  import pretty.. 
-000066b0: 2020 2020 2020 2020 2020 2070 7265 7474             prett
-000066c0: 792e 696e 7374 616c 6c28 290a 2020 2020  y.install().    
-000066d0: 2020 2020 2020 2020 7072 6574 7479 2e70          pretty.p
-000066e0: 7072 696e 7428 7365 6c66 2e74 6f5f 6469  print(self.to_di
-000066f0: 6374 2829 290a 2020 2020 2020 2020 6578  ct()).        ex
-00006700: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
-00006710: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00006720: 696e 7428 7961 6d6c 2e64 756d 7028 7365  int(yaml.dump(se
-00006730: 6c66 2e74 6f5f 6469 6374 2829 2929 0a0a  lf.to_dict()))..
-00006740: 2020 2020 6465 6620 7070 7269 6e74 5f70      def pprint_p
-00006750: 6f72 7473 2873 656c 6629 202d 3e20 4e6f  orts(self) -> No
-00006760: 6e65 3a0a 2020 2020 2020 2020 2222 2250  ne:.        """P
-00006770: 7269 6e74 7320 636f 6d70 6f6e 656e 7420  rints component 
-00006780: 6e65 746c 6973 7473 2e22 2222 0a20 2020  netlists.""".   
-00006790: 2020 2020 2070 6f72 7473 5f6c 6973 7420       ports_list 
-000067a0: 3d20 7365 6c66 2e67 6574 5f70 6f72 7473  = self.get_ports
-000067b0: 5f6c 6973 7428 290a 2020 2020 2020 2020  _list().        
-000067c0: 666f 7220 706f 7274 2069 6e20 706f 7274  for port in port
-000067d0: 735f 6c69 7374 3a0a 2020 2020 2020 2020  s_list:.        
-000067e0: 2020 2020 7072 696e 7428 706f 7274 290a      print(port).
-000067f0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00006800: 2020 2064 6566 206d 6574 6164 6174 615f     def metadata_
-00006810: 6368 696c 6428 7365 6c66 2920 2d3e 2044  child(self) -> D
-00006820: 6963 743a 0a20 2020 2020 2020 2022 2222  ict:.        """
-00006830: 5265 7475 726e 7320 6d65 7461 6461 7461  Returns metadata
-00006840: 2066 726f 6d20 6368 696c 6420 6966 2061   from child if a
-00006850: 6e79 2c20 4f74 6865 7277 6973 6520 7265  ny, Otherwise re
-00006860: 7475 726e 7320 636f 6d70 6f6e 656e 7420  turns component 
-00006870: 6f77 6e2e 0a0a 2020 2020 2020 2020 6d65  own...        me
-00006880: 7461 6461 7461 2047 7265 6174 2074 6f20  tadata Great to 
-00006890: 6163 6365 7373 2074 6865 2063 6869 6c64  access the child
-000068a0: 7265 6e20 6d65 7461 6461 7461 2061 7420  ren metadata at 
-000068b0: 7468 6520 626f 7474 6f6d 206f 6620 7468  the bottom of th
-000068c0: 650a 2020 2020 2020 2020 6869 6572 6172  e.        hierar
-000068d0: 6368 792e 0a20 2020 2020 2020 2022 2222  chy..        """
-000068e0: 0a20 2020 2020 2020 2073 6574 7469 6e67  .        setting
-000068f0: 7320 3d20 6469 6374 2873 656c 662e 7365  s = dict(self.se
-00006900: 7474 696e 6773 290a 0a20 2020 2020 2020  ttings)..       
-00006910: 2077 6869 6c65 2073 6574 7469 6e67 732e   while settings.
-00006920: 6765 7428 2263 6869 6c64 2229 3a0a 2020  get("child"):.  
-00006930: 2020 2020 2020 2020 2020 7365 7474 696e            settin
-00006940: 6773 203d 2073 6574 7469 6e67 732e 6765  gs = settings.ge
-00006950: 7428 2263 6869 6c64 2229 0a0a 2020 2020  t("child")..    
-00006960: 2020 2020 7265 7475 726e 2064 6963 7428      return dict(
-00006970: 7365 7474 696e 6773 290a 0a20 2020 2040  settings)..    @
-00006980: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00006990: 206d 6574 6164 6174 6128 7365 6c66 2920   metadata(self) 
-000069a0: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
-000069b0: 2072 6574 7572 6e20 6469 6374 2873 656c   return dict(sel
-000069c0: 662e 7365 7474 696e 6773 290a 0a20 2020  f.settings)..   
-000069d0: 2064 6566 2061 6464 5f70 6f72 7428 0a20   def add_port(. 
-000069e0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-000069f0: 2020 2020 206e 616d 653a 204f 7074 696f       name: Optio
-00006a00: 6e61 6c5b 556e 696f 6e5b 7374 722c 206f  nal[Union[str, o
-00006a10: 626a 6563 745d 5d20 3d20 4e6f 6e65 2c0a  bject]] = None,.
-00006a20: 2020 2020 2020 2020 6365 6e74 6572 3a20          center: 
-00006a30: 4f70 7469 6f6e 616c 5b54 7570 6c65 5b66  Optional[Tuple[f
-00006a40: 6c6f 6174 2c20 666c 6f61 745d 5d20 3d20  loat, float]] = 
-00006a50: 4e6f 6e65 2c0a 2020 2020 2020 2020 7769  None,.        wi
-00006a60: 6474 683a 204f 7074 696f 6e61 6c5b 666c  dth: Optional[fl
-00006a70: 6f61 745d 203d 204e 6f6e 652c 0a20 2020  oat] = None,.   
-00006a80: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
-00006a90: 3a20 4f70 7469 6f6e 616c 5b66 6c6f 6174  : Optional[float
-00006aa0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00006ab0: 2020 706f 7274 3a20 4f70 7469 6f6e 616c    port: Optional
-00006ac0: 5b50 6f72 745d 203d 204e 6f6e 652c 0a20  [Port] = None,. 
-00006ad0: 2020 2020 2020 206c 6179 6572 3a20 4f70         layer: Op
-00006ae0: 7469 6f6e 616c 5b4c 6179 6572 5370 6563  tional[LayerSpec
-00006af0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00006b00: 2020 706f 7274 5f74 7970 653a 204f 7074    port_type: Opt
-00006b10: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00006b20: 652c 0a20 2020 2020 2020 2063 726f 7373  e,.        cross
-00006b30: 5f73 6563 7469 6f6e 3a20 4f70 7469 6f6e  _section: Option
-00006b40: 616c 5b43 726f 7373 5365 6374 696f 6e5d  al[CrossSection]
-00006b50: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
-00006b60: 3e20 506f 7274 3a0a 2020 2020 2020 2020  > Port:.        
-00006b70: 2222 2241 6464 2070 6f72 7420 746f 2063  """Add port to c
-00006b80: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
-00006b90: 2020 2059 6f75 2063 616e 2063 6f70 7920     You can copy 
-00006ba0: 616e 2065 7869 7374 696e 6720 706f 7274  an existing port
-00006bb0: 206c 696b 6520 6164 645f 706f 7274 2870   like add_port(p
-00006bc0: 6f72 7420 3d20 6578 6973 7469 6e67 5f70  ort = existing_p
-00006bd0: 6f72 7429 206f 720a 2020 2020 2020 2020  ort) or.        
-00006be0: 6372 6561 7465 2061 206e 6577 2070 6f72  create a new por
-00006bf0: 7420 6164 645f 706f 7274 286d 796e 616d  t add_port(mynam
-00006c00: 652c 206d 7963 656e 7465 722c 206d 7977  e, mycenter, myw
-00006c10: 6964 7468 2c20 6d79 6f72 6965 6e74 6174  idth, myorientat
-00006c20: 696f 6e29 2e0a 2020 2020 2020 2020 596f  ion)..        Yo
-00006c30: 7520 6361 6e20 616c 736f 2063 6f70 7920  u can also copy 
-00006c40: 616e 2065 7869 7374 696e 6720 706f 7274  an existing port
-00006c50: 0a20 2020 2020 2020 2077 6974 6820 6120  .        with a 
-00006c60: 6e65 7720 6e61 6d65 2061 6464 5f70 6f72  new name add_por
-00006c70: 7428 706f 7274 203d 2065 7869 7374 696e  t(port = existin
-00006c80: 675f 706f 7274 2c20 6e61 6d65 203d 206e  g_port, name = n
-00006c90: 6577 5f6e 616d 6529 0a0a 2020 2020 2020  ew_name)..      
-00006ca0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00006cb0: 2020 2020 6e61 6d65 3a20 706f 7274 206e      name: port n
-00006cc0: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
-00006cd0: 2063 656e 7465 723a 2078 2c20 792e 0a20   center: x, y.. 
-00006ce0: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00006cf0: 3a20 696e 2075 6d2e 0a20 2020 2020 2020  : in um..       
-00006d00: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
-00006d10: 3a20 696e 2064 6567 2e0a 2020 2020 2020  : in deg..      
-00006d20: 2020 2020 2020 706f 7274 3a20 6f70 7469        port: opti
-00006d30: 6f6e 616c 2070 6f72 742e 0a20 2020 2020  onal port..     
-00006d40: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
-00006d50: 7274 206c 6179 6572 2e0a 2020 2020 2020  rt layer..      
-00006d60: 2020 2020 2020 706f 7274 5f74 7970 653a        port_type:
-00006d70: 206f 7074 6963 616c 2c20 656c 6563 7472   optical, electr
-00006d80: 6963 616c 2c20 7665 7274 6963 616c 5f64  ical, vertical_d
-00006d90: 632c 2076 6572 7469 6361 6c5f 7465 2c20  c, vertical_te, 
-00006da0: 7665 7274 6963 616c 5f74 6d2e 2044 6566  vertical_tm. Def
-00006db0: 6175 6c74 7320 746f 206f 7074 6963 616c  aults to optical
-00006dc0: 2e0a 2020 2020 2020 2020 2020 2020 6372  ..            cr
-00006dd0: 6f73 735f 7365 6374 696f 6e3a 2070 6f72  oss_section: por
-00006de0: 7420 6372 6f73 735f 7365 6374 696f 6e2e  t cross_section.
-00006df0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00006e00: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00006e10: 746f 7279 2e70 646b 2069 6d70 6f72 7420  tory.pdk import 
-00006e20: 6765 745f 6c61 7965 720a 0a20 2020 2020  get_layer..     
-00006e30: 2020 206c 6179 6572 203d 2067 6574 5f6c     layer = get_l
-00006e40: 6179 6572 286c 6179 6572 290a 0a20 2020  ayer(layer)..   
-00006e50: 2020 2020 2069 6620 706f 7274 3a0a 2020       if port:.  
-00006e60: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00006e70: 2069 7369 6e73 7461 6e63 6528 706f 7274   isinstance(port
-00006e80: 2c20 506f 7274 293a 0a20 2020 2020 2020  , Port):.       
-00006e90: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00006ea0: 616c 7565 4572 726f 7228 6622 6164 645f  alueError(f"add_
-00006eb0: 706f 7274 2829 206e 6565 6473 2061 2050  port() needs a P
-00006ec0: 6f72 742c 2067 6f74 207b 7479 7065 2870  ort, got {type(p
-00006ed0: 6f72 7429 7d22 290a 2020 2020 2020 2020  ort)}").        
-00006ee0: 2020 2020 7020 3d20 706f 7274 2e63 6f70      p = port.cop
-00006ef0: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-00006f00: 6966 206e 616d 6520 6973 206e 6f74 204e  if name is not N
-00006f10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00006f20: 2020 2020 2070 2e6e 616d 6520 3d20 6e61       p.name = na
-00006f30: 6d65 0a20 2020 2020 2020 2020 2020 2069  me.            i
-00006f40: 6620 6365 6e74 6572 2069 7320 6e6f 7420  f center is not 
-00006f50: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00006f60: 2020 2020 2020 702e 6365 6e74 6572 203d        p.center =
-00006f70: 2063 656e 7465 720a 2020 2020 2020 2020   center.        
-00006f80: 2020 2020 6966 2077 6964 7468 2069 7320      if width is 
-00006f90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00006fa0: 2020 2020 2020 2020 2020 702e 7769 6474            p.widt
-00006fb0: 6820 3d20 7769 6474 680a 2020 2020 2020  h = width.      
-00006fc0: 2020 2020 2020 6966 206f 7269 656e 7461        if orienta
-00006fd0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
-00006fe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006ff0: 2020 702e 6f72 6965 6e74 6174 696f 6e20    p.orientation 
-00007000: 3d20 6f72 6965 6e74 6174 696f 6e0a 2020  = orientation.  
-00007010: 2020 2020 2020 2020 2020 6966 2070 6f72            if por
-00007020: 745f 7479 7065 2069 7320 6e6f 7420 4e6f  t_type is not No
-00007030: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007040: 2020 2020 702e 706f 7274 5f74 7970 6520      p.port_type 
-00007050: 3d20 706f 7274 5f74 7970 650a 2020 2020  = port_type.    
-00007060: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
-00007070: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00007080: 2020 2020 2020 2020 2020 2020 2020 702e                p.
-00007090: 6c61 7965 7220 3d20 6c61 7965 720a 2020  layer = layer.  
-000070a0: 2020 2020 2020 2020 2020 702e 7061 7265            p.pare
-000070b0: 6e74 203d 2073 656c 660a 0a20 2020 2020  nt = self..     
-000070c0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-000070d0: 6365 286e 616d 652c 2050 6f72 7429 3a0a  ce(name, Port):.
-000070e0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
-000070f0: 6e61 6d65 2e63 6f70 7928 290a 2020 2020  name.copy().    
-00007100: 2020 2020 2020 2020 702e 7061 7265 6e74          p.parent
-00007110: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
-00007120: 2020 2020 6e61 6d65 203d 2070 2e6e 616d      name = p.nam
-00007130: 650a 2020 2020 2020 2020 656c 6966 2063  e.        elif c
-00007140: 656e 7465 7220 6973 204e 6f6e 653a 0a20  enter is None:. 
-00007150: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00007160: 2056 616c 7565 4572 726f 7228 2250 6f72   ValueError("Por
-00007170: 7420 6e65 6564 7320 6365 6e74 6572 2070  t needs center p
-00007180: 6172 616d 6574 6572 2028 782c 2079 2920  arameter (x, y) 
-00007190: 756d 2e22 290a 0a20 2020 2020 2020 2065  um.")..        e
-000071a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000071b0: 2070 203d 2050 6f72 7428 0a20 2020 2020   p = Port(.     
-000071c0: 2020 2020 2020 2020 2020 206e 616d 653d             name=
-000071d0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-000071e0: 2020 2020 2020 6365 6e74 6572 3d63 656e        center=cen
-000071f0: 7465 722c 0a20 2020 2020 2020 2020 2020  ter,.           
-00007200: 2020 2020 2077 6964 7468 3d77 6964 7468       width=width
-00007210: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007220: 2020 6f72 6965 6e74 6174 696f 6e3d 6f72    orientation=or
-00007230: 6965 6e74 6174 696f 6e2c 0a20 2020 2020  ientation,.     
-00007240: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00007250: 743d 7365 6c66 2c0a 2020 2020 2020 2020  t=self,.        
-00007260: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
-00007270: 7965 722c 0a20 2020 2020 2020 2020 2020  yer,.           
-00007280: 2020 2020 2070 6f72 745f 7479 7065 3d70       port_type=p
-00007290: 6f72 745f 7479 7065 206f 7220 226f 7074  ort_type or "opt
-000072a0: 6963 616c 222c 0a20 2020 2020 2020 2020  ical",.         
-000072b0: 2020 2020 2020 2063 726f 7373 5f73 6563         cross_sec
-000072c0: 7469 6f6e 3d63 726f 7373 5f73 6563 7469  tion=cross_secti
-000072d0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-000072e0: 290a 2020 2020 2020 2020 6966 206e 616d  ).        if nam
-000072f0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00007300: 2020 2020 2020 2020 2020 2070 2e6e 616d             p.nam
-00007310: 6520 3d20 6e61 6d65 0a20 2020 2020 2020  e = name.       
-00007320: 2069 6620 702e 6e61 6d65 2069 6e20 7365   if p.name in se
-00007330: 6c66 2e70 6f72 7473 3a0a 2020 2020 2020  lf.ports:.      
-00007340: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00007350: 6545 7272 6f72 2866 2261 6464 5f70 6f72  eError(f"add_por
-00007360: 7428 2920 506f 7274 206e 616d 6520 7b70  t() Port name {p
-00007370: 2e6e 616d 6521 727d 2065 7869 7374 7320  .name!r} exists 
-00007380: 696e 207b 7365 6c66 2e6e 616d 6521 727d  in {self.name!r}
-00007390: 2229 0a0a 2020 2020 2020 2020 7365 6c66  ")..        self
-000073a0: 2e70 6f72 7473 5b70 2e6e 616d 655d 203d  .ports[p.name] =
-000073b0: 2070 0a20 2020 2020 2020 2072 6574 7572   p.        retur
-000073c0: 6e20 700a 0a20 2020 2064 6566 2061 6464  n p..    def add
-000073d0: 5f70 6f72 7473 280a 2020 2020 2020 2020  _ports(.        
-000073e0: 7365 6c66 2c0a 2020 2020 2020 2020 706f  self,.        po
-000073f0: 7274 733a 2055 6e69 6f6e 5b4c 6973 745b  rts: Union[List[
-00007400: 506f 7274 5d2c 2044 6963 745b 7374 722c  Port], Dict[str,
-00007410: 2050 6f72 745d 5d2c 0a20 2020 2020 2020   Port]],.       
-00007420: 2070 7265 6669 783a 2073 7472 203d 2022   prefix: str = "
-00007430: 222c 0a20 2020 2020 2020 2073 7566 6669  ",.        suffi
-00007440: 783a 2073 7472 203d 2022 222c 0a20 2020  x: str = "",.   
-00007450: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-00007460: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-00007470: 2020 2020 2020 2222 2241 6464 2061 206c        """Add a l
-00007480: 6973 7420 6f72 2064 6963 7420 6f66 2070  ist or dict of p
-00007490: 6f72 7473 2e0a 0a20 2020 2020 2020 2079  orts...        y
-000074a0: 6f75 2063 616e 2069 6e63 6c75 6465 2061  ou can include a
-000074b0: 2070 7265 6669 7820 746f 2061 6464 2074   prefix to add t
-000074c0: 6f20 7468 6520 6e65 7720 706f 7274 206e  o the new port n
-000074d0: 616d 6573 2074 6f20 6176 6f69 6420 6e61  ames to avoid na
-000074e0: 6d65 2063 6f6e 666c 6963 7473 2e0a 0a20  me conflicts... 
-000074f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00007500: 2020 2020 2020 2020 2070 6f72 7473 3a20           ports: 
-00007510: 6c69 7374 206f 7220 6469 6374 206f 6620  list or dict of 
-00007520: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
-00007530: 2020 2070 7265 6669 783a 2074 6f20 7072     prefix: to pr
-00007540: 6570 656e 6420 746f 2065 6163 6820 706f  epend to each po
-00007550: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
-00007560: 2020 2020 2073 7566 6669 783a 2074 6f20       suffix: to 
-00007570: 6170 7065 6e64 2074 6f20 6561 6368 2070  append to each p
-00007580: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
-00007590: 2020 2222 220a 2020 2020 2020 2020 706f    """.        po
-000075a0: 7274 7320 3d20 706f 7274 7320 6966 2069  rts = ports if i
-000075b0: 7369 6e73 7461 6e63 6528 706f 7274 732c  sinstance(ports,
-000075c0: 206c 6973 7429 2065 6c73 6520 706f 7274   list) else port
-000075d0: 732e 7661 6c75 6573 2829 0a20 2020 2020  s.values().     
-000075e0: 2020 2066 6f72 2070 6f72 7420 696e 206c     for port in l
-000075f0: 6973 7428 706f 7274 7329 3a0a 2020 2020  ist(ports):.    
-00007600: 2020 2020 2020 2020 6e61 6d65 203d 2066          name = f
-00007610: 227b 7072 6566 6978 7d7b 706f 7274 2e6e  "{prefix}{port.n
-00007620: 616d 657d 7b73 7566 6669 787d 220a 2020  ame}{suffix}".  
-00007630: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00007640: 6464 5f70 6f72 7428 6e61 6d65 3d6e 616d  dd_port(name=nam
-00007650: 652c 2070 6f72 743d 706f 7274 2c20 2a2a  e, port=port, **
-00007660: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
-00007670: 2073 6e61 705f 706f 7274 735f 746f 5f67   snap_ports_to_g
-00007680: 7269 6428 7365 6c66 2c20 6e6d 3a20 696e  rid(self, nm: in
-00007690: 7420 3d20 3129 202d 3e20 4e6f 6e65 3a0a  t = 1) -> None:.
-000076a0: 2020 2020 2020 2020 666f 7220 706f 7274          for port
-000076b0: 2069 6e20 7365 6c66 2e70 6f72 7473 2e76   in self.ports.v
-000076c0: 616c 7565 7328 293a 0a20 2020 2020 2020  alues():.       
-000076d0: 2020 2020 2070 6f72 742e 736e 6170 5f74       port.snap_t
-000076e0: 6f5f 6772 6964 286e 6d3d 6e6d 290a 0a20  o_grid(nm=nm).. 
-000076f0: 2020 2064 6566 2072 656d 6f76 655f 6c61     def remove_la
-00007700: 7965 7273 280a 2020 2020 2020 2020 7365  yers(.        se
-00007710: 6c66 2c0a 2020 2020 2020 2020 6c61 7965  lf,.        laye
-00007720: 7273 3a20 4c69 7374 5b4c 6179 6572 5370  rs: List[LayerSp
-00007730: 6563 5d2c 0a20 2020 2020 2020 2069 6e63  ec],.        inc
-00007740: 6c75 6465 5f6c 6162 656c 733a 2062 6f6f  lude_labels: boo
-00007750: 6c20 3d20 5472 7565 2c0a 2020 2020 2020  l = True,.      
-00007760: 2020 696e 7665 7274 5f73 656c 6563 7469    invert_selecti
-00007770: 6f6e 3a20 626f 6f6c 203d 2046 616c 7365  on: bool = False
-00007780: 2c0a 2020 2020 2020 2020 7265 6375 7273  ,.        recurs
-00007790: 6976 653a 2062 6f6f 6c20 3d20 5472 7565  ive: bool = True
-000077a0: 2c0a 2020 2020 2920 2d3e 2043 6f6d 706f  ,.    ) -> Compo
-000077b0: 6e65 6e74 3a0a 2020 2020 2020 2020 2222  nent:.        ""
-000077c0: 2252 656d 6f76 6520 6120 6c69 7374 206f  "Remove a list o
-000077d0: 6620 6c61 7965 7273 2061 6e64 2072 6574  f layers and ret
-000077e0: 7572 6e73 2074 6865 2073 616d 6520 436f  urns the same Co
-000077f0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-00007800: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00007810: 2020 2020 6c61 7965 7273 3a20 6c69 7374      layers: list
-00007820: 206f 6620 6c61 7965 7273 2074 6f20 7265   of layers to re
-00007830: 6d6f 7665 2e0a 2020 2020 2020 2020 2020  move..          
-00007840: 2020 696e 636c 7564 655f 6c61 6265 6c73    include_labels
-00007850: 3a20 7265 6d6f 7665 206c 6162 656c 7320  : remove labels 
-00007860: 6f6e 2074 686f 7365 206c 6179 6572 732e  on those layers.
-00007870: 0a20 2020 2020 2020 2020 2020 2069 6e76  .            inv
-00007880: 6572 745f 7365 6c65 6374 696f 6e3a 2072  ert_selection: r
-00007890: 656d 6f76 6573 2061 6c6c 206c 6179 6572  emoves all layer
-000078a0: 7320 6578 6365 7074 206c 6179 6572 7320  s except layers 
-000078b0: 7370 6563 6966 6965 642e 0a20 2020 2020  specified..     
-000078c0: 2020 2020 2020 2072 6563 7572 7369 7665         recursive
-000078d0: 3a20 6f70 6572 6174 6520 6f6e 2074 6865  : operate on the
-000078e0: 2063 656c 6c73 2069 6e63 6c75 6465 6420   cells included 
-000078f0: 696e 2074 6869 7320 6365 6c6c 2e0a 2020  in this cell..  
-00007900: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00007910: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-00007920: 7920 696d 706f 7274 2067 6574 5f6c 6179  y import get_lay
-00007930: 6572 0a0a 2020 2020 2020 2020 636f 6d70  er..        comp
-00007940: 6f6e 656e 7420 3d20 7365 6c66 2e66 6c61  onent = self.fla
-00007950: 7474 656e 2829 2069 6620 7265 6375 7273  tten() if recurs
-00007960: 6976 6520 616e 6420 7365 6c66 2e72 6566  ive and self.ref
-00007970: 6572 656e 6365 7320 656c 7365 2073 656c  erences else sel
-00007980: 660a 2020 2020 2020 2020 6c61 7965 7273  f.        layers
-00007990: 203d 205b 6765 745f 6c61 7965 7228 6c61   = [get_layer(la
-000079a0: 7965 7229 2066 6f72 206c 6179 6572 2069  yer) for layer i
-000079b0: 6e20 6c61 7965 7273 5d0a 0a20 2020 2020  n layers]..     
-000079c0: 2020 2073 686f 756c 645f 7265 6d6f 7665     should_remove
-000079d0: 203d 206e 6f74 2069 6e76 6572 745f 7365   = not invert_se
-000079e0: 6c65 6374 696f 6e0a 2020 2020 2020 2020  lection.        
-000079f0: 636f 6d70 6f6e 656e 742e 5f63 656c 6c2e  component._cell.
-00007a00: 6669 6c74 6572 280a 2020 2020 2020 2020  filter(.        
-00007a10: 2020 2020 7370 6563 3d6c 6179 6572 732c      spec=layers,
-00007a20: 0a20 2020 2020 2020 2020 2020 2072 656d  .            rem
-00007a30: 6f76 653d 7368 6f75 6c64 5f72 656d 6f76  ove=should_remov
-00007a40: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
-00007a50: 6f6c 7967 6f6e 733d 5472 7565 2c0a 2020  olygons=True,.  
-00007a60: 2020 2020 2020 2020 2020 7061 7468 733d            paths=
-00007a70: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00007a80: 2020 6c61 6265 6c73 3d69 6e63 6c75 6465    labels=include
-00007a90: 5f6c 6162 656c 732c 0a20 2020 2020 2020  _labels,.       
-00007aa0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-00007ab0: 6e20 636f 6d70 6f6e 656e 740a 0a20 2020  n component..   
-00007ac0: 2064 6566 2065 7874 7261 6374 280a 2020   def extract(.  
-00007ad0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00007ae0: 2020 2020 6c61 7965 7273 3a20 4c69 7374      layers: List
-00007af0: 5b55 6e69 6f6e 5b54 7570 6c65 5b69 6e74  [Union[Tuple[int
-00007b00: 2c20 696e 745d 2c20 7374 725d 5d2c 0a20  , int], str]],. 
-00007b10: 2020 2029 202d 3e20 436f 6d70 6f6e 656e     ) -> Componen
-00007b20: 743a 0a20 2020 2020 2020 2022 2222 4578  t:.        """Ex
-00007b30: 7472 6163 7420 706f 6c79 676f 6e73 2066  tract polygons f
-00007b40: 726f 6d20 6120 436f 6d70 6f6e 656e 7420  rom a Component 
-00007b50: 616e 6420 7265 7475 726e 7320 6120 6e65  and returns a ne
-00007b60: 7720 436f 6d70 6f6e 656e 742e 2222 220a  w Component.""".
-00007b70: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-00007b80: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
-00007b90: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
-00007ba0: 2020 2020 2020 6966 2074 7970 6528 6c61        if type(la
-00007bb0: 7965 7273 2920 6e6f 7420 696e 2028 6c69  yers) not in (li
-00007bc0: 7374 2c20 7475 706c 6529 3a0a 2020 2020  st, tuple):.    
-00007bd0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00007be0: 6c75 6545 7272 6f72 2866 226c 6179 6572  lueError(f"layer
-00007bf0: 7320 7b6c 6179 6572 7321 727d 206e 6565  s {layers!r} nee
-00007c00: 6473 2074 6f20 6265 2061 206c 6973 7420  ds to be a list 
-00007c10: 6f72 2074 7570 6c65 2229 0a0a 2020 2020  or tuple")..    
-00007c20: 2020 2020 6c61 7965 7273 203d 205b 6765      layers = [ge
-00007c30: 745f 6c61 7965 7228 6c61 7965 7229 2066  t_layer(layer) f
-00007c40: 6f72 206c 6179 6572 2069 6e20 6c61 7965  or layer in laye
-00007c50: 7273 5d0a 2020 2020 2020 2020 2320 636f  rs].        # co
-00007c60: 6d70 6f6e 656e 7420 3d20 7365 6c66 2e63  mponent = self.c
-00007c70: 6f70 7928 290a 2020 2020 2020 2020 2320  opy().        # 
-00007c80: 636f 6d70 6f6e 656e 742e 5f63 656c 6c2e  component._cell.
-00007c90: 6669 6c74 6572 2873 7065 633d 6c61 7965  filter(spec=laye
-00007ca0: 7273 2c20 7265 6d6f 7665 3d46 616c 7365  rs, remove=False
-00007cb0: 290a 0a20 2020 2020 2020 2063 6f6d 706f  )..        compo
-00007cc0: 6e65 6e74 203d 2043 6f6d 706f 6e65 6e74  nent = Component
-00007cd0: 2829 0a20 2020 2020 2020 2070 6f6c 795f  ().        poly_
-00007ce0: 6469 6374 203d 2073 656c 662e 6765 745f  dict = self.get_
-00007cf0: 706f 6c79 676f 6e73 2862 795f 7370 6563  polygons(by_spec
-00007d00: 3d54 7275 652c 2069 6e63 6c75 6465 5f70  =True, include_p
-00007d10: 6174 6873 3d46 616c 7365 290a 0a20 2020  aths=False)..   
-00007d20: 2020 2020 2066 6f72 206c 6179 6572 2069       for layer i
-00007d30: 6e20 6c61 7965 7273 3a0a 2020 2020 2020  n layers:.      
-00007d40: 2020 2020 2020 6966 206c 6179 6572 2069        if layer i
-00007d50: 6e20 706f 6c79 5f64 6963 743a 0a20 2020  n poly_dict:.   
-00007d60: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-00007d70: 7967 6f6e 7320 3d20 706f 6c79 5f64 6963  ygons = poly_dic
-00007d80: 745b 6c61 7965 725d 0a20 2020 2020 2020  t[layer].       
-00007d90: 2020 2020 2020 2020 2066 6f72 2070 6f6c           for pol
-00007da0: 7967 6f6e 2069 6e20 706f 6c79 676f 6e73  ygon in polygons
-00007db0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007dc0: 2020 2020 2020 636f 6d70 6f6e 656e 742e        component.
-00007dd0: 6164 645f 706f 6c79 676f 6e28 706f 6c79  add_polygon(poly
-00007de0: 676f 6e2c 206c 6179 6572 290a 0a20 2020  gon, layer)..   
-00007df0: 2020 2020 2066 6f72 206c 6179 6572 2069       for layer i
-00007e00: 6e20 6c61 7965 7273 3a0a 2020 2020 2020  n layers:.      
-00007e10: 2020 2020 2020 666f 7220 7061 7468 2069        for path i
-00007e20: 6e20 7365 6c66 2e5f 6365 6c6c 2e67 6574  n self._cell.get
-00007e30: 5f70 6174 6873 286c 6179 6572 3d6c 6179  _paths(layer=lay
-00007e40: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
-00007e50: 2020 2020 2063 6f6d 706f 6e65 6e74 2e61       component.a
-00007e60: 6464 2870 6174 6829 0a0a 2020 2020 2020  dd(path)..      
-00007e70: 2020 7265 7475 726e 2063 6f6d 706f 6e65    return compone
-00007e80: 6e74 0a0a 2020 2020 6465 6620 6164 645f  nt..    def add_
-00007e90: 706f 6c79 676f 6e28 7365 6c66 2c20 706f  polygon(self, po
-00007ea0: 696e 7473 2c20 6c61 7965 723d 6e70 2e6e  ints, layer=np.n
-00007eb0: 616e 293a 0a20 2020 2020 2020 2022 2222  an):.        """
-00007ec0: 4164 6473 2061 2050 6f6c 7967 6f6e 2074  Adds a Polygon t
-00007ed0: 6f20 7468 6520 436f 6d70 6f6e 656e 742e  o the Component.
-00007ee0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00007ef0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00007f00: 7473 3a20 436f 6f72 6469 6e61 7465 7320  ts: Coordinates 
-00007f10: 6f66 2074 6865 2076 6572 7469 6365 7320  of the vertices 
-00007f20: 6f66 2074 6865 2050 6f6c 7967 6f6e 2e0a  of the Polygon..
-00007f30: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00007f40: 723a 206c 6179 6572 2073 7065 6320 746f  r: layer spec to
-00007f50: 2061 6464 2070 6f6c 7967 6f6e 206f 6e2e   add polygon on.
-00007f60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00007f70: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00007f80: 746f 7279 2e70 646b 2069 6d70 6f72 7420  tory.pdk import 
-00007f90: 6765 745f 6c61 7965 720a 0a20 2020 2020  get_layer..     
-00007fa0: 2020 206c 6179 6572 203d 2067 6574 5f6c     layer = get_l
-00007fb0: 6179 6572 286c 6179 6572 290a 0a20 2020  ayer(layer)..   
-00007fc0: 2020 2020 2069 6620 6c61 7965 7220 6973       if layer is
-00007fd0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007fe0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
-00007ff0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00008000: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00008010: 7374 616e 6365 286c 6179 6572 2c20 7365  stance(layer, se
-00008020: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00008030: 2020 2020 7265 7475 726e 205b 7365 6c66      return [self
-00008040: 2e61 6464 5f70 6f6c 7967 6f6e 2870 6f69  .add_polygon(poi
-00008050: 6e74 732c 206c 7929 2066 6f72 206c 7920  nts, ly) for ly 
-00008060: 696e 206c 6179 6572 5d0a 2020 2020 2020  in layer].      
-00008070: 2020 2020 2020 656c 6966 2061 6c6c 2869        elif all(i
-00008080: 7369 6e73 7461 6e63 6528 6c79 2c20 284c  sinstance(ly, (L
-00008090: 6179 6572 2929 2066 6f72 206c 7920 696e  ayer)) for ly in
-000080a0: 206c 6179 6572 293a 0a20 2020 2020 2020   layer):.       
-000080b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000080c0: 5b73 656c 662e 6164 645f 706f 6c79 676f  [self.add_polygo
-000080d0: 6e28 706f 696e 7473 2c20 6c79 2920 666f  n(points, ly) fo
-000080e0: 7220 6c79 2069 6e20 6c61 7965 725d 0a20  r ly in layer]. 
-000080f0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00008100: 6c65 6e28 6c61 7965 7229 203e 2032 3a20  len(layer) > 2: 
-00008110: 2023 2053 6f6d 656f 6e65 2077 726f 7465   # Someone wrote
-00008120: 2065 2e67 2e20 6c61 7965 7220 3d20 5b31   e.g. layer = [1
-00008130: 2c34 2c35 5d0a 2020 2020 2020 2020 2020  ,4,5].          
-00008140: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00008150: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00008160: 2020 2020 2020 2020 2020 2020 2222 2220              """ 
-00008170: 5b50 4849 444c 5d20 4966 2073 7065 6369  [PHIDL] If speci
-00008180: 6679 696e 6720 6d75 6c74 6970 6c65 206c  fying multiple l
-00008190: 6179 6572 730a 2020 2020 2020 2020 2020  ayers.          
-000081a0: 2020 2020 2020 796f 7520 6d75 7374 2075        you must u
-000081b0: 7365 2073 6574 206e 6f74 6174 696f 6e2c  se set notation,
-000081c0: 2065 2e67 2e20 7b31 2c35 2c38 7d20 2222   e.g. {1,5,8} ""
-000081d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000081e0: 2020 290a 2020 2020 2020 2020 6578 6365    ).        exce
-000081f0: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00008200: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
-00008210: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00008220: 7461 6e63 6528 706f 696e 7473 2c20 6764  tance(points, gd
-00008230: 7374 6b2e 506f 6c79 676f 6e29 3a0a 2020  stk.Polygon):.  
-00008240: 2020 2020 2020 2020 2020 2320 6966 206c            # if l
-00008250: 6179 6572 2069 7320 756e 7370 6563 6966  ayer is unspecif
-00008260: 6965 6420 6f72 206d 6174 6368 6573 206f  ied or matches o
-00008270: 7269 6769 6e61 6c20 706f 6c79 676f 6e2c  riginal polygon,
-00008280: 206a 7573 7420 6164 6420 6974 2061 732d   just add it as-
-00008290: 6973 0a20 2020 2020 2020 2020 2020 2070  is.            p
-000082a0: 6f6c 7967 6f6e 203d 2070 6f69 6e74 730a  olygon = points.
-000082b0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000082c0: 6179 6572 2069 7320 6e70 2e6e 616e 206f  ayer is np.nan o
-000082d0: 7220 280a 2020 2020 2020 2020 2020 2020  r (.            
-000082e0: 2020 2020 6973 696e 7374 616e 6365 286c      isinstance(l
-000082f0: 6179 6572 2c20 7475 706c 6529 2061 6e64  ayer, tuple) and
-00008300: 2028 706f 6c79 676f 6e2e 6c61 7965 722c   (polygon.layer,
-00008310: 2070 6f6c 7967 6f6e 2e64 6174 6174 7970   polygon.datatyp
-00008320: 6529 203d 3d20 6c61 7965 720a 2020 2020  e) == layer.    
-00008330: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-00008340: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00008350: 6f6e 203d 2050 6f6c 7967 6f6e 2870 6f6c  on = Polygon(pol
-00008360: 7967 6f6e 2e70 6f69 6e74 732c 2070 6f6c  ygon.points, pol
-00008370: 7967 6f6e 2e6c 6179 6572 2c20 706f 6c79  ygon.layer, poly
-00008380: 676f 6e2e 6461 7461 7479 7065 290a 2020  gon.datatype).  
-00008390: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000083a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083b0: 6c61 7965 722c 2064 6174 6174 7970 6520  layer, datatype 
-000083c0: 3d20 5f70 6172 7365 5f6c 6179 6572 286c  = _parse_layer(l
-000083d0: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
-000083e0: 2020 2020 2020 706f 6c79 676f 6e20 3d20        polygon = 
-000083f0: 506f 6c79 676f 6e28 706f 6c79 676f 6e2e  Polygon(polygon.
-00008400: 706f 696e 7473 2c20 6c61 7965 722c 2064  points, layer, d
-00008410: 6174 6174 7970 6529 0a0a 2020 2020 2020  atatype)..      
-00008420: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-00008430: 2870 6f69 6e74 732c 2022 7072 6f70 6572  (points, "proper
-00008440: 7469 6573 2229 3a0a 2020 2020 2020 2020  ties"):.        
-00008450: 2020 2020 2020 2020 706f 6c79 676f 6e2e          polygon.
-00008460: 7072 6f70 6572 7469 6573 203d 2064 6565  properties = dee
-00008470: 7063 6f70 7928 706f 696e 7473 2e70 726f  pcopy(points.pro
-00008480: 7065 7274 6965 7329 0a0a 2020 2020 2020  perties)..      
-00008490: 2020 2020 2020 7365 6c66 2e5f 6164 645f        self._add_
-000084a0: 706f 6c79 676f 6e73 2870 6f6c 7967 6f6e  polygons(polygon
-000084b0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000084c0: 7475 726e 2070 6f6c 7967 6f6e 0a0a 2020  turn polygon..  
-000084d0: 2020 2020 2020 656c 6966 2068 6173 6174        elif hasat
-000084e0: 7472 2870 6f69 6e74 732c 2022 6765 6f6d  tr(points, "geom
-000084f0: 7322 293a 0a20 2020 2020 2020 2020 2020  s"):.           
-00008500: 2066 6f72 2067 656f 6d20 696e 2070 6f69   for geom in poi
-00008510: 6e74 732e 6765 6f6d 733a 0a20 2020 2020  nts.geoms:.     
-00008520: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00008530: 6f6e 203d 2073 656c 662e 6164 645f 706f  on = self.add_po
-00008540: 6c79 676f 6e28 6765 6f6d 2c20 6c61 7965  lygon(geom, laye
-00008550: 723d 6c61 7965 7229 0a20 2020 2020 2020  r=layer).       
-00008560: 2020 2020 2072 6574 7572 6e20 706f 6c79       return poly
-00008570: 676f 6e0a 2020 2020 2020 2020 656c 6966  gon.        elif
-00008580: 2068 6173 6174 7472 2870 6f69 6e74 732c   hasattr(points,
-00008590: 2022 6578 7465 7269 6f72 2229 3a20 2023   "exterior"):  #
-000085a0: 2070 6f69 6e74 7320 6973 2061 2073 6861   points is a sha
-000085b0: 7065 6c79 2050 6f6c 7967 6f6e 0a20 2020  pely Polygon.   
-000085c0: 2020 2020 2020 2020 206c 6179 6572 2c20           layer, 
-000085d0: 6461 7461 7479 7065 203d 205f 7061 7273  datatype = _pars
-000085e0: 655f 6c61 7965 7228 6c61 7965 7229 0a20  e_layer(layer). 
-000085f0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00008600: 735f 6f6e 5f67 7269 6420 3d20 6e70 2e72  s_on_grid = np.r
-00008610: 6f75 6e64 2870 6f69 6e74 732e 6578 7465  ound(points.exte
-00008620: 7269 6f72 2e63 6f6f 7264 732c 2033 290a  rior.coords, 3).
-00008630: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-00008640: 676f 6e20 3d20 6764 7374 6b2e 506f 6c79  gon = gdstk.Poly
-00008650: 676f 6e28 706f 696e 7473 5f6f 6e5f 6772  gon(points_on_gr
-00008660: 6964 2c20 6c61 7965 722c 2064 6174 6174  id, layer, datat
-00008670: 7970 6529 0a0a 2020 2020 2020 2020 2020  ype)..          
-00008680: 2020 6966 2070 6f69 6e74 732e 696e 7465    if points.inte
-00008690: 7269 6f72 733a 0a20 2020 2020 2020 2020  riors:.         
-000086a0: 2020 2020 2020 2066 726f 6d20 7368 6170         from shap
-000086b0: 656c 7920 696d 706f 7274 2067 6574 5f63  ely import get_c
-000086c0: 6f6f 7264 696e 6174 6573 0a0a 2020 2020  oordinates..    
-000086d0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-000086e0: 7473 5f6f 6e5f 6772 6964 5f69 6e74 6572  ts_on_grid_inter
-000086f0: 696f 7220 3d20 6e70 2e72 6f75 6e64 2867  ior = np.round(g
-00008700: 6574 5f63 6f6f 7264 696e 6174 6573 2870  et_coordinates(p
-00008710: 6f69 6e74 732e 696e 7465 7269 6f72 7329  oints.interiors)
-00008720: 2c20 3329 0a20 2020 2020 2020 2020 2020  , 3).           
-00008730: 2020 2020 2070 6f6c 7967 6f6e 5f69 6e74       polygon_int
-00008740: 6572 696f 7220 3d20 6764 7374 6b2e 506f  erior = gdstk.Po
-00008750: 6c79 676f 6e28 0a20 2020 2020 2020 2020  lygon(.         
-00008760: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00008770: 735f 6f6e 5f67 7269 645f 696e 7465 7269  s_on_grid_interi
-00008780: 6f72 2c20 6c61 7965 722c 2064 6174 6174  or, layer, datat
-00008790: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
-000087a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000087b0: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
-000087c0: 2067 6473 746b 2e62 6f6f 6c65 616e 280a   gdstk.boolean(.
-000087d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087e0: 2020 2020 706f 6c79 676f 6e2c 0a20 2020      polygon,.   
-000087f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008800: 2070 6f6c 7967 6f6e 5f69 6e74 6572 696f   polygon_interio
-00008810: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00008820: 2020 2020 2020 206f 7065 7261 7469 6f6e         operation
-00008830: 3d22 6e6f 7422 2c0a 2020 2020 2020 2020  ="not",.        
-00008840: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00008850: 723d 6c61 7965 722c 0a20 2020 2020 2020  r=layer,.       
-00008860: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00008870: 6174 7970 653d 6461 7461 7479 7065 2c0a  atype=datatype,.
-00008880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000088a0: 2020 666f 7220 706f 6c79 676f 6e20 696e    for polygon in
-000088b0: 2070 6f6c 7967 6f6e 733a 0a20 2020 2020   polygons:.     
-000088c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000088d0: 656c 662e 5f61 6464 5f70 6f6c 7967 6f6e  elf._add_polygon
-000088e0: 7328 706f 6c79 676f 6e29 0a20 2020 2020  s(polygon).     
-000088f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008900: 6e20 706f 6c79 676f 6e0a 0a20 2020 2020  n polygon..     
-00008910: 2020 2020 2020 2073 656c 662e 5f61 6464         self._add
-00008920: 5f70 6f6c 7967 6f6e 7328 706f 6c79 676f  _polygons(polygo
-00008930: 6e29 0a20 2020 2020 2020 2020 2020 2072  n).            r
-00008940: 6574 7572 6e20 706f 6c79 676f 6e0a 0a20  eturn polygon.. 
-00008950: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
-00008960: 6e70 2e61 7361 7272 6179 2870 6f69 6e74  np.asarray(point
-00008970: 7329 0a20 2020 2020 2020 2069 6620 706f  s).        if po
-00008980: 696e 7473 2e6e 6469 6d20 3d3d 2031 3a0a  ints.ndim == 1:.
-00008990: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000089a0: 726e 205b 7365 6c66 2e61 6464 5f70 6f6c  rn [self.add_pol
-000089b0: 7967 6f6e 2870 6f6c 792c 206c 6179 6572  ygon(poly, layer
-000089c0: 3d6c 6179 6572 2920 666f 7220 706f 6c79  =layer) for poly
-000089d0: 2069 6e20 706f 696e 7473 5d0a 2020 2020   in points].    
-000089e0: 2020 2020 6966 206c 6179 6572 2069 7320      if layer is 
-000089f0: 6e70 2e6e 616e 3a0a 2020 2020 2020 2020  np.nan:.        
-00008a00: 2020 2020 6c61 7965 7220 3d20 300a 0a20      layer = 0.. 
-00008a10: 2020 2020 2020 2069 6620 706f 696e 7473         if points
-00008a20: 2e6e 6469 6d20 3d3d 2032 3a0a 2020 2020  .ndim == 2:.    
-00008a30: 2020 2020 2020 2020 2320 6164 6420 7369          # add si
-00008a40: 6e67 6c65 2070 6f6c 7967 6f6e 2066 726f  ngle polygon fro
-00008a50: 6d20 706f 696e 7473 0a20 2020 2020 2020  m points.       
-00008a60: 2020 2020 2069 6620 6c65 6e28 706f 696e       if len(poin
-00008a70: 7473 5b30 5d29 203e 2032 3a0a 2020 2020  ts[0]) > 2:.    
-00008a80: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
-00008a90: 6e76 6572 7420 746f 2066 6f72 6d20 5b5b  nvert to form [[
-00008aa0: 312c 325d 2c5b 332c 345d 2c5b 352c 365d  1,2],[3,4],[5,6]
-00008ab0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00008ac0: 2020 706f 696e 7473 203d 206e 702e 636f    points = np.co
-00008ad0: 6c75 6d6e 5f73 7461 636b 2870 6f69 6e74  lumn_stack(point
-00008ae0: 7329 0a20 2020 2020 2020 2020 2020 206c  s).            l
-00008af0: 6179 6572 2c20 6461 7461 7479 7065 203d  ayer, datatype =
-00008b00: 205f 7061 7273 655f 6c61 7965 7228 6c61   _parse_layer(la
-00008b10: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
-00008b20: 2070 6f6c 7967 6f6e 203d 2050 6f6c 7967   polygon = Polyg
-00008b30: 6f6e 2870 6f69 6e74 732c 206c 6179 6572  on(points, layer
-00008b40: 3d6c 6179 6572 2c20 6461 7461 7479 7065  =layer, datatype
-00008b50: 3d64 6174 6174 7970 6529 0a20 2020 2020  =datatype).     
-00008b60: 2020 2020 2020 2073 656c 662e 5f61 6464         self._add
-00008b70: 5f70 6f6c 7967 6f6e 7328 706f 6c79 676f  _polygons(polygo
-00008b80: 6e29 0a20 2020 2020 2020 2020 2020 2072  n).            r
-00008b90: 6574 7572 6e20 706f 6c79 676f 6e0a 2020  eturn polygon.  
-00008ba0: 2020 2020 2020 656c 6966 2070 6f69 6e74        elif point
-00008bb0: 732e 6e64 696d 203d 3d20 333a 0a20 2020  s.ndim == 3:.   
-00008bc0: 2020 2020 2020 2020 206c 6179 6572 2c20           layer, 
-00008bd0: 6461 7461 7479 7065 203d 205f 7061 7273  datatype = _pars
-00008be0: 655f 6c61 7965 7228 6c61 7965 7229 0a20  e_layer(layer). 
-00008bf0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-00008c00: 6f6e 7320 3d20 5b0a 2020 2020 2020 2020  ons = [.        
-00008c10: 2020 2020 2020 2020 506f 6c79 676f 6e28          Polygon(
-00008c20: 7070 6f69 6e74 732c 206c 6179 6572 3d6c  ppoints, layer=l
-00008c30: 6179 6572 2c20 6461 7461 7479 7065 3d64  ayer, datatype=d
-00008c40: 6174 6174 7970 6529 2066 6f72 2070 706f  atatype) for ppo
-00008c50: 696e 7473 2069 6e20 706f 696e 7473 0a20  ints in points. 
-00008c60: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-00008c70: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-00008c80: 6464 5f70 6f6c 7967 6f6e 7328 2a70 6f6c  dd_polygons(*pol
-00008c90: 7967 6f6e 7329 0a20 2020 2020 2020 2020  ygons).         
-00008ca0: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
-00008cb0: 6e73 0a20 2020 2020 2020 2065 6c73 653a  ns.        else:
-00008cc0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00008cd0: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-00008ce0: 556e 6162 6c65 2074 6f20 6164 6420 7b70  Unable to add {p
-00008cf0: 6f69 6e74 732e 6e64 696d 7d2d 6469 6d65  oints.ndim}-dime
-00008d00: 6e73 696f 6e61 6c20 706f 696e 7473 206f  nsional points o
-00008d10: 626a 6563 7422 290a 0a20 2020 2064 6566  bject")..    def
-00008d20: 205f 6164 645f 706f 6c79 676f 6e73 2873   _add_polygons(s
-00008d30: 656c 662c 202a 706f 6c79 676f 6e73 3a20  elf, *polygons: 
-00008d40: 4c69 7374 5b50 6f6c 7967 6f6e 5d29 202d  List[Polygon]) -
-00008d50: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00008d60: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
-00008d70: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00008d80: 5f63 656c 6c2e 6164 6428 2a70 6f6c 7967  _cell.add(*polyg
-00008d90: 6f6e 7329 0a0a 2020 2020 6465 6620 636f  ons)..    def co
-00008da0: 7079 2873 656c 6629 202d 3e20 436f 6d70  py(self) -> Comp
-00008db0: 6f6e 656e 743a 0a20 2020 2020 2020 2072  onent:.        r
-00008dc0: 6574 7572 6e20 636f 7079 2873 656c 6629  eturn copy(self)
-00008dd0: 0a0a 2020 2020 6465 6620 6164 645f 7265  ..    def add_re
-00008de0: 665f 636f 6e74 6169 6e65 7228 7365 6c66  f_container(self
-00008df0: 2c20 636f 6d70 6f6e 656e 743a 2043 6f6d  , component: Com
-00008e00: 706f 6e65 6e74 2920 2d3e 2043 6f6d 706f  ponent) -> Compo
-00008e10: 6e65 6e74 5265 6665 7265 6e63 653a 0a20  nentReference:. 
-00008e20: 2020 2020 2020 2022 2222 4164 6420 7265         """Add re
-00008e30: 6665 7265 6e63 652c 2070 6f72 7473 2061  ference, ports a
-00008e40: 6e64 2063 6f70 795f 6368 696c 645f 696e  nd copy_child_in
-00008e50: 666f 2e22 2222 0a20 2020 2020 2020 2072  fo.""".        r
-00008e60: 6566 203d 2073 656c 6620 3c3c 2063 6f6d  ef = self << com
-00008e70: 706f 6e65 6e74 0a20 2020 2020 2020 2073  ponent.        s
-00008e80: 656c 662e 6164 645f 706f 7274 7328 7265  elf.add_ports(re
-00008e90: 662e 706f 7274 7329 0a20 2020 2020 2020  f.ports).       
-00008ea0: 2073 656c 662e 636f 7079 5f63 6869 6c64   self.copy_child
-00008eb0: 5f69 6e66 6f28 636f 6d70 6f6e 656e 7429  _info(component)
-00008ec0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00008ed0: 7265 660a 0a20 2020 2064 6566 2063 6f70  ref..    def cop
-00008ee0: 795f 6368 696c 645f 696e 666f 2873 656c  y_child_info(sel
-00008ef0: 662c 2063 6f6d 706f 6e65 6e74 3a20 436f  f, component: Co
-00008f00: 6d70 6f6e 656e 7429 202d 3e20 4e6f 6e65  mponent) -> None
-00008f10: 3a0a 2020 2020 2020 2020 2222 2243 6f70  :.        """Cop
-00008f20: 7920 616e 6420 7365 7474 696e 6773 2069  y and settings i
-00008f30: 6e66 6f20 6672 6f6d 2063 6869 6c64 2063  nfo from child c
-00008f40: 6f6d 706f 6e65 6e74 2069 6e74 6f20 7061  omponent into pa
-00008f50: 7265 6e74 2e0a 0a20 2020 2020 2020 2050  rent...        P
-00008f60: 6172 656e 7420 636f 6d70 6f6e 656e 7473  arent components
-00008f70: 2063 616e 2061 6363 6573 7320 6368 696c   can access chil
-00008f80: 6420 6365 6c6c 7320 7365 7474 696e 6773  d cells settings
-00008f90: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00008fa0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00008fb0: 6e73 7461 6e63 6528 636f 6d70 6f6e 656e  nstance(componen
-00008fc0: 742c 2028 436f 6d70 6f6e 656e 742c 2043  t, (Component, C
-00008fd0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-00008fe0: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
-00008ff0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00009000: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00009010: 2020 2066 227b 7479 7065 2863 6f6d 706f     f"{type(compo
-00009020: 6e65 6e74 297d 2220 2269 7320 6e6f 7420  nent)}" "is not 
-00009030: 6120 436f 6d70 6f6e 656e 7420 6f72 2043  a Component or C
-00009040: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-00009050: 6522 0a20 2020 2020 2020 2020 2020 2029  e".            )
-00009060: 0a0a 2020 2020 2020 2020 7365 6c66 2e67  ..        self.g
-00009070: 6574 5f63 6869 6c64 5f6e 616d 6520 3d20  et_child_name = 
-00009080: 5472 7565 0a20 2020 2020 2020 2073 656c  True.        sel
-00009090: 662e 6368 696c 6420 3d20 636f 6d70 6f6e  f.child = compon
-000090a0: 656e 740a 2020 2020 2020 2020 7365 6c66  ent.        self
-000090b0: 2e69 6e66 6f2e 7570 6461 7465 2863 6f6d  .info.update(com
-000090c0: 706f 6e65 6e74 2e69 6e66 6f29 0a20 2020  ponent.info).   
-000090d0: 2020 2020 2073 656c 662e 7365 7474 696e       self.settin
-000090e0: 6773 2e75 7064 6174 6528 636f 6d70 6f6e  gs.update(compon
-000090f0: 656e 742e 7365 7474 696e 6773 290a 0a20  ent.settings).. 
-00009100: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00009110: 2064 6566 2073 697a 655f 696e 666f 2873   def size_info(s
-00009120: 656c 6629 202d 3e20 5369 7a65 496e 666f  elf) -> SizeInfo
-00009130: 3a0a 2020 2020 2020 2020 2222 2253 697a  :.        """Siz
-00009140: 6520 696e 666f 206f 6620 7468 6520 636f  e info of the co
-00009150: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
-00009160: 2020 2020 7265 7475 726e 2053 697a 6549      return SizeI
-00009170: 6e66 6f28 7365 6c66 2e62 626f 7829 0a0a  nfo(self.bbox)..
-00009180: 2020 2020 6465 6620 6765 745f 7365 7474      def get_sett
-00009190: 696e 6728 7365 6c66 2c20 7365 7474 696e  ing(self, settin
-000091a0: 673a 2073 7472 2920 2d3e 2055 6e69 6f6e  g: str) -> Union
-000091b0: 5b73 7472 2c20 696e 742c 2066 6c6f 6174  [str, int, float
-000091c0: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
-000091d0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-000091e0: 7365 6c66 2e69 6e66 6f2e 6765 7428 7365  self.info.get(se
-000091f0: 7474 696e 6729 0a20 2020 2020 2020 2020  tting).         
-00009200: 2020 206f 7220 7365 6c66 2e73 6574 7469     or self.setti
-00009210: 6e67 732e 6675 6c6c 2e67 6574 2873 6574  ngs.full.get(set
-00009220: 7469 6e67 290a 2020 2020 2020 2020 2020  ting).          
-00009230: 2020 6f72 2073 656c 662e 6d65 7461 6461    or self.metada
-00009240: 7461 5f63 6869 6c64 2e67 6574 2873 6574  ta_child.get(set
-00009250: 7469 6e67 290a 2020 2020 2020 2020 290a  ting).        ).
-00009260: 0a20 2020 2064 6566 2069 735f 756e 6c6f  .    def is_unlo
-00009270: 636b 6564 2873 656c 6629 202d 3e20 4e6f  cked(self) -> No
-00009280: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
-00009290: 6169 7365 7320 6572 726f 7220 6966 2043  aises error if C
-000092a0: 6f6d 706f 6e65 6e74 2069 7320 6c6f 636b  omponent is lock
-000092b0: 6564 2e22 2222 0a20 2020 2020 2020 2069  ed.""".        i
-000092c0: 6620 7365 6c66 2e5f 6c6f 636b 6564 3a0a  f self._locked:.
-000092d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000092e0: 6520 4d75 7461 6269 6c69 7479 4572 726f  e MutabilityErro
-000092f0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00009300: 2020 2066 2243 6f6d 706f 6e65 6e74 207b     f"Component {
-00009310: 7365 6c66 2e6e 616d 6521 727d 2063 616e  self.name!r} can
-00009320: 6e6f 7420 6265 206d 6f64 6966 6965 6420  not be modified 
-00009330: 6173 2069 7427 7320 616c 7265 6164 7920  as it's already 
-00009340: 6f6e 2063 6163 6865 2e20 220a 2020 2020  on cache. ".    
-00009350: 2020 2020 2020 2020 2020 2020 2b20 6d75              + mu
-00009360: 7461 6269 6c69 7479 5f65 7272 6f72 5f6d  tability_error_m
-00009370: 6573 7361 6765 0a20 2020 2020 2020 2020  essage.         
-00009380: 2020 2029 0a0a 2020 2020 6465 6620 5f61     )..    def _a
-00009390: 6464 2873 656c 662c 2065 6c65 6d65 6e74  dd(self, element
-000093a0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000093b0: 2020 2022 2222 4164 6420 6120 6e65 7720     """Add a new 
-000093c0: 656c 656d 656e 7420 6f72 206c 6973 7420  element or list 
-000093d0: 6f66 2065 6c65 6d65 6e74 7320 746f 2074  of elements to t
-000093e0: 6869 7320 436f 6d70 6f6e 656e 742e 0a0a  his Component...
-000093f0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00009400: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00009410: 743a 2050 6f6c 7967 6f6e 2c20 436f 6d70  t: Polygon, Comp
-00009420: 6f6e 656e 7452 6566 6572 656e 6365 206f  onentReference o
-00009430: 7220 6974 6572 6162 6c65 0a20 2020 2020  r iterable.     
-00009440: 2020 2020 2020 2020 2020 2054 6865 2065             The e
-00009450: 6c65 6d65 6e74 206f 7220 6974 6572 6162  lement or iterab
-00009460: 6c65 206f 6620 656c 656d 656e 7473 2074  le of elements t
-00009470: 6f20 6265 2069 6e73 6572 7465 6420 696e  o be inserted in
-00009480: 2074 6869 7320 6365 6c6c 2e0a 0a20 2020   this cell...   
-00009490: 2020 2020 2052 6169 7365 733a 0a20 2020       Raises:.   
-000094a0: 2020 2020 2020 2020 204d 7574 6162 696c           Mutabil
-000094b0: 6974 7945 7272 6f72 3a20 6966 2063 6f6d  ityError: if com
-000094c0: 706f 6e65 6e74 2069 7320 6c6f 636b 6564  ponent is locked
-000094d0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000094e0: 2020 2020 2020 7365 6c66 2e69 735f 756e        self.is_un
-000094f0: 6c6f 636b 6564 2829 0a20 2020 2020 2020  locked().       
-00009500: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
-00009510: 6c65 6d65 6e74 2c20 436f 6d70 6f6e 656e  lement, Componen
-00009520: 7452 6566 6572 656e 6365 293a 0a20 2020  tReference):.   
-00009530: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-00009540: 656c 6c2e 6164 6428 656c 656d 656e 742e  ell.add(element.
-00009550: 5f72 6566 6572 656e 6365 290a 2020 2020  _reference).    
-00009560: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-00009570: 6665 7265 6e63 6573 2e61 7070 656e 6428  ferences.append(
-00009580: 656c 656d 656e 7429 0a20 2020 2020 2020  element).       
-00009590: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000095a0: 2020 2073 656c 662e 5f63 656c 6c2e 6164     self._cell.ad
-000095b0: 6428 656c 656d 656e 7429 0a0a 2020 2020  d(element)..    
-000095c0: 6465 6620 6164 6428 7365 6c66 2c20 656c  def add(self, el
-000095d0: 656d 656e 7429 202d 3e20 4e6f 6e65 3a0a  ement) -> None:.
-000095e0: 2020 2020 2020 2020 2222 2241 6464 2061          """Add a
-000095f0: 206e 6577 2065 6c65 6d65 6e74 206f 7220   new element or 
-00009600: 6c69 7374 206f 6620 656c 656d 656e 7473  list of elements
-00009610: 2074 6f20 7468 6973 2043 6f6d 706f 6e65   to this Compone
-00009620: 6e74 2e0a 0a20 2020 2020 2020 2041 7267  nt...        Arg
-00009630: 733a 0a20 2020 2020 2020 2020 2020 2065  s:.            e
-00009640: 6c65 6d65 6e74 3a20 506f 6c79 676f 6e2c  lement: Polygon,
-00009650: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
-00009660: 6e63 6520 6f72 2069 7465 7261 626c 650a  nce or iterable.
-00009670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009680: 5468 6520 656c 656d 656e 7420 6f72 2069  The element or i
-00009690: 7465 7261 626c 6520 6f66 2065 6c65 6d65  terable of eleme
-000096a0: 6e74 7320 746f 2062 6520 696e 7365 7274  nts to be insert
-000096b0: 6564 2069 6e20 7468 6973 2063 656c 6c2e  ed in this cell.
-000096c0: 0a0a 2020 2020 2020 2020 5261 6973 6573  ..        Raises
-000096d0: 3a0a 2020 2020 2020 2020 2020 2020 4d75  :.            Mu
-000096e0: 7461 6269 6c69 7479 4572 726f 723a 2069  tabilityError: i
-000096f0: 6620 636f 6d70 6f6e 656e 7420 6973 206c  f component is l
-00009700: 6f63 6b65 642e 0a20 2020 2020 2020 2022  ocked..        "
-00009710: 2222 0a20 2020 2020 2020 2069 6620 6973  "".        if is
-00009720: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
-00009730: 2c20 436f 6d70 6f6e 656e 7452 6566 6572  , ComponentRefer
-00009740: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
-00009750: 2020 2073 656c 662e 5f72 6567 6973 7465     self._registe
-00009760: 725f 7265 6665 7265 6e63 6528 656c 656d  r_reference(elem
-00009770: 656e 7429 0a20 2020 2020 2020 2020 2020  ent).           
-00009780: 2073 656c 662e 5f61 6464 2865 6c65 6d65   self._add(eleme
-00009790: 6e74 290a 2020 2020 2020 2020 656c 6966  nt).        elif
-000097a0: 2069 7369 6e73 7461 6e63 6528 656c 656d   isinstance(elem
-000097b0: 656e 742c 2049 7465 7261 626c 6529 3a0a  ent, Iterable):.
-000097c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000097d0: 7375 6265 6c65 6d65 6e74 2069 6e20 656c  subelement in el
-000097e0: 656d 656e 743a 0a20 2020 2020 2020 2020  ement:.         
-000097f0: 2020 2020 2020 2073 656c 662e 6164 6428         self.add(
-00009800: 7375 6265 6c65 6d65 6e74 290a 2020 2020  subelement).    
-00009810: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00009820: 2020 2020 2020 7365 6c66 2e5f 6164 6428        self._add(
-00009830: 656c 656d 656e 7429 0a0a 2020 2020 6465  element)..    de
-00009840: 6620 6164 645f 6172 7261 7928 0a20 2020  f add_array(.   
-00009850: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00009860: 2020 2063 6f6d 706f 6e65 6e74 3a20 436f     component: Co
-00009870: 6d70 6f6e 656e 742c 0a20 2020 2020 2020  mponent,.       
-00009880: 2063 6f6c 756d 6e73 3a20 696e 7420 3d20   columns: int = 
-00009890: 322c 0a20 2020 2020 2020 2072 6f77 733a  2,.        rows:
-000098a0: 2069 6e74 203d 2032 2c0a 2020 2020 2020   int = 2,.      
-000098b0: 2020 7370 6163 696e 673a 2054 7570 6c65    spacing: Tuple
-000098c0: 5b66 6c6f 6174 2c20 666c 6f61 745d 203d  [float, float] =
-000098d0: 2028 3130 302c 2031 3030 292c 0a20 2020   (100, 100),.   
-000098e0: 2020 2020 2061 6c69 6173 3a20 4f70 7469       alias: Opti
-000098f0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00009900: 2c0a 2020 2020 2920 2d3e 2043 6f6d 706f  ,.    ) -> Compo
-00009910: 6e65 6e74 5265 6665 7265 6e63 653a 0a20  nentReference:. 
-00009920: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
-00009930: 7320 6120 436f 6d70 6f6e 656e 7452 6566  s a ComponentRef
-00009940: 6572 656e 6365 2072 6566 6572 656e 6365  erence reference
-00009950: 2074 6f20 6120 436f 6d70 6f6e 656e 742e   to a Component.
-00009960: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00009970: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00009980: 6f6e 656e 743a 2054 6865 2072 6566 6572  onent: The refer
-00009990: 656e 6365 6420 636f 6d70 6f6e 656e 742e  enced component.
-000099a0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-000099b0: 756d 6e73 3a20 4e75 6d62 6572 206f 6620  umns: Number of 
-000099c0: 636f 6c75 6d6e 7320 696e 2074 6865 2061  columns in the a
-000099d0: 7272 6179 2e0a 2020 2020 2020 2020 2020  rray..          
-000099e0: 2020 726f 7773 3a20 4e75 6d62 6572 206f    rows: Number o
-000099f0: 6620 726f 7773 2069 6e20 7468 6520 6172  f rows in the ar
-00009a00: 7261 792e 0a20 2020 2020 2020 2020 2020  ray..           
-00009a10: 2073 7061 6369 6e67 3a20 6172 7261 792d   spacing: array-
-00009a20: 6c69 6b65 5b32 5d20 6f66 2069 6e74 206f  like[2] of int o
-00009a30: 7220 666c 6f61 742e 0a20 2020 2020 2020  r float..       
-00009a40: 2020 2020 2020 2020 2044 6973 7461 6e63           Distanc
-00009a50: 6520 6265 7477 6565 6e20 6164 6a61 6365  e between adjace
-00009a60: 6e74 2063 6f6c 756d 6e73 2061 6e64 2061  nt columns and a
-00009a70: 646a 6163 656e 7420 726f 7773 2e0a 2020  djacent rows..  
-00009a80: 2020 2020 2020 2020 2020 616c 6961 733a            alias:
-00009a90: 2073 7472 206f 7220 4e6f 6e65 2e20 416c   str or None. Al
-00009aa0: 6961 7320 6f66 2074 6865 2072 6566 6572  ias of the refer
-00009ab0: 656e 6365 6420 436f 6d70 6f6e 656e 742e  enced Component.
-00009ac0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00009ad0: 730a 2020 2020 2020 2020 2020 2020 613a  s.            a:
-00009ae0: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
-00009af0: 6e63 6520 636f 6e74 6169 6e69 6e67 2072  nce containing r
-00009b00: 6566 6572 656e 6365 7320 746f 2074 6865  eferences to the
-00009b10: 2043 6f6d 706f 6e65 6e74 2e0a 2020 2020   Component..    
-00009b20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00009b30: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00009b40: 6528 636f 6d70 6f6e 656e 742c 2043 6f6d  e(component, Com
-00009b50: 706f 6e65 6e74 293a 0a20 2020 2020 2020  ponent):.       
-00009b60: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00009b70: 7272 6f72 2822 6164 645f 6172 7261 7928  rror("add_array(
-00009b80: 2920 6e65 6564 7320 6120 436f 6d70 6f6e  ) needs a Compon
-00009b90: 656e 7420 6f62 6a65 6374 2e22 290a 2020  ent object.").  
-00009ba0: 2020 2020 2020 7265 6620 3d20 436f 6d70        ref = Comp
-00009bb0: 6f6e 656e 7452 6566 6572 656e 6365 280a  onentReference(.
-00009bc0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00009bd0: 6f6e 656e 743d 636f 6d70 6f6e 656e 742c  onent=component,
-00009be0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00009bf0: 756d 6e73 3d69 6e74 2872 6f75 6e64 2863  umns=int(round(c
-00009c00: 6f6c 756d 6e73 2929 2c0a 2020 2020 2020  olumns)),.      
-00009c10: 2020 2020 2020 726f 7773 3d69 6e74 2872        rows=int(r
-00009c20: 6f75 6e64 2872 6f77 7329 292c 0a20 2020  ound(rows)),.   
-00009c30: 2020 2020 2020 2020 2073 7061 6369 6e67           spacing
-00009c40: 3d73 7061 6369 6e67 2c0a 2020 2020 2020  =spacing,.      
-00009c50: 2020 290a 2020 2020 2020 2020 7265 662e    ).        ref.
-00009c60: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
-00009c70: 2020 2020 7365 6c66 2e5f 6164 6428 7265      self._add(re
-00009c80: 6629 0a20 2020 2020 2020 2073 656c 662e  f).        self.
-00009c90: 5f72 6567 6973 7465 725f 7265 6665 7265  _register_refere
-00009ca0: 6e63 6528 7265 6665 7265 6e63 653d 7265  nce(reference=re
-00009cb0: 662c 2061 6c69 6173 3d61 6c69 6173 290a  f, alias=alias).
-00009cc0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00009cd0: 6566 0a0a 2020 2020 6465 6620 6469 7374  ef..    def dist
-00009ce0: 7269 6275 7465 280a 2020 2020 2020 2020  ribute(.        
-00009cf0: 7365 6c66 2c20 656c 656d 656e 7473 3d22  self, elements="
-00009d00: 616c 6c22 2c20 6469 7265 6374 696f 6e3d  all", direction=
-00009d10: 2278 222c 2073 7061 6369 6e67 3d31 3030  "x", spacing=100
-00009d20: 2c20 7365 7061 7261 7469 6f6e 3d54 7275  , separation=Tru
-00009d30: 652c 2065 6467 653d 2263 656e 7465 7222  e, edge="center"
-00009d40: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00009d50: 2222 2244 6973 7472 6962 7574 6573 2074  """Distributes t
-00009d60: 6865 2073 7065 6369 6669 6564 2065 6c65  he specified ele
-00009d70: 6d65 6e74 7320 696e 2074 6865 2043 6f6d  ments in the Com
-00009d80: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-00009d90: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00009da0: 2020 2065 6c65 6d65 6e74 7320 3a20 6172     elements : ar
-00009db0: 7261 792d 6c69 6b65 206f 6620 6f62 6a65  ray-like of obje
-00009dc0: 6374 7320 6f72 2027 616c 6c27 0a20 2020  cts or 'all'.   
-00009dd0: 2020 2020 2020 2020 2020 2020 2045 6c65               Ele
-00009de0: 6d65 6e74 7320 746f 2064 6973 7472 6962  ments to distrib
-00009df0: 7574 652e 0a20 2020 2020 2020 2020 2020  ute..           
-00009e00: 2064 6972 6563 7469 6f6e 203a 207b 2778   direction : {'x
-00009e10: 272c 2027 7927 7d0a 2020 2020 2020 2020  ', 'y'}.        
-00009e20: 2020 2020 2020 2020 4469 7265 6374 696f          Directio
-00009e30: 6e20 6f66 2064 6973 7472 6962 7574 696f  n of distributio
-00009e40: 6e3b 2065 6974 6865 7220 6120 6c69 6e65  n; either a line
-00009e50: 2069 6e20 7468 6520 782d 6469 7265 6374   in the x-direct
-00009e60: 696f 6e20 6f72 0a20 2020 2020 2020 2020  ion or.         
-00009e70: 2020 2020 2020 2079 2d64 6972 6563 7469         y-directi
-00009e80: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00009e90: 7370 6163 696e 6720 3a20 696e 7420 6f72  spacing : int or
-00009ea0: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
-00009eb0: 2020 2020 2020 2044 6973 7461 6e63 6520         Distance 
-00009ec0: 6265 7477 6565 6e20 656c 656d 656e 7473  between elements
-00009ed0: 2e0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00009ee0: 7061 7261 7469 6f6e 203a 2062 6f6f 6c0a  paration : bool.
-00009ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f00: 4966 2054 7275 652c 2067 7561 7261 6e74  If True, guarant
-00009f10: 6565 7320 656c 656d 656e 7473 2061 7265  ees elements are
-00009f20: 2073 6570 6172 6174 6564 2077 6974 6820   separated with 
-00009f30: 6120 6669 7865 6420 7370 6163 696e 670a  a fixed spacing.
-00009f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f50: 6265 7477 6565 6e3b 2069 6620 2046 616c  between; if  Fal
-00009f60: 7365 2c20 656c 656d 656e 7473 2061 7265  se, elements are
-00009f70: 2073 7061 6365 6420 6576 656e 6c79 2061   spaced evenly a
-00009f80: 6c6f 6e67 2061 2067 7269 642e 0a20 2020  long a grid..   
-00009f90: 2020 2020 2020 2020 2065 6467 6520 3a20           edge : 
-00009fa0: 7b27 7827 2c20 2778 6d69 6e27 2c20 2778  {'x', 'xmin', 'x
-00009fb0: 6d61 7827 2c20 2779 272c 2027 796d 696e  max', 'y', 'ymin
-00009fc0: 272c 2027 796d 6178 277d 0a20 2020 2020  ', 'ymax'}.     
-00009fd0: 2020 2020 2020 2020 2020 2057 6869 6368             Which
-00009fe0: 2065 6467 6520 746f 2070 6572 666f 726d   edge to perform
-00009ff0: 2074 6865 2064 6973 7472 6962 7574 696f   the distributio
-0000a000: 6e20 616c 6f6e 6720 2875 6e75 7365 6420  n along (unused 
-0000a010: 6966 0a20 2020 2020 2020 2020 2020 2020  if.             
-0000a020: 2020 2073 6570 6172 6174 696f 6e20 3d3d     separation ==
-0000a030: 2054 7275 6529 0a0a 2020 2020 2020 2020   True)..        
-0000a040: 2222 220a 2020 2020 2020 2020 6966 2065  """.        if e
-0000a050: 6c65 6d65 6e74 7320 3d3d 2022 616c 6c22  lements == "all"
-0000a060: 3a0a 2020 2020 2020 2020 2020 2020 656c  :.            el
-0000a070: 656d 656e 7473 203d 2073 656c 662e 706f  ements = self.po
-0000a080: 6c79 676f 6e73 202b 2073 656c 662e 7265  lygons + self.re
-0000a090: 6665 7265 6e63 6573 0a20 2020 2020 2020  ferences.       
-0000a0a0: 205f 6469 7374 7269 6275 7465 280a 2020   _distribute(.  
-0000a0b0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-0000a0c0: 7473 3d65 6c65 6d65 6e74 732c 0a20 2020  ts=elements,.   
-0000a0d0: 2020 2020 2020 2020 2064 6972 6563 7469           directi
-0000a0e0: 6f6e 3d64 6972 6563 7469 6f6e 2c0a 2020  on=direction,.  
-0000a0f0: 2020 2020 2020 2020 2020 7370 6163 696e            spacin
-0000a100: 673d 7370 6163 696e 672c 0a20 2020 2020  g=spacing,.     
-0000a110: 2020 2020 2020 2073 6570 6172 6174 696f         separatio
-0000a120: 6e3d 7365 7061 7261 7469 6f6e 2c0a 2020  n=separation,.  
-0000a130: 2020 2020 2020 2020 2020 6564 6765 3d65            edge=e
-0000a140: 6467 652c 0a20 2020 2020 2020 2029 0a20  dge,.        ). 
-0000a150: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000a160: 6c66 0a0a 2020 2020 6465 6620 616c 6967  lf..    def alig
-0000a170: 6e28 7365 6c66 2c20 656c 656d 656e 7473  n(self, elements
-0000a180: 3d22 616c 6c22 2c20 616c 6967 6e6d 656e  ="all", alignmen
-0000a190: 743d 2279 6d61 7822 293a 0a20 2020 2020  t="ymax"):.     
-0000a1a0: 2020 2022 2222 416c 6967 6e20 656c 656d     """Align elem
-0000a1b0: 656e 7473 2069 6e20 7468 6520 436f 6d70  ents in the Comp
-0000a1c0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
-0000a1d0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-0000a1e0: 2020 656c 656d 656e 7473 203a 2061 7272    elements : arr
-0000a1f0: 6179 2d6c 696b 6520 6f66 206f 626a 6563  ay-like of objec
-0000a200: 7473 2c20 6f72 2027 616c 6c27 0a20 2020  ts, or 'all'.   
-0000a210: 2020 2020 2020 2020 2020 2020 2045 6c65               Ele
-0000a220: 6d65 6e74 7320 696e 2074 6865 2043 6f6d  ments in the Com
-0000a230: 706f 6e65 6e74 2074 6f20 616c 6967 6e2e  ponent to align.
-0000a240: 0a20 2020 2020 2020 2020 2020 2061 6c69  .            ali
-0000a250: 676e 6d65 6e74 203a 207b 2778 272c 2027  gnment : {'x', '
-0000a260: 7927 2c20 2778 6d69 6e27 2c20 2778 6d61  y', 'xmin', 'xma
-0000a270: 7827 2c20 2779 6d69 6e27 2c20 2779 6d61  x', 'ymin', 'yma
-0000a280: 7827 7d0a 2020 2020 2020 2020 2020 2020  x'}.            
-0000a290: 2020 2020 5768 6963 6820 6564 6765 2074      Which edge t
-0000a2a0: 6f20 616c 6967 6e20 616c 6f6e 6720 2865  o align along (e
-0000a2b0: 2e67 2e20 2779 6d61 7827 2077 696c 6c20  .g. 'ymax' will 
-0000a2c0: 6d6f 7665 2074 6865 2065 6c65 6d65 6e74  move the element
-0000a2d0: 7320 7375 6368 0a20 2020 2020 2020 2020  s such.         
-0000a2e0: 2020 2020 2020 2074 6861 7420 616c 6c20         that all 
-0000a2f0: 6f66 2074 6865 6972 2074 6f70 6d6f 7374  of their topmost
-0000a300: 2070 6f69 6e74 7320 6172 6520 616c 6967   points are alig
-0000a310: 6e65 6429 2e0a 2020 2020 2020 2020 2222  ned)..        ""
-0000a320: 220a 2020 2020 2020 2020 6966 2065 6c65  ".        if ele
-0000a330: 6d65 6e74 7320 3d3d 2022 616c 6c22 3a0a  ments == "all":.
-0000a340: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-0000a350: 656e 7473 203d 2073 656c 662e 706f 6c79  ents = self.poly
-0000a360: 676f 6e73 202b 2073 656c 662e 7265 6665  gons + self.refe
-0000a370: 7265 6e63 6573 0a20 2020 2020 2020 205f  rences.        _
-0000a380: 616c 6967 6e28 656c 656d 656e 7473 2c20  align(elements, 
-0000a390: 616c 6967 6e6d 656e 743d 616c 6967 6e6d  alignment=alignm
-0000a3a0: 656e 7429 0a20 2020 2020 2020 2072 6574  ent).        ret
-0000a3b0: 7572 6e20 7365 6c66 0a0a 2020 2020 6465  urn self..    de
-0000a3c0: 6620 666c 6174 7465 6e28 7365 6c66 2c20  f flatten(self, 
-0000a3d0: 7369 6e67 6c65 5f6c 6179 6572 3a20 4f70  single_layer: Op
-0000a3e0: 7469 6f6e 616c 5b4c 6179 6572 5370 6563  tional[LayerSpec
-0000a3f0: 5d20 3d20 4e6f 6e65 293a 0a20 2020 2020  ] = None):.     
-0000a400: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-0000a410: 666c 6174 7465 6e65 6420 636f 7079 206f  flattened copy o
-0000a420: 6620 7468 6520 636f 6d70 6f6e 656e 742e  f the component.
-0000a430: 0a0a 2020 2020 2020 2020 466c 6174 7465  ..        Flatte
-0000a440: 6e73 2074 6865 2068 6965 7261 7263 6879  ns the hierarchy
-0000a450: 206f 6620 7468 6520 436f 6d70 6f6e 656e   of the Componen
-0000a460: 7420 7375 6368 2074 6861 7420 7468 6572  t such that ther
-0000a470: 6520 6172 6520 6e6f 206c 6f6e 6765 720a  e are no longer.
-0000a480: 2020 2020 2020 2020 616e 7920 7265 6665          any refe
-0000a490: 7265 6e63 6573 2074 6f20 6f74 6865 7220  rences to other 
-0000a4a0: 436f 6d70 6f6e 656e 7473 2e20 416c 6c20  Components. All 
-0000a4b0: 706f 6c79 676f 6e73 2061 6e64 206c 6162  polygons and lab
-0000a4c0: 656c 7320 6672 6f6d 0a20 2020 2020 2020  els from.       
-0000a4d0: 2075 6e64 6572 6c79 696e 6720 7265 6665   underlying refe
-0000a4e0: 7265 6e63 6573 2061 7265 2063 6f70 6965  rences are copie
-0000a4f0: 6420 616e 6420 706c 6163 6564 2069 6e20  d and placed in 
-0000a500: 7468 6520 746f 702d 6c65 7665 6c20 436f  the top-level Co
-0000a510: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
-0000a520: 2049 6620 7369 6e67 6c65 5f6c 6179 6572   If single_layer
-0000a530: 2069 7320 7370 6563 6966 6965 642c 2061   is specified, a
-0000a540: 6c6c 2070 6f6c 7967 6f6e 7320 6172 6520  ll polygons are 
-0000a550: 6d6f 7665 6420 746f 2074 6861 7420 6c61  moved to that la
-0000a560: 7965 722e 0a0a 2020 2020 2020 2020 4172  yer...        Ar
-0000a570: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000a580: 7369 6e67 6c65 5f6c 6179 6572 3a20 6d6f  single_layer: mo
-0000a590: 7665 2061 6c6c 2070 6f6c 7967 6f6e 7320  ve all polygons 
-0000a5a0: 6172 6520 6d6f 7665 6420 746f 2074 6865  are moved to the
-0000a5b0: 2073 7065 6369 6669 6564 2028 6f70 7469   specified (opti
-0000a5c0: 6f6e 616c 292e 0a20 2020 2020 2020 2022  onal)..        "
-0000a5d0: 2222 0a20 2020 2020 2020 2063 6f6d 706f  "".        compo
-0000a5e0: 6e65 6e74 5f66 6c61 7420 3d20 436f 6d70  nent_flat = Comp
-0000a5f0: 6f6e 656e 7428 290a 0a20 2020 2020 2020  onent()..       
-0000a600: 205f 6365 6c6c 203d 2073 656c 662e 5f63   _cell = self._c
-0000a610: 656c 6c2e 636f 7079 286e 616d 653d 636f  ell.copy(name=co
-0000a620: 6d70 6f6e 656e 745f 666c 6174 2e6e 616d  mponent_flat.nam
-0000a630: 6529 0a20 2020 2020 2020 205f 6365 6c6c  e).        _cell
-0000a640: 203d 205f 6365 6c6c 2e66 6c61 7474 656e   = _cell.flatten
-0000a650: 2829 0a20 2020 2020 2020 2063 6f6d 706f  ().        compo
-0000a660: 6e65 6e74 5f66 6c61 742e 5f63 656c 6c20  nent_flat._cell 
-0000a670: 3d20 5f63 656c 6c0a 2020 2020 2020 2020  = _cell.        
-0000a680: 6966 2073 696e 676c 655f 6c61 7965 7220  if single_layer 
-0000a690: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000a6a0: 2020 2020 2020 2020 2066 726f 6d20 6764           from gd
-0000a6b0: 7366 6163 746f 7279 2069 6d70 6f72 7420  sfactory import 
-0000a6c0: 6765 745f 6c61 7965 720a 0a20 2020 2020  get_layer..     
-0000a6d0: 2020 2020 2020 206c 6179 6572 2c20 6461         layer, da
-0000a6e0: 7461 7479 7065 203d 2067 6574 5f6c 6179  tatype = get_lay
-0000a6f0: 6572 2873 696e 676c 655f 6c61 7965 7229  er(single_layer)
-0000a700: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000a710: 2070 6f6c 7967 6f6e 2069 6e20 5f63 656c   polygon in _cel
-0000a720: 6c2e 706f 6c79 676f 6e73 3a0a 2020 2020  l.polygons:.    
-0000a730: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-0000a740: 676f 6e2e 6c61 7965 7220 3d20 6c61 7965  gon.layer = laye
-0000a750: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0000a760: 2020 706f 6c79 676f 6e2e 6461 7461 7479    polygon.dataty
-0000a770: 7065 203d 2064 6174 6174 7970 650a 2020  pe = datatype.  
-0000a780: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-0000a790: 7468 2069 6e20 5f63 656c 6c2e 7061 7468  th in _cell.path
-0000a7a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000a7b0: 2020 2070 6174 682e 7365 745f 6c61 7965     path.set_laye
-0000a7c0: 7273 286c 6179 6572 290a 2020 2020 2020  rs(layer).      
-0000a7d0: 2020 2020 2020 2020 2020 7061 7468 2e73            path.s
-0000a7e0: 6574 5f64 6174 6174 7970 6573 2864 6174  et_datatypes(dat
-0000a7f0: 6174 7970 6529 0a0a 2020 2020 2020 2020  atype)..        
-0000a800: 636f 6d70 6f6e 656e 745f 666c 6174 2e69  component_flat.i
-0000a810: 6e66 6f20 3d20 7365 6c66 2e69 6e66 6f2e  nfo = self.info.
-0000a820: 636f 7079 2829 0a20 2020 2020 2020 2063  copy().        c
-0000a830: 6f6d 706f 6e65 6e74 5f66 6c61 742e 6164  omponent_flat.ad
-0000a840: 645f 706f 7274 7328 7365 6c66 2e70 6f72  d_ports(self.por
-0000a850: 7473 290a 2020 2020 2020 2020 7265 7475  ts).        retu
-0000a860: 726e 2063 6f6d 706f 6e65 6e74 5f66 6c61  rn component_fla
-0000a870: 740a 0a20 2020 2064 6566 2066 6c61 7474  t..    def flatt
-0000a880: 656e 5f72 6566 6572 656e 6365 2873 656c  en_reference(sel
-0000a890: 662c 2072 6566 3a20 436f 6d70 6f6e 656e  f, ref: Componen
-0000a8a0: 7452 6566 6572 656e 6365 2920 2d3e 204e  tReference) -> N
-0000a8b0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000a8c0: 4672 6f6d 2065 7869 7374 696e 6720 6365  From existing ce
-0000a8d0: 6c6c 2072 6570 6c61 6365 7320 7265 6665  ll replaces refe
-0000a8e0: 7265 6e63 6520 7769 7468 2061 2066 6c61  rence with a fla
-0000a8f0: 7474 656e 2072 6566 6572 656e 6365 205c  tten reference \
-0000a900: 0a20 2020 2020 2020 2077 6869 6368 2068  .        which h
-0000a910: 6173 2074 6865 2074 7261 6e73 666f 726d  as the transform
-0000a920: 6174 696f 6e73 2061 6c72 6561 6479 2061  ations already a
-0000a930: 7070 6c69 6564 2e0a 0a20 2020 2020 2020  pplied...       
-0000a940: 2054 7261 6e73 666f 726d 6564 2072 6566   Transformed ref
-0000a950: 6572 656e 6365 206b 6565 7073 2074 6865  erence keeps the
-0000a960: 206f 7269 6769 6e61 6c20 6e61 6d65 2e0a   original name..
-0000a970: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-0000a980: 2020 2020 2020 2020 2020 2072 6566 3a20             ref: 
-0000a990: 7468 6520 7265 6665 7265 6e63 6520 746f  the reference to
-0000a9a0: 2066 6c61 7474 656e 2069 6e74 6f20 6120   flatten into a 
-0000a9b0: 6e65 7720 6365 6c6c 2e0a 0a20 2020 2020  new cell...     
-0000a9c0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-0000a9d0: 726f 6d20 6764 7366 6163 746f 7279 2e66  rom gdsfactory.f
-0000a9e0: 756e 6374 696f 6e73 2069 6d70 6f72 7420  unctions import 
-0000a9f0: 7472 616e 7366 6f72 6d65 640a 0a20 2020  transformed..   
-0000aa00: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
-0000aa10: 2872 6566 290a 2020 2020 2020 2020 6e65  (ref).        ne
-0000aa20: 775f 636f 6d70 6f6e 656e 7420 3d20 7472  w_component = tr
-0000aa30: 616e 7366 6f72 6d65 6428 7265 662c 2064  ansformed(ref, d
-0000aa40: 6563 6f72 6174 6f72 3d4e 6f6e 6529 0a20  ecorator=None). 
-0000aa50: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000aa60: 7265 6628 6e65 775f 636f 6d70 6f6e 656e  ref(new_componen
-0000aa70: 742c 2061 6c69 6173 3d72 6566 2e6e 616d  t, alias=ref.nam
-0000aa80: 6529 0a0a 2020 2020 6465 6620 6164 645f  e)..    def add_
-0000aa90: 7265 6628 0a20 2020 2020 2020 2073 656c  ref(.        sel
-0000aaa0: 662c 2063 6f6d 706f 6e65 6e74 3a20 436f  f, component: Co
-0000aab0: 6d70 6f6e 656e 742c 2061 6c69 6173 3a20  mponent, alias: 
-0000aac0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-0000aad0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 0a20  None, **kwargs. 
-0000aae0: 2020 2029 202d 3e20 436f 6d70 6f6e 656e     ) -> Componen
-0000aaf0: 7452 6566 6572 656e 6365 3a0a 2020 2020  tReference:.    
-0000ab00: 2020 2020 2222 2241 6464 2043 6f6d 706f      """Add Compo
-0000ab10: 6e65 6e74 5265 6665 7265 6e63 6520 746f  nentReference to
-0000ab20: 2074 6865 2063 7572 7265 6e74 2043 6f6d   the current Com
-0000ab30: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
-0000ab40: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0000ab50: 2020 2063 6f6d 706f 6e65 6e74 3a20 436f     component: Co
-0000ab60: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
-0000ab70: 2020 2020 2061 6c69 6173 3a20 6e61 6d65       alias: name
-0000ab80: 645f 7265 6665 7265 6e63 6573 2e0a 0a20  d_references... 
-0000ab90: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
-0000aba0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-0000abb0: 2063 6f6c 756d 6e73 3a20 4e75 6d62 6572   columns: Number
-0000abc0: 206f 6620 636f 6c75 6d6e 7320 696e 2074   of columns in t
-0000abd0: 6865 2061 7272 6179 2e0a 2020 2020 2020  he array..      
-0000abe0: 2020 2020 2020 726f 7773 3a20 4e75 6d62        rows: Numb
-0000abf0: 6572 206f 6620 726f 7773 2069 6e20 7468  er of rows in th
-0000ac00: 6520 6172 7261 792e 0a20 2020 2020 2020  e array..       
-0000ac10: 2020 2020 2073 7061 6369 6e67 3a20 4469       spacing: Di
-0000ac20: 7374 616e 6365 7320 6265 7477 6565 6e20  stances between 
-0000ac30: 6164 6a61 6365 6e74 2063 6f6c 756d 6e73  adjacent columns
-0000ac40: 2061 6e64 2061 646a 6163 656e 7420 726f   and adjacent ro
-0000ac50: 7773 2e0a 2020 2020 2020 2020 2020 2020  ws..            
-0000ac60: 6f72 6967 696e 3a20 6172 7261 792d 6c69  origin: array-li
-0000ac70: 6b65 5b32 5d20 6f66 2069 6e74 206f 7220  ke[2] of int or 
-0000ac80: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-0000ac90: 2020 2020 2020 506f 7369 7469 6f6e 2077        Position w
-0000aca0: 6865 7265 2074 6865 2063 656c 6c20 6973  here the cell is
-0000acb0: 2069 6e73 6572 7465 642e 0a20 2020 2020   inserted..     
-0000acc0: 2020 2020 2020 2072 6f74 6174 696f 6e20         rotation 
-0000acd0: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-0000ace0: 2020 2020 2020 2020 2020 2020 2020 2041                 A
-0000acf0: 6e67 6c65 206f 6620 726f 7461 7469 6f6e  ngle of rotation
-0000ad00: 206f 6620 7468 6520 7265 6665 7265 6e63   of the referenc
-0000ad10: 6520 2869 6e20 6064 6567 7265 6573 6029  e (in `degrees`)
-0000ad20: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
-0000ad30: 676e 6966 6963 6174 696f 6e20 3a20 696e  gnification : in
-0000ad40: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
-0000ad50: 2020 2020 2020 2020 2020 204d 6167 6e69             Magni
-0000ad60: 6669 6361 7469 6f6e 2066 6163 746f 7220  fication factor 
-0000ad70: 666f 7220 7468 6520 7265 6665 7265 6e63  for the referenc
-0000ad80: 652e 0a20 2020 2020 2020 2020 2020 2078  e..            x
-0000ad90: 5f72 6566 6c65 6374 696f 6e20 3a20 626f  _reflection : bo
-0000ada0: 6f6c 0a20 2020 2020 2020 2020 2020 2020  ol.             
-0000adb0: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-0000adc0: 7265 6665 7265 6e63 6520 6973 2072 6566  reference is ref
-0000add0: 6c65 6374 6564 2070 6172 616c 6c65 6c20  lected parallel 
-0000ade0: 746f 2074 6865 2078 2064 6972 6563 7469  to the x directi
-0000adf0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-0000ae00: 2020 2062 6566 6f72 6520 6265 696e 6720     before being 
-0000ae10: 726f 7461 7465 642e 0a20 2020 2020 2020  rotated..       
-0000ae20: 2020 2020 206e 616d 6520 3a20 7374 7220       name : str 
-0000ae30: 286f 7074 696f 6e61 6c29 0a20 2020 2020  (optional).     
-0000ae40: 2020 2020 2020 2020 2020 2041 206e 616d             A nam
-0000ae50: 6520 666f 7220 7468 6520 7265 6665 7265  e for the refere
-0000ae60: 6e63 6520 2869 6620 7072 6f76 6964 6564  nce (if provided
-0000ae70: 292e 0a0a 2020 2020 2020 2020 2222 220a  )...        """.
-0000ae80: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0000ae90: 7369 6e73 7461 6e63 6528 636f 6d70 6f6e  sinstance(compon
-0000aea0: 656e 742c 2043 6f6d 706f 6e65 6e74 293a  ent, Component):
-0000aeb0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000aec0: 7365 2054 7970 6545 7272 6f72 2866 2274  se TypeError(f"t
-0000aed0: 7970 6520 3d20 7b74 7970 6528 436f 6d70  ype = {type(Comp
-0000aee0: 6f6e 656e 7429 7d20 6e65 6564 7320 746f  onent)} needs to
-0000aef0: 2062 6520 6120 436f 6d70 6f6e 656e 742e   be a Component.
-0000af00: 2229 0a20 2020 2020 2020 2072 6566 203d  ").        ref =
-0000af10: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
-0000af20: 6e63 6528 636f 6d70 6f6e 656e 742c 202a  nce(component, *
-0000af30: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0000af40: 2073 656c 662e 5f61 6464 2872 6566 290a   self._add(ref).
-0000af50: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-0000af60: 6769 7374 6572 5f72 6566 6572 656e 6365  gister_reference
-0000af70: 2872 6566 6572 656e 6365 3d72 6566 2c20  (reference=ref, 
-0000af80: 616c 6961 733d 616c 6961 7329 0a20 2020  alias=alias).   
-0000af90: 2020 2020 2072 6574 7572 6e20 7265 660a       return ref.
-0000afa0: 0a20 2020 2064 6566 205f 7265 6769 7374  .    def _regist
-0000afb0: 6572 5f72 6566 6572 656e 6365 280a 2020  er_reference(.  
-0000afc0: 2020 2020 2020 7365 6c66 2c20 7265 6665        self, refe
-0000afd0: 7265 6e63 653a 2043 6f6d 706f 6e65 6e74  rence: Component
-0000afe0: 5265 6665 7265 6e63 652c 2061 6c69 6173  Reference, alias
-0000aff0: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-0000b000: 3d20 4e6f 6e65 0a20 2020 2029 202d 3e20  = None.    ) -> 
-0000b010: 4e6f 6e65 3a0a 2020 2020 2020 2020 636f  None:.        co
-0000b020: 6d70 6f6e 656e 7420 3d20 7265 6665 7265  mponent = refere
-0000b030: 6e63 652e 7061 7265 6e74 0a20 2020 2020  nce.parent.     
-0000b040: 2020 2072 6566 6572 656e 6365 2e6f 776e     reference.own
-0000b050: 6572 203d 2073 656c 660a 0a20 2020 2020  er = self..     
-0000b060: 2020 2069 6620 616c 6961 7320 6973 204e     if alias is N
-0000b070: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000b080: 2069 6620 7265 6665 7265 6e63 652e 6e61   if reference.na
-0000b090: 6d65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  me is not None:.
-0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0b0: 616c 6961 7320 3d20 7265 6665 7265 6e63  alias = referenc
-0000b0c0: 652e 6e61 6d65 0a20 2020 2020 2020 2020  e.name.         
-0000b0d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000b0e0: 2020 2020 2020 2020 2070 7265 6669 7820           prefix 
-0000b0f0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000b100: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-0000b110: 742e 7365 7474 696e 6773 2e66 756e 6374  t.settings.funct
-0000b120: 696f 6e5f 6e61 6d65 0a20 2020 2020 2020  ion_name.       
-0000b130: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000b140: 6861 7361 7474 7228 636f 6d70 6f6e 656e  hasattr(componen
-0000b150: 742c 2022 7365 7474 696e 6773 2229 0a20  t, "settings"). 
-0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b170: 2020 2061 6e64 2068 6173 6174 7472 2863     and hasattr(c
-0000b180: 6f6d 706f 6e65 6e74 2e73 6574 7469 6e67  omponent.setting
-0000b190: 732c 2022 6675 6e63 7469 6f6e 5f6e 616d  s, "function_nam
-0000b1a0: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-0000b1b0: 2020 2020 2020 2020 656c 7365 2063 6f6d          else com
-0000b1c0: 706f 6e65 6e74 2e6e 616d 650a 2020 2020  ponent.name.    
-0000b1d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000b1e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000b1f0: 6c66 2e5f 7265 6665 7265 6e63 655f 6e61  lf._reference_na
-0000b200: 6d65 735f 636f 756e 7465 722e 7570 6461  mes_counter.upda
-0000b210: 7465 287b 7072 6566 6978 3a20 317d 290a  te({prefix: 1}).
-0000b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b230: 616c 6961 7320 3d20 6622 7b70 7265 6669  alias = f"{prefi
-0000b240: 787d 5f7b 7365 6c66 2e5f 7265 6665 7265  x}_{self._refere
-0000b250: 6e63 655f 6e61 6d65 735f 636f 756e 7465  nce_names_counte
-0000b260: 725b 7072 6566 6978 5d7d 220a 0a20 2020  r[prefix]}"..   
-0000b270: 2020 2020 2020 2020 2020 2020 2077 6869               whi
-0000b280: 6c65 2061 6c69 6173 2069 6e20 7365 6c66  le alias in self
-0000b290: 2e5f 6e61 6d65 645f 7265 6665 7265 6e63  ._named_referenc
-0000b2a0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000b2b0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-0000b2c0: 6665 7265 6e63 655f 6e61 6d65 735f 636f  ference_names_co
-0000b2d0: 756e 7465 722e 7570 6461 7465 287b 7072  unter.update({pr
-0000b2e0: 6566 6978 3a20 317d 290a 2020 2020 2020  efix: 1}).      
-0000b2f0: 2020 2020 2020 2020 2020 2020 2020 616c                al
-0000b300: 6961 7320 3d20 6622 7b70 7265 6669 787d  ias = f"{prefix}
-0000b310: 5f7b 7365 6c66 2e5f 7265 6665 7265 6e63  _{self._referenc
-0000b320: 655f 6e61 6d65 735f 636f 756e 7465 725b  e_names_counter[
-0000b330: 7072 6566 6978 5d7d 220a 0a20 2020 2020  prefix]}"..     
-0000b340: 2020 2072 6566 6572 656e 6365 2e6e 616d     reference.nam
-0000b350: 6520 3d20 616c 6961 730a 2020 2020 2020  e = alias.      
-0000b360: 2020 7365 6c66 2e5f 6e61 6d65 645f 7265    self._named_re
-0000b370: 6665 7265 6e63 6573 5b61 6c69 6173 5d20  ferences[alias] 
-0000b380: 3d20 7265 6665 7265 6e63 650a 0a20 2020  = reference..   
-0000b390: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-0000b3a0: 6566 206c 6179 6572 7328 7365 6c66 2920  ef layers(self) 
-0000b3b0: 2d3e 2053 6574 5b54 7570 6c65 5b69 6e74  -> Set[Tuple[int
-0000b3c0: 2c20 696e 745d 5d3a 0a20 2020 2020 2020  , int]]:.       
-0000b3d0: 2022 2222 5265 7475 726e 7320 6120 7365   """Returns a se
-0000b3e0: 7420 6f66 2074 6865 204c 6179 6572 7320  t of the Layers 
-0000b3f0: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
-0000b400: 2e22 2222 0a20 2020 2020 2020 2072 6574  .""".        ret
-0000b410: 7572 6e20 7365 6c66 2e67 6574 5f6c 6179  urn self.get_lay
-0000b420: 6572 7328 290a 0a20 2020 2064 6566 2067  ers()..    def g
-0000b430: 6574 5f6c 6179 6572 7328 7365 6c66 2920  et_layers(self) 
-0000b440: 2d3e 2053 6574 5b54 7570 6c65 5b69 6e74  -> Set[Tuple[int
-0000b450: 2c20 696e 745d 5d3a 0a20 2020 2020 2020  , int]]:.       
-0000b460: 2022 2222 5265 7475 726e 2061 2073 6574   """Return a set
-0000b470: 206f 6620 286c 6179 6572 2c20 6461 7461   of (layer, data
-0000b480: 7479 7065 292e 0a0a 2020 2020 2020 2020  type)...        
-0000b490: 2e2e 2063 6f64 6520 3a3a 0a0a 2020 2020  .. code ::..    
-0000b4a0: 2020 2020 2020 2020 696d 706f 7274 2067          import g
-0000b4b0: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-0000b4c0: 2020 2020 2020 2020 2020 2020 6766 2e63              gf.c
-0000b4d0: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
-0000b4e0: 6874 2829 2e67 6574 5f6c 6179 6572 7328  ht().get_layers(
-0000b4f0: 2920 3d3d 207b 2831 2c20 3029 2c20 2831  ) == {(1, 0), (1
-0000b500: 3131 2c20 3029 7d0a 2020 2020 2020 2020  11, 0)}.        
-0000b510: 2222 220a 2020 2020 2020 2020 706f 6c79  """.        poly
-0000b520: 676f 6e73 203d 2073 656c 662e 5f63 656c  gons = self._cel
-0000b530: 6c2e 6765 745f 706f 6c79 676f 6e73 2864  l.get_polygons(d
-0000b540: 6570 7468 3d4e 6f6e 6529 0a20 2020 2020  epth=None).     
-0000b550: 2020 2072 6574 7572 6e20 7b28 706f 6c79     return {(poly
-0000b560: 676f 6e2e 6c61 7965 722c 2070 6f6c 7967  gon.layer, polyg
-0000b570: 6f6e 2e64 6174 6174 7970 6529 2066 6f72  on.datatype) for
-0000b580: 2070 6f6c 7967 6f6e 2069 6e20 706f 6c79   polygon in poly
-0000b590: 676f 6e73 7d0a 0a20 2020 2064 6566 2067  gons}..    def g
-0000b5a0: 6574 5f6c 6179 6572 5f6e 616d 6573 2873  et_layer_names(s
-0000b5b0: 656c 6629 202d 3e20 4c69 7374 5b54 7570  elf) -> List[Tup
-0000b5c0: 6c65 5b69 6e74 2c20 696e 745d 5d3a 0a20  le[int, int]]:. 
-0000b5d0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-0000b5e0: 206c 6179 6572 206e 616d 6573 2075 7365   layer names use
-0000b5f0: 6420 696e 2074 6865 2064 6573 6967 6e2e  d in the design.
-0000b600: 0a0a 2020 2020 2020 2020 2e2e 2063 6f64  ..        .. cod
-0000b610: 6520 3a3a 0a0a 2020 2020 2020 2020 2020  e ::..          
-0000b620: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
-0000b630: 6f72 7920 6173 2067 660a 2020 2020 2020  ory as gf.      
-0000b640: 2020 2020 2020 6766 2e63 6f6d 706f 6e65        gf.compone
-0000b650: 6e74 732e 7374 7261 6967 6874 2829 2e67  nts.straight().g
-0000b660: 6574 5f6e 616d 6573 2829 203d 3d20 5b27  et_names() == ['
-0000b670: 5747 275d 0a20 2020 2020 2020 2022 2222  WG'].        """
-0000b680: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-0000b690: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
-0000b6a0: 0a0a 2020 2020 2020 2020 5044 4b20 3d20  ..        PDK = 
-0000b6b0: 6766 2e67 6574 5f61 6374 6976 655f 7064  gf.get_active_pd
-0000b6c0: 6b28 290a 2020 2020 2020 2020 4c41 5945  k().        LAYE
-0000b6d0: 5253 203d 2050 444b 2e6c 6179 6572 730a  RS = PDK.layers.
-0000b6e0: 2020 2020 2020 2020 6e61 6d65 5f74 6f5f          name_to_
-0000b6f0: 6c61 7965 7220 3d20 6469 6374 284c 4159  layer = dict(LAY
-0000b700: 4552 5329 0a20 2020 2020 2020 206c 6179  ERS).        lay
-0000b710: 6572 5f74 6f5f 6e61 6d65 203d 207b 763a  er_to_name = {v:
-0000b720: 206b 2066 6f72 206b 2c20 7620 696e 206e   k for k, v in n
-0000b730: 616d 655f 746f 5f6c 6179 6572 2e69 7465  ame_to_layer.ite
-0000b740: 6d73 2829 7d0a 2020 2020 2020 2020 6c61  ms()}.        la
-0000b750: 7965 725f 6e61 6d65 7320 3d20 5b5d 0a0a  yer_names = []..
-0000b760: 2020 2020 2020 2020 666f 7220 6c61 7965          for laye
-0000b770: 7220 696e 2073 656c 662e 6c61 7965 7273  r in self.layers
-0000b780: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000b790: 206c 6179 6572 206e 6f74 2069 6e20 6c61   layer not in la
-0000b7a0: 7965 725f 746f 5f6e 616d 653a 0a20 2020  yer_to_name:.   
-0000b7b0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0000b7c0: 6e69 6e67 732e 7761 726e 2866 227b 6c61  nings.warn(f"{la
-0000b7d0: 7965 727d 206e 6f74 2069 6e20 4c61 7965  yer} not in Laye
-0000b7e0: 724d 6170 2e22 2c20 7374 6163 6b6c 6576  rMap.", stacklev
-0000b7f0: 656c 3d33 290a 2020 2020 2020 2020 2020  el=3).          
-0000b800: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b810: 2020 2020 2020 2020 6c61 7965 725f 6e61          layer_na
-0000b820: 6d65 732e 6170 7065 6e64 286c 6179 6572  mes.append(layer
-0000b830: 5f74 6f5f 6e61 6d65 5b6c 6179 6572 5d29  _to_name[layer])
-0000b840: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000b850: 6c61 7965 725f 6e61 6d65 730a 0a20 2020  layer_names..   
-0000b860: 2064 6566 205f 6970 7974 686f 6e5f 6469   def _ipython_di
-0000b870: 7370 6c61 795f 2873 656c 6629 202d 3e20  splay_(self) -> 
-0000b880: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000b890: 2253 686f 7720 6765 6f6d 6574 7279 2069  "Show geometry i
-0000b8a0: 6e20 4b4c 6179 6f75 7420 616e 6420 696e  n KLayout and in
-0000b8b0: 206d 6174 706c 6f74 6c69 6220 666f 7220   matplotlib for 
-0000b8c0: 4a75 7079 7465 7220 4e6f 7465 626f 6f6b  Jupyter Notebook
-0000b8d0: 732e 2222 220a 2020 2020 2020 2020 7365  s.""".        se
-0000b8e0: 6c66 2e73 686f 7728 7368 6f77 5f70 6f72  lf.show(show_por
-0000b8f0: 7473 3d54 7275 6529 2020 2320 7368 6f77  ts=True)  # show
-0000b900: 2069 6e20 6b6c 6179 6f75 740a 2020 2020   in klayout.    
-0000b910: 2020 2020 7365 6c66 2e70 6c6f 745f 6b6c      self.plot_kl
-0000b920: 6179 6f75 7428 290a 2020 2020 2020 2020  ayout().        
-0000b930: 7072 696e 7428 7365 6c66 290a 0a20 2020  print(self)..   
-0000b940: 2064 6566 2061 6464 5f70 696e 735f 7472   def add_pins_tr
-0000b950: 6961 6e67 6c65 280a 2020 2020 2020 2020  iangle(.        
-0000b960: 7365 6c66 2c0a 2020 2020 2020 2020 706f  self,.        po
-0000b970: 7274 5f6d 6172 6b65 725f 6c61 7965 723a  rt_marker_layer:
-0000b980: 204c 6179 6572 203d 2028 312c 2031 3029   Layer = (1, 10)
-0000b990: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-0000b9a0: 2022 2222 5265 7475 726e 7320 636f 6d70   """Returns comp
-0000b9b0: 6f6e 656e 7420 7769 7468 2074 7269 616e  onent with trian
-0000b9c0: 6775 6c61 7220 7069 6e73 2e22 2222 0a20  gular pins.""". 
-0000b9d0: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-0000b9e0: 6163 746f 7279 2e61 6464 5f70 696e 7320  actory.add_pins 
-0000b9f0: 696d 706f 7274 2061 6464 5f70 696e 735f  import add_pins_
-0000ba00: 7472 6961 6e67 6c65 0a0a 2020 2020 2020  triangle..      
-0000ba10: 2020 636f 6d70 6f6e 656e 7420 3d20 7365    component = se
-0000ba20: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-0000ba30: 2020 636f 6d70 6f6e 656e 742e 6e61 6d65    component.name
-0000ba40: 203d 2073 656c 662e 6e61 6d65 0a20 2020   = self.name.   
-0000ba50: 2020 2020 2061 6464 5f70 696e 735f 7472       add_pins_tr
-0000ba60: 6961 6e67 6c65 2863 6f6d 706f 6e65 6e74  iangle(component
-0000ba70: 3d63 6f6d 706f 6e65 6e74 2c20 6c61 7965  =component, laye
-0000ba80: 723d 706f 7274 5f6d 6172 6b65 725f 6c61  r=port_marker_la
-0000ba90: 7965 7229 0a20 2020 2020 2020 2072 6574  yer).        ret
-0000baa0: 7572 6e20 636f 6d70 6f6e 656e 740a 0a20  urn component.. 
-0000bab0: 2020 2064 6566 2070 6c6f 745f 7769 6467     def plot_widg
-0000bac0: 6574 280a 2020 2020 2020 2020 7365 6c66  et(.        self
-0000bad0: 2c0a 2020 2020 2020 2020 7368 6f77 5f70  ,.        show_p
-0000bae0: 6f72 7473 3a20 626f 6f6c 203d 2054 7275  orts: bool = Tru
-0000baf0: 652c 0a20 2020 2020 2020 2070 6f72 745f  e,.        port_
-0000bb00: 6d61 726b 6572 5f6c 6179 6572 3a20 4c61  marker_layer: La
-0000bb10: 7965 7220 3d20 2831 2c20 3130 292c 0a20  yer = (1, 10),. 
-0000bb20: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-0000bb30: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-0000bb40: 2069 7079 7468 6f6e 2077 6964 6765 7420   ipython widget 
-0000bb50: 666f 7220 6b6c 6179 6f75 7420 7669 7375  for klayout visu
-0000bb60: 616c 697a 6174 696f 6e2e 0a0a 2020 2020  alization...    
-0000bb70: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-0000bb80: 2020 2020 2020 7368 6f77 5f70 6f72 7473        show_ports
-0000bb90: 3a20 7368 6f77 7320 636f 6d70 6f6e 656e  : shows componen
-0000bba0: 7420 7769 7468 2070 6f72 7420 6d61 726b  t with port mark
-0000bbb0: 6572 7320 616e 6420 6c61 6265 6c73 2e0a  ers and labels..
-0000bbc0: 2020 2020 2020 2020 2020 2020 706f 7274              port
-0000bbd0: 5f6d 6172 6b65 725f 6c61 7965 723a 2066  _marker_layer: f
-0000bbe0: 6f72 2074 6865 2070 6f72 7473 2e0a 2020  or the ports..  
-0000bbf0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000bc00: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-0000bc10: 792e 7064 6b20 696d 706f 7274 2067 6574  y.pdk import get
-0000bc20: 5f6c 6179 6572 5f76 6965 7773 0a20 2020  _layer_views.   
-0000bc30: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-0000bc40: 746f 7279 2e77 6964 6765 7473 2e6c 6179  tory.widgets.lay
-0000bc50: 6f75 745f 7669 6577 6572 2069 6d70 6f72  out_viewer impor
-0000bc60: 7420 4c61 796f 7574 5669 6577 6572 0a20  t LayoutViewer. 
-0000bc70: 2020 2020 2020 2066 726f 6d20 4950 7974         from IPyt
-0000bc80: 686f 6e2e 6469 7370 6c61 7920 696d 706f  hon.display impo
-0000bc90: 7274 2064 6973 706c 6179 0a0a 2020 2020  rt display..    
-0000bca0: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
-0000bcb0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0000bcc0: 6c66 2e61 6464 5f70 696e 735f 7472 6961  lf.add_pins_tria
-0000bcd0: 6e67 6c65 2870 6f72 745f 6d61 726b 6572  ngle(port_marker
-0000bce0: 5f6c 6179 6572 3d70 6f72 745f 6d61 726b  _layer=port_mark
-0000bcf0: 6572 5f6c 6179 6572 290a 2020 2020 2020  er_layer).      
-0000bd00: 2020 2020 2020 6966 2073 686f 775f 706f        if show_po
-0000bd10: 7274 730a 2020 2020 2020 2020 2020 2020  rts.            
-0000bd20: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
-0000bd30: 2020 290a 0a20 2020 2020 2020 2067 6473    )..        gds
-0000bd40: 7061 7468 203d 2063 6f6d 706f 6e65 6e74  path = component
-0000bd50: 2e77 7269 7465 5f67 6473 286c 6f67 6769  .write_gds(loggi
-0000bd60: 6e67 3d46 616c 7365 290a 2020 2020 2020  ng=False).      
-0000bd70: 2020 6c79 705f 7061 7468 203d 2067 6473    lyp_path = gds
-0000bd80: 7061 7468 2e77 6974 685f 7375 6666 6978  path.with_suffix
-0000bd90: 2822 2e6c 7970 2229 0a0a 2020 2020 2020  (".lyp")..      
-0000bda0: 2020 6c61 7965 725f 7669 6577 7320 3d20    layer_views = 
-0000bdb0: 6765 745f 6c61 7965 725f 7669 6577 7328  get_layer_views(
-0000bdc0: 290a 2020 2020 2020 2020 6c61 7965 725f  ).        layer_
-0000bdd0: 7669 6577 732e 746f 5f6c 7970 2866 696c  views.to_lyp(fil
-0000bde0: 6570 6174 683d 6c79 705f 7061 7468 290a  epath=lyp_path).
-0000bdf0: 0a20 2020 2020 2020 206c 6179 6f75 7420  .        layout 
-0000be00: 3d20 4c61 796f 7574 5669 6577 6572 2867  = LayoutViewer(g
-0000be10: 6473 7061 7468 2c20 6c79 705f 7061 7468  dspath, lyp_path
-0000be20: 290a 2020 2020 2020 2020 6469 7370 6c61  ).        displa
-0000be30: 7928 6c61 796f 7574 2e77 6964 6765 7429  y(layout.widget)
-0000be40: 0a0a 2020 2020 6465 6620 706c 6f74 5f6b  ..    def plot_k
-0000be50: 6c61 796f 7574 280a 2020 2020 2020 2020  layout(.        
-0000be60: 7365 6c66 2c0a 2020 2020 2020 2020 7368  self,.        sh
-0000be70: 6f77 5f70 6f72 7473 3a20 626f 6f6c 203d  ow_ports: bool =
-0000be80: 2054 7275 652c 0a20 2020 2020 2020 2070   True,.        p
-0000be90: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
-0000bea0: 3a20 4c61 7965 7220 3d20 2831 2c20 3130  : Layer = (1, 10
-0000beb0: 292c 0a20 2020 2020 2020 2073 686f 775f  ),.        show_
-0000bec0: 6c61 6265 6c73 3a20 626f 6f6c 203d 2046  labels: bool = F
-0000bed0: 616c 7365 2c0a 2020 2020 2920 2d3e 204e  alse,.    ) -> N
-0000bee0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-0000bef0: 5265 7475 726e 7320 6b6c 6179 6f75 7420  Returns klayout 
-0000bf00: 696d 6167 652e 0a0a 2020 2020 2020 2020  image...        
-0000bf10: 4966 2069 7420 6661 696c 7320 746f 2069  If it fails to i
-0000bf20: 6d70 6f72 7420 6b6c 6179 6f75 7420 6465  mport klayout de
-0000bf30: 6661 756c 7473 2074 6f20 6d61 7470 6c6f  faults to matplo
-0000bf40: 746c 6962 2e0a 0a20 2020 2020 2020 2041  tlib...        A
-0000bf50: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-0000bf60: 2073 686f 775f 706f 7274 733a 2073 686f   show_ports: sho
-0000bf70: 7773 2063 6f6d 706f 6e65 6e74 2077 6974  ws component wit
-0000bf80: 6820 706f 7274 206d 6172 6b65 7273 2061  h port markers a
-0000bf90: 6e64 206c 6162 656c 732e 0a20 2020 2020  nd labels..     
-0000bfa0: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
-0000bfb0: 6572 5f6c 6179 6572 3a20 666f 7220 7468  er_layer: for th
-0000bfc0: 6520 706f 7274 732e 0a20 2020 2020 2020  e ports..       
-0000bfd0: 2020 2020 2073 686f 775f 6c61 6265 6c73       show_labels
-0000bfe0: 3a20 7368 6f77 7320 6c61 6265 6c73 2e0a  : shows labels..
-0000bff0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000c000: 2020 2020 2063 6f6d 706f 6e65 6e74 203d       component =
-0000c010: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
-0000c020: 656c 662e 6164 645f 7069 6e73 5f74 7269  elf.add_pins_tri
-0000c030: 616e 676c 6528 706f 7274 5f6d 6172 6b65  angle(port_marke
-0000c040: 725f 6c61 7965 723d 706f 7274 5f6d 6172  r_layer=port_mar
-0000c050: 6b65 725f 6c61 7965 7229 0a20 2020 2020  ker_layer).     
-0000c060: 2020 2020 2020 2069 6620 7368 6f77 5f70         if show_p
-0000c070: 6f72 7473 0a20 2020 2020 2020 2020 2020  orts.           
-0000c080: 2065 6c73 6520 7365 6c66 0a20 2020 2020   else self.     
-0000c090: 2020 2029 0a0a 2020 2020 2020 2020 7472     )..        tr
-0000c0a0: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-0000c0b0: 6d70 6f72 7420 6b6c 6179 6f75 742e 6462  mport klayout.db
-0000c0c0: 2061 7320 6462 2020 2320 6e6f 7161 3a20   as db  # noqa: 
-0000c0d0: 4634 3031 0a20 2020 2020 2020 2020 2020  F401.           
-0000c0e0: 2069 6d70 6f72 7420 6b6c 6179 6f75 742e   import klayout.
-0000c0f0: 6c61 7920 6173 206c 6179 0a20 2020 2020  lay as lay.     
-0000c100: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-0000c110: 6163 746f 7279 2e70 646b 2069 6d70 6f72  actory.pdk impor
-0000c120: 7420 6765 745f 6c61 7965 725f 7669 6577  t get_layer_view
-0000c130: 730a 2020 2020 2020 2020 2020 2020 6672  s.            fr
-0000c140: 6f6d 2049 5079 7468 6f6e 2e64 6973 706c  om IPython.displ
-0000c150: 6179 2069 6d70 6f72 7420 6469 7370 6c61  ay import displa
-0000c160: 790a 2020 2020 2020 2020 2020 2020 6672  y.            fr
-0000c170: 6f6d 2069 7079 7769 6467 6574 7320 696d  om ipywidgets im
-0000c180: 706f 7274 2049 6d61 6765 0a0a 2020 2020  port Image..    
-0000c190: 2020 2020 2020 2020 6764 7370 6174 6820          gdspath 
-0000c1a0: 3d20 636f 6d70 6f6e 656e 742e 7772 6974  = component.writ
-0000c1b0: 655f 6764 7328 6c6f 6767 696e 673d 4661  e_gds(logging=Fa
-0000c1c0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
-0000c1d0: 206c 7970 5f70 6174 6820 3d20 6764 7370   lyp_path = gdsp
-0000c1e0: 6174 682e 7769 7468 5f73 7566 6669 7828  ath.with_suffix(
-0000c1f0: 222e 6c79 7022 290a 0a20 2020 2020 2020  ".lyp")..       
-0000c200: 2020 2020 206c 6179 6572 5f76 6965 7773       layer_views
-0000c210: 203d 2067 6574 5f6c 6179 6572 5f76 6965   = get_layer_vie
-0000c220: 7773 2829 0a20 2020 2020 2020 2020 2020  ws().           
-0000c230: 206c 6179 6572 5f76 6965 7773 2e74 6f5f   layer_views.to_
-0000c240: 6c79 7028 6669 6c65 7061 7468 3d6c 7970  lyp(filepath=lyp
-0000c250: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
-0000c260: 2020 2020 6c61 796f 7574 5f76 6965 7720      layout_view 
-0000c270: 3d20 6c61 792e 4c61 796f 7574 5669 6577  = lay.LayoutView
-0000c280: 2829 0a20 2020 2020 2020 2020 2020 206c  ().            l
-0000c290: 6179 6f75 745f 7669 6577 2e6c 6f61 645f  ayout_view.load_
-0000c2a0: 6c61 796f 7574 2873 7472 2867 6473 7061  layout(str(gdspa
-0000c2b0: 7468 2e61 6273 6f6c 7574 6528 2929 290a  th.absolute())).
-0000c2c0: 2020 2020 2020 2020 2020 2020 6c61 796f              layo
-0000c2d0: 7574 5f76 6965 772e 6d61 785f 6869 6572  ut_view.max_hier
-0000c2e0: 2829 0a20 2020 2020 2020 2020 2020 206c  ().            l
-0000c2f0: 6179 6f75 745f 7669 6577 2e6c 6f61 645f  ayout_view.load_
-0000c300: 6c61 7965 725f 7072 6f70 7328 7374 7228  layer_props(str(
-0000c310: 6c79 705f 7061 7468 2929 0a0a 2020 2020  lyp_path))..    
-0000c320: 2020 2020 2020 2020 6c61 796f 7574 5f76          layout_v
-0000c330: 6965 772e 7365 745f 636f 6e66 6967 2822  iew.set_config("
-0000c340: 7465 7874 2d76 6973 6962 6c65 222c 2022  text-visible", "
-0000c350: 7472 7565 2220 6966 2073 686f 775f 6c61  true" if show_la
-0000c360: 6265 6c73 2065 6c73 6520 2266 616c 7365  bels else "false
-0000c370: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0000c380: 7069 7865 6c5f 6275 6666 6572 203d 206c  pixel_buffer = l
-0000c390: 6179 6f75 745f 7669 6577 2e67 6574 5f70  ayout_view.get_p
-0000c3a0: 6978 656c 735f 7769 7468 5f6f 7074 696f  ixels_with_optio
-0000c3b0: 6e73 2838 3030 2c20 3630 3029 0a20 2020  ns(800, 600).   
-0000c3c0: 2020 2020 2020 2020 2070 6e67 5f64 6174           png_dat
-0000c3d0: 6120 3d20 7069 7865 6c5f 6275 6666 6572  a = pixel_buffer
-0000c3e0: 2e74 6f5f 706e 675f 6461 7461 2829 0a20  .to_png_data(). 
-0000c3f0: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0000c400: 203d 2049 6d61 6765 2876 616c 7565 3d70   = Image(value=p
-0000c410: 6e67 5f64 6174 612c 2066 6f72 6d61 743d  ng_data, format=
-0000c420: 2270 6e67 2229 0a20 2020 2020 2020 2020  "png").         
-0000c430: 2020 2064 6973 706c 6179 2869 6d61 6765     display(image
-0000c440: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
-0000c450: 7420 496d 706f 7274 4572 726f 723a 0a20  t ImportError:. 
-0000c460: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000c470: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000c480: 2020 2259 6f75 2063 616e 2069 6e73 7461    "You can insta
-0000c490: 6c6c 2060 7069 7020 696e 7374 616c 6c20  ll `pip install 
-0000c4a0: 6764 7366 6163 746f 7279 5b66 756c 6c5d  gdsfactory[full]
-0000c4b0: 6020 666f 7220 6265 7474 6572 2076 6973  ` for better vis
-0000c4c0: 7561 6c69 7a61 7469 6f6e 220a 2020 2020  ualization".    
-0000c4d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000c4e0: 2020 2020 2020 636f 6d70 6f6e 656e 742e        component.
-0000c4f0: 706c 6f74 2870 6c6f 7474 6572 3d22 6d61  plot(plotter="ma
-0000c500: 7470 6c6f 746c 6962 2229 0a0a 2020 2020  tplotlib")..    
-0000c510: 6465 6620 706c 6f74 5f6a 7570 7974 6572  def plot_jupyter
-0000c520: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000c530: 2222 2253 686f 7773 2063 7572 7265 6e74  """Shows current
-0000c540: 2067 6473 2069 6e20 6b6c 6179 6f75 742e   gds in klayout.
-0000c550: 2055 7365 7320 4b77 6562 2069 6620 7365   Uses Kweb if se
-0000c560: 7276 6572 2072 756e 6e69 6e67 2e0a 0a20  rver running... 
-0000c570: 2020 2020 2020 2069 6620 6e6f 7420 7472         if not tr
-0000c580: 6965 7320 7573 696e 6720 4b6c 6179 6f75  ies using Klayou
-0000c590: 7420 7769 6467 6574 2061 6e64 2066 696e  t widget and fin
-0000c5a0: 616c 6c79 2064 6566 6175 6c74 7320 746f  ally defaults to
-0000c5b0: 206d 6174 706c 6f74 6c69 622e 0a20 2020   matplotlib..   
-0000c5c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c5d0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000c5e0: 2020 696d 706f 7274 206f 730a 2020 2020    import os.    
-0000c5f0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-0000c600: 6661 6374 6f72 792e 636f 6e66 6967 2069  factory.config i
-0000c610: 6d70 6f72 7420 5041 5448 0a20 2020 2020  mport PATH.     
-0000c620: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-0000c630: 6163 746f 7279 2e70 646b 2069 6d70 6f72  actory.pdk impor
-0000c640: 7420 6765 745f 6c61 7965 725f 7669 6577  t get_layer_view
-0000c650: 730a 2020 2020 2020 2020 2020 2020 6672  s.            fr
-0000c660: 6f6d 2049 5079 7468 6f6e 2e64 6973 706c  om IPython.displ
-0000c670: 6179 2069 6d70 6f72 7420 4946 7261 6d65  ay import IFrame
-0000c680: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-0000c690: 6f72 7420 6b77 6562 2e73 6572 7665 725f  ort kweb.server_
-0000c6a0: 6a75 7079 7465 7220 6173 206b 6a0a 2020  jupyter as kj.  
-0000c6b0: 2020 2020 2020 2020 2020 6672 6f6d 2068            from h
-0000c6c0: 746d 6c20 696d 706f 7274 2065 7363 6170  tml import escap
-0000c6d0: 650a 0a20 2020 2020 2020 2020 2020 2067  e..            g
-0000c6e0: 6473 7061 7468 203d 2073 656c 662e 7772  dspath = self.wr
-0000c6f0: 6974 655f 6764 7328 6764 7364 6972 3d50  ite_gds(gdsdir=P
-0000c700: 4154 482e 6764 736c 6962 202f 2022 6578  ATH.gdslib / "ex
-0000c710: 7472 6122 2c20 6c6f 6767 696e 673d 4661  tra", logging=Fa
-0000c720: 6c73 6529 0a0a 2020 2020 2020 2020 2020  lse)..          
-0000c730: 2020 6469 7270 6174 6820 3d20 4744 5344    dirpath = GDSD
-0000c740: 4952 5f54 454d 500a 2020 2020 2020 2020  IR_TEMP.        
-0000c750: 2020 2020 6469 7270 6174 682e 6d6b 6469      dirpath.mkdi
-0000c760: 7228 6578 6973 745f 6f6b 3d54 7275 652c  r(exist_ok=True,
-0000c770: 2070 6172 656e 7473 3d54 7275 6529 0a20   parents=True). 
-0000c780: 2020 2020 2020 2020 2020 206c 7970 5f70             lyp_p
-0000c790: 6174 6820 3d20 6469 7270 6174 6820 2f20  ath = dirpath / 
-0000c7a0: 226c 6179 6572 732e 6c79 7022 0a0a 2020  "layers.lyp"..  
-0000c7b0: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
-0000c7c0: 7072 6f70 7320 3d20 6765 745f 6c61 7965  props = get_laye
-0000c7d0: 725f 7669 6577 7328 290a 2020 2020 2020  r_views().      
-0000c7e0: 2020 2020 2020 6c61 7965 725f 7072 6f70        layer_prop
-0000c7f0: 732e 746f 5f6c 7970 2866 696c 6570 6174  s.to_lyp(filepat
-0000c800: 683d 6c79 705f 7061 7468 290a 0a20 2020  h=lyp_path)..   
-0000c810: 2020 2020 2020 2020 2070 6f72 7420 3d20           port = 
-0000c820: 6b6a 2e70 6f72 7420 6966 2068 6173 6174  kj.port if hasat
-0000c830: 7472 286b 6a2c 2022 706f 7274 2229 2065  tr(kj, "port") e
-0000c840: 6c73 6520 3830 3030 0a0a 2020 2020 2020  lse 8000..      
-0000c850: 2020 2020 2020 7372 6320 3d20 6622 6874        src = f"ht
-0000c860: 7470 3a2f 2f31 3237 2e30 2e30 2e31 3a7b  tp://127.0.0.1:{
-0000c870: 706f 7274 7d2f 6764 733f 6764 735f 6669  port}/gds?gds_fi
-0000c880: 6c65 3d7b 6573 6361 7065 2873 7472 2867  le={escape(str(g
-0000c890: 6473 7061 7468 2929 7d26 6c61 7965 725f  dspath))}&layer_
-0000c8a0: 7072 6f70 733d 7b65 7363 6170 6528 7374  props={escape(st
-0000c8b0: 7228 6c79 705f 7061 7468 2929 7d22 0a20  r(lyp_path))}". 
-0000c8c0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0000c8d0: 722e 6465 6275 6728 7372 6329 0a0a 2020  r.debug(src)..  
-0000c8e0: 2020 2020 2020 2020 2020 6966 206b 6a2e            if kj.
-0000c8f0: 6a75 7079 7465 725f 7365 7276 6572 2061  jupyter_server a
-0000c900: 6e64 206e 6f74 206f 732e 656e 7669 726f  nd not os.enviro
-0000c910: 6e2e 6765 7428 2244 4f43 5322 2c20 4661  n.get("DOCS", Fa
-0000c920: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
-0000c930: 2020 2020 2020 7265 7475 726e 2049 4672        return IFr
-0000c940: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
-0000c950: 2020 2020 2020 2020 2073 7263 3d73 7263           src=src
-0000c960: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c970: 2020 2020 2020 7769 6474 683d 3134 3030        width=1400
-0000c980: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c990: 2020 2020 2020 6865 6967 6874 3d36 3030        height=600
-0000c9a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c9b0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000c9c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000c9d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000c9e0: 662e 706c 6f74 5f6b 6c61 796f 7574 2829  f.plot_klayout()
-0000c9f0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000ca00: 496d 706f 7274 4572 726f 723a 0a20 2020  ImportError:.   
-0000ca10: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-0000ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca30: 2259 6f75 2063 616e 2069 6e73 7461 6c6c  "You can install
-0000ca40: 2060 7069 7020 696e 7374 616c 6c20 6764   `pip install gd
-0000ca50: 7366 6163 746f 7279 5b66 756c 6c5d 6020  sfactory[full]` 
-0000ca60: 666f 7220 6265 7474 6572 2076 6973 7561  for better visua
-0000ca70: 6c69 7a61 7469 6f6e 220a 2020 2020 2020  lization".      
-0000ca80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000ca90: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000caa0: 706c 6f74 5f6b 6c61 796f 7574 2829 0a0a  plot_klayout()..
-0000cab0: 2020 2020 6465 6620 706c 6f74 5f6d 6174      def plot_mat
-0000cac0: 706c 6f74 6c69 6228 7365 6c66 2c20 2a2a  plotlib(self, **
-0000cad0: 6b77 6172 6773 2920 2d3e 204e 6f6e 653a  kwargs) -> None:
-0000cae0: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
-0000caf0: 2063 6f6d 706f 6e65 6e74 2075 7369 6e67   component using
-0000cb00: 206d 6174 706c 6f74 6c69 622e 0a0a 2020   matplotlib...  
-0000cb10: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
-0000cb20: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000cb30: 7368 6f77 5f70 6f72 7473 3a20 5365 7473  show_ports: Sets
-0000cb40: 2077 6865 7468 6572 2070 6f72 7473 2061   whether ports a
-0000cb50: 7265 2064 7261 776e 2e0a 2020 2020 2020  re drawn..      
-0000cb60: 2020 2020 2020 7368 6f77 5f73 7562 706f        show_subpo
-0000cb70: 7274 733a 2053 6574 7320 7768 6574 6865  rts: Sets whethe
-0000cb80: 7220 7375 6270 6f72 7473 2028 706f 7274  r subports (port
-0000cb90: 7320 7468 6174 2062 656c 6f6e 6720 746f  s that belong to
-0000cba0: 2072 6566 6572 656e 6365 7329 2061 7265   references) are
-0000cbb0: 2064 7261 776e 2e0a 2020 2020 2020 2020   drawn..        
-0000cbc0: 2020 2020 6c61 6265 6c5f 616c 6961 7365      label_aliase
-0000cbd0: 733a 2053 6574 7320 7768 6574 6865 7220  s: Sets whether 
-0000cbe0: 616c 6961 7365 7320 6172 6520 6c61 6265  aliases are labe
-0000cbf0: 6c65 6420 7769 7468 2061 2074 6578 7420  led with a text 
-0000cc00: 6e61 6d65 2e0a 2020 2020 2020 2020 2020  name..          
-0000cc10: 2020 6e65 775f 7769 6e64 6f77 3a20 4966    new_window: If
-0000cc20: 2054 7275 652c 2065 6163 6820 6361 6c6c   True, each call
-0000cc30: 2074 6f20 7175 6963 6b70 6c6f 7428 2920   to quickplot() 
-0000cc40: 7769 6c6c 2067 656e 6572 6174 6520 6120  will generate a 
-0000cc50: 7365 7061 7261 7465 2077 696e 646f 772e  separate window.
-0000cc60: 0a20 2020 2020 2020 2020 2020 2062 6c6f  .            blo
-0000cc70: 636b 696e 673a 2049 6620 5472 7565 2c20  cking: If True, 
-0000cc80: 6361 6c6c 696e 6720 7175 6963 6b70 6c6f  calling quickplo
-0000cc90: 7428 2920 7769 6c6c 2070 6175 7365 2065  t() will pause e
-0000cca0: 7865 6375 7469 6f6e 206f 6620 2822 626c  xecution of ("bl
-0000ccb0: 6f63 6b22 2920 7468 650a 2020 2020 2020  ock") the.      
-0000ccc0: 2020 2020 2020 2020 2020 7265 6d61 696e            remain
-0000ccd0: 6465 7220 6f66 2074 6865 2070 7974 686f  der of the pytho
-0000cce0: 6e20 636f 6465 2075 6e74 696c 2074 6865  n code until the
-0000ccf0: 2071 7569 636b 706c 6f74 2829 2077 696e   quickplot() win
-0000cd00: 646f 7720 6973 2063 6c6f 7365 642e 0a20  dow is closed.. 
-0000cd10: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-0000cd20: 6620 4661 6c73 652c 2074 6865 2077 696e  f False, the win
-0000cd30: 646f 7720 7769 6c6c 2062 6520 6f70 656e  dow will be open
-0000cd40: 6564 2061 6e64 2063 6f64 6520 7769 6c6c  ed and code will
-0000cd50: 2063 6f6e 7469 6e75 6520 746f 2072 756e   continue to run
-0000cd60: 2e0a 2020 2020 2020 2020 2020 2020 7a6f  ..            zo
-0000cd70: 6f6d 5f66 6163 746f 723a 2053 6574 7320  om_factor: Sets 
-0000cd80: 7468 6520 7363 616c 696e 6720 6661 6374  the scaling fact
-0000cd90: 6f72 2077 6865 6e20 7a6f 6f6d 696e 6720  or when zooming 
-0000cda0: 7468 6520 7175 6963 6b70 6c6f 7420 7769  the quickplot wi
-0000cdb0: 6e64 6f77 2077 6974 6820 7468 650a 2020  ndow with the.  
-0000cdc0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0000cdd0: 7573 6577 6865 656c 2f74 7261 636b 7061  usewheel/trackpa
-0000cde0: 642e 0a20 2020 2020 2020 2020 2020 2069  d..            i
-0000cdf0: 6e74 6572 6163 7469 7665 5f7a 6f6f 6d3a  nteractive_zoom:
-0000ce00: 2045 6e61 626c 6573 2075 7369 6e67 206d   Enables using m
-0000ce10: 6f75 7365 7768 6565 6c2f 7472 6163 6b70  ousewheel/trackp
-0000ce20: 6164 2074 6f20 7a6f 6f6d 2e0a 2020 2020  ad to zoom..    
-0000ce30: 2020 2020 2020 2020 666f 6e74 7369 7a65          fontsize
-0000ce40: 3a20 666f 7220 6c61 6265 6c73 2e0a 2020  : for labels..  
-0000ce50: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
-0000ce60: 5f65 7863 6c75 6465 643a 206c 6973 7420  _excluded: list 
-0000ce70: 6f66 206c 6179 6572 7320 746f 2065 7863  of layers to exc
-0000ce80: 6c75 6465 2e0a 2020 2020 2020 2020 2020  lude..          
-0000ce90: 2020 6c61 7965 725f 7669 6577 733a 206c    layer_views: l
-0000cea0: 6179 6572 5f76 6965 7773 2063 6f6c 6f72  ayer_views color
-0000ceb0: 7320 6c6f 6164 6564 2066 726f 6d20 4b6c  s loaded from Kl
-0000cec0: 6179 6f75 742e 0a20 2020 2020 2020 2020  ayout..         
-0000ced0: 2020 206d 696e 5f61 7370 6563 743a 206d     min_aspect: m
-0000cee0: 696e 696d 756d 2061 7370 6563 7420 7261  inimum aspect ra
-0000cef0: 7469 6f2e 0a20 2020 2020 2020 2022 2222  tio..        """
-0000cf00: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-0000cf10: 7366 6163 746f 7279 2e71 7569 636b 706c  sfactory.quickpl
-0000cf20: 6f74 7465 7220 696d 706f 7274 2071 7569  otter import qui
-0000cf30: 636b 706c 6f74 0a0a 2020 2020 2020 2020  ckplot..        
-0000cf40: 7175 6963 6b70 6c6f 7428 7365 6c66 2c20  quickplot(self, 
-0000cf50: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-0000cf60: 6566 2070 6c6f 7428 7365 6c66 2c20 706c  ef plot(self, pl
-0000cf70: 6f74 7465 723a 204f 7074 696f 6e61 6c5b  otter: Optional[
-0000cf80: 506c 6f74 7465 725d 203d 204e 6f6e 652c  Plotter] = None,
-0000cf90: 202a 2a6b 7761 7267 7329 202d 3e20 4e6f   **kwargs) -> No
-0000cfa0: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
-0000cfb0: 6574 7572 6e73 2063 6f6d 706f 6e65 6e74  eturns component
-0000cfc0: 2070 6c6f 7420 7573 696e 6720 6b6c 6179   plot using klay
-0000cfd0: 6f75 742c 206d 6174 706c 6f74 6c69 622c  out, matplotlib,
-0000cfe0: 2068 6f6c 6f76 6965 7773 206f 7220 7174   holoviews or qt
-0000cff0: 2e0a 0a20 2020 2020 2020 2057 6520 7265  ...        We re
-0000d000: 636f 6d6d 656e 6420 7573 696e 6720 6b6c  commend using kl
-0000d010: 6179 6f75 742e 0a0a 2020 2020 2020 2020  ayout...        
-0000d020: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-0000d030: 2020 706c 6f74 7465 723a 2070 6c6f 7420    plotter: plot 
-0000d040: 6261 636b 656e 6420 2827 686f 6c6f 7669  backend ('holovi
-0000d050: 6577 7327 2c20 276d 6174 706c 6f74 6c69  ews', 'matplotli
-0000d060: 6227 2c20 2771 7427 2c20 276b 6c61 796f  b', 'qt', 'klayo
-0000d070: 7574 2729 2e0a 2020 2020 2020 2020 2222  ut')..        ""
-0000d080: 220a 2020 2020 2020 2020 706c 6f74 7465  ".        plotte
-0000d090: 7220 3d20 706c 6f74 7465 7220 6f72 2043  r = plotter or C
-0000d0a0: 4f4e 462e 6765 7428 2270 6c6f 7474 6572  ONF.get("plotter
-0000d0b0: 222c 2022 6d61 7470 6c6f 746c 6962 2229  ", "matplotlib")
-0000d0c0: 0a0a 2020 2020 2020 2020 6966 2070 6c6f  ..        if plo
-0000d0d0: 7474 6572 203d 3d20 226b 6c61 796f 7574  tter == "klayout
-0000d0e0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-0000d0f0: 656c 662e 706c 6f74 5f6b 6c61 796f 7574  elf.plot_klayout
-0000d100: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-0000d110: 6574 7572 6e0a 0a20 2020 2020 2020 2065  eturn..        e
-0000d120: 6c69 6620 706c 6f74 7465 7220 3d3d 2022  lif plotter == "
-0000d130: 6d61 7470 6c6f 746c 6962 223a 0a20 2020  matplotlib":.   
-0000d140: 2020 2020 2020 2020 2066 726f 6d20 6764           from gd
-0000d150: 7366 6163 746f 7279 2e71 7569 636b 706c  sfactory.quickpl
-0000d160: 6f74 7465 7220 696d 706f 7274 2071 7569  otter import qui
-0000d170: 636b 706c 6f74 0a0a 2020 2020 2020 2020  ckplot..        
-0000d180: 2020 2020 7175 6963 6b70 6c6f 7428 7365      quickplot(se
-0000d190: 6c66 2c20 2a2a 6b77 6172 6773 290a 2020  lf, **kwargs).  
-0000d1a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d1b0: 0a0a 2020 2020 2020 2020 656c 6966 2070  ..        elif p
-0000d1c0: 6c6f 7474 6572 203d 3d20 2268 6f6c 6f76  lotter == "holov
-0000d1d0: 6965 7773 223a 0a20 2020 2020 2020 2020  iews":.         
-0000d1e0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000d1f0: 2020 2020 2020 2020 696d 706f 7274 2068          import h
-0000d200: 6f6c 6f76 6965 7773 2061 7320 6876 0a0a  oloviews as hv..
-0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d220: 6876 2e65 7874 656e 7369 6f6e 2822 626f  hv.extension("bo
-0000d230: 6b65 6822 290a 2020 2020 2020 2020 2020  keh").          
-0000d240: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
-0000d250: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-0000d260: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000d270: 2822 796f 7520 6e65 6564 2074 6f20 6070  ("you need to `p
-0000d280: 6970 2069 6e73 7461 6c6c 2068 6f6c 6f76  ip install holov
-0000d290: 6965 7773 6022 290a 2020 2020 2020 2020  iews`").        
-0000d2a0: 2020 2020 2020 2020 7261 6973 6520 650a          raise e.
-0000d2b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d2c0: 726e 2073 656c 662e 706c 6f74 5f68 6f6c  rn self.plot_hol
-0000d2d0: 6f76 6965 7773 282a 2a6b 7761 7267 7329  oviews(**kwargs)
-0000d2e0: 0a0a 2020 2020 2020 2020 656c 6966 2070  ..        elif p
-0000d2f0: 6c6f 7474 6572 203d 3d20 2271 7422 3a0a  lotter == "qt":.
-0000d300: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-0000d310: 2067 6473 6661 6374 6f72 792e 7175 6963   gdsfactory.quic
-0000d320: 6b70 6c6f 7474 6572 2069 6d70 6f72 7420  kplotter import 
-0000d330: 7175 6963 6b70 6c6f 7432 0a0a 2020 2020  quickplot2..    
-0000d340: 2020 2020 2020 2020 7175 6963 6b70 6c6f          quickplo
-0000d350: 7432 2873 656c 6629 0a20 2020 2020 2020  t2(self).       
-0000d360: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0000d370: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d380: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000d390: 6545 7272 6f72 2866 227b 706c 6f74 7465  eError(f"{plotte
-0000d3a0: 7221 727d 206e 6f74 2069 6e20 7b50 6c6f  r!r} not in {Plo
-0000d3b0: 7474 6572 7d22 290a 0a20 2020 2064 6566  tter}")..    def
-0000d3c0: 2070 6c6f 745f 686f 6c6f 7669 6577 7328   plot_holoviews(
-0000d3d0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0000d3e0: 2020 2020 2020 206c 6179 6572 735f 6578         layers_ex
-0000d3f0: 636c 7564 6564 3a20 4f70 7469 6f6e 616c  cluded: Optional
-0000d400: 5b4c 6179 6572 735d 203d 204e 6f6e 652c  [Layers] = None,
-0000d410: 0a20 2020 2020 2020 206c 6179 6572 5f76  .        layer_v
-0000d420: 6965 7773 3a20 4f70 7469 6f6e 616c 5b4c  iews: Optional[L
-0000d430: 6179 6572 5669 6577 735d 203d 204e 6f6e  ayerViews] = Non
-0000d440: 652c 0a20 2020 2020 2020 206d 696e 5f61  e,.        min_a
-0000d450: 7370 6563 743a 2066 6c6f 6174 203d 2030  spect: float = 0
-0000d460: 2e32 352c 0a20 2020 2020 2020 2070 6164  .25,.        pad
-0000d470: 6469 6e67 3a20 666c 6f61 7420 3d20 302e  ding: float = 0.
-0000d480: 352c 0a20 2020 2029 3a0a 2020 2020 2020  5,.    ):.      
-0000d490: 2020 2222 2250 6c6f 7420 636f 6d70 6f6e    """Plot compon
-0000d4a0: 656e 7420 696e 2068 6f6c 6f76 6965 7773  ent in holoviews
-0000d4b0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-0000d4c0: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-0000d4d0: 6572 735f 6578 636c 7564 6564 3a20 6c69  ers_excluded: li
-0000d4e0: 7374 206f 6620 6c61 7965 7273 2074 6f20  st of layers to 
-0000d4f0: 6578 636c 7564 652e 0a20 2020 2020 2020  exclude..       
-0000d500: 2020 2020 206c 6179 6572 5f76 6965 7773       layer_views
-0000d510: 3a20 6c61 7965 725f 7669 6577 7320 636f  : layer_views co
-0000d520: 6c6f 7273 206c 6f61 6465 6420 6672 6f6d  lors loaded from
-0000d530: 204b 6c61 796f 7574 2e0a 2020 2020 2020   Klayout..      
-0000d540: 2020 2020 2020 6d69 6e5f 6173 7065 6374        min_aspect
-0000d550: 3a20 6d69 6e69 6d75 6d20 6173 7065 6374  : minimum aspect
-0000d560: 2072 6174 696f 2e0a 2020 2020 2020 2020   ratio..        
-0000d570: 2020 2020 7061 6464 696e 673a 2061 726f      padding: aro
-0000d580: 756e 6420 626f 756e 6469 6e67 2062 6f78  und bounding box
-0000d590: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-0000d5a0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0000d5b0: 486f 6c6f 7669 6577 7320 4f76 6572 6c61  Holoviews Overla
-0000d5c0: 7920 746f 2064 6973 706c 6179 2061 6c6c  y to display all
-0000d5d0: 2070 6f6c 7967 6f6e 732e 0a20 2020 2020   polygons..     
-0000d5e0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-0000d5f0: 726f 6d20 6764 7366 6163 746f 7279 2e61  rom gdsfactory.a
-0000d600: 6464 5f70 696e 7320 696d 706f 7274 2067  dd_pins import g
-0000d610: 6574 5f70 696e 5f74 7269 616e 676c 655f  et_pin_triangle_
-0000d620: 706f 6c79 676f 6e5f 7469 700a 2020 2020  polygon_tip.    
-0000d630: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
-0000d640: 6f72 792e 6765 6e65 7269 635f 7465 6368  ory.generic_tech
-0000d650: 2069 6d70 6f72 7420 4c41 5945 525f 5649   import LAYER_VI
-0000d660: 4557 530a 0a20 2020 2020 2020 2069 6620  EWS..        if 
-0000d670: 6c61 7965 725f 7669 6577 7320 6973 204e  layer_views is N
-0000d680: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000d690: 206c 6179 6572 5f76 6965 7773 203d 204c   layer_views = L
-0000d6a0: 4159 4552 5f56 4945 5753 0a0a 2020 2020  AYER_VIEWS..    
-0000d6b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000d6c0: 2020 2020 2069 6d70 6f72 7420 686f 6c6f       import holo
-0000d6d0: 7669 6577 7320 6173 2068 760a 0a20 2020  views as hv..   
-0000d6e0: 2020 2020 2020 2020 2068 762e 6578 7465           hv.exte
-0000d6f0: 6e73 696f 6e28 2262 6f6b 6568 2229 0a20  nsion("bokeh"). 
-0000d700: 2020 2020 2020 2065 7863 6570 7420 496d         except Im
-0000d710: 706f 7274 4572 726f 7220 6173 2065 3a0a  portError as e:.
-0000d720: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000d730: 7428 2279 6f75 206e 6565 6420 746f 2060  t("you need to `
-0000d740: 7069 7020 696e 7374 616c 6c20 686f 6c6f  pip install holo
-0000d750: 7669 6577 7360 2229 0a20 2020 2020 2020  views`").       
-0000d760: 2020 2020 2072 6169 7365 2065 0a0a 2020       raise e..  
-0000d770: 2020 2020 2020 7365 6c66 2e5f 6262 5f76        self._bb_v
-0000d780: 616c 6964 203d 2046 616c 7365 2020 2320  alid = False  # 
-0000d790: 7265 636f 6d70 7574 6520 7468 6520 626f  recompute the bo
-0000d7a0: 756e 6469 6e67 2062 6f78 0a20 2020 2020  unding box.     
-0000d7b0: 2020 2062 203d 2073 656c 662e 6262 6f78     b = self.bbox
-0000d7c0: 202b 2028 282d 7061 6464 696e 672c 202d   + ((-padding, -
-0000d7d0: 7061 6464 696e 6729 2c20 2870 6164 6469  padding), (paddi
-0000d7e0: 6e67 2c20 7061 6464 696e 6729 290a 2020  ng, padding)).  
-0000d7f0: 2020 2020 2020 6220 3d20 6e70 2e61 7272        b = np.arr
-0000d800: 6179 2862 2e66 6c61 7429 0a20 2020 2020  ay(b.flat).     
-0000d810: 2020 2063 656e 7465 7220 3d20 6e70 2e61     center = np.a
-0000d820: 7272 6179 2828 6e70 2e73 756d 2862 5b3a  rray((np.sum(b[:
-0000d830: 3a32 5d29 202f 2032 2c20 6e70 2e73 756d  :2]) / 2, np.sum
-0000d840: 2862 5b31 3a3a 325d 2920 2f20 3229 290a  (b[1::2]) / 2)).
-0000d850: 2020 2020 2020 2020 7369 7a65 203d 206e          size = n
-0000d860: 702e 6172 7261 7928 286e 702e 6162 7328  p.array((np.abs(
-0000d870: 625b 325d 202d 2062 5b30 5d29 2c20 6e70  b[2] - b[0]), np
-0000d880: 2e61 6273 2862 5b33 5d20 2d20 625b 315d  .abs(b[3] - b[1]
-0000d890: 2929 290a 2020 2020 2020 2020 6478 203d  ))).        dx =
-0000d8a0: 206e 702e 6172 7261 7928 0a20 2020 2020   np.array(.     
-0000d8b0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
-0000d8c0: 2020 2020 2020 2020 206e 702e 6d61 7869           np.maxi
-0000d8d0: 6d75 6d28 6d69 6e5f 6173 7065 6374 202a  mum(min_aspect *
-0000d8e0: 2073 697a 655b 315d 2c20 7369 7a65 5b30   size[1], size[0
-0000d8f0: 5d29 202f 2032 2c0a 2020 2020 2020 2020  ]) / 2,.        
-0000d900: 2020 2020 2020 2020 6e70 2e6d 6178 696d          np.maxim
-0000d910: 756d 2873 697a 655b 315d 2c20 6d69 6e5f  um(size[1], min_
-0000d920: 6173 7065 6374 202a 2073 697a 655b 305d  aspect * size[0]
-0000d930: 2920 2f20 322c 0a20 2020 2020 2020 2020  ) / 2,.         
-0000d940: 2020 2029 0a20 2020 2020 2020 2029 0a20     ).        ). 
-0000d950: 2020 2020 2020 2062 203d 206e 702e 6873         b = np.hs
-0000d960: 7461 636b 2828 6365 6e74 6572 202d 2064  tack((center - d
-0000d970: 782c 2063 656e 7465 7220 2b20 6478 2929  x, center + dx))
-0000d980: 0a0a 2020 2020 2020 2020 706c 6f74 735f  ..        plots_
-0000d990: 746f 5f6f 7665 726c 6179 203d 205b 5d0a  to_overlay = [].
-0000d9a0: 2020 2020 2020 2020 6c61 7965 7273 5f65          layers_e
-0000d9b0: 7863 6c75 6465 6420 3d20 5b5d 2069 6620  xcluded = [] if 
-0000d9c0: 6c61 7965 7273 5f65 7863 6c75 6465 6420  layers_excluded 
-0000d9d0: 6973 204e 6f6e 6520 656c 7365 206c 6179  is None else lay
-0000d9e0: 6572 735f 6578 636c 7564 6564 0a0a 2020  ers_excluded..  
-0000d9f0: 2020 2020 2020 666f 7220 6c61 7965 722c        for layer,
-0000da00: 2070 6f6c 7967 6f6e 2069 6e20 7365 6c66   polygon in self
-0000da10: 2e67 6574 5f70 6f6c 7967 6f6e 7328 6279  .get_polygons(by
-0000da20: 5f73 7065 633d 5472 7565 292e 6974 656d  _spec=True).item
-0000da30: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0000da40: 2069 6620 6c61 7965 7220 696e 206c 6179   if layer in lay
-0000da50: 6572 735f 6578 636c 7564 6564 3a0a 2020  ers_excluded:.  
-0000da60: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000da70: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-0000da80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000da90: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
-0000daa0: 6965 7720 3d20 6c61 7965 725f 7669 6577  iew = layer_view
-0000dab0: 732e 6765 745f 6672 6f6d 5f74 7570 6c65  s.get_from_tuple
-0000dac0: 286c 6179 6572 290a 2020 2020 2020 2020  (layer).        
-0000dad0: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
-0000dae0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0000daf0: 2020 2020 2020 206c 6179 6572 7320 3d20         layers = 
-0000db00: 6c69 7374 286c 6179 6572 5f76 6965 7773  list(layer_views
-0000db10: 2e67 6574 5f6c 6179 6572 5f76 6965 7773  .get_layer_views
-0000db20: 2829 2e6b 6579 7328 2929 0a20 2020 2020  ().keys()).     
-0000db30: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0000db40: 6e67 732e 7761 726e 2866 227b 6c61 7965  ngs.warn(f"{laye
-0000db50: 7221 727d 206e 6f74 2064 6566 696e 6564  r!r} not defined
-0000db60: 2069 6e20 7b6c 6179 6572 737d 222c 2073   in {layers}", s
-0000db70: 7461 636b 6c65 7665 6c3d 3329 0a20 2020  tacklevel=3).   
-0000db80: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-0000db90: 6572 5f76 6965 7720 3d20 4c61 7965 7256  er_view = LayerV
-0000dba0: 6965 7728 6c61 7965 723d 6c61 7965 7229  iew(layer=layer)
-0000dbb0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-0000dbc0: 4f44 4f3a 204d 6174 6368 2075 7020 6f70  ODO: Match up op
-0000dbd0: 7469 6f6e 7320 7769 7468 204c 6179 6572  tions with Layer
-0000dbe0: 5669 6577 730a 2020 2020 2020 2020 2020  Views.          
-0000dbf0: 2020 706c 6f74 735f 746f 5f6f 7665 726c    plots_to_overl
-0000dc00: 6179 2e61 7070 656e 6428 0a20 2020 2020  ay.append(.     
-0000dc10: 2020 2020 2020 2020 2020 2068 762e 506f             hv.Po
-0000dc20: 6c79 676f 6e73 2870 6f6c 7967 6f6e 2c20  lygons(polygon, 
-0000dc30: 6c61 6265 6c3d 7374 7228 6c61 7965 725f  label=str(layer_
-0000dc40: 7669 6577 2e6e 616d 6529 292e 6f70 7473  view.name)).opts
-0000dc50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000dc60: 2020 2020 2020 6461 7461 5f61 7370 6563        data_aspec
-0000dc70: 743d 312c 0a20 2020 2020 2020 2020 2020  t=1,.           
-0000dc80: 2020 2020 2020 2020 2066 7261 6d65 5f77           frame_w
-0000dc90: 6964 7468 3d35 3030 2c0a 2020 2020 2020  idth=500,.      
-0000dca0: 2020 2020 2020 2020 2020 2020 2020 796c                yl
-0000dcb0: 696d 3d28 625b 315d 2c20 625b 335d 292c  im=(b[1], b[3]),
-0000dcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dcd0: 2020 2020 2078 6c69 6d3d 2862 5b30 5d2c       xlim=(b[0],
-0000dce0: 2062 5b32 5d29 2c0a 2020 2020 2020 2020   b[2]),.        
-0000dcf0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0000dd00: 5f63 6f6c 6f72 3d6c 6179 6572 5f76 6965  _color=layer_vie
-0000dd10: 772e 6669 6c6c 5f63 6f6c 6f72 2e61 735f  w.fill_color.as_
-0000dd20: 7267 6228 2920 6f72 2022 222c 0a20 2020  rgb() or "",.   
-0000dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd40: 206c 696e 655f 636f 6c6f 723d 6c61 7965   line_color=laye
-0000dd50: 725f 7669 6577 2e66 7261 6d65 5f63 6f6c  r_view.frame_col
-0000dd60: 6f72 2e61 735f 7267 6228 2920 6f72 2022  or.as_rgb() or "
-0000dd70: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000dd80: 2020 2020 2020 2066 696c 6c5f 616c 7068         fill_alph
-0000dd90: 613d 6c61 7965 725f 7669 6577 2e67 6574  a=layer_view.get
-0000dda0: 5f61 6c70 6861 2829 206f 7220 2222 2c0a  _alpha() or "",.
-0000ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddc0: 2020 2020 6c69 6e65 5f61 6c70 6861 3d6c      line_alpha=l
-0000ddd0: 6179 6572 5f76 6965 772e 6765 745f 616c  ayer_view.get_al
-0000dde0: 7068 6128 2920 6f72 2022 222c 0a20 2020  pha() or "",.   
-0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de00: 2074 6f6f 6c73 3d5b 2268 6f76 6572 225d   tools=["hover"]
-0000de10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000de20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000de30: 290a 2020 2020 2020 2020 666f 7220 6e61  ).        for na
-0000de40: 6d65 2c20 706f 7274 2069 6e20 7365 6c66  me, port in self
-0000de50: 2e70 6f72 7473 2e69 7465 6d73 2829 3a0a  .ports.items():.
-0000de60: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0000de70: 203d 2073 7472 286e 616d 6529 0a20 2020   = str(name).   
-0000de80: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-0000de90: 2c20 7074 6970 203d 2067 6574 5f70 696e  , ptip = get_pin
-0000dea0: 5f74 7269 616e 676c 655f 706f 6c79 676f  _triangle_polygo
-0000deb0: 6e5f 7469 7028 706f 7274 3d70 6f72 7429  n_tip(port=port)
-0000dec0: 0a0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
-0000ded0: 6f74 735f 746f 5f6f 7665 726c 6179 2e61  ots_to_overlay.a
-0000dee0: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
-0000def0: 2020 2020 2020 2068 762e 506f 6c79 676f         hv.Polygo
-0000df00: 6e73 2870 6f6c 7967 6f6e 2c20 6c61 6265  ns(polygon, labe
-0000df10: 6c3d 6e61 6d65 292e 6f70 7473 280a 2020  l=name).opts(.  
-0000df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df30: 2020 6461 7461 5f61 7370 6563 743d 312c    data_aspect=1,
-0000df40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000df50: 2020 2020 2066 7261 6d65 5f77 6964 7468       frame_width
-0000df60: 3d35 3030 2c0a 2020 2020 2020 2020 2020  =500,.          
-0000df70: 2020 2020 2020 2020 2020 6669 6c6c 5f61            fill_a
-0000df80: 6c70 6861 3d30 2c0a 2020 2020 2020 2020  lpha=0,.        
-0000df90: 2020 2020 2020 2020 2020 2020 796c 696d              ylim
-0000dfa0: 3d28 625b 315d 2c20 625b 335d 292c 0a20  =(b[1], b[3]),. 
-0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfc0: 2020 2078 6c69 6d3d 2862 5b30 5d2c 2062     xlim=(b[0], b
-0000dfd0: 5b32 5d29 2c0a 2020 2020 2020 2020 2020  [2]),.          
-0000dfe0: 2020 2020 2020 2020 2020 636f 6c6f 723d            color=
-0000dff0: 2272 6564 222c 0a20 2020 2020 2020 2020  "red",.         
-0000e000: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-0000e010: 616c 7068 613d 6c61 7965 725f 7669 6577  alpha=layer_view
-0000e020: 2e67 6574 5f61 6c70 6861 2829 206f 7220  .get_alpha() or 
-0000e030: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0000e040: 2020 2020 2020 2020 746f 6f6c 733d 5b22          tools=["
-0000e050: 686f 7665 7222 5d2c 0a20 2020 2020 2020  hover"],.       
-0000e060: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000e070: 2020 2020 2020 2020 2020 202a 2068 762e             * hv.
-0000e080: 5465 7874 2870 7469 705b 305d 2c20 7074  Text(ptip[0], pt
-0000e090: 6970 5b31 5d2c 206e 616d 6529 0a20 2020  ip[1], name).   
-0000e0a0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000e0b0: 2020 2020 7265 7475 726e 2068 762e 4f76      return hv.Ov
-0000e0c0: 6572 6c61 7928 706c 6f74 735f 746f 5f6f  erlay(plots_to_o
-0000e0d0: 7665 726c 6179 292e 6f70 7473 280a 2020  verlay).opts(.  
-0000e0e0: 2020 2020 2020 2020 2020 7368 6f77 5f6c            show_l
-0000e0f0: 6567 656e 643d 5472 7565 2c20 7368 6172  egend=True, shar
-0000e100: 6564 5f61 7865 733d 4661 6c73 652c 2079  ed_axes=False, y
-0000e110: 6c69 6d3d 2862 5b31 5d2c 2062 5b33 5d29  lim=(b[1], b[3])
-0000e120: 2c20 786c 696d 3d28 625b 305d 2c20 625b  , xlim=(b[0], b[
-0000e130: 325d 290a 2020 2020 2020 2020 290a 0a20  2]).        ).. 
-0000e140: 2020 2064 6566 2073 686f 7728 0a20 2020     def show(.   
-0000e150: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000e160: 2020 2073 686f 775f 706f 7274 733a 2062     show_ports: b
-0000e170: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000e180: 2020 2020 2073 686f 775f 7375 6270 6f72       show_subpor
-0000e190: 7473 3a20 626f 6f6c 203d 2046 616c 7365  ts: bool = False
-0000e1a0: 2c0a 2020 2020 2020 2020 706f 7274 5f6d  ,.        port_m
-0000e1b0: 6172 6b65 725f 6c61 7965 723a 204c 6179  arker_layer: Lay
-0000e1c0: 6572 203d 2028 312c 2031 3029 2c0a 2020  er = (1, 10),.  
-0000e1d0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-0000e1e0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-0000e1f0: 2020 2020 2020 2022 2222 5368 6f77 2063         """Show c
-0000e200: 6f6d 706f 6e65 6e74 2069 6e20 4b4c 6179  omponent in KLay
-0000e210: 6f75 742e 0a0a 2020 2020 2020 2020 7265  out...        re
-0000e220: 7475 726e 7320 6120 636f 7079 206f 6620  turns a copy of 
-0000e230: 7468 6520 436f 6d70 6f6e 656e 742c 2073  the Component, s
-0000e240: 6f20 7468 6520 6f72 6967 696e 616c 2063  o the original c
-0000e250: 6f6d 706f 6e65 6e74 2072 656d 6169 6e73  omponent remains
-0000e260: 2069 6e74 6163 742e 0a20 2020 2020 2020   intact..       
-0000e270: 2077 6974 6820 7069 6e73 206d 6172 6b65   with pins marke
-0000e280: 7273 206f 6e20 6561 6368 2070 6f72 7420  rs on each port 
-0000e290: 7368 6f77 5f70 6f72 7473 203d 2054 7275  show_ports = Tru
-0000e2a0: 652c 2061 6e64 206f 7074 696f 6e61 6c6c  e, and optionall
-0000e2b0: 7920 616c 736f 0a20 2020 2020 2020 2074  y also.        t
-0000e2c0: 6865 2070 6f72 7473 2066 726f 6d20 7468  he ports from th
-0000e2d0: 6520 7265 6665 7265 6e63 6573 2028 7368  e references (sh
-0000e2e0: 6f77 5f73 7562 706f 7274 733d 5472 7565  ow_subports=True
-0000e2f0: 290a 0a20 2020 2020 2020 2041 7267 733a  )..        Args:
-0000e300: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-0000e310: 775f 706f 7274 733a 2073 686f 7773 2063  w_ports: shows c
-0000e320: 6f6d 706f 6e65 6e74 2077 6974 6820 706f  omponent with po
-0000e330: 7274 206d 6172 6b65 7273 2061 6e64 206c  rt markers and l
-0000e340: 6162 656c 732e 0a20 2020 2020 2020 2020  abels..         
-0000e350: 2020 2073 686f 775f 7375 6270 6f72 7473     show_subports
-0000e360: 3a20 6164 6420 706f 7274 7320 6d61 726b  : add ports mark
-0000e370: 6572 7320 616e 6420 6c61 6265 6c73 2074  ers and labels t
-0000e380: 6f20 7265 6665 7265 6e63 6573 2e0a 2020  o references..  
-0000e390: 2020 2020 2020 2020 2020 706f 7274 5f6d            port_m
-0000e3a0: 6172 6b65 725f 6c61 7965 723a 2066 6f72  arker_layer: for
-0000e3b0: 2074 6865 2070 6f72 7473 2e0a 0a20 2020   the ports...   
-0000e3c0: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
-0000e3d0: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
-0000e3e0: 6473 7061 7468 3a20 4744 5320 6669 6c65  dspath: GDS file
-0000e3f0: 2070 6174 6820 746f 2077 7269 7465 2074   path to write t
-0000e400: 6f2e 0a20 2020 2020 2020 2020 2020 2067  o..            g
-0000e410: 6473 6469 723a 2064 6972 6563 746f 7279  dsdir: directory
-0000e420: 2066 6f72 2074 6865 2047 4453 2066 696c   for the GDS fil
-0000e430: 652e 2044 6566 6175 6c74 7320 746f 202f  e. Defaults to /
-0000e440: 746d 702f 2e0a 2020 2020 2020 2020 2020  tmp/..          
-0000e450: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
-0000e460: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
-0000e470: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
-0000e480: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-0000e490: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
-0000e4a0: 2066 6f72 206f 626a 6563 7420 6469 6d65   for object dime
-0000e4b0: 6e73 696f 6e73 2069 6e20 7468 6520 6c69  nsions in the li
-0000e4c0: 6272 6172 7920 286d 292e 2031 6e6d 2062  brary (m). 1nm b
-0000e4d0: 7920 6465 6661 756c 742e 0a20 2020 2020  y default..     
-0000e4e0: 2020 2020 2020 2074 696d 6573 7461 6d70         timestamp
-0000e4f0: 3a20 4465 6661 756c 7473 2074 6f20 3230  : Defaults to 20
-0000e500: 3139 2d31 302d 3235 2e20 4966 204e 6f6e  19-10-25. If Non
-0000e510: 6520 7573 6573 2063 7572 7265 6e74 2074  e uses current t
-0000e520: 696d 652e 0a20 2020 2020 2020 2022 2222  ime..        """
-0000e530: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-0000e540: 7366 6163 746f 7279 2e61 6464 5f70 696e  sfactory.add_pin
-0000e550: 7320 696d 706f 7274 2061 6464 5f70 696e  s import add_pin
-0000e560: 735f 7472 6961 6e67 6c65 0a20 2020 2020  s_triangle.     
-0000e570: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000e580: 7279 2e73 686f 7720 696d 706f 7274 2073  ry.show import s
-0000e590: 686f 770a 0a20 2020 2020 2020 2063 6f6d  how..        com
-0000e5a0: 706f 6e65 6e74 203d 2028 0a20 2020 2020  ponent = (.     
-0000e5b0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0000e5c0: 7069 6e73 5f74 7269 616e 676c 6528 706f  pins_triangle(po
-0000e5d0: 7274 5f6d 6172 6b65 725f 6c61 7965 723d  rt_marker_layer=
-0000e5e0: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
-0000e5f0: 7229 0a20 2020 2020 2020 2020 2020 2069  r).            i
-0000e600: 6620 7368 6f77 5f70 6f72 7473 0a20 2020  f show_ports.   
-0000e610: 2020 2020 2020 2020 2065 6c73 6520 7365           else se
-0000e620: 6c66 0a20 2020 2020 2020 2029 0a0a 2020  lf.        )..  
-0000e630: 2020 2020 2020 6966 2073 686f 775f 7375        if show_su
-0000e640: 6270 6f72 7473 3a0a 2020 2020 2020 2020  bports:.        
-0000e650: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
-0000e660: 7365 6c66 2e63 6f70 7928 290a 2020 2020  self.copy().    
-0000e670: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-0000e680: 742e 6e61 6d65 203d 2073 656c 662e 6e61  t.name = self.na
-0000e690: 6d65 0a20 2020 2020 2020 2020 2020 2066  me.            f
-0000e6a0: 6f72 2072 6566 6572 656e 6365 2069 6e20  or reference in 
-0000e6b0: 636f 6d70 6f6e 656e 742e 7265 6665 7265  component.refere
-0000e6c0: 6e63 6573 3a0a 2020 2020 2020 2020 2020  nces:.          
-0000e6d0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000e6e0: 6e63 6528 636f 6d70 6f6e 656e 742c 2043  nce(component, C
-0000e6f0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-0000e700: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000e710: 2020 2020 2020 2020 6164 645f 7069 6e73          add_pins
-0000e720: 5f74 7269 616e 676c 6528 0a20 2020 2020  _triangle(.     
-0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e740: 2020 2063 6f6d 706f 6e65 6e74 3d63 6f6d     component=com
-0000e750: 706f 6e65 6e74 2c0a 2020 2020 2020 2020  ponent,.        
-0000e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e770: 7265 6665 7265 6e63 653d 7265 6665 7265  reference=refere
-0000e780: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
-0000e790: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-0000e7a0: 6572 3d70 6f72 745f 6d61 726b 6572 5f6c  er=port_marker_l
-0000e7b0: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-0000e7c0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000e7d0: 2020 2020 2073 686f 7728 636f 6d70 6f6e       show(compon
-0000e7e0: 656e 742c 202a 2a6b 7761 7267 7329 0a0a  ent, **kwargs)..
-0000e7f0: 2020 2020 6465 6620 5f77 7269 7465 5f6c      def _write_l
-0000e800: 6962 7261 7279 280a 2020 2020 2020 2020  ibrary(.        
-0000e810: 7365 6c66 2c0a 2020 2020 2020 2020 6764  self,.        gd
-0000e820: 7370 6174 683a 204f 7074 696f 6e61 6c5b  spath: Optional[
-0000e830: 5061 7468 5479 7065 5d20 3d20 4e6f 6e65  PathType] = None
-0000e840: 2c0a 2020 2020 2020 2020 6764 7364 6972  ,.        gdsdir
-0000e850: 3a20 4f70 7469 6f6e 616c 5b50 6174 6854  : Optional[PathT
-0000e860: 7970 655d 203d 204e 6f6e 652c 0a20 2020  ype] = None,.   
-0000e870: 2020 2020 2074 696d 6573 7461 6d70 3a20       timestamp: 
-0000e880: 4f70 7469 6f6e 616c 5b64 6174 6574 696d  Optional[datetim
-0000e890: 652e 6461 7465 7469 6d65 5d20 3d20 5f74  e.datetime] = _t
-0000e8a0: 696d 6573 7461 6d70 3230 3139 2c0a 2020  imestamp2019,.  
-0000e8b0: 2020 2020 2020 6c6f 6767 696e 673a 2062        logging: b
-0000e8c0: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
-0000e8d0: 2020 2020 7769 7468 5f6f 6173 6973 3a20      with_oasis: 
-0000e8e0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0000e8f0: 2020 2020 2020 7769 7468 5f6d 6574 6164        with_metad
-0000e900: 6174 613a 2062 6f6f 6c20 3d20 4661 6c73  ata: bool = Fals
-0000e910: 652c 0a20 2020 2020 2020 202a 2a6b 7761  e,.        **kwa
-0000e920: 7267 732c 0a20 2020 2029 202d 3e20 5061  rgs,.    ) -> Pa
-0000e930: 7468 3a0a 2020 2020 2020 2020 2222 2257  th:.        """W
-0000e940: 7269 7465 2063 6f6d 706f 6e65 6e74 2074  rite component t
-0000e950: 6f20 4744 5320 6f72 204f 4153 4953 2061  o GDS or OASIS a
-0000e960: 6e64 2072 6574 7572 6e73 2067 6473 7061  nd returns gdspa
-0000e970: 7468 2e0a 0a20 2020 2020 2020 2041 7267  th...        Arg
-0000e980: 733a 0a20 2020 2020 2020 2020 2020 2067  s:.            g
-0000e990: 6473 7061 7468 3a20 4744 5320 6669 6c65  dspath: GDS file
-0000e9a0: 2070 6174 6820 746f 2077 7269 7465 2074   path to write t
-0000e9b0: 6f2e 0a20 2020 2020 2020 2020 2020 2067  o..            g
-0000e9c0: 6473 6469 723a 2064 6972 6563 746f 7279  dsdir: directory
-0000e9d0: 2066 6f72 2074 6865 2047 4453 2066 696c   for the GDS fil
-0000e9e0: 652e 2044 6566 6175 6c74 7320 746f 202f  e. Defaults to /
-0000e9f0: 746d 702f 7261 6e64 6f6d 4669 6c65 2f67  tmp/randomFile/g
-0000ea00: 6473 6661 6374 6f72 792e 0a20 2020 2020  dsfactory..     
-0000ea10: 2020 2020 2020 2074 696d 6573 7461 6d70         timestamp
-0000ea20: 3a20 4465 6661 756c 7473 2074 6f20 3230  : Defaults to 20
-0000ea30: 3139 2d31 302d 3235 2066 6f72 2063 6f6e  19-10-25 for con
-0000ea40: 7369 7374 656e 7420 6861 7368 2e0a 2020  sistent hash..  
-0000ea50: 2020 2020 2020 2020 2020 2020 2020 4966                If
-0000ea60: 204e 6f6e 6520 7573 6573 2063 7572 7265   None uses curre
-0000ea70: 6e74 2074 696d 652e 0a20 2020 2020 2020  nt time..       
-0000ea80: 2020 2020 206c 6f67 6769 6e67 3a20 6469       logging: di
-0000ea90: 7361 626c 6520 4744 5320 7061 7468 206c  sable GDS path l
-0000eaa0: 6f67 6769 6e67 2c20 666f 7220 6578 616d  ogging, for exam
-0000eab0: 706c 6520 666f 7220 7368 6f77 696e 6720  ple for showing 
-0000eac0: 6974 2069 6e20 4b4c 6179 6f75 742e 0a20  it in KLayout.. 
-0000ead0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
-0000eae0: 6f61 7369 733a 2049 6620 5472 7565 2c20  oasis: If True, 
-0000eaf0: 6669 6c65 2077 696c 6c20 6265 2077 7269  file will be wri
-0000eb00: 7474 656e 2074 6f20 4f41 5349 532e 204f  tten to OASIS. O
-0000eb10: 7468 6572 7769 7365 2c20 6669 6c65 2077  therwise, file w
-0000eb20: 696c 6c20 6265 2077 7269 7474 656e 2074  ill be written t
-0000eb30: 6f20 4744 532e 0a20 2020 2020 2020 2020  o GDS..         
-0000eb40: 2020 2077 6974 685f 6d65 7461 6461 7461     with_metadata
-0000eb50: 3a20 7772 6974 6573 206d 6574 6164 6174  : writes metadat
-0000eb60: 6120 696e 2059 414d 4c20 666f 726d 6174  a in YAML format
-0000eb70: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-0000eb80: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-0000eb90: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
-0000eba0: 756d 656e 7473 2077 696c 6c20 6f76 6572  uments will over
-0000ebb0: 7269 6465 2074 6865 2061 6374 6976 6520  ride the active 
-0000ebc0: 5044 4b27 7320 6465 6661 756c 7420 4764  PDK's default Gd
-0000ebd0: 7357 7269 7465 5365 7474 696e 6773 2061  sWriteSettings a
-0000ebe0: 6e64 204f 6173 6973 5772 6974 6553 6574  nd OasisWriteSet
-0000ebf0: 7469 6e67 732e 0a0a 2020 2020 2020 2020  tings...        
-0000ec00: 2020 2020 4764 7320 7365 7474 696e 6773      Gds settings
-0000ec10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ec20: 2020 756e 6974 3a20 756e 6974 2073 697a    unit: unit siz
-0000ec30: 6520 666f 7220 6f62 6a65 6374 7320 696e  e for objects in
-0000ec40: 206c 6962 7261 7279 2e20 3175 6d20 6279   library. 1um by
-0000ec50: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
-0000ec60: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-0000ec70: 696f 6e3a 2066 6f72 2064 696d 656e 7369  ion: for dimensi
-0000ec80: 6f6e 7320 696e 2074 6865 206c 6962 7261  ons in the libra
-0000ec90: 7279 2028 6d29 2e20 316e 6d20 6279 2064  ry (m). 1nm by d
-0000eca0: 6566 6175 6c74 2e0a 2020 2020 2020 2020  efault..        
-0000ecb0: 2020 2020 2020 2020 6f6e 5f64 7570 6c69          on_dupli
-0000ecc0: 6361 7465 5f63 656c 6c3a 2073 7065 6369  cate_cell: speci
-0000ecd0: 6679 2068 6f77 2074 6f20 7265 736f 6c76  fy how to resolv
-0000ece0: 6520 6475 706c 6963 6174 652d 6e61 6d65  e duplicate-name
-0000ecf0: 6420 6365 6c6c 732e 2043 686f 6f73 6520  d cells. Choose 
-0000ed00: 6f6e 6520 6f66 2074 6865 2066 6f6c 6c6f  one of the follo
-0000ed10: 7769 6e67 3a0a 2020 2020 2020 2020 2020  wing:.          
-0000ed20: 2020 2020 2020 2020 2020 2277 6172 6e22            "warn"
-0000ed30: 2028 6465 6661 756c 7429 3a20 6f76 6572   (default): over
-0000ed40: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
-0000ed50: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
-0000ed60: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
-0000ed70: 6174 6573 2028 6172 6269 7472 6172 696c  ates (arbitraril
-0000ed80: 7929 2e0a 2020 2020 2020 2020 2020 2020  y)..            
-0000ed90: 2020 2020 2020 2020 2265 7272 6f72 223a          "error":
-0000eda0: 2074 6872 6f77 2061 2056 616c 7565 4572   throw a ValueEr
-0000edb0: 726f 7220 7768 656e 2061 7474 656d 7074  ror when attempt
-0000edc0: 696e 6720 746f 2077 7269 7465 2061 2067  ing to write a g
-0000edd0: 6473 2077 6974 6820 6475 706c 6963 6174  ds with duplicat
-0000ede0: 6520 6365 6c6c 732e 0a20 2020 2020 2020  e cells..       
-0000edf0: 2020 2020 2020 2020 2020 2020 2022 6f76               "ov
-0000ee00: 6572 7772 6974 6522 3a20 6f76 6572 7772  erwrite": overwr
-0000ee10: 6974 6520 616c 6c20 6475 706c 6963 6174  ite all duplicat
-0000ee20: 6520 6365 6c6c 7320 7769 7468 206f 6e65  e cells with one
-0000ee30: 206f 6620 7468 6520 6475 706c 6963 6174   of the duplicat
-0000ee40: 6573 2c20 7769 7468 6f75 7420 7761 726e  es, without warn
-0000ee50: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-0000ee60: 2020 2020 2020 2020 204e 6f6e 653a 2064           None: d
-0000ee70: 6f20 6e6f 7420 7472 7920 746f 2072 6573  o not try to res
-0000ee80: 6f6c 7665 2028 6174 2079 6f75 7220 6f77  olve (at your ow
-0000ee90: 6e20 7269 736b 2129 0a20 2020 2020 2020  n risk!).       
-0000eea0: 2020 2020 2020 2020 2066 6c61 7474 656e           flatten
-0000eeb0: 5f69 6e76 616c 6964 5f72 6566 733a 2066  _invalid_refs: f
-0000eec0: 6c61 7474 656e 7320 636f 6d70 6f6e 656e  lattens componen
-0000eed0: 7420 7265 6665 7265 6e63 6573 2077 6869  t references whi
-0000eee0: 6368 2068 6176 6520 696e 7661 6c69 6420  ch have invalid 
-0000eef0: 7472 616e 7366 6f72 6d61 7469 6f6e 732e  transformations.
-0000ef00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef10: 206d 6178 5f70 6f69 6e74 733a 204d 6178   max_points: Max
-0000ef20: 696d 616c 206e 756d 6265 7220 6f66 2076  imal number of v
-0000ef30: 6572 7469 6365 7320 7065 7220 706f 6c79  ertices per poly
-0000ef40: 676f 6e2e 2050 6f6c 7967 6f6e 7320 7769  gon. Polygons wi
-0000ef50: 7468 206d 6f72 6520 7665 7274 6963 6573  th more vertices
-0000ef60: 2074 6861 7420 7468 6973 2061 7265 2061   that this are a
-0000ef70: 7574 6f6d 6174 6963 616c 6c79 2066 7261  utomatically fra
-0000ef80: 6374 7572 6564 2e0a 0a20 2020 2020 2020  ctured...       
-0000ef90: 2020 2020 204f 6173 6973 2073 6574 7469       Oasis setti
-0000efa0: 6e67 733a 0a20 2020 2020 2020 2020 2020  ngs:.           
-0000efb0: 2020 2020 2063 6f6d 7072 6573 7369 6f6e       compression
-0000efc0: 5f6c 6576 656c 3a20 4c65 7665 6c20 6f66  _level: Level of
-0000efd0: 2063 6f6d 7072 6573 7369 6f6e 2066 6f72   compression for
-0000efe0: 2063 656c 6c73 2028 6265 7477 6565 6e20   cells (between 
-0000eff0: 3020 616e 6420 3929 2e0a 2020 2020 2020  0 and 9)..      
-0000f000: 2020 2020 2020 2020 2020 2020 2020 5365                Se
-0000f010: 7474 696e 6720 746f 2030 2077 696c 6c20  tting to 0 will 
-0000f020: 6469 7361 626c 6520 6365 6c6c 2063 6f6d  disable cell com
-0000f030: 7072 6573 7369 6f6e 2c20 3120 6769 7665  pression, 1 give
-0000f040: 7320 7468 6520 6265 7374 2073 7065 6564  s the best speed
-0000f050: 2061 6e64 2039 2c20 7468 6520 6265 7374   and 9, the best
-0000f060: 2063 6f6d 7072 6573 7369 6f6e 2e0a 2020   compression..  
-0000f070: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000f080: 7465 6374 5f72 6563 7461 6e67 6c65 733a  tect_rectangles:
-0000f090: 2053 746f 7265 2072 6563 7461 6e67 6c65   Store rectangle
-0000f0a0: 7320 696e 2063 6f6d 7072 6573 7365 6420  s in compressed 
-0000f0b0: 666f 726d 6174 2e0a 2020 2020 2020 2020  format..        
-0000f0c0: 2020 2020 2020 2020 6465 7465 6374 5f74          detect_t
-0000f0d0: 7261 7065 7a6f 6964 733a 2053 746f 7265  rapezoids: Store
-0000f0e0: 2074 7261 7065 7a6f 6964 7320 696e 2063   trapezoids in c
-0000f0f0: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
-0000f100: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f110: 2020 6369 7263 6c65 5f74 6f6c 6572 616e    circle_toleran
-0000f120: 6365 3a20 546f 6c65 7261 6e63 6520 666f  ce: Tolerance fo
-0000f130: 7220 6465 7465 6374 696e 6720 6369 7263  r detecting circ
-0000f140: 6c65 732e 2049 6620 6c65 7373 206f 7220  les. If less or 
-0000f150: 6571 7561 6c20 746f 2030 2c20 6e6f 2064  equal to 0, no d
-0000f160: 6574 6563 7469 6f6e 2069 7320 7065 7266  etection is perf
-0000f170: 6f72 6d65 642e 2043 6972 636c 6573 2061  ormed. Circles a
-0000f180: 7265 2073 746f 7265 6420 696e 2063 6f6d  re stored in com
-0000f190: 7072 6573 7365 6420 666f 726d 6174 2e0a  pressed format..
+000000b0: 6173 686c 6962 0a69 6d70 6f72 7420 696d  ashlib.import im
+000000c0: 706f 7274 6c69 622e 7574 696c 0a69 6d70  portlib.util.imp
+000000d0: 6f72 7420 6974 6572 746f 6f6c 730a 696d  ort itertools.im
+000000e0: 706f 7274 206d 6174 680a 696d 706f 7274  port math.import
+000000f0: 2070 6174 686c 6962 0a69 6d70 6f72 7420   pathlib.import 
+00000100: 7575 6964 0a69 6d70 6f72 7420 7761 726e  uuid.import warn
+00000110: 696e 6773 0a66 726f 6d20 636f 6c6c 6563  ings.from collec
+00000120: 7469 6f6e 7320 696d 706f 7274 2043 6f75  tions import Cou
+00000130: 6e74 6572 0a66 726f 6d20 636f 6c6c 6563  nter.from collec
+00000140: 7469 6f6e 732e 6162 6320 696d 706f 7274  tions.abc import
+00000150: 2049 7465 7261 626c 652c 204d 6170 7069   Iterable, Mappi
+00000160: 6e67 0a66 726f 6d20 636f 7079 2069 6d70  ng.from copy imp
+00000170: 6f72 7420 6465 6570 636f 7079 0a66 726f  ort deepcopy.fro
+00000180: 6d20 7061 7468 6c69 6220 696d 706f 7274  m pathlib import
+00000190: 2050 6174 680a 6672 6f6d 2074 7970 696e   Path.from typin
+000001a0: 6720 696d 706f 7274 2054 5950 455f 4348  g import TYPE_CH
+000001b0: 4543 4b49 4e47 2c20 416e 792c 204c 6974  ECKING, Any, Lit
+000001c0: 6572 616c 0a0a 696d 706f 7274 2067 6473  eral..import gds
+000001d0: 746b 0a69 6d70 6f72 7420 6e75 6d70 7920  tk.import numpy 
+000001e0: 6173 206e 700a 696d 706f 7274 2073 6861  as np.import sha
+000001f0: 7065 6c79 0a69 6d70 6f72 7420 7961 6d6c  pely.import yaml
+00000200: 0a66 726f 6d20 6f6d 6567 6163 6f6e 6620  .from omegaconf 
+00000210: 696d 706f 7274 2044 6963 7443 6f6e 6669  import DictConfi
+00000220: 670a 0a66 726f 6d20 6764 7366 6163 746f  g..from gdsfacto
+00000230: 7279 2e63 6f6d 706f 6e65 6e74 5f6c 6179  ry.component_lay
+00000240: 6f75 7420 696d 706f 7274 2028 0a20 2020  out import (.   
+00000250: 204c 6162 656c 2c0a 2020 2020 5f61 6c69   Label,.    _ali
+00000260: 676e 2c0a 2020 2020 5f64 6973 7472 6962  gn,.    _distrib
+00000270: 7574 652c 0a20 2020 205f 4765 6f6d 6574  ute,.    _Geomet
+00000280: 7279 4865 6c70 6572 2c0a 2020 2020 5f70  ryHelper,.    _p
+00000290: 6172 7365 5f6c 6179 6572 2c0a 2020 2020  arse_layer,.    
+000002a0: 6765 745f 706f 6c79 676f 6e73 2c0a 290a  get_polygons,.).
+000002b0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+000002c0: 636f 6d70 6f6e 656e 745f 7265 6665 7265  component_refere
+000002d0: 6e63 6520 696d 706f 7274 2043 6f6d 706f  nce import Compo
+000002e0: 6e65 6e74 5265 6665 7265 6e63 652c 2053  nentReference, S
+000002f0: 697a 6549 6e66 6f0a 6672 6f6d 2067 6473  izeInfo.from gds
+00000300: 6661 6374 6f72 792e 636f 6e66 6967 2069  factory.config i
+00000310: 6d70 6f72 7420 434f 4e46 2c20 4744 5344  mport CONF, GDSD
+00000320: 4952 5f54 454d 502c 206c 6f67 6765 720a  IR_TEMP, logger.
+00000330: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00000340: 6765 6e65 7269 635f 7465 6368 2069 6d70  generic_tech imp
+00000350: 6f72 7420 4c41 5945 520a 6672 6f6d 2067  ort LAYER.from g
+00000360: 6473 6661 6374 6f72 792e 706f 6c79 676f  dsfactory.polygo
+00000370: 6e20 696d 706f 7274 2050 6f6c 7967 6f6e  n import Polygon
+00000380: 0a66 726f 6d20 6764 7366 6163 746f 7279  .from gdsfactory
+00000390: 2e70 6f72 7420 696d 706f 7274 2028 0a20  .port import (. 
+000003a0: 2020 2050 6f72 742c 0a20 2020 2061 7574     Port,.    aut
+000003b0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 2c0a  o_rename_ports,.
+000003c0: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
+000003d0: 706f 7274 735f 636f 756e 7465 725f 636c  ports_counter_cl
+000003e0: 6f63 6b77 6973 652c 0a20 2020 2061 7574  ockwise,.    aut
+000003f0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6c  o_rename_ports_l
+00000400: 6179 6572 5f6f 7269 656e 7461 7469 6f6e  ayer_orientation
+00000410: 2c0a 2020 2020 6175 746f 5f72 656e 616d  ,.    auto_renam
+00000420: 655f 706f 7274 735f 6f72 6965 6e74 6174  e_ports_orientat
+00000430: 696f 6e2c 0a20 2020 206d 6170 5f70 6f72  ion,.    map_por
+00000440: 7473 5f6c 6179 6572 5f74 6f5f 6f72 6965  ts_layer_to_orie
+00000450: 6e74 6174 696f 6e2c 0a20 2020 206d 6170  ntation,.    map
+00000460: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
+00000470: 6174 696f 6e5f 6363 772c 0a20 2020 206d  ation_ccw,.    m
+00000480: 6170 5f70 6f72 7473 5f74 6f5f 6f72 6965  ap_ports_to_orie
+00000490: 6e74 6174 696f 6e5f 6377 2c0a 2020 2020  ntation_cw,.    
+000004a0: 7365 6c65 6374 5f70 6f72 7473 2c0a 290a  select_ports,.).
+000004b0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+000004c0: 7365 7269 616c 697a 6174 696f 6e20 696d  serialization im
+000004d0: 706f 7274 2063 6c65 616e 5f64 6963 740a  port clean_dict.
+000004e0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+000004f0: 7465 6368 6e6f 6c6f 6779 2069 6d70 6f72  technology impor
+00000500: 7420 4c61 7965 7253 7461 636b 2c20 4c61  t LayerStack, La
+00000510: 7965 7256 6965 772c 204c 6179 6572 5669  yerView, LayerVi
+00000520: 6577 730a 0a69 6620 5459 5045 5f43 4845  ews..if TYPE_CHE
+00000530: 434b 494e 473a 0a20 2020 2066 726f 6d20  CKING:.    from 
+00000540: 6764 7366 6163 746f 7279 2e74 7970 696e  gdsfactory.typin
+00000550: 6773 2069 6d70 6f72 7420 280a 2020 2020  gs import (.    
+00000560: 2020 2020 436f 6f72 6469 6e61 7465 2c0a      Coordinate,.
+00000570: 2020 2020 2020 2020 4372 6f73 7353 6563          CrossSec
+00000580: 7469 6f6e 5370 6563 2c0a 2020 2020 2020  tionSpec,.      
+00000590: 2020 466c 6f61 7432 2c0a 2020 2020 2020    Float2,.      
+000005a0: 2020 4c61 7965 722c 0a20 2020 2020 2020    Layer,.       
+000005b0: 204c 6179 6572 732c 0a20 2020 2020 2020   Layers,.       
+000005c0: 204c 6179 6572 5370 6563 2c0a 2020 2020   LayerSpec,.    
+000005d0: 2020 2020 5061 7468 5479 7065 2c0a 2020      PathType,.  
+000005e0: 2020 290a 0a76 616c 6964 5f70 6c6f 7474    )..valid_plott
+000005f0: 6572 7320 3d20 5b0a 2020 2020 2268 6f6c  ers = [.    "hol
+00000600: 6f76 6965 7773 222c 0a20 2020 2022 6d61  oviews",.    "ma
+00000610: 7470 6c6f 746c 6962 222c 0a20 2020 2022  tplotlib",.    "
+00000620: 7769 6467 6574 222c 0a20 2020 2022 6b6c  widget",.    "kl
+00000630: 6179 6f75 7422 2c0a 2020 2020 2271 7422  ayout",.    "qt"
+00000640: 2c0a 2020 2020 226b 7765 6222 2c0a 5d20  ,.    "kweb",.] 
+00000650: 2023 2071 7420 616e 6420 686f 6c6f 7669   # qt and holovi
+00000660: 6577 7320 6172 6520 6465 7072 6563 6174  ews are deprecat
+00000670: 6564 0a41 7869 7320 3d20 4c69 7465 7261  ed.Axis = Litera
+00000680: 6c5b 2278 222c 2022 7922 5d0a 0a0a 636c  l["x", "y"]...cl
+00000690: 6173 7320 556e 6361 6368 6564 436f 6d70  ass UncachedComp
+000006a0: 6f6e 656e 7457 6172 6e69 6e67 2855 7365  onentWarning(Use
+000006b0: 7257 6172 6e69 6e67 293a 0a20 2020 2070  rWarning):.    p
+000006c0: 6173 730a 0a0a 636c 6173 7320 556e 6361  ass...class Unca
+000006d0: 6368 6564 436f 6d70 6f6e 656e 7445 7272  chedComponentErr
+000006e0: 6f72 2856 616c 7565 4572 726f 7229 3a0a  or(ValueError):.
+000006f0: 2020 2020 7061 7373 0a0a 0a63 6c61 7373      pass...class
+00000700: 204d 7574 6162 696c 6974 7945 7272 6f72   MutabilityError
+00000710: 2856 616c 7565 4572 726f 7229 3a0a 2020  (ValueError):.  
+00000720: 2020 7061 7373 0a0a 0a64 6566 205f 6765    pass...def _ge
+00000730: 745f 6465 7065 6e64 656e 6369 6573 2863  t_dependencies(c
+00000740: 6f6d 706f 6e65 6e74 2c20 7265 6665 7265  omponent, refere
+00000750: 6e63 6573 5f73 6574 2920 2d3e 204e 6f6e  nces_set) -> Non
+00000760: 653a 0a20 2020 2066 6f72 2072 6566 2069  e:.    for ref i
+00000770: 6e20 636f 6d70 6f6e 656e 742e 7265 6665  n component.refe
+00000780: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
+00000790: 7265 6665 7265 6e63 6573 5f73 6574 2e61  references_set.a
+000007a0: 6464 2872 6566 2e72 6566 5f63 656c 6c29  dd(ref.ref_cell)
+000007b0: 0a20 2020 2020 2020 205f 6765 745f 6465  .        _get_de
+000007c0: 7065 6e64 656e 6369 6573 2872 6566 2e72  pendencies(ref.r
+000007d0: 6566 5f63 656c 6c2c 2072 6566 6572 656e  ef_cell, referen
+000007e0: 6365 735f 7365 7429 0a0a 0a6d 7574 6162  ces_set)...mutab
+000007f0: 696c 6974 795f 6572 726f 725f 6d65 7373  ility_error_mess
+00000800: 6167 6520 3d20 2222 220a 596f 7520 6361  age = """.You ca
+00000810: 6e6e 6f74 206d 6f64 6966 7920 6120 436f  nnot modify a Co
+00000820: 6d70 6f6e 656e 7420 6166 7465 7220 6372  mponent after cr
+00000830: 6561 7469 6f6e 2061 7320 6974 2077 696c  eation as it wil
+00000840: 6c20 6166 6665 6374 2061 6c6c 206f 6620  l affect all of 
+00000850: 6974 7320 696e 7374 616e 6365 732e 0a0a  its instances...
+00000860: 4372 6561 7465 2061 206e 6577 2043 6f6d  Create a new Com
+00000870: 706f 6e65 6e74 2061 6e64 2061 6464 2061  ponent and add a
+00000880: 2072 6566 6572 656e 6365 2074 6f20 6974   reference to it
+00000890: 2e0a 0a46 6f72 2065 7861 6d70 6c65 3a0a  ...For example:.
+000008a0: 0a23 2042 4144 0a63 203d 2067 662e 636f  .# BAD.c = gf.co
+000008b0: 6d70 6f6e 656e 7473 2e62 656e 645f 6575  mponents.bend_eu
+000008c0: 6c65 7228 290a 632e 6164 645f 7265 6628  ler().c.add_ref(
+000008d0: 6766 2e63 6f6d 706f 6e65 6e74 732e 6d7a  gf.components.mz
+000008e0: 6928 2929 0a0a 2320 474f 4f44 0a63 203d  i())..# GOOD.c =
+000008f0: 2067 662e 436f 6d70 6f6e 656e 7428 290a   gf.Component().
+00000900: 632e 6164 645f 7265 6628 6766 2e63 6f6d  c.add_ref(gf.com
+00000910: 706f 6e65 6e74 732e 6265 6e64 5f65 756c  ponents.bend_eul
+00000920: 6572 2829 290a 632e 6164 645f 7265 6628  er()).c.add_ref(
+00000930: 6766 2e63 6f6d 706f 6e65 6e74 732e 6d7a  gf.components.mz
+00000940: 6928 2929 0a22 2222 0a0a 6d6f 7665 5f65  i())."""..move_e
+00000950: 7272 6f72 5f6d 6573 7361 6765 203d 2022  rror_message = "
+00000960: 2222 0a59 6f75 2063 616e 6e6f 7420 6d6f  "".You cannot mo
+00000970: 7665 2061 2043 6f6d 706f 6e65 6e74 2e20  ve a Component. 
+00000980: 596f 7520 6361 6e20 6372 6561 7465 2061  You can create a
+00000990: 206e 6577 2043 6f6d 706f 6e65 6e74 2c20   new Component, 
+000009a0: 6164 6420 6120 7265 6665 7265 6e63 6520  add a reference 
+000009b0: 746f 2074 6865 206f 7468 6572 2043 6f6d  to the other Com
+000009c0: 706f 6e65 6e74 2061 6e64 2074 6865 6e20  ponent and then 
+000009d0: 6d6f 7665 2074 6865 2072 6566 6572 656e  move the referen
+000009e0: 6365 2e0a 0a46 6f72 2065 7861 6d70 6c65  ce...For example
+000009f0: 3a0a 0a23 2042 4144 0a63 203d 2067 662e  :..# BAD.c = gf.
+00000a00: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
+00000a10: 6768 7428 290a 632e 786d 696e 203d 2031  ght().c.xmin = 1
+00000a20: 300a 0a23 2047 4f4f 440a 6320 3d20 6766  0..# GOOD.c = gf
+00000a30: 2e43 6f6d 706f 6e65 6e74 2829 0a72 6566  .Component().ref
+00000a40: 203d 2063 2e61 6464 5f72 6566 2867 662e   = c.add_ref(gf.
+00000a50: 636f 6d70 6f6e 656e 7473 2e73 7472 6169  components.strai
+00000a60: 6768 7428 2929 2023 206f 7220 7265 6620  ght()) # or ref 
+00000a70: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
+00000a80: 656e 7473 2e73 7472 6169 6768 7428 290a  ents.straight().
+00000a90: 7265 662e 786d 696e 203d 2031 300a 2222  ref.xmin = 10.""
+00000aa0: 220a 0a0a 5f74 696d 6573 7461 6d70 3230  "..._timestamp20
+00000ab0: 3139 203d 2064 6174 6574 696d 652e 6461  19 = datetime.da
+00000ac0: 7465 7469 6d65 2e66 726f 6d74 696d 6573  tetime.fromtimes
+00000ad0: 7461 6d70 2831 3537 3230 3134 3139 322e  tamp(1572014192.
+00000ae0: 3832 3733 290a 4d41 585f 4e41 4d45 5f4c  8273).MAX_NAME_L
+00000af0: 454e 4754 4820 3d20 3332 0a0a 0a64 6566  ENGTH = 32...def
+00000b00: 205f 726e 6428 6172 722c 2070 7265 6369   _rnd(arr, preci
+00000b10: 7369 6f6e 3d31 652d 3429 3a0a 2020 2020  sion=1e-4):.    
+00000b20: 6172 7220 3d20 6e70 2e61 7363 6f6e 7469  arr = np.asconti
+00000b30: 6775 6f75 7361 7272 6179 2861 7272 290a  guousarray(arr).
+00000b40: 2020 2020 6e64 6967 6974 7320 3d20 726f      ndigits = ro
+00000b50: 756e 6428 2d6d 6174 682e 6c6f 6731 3028  und(-math.log10(
+00000b60: 7072 6563 6973 696f 6e29 290a 2020 2020  precision)).    
+00000b70: 7265 7475 726e 206e 702e 6173 636f 6e74  return np.ascont
+00000b80: 6967 756f 7573 6172 7261 7928 6172 722e  iguousarray(arr.
+00000b90: 726f 756e 6428 6e64 6967 6974 7329 202f  round(ndigits) /
+00000ba0: 2070 7265 6369 7369 6f6e 2c20 6474 7970   precision, dtyp
+00000bb0: 653d 6e70 2e69 6e74 3634 290a 0a0a 636c  e=np.int64)...cl
+00000bc0: 6173 7320 436f 6d70 6f6e 656e 7428 5f47  ass Component(_G
+00000bd0: 656f 6d65 7472 7948 656c 7065 7229 3a0a  eometryHelper):.
+00000be0: 2020 2020 2222 2241 2043 6f6d 706f 6e65      """A Compone
+00000bf0: 6e74 2069 7320 616e 2065 6d70 7479 2063  nt is an empty c
+00000c00: 616e 7661 7320 7768 6572 6520 796f 7520  anvas where you 
+00000c10: 6164 6420 706f 6c79 676f 6e73 2c20 7265  add polygons, re
+00000c20: 6665 7265 6e63 6573 2061 6e64 2070 6f72  ferences and por
+00000c30: 7473 205c 0a20 2020 2020 2020 2020 2020  ts \.           
+00000c40: 2028 746f 2063 6f6e 6e65 6374 2074 6f20   (to connect to 
+00000c50: 6f74 6865 7220 636f 6d70 6f6e 656e 7473  other components
+00000c60: 292e 0a0a 2020 2020 2d20 7374 6f72 6573  )...    - stores
+00000c70: 2073 6574 7469 6e67 7320 7468 6174 2079   settings that y
+00000c80: 6f75 2075 7365 2074 6f20 6275 696c 6420  ou use to build 
+00000c90: 7468 6520 636f 6d70 6f6e 656e 740a 2020  the component.  
+00000ca0: 2020 2d20 7374 6f72 6573 2069 6e66 6f20    - stores info 
+00000cb0: 7468 6174 2079 6f75 2077 616e 7420 746f  that you want to
+00000cc0: 2075 7365 0a20 2020 202d 2063 616e 2072   use.    - can r
+00000cd0: 6574 7572 6e20 706f 7274 7320 6279 2074  eturn ports by t
+00000ce0: 7970 6520 286f 7074 6963 616c 2c20 656c  ype (optical, el
+00000cf0: 6563 7472 6963 616c 202e 2e2e 290a 2020  ectrical ...).  
+00000d00: 2020 2d20 6361 6e20 7265 7475 726e 206e    - can return n
+00000d10: 6574 6c69 7374 2066 6f72 2063 6972 6375  etlist for circu
+00000d20: 6974 2073 696d 756c 6174 696f 6e0a 2020  it simulation.  
+00000d30: 2020 2d20 6361 6e20 7772 6974 6520 746f    - can write to
+00000d40: 2047 4453 2c20 4f41 5349 530a 2020 2020   GDS, OASIS.    
+00000d50: 2d20 6361 6e20 7368 6f77 2069 6e20 4b4c  - can show in KL
+00000d60: 6179 6f75 742c 206d 6174 706c 6f74 6c69  ayout, matplotli
+00000d70: 622c 2033 440a 2020 2020 2d20 6361 6e20  b, 3D.    - can 
+00000d80: 7265 7475 726e 2063 6f70 792c 206d 6972  return copy, mir
+00000d90: 726f 722c 2066 6c61 7474 656e 6564 2028  ror, flattened (
+00000da0: 6e6f 2072 6566 6572 656e 6365 7329 0a0a  no references)..
+00000db0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00000dc0: 2020 6e61 6d65 3a20 636f 6d70 6f6e 656e    name: componen
+00000dd0: 745f 6e61 6d65 2e20 5573 6520 4063 656c  t_name. Use @cel
+00000de0: 6c20 6465 636f 7261 746f 7220 666f 7220  l decorator for 
+00000df0: 6175 746f 2d6e 616d 696e 672e 0a20 2020  auto-naming..   
+00000e00: 2020 2020 2077 6974 685f 7575 6964 3a20       with_uuid: 
+00000e10: 6164 6473 2075 6e69 7175 6520 6964 656e  adds unique iden
+00000e20: 7469 6669 6572 2e0a 0a20 2020 2050 726f  tifier...    Pro
+00000e30: 7065 7274 6965 733a 0a20 2020 2020 2020  perties:.       
+00000e40: 2069 6e66 6f3a 2064 6963 7469 6f6e 6172   info: dictionar
+00000e50: 7920 7468 6174 2069 6e63 6c75 6465 730a  y that includes.
+00000e60: 2020 2020 2020 2020 2020 2020 2d20 6465              - de
+00000e70: 7269 7665 6420 7072 6f70 6572 7469 6573  rived properties
+00000e80: 0a20 2020 2020 2020 2020 2020 202d 2065  .            - e
+00000e90: 7874 6572 6e61 6c20 6d65 7461 6461 7461  xternal metadata
+00000ea0: 2028 7465 7374 5f70 726f 746f 636f 6c2c   (test_protocol,
+00000eb0: 2064 6f63 732c 202e 2e2e 290a 2020 2020   docs, ...).    
+00000ec0: 2020 2020 2020 2020 2d20 7369 6d75 6c61          - simula
+00000ed0: 7469 6f6e 5f73 6574 7469 6e67 730a 2020  tion_settings.  
+00000ee0: 2020 2020 2020 2020 2020 2d20 6675 6e63            - func
+00000ef0: 7469 6f6e 5f6e 616d 650a 2020 2020 2020  tion_name.      
+00000f00: 2020 2020 2020 2d20 6e61 6d65 3a20 666f        - name: fo
+00000f10: 7220 7468 6520 636f 6d70 6f6e 656e 740a  r the component.
+00000f20: 0a20 2020 2020 2020 2073 6574 7469 6e67  .        setting
+00000f30: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+00000f40: 756c 6c3a 2066 756c 6c20 7365 7474 696e  ull: full settin
+00000f50: 6773 2070 6173 7365 6420 746f 2074 6865  gs passed to the
+00000f60: 2066 756e 6374 696f 6e20 746f 2063 7265   function to cre
+00000f70: 6174 6520 636f 6d70 6f6e 656e 742e 0a20  ate component.. 
+00000f80: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
+00000f90: 6564 3a20 6368 616e 6765 6420 7365 7474  ed: changed sett
+00000fa0: 696e 6773 2e0a 2020 2020 2020 2020 2020  ings..          
+00000fb0: 2020 6465 6661 756c 743a 2064 6566 6175    default: defau
+00000fc0: 6c74 2063 6f6d 706f 6e65 6e74 2073 6574  lt component set
+00000fd0: 7469 6e67 732e 0a20 2020 2020 2020 2020  tings..         
+00000fe0: 2020 2063 6869 6c64 3a20 6469 6374 2069     child: dict i
+00000ff0: 6e66 6f20 6672 6f6d 2074 6865 2063 6869  nfo from the chi
+00001000: 6c64 7265 6e2c 2069 6620 616e 792e 0a20  ldren, if any.. 
+00001010: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+00001020: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
+00001030: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00001040: 6e61 6d65 3a20 7374 7220 3d20 2255 6e6e  name: str = "Unn
+00001050: 616d 6564 222c 0a20 2020 2020 2020 2077  amed",.        w
+00001060: 6974 685f 7575 6964 3a20 626f 6f6c 203d  ith_uuid: bool =
+00001070: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
+00001080: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00001090: 2222 496e 6974 6961 6c69 7a65 2074 6865  ""Initialize the
+000010a0: 2043 6f6d 706f 6e65 6e74 206f 626a 6563   Component objec
+000010b0: 742e 2222 220a 2020 2020 2020 2020 7365  t.""".        se
+000010c0: 6c66 2e75 6964 203d 2073 7472 2875 7569  lf.uid = str(uui
+000010d0: 642e 7575 6964 3428 2929 5b3a 385d 0a20  d.uuid4())[:8]. 
+000010e0: 2020 2020 2020 2069 6620 7769 7468 5f75         if with_u
+000010f0: 7569 6420 6f72 206e 616d 6520 3d3d 2022  uid or name == "
+00001100: 556e 6e61 6d65 6422 3a0a 2020 2020 2020  Unnamed":.      
+00001110: 2020 2020 2020 6e61 6d65 202b 3d20 6622        name += f"
+00001120: 5f7b 7365 6c66 2e75 6964 7d22 0a0a 2020  _{self.uid}"..  
+00001130: 2020 2020 2020 7365 6c66 2e5f 6365 6c6c        self._cell
+00001140: 203d 2067 6473 746b 2e43 656c 6c28 6e61   = gdstk.Cell(na
+00001150: 6d65 3d6e 616d 6529 0a20 2020 2020 2020  me=name).       
+00001160: 2073 656c 662e 6e61 6d65 203d 206e 616d   self.name = nam
+00001170: 650a 2020 2020 2020 2020 7365 6c66 2e69  e.        self.i
+00001180: 6e66 6f3a 2064 6963 745b 7374 722c 2041  nfo: dict[str, A
+00001190: 6e79 5d20 3d20 7b7d 0a0a 2020 2020 2020  ny] = {}..      
+000011a0: 2020 7365 6c66 2e73 6574 7469 6e67 733a    self.settings:
+000011b0: 2064 6963 745b 7374 722c 2041 6e79 5d20   dict[str, Any] 
+000011c0: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
+000011d0: 662e 5f6c 6f63 6b65 6420 3d20 4661 6c73  f._locked = Fals
+000011e0: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
+000011f0: 6765 745f 6368 696c 645f 6e61 6d65 203d  get_child_name =
+00001200: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+00001210: 656c 662e 5f72 6566 6572 656e 6365 5f6e  elf._reference_n
+00001220: 616d 6573 5f63 6f75 6e74 6572 203d 2043  ames_counter = C
+00001230: 6f75 6e74 6572 2829 0a20 2020 2020 2020  ounter().       
+00001240: 2073 656c 662e 5f72 6566 6572 656e 6365   self._reference
+00001250: 5f6e 616d 6573 5f75 7365 6420 3d20 7365  _names_used = se
+00001260: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
+00001270: 2e5f 6e61 6d65 645f 7265 6665 7265 6e63  ._named_referenc
+00001280: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+00001290: 7365 6c66 2e5f 7265 6665 7265 6e63 6573  self._references
+000012a0: 203d 205b 5d0a 0a20 2020 2020 2020 2073   = []..        s
+000012b0: 656c 662e 706f 7274 7320 3d20 7b7d 0a0a  elf.ports = {}..
+000012c0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+000012d0: 2020 6465 6620 7265 6665 7265 6e63 6573    def references
+000012e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000012f0: 7265 7475 726e 2073 656c 662e 5f72 6566  return self._ref
+00001300: 6572 656e 6365 730a 0a20 2020 2040 7072  erences..    @pr
+00001310: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
+00001320: 6f6c 7967 6f6e 7328 7365 6c66 2920 2d3e  olygons(self) ->
+00001330: 206c 6973 745b 506f 6c79 676f 6e5d 3a0a   list[Polygon]:.
+00001340: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001350: 656c 662e 5f63 656c 6c2e 706f 6c79 676f  elf._cell.polygo
+00001360: 6e73 0a0a 2020 2020 4070 726f 7065 7274  ns..    @propert
+00001370: 790a 2020 2020 6465 6620 6172 6561 2873  y.    def area(s
+00001380: 656c 6629 202d 3e20 666c 6f61 743a 0a20  elf) -> float:. 
+00001390: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000013a0: 6c66 2e5f 6365 6c6c 2e61 7265 610a 0a20  lf._cell.area.. 
+000013b0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+000013c0: 2064 6566 206c 6162 656c 7328 7365 6c66   def labels(self
+000013d0: 2920 2d3e 206c 6973 745b 4c61 6265 6c5d  ) -> list[Label]
+000013e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000013f0: 2073 656c 662e 5f63 656c 6c2e 6c61 6265   self._cell.labe
+00001400: 6c73 0a0a 2020 2020 4070 726f 7065 7274  ls..    @propert
+00001410: 790a 2020 2020 6465 6620 7061 7468 7328  y.    def paths(
+00001420: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00001430: 6574 7572 6e20 7365 6c66 2e5f 6365 6c6c  eturn self._cell
+00001440: 2e70 6174 6873 0a0a 2020 2020 4070 726f  .paths..    @pro
+00001450: 7065 7274 790a 2020 2020 6465 6620 6e61  perty.    def na
+00001460: 6d65 2873 656c 6629 202d 3e20 7374 723a  me(self) -> str:
+00001470: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00001480: 7365 6c66 2e5f 6365 6c6c 2e6e 616d 650a  self._cell.name.
+00001490: 0a20 2020 2040 6e61 6d65 2e73 6574 7465  .    @name.sette
+000014a0: 720a 2020 2020 6465 6620 6e61 6d65 2873  r.    def name(s
+000014b0: 656c 662c 2076 616c 7565 2920 2d3e 204e  elf, value) -> N
+000014c0: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+000014d0: 662e 5f63 656c 6c2e 6e61 6d65 203d 2076  f._cell.name = v
+000014e0: 616c 7565 0a0a 2020 2020 6465 6620 5f5f  alue..    def __
+000014f0: 6974 6572 5f5f 2873 656c 6629 3a0a 2020  iter__(self):.  
+00001500: 2020 2020 2020 2222 2259 6f75 2063 616e        """You can
+00001510: 2069 7465 7261 7465 206f 7665 7220 706f   iterate over po
+00001520: 6c79 676f 6e73 2c20 7061 7468 732c 206c  lygons, paths, l
+00001530: 6162 656c 7320 616e 6420 7265 6665 7265  abels and refere
+00001540: 6e63 6573 2e22 2222 0a20 2020 2020 2020  nces.""".       
+00001550: 2072 6574 7572 6e20 6974 6572 746f 6f6c   return itertool
+00001560: 732e 6368 6169 6e28 7365 6c66 2e70 6f6c  s.chain(self.pol
+00001570: 7967 6f6e 732c 2073 656c 662e 7061 7468  ygons, self.path
+00001580: 732c 2073 656c 662e 6c61 6265 6c73 2c20  s, self.labels, 
+00001590: 7365 6c66 2e72 6566 6572 656e 6365 7329  self.references)
+000015a0: 0a0a 2020 2020 6465 6620 6765 745f 706f  ..    def get_po
+000015b0: 6c79 676f 6e5f 656e 636c 6f73 7572 6528  lygon_enclosure(
+000015c0: 7365 6c66 2920 2d3e 2073 6861 7065 6c79  self) -> shapely
+000015d0: 2e50 6f6c 7967 6f6e 3a0a 2020 2020 2020  .Polygon:.      
+000015e0: 2020 7265 7475 726e 2073 6861 7065 6c79    return shapely
+000015f0: 2e50 6f6c 7967 6f6e 2873 656c 662e 5f63  .Polygon(self._c
+00001600: 656c 6c2e 636f 6e76 6578 5f68 756c 6c28  ell.convex_hull(
+00001610: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
+00001620: 706f 6c79 676f 6e5f 6262 6f78 280a 2020  polygon_bbox(.  
+00001630: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00001640: 2020 2020 6465 6661 756c 743a 2066 6c6f      default: flo
+00001650: 6174 203d 2030 2e30 2c0a 2020 2020 2020  at = 0.0,.      
+00001660: 2020 746f 703a 2066 6c6f 6174 207c 204e    top: float | N
+00001670: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
+00001680: 2020 2020 626f 7474 6f6d 3a20 666c 6f61      bottom: floa
+00001690: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
+000016a0: 0a20 2020 2020 2020 2072 6967 6874 3a20  .        right: 
+000016b0: 666c 6f61 7420 7c20 4e6f 6e65 203d 204e  float | None = N
+000016c0: 6f6e 652c 0a20 2020 2020 2020 206c 6566  one,.        lef
+000016d0: 743a 2066 6c6f 6174 207c 204e 6f6e 6520  t: float | None 
+000016e0: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+000016f0: 2073 6861 7065 6c79 2e50 6f6c 7967 6f6e   shapely.Polygon
+00001700: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00001710: 7572 6e73 2073 6861 7065 6c79 2050 6f6c  urns shapely Pol
+00001720: 7967 6f6e 2077 6974 6820 626f 756e 6469  ygon with boundi
+00001730: 6e67 2062 6f78 2e0a 0a20 2020 2020 2020  ng box...       
+00001740: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00001750: 2020 2064 6566 6175 6c74 3a20 6465 6661     default: defa
+00001760: 756c 7420 7061 6464 696e 6720 696e 2075  ult padding in u
+00001770: 6d2e 0a20 2020 2020 2020 2020 2020 2074  m..            t
+00001780: 6f70 3a20 6e6f 7274 6820 7061 6464 696e  op: north paddin
+00001790: 6720 696e 2075 6d2e 0a20 2020 2020 2020  g in um..       
+000017a0: 2020 2020 2062 6f74 746f 6d3a 2073 6f75       bottom: sou
+000017b0: 7468 2070 6164 6469 6e67 2069 6e20 756d  th padding in um
+000017c0: 2e0a 2020 2020 2020 2020 2020 2020 7269  ..            ri
+000017d0: 6768 743a 2065 6173 7420 7061 6464 696e  ght: east paddin
+000017e0: 6720 696e 2075 6d2e 0a20 2020 2020 2020  g in um..       
+000017f0: 2020 2020 206c 6566 743a 2077 6573 7420       left: west 
+00001800: 7061 6464 696e 6720 696e 2075 6d2e 0a20  padding in um.. 
+00001810: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00001820: 2020 2028 786d 696e 2c20 796d 696e 292c     (xmin, ymin),
+00001830: 2028 786d 6178 2c20 796d 6178 2920 3d20   (xmax, ymax) = 
+00001840: 7365 6c66 2e62 626f 780a 2020 2020 2020  self.bbox.      
+00001850: 2020 746f 7020 3d20 746f 7020 6966 2074    top = top if t
+00001860: 6f70 2069 7320 6e6f 7420 4e6f 6e65 2065  op is not None e
+00001870: 6c73 6520 6465 6661 756c 740a 2020 2020  lse default.    
+00001880: 2020 2020 626f 7474 6f6d 203d 2062 6f74      bottom = bot
+00001890: 746f 6d20 6966 2062 6f74 746f 6d20 6973  tom if bottom is
+000018a0: 206e 6f74 204e 6f6e 6520 656c 7365 2064   not None else d
+000018b0: 6566 6175 6c74 0a20 2020 2020 2020 2072  efault.        r
+000018c0: 6967 6874 203d 2072 6967 6874 2069 6620  ight = right if 
+000018d0: 7269 6768 7420 6973 206e 6f74 204e 6f6e  right is not Non
+000018e0: 6520 656c 7365 2064 6566 6175 6c74 0a20  e else default. 
+000018f0: 2020 2020 2020 206c 6566 7420 3d20 6c65         left = le
+00001900: 6674 2069 6620 6c65 6674 2069 7320 6e6f  ft if left is no
+00001910: 7420 4e6f 6e65 2065 6c73 6520 6465 6661  t None else defa
+00001920: 756c 740a 2020 2020 2020 2020 706f 696e  ult.        poin
+00001930: 7473 203d 205b 0a20 2020 2020 2020 2020  ts = [.         
+00001940: 2020 205b 786d 696e 202d 206c 6566 742c     [xmin - left,
+00001950: 2079 6d69 6e20 2d20 626f 7474 6f6d 5d2c   ymin - bottom],
+00001960: 0a20 2020 2020 2020 2020 2020 205b 786d  .            [xm
+00001970: 6178 202b 2072 6967 6874 2c20 796d 696e  ax + right, ymin
+00001980: 202d 2062 6f74 746f 6d5d 2c0a 2020 2020   - bottom],.    
+00001990: 2020 2020 2020 2020 5b78 6d61 7820 2b20          [xmax + 
+000019a0: 7269 6768 742c 2079 6d61 7820 2b20 746f  right, ymax + to
+000019b0: 705d 2c0a 2020 2020 2020 2020 2020 2020  p],.            
+000019c0: 5b78 6d69 6e20 2d20 6c65 6674 2c20 796d  [xmin - left, ym
+000019d0: 6178 202b 2074 6f70 5d2c 0a20 2020 2020  ax + top],.     
+000019e0: 2020 205d 0a20 2020 2020 2020 2072 6574     ].        ret
+000019f0: 7572 6e20 7368 6170 656c 792e 506f 6c79  urn shapely.Poly
+00001a00: 676f 6e28 706f 696e 7473 290a 0a20 2020  gon(points)..   
+00001a10: 2064 6566 2067 6574 5f70 6f6c 7967 6f6e   def get_polygon
+00001a20: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+00001a30: 0a20 2020 2020 2020 2062 795f 7370 6563  .        by_spec
+00001a40: 3a20 626f 6f6c 207c 2074 7570 6c65 5b69  : bool | tuple[i
+00001a50: 6e74 2c20 696e 745d 203d 2046 616c 7365  nt, int] = False
+00001a60: 2c0a 2020 2020 2020 2020 6465 7074 683a  ,.        depth:
+00001a70: 2069 6e74 207c 204e 6f6e 6520 3d20 4e6f   int | None = No
+00001a80: 6e65 2c0a 2020 2020 2020 2020 696e 636c  ne,.        incl
+00001a90: 7564 655f 7061 7468 733a 2062 6f6f 6c20  ude_paths: bool 
+00001aa0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00001ab0: 6173 5f61 7272 6179 3a20 626f 6f6c 203d  as_array: bool =
+00001ac0: 2054 7275 652c 0a20 2020 2020 2020 2061   True,.        a
+00001ad0: 735f 7368 6170 656c 793a 2062 6f6f 6c20  s_shapely: bool 
+00001ae0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00001af0: 2061 735f 7368 6170 656c 795f 6d65 7267   as_shapely_merg
+00001b00: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
+00001b10: 2c0a 2020 2020 2920 2d3e 206c 6973 745b  ,.    ) -> list[
+00001b20: 506f 6c79 676f 6e5d 207c 2064 6963 745b  Polygon] | dict[
+00001b30: 7475 706c 655b 696e 742c 2069 6e74 5d2c  tuple[int, int],
+00001b40: 206c 6973 745b 506f 6c79 676f 6e5d 5d3a   list[Polygon]]:
+00001b50: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00001b60: 726e 2061 206c 6973 7420 6f66 2070 6f6c  rn a list of pol
+00001b70: 7967 6f6e 7320 696e 2074 6869 7320 6365  ygons in this ce
+00001b80: 6c6c 2e0a 0a20 2020 2020 2020 2041 7267  ll...        Arg
+00001b90: 733a 0a20 2020 2020 2020 2020 2020 2062  s:.            b
+00001ba0: 795f 7370 6563 3a20 626f 6f6c 206f 7220  y_spec: bool or 
+00001bb0: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
+00001bc0: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00001bd0: 6865 2072 6574 7572 6e20 7661 6c75 6520  he return value 
+00001be0: 6973 2061 2064 6963 7469 6f6e 6172 7920  is a dictionary 
+00001bf0: 7769 7468 2074 6865 0a20 2020 2020 2020  with the.       
+00001c00: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00001c10: 7320 6f66 2065 6163 6820 696e 6469 7669  s of each indivi
+00001c20: 6475 616c 2070 6169 7220 286c 6179 6572  dual pair (layer
+00001c30: 2c20 6461 7461 7479 7065 292c 2077 6869  , datatype), whi
+00001c40: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
+00001c50: 2020 2061 7265 2075 7365 6420 6173 206b     are used as k
+00001c60: 6579 732e 2020 4966 2073 6574 2074 6f20  eys.  If set to 
+00001c70: 6120 7475 706c 6520 6f66 2028 6c61 7965  a tuple of (laye
+00001c80: 722c 2064 6174 6174 7970 6529 2c0a 2020  r, datatype),.  
+00001c90: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+00001ca0: 6c79 2070 6f6c 7967 6f6e 7320 7769 7468  ly polygons with
+00001cb0: 2074 6861 7420 7370 6563 6966 6963 6174   that specificat
+00001cc0: 696f 6e20 6172 6520 7265 7475 726e 6564  ion are returned
+00001cd0: 2e0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00001ce0: 7074 683a 2069 6e74 6567 6572 206f 7220  pth: integer or 
+00001cf0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00001d00: 2020 2020 2049 6620 6e6f 7420 4e6f 6e65       If not None
+00001d10: 2c20 6465 6669 6e65 7320 6672 6f6d 2068  , defines from h
+00001d20: 6f77 206d 616e 7920 7265 6665 7265 6e63  ow many referenc
+00001d30: 6520 6c65 7665 6c73 2074 6f0a 2020 2020  e levels to.    
+00001d40: 2020 2020 2020 2020 2020 2020 7265 7472              retr
+00001d50: 6965 7665 2070 6f6c 7967 6f6e 732e 2020  ieve polygons.  
+00001d60: 5265 6665 7265 6e63 6573 2062 656c 6f77  References below
+00001d70: 2074 6869 7320 6c65 7665 6c20 7769 6c6c   this level will
+00001d80: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+00001d90: 2020 2020 2020 2020 696e 2061 2062 6f75          in a bou
+00001da0: 6e64 696e 6720 626f 782e 2020 4966 2060  nding box.  If `
+00001db0: 6279 5f73 7065 6360 2069 7320 5472 7565  by_spec` is True
+00001dc0: 2074 6865 206b 6579 2077 696c 6c20 6265   the key will be
+00001dd0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00001de0: 2020 2020 206e 616d 6520 6f66 2074 6869       name of thi
+00001df0: 7320 6365 6c6c 2e0a 2020 2020 2020 2020  s cell..        
+00001e00: 2020 2020 696e 636c 7564 655f 7061 7468      include_path
+00001e10: 733a 2049 6620 5472 7565 2c20 706f 6c79  s: If True, poly
+00001e20: 676f 6e61 6c20 7265 7072 6573 656e 7461  gonal representa
+00001e30: 7469 6f6e 206f 6620 7061 7468 7320 6172  tion of paths ar
+00001e40: 6520 616c 736f 2069 6e63 6c75 6465 6420  e also included 
+00001e50: 696e 2074 6865 2072 6573 756c 742e 0a20  in the result.. 
+00001e60: 2020 2020 2020 2020 2020 2061 735f 6172             as_ar
+00001e70: 7261 793a 2077 6865 6e20 6173 5f61 7272  ray: when as_arr
+00001e80: 6179 3d66 616c 7365 2c20 7265 7475 726e  ay=false, return
+00001e90: 2074 6865 2050 6f6c 7967 6f6e 206f 626a   the Polygon obj
+00001ea0: 6563 7473 2069 6e73 7465 6164 2e0a 2020  ects instead..  
+00001eb0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00001ec0: 6c79 676f 6e20 6f62 6a65 6374 7320 6861  lygon objects ha
+00001ed0: 7665 206d 6f72 6520 696e 666f 726d 6174  ve more informat
+00001ee0: 696f 6e20 2865 7370 6563 6961 6c6c 7920  ion (especially 
+00001ef0: 7768 656e 2062 795f 7370 6563 3d46 616c  when by_spec=Fal
+00001f00: 7365 2920 616e 6420 6172 6520 6661 7374  se) and are fast
+00001f10: 6572 2074 6f20 7265 7472 6965 7665 2e0a  er to retrieve..
+00001f20: 2020 2020 2020 2020 2020 2020 6173 5f73              as_s
+00001f30: 6861 7065 6c79 3a20 7265 7475 726e 7320  hapely: returns 
+00001f40: 7368 6170 656c 7920 706f 6c79 676f 6e73  shapely polygons
+00001f50: 2e0a 2020 2020 2020 2020 2020 2020 6173  ..            as
+00001f60: 5f73 6861 7065 6c79 5f6d 6572 6765 643a  _shapely_merged:
+00001f70: 2072 6574 7572 6e73 2061 2073 6861 7065   returns a shape
+00001f80: 6c79 2070 6f6c 7967 6f6e 697a 652e 0a0a  ly polygonize...
+00001f90: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00001fa0: 2020 2020 2020 2020 2020 2020 6f75 743a              out:
+00001fb0: 206c 6973 7420 6f66 2061 7272 6179 2d6c   list of array-l
+00001fc0: 696b 655b 4e5d 5b32 5d20 6f72 2064 6963  ike[N][2] or dic
+00001fd0: 7469 6f6e 6172 790a 2020 2020 2020 2020  tionary.        
+00001fe0: 2020 2020 2020 2020 4c69 7374 2063 6f6e          List con
+00001ff0: 7461 696e 696e 6720 7468 6520 636f 6f72  taining the coor
+00002000: 6469 6e61 7465 7320 6f66 2074 6865 2076  dinates of the v
+00002010: 6572 7469 6365 7320 6f66 2065 6163 680a  ertices of each.
+00002020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002030: 706f 6c79 676f 6e2c 206f 7220 6469 6374  polygon, or dict
+00002040: 696f 6e61 7279 2077 6974 6820 7769 7468  ionary with with
+00002050: 2074 6865 206c 6973 7420 6f66 2070 6f6c   the list of pol
+00002060: 7967 6f6e 7320 2869 660a 2020 2020 2020  ygons (if.      
+00002070: 2020 2020 2020 2020 2020 6062 795f 7370            `by_sp
+00002080: 6563 6020 6973 2054 7275 6529 2e0a 0a20  ec` is True)... 
+00002090: 2020 2020 2020 204e 6f74 653a 0a20 2020         Note:.   
+000020a0: 2020 2020 2020 2020 2049 6e73 7461 6e63           Instanc
+000020b0: 6573 206f 6620 6046 6c65 7850 6174 6860  es of `FlexPath`
+000020c0: 2061 6e64 2060 526f 6275 7374 5061 7468   and `RobustPath
+000020d0: 6020 6172 6520 616c 736f 2069 6e63 6c75  ` are also inclu
+000020e0: 6465 6420 696e 0a20 2020 2020 2020 2020  ded in.         
+000020f0: 2020 2074 6865 2072 6573 756c 7420 6279     the result by
+00002100: 2063 6f6d 7075 7469 6e67 2074 6865 6972   computing their
+00002110: 2070 6f6c 7967 6f6e 616c 2062 6f75 6e64   polygonal bound
+00002120: 6172 792e 0a20 2020 2020 2020 2022 2222  ary..        """
+00002130: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00002140: 6765 745f 706f 6c79 676f 6e73 280a 2020  get_polygons(.  
+00002150: 2020 2020 2020 2020 2020 696e 7374 616e            instan
+00002160: 6365 3d73 656c 662c 0a20 2020 2020 2020  ce=self,.       
+00002170: 2020 2020 2062 795f 7370 6563 3d62 795f       by_spec=by_
+00002180: 7370 6563 2c0a 2020 2020 2020 2020 2020  spec,.          
+00002190: 2020 6465 7074 683d 6465 7074 682c 0a20    depth=depth,. 
+000021a0: 2020 2020 2020 2020 2020 2069 6e63 6c75             inclu
+000021b0: 6465 5f70 6174 6873 3d69 6e63 6c75 6465  de_paths=include
+000021c0: 5f70 6174 6873 2c0a 2020 2020 2020 2020  _paths,.        
+000021d0: 2020 2020 6173 5f61 7272 6179 3d61 735f      as_array=as_
+000021e0: 6172 7261 792c 0a20 2020 2020 2020 2020  array,.         
+000021f0: 2020 2061 735f 7368 6170 656c 793d 6173     as_shapely=as
+00002200: 5f73 6861 7065 6c79 2c0a 2020 2020 2020  _shapely,.      
+00002210: 2020 2020 2020 6173 5f73 6861 7065 6c79        as_shapely
+00002220: 5f6d 6572 6765 643d 6173 5f73 6861 7065  _merged=as_shape
+00002230: 6c79 5f6d 6572 6765 642c 0a20 2020 2020  ly_merged,.     
+00002240: 2020 2029 0a0a 2020 2020 6465 6620 6765     )..    def ge
+00002250: 745f 6465 7065 6e64 656e 6369 6573 2873  t_dependencies(s
+00002260: 656c 662c 2072 6563 7572 7369 7665 3a20  elf, recursive: 
+00002270: 626f 6f6c 203d 2046 616c 7365 2920 2d3e  bool = False) ->
+00002280: 206c 6973 745b 436f 6d70 6f6e 656e 745d   list[Component]
+00002290: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+000022a0: 7572 6e20 6120 6c69 7374 206f 6620 436f  urn a list of Co
+000022b0: 6d70 6f6e 656e 7473 2072 6566 6572 656e  mponents referen
+000022c0: 6365 6420 6279 2074 6869 7320 436f 6d70  ced by this Comp
+000022d0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+000022e0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+000022f0: 2020 7265 6375 7273 6976 653a 2049 6620    recursive: If 
+00002300: 5472 7565 2072 6574 7572 6e73 2064 6570  True returns dep
+00002310: 656e 6465 6e63 6965 7320 7265 6375 7273  endencies recurs
+00002320: 6976 656c 792e 0a0a 2020 2020 2020 2020  ively...        
+00002330: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+00002340: 6f74 2072 6563 7572 7369 7665 3a0a 2020  ot recursive:.  
+00002350: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00002360: 206c 6973 7428 7b72 6566 2e70 6172 656e   list({ref.paren
+00002370: 7420 666f 7220 7265 6620 696e 2073 656c  t for ref in sel
+00002380: 662e 7265 6665 7265 6e63 6573 7d29 0a0a  f.references})..
+00002390: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
+000023a0: 6573 5f73 6574 203d 2073 6574 2829 0a20  es_set = set(). 
+000023b0: 2020 2020 2020 205f 6765 745f 6465 7065         _get_depe
+000023c0: 6e64 656e 6369 6573 2873 656c 662c 2072  ndencies(self, r
+000023d0: 6566 6572 656e 6365 735f 7365 743d 7265  eferences_set=re
+000023e0: 6665 7265 6e63 6573 5f73 6574 290a 2020  ferences_set).  
+000023f0: 2020 2020 2020 7265 7475 726e 206c 6973        return lis
+00002400: 7428 7265 6665 7265 6e63 6573 5f73 6574  t(references_set
+00002410: 290a 0a20 2020 2064 6566 2067 6574 5f63  )..    def get_c
+00002420: 6f6d 706f 6e65 6e74 5f73 7065 6328 7365  omponent_spec(se
+00002430: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+00002440: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
+00002450: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+00002460: 2020 2020 2263 6f6d 706f 6e65 6e74 223a      "component":
+00002470: 2073 656c 662e 7365 7474 696e 6773 2e66   self.settings.f
+00002480: 756e 6374 696f 6e5f 6e61 6d65 2c0a 2020  unction_name,.  
+00002490: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+000024a0: 6574 7469 6e67 7322 3a20 7365 6c66 2e73  ettings": self.s
+000024b0: 6574 7469 6e67 732e 6368 616e 6765 642c  ettings.changed,
+000024c0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+000024d0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000024e0: 6c66 2e73 6574 7469 6e67 730a 2020 2020  lf.settings.    
+000024f0: 2020 2020 2020 2020 656c 7365 207b 2263          else {"c
+00002500: 6f6d 706f 6e65 6e74 223a 2073 656c 662e  omponent": self.
+00002510: 6e61 6d65 2c20 2273 6574 7469 6e67 7322  name, "settings"
+00002520: 3a20 7b7d 7d0a 2020 2020 2020 2020 290a  : {}}.        ).
+00002530: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
+00002540: 656d 5f5f 2873 656c 662c 206b 6579 2920  em__(self, key) 
+00002550: 2d3e 2050 6f72 743a 0a20 2020 2020 2020  -> Port:.       
+00002560: 2022 2222 4163 6365 7373 2072 6566 6572   """Access refer
+00002570: 656e 6365 2070 6f72 7473 2e22 2222 0a20  ence ports.""". 
+00002580: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
+00002590: 7420 696e 2073 656c 662e 706f 7274 733a  t in self.ports:
+000025a0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+000025b0: 7473 203d 206c 6973 7428 7365 6c66 2e70  ts = list(self.p
+000025c0: 6f72 7473 2e6b 6579 7328 2929 0a20 2020  orts.keys()).   
+000025d0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000025e0: 616c 7565 4572 726f 7228 6622 7b6b 6579  alueError(f"{key
+000025f0: 2172 7d20 6e6f 7420 696e 207b 706f 7274  !r} not in {port
+00002600: 737d 2229 0a0a 2020 2020 2020 2020 7265  s}")..        re
+00002610: 7475 726e 2073 656c 662e 706f 7274 735b  turn self.ports[
+00002620: 6b65 795d 0a0a 2020 2020 6465 6620 5f5f  key]..    def __
+00002630: 6c73 6869 6674 5f5f 2873 656c 662c 2065  lshift__(self, e
+00002640: 6c65 6d65 6e74 2920 2d3e 2043 6f6d 706f  lement) -> Compo
+00002650: 6e65 6e74 5265 6665 7265 6e63 653a 0a20  nentReference:. 
+00002660: 2020 2020 2020 2022 2222 436f 6e76 656e         """Conven
+00002670: 6965 6e63 6520 6f70 6572 6174 6f72 2065  ience operator e
+00002680: 7175 6976 616c 656e 7420 746f 2061 6464  quivalent to add
+00002690: 5f72 6566 2829 2e22 2222 0a20 2020 2020  _ref().""".     
+000026a0: 2020 2072 6574 7572 6e20 7365 6c66 2e61     return self.a
+000026b0: 6464 5f72 6566 2865 6c65 6d65 6e74 290a  dd_ref(element).
+000026c0: 0a20 2020 2064 6566 2075 6e6c 6f63 6b28  .    def unlock(
+000026d0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000026e0: 2020 2020 2020 2022 2222 4f6e 6c79 2064         """Only d
+000026f0: 6f20 7468 6973 2069 6620 796f 7520 6b6e  o this if you kn
+00002700: 6f77 2077 6861 7420 796f 7520 6172 6520  ow what you are 
+00002710: 646f 696e 672e 2222 220a 2020 2020 2020  doing.""".      
+00002720: 2020 7365 6c66 2e5f 6c6f 636b 6564 203d    self._locked =
+00002730: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
+00002740: 6c6f 636b 2873 656c 6629 202d 3e20 4e6f  lock(self) -> No
+00002750: 6e65 3a0a 2020 2020 2020 2020 2222 224d  ne:.        """M
+00002760: 616b 6573 2073 7572 6520 636f 6d70 6f6e  akes sure compon
+00002770: 656e 7473 2063 616e 2774 2061 6464 206e  ents can't add n
+00002780: 6577 2065 6c65 6d65 6e74 7320 6f72 206d  ew elements or m
+00002790: 6f76 6520 6578 6973 7469 6e67 206f 6e65  ove existing one
+000027a0: 732e 0a0a 2020 2020 2020 2020 436f 6d70  s...        Comp
+000027b0: 6f6e 656e 7473 206c 6f63 6b20 6175 746f  onents lock auto
+000027c0: 6d61 7469 6361 6c6c 7920 7768 656e 2067  matically when g
+000027d0: 6f69 6e67 2069 6e74 6f20 7468 6520 4341  oing into the CA
+000027e0: 4348 4520 746f 0a20 2020 2020 2020 2065  CHE to.        e
+000027f0: 6e73 7572 6520 6f6e 6520 636f 6d70 6f6e  nsure one compon
+00002800: 656e 7420 646f 6573 206e 6f74 2063 6861  ent does not cha
+00002810: 6e67 6520 6f74 6865 7273 0a20 2020 2020  nge others.     
+00002820: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+00002830: 656c 662e 5f6c 6f63 6b65 6420 3d20 5472  elf._locked = Tr
+00002840: 7565 0a0a 2020 2020 6465 6620 5f5f 7365  ue..    def __se
+00002850: 7469 7465 6d5f 5f28 7365 6c66 2c20 6b65  titem__(self, ke
+00002860: 792c 2065 6c65 6d65 6e74 293a 0a20 2020  y, element):.   
+00002870: 2020 2020 2022 2222 416c 6c6f 7720 6164       """Allow ad
+00002880: 6469 6e67 2070 6f6c 7967 6f6e 7320 616e  ding polygons an
+00002890: 6420 6365 6c6c 2072 6566 6572 656e 6365  d cell reference
+000028a0: 732e 0a0a 2020 2020 2020 2020 6c69 6b65  s...        like
+000028b0: 2044 5b27 6172 6333 275d 203d 2070 672e   D['arc3'] = pg.
+000028c0: 6172 6328 290a 0a20 2020 2020 2020 2041  arc()..        A
+000028d0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+000028e0: 206b 6579 3a20 416c 6961 7320 6e61 6d65   key: Alias name
+000028f0: 2e0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00002900: 656d 656e 743a 204f 626a 6563 7420 7468  ement: Object th
+00002910: 6174 2077 696c 6c20 6265 2061 6363 6573  at will be acces
+00002920: 7369 626c 6520 6279 2061 6c69 6173 206e  sible by alias n
+00002930: 616d 652e 0a0a 2020 2020 2020 2020 2222  ame...        ""
+00002940: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
+00002950: 6e73 7461 6e63 6528 656c 656d 656e 742c  nstance(element,
+00002960: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+00002970: 6e63 6520 7c20 506f 6c79 676f 6e29 3a0a  nce | Polygon):.
+00002980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002990: 2e6e 616d 6564 5f72 6566 6572 656e 6365  .named_reference
+000029a0: 735b 6b65 795d 203d 2065 6c65 6d65 6e74  s[key] = element
+000029b0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000029c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000029d0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+000029e0: 2020 2020 2020 2020 2020 2020 2066 2254               f"T
+000029f0: 7269 6564 2074 6f20 6173 7369 676e 2061  ried to assign a
+00002a00: 6c69 6173 207b 6b65 7921 727d 2069 6e20  lias {key!r} in 
+00002a10: 436f 6d70 6f6e 656e 7420 7b73 656c 662e  Component {self.
+00002a20: 6e61 6d65 2172 7d2c 220a 2020 2020 2020  name!r},".      
+00002a30: 2020 2020 2020 2020 2020 2262 7574 2066            "but f
+00002a40: 6169 6c65 6420 6265 6361 7573 6520 7468  ailed because th
+00002a50: 6520 6974 656d 2077 6173 206e 6f74 2061  e item was not a
+00002a60: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+00002a70: 6e63 6522 0a20 2020 2020 2020 2020 2020  nce".           
+00002a80: 2029 0a0a 2020 2020 4063 6c61 7373 6d65   )..    @classme
+00002a90: 7468 6f64 0a20 2020 2064 6566 205f 5f67  thod.    def __g
+00002aa0: 6574 5f76 616c 6964 6174 6f72 735f 5f28  et_validators__(
+00002ab0: 636c 7329 3a0a 2020 2020 2020 2020 2222  cls):.        ""
+00002ac0: 2247 6574 2076 616c 6964 6174 6f72 7320  "Get validators 
+00002ad0: 666f 7220 7468 6520 436f 6d70 6f6e 656e  for the Componen
+00002ae0: 7420 6f62 6a65 6374 2e22 2222 0a20 2020  t object.""".   
+00002af0: 2020 2020 2079 6965 6c64 2063 6c73 2e76       yield cls.v
+00002b00: 616c 6964 6174 650a 0a20 2020 2040 636c  alidate..    @cl
+00002b10: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00002b20: 6620 7661 6c69 6461 7465 2863 6c73 2c20  f validate(cls, 
+00002b30: 7629 3a0a 2020 2020 2020 2020 2222 2250  v):.        """P
+00002b40: 7964 616e 7469 6320 6173 7375 6d65 7320  ydantic assumes 
+00002b50: 636f 6d70 6f6e 656e 7420 6973 2076 616c  component is val
+00002b60: 6964 2069 6620 7468 6520 666f 6c6c 6f77  id if the follow
+00002b70: 696e 6720 6172 6520 7472 7565 2e0a 0a20  ing are true... 
+00002b80: 2020 2020 2020 202d 206e 616d 6520 6368         - name ch
+00002b90: 6172 6163 7465 7273 203c 204d 4158 5f4e  aracters < MAX_N
+00002ba0: 414d 455f 4c45 4e47 5448 0a20 2020 2020  AME_LENGTH.     
+00002bb0: 2020 202d 2069 7320 6e6f 7420 656d 7074     - is not empt
+00002bc0: 7920 2868 6173 2072 6566 6572 656e 6365  y (has reference
+00002bd0: 7320 6f72 2070 6f6c 7967 6f6e 7329 0a20  s or polygons). 
+00002be0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00002bf0: 2020 204d 4158 5f4e 414d 455f 4c45 4e47     MAX_NAME_LENG
+00002c00: 5448 203d 2039 390a 2020 2020 2020 2020  TH = 99.        
+00002c10: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+00002c20: 6528 0a20 2020 2020 2020 2020 2020 2076  e(.            v
+00002c30: 2c20 436f 6d70 6f6e 656e 740a 2020 2020  , Component.    
+00002c40: 2020 2020 292c 2066 2254 7970 6545 7272      ), f"TypeErr
+00002c50: 6f72 2c20 476f 7420 7b74 7970 6528 7629  or, Got {type(v)
+00002c60: 7d2c 2065 7870 6563 7469 6e67 2043 6f6d  }, expecting Com
+00002c70: 706f 6e65 6e74 220a 2020 2020 2020 2020  ponent".        
+00002c80: 6173 7365 7274 2028 0a20 2020 2020 2020  assert (.       
+00002c90: 2020 2020 206c 656e 2876 2e6e 616d 6529       len(v.name)
+00002ca0: 203c 3d20 4d41 585f 4e41 4d45 5f4c 454e   <= MAX_NAME_LEN
+00002cb0: 4754 480a 2020 2020 2020 2020 292c 2066  GTH.        ), f
+00002cc0: 226e 616d 6520 607b 762e 6e61 6d65 7d60  "name `{v.name}`
+00002cd0: 207b 6c65 6e28 762e 6e61 6d65 297d 203e   {len(v.name)} >
+00002ce0: 207b 4d41 585f 4e41 4d45 5f4c 454e 4754   {MAX_NAME_LENGT
+00002cf0: 487d 2022 0a20 2020 2020 2020 2072 6574  H} ".        ret
+00002d00: 7572 6e20 760a 0a20 2020 2040 7072 6f70  urn v..    @prop
+00002d10: 6572 7479 0a20 2020 2064 6566 206e 616d  erty.    def nam
+00002d20: 6564 5f72 6566 6572 656e 6365 7328 7365  ed_references(se
+00002d30: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+00002d40: 7572 6e20 7365 6c66 2e5f 6e61 6d65 645f  urn self._named_
+00002d50: 7265 6665 7265 6e63 6573 0a0a 2020 2020  references..    
+00002d60: 6465 6620 6164 645f 6c61 6265 6c28 0a20  def add_label(. 
+00002d70: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00002d80: 2020 2020 2074 6578 743a 2073 7472 203d       text: str =
+00002d90: 2022 6865 6c6c 6f22 2c0a 2020 2020 2020   "hello",.      
+00002da0: 2020 706f 7369 7469 6f6e 3a20 7475 706c    position: tupl
+00002db0: 655b 666c 6f61 742c 2066 6c6f 6174 5d20  e[float, float] 
+00002dc0: 3d20 2830 2e30 2c20 302e 3029 2c0a 2020  = (0.0, 0.0),.  
+00002dd0: 2020 2020 2020 6d61 676e 6966 6963 6174        magnificat
+00002de0: 696f 6e3a 2066 6c6f 6174 203d 2031 2e30  ion: float = 1.0
+00002df0: 2c0a 2020 2020 2020 2020 726f 7461 7469  ,.        rotati
+00002e00: 6f6e 3a20 666c 6f61 7420 3d20 302c 0a20  on: float = 0,. 
+00002e10: 2020 2020 2020 2061 6e63 686f 723a 2073         anchor: s
+00002e20: 7472 203d 2022 6f22 2c0a 2020 2020 2020  tr = "o",.      
+00002e30: 2020 6c61 7965 723d 2254 4558 5422 2c0a    layer="TEXT",.
+00002e40: 2020 2020 2020 2020 785f 7265 666c 6563          x_reflec
+00002e50: 7469 6f6e 3d46 616c 7365 2c0a 2020 2020  tion=False,.    
+00002e60: 2920 2d3e 204c 6162 656c 3a0a 2020 2020  ) -> Label:.    
+00002e70: 2020 2020 2222 2241 6464 7320 4c61 6265      """Adds Labe
+00002e80: 6c20 746f 2074 6865 2043 6f6d 706f 6e65  l to the Compone
+00002e90: 6e74 2e0a 0a20 2020 2020 2020 2041 7267  nt...        Arg
+00002ea0: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
+00002eb0: 6578 743a 204c 6162 656c 2074 6578 742e  ext: Label text.
+00002ec0: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+00002ed0: 6974 696f 6e3a 2078 2d2c 2079 2d63 6f6f  ition: x-, y-coo
+00002ee0: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
+00002ef0: 4c61 6265 6c20 6c6f 6361 7469 6f6e 2e0a  Label location..
+00002f00: 2020 2020 2020 2020 2020 2020 6d61 676e              magn
+00002f10: 6966 6963 6174 696f 6e3a 204d 6167 6e69  ification: Magni
+00002f20: 6669 6361 7469 6f6e 2066 6163 746f 7220  fication factor 
+00002f30: 666f 7220 7468 6520 4c61 6265 6c20 7465  for the Label te
+00002f40: 7874 2e0a 2020 2020 2020 2020 2020 2020  xt..            
+00002f50: 726f 7461 7469 6f6e 3a20 416e 676c 6520  rotation: Angle 
+00002f60: 726f 7461 7469 6f6e 206f 6620 7468 6520  rotation of the 
+00002f70: 4c61 6265 6c20 7465 7874 2e0a 2020 2020  Label text..    
+00002f80: 2020 2020 2020 2020 616e 6368 6f72 3a20          anchor: 
+00002f90: 7b27 6e27 2c20 2765 272c 2027 7327 2c20  {'n', 'e', 's', 
+00002fa0: 2777 272c 2027 6f27 2c20 276e 6527 2c20  'w', 'o', 'ne', 
+00002fb0: 276e 7727 2c20 2e2e 2e7d 0a20 2020 2020  'nw', ...}.     
+00002fc0: 2020 2020 2020 2020 2020 2050 6f73 6974             Posit
+00002fd0: 696f 6e20 6f66 2074 6865 2061 6e63 686f  ion of the ancho
+00002fe0: 7220 7265 6c61 7469 7665 2074 6f20 7468  r relative to th
+00002ff0: 6520 7465 7874 2e0a 2020 2020 2020 2020  e text..        
+00003000: 2020 2020 6c61 7965 723a 2053 7065 6369      layer: Speci
+00003010: 6669 6320 6c61 7965 7228 7329 2074 6f20  fic layer(s) to 
+00003020: 7075 7420 4c61 6265 6c20 6f6e 2e0a 2020  put Label on..  
+00003030: 2020 2020 2020 2020 2020 785f 7265 666c            x_refl
+00003040: 6563 7469 6f6e 3a20 5472 7565 2072 6566  ection: True ref
+00003050: 6c65 6374 7320 6163 726f 7373 2074 6865  lects across the
+00003060: 2068 6f72 697a 6f6e 7461 6c20 6178 6973   horizontal axis
+00003070: 2062 6566 6f72 6520 726f 7461 7469 6f6e   before rotation
+00003080: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00003090: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+000030a0: 6374 6f72 792e 7064 6b20 696d 706f 7274  ctory.pdk import
+000030b0: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
+000030c0: 2020 2020 6c61 7965 7220 3d20 6765 745f      layer = get_
+000030d0: 6c61 7965 7228 6c61 7965 7229 0a0a 2020  layer(layer)..  
+000030e0: 2020 2020 2020 6764 735f 6c61 7965 722c        gds_layer,
+000030f0: 2067 6473 5f64 6174 6174 7970 6520 3d20   gds_datatype = 
+00003100: 6c61 7965 720a 0a20 2020 2020 2020 2069  layer..        i
+00003110: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00003120: 2874 6578 742c 2073 7472 293a 0a20 2020  (text, str):.   
+00003130: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
+00003140: 7465 7874 0a20 2020 2020 2020 206c 6162  text.        lab
+00003150: 656c 203d 204c 6162 656c 280a 2020 2020  el = Label(.    
+00003160: 2020 2020 2020 2020 7465 7874 3d74 6578          text=tex
+00003170: 742c 0a20 2020 2020 2020 2020 2020 206f  t,.            o
+00003180: 7269 6769 6e3d 706f 7369 7469 6f6e 2c0a  rigin=position,.
+00003190: 2020 2020 2020 2020 2020 2020 616e 6368              anch
+000031a0: 6f72 3d61 6e63 686f 722c 0a20 2020 2020  or=anchor,.     
+000031b0: 2020 2020 2020 206d 6167 6e69 6669 6361         magnifica
+000031c0: 7469 6f6e 3d6d 6167 6e69 6669 6361 7469  tion=magnificati
+000031d0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+000031e0: 726f 7461 7469 6f6e 3d72 6f74 6174 696f  rotation=rotatio
+000031f0: 6e2c 0a20 2020 2020 2020 2020 2020 206c  n,.            l
+00003200: 6179 6572 3d67 6473 5f6c 6179 6572 2c0a  ayer=gds_layer,.
+00003210: 2020 2020 2020 2020 2020 2020 7465 7874              text
+00003220: 7479 7065 3d67 6473 5f64 6174 6174 7970  type=gds_datatyp
+00003230: 652c 0a20 2020 2020 2020 2020 2020 2078  e,.            x
+00003240: 5f72 6566 6c65 6374 696f 6e3d 785f 7265  _reflection=x_re
+00003250: 666c 6563 7469 6f6e 2c0a 2020 2020 2020  flection,.      
+00003260: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
+00003270: 2e61 6464 286c 6162 656c 290a 2020 2020  .add(label).    
+00003280: 2020 2020 7265 7475 726e 206c 6162 656c      return label
+00003290: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+000032a0: 2020 2020 6465 6620 6262 6f78 2873 656c      def bbox(sel
+000032b0: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
+000032c0: 6574 7572 6e73 2074 6865 2062 6f75 6e64  eturns the bound
+000032d0: 696e 6720 626f 7820 6f66 2074 6865 2043  ing box of the C
+000032e0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+000032f0: 652e 2222 220a 2020 2020 2020 2020 6262  e.""".        bb
+00003300: 6f78 203d 2073 656c 662e 5f63 656c 6c2e  ox = self._cell.
+00003310: 626f 756e 6469 6e67 5f62 6f78 2829 0a20  bounding_box(). 
+00003320: 2020 2020 2020 2069 6620 6262 6f78 2069         if bbox i
+00003330: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00003340: 2020 2020 6262 6f78 203d 2028 2830 2c20      bbox = ((0, 
+00003350: 3029 2c20 2830 2c20 3029 290a 2020 2020  0), (0, 0)).    
+00003360: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
+00003370: 7261 7928 6262 6f78 290a 0a20 2020 2040  ray(bbox)..    @
+00003380: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00003390: 2070 6f72 7473 5f6c 6179 6572 2873 656c   ports_layer(sel
+000033a0: 6629 202d 3e20 6469 6374 5b73 7472 2c20  f) -> dict[str, 
+000033b0: 7374 725d 3a0a 2020 2020 2020 2020 2222  str]:.        ""
+000033c0: 2252 6574 7572 6e73 2061 206d 6170 7069  "Returns a mappi
+000033d0: 6e67 2066 726f 6d20 6c61 7965 7230 5f6c  ng from layer0_l
+000033e0: 6179 6572 315f 4530 3a20 706f 7274 4e61  ayer1_E0: portNa
+000033f0: 6d65 2e22 2222 0a20 2020 2020 2020 2072  me.""".        r
+00003400: 6574 7572 6e20 6d61 705f 706f 7274 735f  eturn map_ports_
+00003410: 6c61 7965 725f 746f 5f6f 7269 656e 7461  layer_to_orienta
+00003420: 7469 6f6e 2873 656c 662e 706f 7274 7329  tion(self.ports)
+00003430: 0a0a 2020 2020 6465 6620 706f 7274 5f62  ..    def port_b
+00003440: 795f 6f72 6965 6e74 6174 696f 6e5f 6377  y_orientation_cw
+00003450: 2873 656c 662c 206b 6579 3a20 7374 722c  (self, key: str,
+00003460: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00003470: 2020 2020 2222 2252 6574 7572 6e73 2070      """Returns p
+00003480: 6f72 7420 6279 2069 6e64 6578 696e 6720  ort by indexing 
+00003490: 7468 656d 2063 6c6f 636b 7769 7365 2e22  them clockwise."
+000034a0: 2222 0a20 2020 2020 2020 206d 203d 206d  "".        m = m
+000034b0: 6170 5f70 6f72 7473 5f74 6f5f 6f72 6965  ap_ports_to_orie
+000034c0: 6e74 6174 696f 6e5f 6377 2873 656c 662e  ntation_cw(self.
+000034d0: 706f 7274 732c 202a 2a6b 7761 7267 7329  ports, **kwargs)
+000034e0: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
+000034f0: 6e6f 7420 696e 206d 3a0a 2020 2020 2020  not in m:.      
+00003500: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
+00003510: 7272 6f72 2866 227b 6b65 797d 206e 6f74  rror(f"{key} not
+00003520: 2069 6e20 7b6c 6973 7428 6d2e 6b65 7973   in {list(m.keys
+00003530: 2829 297d 2229 0a20 2020 2020 2020 206b  ())}").        k
+00003540: 6579 3220 3d20 6d5b 6b65 795d 0a20 2020  ey2 = m[key].   
+00003550: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00003560: 2e70 6f72 7473 5b6b 6579 325d 0a0a 2020  .ports[key2]..  
+00003570: 2020 6465 6620 706f 7274 5f62 795f 6f72    def port_by_or
+00003580: 6965 6e74 6174 696f 6e5f 6363 7728 7365  ientation_ccw(se
+00003590: 6c66 2c20 6b65 793a 2073 7472 2c20 2a2a  lf, key: str, **
+000035a0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+000035b0: 2022 2222 5265 7475 726e 7320 706f 7274   """Returns port
+000035c0: 2062 7920 696e 6465 7869 6e67 2074 6865   by indexing the
+000035d0: 6d20 636c 6f63 6b77 6973 652e 2222 220a  m clockwise.""".
+000035e0: 2020 2020 2020 2020 6d20 3d20 6d61 705f          m = map_
+000035f0: 706f 7274 735f 746f 5f6f 7269 656e 7461  ports_to_orienta
+00003600: 7469 6f6e 5f63 6377 2873 656c 662e 706f  tion_ccw(self.po
+00003610: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
+00003620: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
+00003630: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
+00003640: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
+00003650: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
+00003660: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
+00003670: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
+00003680: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
+00003690: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
+000036a0: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
+000036b0: 6465 6620 6765 745f 706f 7274 735f 7873  def get_ports_xs
+000036c0: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
+000036d0: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
+000036e0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000036f0: 2078 6469 7374 616e 6365 2066 726f 6d20   xdistance from 
+00003700: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
+00003710: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
+00003720: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+00003730: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
+00003740: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
+00003750: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00003760: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
+00003770: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00003780: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
+00003790: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
+000037a0: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
+000037b0: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
+000037c0: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
+000037d0: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
+000037e0: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
+000037f0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+00003800: 745f 7479 7065 3a20 6f70 7469 6361 6c2c  t_type: optical,
+00003810: 2065 6c65 6374 7269 6361 6c2c 202e 2e2e   electrical, ...
+00003820: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00003830: 2020 2020 2070 6f72 7473 5f63 7720 3d20       ports_cw = 
+00003840: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
+00003850: 6973 7428 636c 6f63 6b77 6973 653d 5472  ist(clockwise=Tr
+00003860: 7565 2c20 2a2a 6b77 6172 6773 290a 2020  ue, **kwargs).  
+00003870: 2020 2020 2020 706f 7274 735f 6363 7720        ports_ccw 
+00003880: 3d20 7365 6c66 2e67 6574 5f70 6f72 7473  = self.get_ports
+00003890: 5f6c 6973 7428 636c 6f63 6b77 6973 653d  _list(clockwise=
+000038a0: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
+000038b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000038c0: 706f 7274 735f 6363 775b 305d 2e78 202d  ports_ccw[0].x -
+000038d0: 2070 6f72 7473 5f63 775b 305d 2e78 0a0a   ports_cw[0].x..
+000038e0: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
+000038f0: 735f 7973 697a 6528 7365 6c66 2c20 2a2a  s_ysize(self, **
+00003900: 6b77 6172 6773 2920 2d3e 2066 6c6f 6174  kwargs) -> float
+00003910: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00003920: 7572 6e73 2079 6469 7374 616e 6365 2066  urns ydistance f
+00003930: 726f 6d20 6561 7374 2074 6f20 7765 7374  rom east to west
+00003940: 2070 6f72 7473 2e0a 0a20 2020 2020 2020   ports...       
+00003950: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+00003960: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00003970: 3a20 706f 7274 2047 4453 206c 6179 6572  : port GDS layer
+00003980: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00003990: 6566 6978 3a20 7769 7468 2069 6e20 706f  efix: with in po
+000039a0: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
+000039b0: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
+000039c0: 3a20 696e 2064 6567 7265 6573 2e0a 2020  : in degrees..  
+000039d0: 2020 2020 2020 2020 2020 7769 6474 683a            width:
+000039e0: 2070 6f72 7420 7769 6474 6820 2875 6d29   port width (um)
+000039f0: 2e0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+00003a00: 7965 7273 5f65 7863 6c75 6465 643a 204c  yers_excluded: L
+00003a10: 6973 7420 6f66 206c 6179 6572 7320 746f  ist of layers to
+00003a20: 2065 7863 6c75 6465 2e0a 2020 2020 2020   exclude..      
+00003a30: 2020 2020 2020 706f 7274 5f74 7970 653a        port_type:
+00003a40: 206f 7074 6963 616c 2c20 656c 6563 7472   optical, electr
+00003a50: 6963 616c 2c20 2e2e 2e0a 2020 2020 2020  ical, ....      
+00003a60: 2020 2222 220a 2020 2020 2020 2020 706f    """.        po
+00003a70: 7274 735f 6377 203d 2073 656c 662e 6765  rts_cw = self.ge
+00003a80: 745f 706f 7274 735f 6c69 7374 2863 6c6f  t_ports_list(clo
+00003a90: 636b 7769 7365 3d54 7275 652c 202a 2a6b  ckwise=True, **k
+00003aa0: 7761 7267 7329 0a20 2020 2020 2020 2070  wargs).        p
+00003ab0: 6f72 7473 5f63 6377 203d 2073 656c 662e  orts_ccw = self.
+00003ac0: 6765 745f 706f 7274 735f 6c69 7374 2863  get_ports_list(c
+00003ad0: 6c6f 636b 7769 7365 3d46 616c 7365 2c20  lockwise=False, 
+00003ae0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00003af0: 2020 7265 7475 726e 2070 6f72 7473 5f63    return ports_c
+00003b00: 6377 5b30 5d2e 7920 2d20 706f 7274 735f  cw[0].y - ports_
+00003b10: 6377 5b30 5d2e 790a 0a20 2020 2064 6566  cw[0].y..    def
+00003b20: 2070 6c6f 745f 6e65 746c 6973 7428 0a20   plot_netlist(. 
+00003b30: 2020 2020 2020 2073 656c 662c 2077 6974         self, wit
+00003b40: 685f 6c61 6265 6c73 3a20 626f 6f6c 203d  h_labels: bool =
+00003b50: 2054 7275 652c 2066 6f6e 745f 7765 6967   True, font_weig
+00003b60: 6874 3a20 7374 7220 3d20 226e 6f72 6d61  ht: str = "norma
+00003b70: 6c22 2c20 2a2a 6b77 6172 6773 0a20 2020  l", **kwargs.   
+00003b80: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
+00003b90: 6c6f 7473 2061 206e 6574 6c69 7374 2067  lots a netlist g
+00003ba0: 7261 7068 2077 6974 6820 6e65 7477 6f72  raph with networ
+00003bb0: 6b78 2e0a 0a20 2020 2020 2020 2041 7267  kx...        Arg
+00003bc0: 733a 0a20 2020 2020 2020 2020 2020 2077  s:.            w
+00003bd0: 6974 685f 6c61 6265 6c73 3a20 6164 6420  ith_labels: add 
+00003be0: 6c61 6265 6c20 746f 2065 6163 6820 6e6f  label to each no
+00003bf0: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
+00003c00: 666f 6e74 5f77 6569 6768 743a 206e 6f72  font_weight: nor
+00003c10: 6d61 6c2c 2062 6f6c 642e 0a20 2020 2020  mal, bold..     
+00003c20: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
+00003c30: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00003c40: 7473 2066 6f72 2074 6865 2067 6574 5f6e  ts for the get_n
+00003c50: 6574 6c69 7374 2066 756e 6374 696f 6e0a  etlist function.
+00003c60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003c70: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
+00003c80: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
+00003c90: 706c 740a 2020 2020 2020 2020 696d 706f  plt.        impo
+00003ca0: 7274 206e 6574 776f 726b 7820 6173 206e  rt networkx as n
+00003cb0: 780a 0a20 2020 2020 2020 2070 6c74 2e66  x..        plt.f
+00003cc0: 6967 7572 6528 290a 2020 2020 2020 2020  igure().        
+00003cd0: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
+00003ce0: 6574 5f6e 6574 6c69 7374 282a 2a6b 7761  et_netlist(**kwa
+00003cf0: 7267 7329 0a20 2020 2020 2020 2063 6f6e  rgs).        con
+00003d00: 6e65 6374 696f 6e73 203d 206e 6574 6c69  nections = netli
+00003d10: 7374 5b22 636f 6e6e 6563 7469 6f6e 7322  st["connections"
+00003d20: 5d0a 2020 2020 2020 2020 706c 6163 656d  ].        placem
+00003d30: 656e 7473 203d 206e 6574 6c69 7374 5b22  ents = netlist["
+00003d40: 706c 6163 656d 656e 7473 225d 0a20 2020  placements"].   
+00003d50: 2020 2020 2047 203d 206e 782e 4772 6170       G = nx.Grap
+00003d60: 6828 290a 2020 2020 2020 2020 472e 6164  h().        G.ad
+00003d70: 645f 6564 6765 735f 6672 6f6d 280a 2020  d_edges_from(.  
+00003d80: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
+00003d90: 2020 2020 2020 2020 2020 2020 2822 2c22              (","
+00003da0: 2e6a 6f69 6e28 6b2e 7370 6c69 7428 222c  .join(k.split(",
+00003db0: 2229 5b3a 2d31 5d29 2c20 222c 222e 6a6f  ")[:-1]), ",".jo
+00003dc0: 696e 2876 2e73 706c 6974 2822 2c22 295b  in(v.split(",")[
+00003dd0: 3a2d 315d 2929 0a20 2020 2020 2020 2020  :-1])).         
+00003de0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+00003df0: 696e 2063 6f6e 6e65 6374 696f 6e73 2e69  in connections.i
+00003e00: 7465 6d73 2829 0a20 2020 2020 2020 2020  tems().         
+00003e10: 2020 205d 0a20 2020 2020 2020 2029 0a20     ].        ). 
+00003e20: 2020 2020 2020 2070 6f73 203d 207b 6b3a         pos = {k:
+00003e30: 2028 765b 2278 225d 2c20 765b 2279 225d   (v["x"], v["y"]
+00003e40: 2920 666f 7220 6b2c 2076 2069 6e20 706c  ) for k, v in pl
+00003e50: 6163 656d 656e 7473 2e69 7465 6d73 2829  acements.items()
+00003e60: 7d0a 2020 2020 2020 2020 6c61 6265 6c73  }.        labels
+00003e70: 203d 207b 6b3a 2022 2c22 2e6a 6f69 6e28   = {k: ",".join(
+00003e80: 6b2e 7370 6c69 7428 222c 2229 5b3a 315d  k.split(",")[:1]
+00003e90: 2920 666f 7220 6b20 696e 2070 6c61 6365  ) for k in place
+00003ea0: 6d65 6e74 732e 6b65 7973 2829 7d0a 2020  ments.keys()}.  
+00003eb0: 2020 2020 2020 6e78 2e64 7261 7728 0a20        nx.draw(. 
+00003ec0: 2020 2020 2020 2020 2020 2047 2c0a 2020             G,.  
+00003ed0: 2020 2020 2020 2020 2020 7769 7468 5f6c            with_l
+00003ee0: 6162 656c 733d 7769 7468 5f6c 6162 656c  abels=with_label
+00003ef0: 732c 0a20 2020 2020 2020 2020 2020 2066  s,.            f
+00003f00: 6f6e 745f 7765 6967 6874 3d66 6f6e 745f  ont_weight=font_
+00003f10: 7765 6967 6874 2c0a 2020 2020 2020 2020  weight,.        
+00003f20: 2020 2020 6c61 6265 6c73 3d6c 6162 656c      labels=label
+00003f30: 732c 0a20 2020 2020 2020 2020 2020 2070  s,.            p
+00003f40: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
+00003f50: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00003f60: 2047 0a0a 2020 2020 6465 6620 706c 6f74   G..    def plot
+00003f70: 5f6e 6574 6c69 7374 5f66 6c61 7428 0a20  _netlist_flat(. 
+00003f80: 2020 2020 2020 2073 656c 662c 2077 6974         self, wit
+00003f90: 685f 6c61 6265 6c73 3a20 626f 6f6c 203d  h_labels: bool =
+00003fa0: 2054 7275 652c 2066 6f6e 745f 7765 6967   True, font_weig
+00003fb0: 6874 3a20 7374 7220 3d20 226e 6f72 6d61  ht: str = "norma
+00003fc0: 6c22 2c20 2a2a 6b77 6172 6773 0a20 2020  l", **kwargs.   
+00003fd0: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
+00003fe0: 6c6f 7473 2061 206e 6574 6c69 7374 2067  lots a netlist g
+00003ff0: 7261 7068 2077 6974 6820 6e65 7477 6f72  raph with networ
+00004000: 6b78 2e0a 0a20 2020 2020 2020 2041 7267  kx...        Arg
+00004010: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+00004020: 6c61 743a 2069 6620 7472 7565 2c20 7769  lat: if true, wi
+00004030: 6c6c 2070 6c6f 7420 7468 6520 666c 6174  ll plot the flat
+00004040: 206e 6574 6c69 7374 0a20 2020 2020 2020   netlist.       
+00004050: 2020 2020 2077 6974 685f 6c61 6265 6c73       with_labels
+00004060: 3a20 6164 6420 6c61 6265 6c20 746f 2065  : add label to e
+00004070: 6163 6820 6e6f 6465 2e0a 2020 2020 2020  ach node..      
+00004080: 2020 2020 2020 666f 6e74 5f77 6569 6768        font_weigh
+00004090: 743a 206e 6f72 6d61 6c2c 2062 6f6c 642e  t: normal, bold.
+000040a0: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+000040b0: 7761 7267 733a 206b 6579 776f 7264 2061  wargs: keyword a
+000040c0: 7267 756d 656e 7473 2066 6f72 2074 6865  rguments for the
+000040d0: 2067 6574 5f6e 6574 6c69 7374 2066 756e   get_netlist fun
+000040e0: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
+000040f0: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
+00004100: 206d 6174 706c 6f74 6c69 622e 7079 706c   matplotlib.pypl
+00004110: 6f74 2061 7320 706c 740a 2020 2020 2020  ot as plt.      
+00004120: 2020 696d 706f 7274 206e 6574 776f 726b    import network
+00004130: 7820 6173 206e 780a 0a20 2020 2020 2020  x as nx..       
+00004140: 2070 6c74 2e66 6967 7572 6528 290a 2020   plt.figure().  
+00004150: 2020 2020 2020 6e65 746c 6973 7420 3d20        netlist = 
+00004160: 7365 6c66 2e67 6574 5f6e 6574 6c69 7374  self.get_netlist
+00004170: 5f66 6c61 7428 2a2a 6b77 6172 6773 290a  _flat(**kwargs).
+00004180: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00004190: 6f6e 7320 3d20 6e65 746c 6973 745b 2263  ons = netlist["c
+000041a0: 6f6e 6e65 6374 696f 6e73 225d 0a20 2020  onnections"].   
+000041b0: 2020 2020 2070 6c61 6365 6d65 6e74 7320       placements 
+000041c0: 3d20 6e65 746c 6973 745b 2270 6c61 6365  = netlist["place
+000041d0: 6d65 6e74 7322 5d0a 2020 2020 2020 2020  ments"].        
+000041e0: 636f 6e6e 6563 7469 6f6e 735f 6c69 7374  connections_list
+000041f0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00004200: 7220 6b2c 2076 5f6c 6973 7420 696e 2063  r k, v_list in c
+00004210: 6f6e 6e65 6374 696f 6e73 2e69 7465 6d73  onnections.items
+00004220: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00004230: 636f 6e6e 6563 7469 6f6e 735f 6c69 7374  connections_list
+00004240: 2e65 7874 656e 6428 0a20 2020 2020 2020  .extend(.       
+00004250: 2020 2020 2020 2020 2028 222c 222e 6a6f           (",".jo
+00004260: 696e 286b 2e73 706c 6974 2822 2c22 295b  in(k.split(",")[
+00004270: 3a2d 315d 292c 2022 2c22 2e6a 6f69 6e28  :-1]), ",".join(
+00004280: 762e 7370 6c69 7428 222c 2229 5b3a 2d31  v.split(",")[:-1
+00004290: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+000042a0: 2020 2020 666f 7220 7620 696e 2076 5f6c      for v in v_l
+000042b0: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+000042c0: 290a 2020 2020 2020 2020 4720 3d20 6e78  ).        G = nx
+000042d0: 2e47 7261 7068 2829 0a20 2020 2020 2020  .Graph().       
+000042e0: 2047 2e61 6464 5f65 6467 6573 5f66 726f   G.add_edges_fro
+000042f0: 6d28 636f 6e6e 6563 7469 6f6e 735f 6c69  m(connections_li
+00004300: 7374 290a 2020 2020 2020 2020 706f 7320  st).        pos 
+00004310: 3d20 7b6b 3a20 2876 5b22 7822 5d2c 2076  = {k: (v["x"], v
+00004320: 5b22 7922 5d29 2066 6f72 206b 2c20 7620  ["y"]) for k, v 
+00004330: 696e 2070 6c61 6365 6d65 6e74 732e 6974  in placements.it
+00004340: 656d 7328 297d 0a20 2020 2020 2020 206c  ems()}.        l
+00004350: 6162 656c 7320 3d20 7b6b 3a20 222c 222e  abels = {k: ",".
+00004360: 6a6f 696e 286b 2e73 706c 6974 2822 2c22  join(k.split(","
+00004370: 295b 3a31 5d29 2066 6f72 206b 2069 6e20  )[:1]) for k in 
+00004380: 706c 6163 656d 656e 7473 2e6b 6579 7328  placements.keys(
+00004390: 297d 0a20 2020 2020 2020 206e 782e 6472  )}.        nx.dr
+000043a0: 6177 280a 2020 2020 2020 2020 2020 2020  aw(.            
+000043b0: 472c 0a20 2020 2020 2020 2020 2020 2077  G,.            w
+000043c0: 6974 685f 6c61 6265 6c73 3d77 6974 685f  ith_labels=with_
+000043d0: 6c61 6265 6c73 2c0a 2020 2020 2020 2020  labels,.        
+000043e0: 2020 2020 666f 6e74 5f77 6569 6768 743d      font_weight=
+000043f0: 666f 6e74 5f77 6569 6768 742c 0a20 2020  font_weight,.   
+00004400: 2020 2020 2020 2020 206c 6162 656c 733d           labels=
+00004410: 6c61 6265 6c73 2c0a 2020 2020 2020 2020  labels,.        
+00004420: 2020 2020 706f 733d 706f 732c 0a20 2020      pos=pos,.   
+00004430: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00004440: 6574 7572 6e20 470a 0a20 2020 2064 6566  eturn G..    def
+00004450: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
+00004460: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
+00004470: 2920 2d3e 2064 6963 745b 7374 722c 2041  ) -> dict[str, A
+00004480: 6e79 5d3a 0a20 2020 2020 2020 2066 726f  ny]:.        fro
+00004490: 6d20 6764 7366 6163 746f 7279 2e67 6574  m gdsfactory.get
+000044a0: 5f6e 6574 6c69 7374 2069 6d70 6f72 7420  _netlist import 
+000044b0: 6765 745f 6e65 746c 6973 745f 7961 6d6c  get_netlist_yaml
+000044c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000044d0: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
+000044e0: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
+000044f0: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
+00004500: 5f6e 6574 6c69 7374 2873 656c 662c 2066  _netlist(self, f
+00004510: 696c 6570 6174 683a 2073 7472 2920 2d3e  ilepath: str) ->
+00004520: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00004530: 2222 5772 6974 6520 6e65 746c 6973 7420  ""Write netlist 
+00004540: 696e 2059 414d 4c2e 2222 220a 2020 2020  in YAML.""".    
+00004550: 2020 2020 6e65 746c 6973 7420 3d20 7365      netlist = se
+00004560: 6c66 2e67 6574 5f6e 6574 6c69 7374 2829  lf.get_netlist()
+00004570: 0a20 2020 2020 2020 206e 6574 6c69 7374  .        netlist
+00004580: 203d 2063 6c65 616e 5f64 6963 7428 6e65   = clean_dict(ne
+00004590: 746c 6973 7429 0a20 2020 2020 2020 2066  tlist).        f
+000045a0: 696c 6570 6174 6820 3d20 7061 7468 6c69  ilepath = pathli
+000045b0: 622e 5061 7468 2866 696c 6570 6174 6829  b.Path(filepath)
+000045c0: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
+000045d0: 682e 7772 6974 655f 7465 7874 2879 616d  h.write_text(yam
+000045e0: 6c2e 6475 6d70 286e 6574 6c69 7374 2929  l.dump(netlist))
+000045f0: 0a0a 2020 2020 6465 6620 7772 6974 655f  ..    def write_
+00004600: 6e65 746c 6973 745f 646f 7428 7365 6c66  netlist_dot(self
+00004610: 2c20 6669 6c65 7061 7468 3a20 7374 7220  , filepath: str 
+00004620: 7c20 4e6f 6e65 203d 204e 6f6e 6529 202d  | None = None) -
+00004630: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00004640: 2222 2257 7269 7465 206e 6574 6c69 7374  """Write netlist
+00004650: 2067 7261 7068 2069 6e20 444f 5420 666f   graph in DOT fo
+00004660: 726d 6174 2e22 2222 0a20 2020 2020 2020  rmat.""".       
+00004670: 2066 726f 6d20 6e65 7477 6f72 6b78 2e64   from networkx.d
+00004680: 7261 7769 6e67 2e6e 785f 6167 7261 7068  rawing.nx_agraph
+00004690: 2069 6d70 6f72 7420 7772 6974 655f 646f   import write_do
+000046a0: 740a 0a20 2020 2020 2020 2066 696c 6570  t..        filep
+000046b0: 6174 6820 3d20 6669 6c65 7061 7468 206f  ath = filepath o
+000046c0: 7220 6622 7b73 656c 662e 6e61 6d65 7d2e  r f"{self.name}.
+000046d0: 646f 7422 0a0a 2020 2020 2020 2020 4720  dot"..        G 
+000046e0: 3d20 7365 6c66 2e70 6c6f 745f 6e65 746c  = self.plot_netl
+000046f0: 6973 7428 290a 2020 2020 2020 2020 7772  ist().        wr
+00004700: 6974 655f 646f 7428 472c 2066 696c 6570  ite_dot(G, filep
+00004710: 6174 6829 0a0a 2020 2020 6465 6620 6765  ath)..    def ge
+00004720: 745f 6e65 746c 6973 7428 7365 6c66 2c20  t_netlist(self, 
+00004730: 2a2a 6b77 6172 6773 2920 2d3e 2064 6963  **kwargs) -> dic
+00004740: 745b 7374 722c 2041 6e79 5d3a 0a20 2020  t[str, Any]:.   
+00004750: 2020 2020 2022 2222 4672 6f6d 2043 6f6d       """From Com
+00004760: 706f 6e65 6e74 2072 6574 7572 6e73 2069  ponent returns i
+00004770: 6e73 7461 6e63 6573 2c20 636f 6e6e 6563  nstances, connec
+00004780: 7469 6f6e 7320 616e 6420 706c 6163 656d  tions and placem
+00004790: 656e 7473 2064 6963 742e 0a0a 2020 2020  ents dict...    
+000047a0: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
+000047b0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+000047c0: 6d70 6f6e 656e 743a 2074 6f20 6578 7472  mponent: to extr
+000047d0: 6163 7420 6e65 746c 6973 742e 0a20 2020  act netlist..   
+000047e0: 2020 2020 2020 2020 2066 756c 6c5f 7365           full_se
+000047f0: 7474 696e 6773 3a20 5472 7565 2072 6574  ttings: True ret
+00004800: 7572 6e73 2061 6c6c 2c20 6661 6c73 6520  urns all, false 
+00004810: 6368 616e 6765 6420 7365 7474 696e 6773  changed settings
+00004820: 2e0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+00004830: 6c65 7261 6e63 653a 2074 6f6c 6572 616e  lerance: toleran
+00004840: 6365 2069 6e20 6e6d 2074 6f20 636f 6e73  ce in nm to cons
+00004850: 6964 6572 2074 776f 2070 6f72 7473 2063  ider two ports c
+00004860: 6f6e 6e65 6374 6564 2e0a 2020 2020 2020  onnected..      
+00004870: 2020 2020 2020 6578 636c 7564 655f 706f        exclude_po
+00004880: 7274 5f74 7970 6573 3a20 6f70 7469 6f6e  rt_types: option
+00004890: 616c 206c 6973 7420 6f66 2070 6f72 7420  al list of port 
+000048a0: 7479 7065 7320 746f 2065 7863 6c75 6465  types to exclude
+000048b0: 2066 726f 6d20 6e65 746c 6973 7469 6e67   from netlisting
+000048c0: 2e0a 2020 2020 2020 2020 2020 2020 6765  ..            ge
+000048d0: 745f 696e 7374 616e 6365 5f6e 616d 653a  t_instance_name:
+000048e0: 2066 756e 6374 696f 6e20 746f 2067 6574   function to get
+000048f0: 2069 6e73 7461 6e63 6520 6e61 6d65 2e0a   instance name..
+00004900: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
+00004910: 775f 6d75 6c74 6970 6c65 3a20 4661 6c73  w_multiple: Fals
+00004920: 6520 746f 2072 6169 7365 2061 6e20 6572  e to raise an er
+00004930: 726f 7220 6966 206d 6f72 6520 7468 616e  ror if more than
+00004940: 2074 776f 2070 6f72 7473 2073 6861 7265   two ports share
+00004950: 2074 6865 2073 616d 6520 636f 6e6e 6563   the same connec
+00004960: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
+00004970: 2020 2020 2020 6966 2054 7275 652c 2077        if True, w
+00004980: 696c 6c20 7265 7475 726e 206b 6579 3a20  ill return key: 
+00004990: 5b76 616c 7565 5d20 7061 6972 7320 7769  [value] pairs wi
+000049a0: 7468 205b 7661 6c75 655d 2061 206c 6973  th [value] a lis
+000049b0: 7420 6f66 2061 6c6c 2063 6f6e 6e65 6374  t of all connect
+000049c0: 6564 2069 6e73 7461 6e63 6573 2e0a 0a20  ed instances... 
+000049d0: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
+000049e0: 2020 2020 2020 2020 2020 2020 4e65 746c              Netl
+000049f0: 6973 7420 6469 6374 2028 696e 7374 616e  ist dict (instan
+00004a00: 6365 732c 2063 6f6e 6e65 6374 696f 6e73  ces, connections
+00004a10: 2c20 706c 6163 656d 656e 7473 2c20 706f  , placements, po
+00004a20: 7274 7329 0a20 2020 2020 2020 2020 2020  rts).           
+00004a30: 2020 2020 2069 6e73 7461 6e63 6573 3a20       instances: 
+00004a40: 4469 6374 206f 6620 696e 7374 616e 6365  Dict of instance
+00004a50: 206e 616d 6520 616e 6420 7365 7474 696e   name and settin
+00004a60: 6773 2e0a 2020 2020 2020 2020 2020 2020  gs..            
+00004a70: 2020 2020 636f 6e6e 6563 7469 6f6e 733a      connections:
+00004a80: 2044 6963 7420 6f66 2049 6e73 7461 6e63   Dict of Instanc
+00004a90: 6531 4e61 6d65 2c70 6f72 744e 616d 653a  e1Name,portName:
+00004aa0: 2049 6e73 7461 6e63 6532 4e61 6d65 2c70   Instance2Name,p
+00004ab0: 6f72 744e 616d 652e 0a20 2020 2020 2020  ortName..       
+00004ac0: 2020 2020 2020 2020 2070 6c61 6365 6d65           placeme
+00004ad0: 6e74 733a 2044 6963 7420 6f66 2069 6e73  nts: Dict of ins
+00004ae0: 7461 6e63 6520 6e61 6d65 7320 616e 6420  tance names and 
+00004af0: 706c 6163 656d 656e 7473 2028 782c 2079  placements (x, y
+00004b00: 2c20 726f 7461 7469 6f6e 292e 0a20 2020  , rotation)..   
+00004b10: 2020 2020 2020 2020 2020 2020 2070 6f72               por
+00004b20: 7473 3a20 4469 6374 2070 6f72 744e 616d  ts: Dict portNam
+00004b30: 653a 2043 6f6d 706f 6e65 6e74 4e61 6d65  e: ComponentName
+00004b40: 2c70 6f72 742e 0a20 2020 2020 2020 2020  ,port..         
+00004b50: 2020 2020 2020 206e 616d 653a 206e 616d         name: nam
+00004b60: 6520 6f66 2063 6f6d 706f 6e65 6e74 2e0a  e of component..
+00004b70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00004b80: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+00004b90: 6f72 792e 6765 745f 6e65 746c 6973 7420  ory.get_netlist 
+00004ba0: 696d 706f 7274 2067 6574 5f6e 6574 6c69  import get_netli
+00004bb0: 7374 0a0a 2020 2020 2020 2020 7265 7475  st..        retu
+00004bc0: 726e 2067 6574 5f6e 6574 6c69 7374 2863  rn get_netlist(c
+00004bd0: 6f6d 706f 6e65 6e74 3d73 656c 662c 202a  omponent=self, *
+00004be0: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
+00004bf0: 6620 6765 745f 6e65 746c 6973 745f 7265  f get_netlist_re
+00004c00: 6375 7273 6976 6528 7365 6c66 2c20 2a2a  cursive(self, **
+00004c10: 6b77 6172 6773 2920 2d3e 2064 6963 745b  kwargs) -> dict[
+00004c20: 7374 722c 2044 6963 7443 6f6e 6669 675d  str, DictConfig]
+00004c30: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00004c40: 7572 6e73 2072 6563 7572 7369 7665 206e  urns recursive n
+00004c50: 6574 6c69 7374 2066 6f72 2061 2063 6f6d  etlist for a com
+00004c60: 706f 6e65 6e74 2061 6e64 2073 7562 636f  ponent and subco
+00004c70: 6d70 6f6e 656e 7473 2e0a 0a20 2020 2020  mponents...     
+00004c80: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
+00004c90: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+00004ca0: 706f 6e65 6e74 3a20 746f 2065 7874 7261  ponent: to extra
+00004cb0: 6374 206e 6574 6c69 7374 2e0a 2020 2020  ct netlist..    
+00004cc0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00004cd0: 745f 7375 6666 6978 3a20 7375 6666 6978  t_suffix: suffix
+00004ce0: 2074 6f20 6170 7065 6e64 2074 6f20 6561   to append to ea
+00004cf0: 6368 2063 6f6d 706f 6e65 6e74 206e 616d  ch component nam
+00004d00: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
+00004d10: 2020 2075 7365 6675 6c20 6966 2074 6f20     useful if to 
+00004d20: 7361 7665 2061 6e64 2072 656c 6f61 6420  save and reload 
+00004d30: 6120 6261 636b 2d61 6e6e 6f74 6174 6564  a back-annotated
+00004d40: 206e 6574 6c69 7374 2e0a 2020 2020 2020   netlist..      
+00004d50: 2020 2020 2020 6765 745f 6e65 746c 6973        get_netlis
+00004d60: 745f 6675 6e63 3a20 6675 6e63 7469 6f6e  t_func: function
+00004d70: 2074 6f20 6578 7472 6163 7420 696e 6469   to extract indi
+00004d80: 7669 6475 616c 206e 6574 6c69 7374 732e  vidual netlists.
+00004d90: 0a20 2020 2020 2020 2020 2020 2066 756c  .            ful
+00004da0: 6c5f 7365 7474 696e 6773 3a20 5472 7565  l_settings: True
+00004db0: 2072 6574 7572 6e73 2061 6c6c 2c20 6661   returns all, fa
+00004dc0: 6c73 6520 6368 616e 6765 6420 7365 7474  lse changed sett
+00004dd0: 696e 6773 2e0a 2020 2020 2020 2020 2020  ings..          
+00004de0: 2020 746f 6c65 7261 6e63 653a 2074 6f6c    tolerance: tol
+00004df0: 6572 616e 6365 2069 6e20 6e6d 2074 6f20  erance in nm to 
+00004e00: 636f 6e73 6964 6572 2074 776f 2070 6f72  consider two por
+00004e10: 7473 2063 6f6e 6e65 6374 6564 2e0a 2020  ts connected..  
+00004e20: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00004e30: 655f 706f 7274 5f74 7970 6573 3a20 6f70  e_port_types: op
+00004e40: 7469 6f6e 616c 206c 6973 7420 6f66 2070  tional list of p
+00004e50: 6f72 7420 7479 7065 7320 746f 2065 7863  ort types to exc
+00004e60: 6c75 6465 2066 726f 6d20 6e65 746c 6973  lude from netlis
+00004e70: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
+00004e80: 2020 6765 745f 696e 7374 616e 6365 5f6e    get_instance_n
+00004e90: 616d 653a 2066 756e 6374 696f 6e20 746f  ame: function to
+00004ea0: 2067 6574 2069 6e73 7461 6e63 6520 6e61   get instance na
+00004eb0: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+00004ec0: 616c 6c6f 775f 6d75 6c74 6970 6c65 3a20  allow_multiple: 
+00004ed0: 4661 6c73 6520 746f 2072 6169 7365 2061  False to raise a
+00004ee0: 6e20 6572 726f 7220 6966 206d 6f72 6520  n error if more 
+00004ef0: 7468 616e 2074 776f 2070 6f72 7473 2073  than two ports s
+00004f00: 6861 7265 2074 6865 2073 616d 6520 636f  hare the same co
+00004f10: 6e6e 6563 7469 6f6e 2e0a 2020 2020 2020  nnection..      
+00004f20: 2020 2020 2020 2020 2020 6966 2054 7275            if Tru
+00004f30: 652c 2077 696c 6c20 7265 7475 726e 206b  e, will return k
+00004f40: 6579 3a20 5b76 616c 7565 5d20 7061 6972  ey: [value] pair
+00004f50: 7320 7769 7468 205b 7661 6c75 655d 2061  s with [value] a
+00004f60: 206c 6973 7420 6f66 2061 6c6c 2063 6f6e   list of all con
+00004f70: 6e65 6374 6564 2069 6e73 7461 6e63 6573  nected instances
+00004f80: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00004f90: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00004fa0: 4469 6374 696f 6e61 7279 206f 6620 6e65  Dictionary of ne
+00004fb0: 746c 6973 7473 2c20 6b65 7965 6420 6279  tlists, keyed by
+00004fc0: 2074 6865 206e 616d 6520 6f66 2065 6163   the name of eac
+00004fd0: 6820 636f 6d70 6f6e 656e 742e 0a20 2020  h component..   
+00004fe0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00004ff0: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
+00005000: 2e67 6574 5f6e 6574 6c69 7374 2069 6d70  .get_netlist imp
+00005010: 6f72 7420 6765 745f 6e65 746c 6973 745f  ort get_netlist_
+00005020: 7265 6375 7273 6976 650a 0a20 2020 2020  recursive..     
+00005030: 2020 2072 6574 7572 6e20 6765 745f 6e65     return get_ne
+00005040: 746c 6973 745f 7265 6375 7273 6976 6528  tlist_recursive(
+00005050: 636f 6d70 6f6e 656e 743d 7365 6c66 2c20  component=self, 
+00005060: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
+00005070: 6566 2067 6574 5f6e 6574 6c69 7374 5f66  ef get_netlist_f
+00005080: 6c61 7428 7365 6c66 2c20 2a2a 6b77 6172  lat(self, **kwar
+00005090: 6773 2920 2d3e 2064 6963 745b 7374 722c  gs) -> dict[str,
+000050a0: 2044 6963 7443 6f6e 6669 675d 3a0a 2020   DictConfig]:.  
+000050b0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+000050c0: 2061 206e 6574 6c69 7374 2077 6865 7265   a netlist where
+000050d0: 2061 6c6c 2073 7562 696e 7374 616e 6365   all subinstance
+000050e0: 7320 6172 6520 6578 706f 7365 6420 616e  s are exposed an
+000050f0: 6420 696e 6465 7065 6e64 656e 746c 7920  d independently 
+00005100: 6e61 6d65 642e 0a0a 2020 2020 2020 2020  named...        
+00005110: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
+00005120: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+00005130: 656e 743a 2074 6f20 6578 7472 6163 7420  ent: to extract 
+00005140: 6e65 746c 6973 742e 0a20 2020 2020 2020  netlist..       
+00005150: 2020 2020 2063 6f6d 706f 6e65 6e74 5f73       component_s
+00005160: 7566 6669 783a 2073 7566 6669 7820 746f  uffix: suffix to
+00005170: 2061 7070 656e 6420 746f 2065 6163 6820   append to each 
+00005180: 636f 6d70 6f6e 656e 7420 6e61 6d65 2e0a  component name..
+00005190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000051a0: 7573 6566 756c 2069 6620 746f 2073 6176  useful if to sav
+000051b0: 6520 616e 6420 7265 6c6f 6164 2061 2062  e and reload a b
+000051c0: 6163 6b2d 616e 6e6f 7461 7465 6420 6e65  ack-annotated ne
+000051d0: 746c 6973 742e 0a20 2020 2020 2020 2020  tlist..         
+000051e0: 2020 2067 6574 5f6e 6574 6c69 7374 5f66     get_netlist_f
+000051f0: 756e 633a 2066 756e 6374 696f 6e20 746f  unc: function to
+00005200: 2065 7874 7261 6374 2069 6e64 6976 6964   extract individ
+00005210: 7561 6c20 6e65 746c 6973 7473 2e0a 2020  ual netlists..  
+00005220: 2020 2020 2020 2020 2020 6675 6c6c 5f73            full_s
+00005230: 6574 7469 6e67 733a 2054 7275 6520 7265  ettings: True re
+00005240: 7475 726e 7320 616c 6c2c 2066 616c 7365  turns all, false
+00005250: 2063 6861 6e67 6564 2073 6574 7469 6e67   changed setting
+00005260: 732e 0a20 2020 2020 2020 2020 2020 2074  s..            t
+00005270: 6f6c 6572 616e 6365 3a20 746f 6c65 7261  olerance: tolera
+00005280: 6e63 6520 696e 206e 6d20 746f 2063 6f6e  nce in nm to con
+00005290: 7369 6465 7220 7477 6f20 706f 7274 7320  sider two ports 
+000052a0: 636f 6e6e 6563 7465 642e 0a20 2020 2020  connected..     
+000052b0: 2020 2020 2020 2065 7863 6c75 6465 5f70         exclude_p
+000052c0: 6f72 745f 7479 7065 733a 206f 7074 696f  ort_types: optio
+000052d0: 6e61 6c20 6c69 7374 206f 6620 706f 7274  nal list of port
+000052e0: 2074 7970 6573 2074 6f20 6578 636c 7564   types to exclud
+000052f0: 6520 6672 6f6d 206e 6574 6c69 7374 696e  e from netlistin
+00005300: 672e 0a20 2020 2020 2020 2020 2020 2067  g..            g
+00005310: 6574 5f69 6e73 7461 6e63 655f 6e61 6d65  et_instance_name
+00005320: 3a20 6675 6e63 7469 6f6e 2074 6f20 6765  : function to ge
+00005330: 7420 696e 7374 616e 6365 206e 616d 652e  t instance name.
+00005340: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
+00005350: 6f77 5f6d 756c 7469 706c 653a 2046 616c  ow_multiple: Fal
+00005360: 7365 2074 6f20 7261 6973 6520 616e 2065  se to raise an e
+00005370: 7272 6f72 2069 6620 6d6f 7265 2074 6861  rror if more tha
+00005380: 6e20 7477 6f20 706f 7274 7320 7368 6172  n two ports shar
+00005390: 6520 7468 6520 7361 6d65 2063 6f6e 6e65  e the same conne
+000053a0: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
+000053b0: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
+000053c0: 7769 6c6c 2072 6574 7572 6e20 6b65 793a  will return key:
+000053d0: 205b 7661 6c75 655d 2070 6169 7273 2077   [value] pairs w
+000053e0: 6974 6820 5b76 616c 7565 5d20 6120 6c69  ith [value] a li
+000053f0: 7374 206f 6620 616c 6c20 636f 6e6e 6563  st of all connec
+00005400: 7465 6420 696e 7374 616e 6365 732e 0a0a  ted instances...
+00005410: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
+00005420: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
+00005430: 7469 6f6e 6172 7920 6f66 206e 6574 6c69  tionary of netli
+00005440: 7374 732c 206b 6579 6564 2062 7920 7468  sts, keyed by th
+00005450: 6520 6e61 6d65 206f 6620 6561 6368 2063  e name of each c
+00005460: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
+00005470: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00005480: 6f6d 2067 6473 6661 6374 6f72 792e 6765  om gdsfactory.ge
+00005490: 745f 6e65 746c 6973 745f 666c 6174 2069  t_netlist_flat i
+000054a0: 6d70 6f72 7420 6765 745f 6e65 746c 6973  mport get_netlis
+000054b0: 745f 666c 6174 0a0a 2020 2020 2020 2020  t_flat..        
+000054c0: 7265 7475 726e 2067 6574 5f6e 6574 6c69  return get_netli
+000054d0: 7374 5f66 6c61 7428 636f 6d70 6f6e 656e  st_flat(componen
+000054e0: 743d 7365 6c66 2c20 2a2a 6b77 6172 6773  t=self, **kwargs
+000054f0: 290a 0a20 2020 2064 6566 2061 7373 6572  )..    def asser
+00005500: 745f 706f 7274 735f 6f6e 5f67 7269 6428  t_ports_on_grid(
+00005510: 7365 6c66 2c20 6e6d 3a20 696e 7420 3d20  self, nm: int = 
+00005520: 3129 202d 3e20 4e6f 6e65 3a0a 2020 2020  1) -> None:.    
+00005530: 2020 2020 2222 2241 7373 6572 7473 2074      """Asserts t
+00005540: 6861 7420 616c 6c20 706f 7274 7320 6172  hat all ports ar
+00005550: 6520 6f6e 2067 7269 642e 2222 220a 2020  e on grid.""".  
+00005560: 2020 2020 2020 666f 7220 706f 7274 2069        for port i
+00005570: 6e20 7365 6c66 2e70 6f72 7473 2e76 616c  n self.ports.val
+00005580: 7565 7328 293a 0a20 2020 2020 2020 2020  ues():.         
+00005590: 2020 2070 6f72 742e 6173 7365 7274 5f6f     port.assert_o
+000055a0: 6e5f 6772 6964 286e 6d3d 6e6d 290a 0a20  n_grid(nm=nm).. 
+000055b0: 2020 2064 6566 2067 6574 5f70 6f72 7473     def get_ports
+000055c0: 2873 656c 662c 2064 6570 7468 3d4e 6f6e  (self, depth=Non
+000055d0: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
+000055e0: 6574 7572 6e73 2063 6f70 6965 7320 6f66  eturns copies of
+000055f0: 2061 6c6c 2074 6865 2070 6f72 7473 206f   all the ports o
+00005600: 6620 7468 6520 436f 6d70 6f6e 656e 742c  f the Component,
+00005610: 2072 6f74 6174 6564 2061 6e64 205c 0a20   rotated and \. 
+00005620: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00005630: 7261 6e73 6c61 7465 6420 736f 2074 6861  ranslated so tha
+00005640: 7420 7468 6579 2772 6520 696e 2074 6865  t they're in the
+00005650: 6972 2074 6f70 2d6c 6576 656c 2070 6f73  ir top-level pos
+00005660: 6974 696f 6e2e 0a0a 2020 2020 2020 2020  ition...        
+00005670: 5468 6520 506f 7274 7320 7265 7475 726e  The Ports return
+00005680: 6564 2061 7265 2063 6f70 6965 7320 6f66  ed are copies of
+00005690: 2074 6865 206f 7269 6769 6e61 6c73 2c20   the originals, 
+000056a0: 6275 7420 6561 6368 2063 6f70 7920 6861  but each copy ha
+000056b0: 7320 7468 6520 7361 6d65 0a20 2020 2020  s the same.     
+000056c0: 2020 2060 6075 6964 6060 2061 7320 7468     ``uid`` as th
+000056d0: 6520 6f72 6967 696e 616c 2073 6f20 7468  e original so th
+000056e0: 6174 2074 6865 7920 6361 6e20 6265 2074  at they can be t
+000056f0: 7261 6365 6420 6261 636b 2074 6f20 7468  raced back to th
+00005700: 6520 6f72 6967 696e 616c 2069 6620 6e65  e original if ne
+00005710: 6564 6564 2e0a 0a20 2020 2020 2020 2041  eded...        A
+00005720: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00005730: 2064 6570 7468 203a 2069 6e74 206f 7220   depth : int or 
+00005740: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00005750: 2020 2020 2049 6620 6e6f 7420 4e6f 6e65       If not None
+00005760: 2c20 6465 6669 6e65 7320 6672 6f6d 2068  , defines from h
+00005770: 6f77 206d 616e 7920 7265 6665 7265 6e63  ow many referenc
+00005780: 6520 6c65 7665 6c73 2074 6f0a 2020 2020  e levels to.    
+00005790: 2020 2020 2020 2020 2020 2020 7265 7472              retr
+000057a0: 6965 7665 2050 6f72 7473 2066 726f 6d2e  ieve Ports from.
+000057b0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000057c0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+000057d0: 6f72 745f 6c69 7374 203a 206c 6973 7420  ort_list : list 
+000057e0: 6f66 2050 6f72 7420 4c69 7374 206f 6620  of Port List of 
+000057f0: 616c 6c20 506f 7274 7320 696e 2074 6865  all Ports in the
+00005800: 2043 6f6d 706f 6e65 6e74 2e0a 2020 2020   Component..    
+00005810: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00005820: 706f 7274 5f6c 6973 7420 3d20 5b70 2e5f  port_list = [p._
+00005830: 636f 7079 2829 2066 6f72 2070 2069 6e20  copy() for p in 
+00005840: 7365 6c66 2e70 6f72 7473 2e76 616c 7565  self.ports.value
+00005850: 7328 295d 0a0a 2020 2020 2020 2020 6966  s()]..        if
+00005860: 2064 6570 7468 2069 7320 4e6f 6e65 206f   depth is None o
+00005870: 7220 6465 7074 6820 3e20 303a 0a20 2020  r depth > 0:.   
+00005880: 2020 2020 2020 2020 2066 6f72 2072 2069           for r i
+00005890: 6e20 7365 6c66 2e72 6566 6572 656e 6365  n self.reference
+000058a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000058b0: 2020 206e 6577 5f64 6570 7468 203d 204e     new_depth = N
+000058c0: 6f6e 6520 6966 2064 6570 7468 2069 7320  one if depth is 
+000058d0: 4e6f 6e65 2065 6c73 6520 6465 7074 6820  None else depth 
+000058e0: 2d20 310a 2020 2020 2020 2020 2020 2020  - 1.            
+000058f0: 2020 2020 7265 665f 706f 7274 7320 3d20      ref_ports = 
+00005900: 722e 7061 7265 6e74 2e67 6574 5f70 6f72  r.parent.get_por
+00005910: 7473 2864 6570 7468 3d6e 6577 5f64 6570  ts(depth=new_dep
+00005920: 7468 290a 0a20 2020 2020 2020 2020 2020  th)..           
+00005930: 2020 2020 2023 2054 7261 6e73 666f 726d       # Transform
+00005940: 2070 6f72 7473 2074 6861 7420 6361 6d65   ports that came
+00005950: 2066 726f 6d20 6120 7265 6665 7265 6e63   from a referenc
+00005960: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00005970: 2020 7265 665f 706f 7274 735f 7472 616e    ref_ports_tran
+00005980: 7366 6f72 6d65 6420 3d20 5b5d 0a20 2020  sformed = [].   
+00005990: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000059a0: 2072 7020 696e 2072 6566 5f70 6f72 7473   rp in ref_ports
+000059b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000059c0: 2020 2020 2020 6e65 775f 706f 7274 203d        new_port =
+000059d0: 2072 702e 5f63 6f70 7928 290a 2020 2020   rp._copy().    
+000059e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059f0: 6e65 775f 6365 6e74 6572 2c20 6e65 775f  new_center, new_
+00005a00: 6f72 6965 6e74 6174 696f 6e20 3d20 722e  orientation = r.
+00005a10: 5f74 7261 6e73 666f 726d 5f70 6f72 7428  _transform_port(
+00005a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a30: 2020 2020 2020 2020 2072 702e 6365 6e74           rp.cent
+00005a40: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00005a50: 2020 2020 2020 2020 2020 2020 7270 2e6f              rp.o
+00005a60: 7269 656e 7461 7469 6f6e 2c0a 2020 2020  rientation,.    
+00005a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a80: 2020 2020 722e 6f72 6967 696e 2c0a 2020      r.origin,.  
+00005a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005aa0: 2020 2020 2020 722e 726f 7461 7469 6f6e        r.rotation
+00005ab0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00005ac0: 2020 2020 2020 2020 2020 722e 785f 7265            r.x_re
+00005ad0: 666c 6563 7469 6f6e 2c0a 2020 2020 2020  flection,.      
+00005ae0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00005af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b00: 2020 2020 6e65 775f 706f 7274 2e63 656e      new_port.cen
+00005b10: 7465 7220 3d20 6e65 775f 6365 6e74 6572  ter = new_center
+00005b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005b30: 2020 2020 206e 6577 5f70 6f72 742e 6e65       new_port.ne
+00005b40: 775f 6f72 6965 6e74 6174 696f 6e20 3d20  w_orientation = 
+00005b50: 6e65 775f 6f72 6965 6e74 6174 696f 6e0a  new_orientation.
+00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b70: 2020 2020 7265 665f 706f 7274 735f 7472      ref_ports_tr
+00005b80: 616e 7366 6f72 6d65 642e 6170 7065 6e64  ansformed.append
+00005b90: 286e 6577 5f70 6f72 7429 0a20 2020 2020  (new_port).     
+00005ba0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+00005bb0: 6c69 7374 202b 3d20 7265 665f 706f 7274  list += ref_port
+00005bc0: 735f 7472 616e 7366 6f72 6d65 640a 0a20  s_transformed.. 
+00005bd0: 2020 2020 2020 2072 6574 7572 6e20 706f         return po
+00005be0: 7274 5f6c 6973 740a 0a20 2020 2064 6566  rt_list..    def
+00005bf0: 2067 6574 5f70 6f72 7473 5f64 6963 7428   get_ports_dict(
+00005c00: 7365 6c66 2c20 2a2a 6b77 6172 6773 2920  self, **kwargs) 
+00005c10: 2d3e 2064 6963 745b 7374 722c 2050 6f72  -> dict[str, Por
+00005c20: 745d 3a0a 2020 2020 2020 2020 2222 2252  t]:.        """R
+00005c30: 6574 7572 6e73 2061 2064 6963 7420 6f66  eturns a dict of
+00005c40: 2070 6f72 7473 2e0a 0a20 2020 2020 2020   ports...       
+00005c50: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+00005c60: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00005c70: 3a20 706f 7274 2047 4453 206c 6179 6572  : port GDS layer
+00005c80: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00005c90: 6566 6978 3a20 7365 6c65 6374 2070 6f72  efix: select por
+00005ca0: 7473 2077 6974 6820 7072 6566 6978 2069  ts with prefix i
+00005cb0: 6e20 706f 7274 206e 616d 652e 0a20 2020  n port name..   
+00005cc0: 2020 2020 2020 2020 2073 7566 6669 783a           suffix:
+00005cd0: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
+00005ce0: 7468 2070 6f72 7420 6e61 6d65 2073 7566  th port name suf
+00005cf0: 6669 782e 0a20 2020 2020 2020 2020 2020  fix..           
+00005d00: 206f 7269 656e 7461 7469 6f6e 3a20 7365   orientation: se
+00005d10: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
+00005d20: 6f72 6965 6e74 6174 696f 6e20 696e 2064  orientation in d
+00005d30: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
+00005d40: 2020 2020 7769 6474 683a 2073 656c 6563      width: selec
+00005d50: 7420 706f 7274 7320 7769 7468 2070 6f72  t ports with por
+00005d60: 7420 7769 6474 682e 0a20 2020 2020 2020  t width..       
+00005d70: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
+00005d80: 7564 6564 3a20 4c69 7374 206f 6620 6c61  uded: List of la
+00005d90: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
+00005da0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
+00005db0: 745f 7479 7065 3a20 7365 6c65 6374 2070  t_type: select p
+00005dc0: 6f72 7473 2077 6974 6820 706f 7274 5f74  orts with port_t
+00005dd0: 7970 6520 286f 7074 6963 616c 2c20 656c  ype (optical, el
+00005de0: 6563 7472 6963 616c 2c20 7665 7274 6963  ectrical, vertic
+00005df0: 616c 5f74 6529 2e0a 2020 2020 2020 2020  al_te)..        
+00005e00: 2020 2020 636c 6f63 6b77 6973 653a 2069      clockwise: i
+00005e10: 6620 5472 7565 2c20 736f 7274 2070 6f72  f True, sort por
+00005e20: 7473 2063 6c6f 636b 7769 7365 2c20 4661  ts clockwise, Fa
+00005e30: 6c73 653a 2063 6f75 6e74 6572 2d63 6c6f  lse: counter-clo
+00005e40: 636b 7769 7365 2e0a 2020 2020 2020 2020  ckwise..        
+00005e50: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00005e60: 726e 2073 656c 6563 745f 706f 7274 7328  rn select_ports(
+00005e70: 7365 6c66 2e70 6f72 7473 2c20 2a2a 6b77  self.ports, **kw
+00005e80: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
+00005e90: 6574 5f70 6f72 7473 5f6c 6973 7428 7365  et_ports_list(se
+00005ea0: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
+00005eb0: 206c 6973 745b 506f 7274 5d3a 0a20 2020   list[Port]:.   
+00005ec0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00005ed0: 6c69 7374 206f 6620 706f 7274 732e 0a0a  list of ports...
+00005ee0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+00005ef0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00005f00: 2020 6c61 7965 723a 2073 656c 6563 7420    layer: select 
+00005f10: 706f 7274 7320 7769 7468 2047 4453 206c  ports with GDS l
+00005f20: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
+00005f30: 2020 7072 6566 6978 3a20 7365 6c65 6374    prefix: select
+00005f40: 2070 6f72 7473 2077 6974 6820 7072 6566   ports with pref
+00005f50: 6978 2069 6e20 706f 7274 206e 616d 652e  ix in port name.
+00005f60: 0a20 2020 2020 2020 2020 2020 2073 7566  .            suf
+00005f70: 6669 783a 2073 656c 6563 7420 706f 7274  fix: select port
+00005f80: 7320 7769 7468 2070 6f72 7420 6e61 6d65  s with port name
+00005f90: 2073 7566 6669 782e 0a20 2020 2020 2020   suffix..       
+00005fa0: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
+00005fb0: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+00005fc0: 6974 6820 6f72 6965 6e74 6174 696f 6e20  ith orientation 
+00005fd0: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
+00005fe0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
+00005ff0: 696f 6e3a 2073 656c 6563 7420 706f 7274  ion: select port
+00006000: 7320 7769 7468 206f 7269 656e 7461 7469  s with orientati
+00006010: 6f6e 2069 6e20 6465 6772 6565 732e 0a20  on in degrees.. 
+00006020: 2020 2020 2020 2020 2020 2077 6964 7468             width
+00006030: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+00006040: 6974 6820 706f 7274 2077 6964 7468 2e0a  ith port width..
+00006050: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00006060: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
+00006070: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
+00006080: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
+00006090: 2020 2020 706f 7274 5f74 7970 653a 2073      port_type: s
+000060a0: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
+000060b0: 2070 6f72 745f 7479 7065 2028 6f70 7469   port_type (opti
+000060c0: 6361 6c2c 2065 6c65 6374 7269 6361 6c2c  cal, electrical,
+000060d0: 2076 6572 7469 6361 6c5f 7465 292e 0a20   vertical_te).. 
+000060e0: 2020 2020 2020 2020 2020 2063 6c6f 636b             clock
+000060f0: 7769 7365 3a20 6966 2054 7275 652c 2073  wise: if True, s
+00006100: 6f72 7420 706f 7274 7320 636c 6f63 6b77  ort ports clockw
+00006110: 6973 652c 2046 616c 7365 3a20 636f 756e  ise, False: coun
+00006120: 7465 722d 636c 6f63 6b77 6973 652e 0a20  ter-clockwise.. 
+00006130: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00006140: 2020 2072 6574 7572 6e20 6c69 7374 2873     return list(s
+00006150: 656c 6563 745f 706f 7274 7328 7365 6c66  elect_ports(self
+00006160: 2e70 6f72 7473 2c20 2a2a 6b77 6172 6773  .ports, **kwargs
+00006170: 292e 7661 6c75 6573 2829 290a 0a20 2020  ).values())..   
+00006180: 2064 6566 2067 6574 5f70 6f72 7473 5f70   def get_ports_p
+00006190: 616e 6461 7328 7365 6c66 293a 0a20 2020  andas(self):.   
+000061a0: 2020 2020 2069 6d70 6f72 7420 7061 6e64       import pand
+000061b0: 6173 2061 7320 7064 0a0a 2020 2020 2020  as as pd..      
+000061c0: 2020 636f 6c5f 7370 6563 203d 205b 0a20    col_spec = [. 
+000061d0: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
+000061e0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+000061f0: 7769 6474 6822 2c0a 2020 2020 2020 2020  width",.        
+00006200: 2020 2020 2263 656e 7465 7222 2c0a 2020      "center",.  
+00006210: 2020 2020 2020 2020 2020 226f 7269 656e            "orien
+00006220: 7461 7469 6f6e 222c 0a20 2020 2020 2020  tation",.       
+00006230: 2020 2020 2022 6c61 7965 7222 2c0a 2020       "layer",.  
+00006240: 2020 2020 2020 2020 2020 2270 6f72 745f            "port_
+00006250: 7479 7065 222c 0a20 2020 2020 2020 2020  type",.         
+00006260: 2020 2022 7368 6561 725f 616e 676c 6522     "shear_angle"
+00006270: 2c0a 2020 2020 2020 2020 5d0a 0a20 2020  ,.        ]..   
+00006280: 2020 2020 2072 6574 7572 6e20 7064 2e44       return pd.D
+00006290: 6174 6146 7261 6d65 280a 2020 2020 2020  ataFrame(.      
+000062a0: 2020 2020 2020 5b70 6f72 742e 746f 5f64        [port.to_d
+000062b0: 6963 7428 2920 666f 7220 706f 7274 2069  ict() for port i
+000062c0: 6e20 7365 6c66 2e67 6574 5f70 6f72 7473  n self.get_ports
+000062d0: 5f6c 6973 7428 295d 2c20 636f 6c75 6d6e  _list()], column
+000062e0: 733d 636f 6c5f 7370 6563 0a20 2020 2020  s=col_spec.     
+000062f0: 2020 2029 0a0a 2020 2020 6465 6620 6765     )..    def ge
+00006300: 745f 706f 7274 735f 706f 6c61 7273 2873  t_ports_polars(s
+00006310: 656c 6629 3a0a 2020 2020 2020 2020 696d  elf):.        im
+00006320: 706f 7274 2070 6f6c 6172 7320 6173 2070  port polars as p
+00006330: 6c0a 0a20 2020 2020 2020 2063 6f6c 5f73  l..        col_s
+00006340: 7065 6320 3d20 7b0a 2020 2020 2020 2020  pec = {.        
+00006350: 2020 2020 226e 616d 6522 3a20 706c 2e55      "name": pl.U
+00006360: 7466 382c 0a20 2020 2020 2020 2020 2020  tf8,.           
+00006370: 2022 7769 6474 6822 3a20 706c 2e46 6c6f   "width": pl.Flo
+00006380: 6174 3634 2c0a 2020 2020 2020 2020 2020  at64,.          
+00006390: 2020 2263 656e 7465 7222 3a20 706c 2e4c    "center": pl.L
+000063a0: 6973 7428 706c 2e46 6c6f 6174 3634 292c  ist(pl.Float64),
+000063b0: 0a20 2020 2020 2020 2020 2020 2022 6f72  .            "or
+000063c0: 6965 6e74 6174 696f 6e22 3a20 706c 2e46  ientation": pl.F
+000063d0: 6c6f 6174 3634 2c0a 2020 2020 2020 2020  loat64,.        
+000063e0: 2020 2020 226c 6179 6572 223a 2070 6c2e      "layer": pl.
+000063f0: 4c69 7374 2870 6c2e 5549 6e74 3136 292c  List(pl.UInt16),
+00006400: 0a20 2020 2020 2020 2020 2020 2022 706f  .            "po
+00006410: 7274 5f74 7970 6522 3a20 706c 2e55 7466  rt_type": pl.Utf
+00006420: 382c 0a20 2020 2020 2020 2020 2020 2022  8,.            "
+00006430: 7368 6561 725f 616e 676c 6522 3a20 706c  shear_angle": pl
+00006440: 2e46 6c6f 6174 3634 2c0a 2020 2020 2020  .Float64,.      
+00006450: 2020 7d0a 0a20 2020 2020 2020 2072 6574    }..        ret
+00006460: 7572 6e20 706c 2e44 6174 6146 7261 6d65  urn pl.DataFrame
+00006470: 280a 2020 2020 2020 2020 2020 2020 5b70  (.            [p
+00006480: 6f72 742e 746f 5f64 6963 7428 2920 666f  ort.to_dict() fo
+00006490: 7220 706f 7274 2069 6e20 7365 6c66 2e67  r port in self.g
+000064a0: 6574 5f70 6f72 7473 5f6c 6973 7428 295d  et_ports_list()]
+000064b0: 2c20 7363 6865 6d61 3d63 6f6c 5f73 7065  , schema=col_spe
+000064c0: 630a 2020 2020 2020 2020 290a 0a20 2020  c.        )..   
+000064d0: 2064 6566 2072 6566 280a 2020 2020 2020   def ref(.      
+000064e0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000064f0: 706f 7369 7469 6f6e 3a20 436f 6f72 6469  position: Coordi
+00006500: 6e61 7465 203d 2028 302c 2030 292c 0a20  nate = (0, 0),. 
+00006510: 2020 2020 2020 2070 6f72 745f 6964 3a20         port_id: 
+00006520: 7374 7220 7c20 4e6f 6e65 203d 204e 6f6e  str | None = Non
+00006530: 652c 0a20 2020 2020 2020 2072 6f74 6174  e,.        rotat
+00006540: 696f 6e3a 2066 6c6f 6174 203d 2030 2c0a  ion: float = 0,.
+00006550: 2020 2020 2020 2020 685f 6d69 7272 6f72          h_mirror
+00006560: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00006570: 2020 2020 2020 2020 765f 6d69 7272 6f72          v_mirror
+00006580: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00006590: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
+000065a0: 6e74 5265 6665 7265 6e63 653a 0a20 2020  ntReference:.   
+000065b0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+000065c0: 436f 6d70 6f6e 656e 7420 7265 6665 7265  Component refere
+000065d0: 6e63 652e 0a0a 2020 2020 2020 2020 4172  nce...        Ar
+000065e0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000065f0: 706f 7369 7469 6f6e 3a20 782c 2079 2070  position: x, y p
+00006600: 6f73 6974 696f 6e2e 0a20 2020 2020 2020  osition..       
+00006610: 2020 2020 2070 6f72 745f 6964 3a20 6e61       port_id: na
+00006620: 6d65 206f 6620 7468 6520 706f 7274 2e0a  me of the port..
+00006630: 2020 2020 2020 2020 2020 2020 726f 7461              rota
+00006640: 7469 6f6e 3a20 696e 2064 6567 7265 6573  tion: in degrees
+00006650: 2e0a 2020 2020 2020 2020 2020 2020 685f  ..            h_
+00006660: 6d69 7272 6f72 3a20 686f 7269 7a6f 6e74  mirror: horizont
+00006670: 616c 206d 6972 726f 7220 7573 696e 6720  al mirror using 
+00006680: 7920 6178 6973 2028 782c 2031 2920 2831  y axis (x, 1) (1
+00006690: 2c20 3029 2e0a 2020 2020 2020 2020 2020  , 0)..          
+000066a0: 2020 2020 2020 5468 6973 2069 7320 7468        This is th
+000066b0: 6520 6d6f 7374 2063 6f6d 6d6f 6e20 6d69  e most common mi
+000066c0: 7272 6f72 2e0a 2020 2020 2020 2020 2020  rror..          
+000066d0: 2020 765f 6d69 7272 6f72 3a20 7665 7274    v_mirror: vert
+000066e0: 6963 616c 206d 6972 726f 7220 7573 696e  ical mirror usin
+000066f0: 6720 7820 6178 6973 2028 312c 2079 2920  g x axis (1, y) 
+00006700: 2830 2c20 7929 2e0a 2020 2020 2020 2020  (0, y)..        
+00006710: 2222 220a 2020 2020 2020 2020 5f72 6566  """.        _ref
+00006720: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
+00006730: 7265 6e63 6528 7365 6c66 290a 0a20 2020  rence(self)..   
+00006740: 2020 2020 2069 6620 706f 7274 5f69 6420       if port_id 
+00006750: 616e 6420 706f 7274 5f69 6420 6e6f 7420  and port_id not 
+00006760: 696e 2073 656c 662e 706f 7274 733a 0a20  in self.ports:. 
+00006770: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00006780: 2056 616c 7565 4572 726f 7228 6622 706f   ValueError(f"po
+00006790: 7274 207b 706f 7274 5f69 647d 206e 6f74  rt {port_id} not
+000067a0: 2069 6e20 7b73 656c 662e 706f 7274 732e   in {self.ports.
+000067b0: 6b65 7973 2829 7d22 290a 0a20 2020 2020  keys()}")..     
+000067c0: 2020 206f 7269 6769 6e20 3d20 7365 6c66     origin = self
+000067d0: 2e70 6f72 7473 5b70 6f72 745f 6964 5d2e  .ports[port_id].
+000067e0: 6365 6e74 6572 2069 6620 706f 7274 5f69  center if port_i
+000067f0: 6420 656c 7365 2028 302c 2030 290a 2020  d else (0, 0).  
+00006800: 2020 2020 2020 6966 2068 5f6d 6972 726f        if h_mirro
+00006810: 723a 0a20 2020 2020 2020 2020 2020 205f  r:.            _
+00006820: 7265 662e 6d69 7272 6f72 5f78 2870 6f72  ref.mirror_x(por
+00006830: 745f 6964 290a 0a20 2020 2020 2020 2069  t_id)..        i
+00006840: 6620 765f 6d69 7272 6f72 3a0a 2020 2020  f v_mirror:.    
+00006850: 2020 2020 2020 2020 5f72 6566 2e6d 6972          _ref.mir
+00006860: 726f 725f 7928 706f 7274 5f69 6429 0a0a  ror_y(port_id)..
+00006870: 2020 2020 2020 2020 6966 2072 6f74 6174          if rotat
+00006880: 696f 6e20 213d 2030 3a0a 2020 2020 2020  ion != 0:.      
+00006890: 2020 2020 2020 5f72 6566 2e72 6f74 6174        _ref.rotat
+000068a0: 6528 726f 7461 7469 6f6e 2c20 6f72 6967  e(rotation, orig
+000068b0: 696e 290a 2020 2020 2020 2020 5f72 6566  in).        _ref
+000068c0: 2e6d 6f76 6528 6f72 6967 696e 2c20 706f  .move(origin, po
+000068d0: 7369 7469 6f6e 290a 0a20 2020 2020 2020  sition)..       
+000068e0: 2072 6574 7572 6e20 5f72 6566 0a0a 2020   return _ref..  
+000068f0: 2020 6465 6620 7265 665f 6365 6e74 6572    def ref_center
+00006900: 2873 656c 662c 2070 6f73 6974 696f 6e3d  (self, position=
+00006910: 2830 2c20 3029 293a 0a20 2020 2020 2020  (0, 0)):.       
+00006920: 2022 2222 5265 7475 726e 7320 6120 7265   """Returns a re
+00006930: 6665 7265 6e63 6520 6f66 2074 6865 2063  ference of the c
+00006940: 6f6d 706f 6e65 6e74 2063 656e 7465 7265  omponent centere
+00006950: 6420 6174 2028 783d 302c 2079 3d30 292e  d at (x=0, y=0).
+00006960: 2222 220a 2020 2020 2020 2020 7369 203d  """.        si =
+00006970: 2073 656c 662e 7369 7a65 5f69 6e66 6f0a   self.size_info.
+00006980: 2020 2020 2020 2020 7963 203d 2073 692e          yc = si.
+00006990: 736f 7574 6820 2b20 7369 2e68 6569 6768  south + si.heigh
+000069a0: 7420 2f20 320a 2020 2020 2020 2020 7863  t / 2.        xc
+000069b0: 203d 2073 692e 7765 7374 202b 2073 692e   = si.west + si.
+000069c0: 7769 6474 6820 2f20 320a 2020 2020 2020  width / 2.      
+000069d0: 2020 6365 6e74 6572 203d 2028 7863 2c20    center = (xc, 
+000069e0: 7963 290a 2020 2020 2020 2020 5f72 6566  yc).        _ref
+000069f0: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
+00006a00: 7265 6e63 6528 7365 6c66 290a 2020 2020  rence(self).    
+00006a10: 2020 2020 5f72 6566 2e6d 6f76 6528 6365      _ref.move(ce
+00006a20: 6e74 6572 2c20 706f 7369 7469 6f6e 290a  nter, position).
+00006a30: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+00006a40: 7265 660a 0a20 2020 2064 6566 205f 5f72  ref..    def __r
+00006a50: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
+00006a60: 7472 3a0a 2020 2020 2020 2020 2222 2252  tr:.        """R
+00006a70: 6574 7572 6e20 6120 7374 7269 6e67 2072  eturn a string r
+00006a80: 6570 7265 7365 6e74 6174 696f 6e20 6f66  epresentation of
+00006a90: 2074 6865 206f 626a 6563 742e 2222 220a   the object.""".
+00006aa0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00006ab0: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
+00006ac0: 7365 6c66 2e6e 616d 657d 3a20 7569 6420  self.name}: uid 
+00006ad0: 7b73 656c 662e 7569 647d 2c20 220a 2020  {self.uid}, ".  
+00006ae0: 2020 2020 2020 2020 2020 6622 706f 7274            f"port
+00006af0: 7320 7b6c 6973 7428 7365 6c66 2e70 6f72  s {list(self.por
+00006b00: 7473 2e6b 6579 7328 2929 7d2c 2022 0a20  ts.keys())}, ". 
+00006b10: 2020 2020 2020 2020 2020 2066 2272 6566             f"ref
+00006b20: 6572 656e 6365 7320 7b6c 6973 7428 7365  erences {list(se
+00006b30: 6c66 2e6e 616d 6564 5f72 6566 6572 656e  lf.named_referen
+00006b40: 6365 732e 6b65 7973 2829 297d 2c20 220a  ces.keys())}, ".
+00006b50: 2020 2020 2020 2020 2020 2020 6622 7b6c              f"{l
+00006b60: 656e 2873 656c 662e 706f 6c79 676f 6e73  en(self.polygons
+00006b70: 297d 2070 6f6c 7967 6f6e 7322 0a20 2020  )} polygons".   
+00006b80: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00006b90: 7070 7269 6e74 2873 656c 6629 202d 3e20  pprint(self) -> 
+00006ba0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00006bb0: 2250 7269 6e74 7320 636f 6d70 6f6e 656e  "Prints componen
+00006bc0: 7420 696e 666f 2e22 2222 0a20 2020 2020  t info.""".     
+00006bd0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00006be0: 2020 2020 6672 6f6d 2072 6963 6820 696d      from rich im
+00006bf0: 706f 7274 2070 7265 7474 790a 0a20 2020  port pretty..   
+00006c00: 2020 2020 2020 2020 2070 7265 7474 792e           pretty.
+00006c10: 696e 7374 616c 6c28 290a 2020 2020 2020  install().      
+00006c20: 2020 2020 2020 7072 6574 7479 2e70 7072        pretty.ppr
+00006c30: 696e 7428 7365 6c66 2e74 6f5f 6469 6374  int(self.to_dict
+00006c40: 2829 290a 2020 2020 2020 2020 6578 6365  ()).        exce
+00006c50: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
+00006c60: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00006c70: 7428 7961 6d6c 2e64 756d 7028 7365 6c66  t(yaml.dump(self
+00006c80: 2e74 6f5f 6469 6374 2829 2929 0a0a 2020  .to_dict()))..  
+00006c90: 2020 6465 6620 7070 7269 6e74 5f70 6f72    def pprint_por
+00006ca0: 7473 2873 656c 6629 202d 3e20 4e6f 6e65  ts(self) -> None
+00006cb0: 3a0a 2020 2020 2020 2020 2222 2250 7269  :.        """Pri
+00006cc0: 6e74 7320 706f 7274 7320 696e 2061 2072  nts ports in a r
+00006cd0: 6963 6820 7461 626c 652e 2222 220a 2020  ich table.""".  
+00006ce0: 2020 2020 2020 6672 6f6d 2072 6963 682e        from rich.
+00006cf0: 636f 6e73 6f6c 6520 696d 706f 7274 2043  console import C
+00006d00: 6f6e 736f 6c65 0a20 2020 2020 2020 2066  onsole.        f
+00006d10: 726f 6d20 7269 6368 2e74 6162 6c65 2069  rom rich.table i
+00006d20: 6d70 6f72 7420 5461 626c 650a 0a20 2020  mport Table..   
+00006d30: 2020 2020 2063 6f6e 736f 6c65 203d 2043       console = C
+00006d40: 6f6e 736f 6c65 2829 0a0a 2020 2020 2020  onsole()..      
+00006d50: 2020 7461 626c 6520 3d20 5461 626c 6528    table = Table(
+00006d60: 7368 6f77 5f68 6561 6465 723d 5472 7565  show_header=True
+00006d70: 2c20 6865 6164 6572 5f73 7479 6c65 3d22  , header_style="
+00006d80: 626f 6c64 2229 0a20 2020 2020 2020 2070  bold").        p
+00006d90: 6f72 7473 5f6c 6973 7420 3d20 7365 6c66  orts_list = self
+00006da0: 2e67 6574 5f70 6f72 7473 5f6c 6973 7428  .get_ports_list(
+00006db0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00006dc0: 2070 6f72 7473 5f6c 6973 743a 0a20 2020   ports_list:.   
+00006dd0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00006de0: 2020 2020 2020 2020 7030 203d 2070 6f72          p0 = por
+00006df0: 7473 5f6c 6973 745b 305d 0a20 2020 2020  ts_list[0].     
+00006e00: 2020 2066 696c 7465 7265 645f 6469 6374     filtered_dict
+00006e10: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00006e20: 206b 6579 3a20 7661 6c75 6520 666f 7220   key: value for 
+00006e30: 6b65 792c 2076 616c 7565 2069 6e20 7030  key, value in p0
+00006e40: 2e74 6f5f 6469 6374 2829 2e69 7465 6d73  .to_dict().items
+00006e50: 2829 2069 6620 7661 6c75 6520 6973 206e  () if value is n
+00006e60: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+00006e70: 7d0a 2020 2020 2020 2020 6b65 7973 203d  }.        keys =
+00006e80: 2066 696c 7465 7265 645f 6469 6374 2e6b   filtered_dict.k
+00006e90: 6579 7328 290a 0a20 2020 2020 2020 2066  eys()..        f
+00006ea0: 6f72 206b 6579 2069 6e20 6b65 7973 3a0a  or key in keys:.
+00006eb0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+00006ec0: 652e 6164 645f 636f 6c75 6d6e 286b 6579  e.add_column(key
+00006ed0: 290a 0a20 2020 2020 2020 2066 6f72 2070  )..        for p
+00006ee0: 6f72 7420 696e 2070 6f72 7473 5f6c 6973  ort in ports_lis
+00006ef0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+00006f00: 6f72 745f 6469 6374 203d 2070 6f72 742e  ort_dict = port.
+00006f10: 746f 5f64 6963 7428 290a 2020 2020 2020  to_dict().      
+00006f20: 2020 2020 2020 726f 7720 3d20 5b73 7472        row = [str
+00006f30: 2870 6f72 745f 6469 6374 2e67 6574 286b  (port_dict.get(k
+00006f40: 6579 2c20 2222 2929 2066 6f72 206b 6579  ey, "")) for key
+00006f50: 2069 6e20 6b65 7973 5d0a 2020 2020 2020   in keys].      
+00006f60: 2020 2020 2020 7461 626c 652e 6164 645f        table.add_
+00006f70: 726f 7728 2a72 6f77 290a 0a20 2020 2020  row(*row)..     
+00006f80: 2020 2063 6f6e 736f 6c65 2e70 7269 6e74     console.print
+00006f90: 2874 6162 6c65 290a 0a20 2020 2040 7072  (table)..    @pr
+00006fa0: 6f70 6572 7479 0a20 2020 2064 6566 206d  operty.    def m
+00006fb0: 6574 6164 6174 615f 6368 696c 6428 7365  etadata_child(se
+00006fc0: 6c66 2920 2d3e 2064 6963 743a 0a20 2020  lf) -> dict:.   
+00006fd0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00006fe0: 6d65 7461 6461 7461 2066 726f 6d20 6368  metadata from ch
+00006ff0: 696c 6420 6966 2061 6e79 2c20 4f74 6865  ild if any, Othe
+00007000: 7277 6973 6520 7265 7475 726e 7320 636f  rwise returns co
+00007010: 6d70 6f6e 656e 7420 6f77 6e2e 0a0a 2020  mponent own...  
+00007020: 2020 2020 2020 6d65 7461 6461 7461 2047        metadata G
+00007030: 7265 6174 2074 6f20 6163 6365 7373 2074  reat to access t
+00007040: 6865 2063 6869 6c64 7265 6e20 6d65 7461  he children meta
+00007050: 6461 7461 2061 7420 7468 6520 626f 7474  data at the bott
+00007060: 6f6d 206f 6620 7468 650a 2020 2020 2020  om of the.      
+00007070: 2020 6869 6572 6172 6368 792e 0a20 2020    hierarchy..   
+00007080: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007090: 2073 6574 7469 6e67 7320 3d20 6469 6374   settings = dict
+000070a0: 2873 656c 662e 7365 7474 696e 6773 290a  (self.settings).
+000070b0: 0a20 2020 2020 2020 2077 6869 6c65 2073  .        while s
+000070c0: 6574 7469 6e67 732e 6765 7428 2263 6869  ettings.get("chi
+000070d0: 6c64 2229 3a0a 2020 2020 2020 2020 2020  ld"):.          
+000070e0: 2020 7365 7474 696e 6773 203d 2073 6574    settings = set
+000070f0: 7469 6e67 732e 6765 7428 2263 6869 6c64  tings.get("child
+00007100: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
+00007110: 726e 2064 6963 7428 7365 7474 696e 6773  rn dict(settings
+00007120: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+00007130: 0a20 2020 2064 6566 206d 6574 6164 6174  .    def metadat
+00007140: 6128 7365 6c66 2920 2d3e 2064 6963 743a  a(self) -> dict:
+00007150: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007160: 6469 6374 2873 656c 662e 7365 7474 696e  dict(self.settin
+00007170: 6773 290a 0a20 2020 2064 6566 2061 6464  gs)..    def add
+00007180: 5f70 6f72 7428 0a20 2020 2020 2020 2073  _port(.        s
+00007190: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
+000071a0: 653a 2073 7472 207c 206f 626a 6563 7420  e: str | object 
+000071b0: 7c20 4e6f 6e65 203d 204e 6f6e 652c 0a20  | None = None,. 
+000071c0: 2020 2020 2020 2063 656e 7465 723a 2074         center: t
+000071d0: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
+000071e0: 745d 207c 204e 6f6e 6520 3d20 4e6f 6e65  t] | None = None
+000071f0: 2c0a 2020 2020 2020 2020 7769 6474 683a  ,.        width:
+00007200: 2066 6c6f 6174 207c 204e 6f6e 6520 3d20   float | None = 
+00007210: 4e6f 6e65 2c0a 2020 2020 2020 2020 6f72  None,.        or
+00007220: 6965 6e74 6174 696f 6e3a 2066 6c6f 6174  ientation: float
+00007230: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00007240: 2020 2020 2020 2020 706f 7274 3a20 506f          port: Po
+00007250: 7274 207c 204e 6f6e 6520 3d20 4e6f 6e65  rt | None = None
+00007260: 2c0a 2020 2020 2020 2020 6c61 7965 723a  ,.        layer:
+00007270: 204c 6179 6572 5370 6563 207c 204e 6f6e   LayerSpec | Non
+00007280: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00007290: 2020 706f 7274 5f74 7970 653a 2073 7472    port_type: str
+000072a0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+000072b0: 2020 2020 2020 2020 6372 6f73 735f 7365          cross_se
+000072c0: 6374 696f 6e3a 2043 726f 7373 5365 6374  ction: CrossSect
+000072d0: 696f 6e53 7065 6320 7c20 4e6f 6e65 203d  ionSpec | None =
+000072e0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
+000072f0: 6865 6172 5f61 6e67 6c65 3a20 666c 6f61  hear_angle: floa
+00007300: 7420 7c20 4e6f 6e65 203d 204e 6f6e 652c  t | None = None,
+00007310: 0a20 2020 2029 202d 3e20 506f 7274 3a0a  .    ) -> Port:.
+00007320: 2020 2020 2020 2020 2222 2241 6464 2070          """Add p
+00007330: 6f72 7420 746f 2063 6f6d 706f 6e65 6e74  ort to component
+00007340: 2e0a 0a20 2020 2020 2020 2059 6f75 2063  ...        You c
+00007350: 616e 2063 6f70 7920 616e 2065 7869 7374  an copy an exist
+00007360: 696e 6720 706f 7274 206c 696b 6520 6164  ing port like ad
+00007370: 645f 706f 7274 2870 6f72 7420 3d20 6578  d_port(port = ex
+00007380: 6973 7469 6e67 5f70 6f72 7429 206f 720a  isting_port) or.
+00007390: 2020 2020 2020 2020 6372 6561 7465 2061          create a
+000073a0: 206e 6577 2070 6f72 7420 6164 645f 706f   new port add_po
+000073b0: 7274 286d 796e 616d 652c 206d 7963 656e  rt(myname, mycen
+000073c0: 7465 722c 206d 7977 6964 7468 2c20 6d79  ter, mywidth, my
+000073d0: 6f72 6965 6e74 6174 696f 6e29 2e0a 2020  orientation)..  
+000073e0: 2020 2020 2020 596f 7520 6361 6e20 616c        You can al
+000073f0: 736f 2063 6f70 7920 616e 2065 7869 7374  so copy an exist
+00007400: 696e 6720 706f 7274 0a20 2020 2020 2020  ing port.       
+00007410: 2077 6974 6820 6120 6e65 7720 6e61 6d65   with a new name
+00007420: 2061 6464 5f70 6f72 7428 706f 7274 203d   add_port(port =
+00007430: 2065 7869 7374 696e 675f 706f 7274 2c20   existing_port, 
+00007440: 6e61 6d65 203d 206e 6577 5f6e 616d 6529  name = new_name)
+00007450: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00007460: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00007470: 3a20 706f 7274 206e 616d 652e 0a20 2020  : port name..   
+00007480: 2020 2020 2020 2020 2063 656e 7465 723a           center:
+00007490: 2078 2c20 792e 0a20 2020 2020 2020 2020   x, y..         
+000074a0: 2020 2077 6964 7468 3a20 696e 2075 6d2e     width: in um.
+000074b0: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
+000074c0: 656e 7461 7469 6f6e 3a20 696e 2064 6567  entation: in deg
+000074d0: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
+000074e0: 7274 3a20 6f70 7469 6f6e 616c 2070 6f72  rt: optional por
+000074f0: 742e 0a20 2020 2020 2020 2020 2020 206c  t..            l
+00007500: 6179 6572 3a20 706f 7274 206c 6179 6572  ayer: port layer
+00007510: 2e0a 2020 2020 2020 2020 2020 2020 706f  ..            po
+00007520: 7274 5f74 7970 653a 206f 7074 6963 616c  rt_type: optical
+00007530: 2c20 656c 6563 7472 6963 616c 2c20 7665  , electrical, ve
+00007540: 7274 6963 616c 5f64 632c 2076 6572 7469  rtical_dc, verti
+00007550: 6361 6c5f 7465 2c20 7665 7274 6963 616c  cal_te, vertical
+00007560: 5f74 6d2e 2044 6566 6175 6c74 7320 746f  _tm. Defaults to
+00007570: 206f 7074 6963 616c 2e0a 2020 2020 2020   optical..      
+00007580: 2020 2020 2020 6372 6f73 735f 7365 6374        cross_sect
+00007590: 696f 6e3a 2070 6f72 7420 6372 6f73 735f  ion: port cross_
+000075a0: 7365 6374 696f 6e2e 0a20 2020 2020 2020  section..       
+000075b0: 2020 2020 2073 6865 6172 5f61 6e67 6c65       shear_angle
+000075c0: 3a20 616e 206f 7074 696f 6e61 6c20 616e  : an optional an
+000075d0: 676c 6520 746f 2073 6865 6172 2070 6f72  gle to shear por
+000075e0: 7420 6661 6365 2069 6e20 6465 6772 6565  t face in degree
+000075f0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00007600: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+00007610: 6163 746f 7279 2e70 646b 2069 6d70 6f72  actory.pdk impor
+00007620: 7420 6765 745f 6372 6f73 735f 7365 6374  t get_cross_sect
+00007630: 696f 6e2c 2067 6574 5f6c 6179 6572 0a0a  ion, get_layer..
+00007640: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
+00007650: 6765 745f 6c61 7965 7228 6c61 7965 7229  get_layer(layer)
+00007660: 0a0a 2020 2020 2020 2020 6966 2070 6f72  ..        if por
+00007670: 743a 0a20 2020 2020 2020 2020 2020 2069  t:.            i
+00007680: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00007690: 2870 6f72 742c 2050 6f72 7429 3a0a 2020  (port, Port):.  
+000076a0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000076b0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+000076c0: 2261 6464 5f70 6f72 7428 2920 6e65 6564  "add_port() need
+000076d0: 7320 6120 506f 7274 2c20 676f 7420 7b74  s a Port, got {t
+000076e0: 7970 6528 706f 7274 297d 2229 0a20 2020  ype(port)}").   
+000076f0: 2020 2020 2020 2020 2070 203d 2070 6f72           p = por
+00007700: 742e 636f 7079 2829 0a20 2020 2020 2020  t.copy().       
+00007710: 2020 2020 2069 6620 6e61 6d65 2069 7320       if name is 
+00007720: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00007730: 2020 2020 2020 2020 2020 702e 6e61 6d65            p.name
+00007740: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
+00007750: 2020 2020 6966 2063 656e 7465 7220 6973      if center is
+00007760: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00007770: 2020 2020 2020 2020 2020 2070 2e63 656e             p.cen
+00007780: 7465 7220 3d20 6365 6e74 6572 0a20 2020  ter = center.   
+00007790: 2020 2020 2020 2020 2069 6620 7769 6474           if widt
+000077a0: 6820 6973 206e 6f74 204e 6f6e 653a 0a20  h is not None:. 
+000077b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000077c0: 2e77 6964 7468 203d 2077 6964 7468 0a20  .width = width. 
+000077d0: 2020 2020 2020 2020 2020 2069 6620 6f72             if or
+000077e0: 6965 6e74 6174 696f 6e20 6973 206e 6f74  ientation is not
+000077f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00007800: 2020 2020 2020 2070 2e6f 7269 656e 7461         p.orienta
+00007810: 7469 6f6e 203d 206f 7269 656e 7461 7469  tion = orientati
+00007820: 6f6e 0a20 2020 2020 2020 2020 2020 2069  on.            i
+00007830: 6620 706f 7274 5f74 7970 6520 6973 206e  f port_type is n
+00007840: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00007850: 2020 2020 2020 2020 2070 2e70 6f72 745f           p.port_
+00007860: 7479 7065 203d 2070 6f72 745f 7479 7065  type = port_type
+00007870: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00007880: 6c61 7965 7220 6973 206e 6f74 204e 6f6e  layer is not Non
+00007890: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000078a0: 2020 2070 2e6c 6179 6572 203d 206c 6179     p.layer = lay
+000078b0: 6572 0a20 2020 2020 2020 2020 2020 2070  er.            p
+000078c0: 2e70 6172 656e 7420 3d20 7365 6c66 0a0a  .parent = self..
+000078d0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+000078e0: 6e73 7461 6e63 6528 6e61 6d65 2c20 506f  nstance(name, Po
+000078f0: 7274 293a 0a20 2020 2020 2020 2020 2020  rt):.           
+00007900: 2070 203d 206e 616d 652e 636f 7079 2829   p = name.copy()
+00007910: 0a20 2020 2020 2020 2020 2020 2070 2e70  .            p.p
+00007920: 6172 656e 7420 3d20 7365 6c66 0a20 2020  arent = self.   
+00007930: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+00007940: 702e 6e61 6d65 0a20 2020 2020 2020 2065  p.name.        e
+00007950: 6c69 6620 6365 6e74 6572 2069 7320 4e6f  lif center is No
+00007960: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007970: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00007980: 2822 506f 7274 206e 6565 6473 2063 656e  ("Port needs cen
+00007990: 7465 7220 7061 7261 6d65 7465 7220 2878  ter parameter (x
+000079a0: 2c20 7929 2075 6d2e 2229 0a0a 2020 2020  , y) um.")..    
+000079b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000079c0: 2020 2020 2020 7020 3d20 506f 7274 280a        p = Port(.
+000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079e0: 6e61 6d65 3d6e 616d 652c 0a20 2020 2020  name=name,.     
+000079f0: 2020 2020 2020 2020 2020 2063 656e 7465             cente
+00007a00: 723d 6365 6e74 6572 2c0a 2020 2020 2020  r=center,.      
+00007a10: 2020 2020 2020 2020 2020 7769 6474 683d            width=
+00007a20: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
+00007a30: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
+00007a40: 6f6e 3d6f 7269 656e 7461 7469 6f6e 2c0a  on=orientation,.
+00007a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a60: 7061 7265 6e74 3d73 656c 662c 0a20 2020  parent=self,.   
+00007a70: 2020 2020 2020 2020 2020 2020 206c 6179               lay
+00007a80: 6572 3d6c 6179 6572 2c0a 2020 2020 2020  er=layer,.      
+00007a90: 2020 2020 2020 2020 2020 706f 7274 5f74            port_t
+00007aa0: 7970 653d 706f 7274 5f74 7970 6520 6f72  ype=port_type or
+00007ab0: 2022 6f70 7469 6361 6c22 2c0a 2020 2020   "optical",.    
+00007ac0: 2020 2020 2020 2020 2020 2020 6372 6f73              cros
+00007ad0: 735f 7365 6374 696f 6e3d 6765 745f 6372  s_section=get_cr
+00007ae0: 6f73 735f 7365 6374 696f 6e28 6372 6f73  oss_section(cros
+00007af0: 735f 7365 6374 696f 6e29 0a20 2020 2020  s_section).     
+00007b00: 2020 2020 2020 2020 2020 2069 6620 6372             if cr
+00007b10: 6f73 735f 7365 6374 696f 6e0a 2020 2020  oss_section.    
+00007b20: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00007b30: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00007b40: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00007b50: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
+00007b60: 3a0a 2020 2020 2020 2020 2020 2020 702e  :.            p.
+00007b70: 6e61 6d65 203d 206e 616d 650a 2020 2020  name = name.    
+00007b80: 2020 2020 6966 2070 2e6e 616d 6520 696e      if p.name in
+00007b90: 2073 656c 662e 706f 7274 733a 0a20 2020   self.ports:.   
+00007ba0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00007bb0: 616c 7565 4572 726f 7228 6622 6164 645f  alueError(f"add_
+00007bc0: 706f 7274 2829 2050 6f72 7420 6e61 6d65  port() Port name
+00007bd0: 207b 702e 6e61 6d65 2172 7d20 6578 6973   {p.name!r} exis
+00007be0: 7473 2069 6e20 7b73 656c 662e 6e61 6d65  ts in {self.name
+00007bf0: 2172 7d22 290a 0a20 2020 2020 2020 2073  !r}")..        s
+00007c00: 656c 662e 706f 7274 735b 702e 6e61 6d65  elf.ports[p.name
+00007c10: 5d20 3d20 700a 2020 2020 2020 2020 7265  ] = p.        re
+00007c20: 7475 726e 2070 0a0a 2020 2020 6465 6620  turn p..    def 
+00007c30: 6164 645f 706f 7274 7328 0a20 2020 2020  add_ports(.     
+00007c40: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00007c50: 2070 6f72 7473 3a20 4974 6572 6162 6c65   ports: Iterable
+00007c60: 5b50 6f72 745d 207c 2064 6963 745b 7374  [Port] | dict[st
+00007c70: 722c 2050 6f72 745d 2c0a 2020 2020 2020  r, Port],.      
+00007c80: 2020 7072 6566 6978 3a20 7374 7220 3d20    prefix: str = 
+00007c90: 2222 2c0a 2020 2020 2020 2020 7375 6666  "",.        suff
+00007ca0: 6978 3a20 7374 7220 3d20 2222 2c0a 2020  ix: str = "",.  
+00007cb0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+00007cc0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+00007cd0: 2020 2020 2020 2022 2222 4164 6420 6120         """Add a 
+00007ce0: 6c69 7374 206f 7220 6469 6374 206f 6620  list or dict of 
+00007cf0: 706f 7274 732e 0a0a 2020 2020 2020 2020  ports...        
+00007d00: 796f 7520 6361 6e20 696e 636c 7564 6520  you can include 
+00007d10: 6120 7072 6566 6978 2074 6f20 6164 6420  a prefix to add 
+00007d20: 746f 2074 6865 206e 6577 2070 6f72 7420  to the new port 
+00007d30: 6e61 6d65 7320 746f 2061 766f 6964 206e  names to avoid n
+00007d40: 616d 6520 636f 6e66 6c69 6374 732e 0a0a  ame conflicts...
+00007d50: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00007d60: 2020 2020 2020 2020 2020 706f 7274 733a            ports:
+00007d70: 206c 6973 7420 6f72 2064 6963 7420 6f66   list or dict of
+00007d80: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+00007d90: 2020 2020 7072 6566 6978 3a20 746f 2070      prefix: to p
+00007da0: 7265 7065 6e64 2074 6f20 6561 6368 2070  repend to each p
+00007db0: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
+00007dc0: 2020 2020 2020 7375 6666 6978 3a20 746f        suffix: to
+00007dd0: 2061 7070 656e 6420 746f 2065 6163 6820   append to each 
+00007de0: 706f 7274 206e 616d 652e 0a20 2020 2020  port name..     
+00007df0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+00007e00: 6f72 7473 203d 2070 6f72 7473 2e76 616c  orts = ports.val
+00007e10: 7565 7328 2920 6966 2069 7369 6e73 7461  ues() if isinsta
+00007e20: 6e63 6528 706f 7274 732c 204d 6170 7069  nce(ports, Mappi
+00007e30: 6e67 2920 656c 7365 2070 6f72 7473 0a20  ng) else ports. 
+00007e40: 2020 2020 2020 2066 6f72 2070 6f72 7420         for port 
+00007e50: 696e 2070 6f72 7473 3a0a 2020 2020 2020  in ports:.      
+00007e60: 2020 2020 2020 6e61 6d65 203d 2066 227b        name = f"{
+00007e70: 7072 6566 6978 7d7b 706f 7274 2e6e 616d  prefix}{port.nam
+00007e80: 657d 7b73 7566 6669 787d 220a 2020 2020  e}{suffix}".    
+00007e90: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+00007ea0: 5f70 6f72 7428 6e61 6d65 3d6e 616d 652c  _port(name=name,
+00007eb0: 2070 6f72 743d 706f 7274 2c20 2a2a 6b77   port=port, **kw
+00007ec0: 6172 6773 290a 0a20 2020 2064 6566 2073  args)..    def s
+00007ed0: 6e61 705f 706f 7274 735f 746f 5f67 7269  nap_ports_to_gri
+00007ee0: 6428 7365 6c66 2c20 6e6d 3a20 696e 7420  d(self, nm: int 
+00007ef0: 3d20 3129 202d 3e20 4e6f 6e65 3a0a 2020  = 1) -> None:.  
+00007f00: 2020 2020 2020 666f 7220 706f 7274 2069        for port i
+00007f10: 6e20 7365 6c66 2e70 6f72 7473 2e76 616c  n self.ports.val
+00007f20: 7565 7328 293a 0a20 2020 2020 2020 2020  ues():.         
+00007f30: 2020 2070 6f72 742e 736e 6170 5f74 6f5f     port.snap_to_
+00007f40: 6772 6964 286e 6d3d 6e6d 290a 0a20 2020  grid(nm=nm)..   
+00007f50: 2064 6566 2072 656d 6f76 655f 6c61 7965   def remove_laye
+00007f60: 7273 280a 2020 2020 2020 2020 7365 6c66  rs(.        self
+00007f70: 2c0a 2020 2020 2020 2020 6c61 7965 7273  ,.        layers
+00007f80: 3a20 6c69 7374 5b4c 6179 6572 5370 6563  : list[LayerSpec
+00007f90: 5d2c 0a20 2020 2020 2020 2069 6e63 6c75  ],.        inclu
+00007fa0: 6465 5f6c 6162 656c 733a 2062 6f6f 6c20  de_labels: bool 
+00007fb0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00007fc0: 696e 7665 7274 5f73 656c 6563 7469 6f6e  invert_selection
+00007fd0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00007fe0: 2020 2020 2020 2020 7265 6375 7273 6976          recursiv
+00007ff0: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
+00008000: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
+00008010: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
+00008020: 656d 6f76 6520 6120 6c69 7374 206f 6620  emove a list of 
+00008030: 6c61 7965 7273 2061 6e64 2072 6574 7572  layers and retur
+00008040: 6e73 2074 6865 2073 616d 6520 436f 6d70  ns the same Comp
+00008050: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+00008060: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00008070: 2020 6c61 7965 7273 3a20 6c69 7374 206f    layers: list o
+00008080: 6620 6c61 7965 7273 2074 6f20 7265 6d6f  f layers to remo
+00008090: 7665 2e0a 2020 2020 2020 2020 2020 2020  ve..            
+000080a0: 696e 636c 7564 655f 6c61 6265 6c73 3a20  include_labels: 
+000080b0: 7265 6d6f 7665 206c 6162 656c 7320 6f6e  remove labels on
+000080c0: 2074 686f 7365 206c 6179 6572 732e 0a20   those layers.. 
+000080d0: 2020 2020 2020 2020 2020 2069 6e76 6572             inver
+000080e0: 745f 7365 6c65 6374 696f 6e3a 2072 656d  t_selection: rem
+000080f0: 6f76 6573 2061 6c6c 206c 6179 6572 7320  oves all layers 
+00008100: 6578 6365 7074 206c 6179 6572 7320 7370  except layers sp
+00008110: 6563 6966 6965 642e 0a20 2020 2020 2020  ecified..       
+00008120: 2020 2020 2072 6563 7572 7369 7665 3a20       recursive: 
+00008130: 6f70 6572 6174 6520 6f6e 2074 6865 2063  operate on the c
+00008140: 656c 6c73 2069 6e63 6c75 6465 6420 696e  ells included in
+00008150: 2074 6869 7320 6365 6c6c 2e0a 2020 2020   this cell..    
+00008160: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008170: 6672 6f6d 2067 6473 6661 6374 6f72 7920  from gdsfactory 
+00008180: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+00008190: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
+000081a0: 656e 7420 3d20 7365 6c66 2e66 6c61 7474  ent = self.flatt
+000081b0: 656e 2829 2069 6620 7265 6375 7273 6976  en() if recursiv
+000081c0: 6520 616e 6420 7365 6c66 2e72 6566 6572  e and self.refer
+000081d0: 656e 6365 7320 656c 7365 2073 656c 660a  ences else self.
+000081e0: 2020 2020 2020 2020 6c61 7965 7273 203d          layers =
+000081f0: 205b 6765 745f 6c61 7965 7228 6c61 7965   [get_layer(laye
+00008200: 7229 2066 6f72 206c 6179 6572 2069 6e20  r) for layer in 
+00008210: 6c61 7965 7273 5d0a 0a20 2020 2020 2020  layers]..       
+00008220: 2073 686f 756c 645f 7265 6d6f 7665 203d   should_remove =
+00008230: 206e 6f74 2069 6e76 6572 745f 7365 6c65   not invert_sele
+00008240: 6374 696f 6e0a 2020 2020 2020 2020 636f  ction.        co
+00008250: 6d70 6f6e 656e 742e 5f63 656c 6c2e 6669  mponent._cell.fi
+00008260: 6c74 6572 280a 2020 2020 2020 2020 2020  lter(.          
+00008270: 2020 7370 6563 3d6c 6179 6572 732c 0a20    spec=layers,. 
+00008280: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
+00008290: 653d 7368 6f75 6c64 5f72 656d 6f76 652c  e=should_remove,
+000082a0: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+000082b0: 7967 6f6e 733d 5472 7565 2c0a 2020 2020  ygons=True,.    
+000082c0: 2020 2020 2020 2020 7061 7468 733d 5472          paths=Tr
+000082d0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+000082e0: 6c61 6265 6c73 3d69 6e63 6c75 6465 5f6c  labels=include_l
+000082f0: 6162 656c 732c 0a20 2020 2020 2020 2029  abels,.        )
+00008300: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00008310: 636f 6d70 6f6e 656e 740a 0a20 2020 2064  component..    d
+00008320: 6566 2065 7874 7261 6374 280a 2020 2020  ef extract(.    
+00008330: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00008340: 2020 6c61 7965 7273 3a20 6c69 7374 5b74    layers: list[t
+00008350: 7570 6c65 5b69 6e74 2c20 696e 745d 207c  uple[int, int] |
+00008360: 2073 7472 5d2c 0a20 2020 2029 202d 3e20   str],.    ) -> 
+00008370: 436f 6d70 6f6e 656e 743a 0a20 2020 2020  Component:.     
+00008380: 2020 2022 2222 4578 7472 6163 7420 706f     """Extract po
+00008390: 6c79 676f 6e73 2066 726f 6d20 6120 436f  lygons from a Co
+000083a0: 6d70 6f6e 656e 7420 616e 6420 7265 7475  mponent and retu
+000083b0: 726e 7320 6120 6e65 7720 436f 6d70 6f6e  rns a new Compon
+000083c0: 656e 742e 2222 220a 2020 2020 2020 2020  ent.""".        
+000083d0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+000083e0: 7064 6b20 696d 706f 7274 2067 6574 5f6c  pdk import get_l
+000083f0: 6179 6572 0a0a 2020 2020 2020 2020 6966  ayer..        if
+00008400: 2074 7970 6528 6c61 7965 7273 2920 6e6f   type(layers) no
+00008410: 7420 696e 2028 6c69 7374 2c20 7475 706c  t in (list, tupl
+00008420: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00008430: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00008440: 2866 226c 6179 6572 7320 7b6c 6179 6572  (f"layers {layer
+00008450: 7321 727d 206e 6565 6473 2074 6f20 6265  s!r} needs to be
+00008460: 2061 206c 6973 7420 6f72 2074 7570 6c65   a list or tuple
+00008470: 2229 0a0a 2020 2020 2020 2020 6c61 7965  ")..        laye
+00008480: 7273 203d 205b 6765 745f 6c61 7965 7228  rs = [get_layer(
+00008490: 6c61 7965 7229 2066 6f72 206c 6179 6572  layer) for layer
+000084a0: 2069 6e20 6c61 7965 7273 5d0a 2020 2020   in layers].    
+000084b0: 2020 2020 2320 636f 6d70 6f6e 656e 7420      # component 
+000084c0: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
+000084d0: 2020 2020 2020 2320 636f 6d70 6f6e 656e        # componen
+000084e0: 742e 5f63 656c 6c2e 6669 6c74 6572 2873  t._cell.filter(s
+000084f0: 7065 633d 6c61 7965 7273 2c20 7265 6d6f  pec=layers, remo
+00008500: 7665 3d46 616c 7365 290a 0a20 2020 2020  ve=False)..     
+00008510: 2020 2063 6f6d 706f 6e65 6e74 203d 2043     component = C
+00008520: 6f6d 706f 6e65 6e74 2829 0a20 2020 2020  omponent().     
+00008530: 2020 2070 6f6c 795f 6469 6374 203d 2073     poly_dict = s
+00008540: 656c 662e 6765 745f 706f 6c79 676f 6e73  elf.get_polygons
+00008550: 2862 795f 7370 6563 3d54 7275 652c 2069  (by_spec=True, i
+00008560: 6e63 6c75 6465 5f70 6174 6873 3d46 616c  nclude_paths=Fal
+00008570: 7365 290a 0a20 2020 2020 2020 2066 6f72  se)..        for
+00008580: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
+00008590: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+000085a0: 206c 6179 6572 2069 6e20 706f 6c79 5f64   layer in poly_d
+000085b0: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
+000085c0: 2020 2020 2070 6f6c 7967 6f6e 7320 3d20       polygons = 
+000085d0: 706f 6c79 5f64 6963 745b 6c61 7965 725d  poly_dict[layer]
+000085e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000085f0: 2066 6f72 2070 6f6c 7967 6f6e 2069 6e20   for polygon in 
+00008600: 706f 6c79 676f 6e73 3a0a 2020 2020 2020  polygons:.      
+00008610: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00008620: 6d70 6f6e 656e 742e 6164 645f 706f 6c79  mponent.add_poly
+00008630: 676f 6e28 706f 6c79 676f 6e2c 206c 6179  gon(polygon, lay
+00008640: 6572 290a 0a20 2020 2020 2020 2066 6f72  er)..        for
+00008650: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
+00008660: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00008670: 7220 7061 7468 2069 6e20 7365 6c66 2e5f  r path in self._
+00008680: 6365 6c6c 2e67 6574 5f70 6174 6873 286c  cell.get_paths(l
+00008690: 6179 6572 3d6c 6179 6572 293a 0a20 2020  ayer=layer):.   
+000086a0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+000086b0: 706f 6e65 6e74 2e61 6464 2870 6174 6829  ponent.add(path)
+000086c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000086d0: 2063 6f6d 706f 6e65 6e74 0a0a 2020 2020   component..    
+000086e0: 6465 6620 6164 645f 706f 6c79 676f 6e28  def add_polygon(
+000086f0: 0a20 2020 2020 2020 2073 656c 662c 2070  .        self, p
+00008700: 6f69 6e74 732c 206c 6179 6572 3a20 7374  oints, layer: st
+00008710: 7220 7c20 696e 7420 7c20 7475 706c 655b  r | int | tuple[
+00008720: 696e 742c 2069 6e74 5d20 7c20 6e70 2e6e  int, int] | np.n
+00008730: 616e 203d 206e 702e 6e61 6e0a 2020 2020  an = np.nan.    
+00008740: 2920 2d3e 2050 6f6c 7967 6f6e 3a0a 2020  ) -> Polygon:.  
+00008750: 2020 2020 2020 2222 2241 6464 7320 6120        """Adds a 
+00008760: 506f 6c79 676f 6e20 746f 2074 6865 2043  Polygon to the C
+00008770: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
+00008780: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00008790: 2020 2020 2070 6f69 6e74 733a 2043 6f6f       points: Coo
+000087a0: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
+000087b0: 7665 7274 6963 6573 206f 6620 7468 6520  vertices of the 
+000087c0: 506f 6c79 676f 6e2e 0a20 2020 2020 2020  Polygon..       
+000087d0: 2020 2020 206c 6179 6572 3a20 6c61 7965       layer: laye
+000087e0: 7220 7370 6563 2074 6f20 6164 6420 706f  r spec to add po
+000087f0: 6c79 676f 6e20 6f6e 2e0a 2020 2020 2020  lygon on..      
+00008800: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00008810: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
+00008820: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
+00008830: 6572 0a0a 2020 2020 2020 2020 6966 206c  er..        if l
+00008840: 6179 6572 2069 7320 4e6f 6e65 3a0a 2020  ayer is None:.  
+00008850: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00008860: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+00008870: 6966 2069 7369 6e73 7461 6e63 6528 6c61  if isinstance(la
+00008880: 7965 722c 2073 6574 293a 0a20 2020 2020  yer, set):.     
+00008890: 2020 2020 2020 2070 6f6c 7967 6f6e 7320         polygons 
+000088a0: 3d20 5b73 656c 662e 6164 645f 706f 6c79  = [self.add_poly
+000088b0: 676f 6e28 706f 696e 7473 2c20 6c79 2920  gon(points, ly) 
+000088c0: 666f 7220 6c79 2069 6e20 6c61 7965 725d  for ly in layer]
+000088d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000088e0: 7572 6e20 706f 6c79 676f 6e73 5b30 5d0a  urn polygons[0].
+000088f0: 0a20 2020 2020 2020 206c 6179 6572 203d  .        layer =
+00008900: 2067 6574 5f6c 6179 6572 286c 6179 6572   get_layer(layer
+00008910: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
+00008920: 6e73 7461 6e63 6528 706f 696e 7473 2c20  nstance(points, 
+00008930: 6764 7374 6b2e 506f 6c79 676f 6e29 3a0a  gdstk.Polygon):.
+00008940: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+00008950: 206c 6179 6572 2069 7320 756e 7370 6563   layer is unspec
+00008960: 6966 6965 6420 6f72 206d 6174 6368 6573  ified or matches
+00008970: 206f 7269 6769 6e61 6c20 706f 6c79 676f   original polygo
+00008980: 6e2c 206a 7573 7420 6164 6420 6974 2061  n, just add it a
+00008990: 732d 6973 0a20 2020 2020 2020 2020 2020  s-is.           
+000089a0: 2070 6f6c 7967 6f6e 203d 2070 6f69 6e74   polygon = point
+000089b0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
+000089c0: 206c 6179 6572 2069 7320 6e70 2e6e 616e   layer is np.nan
+000089d0: 206f 7220 280a 2020 2020 2020 2020 2020   or (.          
+000089e0: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
+000089f0: 286c 6179 6572 2c20 7475 706c 6529 2061  (layer, tuple) a
+00008a00: 6e64 2028 706f 6c79 676f 6e2e 6c61 7965  nd (polygon.laye
+00008a10: 722c 2070 6f6c 7967 6f6e 2e64 6174 6174  r, polygon.datat
+00008a20: 7970 6529 203d 3d20 6c61 7965 720a 2020  ype) == layer.  
+00008a30: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00008a40: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
+00008a50: 7967 6f6e 203d 2050 6f6c 7967 6f6e 2870  ygon = Polygon(p
+00008a60: 6f6c 7967 6f6e 2e70 6f69 6e74 732c 2028  olygon.points, (
+00008a70: 706f 6c79 676f 6e2e 6c61 7965 722c 2070  polygon.layer, p
+00008a80: 6f6c 7967 6f6e 2e64 6174 6174 7970 6529  olygon.datatype)
+00008a90: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00008aa0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00008ab0: 2020 2020 6c61 7965 722c 2064 6174 6174      layer, datat
+00008ac0: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
+00008ad0: 6572 286c 6179 6572 290a 2020 2020 2020  er(layer).      
+00008ae0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
+00008af0: 6e20 3d20 506f 6c79 676f 6e28 706f 6c79  n = Polygon(poly
+00008b00: 676f 6e2e 706f 696e 7473 2c20 286c 6179  gon.points, (lay
+00008b10: 6572 2c20 6461 7461 7479 7065 2929 0a0a  er, datatype))..
+00008b20: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00008b30: 6173 6174 7472 2870 6f69 6e74 732c 2022  asattr(points, "
+00008b40: 7072 6f70 6572 7469 6573 2229 3a0a 2020  properties"):.  
+00008b50: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00008b60: 6c79 676f 6e2e 7072 6f70 6572 7469 6573  lygon.properties
+00008b70: 203d 2064 6565 7063 6f70 7928 706f 696e   = deepcopy(poin
+00008b80: 7473 2e70 726f 7065 7274 6965 7329 0a0a  ts.properties)..
+00008b90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008ba0: 2e5f 6164 645f 706f 6c79 676f 6e73 2870  ._add_polygons(p
+00008bb0: 6f6c 7967 6f6e 290a 2020 2020 2020 2020  olygon).        
+00008bc0: 2020 2020 7265 7475 726e 2070 6f6c 7967      return polyg
+00008bd0: 6f6e 0a0a 2020 2020 2020 2020 656c 6966  on..        elif
+00008be0: 2068 6173 6174 7472 2870 6f69 6e74 732c   hasattr(points,
+00008bf0: 2022 6765 6f6d 7322 293a 0a20 2020 2020   "geoms"):.     
+00008c00: 2020 2020 2020 2066 6f72 2067 656f 6d20         for geom 
+00008c10: 696e 2070 6f69 6e74 732e 6765 6f6d 733a  in points.geoms:
+00008c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008c30: 2070 6f6c 7967 6f6e 203d 2073 656c 662e   polygon = self.
+00008c40: 6164 645f 706f 6c79 676f 6e28 6765 6f6d  add_polygon(geom
+00008c50: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
+00008c60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00008c70: 6e20 706f 6c79 676f 6e0a 2020 2020 2020  n polygon.      
+00008c80: 2020 656c 6966 2068 6173 6174 7472 2870    elif hasattr(p
+00008c90: 6f69 6e74 732c 2022 6578 7465 7269 6f72  oints, "exterior
+00008ca0: 2229 3a20 2023 2070 6f69 6e74 7320 6973  "):  # points is
+00008cb0: 2061 2073 6861 7065 6c79 2050 6f6c 7967   a shapely Polyg
+00008cc0: 6f6e 0a20 2020 2020 2020 2020 2020 206c  on.            l
+00008cd0: 6179 6572 2c20 6461 7461 7479 7065 203d  ayer, datatype =
+00008ce0: 205f 7061 7273 655f 6c61 7965 7228 6c61   _parse_layer(la
+00008cf0: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
+00008d00: 2070 6f69 6e74 735f 6f6e 5f67 7269 6420   points_on_grid 
+00008d10: 3d20 6e70 2e72 6f75 6e64 2870 6f69 6e74  = np.round(point
+00008d20: 732e 6578 7465 7269 6f72 2e63 6f6f 7264  s.exterior.coord
+00008d30: 732c 2033 290a 2020 2020 2020 2020 2020  s, 3).          
+00008d40: 2020 706f 6c79 676f 6e20 3d20 506f 6c79    polygon = Poly
+00008d50: 676f 6e28 706f 696e 7473 5f6f 6e5f 6772  gon(points_on_gr
+00008d60: 6964 2c20 286c 6179 6572 2c20 6461 7461  id, (layer, data
+00008d70: 7479 7065 2929 0a0a 2020 2020 2020 2020  type))..        
+00008d80: 2020 2020 6966 2070 6f69 6e74 732e 696e      if points.in
+00008d90: 7465 7269 6f72 733a 0a20 2020 2020 2020  teriors:.       
+00008da0: 2020 2020 2020 2020 2066 726f 6d20 7368           from sh
+00008db0: 6170 656c 7920 696d 706f 7274 2067 6574  apely import get
+00008dc0: 5f63 6f6f 7264 696e 6174 6573 0a0a 2020  _coordinates..  
+00008dd0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00008de0: 696e 7473 5f6f 6e5f 6772 6964 5f69 6e74  ints_on_grid_int
+00008df0: 6572 696f 7220 3d20 6e70 2e72 6f75 6e64  erior = np.round
+00008e00: 2867 6574 5f63 6f6f 7264 696e 6174 6573  (get_coordinates
+00008e10: 2870 6f69 6e74 732e 696e 7465 7269 6f72  (points.interior
+00008e20: 7329 2c20 3329 0a20 2020 2020 2020 2020  s), 3).         
+00008e30: 2020 2020 2020 2070 6f6c 7967 6f6e 5f69         polygon_i
+00008e40: 6e74 6572 696f 7220 3d20 506f 6c79 676f  nterior = Polygo
+00008e50: 6e28 706f 696e 7473 5f6f 6e5f 6772 6964  n(points_on_grid
+00008e60: 5f69 6e74 6572 696f 722c 2028 6c61 7965  _interior, (laye
+00008e70: 722c 2064 6174 6174 7970 6529 290a 2020  r, datatype)).  
+00008e80: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00008e90: 6c79 676f 6e73 203d 2067 6473 746b 2e62  lygons = gdstk.b
+00008ea0: 6f6f 6c65 616e 280a 2020 2020 2020 2020  oolean(.        
+00008eb0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
+00008ec0: 676f 6e2c 0a20 2020 2020 2020 2020 2020  gon,.           
+00008ed0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00008ee0: 5f69 6e74 6572 696f 722c 0a20 2020 2020  _interior,.     
+00008ef0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00008f00: 7065 7261 7469 6f6e 3d22 6e6f 7422 2c0a  peration="not",.
+00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f20: 2020 2020 6c61 7965 723d 6c61 7965 722c      layer=layer,
+00008f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008f40: 2020 2020 2064 6174 6174 7970 653d 6461       datatype=da
+00008f50: 7461 7479 7065 2c0a 2020 2020 2020 2020  tatype,.        
+00008f60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00008f70: 2020 2020 2020 2020 2020 666f 7220 706f            for po
+00008f80: 6c79 676f 6e20 696e 2070 6f6c 7967 6f6e  lygon in polygon
+00008f90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00008fa0: 2020 2020 2020 2073 656c 662e 5f61 6464         self._add
+00008fb0: 5f70 6f6c 7967 6f6e 7328 706f 6c79 676f  _polygons(polygo
+00008fc0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+00008fd0: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
+00008fe0: 6e0a 0a20 2020 2020 2020 2020 2020 2073  n..            s
+00008ff0: 656c 662e 5f61 6464 5f70 6f6c 7967 6f6e  elf._add_polygon
+00009000: 7328 706f 6c79 676f 6e29 0a20 2020 2020  s(polygon).     
+00009010: 2020 2020 2020 2072 6574 7572 6e20 706f         return po
+00009020: 6c79 676f 6e0a 0a20 2020 2020 2020 2070  lygon..        p
+00009030: 6f69 6e74 7320 3d20 6e70 2e61 7361 7272  oints = np.asarr
+00009040: 6179 2870 6f69 6e74 7329 0a20 2020 2020  ay(points).     
+00009050: 2020 2069 6620 706f 696e 7473 2e6e 6469     if points.ndi
+00009060: 6d20 3d3d 2031 3a0a 2020 2020 2020 2020  m == 1:.        
+00009070: 2020 2020 7265 7475 726e 205b 7365 6c66      return [self
+00009080: 2e61 6464 5f70 6f6c 7967 6f6e 2870 6f6c  .add_polygon(pol
+00009090: 792c 206c 6179 6572 3d6c 6179 6572 2920  y, layer=layer) 
+000090a0: 666f 7220 706f 6c79 2069 6e20 706f 696e  for poly in poin
+000090b0: 7473 5d0a 2020 2020 2020 2020 6966 206c  ts].        if l
+000090c0: 6179 6572 2069 7320 6e70 2e6e 616e 3a0a  ayer is np.nan:.
+000090d0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+000090e0: 7220 3d20 300a 0a20 2020 2020 2020 2069  r = 0..        i
+000090f0: 6620 706f 696e 7473 2e6e 6469 6d20 3d3d  f points.ndim ==
+00009100: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00009110: 2320 6164 6420 7369 6e67 6c65 2070 6f6c  # add single pol
+00009120: 7967 6f6e 2066 726f 6d20 706f 696e 7473  ygon from points
+00009130: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009140: 6c65 6e28 706f 696e 7473 5b30 5d29 203e  len(points[0]) >
+00009150: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00009160: 2020 2020 2320 436f 6e76 6572 7420 746f      # Convert to
+00009170: 2066 6f72 6d20 5b5b 312c 325d 2c5b 332c   form [[1,2],[3,
+00009180: 345d 2c5b 352c 365d 5d0a 2020 2020 2020  4],[5,6]].      
+00009190: 2020 2020 2020 2020 2020 706f 696e 7473            points
+000091a0: 203d 206e 702e 636f 6c75 6d6e 5f73 7461   = np.column_sta
+000091b0: 636b 2870 6f69 6e74 7329 0a20 2020 2020  ck(points).     
+000091c0: 2020 2020 2020 206c 6179 6572 2c20 6461         layer, da
+000091d0: 7461 7479 7065 203d 205f 7061 7273 655f  tatype = _parse_
+000091e0: 6c61 7965 7228 6c61 7965 7229 0a20 2020  layer(layer).   
+000091f0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00009200: 203d 2050 6f6c 7967 6f6e 2870 6f69 6e74   = Polygon(point
+00009210: 732c 2028 6c61 7965 722c 2064 6174 6174  s, (layer, datat
+00009220: 7970 6529 290a 2020 2020 2020 2020 2020  ype)).          
+00009230: 2020 7365 6c66 2e5f 6164 645f 706f 6c79    self._add_poly
+00009240: 676f 6e73 2870 6f6c 7967 6f6e 290a 2020  gons(polygon).  
+00009250: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00009260: 2070 6f6c 7967 6f6e 0a20 2020 2020 2020   polygon.       
+00009270: 2065 6c69 6620 706f 696e 7473 2e6e 6469   elif points.ndi
+00009280: 6d20 3d3d 2033 3a0a 2020 2020 2020 2020  m == 3:.        
+00009290: 2020 2020 6c61 7965 722c 2064 6174 6174      layer, datat
+000092a0: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
+000092b0: 6572 286c 6179 6572 290a 2020 2020 2020  er(layer).      
+000092c0: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
+000092d0: 205b 506f 6c79 676f 6e28 7070 6f69 6e74   [Polygon(ppoint
+000092e0: 732c 2028 6c61 7965 722c 2064 6174 6174  s, (layer, datat
+000092f0: 7970 6529 2920 666f 7220 7070 6f69 6e74  ype)) for ppoint
+00009300: 7320 696e 2070 6f69 6e74 735d 0a20 2020  s in points].   
+00009310: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
+00009320: 6464 5f70 6f6c 7967 6f6e 7328 2a70 6f6c  dd_polygons(*pol
+00009330: 7967 6f6e 7329 0a20 2020 2020 2020 2020  ygons).         
+00009340: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
+00009350: 6e73 0a20 2020 2020 2020 2065 6c73 653a  ns.        else:
+00009360: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00009370: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+00009380: 556e 6162 6c65 2074 6f20 6164 6420 7b70  Unable to add {p
+00009390: 6f69 6e74 732e 6e64 696d 7d2d 6469 6d65  oints.ndim}-dime
+000093a0: 6e73 696f 6e61 6c20 706f 696e 7473 206f  nsional points o
+000093b0: 626a 6563 7422 290a 0a20 2020 2064 6566  bject")..    def
+000093c0: 205f 6164 645f 706f 6c79 676f 6e73 2873   _add_polygons(s
+000093d0: 656c 662c 202a 706f 6c79 676f 6e73 3a20  elf, *polygons: 
+000093e0: 6c69 7374 5b50 6f6c 7967 6f6e 5d29 202d  list[Polygon]) -
+000093f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00009400: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
+00009410: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+00009420: 5f63 656c 6c2e 6164 6428 2a70 6f6c 7967  _cell.add(*polyg
+00009430: 6f6e 7329 0a0a 2020 2020 6465 6620 636f  ons)..    def co
+00009440: 7079 2873 656c 6629 202d 3e20 436f 6d70  py(self) -> Comp
+00009450: 6f6e 656e 743a 0a20 2020 2020 2020 2072  onent:.        r
+00009460: 6574 7572 6e20 636f 7079 2873 656c 6629  eturn copy(self)
+00009470: 0a0a 2020 2020 6465 6620 6164 645f 7265  ..    def add_re
+00009480: 665f 636f 6e74 6169 6e65 7228 7365 6c66  f_container(self
+00009490: 2c20 636f 6d70 6f6e 656e 743a 2043 6f6d  , component: Com
+000094a0: 706f 6e65 6e74 2920 2d3e 2043 6f6d 706f  ponent) -> Compo
+000094b0: 6e65 6e74 5265 6665 7265 6e63 653a 0a20  nentReference:. 
+000094c0: 2020 2020 2020 2022 2222 4164 6420 7265         """Add re
+000094d0: 6665 7265 6e63 652c 2070 6f72 7473 2061  ference, ports a
+000094e0: 6e64 2063 6f70 795f 6368 696c 645f 696e  nd copy_child_in
+000094f0: 666f 2e22 2222 0a20 2020 2020 2020 2072  fo.""".        r
+00009500: 6566 203d 2073 656c 6620 3c3c 2063 6f6d  ef = self << com
+00009510: 706f 6e65 6e74 0a20 2020 2020 2020 2073  ponent.        s
+00009520: 656c 662e 6164 645f 706f 7274 7328 7265  elf.add_ports(re
+00009530: 662e 706f 7274 7329 0a20 2020 2020 2020  f.ports).       
+00009540: 2073 656c 662e 636f 7079 5f63 6869 6c64   self.copy_child
+00009550: 5f69 6e66 6f28 636f 6d70 6f6e 656e 7429  _info(component)
+00009560: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00009570: 7265 660a 0a20 2020 2064 6566 2063 6f70  ref..    def cop
+00009580: 795f 6368 696c 645f 696e 666f 2873 656c  y_child_info(sel
+00009590: 662c 2063 6f6d 706f 6e65 6e74 3a20 436f  f, component: Co
+000095a0: 6d70 6f6e 656e 7429 202d 3e20 4e6f 6e65  mponent) -> None
+000095b0: 3a0a 2020 2020 2020 2020 2222 2243 6f70  :.        """Cop
+000095c0: 7920 616e 6420 7365 7474 696e 6773 2069  y and settings i
+000095d0: 6e66 6f20 6672 6f6d 2063 6869 6c64 2063  nfo from child c
+000095e0: 6f6d 706f 6e65 6e74 2069 6e74 6f20 7061  omponent into pa
+000095f0: 7265 6e74 2e0a 0a20 2020 2020 2020 2050  rent...        P
+00009600: 6172 656e 7420 636f 6d70 6f6e 656e 7473  arent components
+00009610: 2063 616e 2061 6363 6573 7320 6368 696c   can access chil
+00009620: 6420 6365 6c6c 7320 7365 7474 696e 6773  d cells settings
+00009630: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00009640: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+00009650: 6e73 7461 6e63 6528 636f 6d70 6f6e 656e  nstance(componen
+00009660: 742c 2043 6f6d 706f 6e65 6e74 207c 2043  t, Component | C
+00009670: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00009680: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00009690: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000096a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000096b0: 2020 6622 7b74 7970 6528 636f 6d70 6f6e    f"{type(compon
+000096c0: 656e 7429 7d22 2022 6973 206e 6f74 2061  ent)}" "is not a
+000096d0: 2043 6f6d 706f 6e65 6e74 206f 7220 436f   Component or Co
+000096e0: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
+000096f0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00009700: 0a20 2020 2020 2020 2073 656c 662e 5f67  .        self._g
+00009710: 6574 5f63 6869 6c64 5f6e 616d 6520 3d20  et_child_name = 
+00009720: 5472 7565 0a20 2020 2020 2020 2073 656c  True.        sel
+00009730: 662e 6368 696c 6420 3d20 636f 6d70 6f6e  f.child = compon
+00009740: 656e 740a 2020 2020 2020 2020 7365 6c66  ent.        self
+00009750: 2e69 6e66 6f2e 7570 6461 7465 2863 6f6d  .info.update(com
+00009760: 706f 6e65 6e74 2e69 6e66 6f29 0a20 2020  ponent.info).   
+00009770: 2020 2020 2073 656c 662e 7365 7474 696e       self.settin
+00009780: 6773 2e75 7064 6174 6528 636f 6d70 6f6e  gs.update(compon
+00009790: 656e 742e 7365 7474 696e 6773 290a 0a20  ent.settings).. 
+000097a0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+000097b0: 2064 6566 2073 697a 655f 696e 666f 2873   def size_info(s
+000097c0: 656c 6629 202d 3e20 5369 7a65 496e 666f  elf) -> SizeInfo
+000097d0: 3a0a 2020 2020 2020 2020 2222 2253 697a  :.        """Siz
+000097e0: 6520 696e 666f 206f 6620 7468 6520 636f  e info of the co
+000097f0: 6d70 6f6e 656e 742e 2222 220a 2020 2020  mponent.""".    
+00009800: 2020 2020 7265 7475 726e 2053 697a 6549      return SizeI
+00009810: 6e66 6f28 7365 6c66 2e62 626f 7829 0a0a  nfo(self.bbox)..
+00009820: 2020 2020 6465 6620 6765 745f 7365 7474      def get_sett
+00009830: 696e 6728 7365 6c66 2c20 7365 7474 696e  ing(self, settin
+00009840: 673a 2073 7472 2920 2d3e 2073 7472 207c  g: str) -> str |
+00009850: 2069 6e74 207c 2066 6c6f 6174 3a0a 2020   int | float:.  
+00009860: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+00009870: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009880: 696e 666f 2e67 6574 2873 6574 7469 6e67  info.get(setting
+00009890: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+000098a0: 2073 656c 662e 7365 7474 696e 6773 2e66   self.settings.f
+000098b0: 756c 6c2e 6765 7428 7365 7474 696e 6729  ull.get(setting)
+000098c0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+000098d0: 7365 6c66 2e6d 6574 6164 6174 615f 6368  self.metadata_ch
+000098e0: 696c 642e 6765 7428 7365 7474 696e 6729  ild.get(setting)
+000098f0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00009900: 6465 6620 6973 5f75 6e6c 6f63 6b65 6428  def is_unlocked(
+00009910: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00009920: 2020 2020 2020 2022 2222 5261 6973 6573         """Raises
+00009930: 2065 7272 6f72 2069 6620 436f 6d70 6f6e   error if Compon
+00009940: 656e 7420 6973 206c 6f63 6b65 642e 2222  ent is locked.""
+00009950: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
+00009960: 662e 5f6c 6f63 6b65 643a 0a20 2020 2020  f._locked:.     
+00009970: 2020 2020 2020 2072 6169 7365 204d 7574         raise Mut
+00009980: 6162 696c 6974 7945 7272 6f72 280a 2020  abilityError(.  
+00009990: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+000099a0: 436f 6d70 6f6e 656e 7420 7b73 656c 662e  Component {self.
+000099b0: 6e61 6d65 2172 7d20 6361 6e6e 6f74 2062  name!r} cannot b
+000099c0: 6520 6d6f 6469 6669 6564 2061 7320 6974  e modified as it
+000099d0: 2773 2061 6c72 6561 6479 206f 6e20 6361  's already on ca
+000099e0: 6368 652e 2022 0a20 2020 2020 2020 2020  che. ".         
+000099f0: 2020 2020 2020 202b 206d 7574 6162 696c         + mutabil
+00009a00: 6974 795f 6572 726f 725f 6d65 7373 6167  ity_error_messag
+00009a10: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
+00009a20: 0a20 2020 2064 6566 205f 6164 6428 7365  .    def _add(se
+00009a30: 6c66 2c20 656c 656d 656e 7429 202d 3e20  lf, element) -> 
+00009a40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00009a50: 2241 6464 2061 206e 6577 2065 6c65 6d65  "Add a new eleme
+00009a60: 6e74 206f 7220 6c69 7374 206f 6620 656c  nt or list of el
+00009a70: 656d 656e 7473 2074 6f20 7468 6973 2043  ements to this C
+00009a80: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
+00009a90: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00009aa0: 2020 2020 2065 6c65 6d65 6e74 3a20 506f       element: Po
+00009ab0: 6c79 676f 6e2c 2043 6f6d 706f 6e65 6e74  lygon, Component
+00009ac0: 5265 6665 7265 6e63 6520 6f72 2069 7465  Reference or ite
+00009ad0: 7261 626c 650a 2020 2020 2020 2020 2020  rable.          
+00009ae0: 2020 2020 2020 5468 6520 656c 656d 656e        The elemen
+00009af0: 7420 6f72 2069 7465 7261 626c 6520 6f66  t or iterable of
+00009b00: 2065 6c65 6d65 6e74 7320 746f 2062 6520   elements to be 
+00009b10: 696e 7365 7274 6564 2069 6e20 7468 6973  inserted in this
+00009b20: 2063 656c 6c2e 0a0a 2020 2020 2020 2020   cell...        
+00009b30: 5261 6973 6573 3a0a 2020 2020 2020 2020  Raises:.        
+00009b40: 2020 2020 4d75 7461 6269 6c69 7479 4572      MutabilityEr
+00009b50: 726f 723a 2069 6620 636f 6d70 6f6e 656e  ror: if componen
+00009b60: 7420 6973 206c 6f63 6b65 642e 0a20 2020  t is locked..   
+00009b70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00009b80: 2073 656c 662e 6973 5f75 6e6c 6f63 6b65   self.is_unlocke
+00009b90: 6428 290a 2020 2020 2020 2020 6966 2069  d().        if i
+00009ba0: 7369 6e73 7461 6e63 6528 656c 656d 656e  sinstance(elemen
+00009bb0: 742c 2043 6f6d 706f 6e65 6e74 5265 6665  t, ComponentRefe
+00009bc0: 7265 6e63 6529 3a0a 2020 2020 2020 2020  rence):.        
+00009bd0: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e61      self._cell.a
+00009be0: 6464 2865 6c65 6d65 6e74 2e5f 7265 6665  dd(element._refe
+00009bf0: 7265 6e63 6529 0a20 2020 2020 2020 2020  rence).         
+00009c00: 2020 2073 656c 662e 5f72 6566 6572 656e     self._referen
+00009c10: 6365 732e 6170 7065 6e64 2865 6c65 6d65  ces.append(eleme
+00009c20: 6e74 290a 2020 2020 2020 2020 656c 7365  nt).        else
+00009c30: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00009c40: 6c66 2e5f 6365 6c6c 2e61 6464 2865 6c65  lf._cell.add(ele
+00009c50: 6d65 6e74 290a 0a20 2020 2064 6566 2061  ment)..    def a
+00009c60: 6464 2873 656c 662c 2065 6c65 6d65 6e74  dd(self, element
+00009c70: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00009c80: 2020 2022 2222 4164 6420 6120 6e65 7720     """Add a new 
+00009c90: 656c 656d 656e 7420 6f72 206c 6973 7420  element or list 
+00009ca0: 6f66 2065 6c65 6d65 6e74 7320 746f 2074  of elements to t
+00009cb0: 6869 7320 436f 6d70 6f6e 656e 742e 0a0a  his Component...
+00009cc0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00009cd0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
+00009ce0: 743a 2050 6f6c 7967 6f6e 2c20 436f 6d70  t: Polygon, Comp
+00009cf0: 6f6e 656e 7452 6566 6572 656e 6365 206f  onentReference o
+00009d00: 7220 6974 6572 6162 6c65 0a20 2020 2020  r iterable.     
+00009d10: 2020 2020 2020 2020 2020 2054 6865 2065             The e
+00009d20: 6c65 6d65 6e74 206f 7220 6974 6572 6162  lement or iterab
+00009d30: 6c65 206f 6620 656c 656d 656e 7473 2074  le of elements t
+00009d40: 6f20 6265 2069 6e73 6572 7465 6420 696e  o be inserted in
+00009d50: 2074 6869 7320 6365 6c6c 2e0a 0a20 2020   this cell...   
+00009d60: 2020 2020 2052 6169 7365 733a 0a20 2020       Raises:.   
+00009d70: 2020 2020 2020 2020 204d 7574 6162 696c           Mutabil
+00009d80: 6974 7945 7272 6f72 3a20 6966 2063 6f6d  ityError: if com
+00009d90: 706f 6e65 6e74 2069 7320 6c6f 636b 6564  ponent is locked
+00009da0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00009db0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00009dc0: 6e63 6528 656c 656d 656e 742c 2043 6f6d  nce(element, Com
+00009dd0: 706f 6e65 6e74 5265 6665 7265 6e63 6529  ponentReference)
+00009de0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00009df0: 6c66 2e5f 7265 6769 7374 6572 5f72 6566  lf._register_ref
+00009e00: 6572 656e 6365 2865 6c65 6d65 6e74 290a  erence(element).
+00009e10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009e20: 2e5f 6164 6428 656c 656d 656e 7429 0a20  ._add(element). 
+00009e30: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+00009e40: 7374 616e 6365 2865 6c65 6d65 6e74 2c20  stance(element, 
+00009e50: 4974 6572 6162 6c65 293a 0a20 2020 2020  Iterable):.     
+00009e60: 2020 2020 2020 2066 6f72 2073 7562 656c         for subel
+00009e70: 656d 656e 7420 696e 2065 6c65 6d65 6e74  ement in element
+00009e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009e90: 2020 7365 6c66 2e61 6464 2873 7562 656c    self.add(subel
+00009ea0: 656d 656e 7429 0a20 2020 2020 2020 2065  ement).        e
+00009eb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00009ec0: 2073 656c 662e 5f61 6464 2865 6c65 6d65   self._add(eleme
+00009ed0: 6e74 290a 0a20 2020 2064 6566 2061 6464  nt)..    def add
+00009ee0: 5f61 7272 6179 280a 2020 2020 2020 2020  _array(.        
+00009ef0: 7365 6c66 2c0a 2020 2020 2020 2020 636f  self,.        co
+00009f00: 6d70 6f6e 656e 743a 2043 6f6d 706f 6e65  mponent: Compone
+00009f10: 6e74 2c0a 2020 2020 2020 2020 636f 6c75  nt,.        colu
+00009f20: 6d6e 733a 2069 6e74 203d 2032 2c0a 2020  mns: int = 2,.  
+00009f30: 2020 2020 2020 726f 7773 3a20 696e 7420        rows: int 
+00009f40: 3d20 322c 0a20 2020 2020 2020 2073 7061  = 2,.        spa
+00009f50: 6369 6e67 3a20 7475 706c 655b 666c 6f61  cing: tuple[floa
+00009f60: 742c 2066 6c6f 6174 5d20 3d20 2831 3030  t, float] = (100
+00009f70: 2c20 3130 3029 2c0a 2020 2020 2020 2020  , 100),.        
+00009f80: 616c 6961 733a 2073 7472 207c 204e 6f6e  alias: str | Non
+00009f90: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2920  e = None,.    ) 
+00009fa0: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
+00009fb0: 7265 6e63 653a 0a20 2020 2020 2020 2022  rence:.        "
+00009fc0: 2222 4372 6561 7465 7320 6120 436f 6d70  ""Creates a Comp
+00009fd0: 6f6e 656e 7452 6566 6572 656e 6365 2072  onentReference r
+00009fe0: 6566 6572 656e 6365 2074 6f20 6120 436f  eference to a Co
+00009ff0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+0000a000: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000a010: 2020 2020 636f 6d70 6f6e 656e 743a 2054      component: T
+0000a020: 6865 2072 6566 6572 656e 6365 6420 636f  he referenced co
+0000a030: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
+0000a040: 2020 2020 2063 6f6c 756d 6e73 3a20 4e75       columns: Nu
+0000a050: 6d62 6572 206f 6620 636f 6c75 6d6e 7320  mber of columns 
+0000a060: 696e 2074 6865 2061 7272 6179 2e0a 2020  in the array..  
+0000a070: 2020 2020 2020 2020 2020 726f 7773 3a20            rows: 
+0000a080: 4e75 6d62 6572 206f 6620 726f 7773 2069  Number of rows i
+0000a090: 6e20 7468 6520 6172 7261 792e 0a20 2020  n the array..   
+0000a0a0: 2020 2020 2020 2020 2073 7061 6369 6e67           spacing
+0000a0b0: 3a20 6172 7261 792d 6c69 6b65 5b32 5d20  : array-like[2] 
+0000a0c0: 6f66 2069 6e74 206f 7220 666c 6f61 742e  of int or float.
+0000a0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a0e0: 2044 6973 7461 6e63 6520 6265 7477 6565   Distance betwee
+0000a0f0: 6e20 6164 6a61 6365 6e74 2063 6f6c 756d  n adjacent colum
+0000a100: 6e73 2061 6e64 2061 646a 6163 656e 7420  ns and adjacent 
+0000a110: 726f 7773 2e0a 2020 2020 2020 2020 2020  rows..          
+0000a120: 2020 616c 6961 733a 2073 7472 206f 7220    alias: str or 
+0000a130: 4e6f 6e65 2e20 416c 6961 7320 6f66 2074  None. Alias of t
+0000a140: 6865 2072 6566 6572 656e 6365 6420 436f  he referenced Co
+0000a150: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
+0000a160: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0000a170: 2020 2020 2020 613a 2043 6f6d 706f 6e65        a: Compone
+0000a180: 6e74 5265 6665 7265 6e63 6520 636f 6e74  ntReference cont
+0000a190: 6169 6e69 6e67 2072 6566 6572 656e 6365  aining reference
+0000a1a0: 7320 746f 2074 6865 2043 6f6d 706f 6e65  s to the Compone
+0000a1b0: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
+0000a1c0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0000a1d0: 7369 6e73 7461 6e63 6528 636f 6d70 6f6e  sinstance(compon
+0000a1e0: 656e 742c 2043 6f6d 706f 6e65 6e74 293a  ent, Component):
+0000a1f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000a200: 7365 2054 7970 6545 7272 6f72 2822 6164  se TypeError("ad
+0000a210: 645f 6172 7261 7928 2920 6e65 6564 7320  d_array() needs 
+0000a220: 6120 436f 6d70 6f6e 656e 7420 6f62 6a65  a Component obje
+0000a230: 6374 2e22 290a 2020 2020 2020 2020 7265  ct.").        re
+0000a240: 6620 3d20 436f 6d70 6f6e 656e 7452 6566  f = ComponentRef
+0000a250: 6572 656e 6365 280a 2020 2020 2020 2020  erence(.        
+0000a260: 2020 2020 636f 6d70 6f6e 656e 743d 636f      component=co
+0000a270: 6d70 6f6e 656e 742c 0a20 2020 2020 2020  mponent,.       
+0000a280: 2020 2020 2063 6f6c 756d 6e73 3d69 6e74       columns=int
+0000a290: 2872 6f75 6e64 2863 6f6c 756d 6e73 2929  (round(columns))
+0000a2a0: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
+0000a2b0: 7773 3d69 6e74 2872 6f75 6e64 2872 6f77  ws=int(round(row
+0000a2c0: 7329 292c 0a20 2020 2020 2020 2020 2020  s)),.           
+0000a2d0: 2073 7061 6369 6e67 3d73 7061 6369 6e67   spacing=spacing
+0000a2e0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+0000a2f0: 2020 2020 7265 662e 6e61 6d65 203d 204e      ref.name = N
+0000a300: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+0000a310: 2e5f 6164 6428 7265 6629 0a20 2020 2020  ._add(ref).     
+0000a320: 2020 2073 656c 662e 5f72 6567 6973 7465     self._registe
+0000a330: 725f 7265 6665 7265 6e63 6528 7265 6665  r_reference(refe
+0000a340: 7265 6e63 653d 7265 662c 2061 6c69 6173  rence=ref, alias
+0000a350: 3d61 6c69 6173 290a 2020 2020 2020 2020  =alias).        
+0000a360: 7265 7475 726e 2072 6566 0a0a 2020 2020  return ref..    
+0000a370: 6465 6620 6469 7374 7269 6275 7465 280a  def distribute(.
+0000a380: 2020 2020 2020 2020 7365 6c66 2c20 656c          self, el
+0000a390: 656d 656e 7473 3d22 616c 6c22 2c20 6469  ements="all", di
+0000a3a0: 7265 6374 696f 6e3d 2278 222c 2073 7061  rection="x", spa
+0000a3b0: 6369 6e67 3d31 3030 2c20 7365 7061 7261  cing=100, separa
+0000a3c0: 7469 6f6e 3d54 7275 652c 2065 6467 653d  tion=True, edge=
+0000a3d0: 2263 656e 7465 7222 0a20 2020 2029 3a0a  "center".    ):.
+0000a3e0: 2020 2020 2020 2020 2222 2244 6973 7472          """Distr
+0000a3f0: 6962 7574 6573 2074 6865 2073 7065 6369  ibutes the speci
+0000a400: 6669 6564 2065 6c65 6d65 6e74 7320 696e  fied elements in
+0000a410: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
+0000a420: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+0000a430: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
+0000a440: 6e74 7320 3a20 6172 7261 792d 6c69 6b65  nts : array-like
+0000a450: 206f 6620 6f62 6a65 6374 7320 6f72 2027   of objects or '
+0000a460: 616c 6c27 0a20 2020 2020 2020 2020 2020  all'.           
+0000a470: 2020 2020 2045 6c65 6d65 6e74 7320 746f       Elements to
+0000a480: 2064 6973 7472 6962 7574 652e 0a20 2020   distribute..   
+0000a490: 2020 2020 2020 2020 2064 6972 6563 7469           directi
+0000a4a0: 6f6e 203a 207b 2778 272c 2027 7927 7d0a  on : {'x', 'y'}.
+0000a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4c0: 4469 7265 6374 696f 6e20 6f66 2064 6973  Direction of dis
+0000a4d0: 7472 6962 7574 696f 6e3b 2065 6974 6865  tribution; eithe
+0000a4e0: 7220 6120 6c69 6e65 2069 6e20 7468 6520  r a line in the 
+0000a4f0: 782d 6469 7265 6374 696f 6e20 6f72 0a20  x-direction or. 
+0000a500: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0000a510: 2d64 6972 6563 7469 6f6e 2e0a 2020 2020  -direction..    
+0000a520: 2020 2020 2020 2020 7370 6163 696e 6720          spacing 
+0000a530: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
+0000a540: 2020 2020 2020 2020 2020 2020 2020 2044                 D
+0000a550: 6973 7461 6e63 6520 6265 7477 6565 6e20  istance between 
+0000a560: 656c 656d 656e 7473 2e0a 2020 2020 2020  elements..      
+0000a570: 2020 2020 2020 7365 7061 7261 7469 6f6e        separation
+0000a580: 203a 2062 6f6f 6c0a 2020 2020 2020 2020   : bool.        
+0000a590: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0000a5a0: 2067 7561 7261 6e74 6565 7320 656c 656d   guarantees elem
+0000a5b0: 656e 7473 2061 7265 2073 6570 6172 6174  ents are separat
+0000a5c0: 6564 2077 6974 6820 6120 6669 7865 6420  ed with a fixed 
+0000a5d0: 7370 6163 696e 670a 2020 2020 2020 2020  spacing.        
+0000a5e0: 2020 2020 2020 2020 6265 7477 6565 6e3b          between;
+0000a5f0: 2069 6620 2046 616c 7365 2c20 656c 656d   if  False, elem
+0000a600: 656e 7473 2061 7265 2073 7061 6365 6420  ents are spaced 
+0000a610: 6576 656e 6c79 2061 6c6f 6e67 2061 2067  evenly along a g
+0000a620: 7269 642e 0a20 2020 2020 2020 2020 2020  rid..           
+0000a630: 2065 6467 6520 3a20 7b27 7827 2c20 2778   edge : {'x', 'x
+0000a640: 6d69 6e27 2c20 2778 6d61 7827 2c20 2779  min', 'xmax', 'y
+0000a650: 272c 2027 796d 696e 272c 2027 796d 6178  ', 'ymin', 'ymax
+0000a660: 277d 0a20 2020 2020 2020 2020 2020 2020  '}.             
+0000a670: 2020 2057 6869 6368 2065 6467 6520 746f     Which edge to
+0000a680: 2070 6572 666f 726d 2074 6865 2064 6973   perform the dis
+0000a690: 7472 6962 7574 696f 6e20 616c 6f6e 6720  tribution along 
+0000a6a0: 2875 6e75 7365 6420 6966 0a20 2020 2020  (unused if.     
+0000a6b0: 2020 2020 2020 2020 2020 2073 6570 6172             separ
+0000a6c0: 6174 696f 6e20 3d3d 2054 7275 6529 0a0a  ation == True)..
+0000a6d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000a6e0: 2020 2020 6966 2065 6c65 6d65 6e74 7320      if elements 
+0000a6f0: 3d3d 2022 616c 6c22 3a0a 2020 2020 2020  == "all":.      
+0000a700: 2020 2020 2020 656c 656d 656e 7473 203d        elements =
+0000a710: 2073 656c 662e 706f 6c79 676f 6e73 202b   self.polygons +
+0000a720: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
+0000a730: 0a20 2020 2020 2020 205f 6469 7374 7269  .        _distri
+0000a740: 6275 7465 280a 2020 2020 2020 2020 2020  bute(.          
+0000a750: 2020 656c 656d 656e 7473 3d65 6c65 6d65    elements=eleme
+0000a760: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
+0000a770: 2064 6972 6563 7469 6f6e 3d64 6972 6563   direction=direc
+0000a780: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+0000a790: 2020 7370 6163 696e 673d 7370 6163 696e    spacing=spacin
+0000a7a0: 672c 0a20 2020 2020 2020 2020 2020 2073  g,.            s
+0000a7b0: 6570 6172 6174 696f 6e3d 7365 7061 7261  eparation=separa
+0000a7c0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+0000a7d0: 2020 6564 6765 3d65 6467 652c 0a20 2020    edge=edge,.   
+0000a7e0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+0000a7f0: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
+0000a800: 6465 6620 616c 6967 6e28 7365 6c66 2c20  def align(self, 
+0000a810: 656c 656d 656e 7473 3d22 616c 6c22 2c20  elements="all", 
+0000a820: 616c 6967 6e6d 656e 743d 2279 6d61 7822  alignment="ymax"
+0000a830: 293a 0a20 2020 2020 2020 2022 2222 416c  ):.        """Al
+0000a840: 6967 6e20 656c 656d 656e 7473 2069 6e20  ign elements in 
+0000a850: 7468 6520 436f 6d70 6f6e 656e 742e 0a0a  the Component...
+0000a860: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+0000a870: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
+0000a880: 7473 203a 2061 7272 6179 2d6c 696b 6520  ts : array-like 
+0000a890: 6f66 206f 626a 6563 7473 2c20 6f72 2027  of objects, or '
+0000a8a0: 616c 6c27 0a20 2020 2020 2020 2020 2020  all'.           
+0000a8b0: 2020 2020 2045 6c65 6d65 6e74 7320 696e       Elements in
+0000a8c0: 2074 6865 2043 6f6d 706f 6e65 6e74 2074   the Component t
+0000a8d0: 6f20 616c 6967 6e2e 0a20 2020 2020 2020  o align..       
+0000a8e0: 2020 2020 2061 6c69 676e 6d65 6e74 203a       alignment :
+0000a8f0: 207b 2778 272c 2027 7927 2c20 2778 6d69   {'x', 'y', 'xmi
+0000a900: 6e27 2c20 2778 6d61 7827 2c20 2779 6d69  n', 'xmax', 'ymi
+0000a910: 6e27 2c20 2779 6d61 7827 7d0a 2020 2020  n', 'ymax'}.    
+0000a920: 2020 2020 2020 2020 2020 2020 5768 6963              Whic
+0000a930: 6820 6564 6765 2074 6f20 616c 6967 6e20  h edge to align 
+0000a940: 616c 6f6e 6720 2865 2e67 2e20 2779 6d61  along (e.g. 'yma
+0000a950: 7827 2077 696c 6c20 6d6f 7665 2074 6865  x' will move the
+0000a960: 2065 6c65 6d65 6e74 7320 7375 6368 0a20   elements such. 
+0000a970: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000a980: 6861 7420 616c 6c20 6f66 2074 6865 6972  hat all of their
+0000a990: 2074 6f70 6d6f 7374 2070 6f69 6e74 7320   topmost points 
+0000a9a0: 6172 6520 616c 6967 6e65 6429 2e0a 2020  are aligned)..  
+0000a9b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000a9c0: 2020 6966 2065 6c65 6d65 6e74 7320 3d3d    if elements ==
+0000a9d0: 2022 616c 6c22 3a0a 2020 2020 2020 2020   "all":.        
+0000a9e0: 2020 2020 656c 656d 656e 7473 203d 2073      elements = s
+0000a9f0: 656c 662e 706f 6c79 676f 6e73 202b 2073  elf.polygons + s
+0000aa00: 656c 662e 7265 6665 7265 6e63 6573 0a20  elf.references. 
+0000aa10: 2020 2020 2020 205f 616c 6967 6e28 656c         _align(el
+0000aa20: 656d 656e 7473 2c20 616c 6967 6e6d 656e  ements, alignmen
+0000aa30: 743d 616c 6967 6e6d 656e 7429 0a20 2020  t=alignment).   
+0000aa40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000aa50: 0a0a 2020 2020 6465 6620 666c 6174 7465  ..    def flatte
+0000aa60: 6e28 7365 6c66 2c20 7369 6e67 6c65 5f6c  n(self, single_l
+0000aa70: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
+0000aa80: 7c20 4e6f 6e65 203d 204e 6f6e 6529 3a0a  | None = None):.
+0000aa90: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0000aaa0: 6e73 2061 2066 6c61 7474 656e 6564 2063  ns a flattened c
+0000aab0: 6f70 7920 6f66 2074 6865 2063 6f6d 706f  opy of the compo
+0000aac0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2046  nent...        F
+0000aad0: 6c61 7474 656e 7320 7468 6520 6869 6572  lattens the hier
+0000aae0: 6172 6368 7920 6f66 2074 6865 2043 6f6d  archy of the Com
+0000aaf0: 706f 6e65 6e74 2073 7563 6820 7468 6174  ponent such that
+0000ab00: 2074 6865 7265 2061 7265 206e 6f20 6c6f   there are no lo
+0000ab10: 6e67 6572 0a20 2020 2020 2020 2061 6e79  nger.        any
+0000ab20: 2072 6566 6572 656e 6365 7320 746f 206f   references to o
+0000ab30: 7468 6572 2043 6f6d 706f 6e65 6e74 732e  ther Components.
+0000ab40: 2041 6c6c 2070 6f6c 7967 6f6e 7320 616e   All polygons an
+0000ab50: 6420 6c61 6265 6c73 2066 726f 6d0a 2020  d labels from.  
+0000ab60: 2020 2020 2020 756e 6465 726c 7969 6e67        underlying
+0000ab70: 2072 6566 6572 656e 6365 7320 6172 6520   references are 
+0000ab80: 636f 7069 6564 2061 6e64 2070 6c61 6365  copied and place
+0000ab90: 6420 696e 2074 6865 2074 6f70 2d6c 6576  d in the top-lev
+0000aba0: 656c 2043 6f6d 706f 6e65 6e74 2e0a 2020  el Component..  
+0000abb0: 2020 2020 2020 4966 2073 696e 676c 655f        If single_
+0000abc0: 6c61 7965 7220 6973 2073 7065 6369 6669  layer is specifi
+0000abd0: 6564 2c20 616c 6c20 706f 6c79 676f 6e73  ed, all polygons
+0000abe0: 2061 7265 206d 6f76 6564 2074 6f20 7468   are moved to th
+0000abf0: 6174 206c 6179 6572 2e0a 0a20 2020 2020  at layer...     
+0000ac00: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000ac10: 2020 2020 2073 696e 676c 655f 6c61 7965       single_laye
+0000ac20: 723a 206d 6f76 6520 616c 6c20 706f 6c79  r: move all poly
+0000ac30: 676f 6e73 2061 7265 206d 6f76 6564 2074  gons are moved t
+0000ac40: 6f20 7468 6520 7370 6563 6966 6965 6420  o the specified 
+0000ac50: 286f 7074 696f 6e61 6c29 2e0a 2020 2020  (optional)..    
+0000ac60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ac70: 636f 6d70 6f6e 656e 745f 666c 6174 203d  component_flat =
+0000ac80: 2043 6f6d 706f 6e65 6e74 2829 0a0a 2020   Component()..  
+0000ac90: 2020 2020 2020 5f63 656c 6c20 3d20 7365        _cell = se
+0000aca0: 6c66 2e5f 6365 6c6c 2e63 6f70 7928 6e61  lf._cell.copy(na
+0000acb0: 6d65 3d63 6f6d 706f 6e65 6e74 5f66 6c61  me=component_fla
+0000acc0: 742e 6e61 6d65 290a 2020 2020 2020 2020  t.name).        
+0000acd0: 5f63 656c 6c20 3d20 5f63 656c 6c2e 666c  _cell = _cell.fl
+0000ace0: 6174 7465 6e28 290a 2020 2020 2020 2020  atten().        
+0000acf0: 636f 6d70 6f6e 656e 745f 666c 6174 2e5f  component_flat._
+0000ad00: 6365 6c6c 203d 205f 6365 6c6c 0a20 2020  cell = _cell.   
+0000ad10: 2020 2020 2069 6620 7369 6e67 6c65 5f6c       if single_l
+0000ad20: 6179 6572 2069 7320 6e6f 7420 4e6f 6e65  ayer is not None
+0000ad30: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
+0000ad40: 6f6d 2067 6473 6661 6374 6f72 7920 696d  om gdsfactory im
+0000ad50: 706f 7274 2067 6574 5f6c 6179 6572 0a0a  port get_layer..
+0000ad60: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000ad70: 722c 2064 6174 6174 7970 6520 3d20 6765  r, datatype = ge
+0000ad80: 745f 6c61 7965 7228 7369 6e67 6c65 5f6c  t_layer(single_l
+0000ad90: 6179 6572 290a 2020 2020 2020 2020 2020  ayer).          
+0000ada0: 2020 666f 7220 706f 6c79 676f 6e20 696e    for polygon in
+0000adb0: 205f 6365 6c6c 2e70 6f6c 7967 6f6e 733a   _cell.polygons:
+0000adc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000add0: 2070 6f6c 7967 6f6e 2e6c 6179 6572 203d   polygon.layer =
+0000ade0: 206c 6179 6572 0a20 2020 2020 2020 2020   layer.         
+0000adf0: 2020 2020 2020 2070 6f6c 7967 6f6e 2e64         polygon.d
+0000ae00: 6174 6174 7970 6520 3d20 6461 7461 7479  atatype = dataty
+0000ae10: 7065 0a20 2020 2020 2020 2020 2020 2066  pe.            f
+0000ae20: 6f72 2070 6174 6820 696e 205f 6365 6c6c  or path in _cell
+0000ae30: 2e70 6174 6873 3a0a 2020 2020 2020 2020  .paths:.        
+0000ae40: 2020 2020 2020 2020 7061 7468 2e73 6574          path.set
+0000ae50: 5f6c 6179 6572 7328 6c61 7965 7229 0a20  _layers(layer). 
+0000ae60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000ae70: 6174 682e 7365 745f 6461 7461 7479 7065  ath.set_datatype
+0000ae80: 7328 6461 7461 7479 7065 290a 0a20 2020  s(datatype)..   
+0000ae90: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
+0000aea0: 6c61 742e 696e 666f 203d 2073 656c 662e  lat.info = self.
+0000aeb0: 696e 666f 2e63 6f70 7928 290a 2020 2020  info.copy().    
+0000aec0: 2020 2020 636f 6d70 6f6e 656e 745f 666c      component_fl
+0000aed0: 6174 2e61 6464 5f70 6f72 7473 2873 656c  at.add_ports(sel
+0000aee0: 662e 706f 7274 7329 0a20 2020 2020 2020  f.ports).       
+0000aef0: 2072 6574 7572 6e20 636f 6d70 6f6e 656e   return componen
+0000af00: 745f 666c 6174 0a0a 2020 2020 6465 6620  t_flat..    def 
+0000af10: 666c 6174 7465 6e5f 7265 6665 7265 6e63  flatten_referenc
+0000af20: 6528 7365 6c66 2c20 7265 663a 2043 6f6d  e(self, ref: Com
+0000af30: 706f 6e65 6e74 5265 6665 7265 6e63 6529  ponentReference)
+0000af40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000af50: 2020 2222 2246 726f 6d20 6578 6973 7469    """From existi
+0000af60: 6e67 2063 656c 6c20 7265 706c 6163 6573  ng cell replaces
+0000af70: 2072 6566 6572 656e 6365 2077 6974 6820   reference with 
+0000af80: 6120 666c 6174 7465 6e20 7265 6665 7265  a flatten refere
+0000af90: 6e63 6520 5c0a 2020 2020 2020 2020 7768  nce \.        wh
+0000afa0: 6963 6820 6861 7320 7468 6520 7472 616e  ich has the tran
+0000afb0: 7366 6f72 6d61 7469 6f6e 7320 616c 7265  sformations alre
+0000afc0: 6164 7920 6170 706c 6965 642e 0a0a 2020  ady applied...  
+0000afd0: 2020 2020 2020 5472 616e 7366 6f72 6d65        Transforme
+0000afe0: 6420 7265 6665 7265 6e63 6520 6b65 6570  d reference keep
+0000aff0: 7320 7468 6520 6f72 6967 696e 616c 206e  s the original n
+0000b000: 616d 652e 0a0a 2020 2020 2020 2020 4172  ame...        Ar
+0000b010: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000b020: 7265 663a 2074 6865 2072 6566 6572 656e  ref: the referen
+0000b030: 6365 2074 6f20 666c 6174 7465 6e20 696e  ce to flatten in
+0000b040: 746f 2061 206e 6577 2063 656c 6c2e 0a0a  to a new cell...
+0000b050: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000b060: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+0000b070: 6f72 792e 6675 6e63 7469 6f6e 7320 696d  ory.functions im
+0000b080: 706f 7274 2074 7261 6e73 666f 726d 6564  port transformed
+0000b090: 0a0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+0000b0a0: 656d 6f76 6528 7265 6629 0a20 2020 2020  emove(ref).     
+0000b0b0: 2020 206e 6577 5f63 6f6d 706f 6e65 6e74     new_component
+0000b0c0: 203d 2074 7261 6e73 666f 726d 6564 2872   = transformed(r
+0000b0d0: 6566 2c20 6465 636f 7261 746f 723d 4e6f  ef, decorator=No
+0000b0e0: 6e65 290a 2020 2020 2020 2020 7365 6c66  ne).        self
+0000b0f0: 2e61 6464 5f72 6566 286e 6577 5f63 6f6d  .add_ref(new_com
+0000b100: 706f 6e65 6e74 2c20 616c 6961 733d 7265  ponent, alias=re
+0000b110: 662e 6e61 6d65 290a 0a20 2020 2064 6566  f.name)..    def
+0000b120: 2061 6464 5f72 6566 280a 2020 2020 2020   add_ref(.      
+0000b130: 2020 7365 6c66 2c20 636f 6d70 6f6e 656e    self, componen
+0000b140: 743a 2043 6f6d 706f 6e65 6e74 2c20 616c  t: Component, al
+0000b150: 6961 733a 2073 7472 207c 204e 6f6e 6520  ias: str | None 
+0000b160: 3d20 4e6f 6e65 2c20 2a2a 6b77 6172 6773  = None, **kwargs
+0000b170: 0a20 2020 2029 202d 3e20 436f 6d70 6f6e  .    ) -> Compon
+0000b180: 656e 7452 6566 6572 656e 6365 3a0a 2020  entReference:.  
+0000b190: 2020 2020 2020 2222 2241 6464 2043 6f6d        """Add Com
+0000b1a0: 706f 6e65 6e74 5265 6665 7265 6e63 6520  ponentReference 
+0000b1b0: 746f 2074 6865 2063 7572 7265 6e74 2043  to the current C
+0000b1c0: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
+0000b1d0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000b1e0: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
+0000b1f0: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
+0000b200: 2020 2020 2020 2061 6c69 6173 3a20 6e61         alias: na
+0000b210: 6d65 645f 7265 6665 7265 6e63 6573 2e0a  med_references..
+0000b220: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+0000b230: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+0000b240: 2020 2063 6f6c 756d 6e73 3a20 4e75 6d62     columns: Numb
+0000b250: 6572 206f 6620 636f 6c75 6d6e 7320 696e  er of columns in
+0000b260: 2074 6865 2061 7272 6179 2e0a 2020 2020   the array..    
+0000b270: 2020 2020 2020 2020 726f 7773 3a20 4e75          rows: Nu
+0000b280: 6d62 6572 206f 6620 726f 7773 2069 6e20  mber of rows in 
+0000b290: 7468 6520 6172 7261 792e 0a20 2020 2020  the array..     
+0000b2a0: 2020 2020 2020 2073 7061 6369 6e67 3a20         spacing: 
+0000b2b0: 4469 7374 616e 6365 7320 6265 7477 6565  Distances betwee
+0000b2c0: 6e20 6164 6a61 6365 6e74 2063 6f6c 756d  n adjacent colum
+0000b2d0: 6e73 2061 6e64 2061 646a 6163 656e 7420  ns and adjacent 
+0000b2e0: 726f 7773 2e0a 2020 2020 2020 2020 2020  rows..          
+0000b2f0: 2020 6f72 6967 696e 3a20 6172 7261 792d    origin: array-
+0000b300: 6c69 6b65 5b32 5d20 6f66 2069 6e74 206f  like[2] of int o
+0000b310: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+0000b320: 2020 2020 2020 2020 506f 7369 7469 6f6e          Position
+0000b330: 2077 6865 7265 2074 6865 2063 656c 6c20   where the cell 
+0000b340: 6973 2069 6e73 6572 7465 642e 0a20 2020  is inserted..   
+0000b350: 2020 2020 2020 2020 2072 6f74 6174 696f           rotatio
+0000b360: 6e20 3a20 696e 7420 6f72 2066 6c6f 6174  n : int or float
+0000b370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b380: 2041 6e67 6c65 206f 6620 726f 7461 7469   Angle of rotati
+0000b390: 6f6e 206f 6620 7468 6520 7265 6665 7265  on of the refere
+0000b3a0: 6e63 6520 2869 6e20 6064 6567 7265 6573  nce (in `degrees
+0000b3b0: 6029 2e0a 2020 2020 2020 2020 2020 2020  `)..            
+0000b3c0: 6d61 676e 6966 6963 6174 696f 6e20 3a20  magnification : 
+0000b3d0: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
+0000b3e0: 2020 2020 2020 2020 2020 2020 204d 6167               Mag
+0000b3f0: 6e69 6669 6361 7469 6f6e 2066 6163 746f  nification facto
+0000b400: 7220 666f 7220 7468 6520 7265 6665 7265  r for the refere
+0000b410: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+0000b420: 2078 5f72 6566 6c65 6374 696f 6e20 3a20   x_reflection : 
+0000b430: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
+0000b440: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
+0000b450: 6520 7265 6665 7265 6e63 6520 6973 2072  e reference is r
+0000b460: 6566 6c65 6374 6564 2070 6172 616c 6c65  eflected paralle
+0000b470: 6c20 746f 2074 6865 2078 2064 6972 6563  l to the x direc
+0000b480: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+0000b490: 2020 2020 2062 6566 6f72 6520 6265 696e       before bein
+0000b4a0: 6720 726f 7461 7465 642e 0a20 2020 2020  g rotated..     
+0000b4b0: 2020 2020 2020 206e 616d 6520 3a20 7374         name : st
+0000b4c0: 7220 286f 7074 696f 6e61 6c29 0a20 2020  r (optional).   
+0000b4d0: 2020 2020 2020 2020 2020 2020 2041 206e               A n
+0000b4e0: 616d 6520 666f 7220 7468 6520 7265 6665  ame for the refe
+0000b4f0: 7265 6e63 6520 2869 6620 7072 6f76 6964  rence (if provid
+0000b500: 6564 292e 0a0a 2020 2020 2020 2020 2222  ed)...        ""
+0000b510: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+0000b520: 2069 7369 6e73 7461 6e63 6528 636f 6d70   isinstance(comp
+0000b530: 6f6e 656e 742c 2043 6f6d 706f 6e65 6e74  onent, Component
+0000b540: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000b550: 6169 7365 2054 7970 6545 7272 6f72 2866  aise TypeError(f
+0000b560: 2274 7970 6520 3d20 7b74 7970 6528 436f  "type = {type(Co
+0000b570: 6d70 6f6e 656e 7429 7d20 6e65 6564 7320  mponent)} needs 
+0000b580: 746f 2062 6520 6120 436f 6d70 6f6e 656e  to be a Componen
+0000b590: 742e 2229 0a20 2020 2020 2020 2072 6566  t.").        ref
+0000b5a0: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
+0000b5b0: 7265 6e63 6528 636f 6d70 6f6e 656e 742c  rence(component,
+0000b5c0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+0000b5d0: 2020 2073 656c 662e 5f61 6464 2872 6566     self._add(ref
+0000b5e0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+0000b5f0: 7265 6769 7374 6572 5f72 6566 6572 656e  register_referen
+0000b600: 6365 2872 6566 6572 656e 6365 3d72 6566  ce(reference=ref
+0000b610: 2c20 616c 6961 733d 616c 6961 7329 0a20  , alias=alias). 
+0000b620: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000b630: 660a 0a20 2020 2064 6566 205f 7265 6769  f..    def _regi
+0000b640: 7374 6572 5f72 6566 6572 656e 6365 280a  ster_reference(.
+0000b650: 2020 2020 2020 2020 7365 6c66 2c20 7265          self, re
+0000b660: 6665 7265 6e63 653a 2043 6f6d 706f 6e65  ference: Compone
+0000b670: 6e74 5265 6665 7265 6e63 652c 2061 6c69  ntReference, ali
+0000b680: 6173 3a20 7374 7220 7c20 4e6f 6e65 203d  as: str | None =
+0000b690: 204e 6f6e 650a 2020 2020 2920 2d3e 204e   None.    ) -> N
+0000b6a0: 6f6e 653a 0a20 2020 2020 2020 2063 6f6d  one:.        com
+0000b6b0: 706f 6e65 6e74 203d 2072 6566 6572 656e  ponent = referen
+0000b6c0: 6365 2e70 6172 656e 740a 2020 2020 2020  ce.parent.      
+0000b6d0: 2020 7265 6665 7265 6e63 652e 6f77 6e65    reference.owne
+0000b6e0: 7220 3d20 7365 6c66 0a0a 2020 2020 2020  r = self..      
+0000b6f0: 2020 6966 2061 6c69 6173 2069 7320 4e6f    if alias is No
+0000b700: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000b710: 6966 2072 6566 6572 656e 6365 2e6e 616d  if reference.nam
+0000b720: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0000b730: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000b740: 6c69 6173 203d 2072 6566 6572 656e 6365  lias = reference
+0000b750: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
+0000b760: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000b770: 2020 2020 2020 2020 7072 6566 6978 203d          prefix =
+0000b780: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000b790: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000b7a0: 2e73 6574 7469 6e67 732e 6675 6e63 7469  .settings.functi
+0000b7b0: 6f6e 5f6e 616d 650a 2020 2020 2020 2020  on_name.        
+0000b7c0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+0000b7d0: 6173 6174 7472 2863 6f6d 706f 6e65 6e74  asattr(component
+0000b7e0: 2c20 2273 6574 7469 6e67 7322 290a 2020  , "settings").  
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 2020 616e 6420 6861 7361 7474 7228 636f    and hasattr(co
+0000b810: 6d70 6f6e 656e 742e 7365 7474 696e 6773  mponent.settings
+0000b820: 2c20 2266 756e 6374 696f 6e5f 6e61 6d65  , "function_name
+0000b830: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000b840: 2020 2020 2020 2065 6c73 6520 636f 6d70         else comp
+0000b850: 6f6e 656e 742e 6e61 6d65 0a20 2020 2020  onent.name.     
+0000b860: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000b870: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000b880: 662e 5f72 6566 6572 656e 6365 5f6e 616d  f._reference_nam
+0000b890: 6573 5f63 6f75 6e74 6572 2e75 7064 6174  es_counter.updat
+0000b8a0: 6528 7b70 7265 6669 783a 2031 7d29 0a20  e({prefix: 1}). 
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000b8c0: 6c69 6173 203d 2066 227b 7072 6566 6978  lias = f"{prefix
+0000b8d0: 7d5f 7b73 656c 662e 5f72 6566 6572 656e  }_{self._referen
+0000b8e0: 6365 5f6e 616d 6573 5f63 6f75 6e74 6572  ce_names_counter
+0000b8f0: 5b70 7265 6669 785d 7d22 0a0a 2020 2020  [prefix]}"..    
+0000b900: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+0000b910: 6520 616c 6961 7320 696e 2073 656c 662e  e alias in self.
+0000b920: 5f6e 616d 6564 5f72 6566 6572 656e 6365  _named_reference
+0000b930: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000b940: 2020 2020 2020 2073 656c 662e 5f72 6566         self._ref
+0000b950: 6572 656e 6365 5f6e 616d 6573 5f63 6f75  erence_names_cou
+0000b960: 6e74 6572 2e75 7064 6174 6528 7b70 7265  nter.update({pre
+0000b970: 6669 783a 2031 7d29 0a20 2020 2020 2020  fix: 1}).       
+0000b980: 2020 2020 2020 2020 2020 2020 2061 6c69               ali
+0000b990: 6173 203d 2066 227b 7072 6566 6978 7d5f  as = f"{prefix}_
+0000b9a0: 7b73 656c 662e 5f72 6566 6572 656e 6365  {self._reference
+0000b9b0: 5f6e 616d 6573 5f63 6f75 6e74 6572 5b70  _names_counter[p
+0000b9c0: 7265 6669 785d 7d22 0a0a 2020 2020 2020  refix]}"..      
+0000b9d0: 2020 7265 6665 7265 6e63 652e 6e61 6d65    reference.name
+0000b9e0: 203d 2061 6c69 6173 0a20 2020 2020 2020   = alias.       
+0000b9f0: 2073 656c 662e 5f6e 616d 6564 5f72 6566   self._named_ref
+0000ba00: 6572 656e 6365 735b 616c 6961 735d 203d  erences[alias] =
+0000ba10: 2072 6566 6572 656e 6365 0a0a 2020 2020   reference..    
+0000ba20: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+0000ba30: 6620 6c61 7965 7273 2873 656c 6629 202d  f layers(self) -
+0000ba40: 3e20 7365 745b 7475 706c 655b 696e 742c  > set[tuple[int,
+0000ba50: 2069 6e74 5d5d 3a0a 2020 2020 2020 2020   int]]:.        
+0000ba60: 2222 2252 6574 7572 6e73 2061 2073 6574  """Returns a set
+0000ba70: 206f 6620 7468 6520 4c61 7965 7273 2069   of the Layers i
+0000ba80: 6e20 7468 6520 436f 6d70 6f6e 656e 742e  n the Component.
+0000ba90: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000baa0: 726e 2073 656c 662e 6765 745f 6c61 7965  rn self.get_laye
+0000bab0: 7273 2829 0a0a 2020 2020 6465 6620 6765  rs()..    def ge
+0000bac0: 745f 6c61 7965 7273 2873 656c 6629 202d  t_layers(self) -
+0000bad0: 3e20 7365 745b 7475 706c 655b 696e 742c  > set[tuple[int,
+0000bae0: 2069 6e74 5d5d 3a0a 2020 2020 2020 2020   int]]:.        
+0000baf0: 2222 2252 6574 7572 6e20 6120 7365 7420  """Return a set 
+0000bb00: 6f66 2028 6c61 7965 722c 2064 6174 6174  of (layer, datat
+0000bb10: 7970 6529 2e0a 0a20 2020 2020 2020 202e  ype)...        .
+0000bb20: 2e20 636f 6465 203a 3a0a 0a20 2020 2020  . code ::..     
+0000bb30: 2020 2020 2020 2069 6d70 6f72 7420 6764         import gd
+0000bb40: 7366 6163 746f 7279 2061 7320 6766 0a20  sfactory as gf. 
+0000bb50: 2020 2020 2020 2020 2020 2067 662e 636f             gf.co
+0000bb60: 6d70 6f6e 656e 7473 2e73 7472 6169 6768  mponents.straigh
+0000bb70: 7428 292e 6765 745f 6c61 7965 7273 2829  t().get_layers()
+0000bb80: 203d 3d20 7b28 312c 2030 292c 2028 3131   == {(1, 0), (11
+0000bb90: 312c 2030 297d 0a20 2020 2020 2020 2022  1, 0)}.        "
+0000bba0: 2222 0a20 2020 2020 2020 2070 6f6c 7967  "".        polyg
+0000bbb0: 6f6e 7320 3d20 7365 6c66 2e5f 6365 6c6c  ons = self._cell
+0000bbc0: 2e67 6574 5f70 6f6c 7967 6f6e 7328 6465  .get_polygons(de
+0000bbd0: 7074 683d 4e6f 6e65 290a 2020 2020 2020  pth=None).      
+0000bbe0: 2020 7265 7475 726e 207b 2870 6f6c 7967    return {(polyg
+0000bbf0: 6f6e 2e6c 6179 6572 2c20 706f 6c79 676f  on.layer, polygo
+0000bc00: 6e2e 6461 7461 7479 7065 2920 666f 7220  n.datatype) for 
+0000bc10: 706f 6c79 676f 6e20 696e 2070 6f6c 7967  polygon in polyg
+0000bc20: 6f6e 737d 0a0a 2020 2020 6465 6620 6765  ons}..    def ge
+0000bc30: 745f 6c61 7965 725f 6e61 6d65 7328 7365  t_layer_names(se
+0000bc40: 6c66 2920 2d3e 206c 6973 745b 7475 706c  lf) -> list[tupl
+0000bc50: 655b 696e 742c 2069 6e74 5d5d 3a0a 2020  e[int, int]]:.  
+0000bc60: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0000bc70: 6c61 7965 7220 6e61 6d65 7320 7573 6564  layer names used
+0000bc80: 2069 6e20 7468 6520 6465 7369 676e 2e0a   in the design..
+0000bc90: 0a20 2020 2020 2020 202e 2e20 636f 6465  .        .. code
+0000bca0: 203a 3a0a 0a20 2020 2020 2020 2020 2020   ::..           
+0000bcb0: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
+0000bcc0: 7279 2061 7320 6766 0a20 2020 2020 2020  ry as gf.       
+0000bcd0: 2020 2020 2067 662e 636f 6d70 6f6e 656e       gf.componen
+0000bce0: 7473 2e73 7472 6169 6768 7428 292e 6765  ts.straight().ge
+0000bcf0: 745f 6e61 6d65 7328 2920 3d3d 205b 2757  t_names() == ['W
+0000bd00: 4727 5d0a 2020 2020 2020 2020 2222 220a  G'].        """.
+0000bd10: 2020 2020 2020 2020 696d 706f 7274 2067          import g
+0000bd20: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
+0000bd30: 0a20 2020 2020 2020 2050 444b 203d 2067  .        PDK = g
+0000bd40: 662e 6765 745f 6163 7469 7665 5f70 646b  f.get_active_pdk
+0000bd50: 2829 0a20 2020 2020 2020 204c 4159 4552  ().        LAYER
+0000bd60: 5320 3d20 5044 4b2e 6c61 7965 7273 0a20  S = PDK.layers. 
+0000bd70: 2020 2020 2020 206e 616d 655f 746f 5f6c         name_to_l
+0000bd80: 6179 6572 203d 2064 6963 7428 4c41 5945  ayer = dict(LAYE
+0000bd90: 5253 290a 2020 2020 2020 2020 6c61 7965  RS).        laye
+0000bda0: 725f 746f 5f6e 616d 6520 3d20 7b76 3a20  r_to_name = {v: 
+0000bdb0: 6b20 666f 7220 6b2c 2076 2069 6e20 6e61  k for k, v in na
+0000bdc0: 6d65 5f74 6f5f 6c61 7965 722e 6974 656d  me_to_layer.item
+0000bdd0: 7328 297d 0a20 2020 2020 2020 206c 6179  s()}.        lay
+0000bde0: 6572 5f6e 616d 6573 203d 205b 5d0a 0a20  er_names = [].. 
+0000bdf0: 2020 2020 2020 2066 6f72 206c 6179 6572         for layer
+0000be00: 2069 6e20 7365 6c66 2e6c 6179 6572 733a   in self.layers:
+0000be10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000be20: 6c61 7965 7220 6e6f 7420 696e 206c 6179  layer not in lay
+0000be30: 6572 5f74 6f5f 6e61 6d65 3a0a 2020 2020  er_to_name:.    
+0000be40: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0000be50: 696e 6773 2e77 6172 6e28 6622 7b6c 6179  ings.warn(f"{lay
+0000be60: 6572 7d20 6e6f 7420 696e 204c 6179 6572  er} not in Layer
+0000be70: 4d61 702e 222c 2073 7461 636b 6c65 7665  Map.", stackleve
+0000be80: 6c3d 3329 0a20 2020 2020 2020 2020 2020  l=3).           
+0000be90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000bea0: 2020 2020 2020 206c 6179 6572 5f6e 616d         layer_nam
+0000beb0: 6573 2e61 7070 656e 6428 6c61 7965 725f  es.append(layer_
+0000bec0: 746f 5f6e 616d 655b 6c61 7965 725d 290a  to_name[layer]).
+0000bed0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0000bee0: 6179 6572 5f6e 616d 6573 0a0a 2020 2020  ayer_names..    
+0000bef0: 6465 6620 5f69 7079 7468 6f6e 5f64 6973  def _ipython_dis
+0000bf00: 706c 6179 5f28 7365 6c66 2920 2d3e 204e  play_(self) -> N
+0000bf10: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000bf20: 5368 6f77 2067 656f 6d65 7472 7920 696e  Show geometry in
+0000bf30: 204b 4c61 796f 7574 2061 6e64 2069 6e20   KLayout and in 
+0000bf40: 6d61 7470 6c6f 746c 6962 2066 6f72 204a  matplotlib for J
+0000bf50: 7570 7974 6572 204e 6f74 6562 6f6f 6b73  upyter Notebooks
+0000bf60: 2e22 2222 0a20 2020 2020 2020 2073 656c  .""".        sel
+0000bf70: 662e 7368 6f77 2873 686f 775f 706f 7274  f.show(show_port
+0000bf80: 733d 5472 7565 2920 2023 2073 686f 7720  s=True)  # show 
+0000bf90: 696e 206b 6c61 796f 7574 0a20 2020 2020  in klayout.     
+0000bfa0: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
+0000bfb0: 6c6f 7428 290a 0a20 2020 2064 6566 2061  lot()..    def a
+0000bfc0: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
+0000bfd0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000bfe0: 2020 2020 2020 2020 706f 7274 5f6d 6172          port_mar
+0000bff0: 6b65 725f 6c61 7965 723a 204c 6179 6572  ker_layer: Layer
+0000c000: 203d 2028 312c 2031 3029 2c0a 2020 2020   = (1, 10),.    
+0000c010: 2020 2020 6c61 7965 725f 6c61 6265 6c3a      layer_label:
+0000c020: 204c 6179 6572 203d 2028 312c 2031 3029   Layer = (1, 10)
+0000c030: 2c0a 2020 2020 2920 2d3e 2043 6f6d 706f  ,.    ) -> Compo
+0000c040: 6e65 6e74 3a0a 2020 2020 2020 2020 2222  nent:.        ""
+0000c050: 2252 6574 7572 6e73 2063 6f6d 706f 6e65  "Returns compone
+0000c060: 6e74 2077 6974 6820 7472 6961 6e67 756c  nt with triangul
+0000c070: 6172 2070 696e 732e 2222 220a 2020 2020  ar pins.""".    
+0000c080: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+0000c090: 6f72 792e 6164 645f 7069 6e73 2069 6d70  ory.add_pins imp
+0000c0a0: 6f72 7420 6164 645f 7069 6e73 5f74 7269  ort add_pins_tri
+0000c0b0: 616e 676c 650a 0a20 2020 2020 2020 2063  angle..        c
+0000c0c0: 6f6d 706f 6e65 6e74 203d 2073 656c 662e  omponent = self.
+0000c0d0: 636f 7079 2829 0a20 2020 2020 2020 2063  copy().        c
+0000c0e0: 6f6d 706f 6e65 6e74 2e6e 616d 6520 3d20  omponent.name = 
+0000c0f0: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
+0000c100: 2020 6164 645f 7069 6e73 5f74 7269 616e    add_pins_trian
+0000c110: 676c 6528 0a20 2020 2020 2020 2020 2020  gle(.           
+0000c120: 2063 6f6d 706f 6e65 6e74 3d63 6f6d 706f   component=compo
+0000c130: 6e65 6e74 2c20 6c61 7965 723d 706f 7274  nent, layer=port
+0000c140: 5f6d 6172 6b65 725f 6c61 7965 722c 206c  _marker_layer, l
+0000c150: 6179 6572 5f6c 6162 656c 3d6c 6179 6572  ayer_label=layer
+0000c160: 5f6c 6162 656c 0a20 2020 2020 2020 2029  _label.        )
+0000c170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c180: 636f 6d70 6f6e 656e 740a 0a20 2020 2064  component..    d
+0000c190: 6566 2070 6c6f 745f 7769 6467 6574 280a  ef plot_widget(.
+0000c1a0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0000c1b0: 2020 2020 2020 7368 6f77 5f70 6f72 7473        show_ports
+0000c1c0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+0000c1d0: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
+0000c1e0: 6572 5f6c 6179 6572 3a20 4c61 7965 7220  er_layer: Layer 
+0000c1f0: 3d20 2831 2c20 3130 292c 0a20 2020 2029  = (1, 10),.    )
+0000c200: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000c210: 2020 2222 2252 6574 7572 6e73 2069 7079    """Returns ipy
+0000c220: 7468 6f6e 2077 6964 6765 7420 666f 7220  thon widget for 
+0000c230: 6b6c 6179 6f75 7420 7669 7375 616c 697a  klayout visualiz
+0000c240: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
+0000c250: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000c260: 2020 7368 6f77 5f70 6f72 7473 3a20 7368    show_ports: sh
+0000c270: 6f77 7320 636f 6d70 6f6e 656e 7420 7769  ows component wi
+0000c280: 7468 2070 6f72 7420 6d61 726b 6572 7320  th port markers 
+0000c290: 616e 6420 6c61 6265 6c73 2e0a 2020 2020  and labels..    
+0000c2a0: 2020 2020 2020 2020 706f 7274 5f6d 6172          port_mar
+0000c2b0: 6b65 725f 6c61 7965 723a 2066 6f72 2074  ker_layer: for t
+0000c2c0: 6865 2070 6f72 7473 2e0a 2020 2020 2020  he ports..      
+0000c2d0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+0000c2e0: 6f6d 2049 5079 7468 6f6e 2e64 6973 706c  om IPython.displ
+0000c2f0: 6179 2069 6d70 6f72 7420 6469 7370 6c61  ay import displa
+0000c300: 790a 0a20 2020 2020 2020 2066 726f 6d20  y..        from 
+0000c310: 6764 7366 6163 746f 7279 2e70 646b 2069  gdsfactory.pdk i
+0000c320: 6d70 6f72 7420 6765 745f 6c61 7965 725f  mport get_layer_
+0000c330: 7669 6577 730a 0a20 2020 2020 2020 2074  views..        t
+0000c340: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000c350: 696d 706f 7274 206b 6661 6374 6f72 7920  import kfactory 
+0000c360: 6173 206b 660a 2020 2020 2020 2020 2020  as kf.          
+0000c370: 2020 6672 6f6d 2067 706c 7567 696e 732e    from gplugins.
+0000c380: 7769 6467 6574 2e69 6e74 6572 6163 7469  widget.interacti
+0000c390: 7665 2069 6d70 6f72 7420 4c61 796f 7574  ve import Layout
+0000c3a0: 5769 6467 6574 0a20 2020 2020 2020 2065  Widget.        e
+0000c3b0: 7863 6570 7420 496d 706f 7274 4572 726f  xcept ImportErro
+0000c3c0: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
+0000c3d0: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+0000c3e0: 2020 2020 2020 2259 6f75 206e 6565 6420        "You need 
+0000c3f0: 696e 7374 616c 6c20 6b66 6163 746f 7279  install kfactory
+0000c400: 2070 6c75 6769 6e20 7769 7468 2060 7069   plugin with `pi
+0000c410: 7020 696e 7374 616c 6c20 6764 7366 6163  p install gdsfac
+0000c420: 746f 7279 5b6b 6661 6374 6f72 795d 6022  tory[kfactory]`"
+0000c430: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000c440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000c450: 706c 6f74 5f6b 6c61 796f 7574 2829 0a20  plot_klayout(). 
+0000c460: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000c470: 6e0a 0a20 2020 2020 2020 2063 6f6d 706f  n..        compo
+0000c480: 6e65 6e74 203d 2028 0a20 2020 2020 2020  nent = (.       
+0000c490: 2020 2020 2073 656c 662e 6164 645f 7069       self.add_pi
+0000c4a0: 6e73 5f74 7269 616e 676c 6528 706f 7274  ns_triangle(port
+0000c4b0: 5f6d 6172 6b65 725f 6c61 7965 723d 706f  _marker_layer=po
+0000c4c0: 7274 5f6d 6172 6b65 725f 6c61 7965 7229  rt_marker_layer)
+0000c4d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c4e0: 7368 6f77 5f70 6f72 7473 0a20 2020 2020  show_ports.     
+0000c4f0: 2020 2020 2020 2065 6c73 6520 7365 6c66         else self
+0000c500: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000c510: 2020 2020 6764 7370 6174 6820 3d20 636f      gdspath = co
+0000c520: 6d70 6f6e 656e 742e 7772 6974 655f 6764  mponent.write_gd
+0000c530: 7328 6c6f 6767 696e 673d 4661 6c73 6529  s(logging=False)
+0000c540: 0a20 2020 2020 2020 206c 7970 5f70 6174  .        lyp_pat
+0000c550: 6820 3d20 6764 7370 6174 682e 7769 7468  h = gdspath.with
+0000c560: 5f73 7566 6669 7828 222e 6c79 7022 290a  _suffix(".lyp").
+0000c570: 0a20 2020 2020 2020 206b 636c 203d 206b  .        kcl = k
+0000c580: 662e 4b43 4c61 796f 7574 2829 0a20 2020  f.KCLayout().   
+0000c590: 2020 2020 206b 636c 2e72 6561 6428 6764       kcl.read(gd
+0000c5a0: 7370 6174 6829 0a20 2020 2020 2020 2074  spath).        t
+0000c5b0: 6f70 5f63 656c 6c20 3d20 6b63 6c2e 746f  op_cell = kcl.to
+0000c5c0: 705f 6365 6c6c 2829 0a20 2020 2020 2020  p_cell().       
+0000c5d0: 2063 203d 206b 636c 2e64 7570 2829 5b74   c = kcl.dup()[t
+0000c5e0: 6f70 5f63 656c 6c2e 6e61 6d65 5d0a 2020  op_cell.name].  
+0000c5f0: 2020 2020 2020 2320 6320 3d20 6b66 2e4b        # c = kf.K
+0000c600: 4365 6c6c 2874 6f70 5f63 656c 6c2e 6e61  Cell(top_cell.na
+0000c610: 6d65 2c20 616c 6c29 0a20 2020 2020 2020  me, all).       
+0000c620: 2023 2063 2e63 6f70 795f 7472 6565 2874   # c.copy_tree(t
+0000c630: 6f70 5f63 656c 6c29 0a0a 2020 2020 2020  op_cell)..      
+0000c640: 2020 6c61 7965 725f 7669 6577 7320 3d20    layer_views = 
+0000c650: 6765 745f 6c61 7965 725f 7669 6577 7328  get_layer_views(
+0000c660: 290a 2020 2020 2020 2020 6c61 7965 725f  ).        layer_
+0000c670: 7669 6577 732e 746f 5f6c 7970 2866 696c  views.to_lyp(fil
+0000c680: 6570 6174 683d 6c79 705f 7061 7468 290a  epath=lyp_path).
+0000c690: 0a20 2020 2020 2020 206c 7720 3d20 4c61  .        lw = La
+0000c6a0: 796f 7574 5769 6467 6574 2863 656c 6c3d  youtWidget(cell=
+0000c6b0: 632c 206c 6179 6572 5f70 726f 7065 7274  c, layer_propert
+0000c6c0: 6965 733d 6c79 705f 7061 7468 290a 2020  ies=lyp_path).  
+0000c6d0: 2020 2020 2020 6469 7370 6c61 7928 6c77        display(lw
+0000c6e0: 2e77 6964 6765 7429 0a0a 2020 2020 6465  .widget)..    de
+0000c6f0: 6620 706c 6f74 5f6b 6c61 796f 7574 280a  f plot_klayout(.
+0000c700: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0000c710: 2020 2020 2020 7368 6f77 5f70 6f72 7473        show_ports
+0000c720: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+0000c730: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
+0000c740: 6572 5f6c 6179 6572 3a20 4c61 7965 7220  er_layer: Layer 
+0000c750: 3d20 2831 2c20 3130 292c 0a20 2020 2020  = (1, 10),.     
+0000c760: 2020 2073 686f 775f 6c61 6265 6c73 3a20     show_labels: 
+0000c770: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+0000c780: 2020 2920 2d3e 204e 6f6e 653a 0a20 2020    ) -> None:.   
+0000c790: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+0000c7a0: 6b6c 6179 6f75 7420 696d 6167 652e 0a0a  klayout image...
+0000c7b0: 2020 2020 2020 2020 4966 2069 7420 6661          If it fa
+0000c7c0: 696c 7320 746f 2069 6d70 6f72 7420 6b6c  ils to import kl
+0000c7d0: 6179 6f75 7420 6465 6661 756c 7473 2074  ayout defaults t
+0000c7e0: 6f20 6d61 7470 6c6f 746c 6962 2e0a 0a20  o matplotlib... 
+0000c7f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+0000c800: 2020 2020 2020 2020 2073 686f 775f 706f           show_po
+0000c810: 7274 733a 2073 686f 7773 2063 6f6d 706f  rts: shows compo
+0000c820: 6e65 6e74 2077 6974 6820 706f 7274 206d  nent with port m
+0000c830: 6172 6b65 7273 2061 6e64 206c 6162 656c  arkers and label
+0000c840: 732e 0a20 2020 2020 2020 2020 2020 2070  s..            p
+0000c850: 6f72 745f 6d61 726b 6572 5f6c 6179 6572  ort_marker_layer
+0000c860: 3a20 666f 7220 7468 6520 706f 7274 732e  : for the ports.
+0000c870: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+0000c880: 775f 6c61 6265 6c73 3a20 7368 6f77 7320  w_labels: shows 
+0000c890: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
+0000c8a0: 2222 220a 0a20 2020 2020 2020 2063 6f6d  """..        com
+0000c8b0: 706f 6e65 6e74 203d 2028 0a20 2020 2020  ponent = (.     
+0000c8c0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+0000c8d0: 7069 6e73 5f74 7269 616e 676c 6528 706f  pins_triangle(po
+0000c8e0: 7274 5f6d 6172 6b65 725f 6c61 7965 723d  rt_marker_layer=
+0000c8f0: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
+0000c900: 7229 0a20 2020 2020 2020 2020 2020 2069  r).            i
+0000c910: 6620 7368 6f77 5f70 6f72 7473 0a20 2020  f show_ports.   
+0000c920: 2020 2020 2020 2020 2065 6c73 6520 7365           else se
+0000c930: 6c66 0a20 2020 2020 2020 2029 0a0a 2020  lf.        )..  
+0000c940: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000c950: 2020 2020 2020 2069 6d70 6f72 7420 6b6c         import kl
+0000c960: 6179 6f75 742e 6462 2061 7320 6462 2020  ayout.db as db  
+0000c970: 2320 6e6f 7161 3a20 4634 3031 0a20 2020  # noqa: F401.   
+0000c980: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+0000c990: 6b6c 6179 6f75 742e 6c61 7920 6173 206c  klayout.lay as l
+0000c9a0: 6179 0a20 2020 2020 2020 2020 2020 2066  ay.            f
+0000c9b0: 726f 6d20 4950 7974 686f 6e2e 6469 7370  rom IPython.disp
+0000c9c0: 6c61 7920 696d 706f 7274 2064 6973 706c  lay import displ
+0000c9d0: 6179 0a20 2020 2020 2020 2020 2020 2066  ay.            f
+0000c9e0: 726f 6d20 6970 7977 6964 6765 7473 2069  rom ipywidgets i
+0000c9f0: 6d70 6f72 7420 496d 6167 650a 0a20 2020  mport Image..   
+0000ca00: 2020 2020 2020 2020 2066 726f 6d20 6764           from gd
+0000ca10: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
+0000ca20: 6f72 7420 6765 745f 6c61 7965 725f 7669  ort get_layer_vi
+0000ca30: 6577 730a 0a20 2020 2020 2020 2020 2020  ews..           
+0000ca40: 2067 6473 7061 7468 203d 2063 6f6d 706f   gdspath = compo
+0000ca50: 6e65 6e74 2e77 7269 7465 5f67 6473 286c  nent.write_gds(l
+0000ca60: 6f67 6769 6e67 3d46 616c 7365 290a 2020  ogging=False).  
+0000ca70: 2020 2020 2020 2020 2020 6c79 705f 7061            lyp_pa
+0000ca80: 7468 203d 2067 6473 7061 7468 2e77 6974  th = gdspath.wit
+0000ca90: 685f 7375 6666 6978 2822 2e6c 7970 2229  h_suffix(".lyp")
+0000caa0: 0a0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+0000cab0: 7965 725f 7669 6577 7320 3d20 6765 745f  yer_views = get_
+0000cac0: 6c61 7965 725f 7669 6577 7328 290a 2020  layer_views().  
+0000cad0: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
+0000cae0: 7669 6577 732e 746f 5f6c 7970 2866 696c  views.to_lyp(fil
+0000caf0: 6570 6174 683d 6c79 705f 7061 7468 290a  epath=lyp_path).
+0000cb00: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+0000cb10: 6f75 745f 7669 6577 203d 206c 6179 2e4c  out_view = lay.L
+0000cb20: 6179 6f75 7456 6965 7728 290a 2020 2020  ayoutView().    
+0000cb30: 2020 2020 2020 2020 6c61 796f 7574 5f76          layout_v
+0000cb40: 6965 772e 6c6f 6164 5f6c 6179 6f75 7428  iew.load_layout(
+0000cb50: 7374 7228 6764 7370 6174 682e 6162 736f  str(gdspath.abso
+0000cb60: 6c75 7465 2829 2929 0a20 2020 2020 2020  lute())).       
+0000cb70: 2020 2020 206c 6179 6f75 745f 7669 6577       layout_view
+0000cb80: 2e6d 6178 5f68 6965 7228 290a 2020 2020  .max_hier().    
+0000cb90: 2020 2020 2020 2020 6c61 796f 7574 5f76          layout_v
+0000cba0: 6965 772e 6c6f 6164 5f6c 6179 6572 5f70  iew.load_layer_p
+0000cbb0: 726f 7073 2873 7472 286c 7970 5f70 6174  rops(str(lyp_pat
+0000cbc0: 6829 290a 0a20 2020 2020 2020 2020 2020  h))..           
+0000cbd0: 206c 6179 6f75 745f 7669 6577 2e73 6574   layout_view.set
+0000cbe0: 5f63 6f6e 6669 6728 2274 6578 742d 7669  _config("text-vi
+0000cbf0: 7369 626c 6522 2c20 2274 7275 6522 2069  sible", "true" i
+0000cc00: 6620 7368 6f77 5f6c 6162 656c 7320 656c  f show_labels el
+0000cc10: 7365 2022 6661 6c73 6522 290a 0a20 2020  se "false")..   
+0000cc20: 2020 2020 2020 2020 2070 6978 656c 5f62           pixel_b
+0000cc30: 7566 6665 7220 3d20 6c61 796f 7574 5f76  uffer = layout_v
+0000cc40: 6965 772e 6765 745f 7069 7865 6c73 5f77  iew.get_pixels_w
+0000cc50: 6974 685f 6f70 7469 6f6e 7328 3830 302c  ith_options(800,
+0000cc60: 2036 3030 290a 2020 2020 2020 2020 2020   600).          
+0000cc70: 2020 706e 675f 6461 7461 203d 2070 6978    png_data = pix
+0000cc80: 656c 5f62 7566 6665 722e 746f 5f70 6e67  el_buffer.to_png
+0000cc90: 5f64 6174 6128 290a 2020 2020 2020 2020  _data().        
+0000cca0: 2020 2020 696d 6167 6520 3d20 496d 6167      image = Imag
+0000ccb0: 6528 7661 6c75 653d 706e 675f 6461 7461  e(value=png_data
+0000ccc0: 2c20 666f 726d 6174 3d22 706e 6722 290a  , format="png").
+0000ccd0: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+0000cce0: 6c61 7928 696d 6167 6529 0a0a 2020 2020  lay(image)..    
+0000ccf0: 2020 2020 6578 6365 7074 2049 6d70 6f72      except Impor
+0000cd00: 7445 7272 6f72 3a0a 2020 2020 2020 2020  tError:.        
+0000cd10: 2020 2020 7072 696e 7428 2259 6f75 2063      print("You c
+0000cd20: 616e 2069 6e73 7461 6c6c 2060 7069 7020  an install `pip 
+0000cd30: 696e 7374 616c 6c20 6764 7366 6163 746f  install gdsfacto
+0000cd40: 7279 6020 666f 7220 6265 7474 6572 2076  ry` for better v
+0000cd50: 6973 7561 6c69 7a61 7469 6f6e 2229 0a20  isualization"). 
+0000cd60: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+0000cd70: 6e65 6e74 2e70 6c6f 7428 706c 6f74 7465  nent.plot(plotte
+0000cd80: 723d 226d 6174 706c 6f74 6c69 6222 290a  r="matplotlib").
+0000cd90: 0a20 2020 2064 6566 2070 6c6f 745f 6b77  .    def plot_kw
+0000cda0: 6562 2873 656c 6629 3a0a 2020 2020 2020  eb(self):.      
+0000cdb0: 2020 2222 2253 686f 7773 2063 7572 7265    """Shows curre
+0000cdc0: 6e74 2067 6473 2069 6e20 6b77 6562 2e22  nt gds in kweb."
+0000cdd0: 2222 0a20 2020 2020 2020 2069 6d70 6f72  "".        impor
+0000cde0: 7420 6f73 0a20 2020 2020 2020 2066 726f  t os.        fro
+0000cdf0: 6d20 6874 6d6c 2069 6d70 6f72 7420 6573  m html import es
+0000ce00: 6361 7065 0a0a 2020 2020 2020 2020 696d  cape..        im
+0000ce10: 706f 7274 206b 7765 622e 7365 7276 6572  port kweb.server
+0000ce20: 5f6a 7570 7974 6572 2061 7320 6b6a 0a20  _jupyter as kj. 
+0000ce30: 2020 2020 2020 2066 726f 6d20 4950 7974         from IPyt
+0000ce40: 686f 6e2e 6469 7370 6c61 7920 696d 706f  hon.display impo
+0000ce50: 7274 2049 4672 616d 650a 0a20 2020 2020  rt IFrame..     
+0000ce60: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000ce70: 7279 2e63 6f6e 6669 6720 696d 706f 7274  ry.config import
+0000ce80: 2050 4154 480a 2020 2020 2020 2020 6672   PATH.        fr
+0000ce90: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
+0000cea0: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
+0000ceb0: 6572 5f76 6965 7773 0a0a 2020 2020 2020  er_views..      
+0000cec0: 2020 6764 7370 6174 6820 3d20 7365 6c66    gdspath = self
+0000ced0: 2e77 7269 7465 5f67 6473 2867 6473 6469  .write_gds(gdsdi
+0000cee0: 723d 5041 5448 2e67 6473 6c69 6220 2f20  r=PATH.gdslib / 
+0000cef0: 2265 7874 7261 222c 206c 6f67 6769 6e67  "extra", logging
+0000cf00: 3d46 616c 7365 290a 0a20 2020 2020 2020  =False)..       
+0000cf10: 2064 6972 7061 7468 203d 2047 4453 4449   dirpath = GDSDI
+0000cf20: 525f 5445 4d50 0a20 2020 2020 2020 2064  R_TEMP.        d
+0000cf30: 6972 7061 7468 2e6d 6b64 6972 2865 7869  irpath.mkdir(exi
+0000cf40: 7374 5f6f 6b3d 5472 7565 2c20 7061 7265  st_ok=True, pare
+0000cf50: 6e74 733d 5472 7565 290a 2020 2020 2020  nts=True).      
+0000cf60: 2020 6c79 705f 7061 7468 203d 2064 6972    lyp_path = dir
+0000cf70: 7061 7468 202f 2022 6c61 7965 7273 2e6c  path / "layers.l
+0000cf80: 7970 220a 0a20 2020 2020 2020 206c 6179  yp"..        lay
+0000cf90: 6572 5f70 726f 7073 203d 2067 6574 5f6c  er_props = get_l
+0000cfa0: 6179 6572 5f76 6965 7773 2829 0a20 2020  ayer_views().   
+0000cfb0: 2020 2020 206c 6179 6572 5f70 726f 7073       layer_props
+0000cfc0: 2e74 6f5f 6c79 7028 6669 6c65 7061 7468  .to_lyp(filepath
+0000cfd0: 3d6c 7970 5f70 6174 6829 0a0a 2020 2020  =lyp_path)..    
+0000cfe0: 2020 2020 706f 7274 203d 206b 6a2e 706f      port = kj.po
+0000cff0: 7274 2069 6620 6861 7361 7474 7228 6b6a  rt if hasattr(kj
+0000d000: 2c20 2270 6f72 7422 2920 616e 6420 6b6a  , "port") and kj
+0000d010: 2e70 6f72 7420 656c 7365 2038 3030 300a  .port else 8000.
+0000d020: 2020 2020 2020 2020 7372 6320 3d20 6622          src = f"
+0000d030: 6874 7470 3a2f 2f31 3237 2e30 2e30 2e31  http://127.0.0.1
+0000d040: 3a7b 706f 7274 7d2f 6764 733f 6764 735f  :{port}/gds?gds_
+0000d050: 6669 6c65 3d7b 6573 6361 7065 2873 7472  file={escape(str
+0000d060: 2867 6473 7061 7468 2929 7d26 6c61 7965  (gdspath))}&laye
+0000d070: 725f 7072 6f70 733d 7b65 7363 6170 6528  r_props={escape(
+0000d080: 7374 7228 6c79 705f 7061 7468 2929 7d22  str(lyp_path))}"
+0000d090: 0a0a 2020 2020 2020 2020 6f73 2e65 6e76  ..        os.env
+0000d0a0: 6972 6f6e 5b22 4b57 4542 5f50 4f52 5422  iron["KWEB_PORT"
+0000d0b0: 5d20 3d20 7374 7228 6f73 2e67 6574 656e  ] = str(os.geten
+0000d0c0: 7628 224b 5745 425f 504f 5254 222c 2070  v("KWEB_PORT", p
+0000d0d0: 6f72 7429 290a 0a20 2020 2020 2020 2069  ort))..        i
+0000d0e0: 6620 6e6f 7420 6b6a 2e6a 7570 7974 6572  f not kj.jupyter
+0000d0f0: 5f73 6572 7665 723a 0a20 2020 2020 2020  _server:.       
+0000d100: 2020 2020 2070 6f72 7420 3d20 696e 7428       port = int(
+0000d110: 6f73 2e67 6574 656e 7628 224b 5745 425f  os.getenv("KWEB_
+0000d120: 504f 5254 2229 290a 2020 2020 2020 2020  PORT")).        
+0000d130: 2020 2020 7768 696c 6520 6b6a 2e69 735f      while kj.is_
+0000d140: 706f 7274 5f69 6e5f 7573 6528 706f 7274  port_in_use(port
+0000d150: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000d160: 2020 2070 6f72 7420 2b3d 2031 0a0a 2020     port += 1..  
+0000d170: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+0000d180: 6972 6f6e 5b22 4b57 4542 5f50 4f52 5422  iron["KWEB_PORT"
+0000d190: 5d20 3d20 7374 7228 706f 7274 290a 2020  ] = str(port).  
+0000d1a0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0000d1b0: 2e64 6562 7567 2873 7263 290a 2020 2020  .debug(src).    
+0000d1c0: 2020 2020 2020 2020 6b6a 2e73 7461 7274          kj.start
+0000d1d0: 2829 0a0a 2020 2020 2020 2020 6966 206b  ()..        if k
+0000d1e0: 6a2e 6a75 7079 7465 725f 7365 7276 6572  j.jupyter_server
+0000d1f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000d200: 7475 726e 2049 4672 616d 6528 0a20 2020  turn IFrame(.   
+0000d210: 2020 2020 2020 2020 2020 2020 2073 7263               src
+0000d220: 3d73 7263 2c0a 2020 2020 2020 2020 2020  =src,.          
+0000d230: 2020 2020 2020 7769 6474 683d 3134 3030        width=1400
+0000d240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d250: 2020 6865 6967 6874 3d36 3030 2c0a 2020    height=600,.  
+0000d260: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d270: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000d280: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000d290: 662e 706c 6f74 5f6b 6c61 796f 7574 2829  f.plot_klayout()
+0000d2a0: 0a0a 2020 2020 6465 6620 706c 6f74 5f6d  ..    def plot_m
+0000d2b0: 6174 706c 6f74 6c69 6228 7365 6c66 2c20  atplotlib(self, 
+0000d2c0: 2a2a 6b77 6172 6773 2920 2d3e 204e 6f6e  **kwargs) -> Non
+0000d2d0: 653a 0a20 2020 2020 2020 2022 2222 506c  e:.        """Pl
+0000d2e0: 6f74 2063 6f6d 706f 6e65 6e74 2075 7369  ot component usi
+0000d2f0: 6e67 206d 6174 706c 6f74 6c69 622e 0a0a  ng matplotlib...
+0000d300: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+0000d310: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000d320: 2020 7368 6f77 5f70 6f72 7473 3a20 5365    show_ports: Se
+0000d330: 7473 2077 6865 7468 6572 2070 6f72 7473  ts whether ports
+0000d340: 2061 7265 2064 7261 776e 2e0a 2020 2020   are drawn..    
+0000d350: 2020 2020 2020 2020 7368 6f77 5f73 7562          show_sub
+0000d360: 706f 7274 733a 2053 6574 7320 7768 6574  ports: Sets whet
+0000d370: 6865 7220 7375 6270 6f72 7473 2028 706f  her subports (po
+0000d380: 7274 7320 7468 6174 2062 656c 6f6e 6720  rts that belong 
+0000d390: 746f 2072 6566 6572 656e 6365 7329 2061  to references) a
+0000d3a0: 7265 2064 7261 776e 2e0a 2020 2020 2020  re drawn..      
+0000d3b0: 2020 2020 2020 6c61 6265 6c5f 616c 6961        label_alia
+0000d3c0: 7365 733a 2053 6574 7320 7768 6574 6865  ses: Sets whethe
+0000d3d0: 7220 616c 6961 7365 7320 6172 6520 6c61  r aliases are la
+0000d3e0: 6265 6c65 6420 7769 7468 2061 2074 6578  beled with a tex
+0000d3f0: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
+0000d400: 2020 2020 6e65 775f 7769 6e64 6f77 3a20      new_window: 
+0000d410: 4966 2054 7275 652c 2065 6163 6820 6361  If True, each ca
+0000d420: 6c6c 2074 6f20 7175 6963 6b70 6c6f 7428  ll to quickplot(
+0000d430: 2920 7769 6c6c 2067 656e 6572 6174 6520  ) will generate 
+0000d440: 6120 7365 7061 7261 7465 2077 696e 646f  a separate windo
+0000d450: 772e 0a20 2020 2020 2020 2020 2020 2062  w..            b
+0000d460: 6c6f 636b 696e 673a 2049 6620 5472 7565  locking: If True
+0000d470: 2c20 6361 6c6c 696e 6720 7175 6963 6b70  , calling quickp
+0000d480: 6c6f 7428 2920 7769 6c6c 2070 6175 7365  lot() will pause
+0000d490: 2065 7865 6375 7469 6f6e 206f 6620 2822   execution of ("
+0000d4a0: 626c 6f63 6b22 2920 7468 650a 2020 2020  block") the.    
+0000d4b0: 2020 2020 2020 2020 2020 2020 7265 6d61              rema
+0000d4c0: 696e 6465 7220 6f66 2074 6865 2070 7974  inder of the pyt
+0000d4d0: 686f 6e20 636f 6465 2075 6e74 696c 2074  hon code until t
+0000d4e0: 6865 2071 7569 636b 706c 6f74 2829 2077  he quickplot() w
+0000d4f0: 696e 646f 7720 6973 2063 6c6f 7365 642e  indow is closed.
+0000d500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d510: 2049 6620 4661 6c73 652c 2074 6865 2077   If False, the w
+0000d520: 696e 646f 7720 7769 6c6c 2062 6520 6f70  indow will be op
+0000d530: 656e 6564 2061 6e64 2063 6f64 6520 7769  ened and code wi
+0000d540: 6c6c 2063 6f6e 7469 6e75 6520 746f 2072  ll continue to r
+0000d550: 756e 2e0a 2020 2020 2020 2020 2020 2020  un..            
+0000d560: 7a6f 6f6d 5f66 6163 746f 723a 2053 6574  zoom_factor: Set
+0000d570: 7320 7468 6520 7363 616c 696e 6720 6661  s the scaling fa
+0000d580: 6374 6f72 2077 6865 6e20 7a6f 6f6d 696e  ctor when zoomin
+0000d590: 6720 7468 6520 7175 6963 6b70 6c6f 7420  g the quickplot 
+0000d5a0: 7769 6e64 6f77 2077 6974 6820 7468 650a  window with the.
+0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5c0: 6d6f 7573 6577 6865 656c 2f74 7261 636b  mousewheel/track
+0000d5d0: 7061 642e 0a20 2020 2020 2020 2020 2020  pad..           
+0000d5e0: 2069 6e74 6572 6163 7469 7665 5f7a 6f6f   interactive_zoo
+0000d5f0: 6d3a 2045 6e61 626c 6573 2075 7369 6e67  m: Enables using
+0000d600: 206d 6f75 7365 7768 6565 6c2f 7472 6163   mousewheel/trac
+0000d610: 6b70 6164 2074 6f20 7a6f 6f6d 2e0a 2020  kpad to zoom..  
+0000d620: 2020 2020 2020 2020 2020 666f 6e74 7369            fontsi
+0000d630: 7a65 3a20 666f 7220 6c61 6265 6c73 2e0a  ze: for labels..
+0000d640: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000d650: 7273 5f65 7863 6c75 6465 643a 206c 6973  rs_excluded: lis
+0000d660: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
+0000d670: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
+0000d680: 2020 2020 6c61 7965 725f 7669 6577 733a      layer_views:
+0000d690: 206c 6179 6572 5f76 6965 7773 2063 6f6c   layer_views col
+0000d6a0: 6f72 7320 6c6f 6164 6564 2066 726f 6d20  ors loaded from 
+0000d6b0: 4b6c 6179 6f75 742e 0a20 2020 2020 2020  Klayout..       
+0000d6c0: 2020 2020 206d 696e 5f61 7370 6563 743a       min_aspect:
+0000d6d0: 206d 696e 696d 756d 2061 7370 6563 7420   minimum aspect 
+0000d6e0: 7261 7469 6f2e 0a20 2020 2020 2020 2022  ratio..        "
+0000d6f0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+0000d700: 6764 7366 6163 746f 7279 2e71 7569 636b  gdsfactory.quick
+0000d710: 706c 6f74 7465 7220 696d 706f 7274 2071  plotter import q
+0000d720: 7569 636b 706c 6f74 0a0a 2020 2020 2020  uickplot..      
+0000d730: 2020 7175 6963 6b70 6c6f 7428 7365 6c66    quickplot(self
+0000d740: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+0000d750: 2064 6566 2070 6c6f 7428 7365 6c66 2c20   def plot(self, 
+0000d760: 706c 6f74 7465 723a 2073 7472 207c 204e  plotter: str | N
+0000d770: 6f6e 6520 3d20 4e6f 6e65 2c20 2a2a 6b77  one = None, **kw
+0000d780: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
+0000d790: 2222 5265 7475 726e 7320 636f 6d70 6f6e  ""Returns compon
+0000d7a0: 656e 7420 706c 6f74 2075 7369 6e67 206b  ent plot using k
+0000d7b0: 6c61 796f 7574 2c20 6d61 7470 6c6f 746c  layout, matplotl
+0000d7c0: 6962 2c20 686f 6c6f 7669 6577 7320 6f72  ib, holoviews or
+0000d7d0: 2071 742e 0a0a 2020 2020 2020 2020 5765   qt...        We
+0000d7e0: 2072 6563 6f6d 6d65 6e64 2075 7369 6e67   recommend using
+0000d7f0: 206b 6c61 796f 7574 2e0a 0a20 2020 2020   klayout...     
+0000d800: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000d810: 2020 2020 2070 6c6f 7474 6572 3a20 706c       plotter: pl
+0000d820: 6f74 2062 6163 6b65 6e64 2028 276d 6174  ot backend ('mat
+0000d830: 706c 6f74 6c69 6227 2c20 2777 6964 6765  plotlib', 'widge
+0000d840: 7427 2c20 276b 6c61 796f 7574 272c 2027  t', 'klayout', '
+0000d850: 6b77 6562 2729 2e0a 2020 2020 2020 2020  kweb')..        
+0000d860: 2222 220a 2020 2020 2020 2020 706c 6f74  """.        plot
+0000d870: 7465 7220 3d20 706c 6f74 7465 7220 6f72  ter = plotter or
+0000d880: 2043 4f4e 462e 6469 7370 6c61 795f 7479   CONF.display_ty
+0000d890: 7065 0a0a 2020 2020 2020 2020 6966 2070  pe..        if p
+0000d8a0: 6c6f 7474 6572 206e 6f74 2069 6e20 7661  lotter not in va
+0000d8b0: 6c69 645f 706c 6f74 7465 7273 3a0a 2020  lid_plotters:.  
+0000d8c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000d8d0: 5661 6c75 6545 7272 6f72 2866 227b 706c  ValueError(f"{pl
+0000d8e0: 6f74 7465 7221 727d 206e 6f74 2069 6e20  otter!r} not in 
+0000d8f0: 7b76 616c 6964 5f70 6c6f 7474 6572 737d  {valid_plotters}
+0000d900: 2229 0a0a 2020 2020 2020 2020 6966 2070  ")..        if p
+0000d910: 6c6f 7474 6572 203d 3d20 226b 6c61 796f  lotter == "klayo
+0000d920: 7574 223a 0a20 2020 2020 2020 2020 2020  ut":.           
+0000d930: 2073 656c 662e 706c 6f74 5f6b 6c61 796f   self.plot_klayo
+0000d940: 7574 2829 0a20 2020 2020 2020 2020 2020  ut().           
+0000d950: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+0000d960: 656c 6966 2070 6c6f 7474 6572 203d 3d20  elif plotter == 
+0000d970: 226b 7765 6222 3a0a 2020 2020 2020 2020  "kweb":.        
+0000d980: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000d990: 706c 6f74 5f6b 7765 6228 290a 2020 2020  plot_kweb().    
+0000d9a0: 2020 2020 656c 6966 2070 6c6f 7474 6572      elif plotter
+0000d9b0: 203d 3d20 2277 6964 6765 7422 3a0a 2020   == "widget":.  
+0000d9c0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000d9d0: 6c6f 745f 7769 6467 6574 2829 0a20 2020  lot_widget().   
+0000d9e0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0000d9f0: 0a20 2020 2020 2020 2065 6c69 6620 706c  .        elif pl
+0000da00: 6f74 7465 7220 3d3d 2022 6d61 7470 6c6f  otter == "matplo
+0000da10: 746c 6962 223a 0a20 2020 2020 2020 2020  tlib":.         
+0000da20: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000da30: 7279 2e71 7569 636b 706c 6f74 7465 7220  ry.quickplotter 
+0000da40: 696d 706f 7274 2071 7569 636b 706c 6f74  import quickplot
+0000da50: 0a0a 2020 2020 2020 2020 2020 2020 7175  ..            qu
+0000da60: 6963 6b70 6c6f 7428 7365 6c66 2c20 2a2a  ickplot(self, **
+0000da70: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+0000da80: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+0000da90: 2020 2020 656c 6966 2070 6c6f 7474 6572      elif plotter
+0000daa0: 203d 3d20 2268 6f6c 6f76 6965 7773 223a   == "holoviews":
+0000dab0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000dac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000dad0: 2020 696d 706f 7274 2068 6f6c 6f76 6965    import holovie
+0000dae0: 7773 2061 7320 6876 0a0a 2020 2020 2020  ws as hv..      
+0000daf0: 2020 2020 2020 2020 2020 6876 2e65 7874            hv.ext
+0000db00: 656e 7369 6f6e 2822 626f 6b65 6822 290a  ension("bokeh").
+0000db10: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000db20: 7074 2049 6d70 6f72 7445 7272 6f72 2061  pt ImportError a
+0000db30: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000db40: 2020 2020 2070 7269 6e74 2822 796f 7520       print("you 
+0000db50: 6e65 6564 2074 6f20 6070 6970 2069 6e73  need to `pip ins
+0000db60: 7461 6c6c 2068 6f6c 6f76 6965 7773 6022  tall holoviews`"
+0000db70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000db80: 2020 7261 6973 6520 650a 2020 2020 2020    raise e.      
+0000db90: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000dba0: 662e 706c 6f74 5f68 6f6c 6f76 6965 7773  f.plot_holoviews
+0000dbb0: 282a 2a6b 7761 7267 7329 0a0a 2020 2020  (**kwargs)..    
+0000dbc0: 2020 2020 656c 6966 2070 6c6f 7474 6572      elif plotter
+0000dbd0: 203d 3d20 2271 7422 3a0a 2020 2020 2020   == "qt":.      
+0000dbe0: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+0000dbf0: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
+0000dc00: 2020 2020 2022 7174 2070 6c6f 7474 6572       "qt plotter
+0000dc10: 2069 7320 6465 7072 6563 6174 6564 2e20   is deprecated. 
+0000dc20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000dc30: 2020 2255 7365 2074 6865 2064 6566 6175    "Use the defau
+0000dc40: 6c74 2043 6f6d 706f 6e65 6e74 2e70 6c6f  lt Component.plo
+0000dc50: 7428 292c 2043 6f6d 706f 6e65 6e74 2e70  t(), Component.p
+0000dc60: 6c6f 745f 6b6c 6179 6f75 7428 2920 6f72  lot_klayout() or
+0000dc70: 2043 6f6d 706f 6e65 6e74 2e70 6c6f 745f   Component.plot_
+0000dc80: 7769 6467 6574 2829 222c 0a20 2020 2020  widget()",.     
+0000dc90: 2020 2020 2020 2020 2020 2073 7461 636b             stack
+0000dca0: 6c65 7665 6c3d 332c 0a20 2020 2020 2020  level=3,.       
+0000dcb0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000dcc0: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+0000dcd0: 7279 2e71 7569 636b 706c 6f74 7465 7220  ry.quickplotter 
+0000dce0: 696d 706f 7274 2071 7569 636b 706c 6f74  import quickplot
+0000dcf0: 320a 0a20 2020 2020 2020 2020 2020 2071  2..            q
+0000dd00: 7569 636b 706c 6f74 3228 7365 6c66 290a  uickplot2(self).
+0000dd10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000dd20: 726e 0a0a 2020 2020 6465 6620 706c 6f74  rn..    def plot
+0000dd30: 5f68 6f6c 6f76 6965 7773 280a 2020 2020  _holoviews(.    
+0000dd40: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000dd50: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
+0000dd60: 643a 204c 6179 6572 7320 7c20 4e6f 6e65  d: Layers | None
+0000dd70: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000dd80: 206c 6179 6572 5f76 6965 7773 3a20 4c61   layer_views: La
+0000dd90: 7965 7256 6965 7773 207c 204e 6f6e 6520  yerViews | None 
+0000dda0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000ddb0: 6d69 6e5f 6173 7065 6374 3a20 666c 6f61  min_aspect: floa
+0000ddc0: 7420 3d20 302e 3235 2c0a 2020 2020 2020  t = 0.25,.      
+0000ddd0: 2020 7061 6464 696e 673a 2066 6c6f 6174    padding: float
+0000dde0: 203d 2030 2e35 2c0a 2020 2020 293a 0a20   = 0.5,.    ):. 
+0000ddf0: 2020 2020 2020 2022 2222 506c 6f74 2063         """Plot c
+0000de00: 6f6d 706f 6e65 6e74 2069 6e20 686f 6c6f  omponent in holo
+0000de10: 7669 6577 732e 0a0a 2020 2020 2020 2020  views...        
+0000de20: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000de30: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
+0000de40: 643a 206c 6973 7420 6f66 206c 6179 6572  d: list of layer
+0000de50: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
+0000de60: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
+0000de70: 7669 6577 733a 206c 6179 6572 5f76 6965  views: layer_vie
+0000de80: 7773 2063 6f6c 6f72 7320 6c6f 6164 6564  ws colors loaded
+0000de90: 2066 726f 6d20 4b6c 6179 6f75 742e 0a20   from Klayout.. 
+0000dea0: 2020 2020 2020 2020 2020 206d 696e 5f61             min_a
+0000deb0: 7370 6563 743a 206d 696e 696d 756d 2061  spect: minimum a
+0000dec0: 7370 6563 7420 7261 7469 6f2e 0a20 2020  spect ratio..   
+0000ded0: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
+0000dee0: 3a20 6172 6f75 6e64 2062 6f75 6e64 696e  : around boundin
+0000def0: 6720 626f 782e 0a0a 2020 2020 2020 2020  g box...        
+0000df00: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
+0000df10: 2020 2020 2048 6f6c 6f76 6965 7773 204f       Holoviews O
+0000df20: 7665 726c 6179 2074 6f20 6469 7370 6c61  verlay to displa
+0000df30: 7920 616c 6c20 706f 6c79 676f 6e73 2e0a  y all polygons..
+0000df40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000df50: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+0000df60: 6f72 792e 6164 645f 7069 6e73 2069 6d70  ory.add_pins imp
+0000df70: 6f72 7420 6765 745f 7069 6e5f 7472 6961  ort get_pin_tria
+0000df80: 6e67 6c65 5f70 6f6c 7967 6f6e 5f74 6970  ngle_polygon_tip
+0000df90: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+0000dfa0: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
+0000dfb0: 6f72 7420 6765 745f 6c61 7965 725f 7669  ort get_layer_vi
+0000dfc0: 6577 730a 0a20 2020 2020 2020 2077 6172  ews..        war
+0000dfd0: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+0000dfe0: 2020 2020 2020 2020 2268 6f6c 6f76 6965          "holovie
+0000dff0: 7773 2070 6c6f 7474 6572 2069 7320 6465  ws plotter is de
+0000e000: 7072 6563 6174 6564 2e20 220a 2020 2020  precated. ".    
+0000e010: 2020 2020 2020 2020 2255 7365 2074 6865          "Use the
+0000e020: 2064 6566 6175 6c74 2043 6f6d 706f 6e65   default Compone
+0000e030: 6e74 2e70 6c6f 7428 292c 2043 6f6d 706f  nt.plot(), Compo
+0000e040: 6e65 6e74 2e70 6c6f 745f 6b6c 6179 6f75  nent.plot_klayou
+0000e050: 7428 2920 6f72 2043 6f6d 706f 6e65 6e74  t() or Component
+0000e060: 2e70 6c6f 745f 7769 6467 6574 2829 222c  .plot_widget()",
+0000e070: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+0000e080: 636b 6c65 7665 6c3d 332c 0a20 2020 2020  cklevel=3,.     
+0000e090: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
+0000e0a0: 206c 6179 6572 5f76 6965 7773 2069 7320   layer_views is 
+0000e0b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000e0c0: 2020 6c61 7965 725f 7669 6577 7320 3d20    layer_views = 
+0000e0d0: 6765 745f 6c61 7965 725f 7669 6577 7328  get_layer_views(
+0000e0e0: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
+0000e0f0: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+0000e100: 7274 2068 6f6c 6f76 6965 7773 2061 7320  rt holoviews as 
+0000e110: 6876 0a0a 2020 2020 2020 2020 2020 2020  hv..            
+0000e120: 6876 2e65 7874 656e 7369 6f6e 2822 626f  hv.extension("bo
+0000e130: 6b65 6822 290a 2020 2020 2020 2020 6578  keh").        ex
+0000e140: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
+0000e150: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000e160: 2020 2070 7269 6e74 2822 796f 7520 6e65     print("you ne
+0000e170: 6564 2074 6f20 6070 6970 2069 6e73 7461  ed to `pip insta
+0000e180: 6c6c 2068 6f6c 6f76 6965 7773 6022 290a  ll holoviews`").
+0000e190: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000e1a0: 6520 650a 0a20 2020 2020 2020 2073 656c  e e..        sel
+0000e1b0: 662e 5f62 625f 7661 6c69 6420 3d20 4661  f._bb_valid = Fa
+0000e1c0: 6c73 6520 2023 2072 6563 6f6d 7075 7465  lse  # recompute
+0000e1d0: 2074 6865 2062 6f75 6e64 696e 6720 626f   the bounding bo
+0000e1e0: 780a 2020 2020 2020 2020 6220 3d20 7365  x.        b = se
+0000e1f0: 6c66 2e62 626f 7820 2b20 2828 2d70 6164  lf.bbox + ((-pad
+0000e200: 6469 6e67 2c20 2d70 6164 6469 6e67 292c  ding, -padding),
+0000e210: 2028 7061 6464 696e 672c 2070 6164 6469   (padding, paddi
+0000e220: 6e67 2929 0a20 2020 2020 2020 2062 203d  ng)).        b =
+0000e230: 206e 702e 6172 7261 7928 622e 666c 6174   np.array(b.flat
+0000e240: 290a 2020 2020 2020 2020 6365 6e74 6572  ).        center
+0000e250: 203d 206e 702e 6172 7261 7928 286e 702e   = np.array((np.
+0000e260: 7375 6d28 625b 3a3a 325d 2920 2f20 322c  sum(b[::2]) / 2,
+0000e270: 206e 702e 7375 6d28 625b 313a 3a32 5d29   np.sum(b[1::2])
+0000e280: 202f 2032 2929 0a20 2020 2020 2020 2073   / 2)).        s
+0000e290: 697a 6520 3d20 6e70 2e61 7272 6179 2828  ize = np.array((
+0000e2a0: 6e70 2e61 6273 2862 5b32 5d20 2d20 625b  np.abs(b[2] - b[
+0000e2b0: 305d 292c 206e 702e 6162 7328 625b 335d  0]), np.abs(b[3]
+0000e2c0: 202d 2062 5b31 5d29 2929 0a20 2020 2020   - b[1]))).     
+0000e2d0: 2020 2064 7820 3d20 6e70 2e61 7272 6179     dx = np.array
+0000e2e0: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
+0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e300: 6e70 2e6d 6178 696d 756d 286d 696e 5f61  np.maximum(min_a
+0000e310: 7370 6563 7420 2a20 7369 7a65 5b31 5d2c  spect * size[1],
+0000e320: 2073 697a 655b 305d 2920 2f20 322c 0a20   size[0]) / 2,. 
+0000e330: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000e340: 702e 6d61 7869 6d75 6d28 7369 7a65 5b31  p.maximum(size[1
+0000e350: 5d2c 206d 696e 5f61 7370 6563 7420 2a20  ], min_aspect * 
+0000e360: 7369 7a65 5b30 5d29 202f 2032 2c0a 2020  size[0]) / 2,.  
+0000e370: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000e380: 2020 2020 290a 2020 2020 2020 2020 6220      ).        b 
+0000e390: 3d20 6e70 2e68 7374 6163 6b28 2863 656e  = np.hstack((cen
+0000e3a0: 7465 7220 2d20 6478 2c20 6365 6e74 6572  ter - dx, center
+0000e3b0: 202b 2064 7829 290a 0a20 2020 2020 2020   + dx))..       
+0000e3c0: 2070 6c6f 7473 5f74 6f5f 6f76 6572 6c61   plots_to_overla
+0000e3d0: 7920 3d20 5b5d 0a20 2020 2020 2020 206c  y = [].        l
+0000e3e0: 6179 6572 735f 6578 636c 7564 6564 203d  ayers_excluded =
+0000e3f0: 205b 5d20 6966 206c 6179 6572 735f 6578   [] if layers_ex
+0000e400: 636c 7564 6564 2069 7320 4e6f 6e65 2065  cluded is None e
+0000e410: 6c73 6520 6c61 7965 7273 5f65 7863 6c75  lse layers_exclu
+0000e420: 6465 640a 0a20 2020 2020 2020 2066 6f72  ded..        for
+0000e430: 206c 6179 6572 2c20 706f 6c79 676f 6e20   layer, polygon 
+0000e440: 696e 2073 656c 662e 6765 745f 706f 6c79  in self.get_poly
+0000e450: 676f 6e73 2862 795f 7370 6563 3d54 7275  gons(by_spec=Tru
+0000e460: 6529 2e69 7465 6d73 2829 3a0a 2020 2020  e).items():.    
+0000e470: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+0000e480: 2069 6e20 6c61 7965 7273 5f65 7863 6c75   in layers_exclu
+0000e490: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
+0000e4a0: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
+0000e4b0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4d0: 6c61 7965 725f 7669 6577 203d 206c 6179  layer_view = lay
+0000e4e0: 6572 5f76 6965 7773 2e67 6574 5f66 726f  er_views.get_fro
+0000e4f0: 6d5f 7475 706c 6528 6c61 7965 7229 0a20  m_tuple(layer). 
+0000e500: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000e510: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
+0000e520: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000e530: 7965 7273 203d 206c 6973 7428 6c61 7965  yers = list(laye
+0000e540: 725f 7669 6577 732e 6765 745f 6c61 7965  r_views.get_laye
+0000e550: 725f 7669 6577 7328 292e 6b65 7973 2829  r_views().keys()
+0000e560: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e570: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+0000e580: 6622 7b6c 6179 6572 2172 7d20 6e6f 7420  f"{layer!r} not 
+0000e590: 6465 6669 6e65 6420 696e 207b 6c61 7965  defined in {laye
+0000e5a0: 7273 7d22 2c20 7374 6163 6b6c 6576 656c  rs}", stacklevel
+0000e5b0: 3d33 290a 2020 2020 2020 2020 2020 2020  =3).            
+0000e5c0: 2020 2020 6c61 7965 725f 7669 6577 203d      layer_view =
+0000e5d0: 204c 6179 6572 5669 6577 286c 6179 6572   LayerView(layer
+0000e5e0: 3d6c 6179 6572 290a 2020 2020 2020 2020  =layer).        
+0000e5f0: 2020 2020 2320 544f 444f 3a20 4d61 7463      # TODO: Matc
+0000e600: 6820 7570 206f 7074 696f 6e73 2077 6974  h up options wit
+0000e610: 6820 4c61 7965 7256 6965 7773 0a20 2020  h LayerViews.   
+0000e620: 2020 2020 2020 2020 2070 6c6f 7473 5f74           plots_t
+0000e630: 6f5f 6f76 6572 6c61 792e 6170 7065 6e64  o_overlay.append
+0000e640: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e650: 2020 6876 2e50 6f6c 7967 6f6e 7328 706f    hv.Polygons(po
+0000e660: 6c79 676f 6e2c 206c 6162 656c 3d73 7472  lygon, label=str
+0000e670: 286c 6179 6572 5f76 6965 772e 6e61 6d65  (layer_view.name
+0000e680: 2929 2e6f 7074 7328 0a20 2020 2020 2020  )).opts(.       
+0000e690: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0000e6a0: 615f 6173 7065 6374 3d31 2c0a 2020 2020  a_aspect=1,.    
+0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6c0: 6672 616d 655f 7769 6474 683d 3530 302c  frame_width=500,
+0000e6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e6e0: 2020 2020 2079 6c69 6d3d 2862 5b31 5d2c       ylim=(b[1],
+0000e6f0: 2062 5b33 5d29 2c0a 2020 2020 2020 2020   b[3]),.        
+0000e700: 2020 2020 2020 2020 2020 2020 786c 696d              xlim
+0000e710: 3d28 625b 305d 2c20 625b 325d 292c 0a20  =(b[0], b[2]),. 
+0000e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e730: 2020 2066 696c 6c5f 636f 6c6f 723d 6c61     fill_color=la
+0000e740: 7965 725f 7669 6577 2e66 696c 6c5f 636f  yer_view.fill_co
+0000e750: 6c6f 722e 6173 5f72 6762 2829 206f 7220  lor.as_rgb() or 
+0000e760: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
+0000e770: 2020 2020 2020 2020 6c69 6e65 5f63 6f6c          line_col
+0000e780: 6f72 3d6c 6179 6572 5f76 6965 772e 6672  or=layer_view.fr
+0000e790: 616d 655f 636f 6c6f 722e 6173 5f72 6762  ame_color.as_rgb
+0000e7a0: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
+0000e7b0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000e7c0: 6c6c 5f61 6c70 6861 3d6c 6179 6572 5f76  ll_alpha=layer_v
+0000e7d0: 6965 772e 6765 745f 616c 7068 6128 2920  iew.get_alpha() 
+0000e7e0: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
+0000e7f0: 2020 2020 2020 2020 2020 206c 696e 655f             line_
+0000e800: 616c 7068 613d 6c61 7965 725f 7669 6577  alpha=layer_view
+0000e810: 2e67 6574 5f61 6c70 6861 2829 206f 7220  .get_alpha() or 
+0000e820: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
+0000e830: 2020 2020 2020 2020 746f 6f6c 733d 5b22          tools=["
+0000e840: 686f 7665 7222 5d2c 0a20 2020 2020 2020  hover"],.       
+0000e850: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e860: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000e870: 2066 6f72 206e 616d 652c 2070 6f72 7420   for name, port 
+0000e880: 696e 2073 656c 662e 706f 7274 732e 6974  in self.ports.it
+0000e890: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0000e8a0: 2020 206e 616d 6520 3d20 7374 7228 6e61     name = str(na
+0000e8b0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000e8c0: 706f 6c79 676f 6e2c 2070 7469 7020 3d20  polygon, ptip = 
+0000e8d0: 6765 745f 7069 6e5f 7472 6961 6e67 6c65  get_pin_triangle
+0000e8e0: 5f70 6f6c 7967 6f6e 5f74 6970 2870 6f72  _polygon_tip(por
+0000e8f0: 743d 706f 7274 290a 0a20 2020 2020 2020  t=port)..       
+0000e900: 2020 2020 2070 6c6f 7473 5f74 6f5f 6f76       plots_to_ov
+0000e910: 6572 6c61 792e 6170 7065 6e64 280a 2020  erlay.append(.  
+0000e920: 2020 2020 2020 2020 2020 2020 2020 6876                hv
+0000e930: 2e50 6f6c 7967 6f6e 7328 706f 6c79 676f  .Polygons(polygo
+0000e940: 6e2c 206c 6162 656c 3d6e 616d 6529 2e6f  n, label=name).o
+0000e950: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
+0000e960: 2020 2020 2020 2020 2064 6174 615f 6173           data_as
+0000e970: 7065 6374 3d31 2c0a 2020 2020 2020 2020  pect=1,.        
+0000e980: 2020 2020 2020 2020 2020 2020 6672 616d              fram
+0000e990: 655f 7769 6474 683d 3530 302c 0a20 2020  e_width=500,.   
+0000e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9b0: 2066 696c 6c5f 616c 7068 613d 302c 0a20   fill_alpha=0,. 
+0000e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9d0: 2020 2079 6c69 6d3d 2862 5b31 5d2c 2062     ylim=(b[1], b
+0000e9e0: 5b33 5d29 2c0a 2020 2020 2020 2020 2020  [3]),.          
+0000e9f0: 2020 2020 2020 2020 2020 786c 696d 3d28            xlim=(
+0000ea00: 625b 305d 2c20 625b 325d 292c 0a20 2020  b[0], b[2]),.   
+0000ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea20: 2063 6f6c 6f72 3d22 7265 6422 2c0a 2020   color="red",.  
+0000ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea40: 2020 6c69 6e65 5f61 6c70 6861 3d6c 6179    line_alpha=lay
+0000ea50: 6572 5f76 6965 772e 6765 745f 616c 7068  er_view.get_alph
+0000ea60: 6128 2920 6f72 2022 222c 0a20 2020 2020  a() or "",.     
+0000ea70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000ea80: 6f6f 6c73 3d5b 2268 6f76 6572 225d 2c0a  ools=["hover"],.
+0000ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eaa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000eab0: 2020 2a20 6876 2e54 6578 7428 7074 6970    * hv.Text(ptip
+0000eac0: 5b30 5d2c 2070 7469 705b 315d 2c20 6e61  [0], ptip[1], na
+0000ead0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000eae0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000eaf0: 6e20 6876 2e4f 7665 726c 6179 2870 6c6f  n hv.Overlay(plo
+0000eb00: 7473 5f74 6f5f 6f76 6572 6c61 7929 2e6f  ts_to_overlay).o
+0000eb10: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
+0000eb20: 2073 686f 775f 6c65 6765 6e64 3d54 7275   show_legend=Tru
+0000eb30: 652c 2073 6861 7265 645f 6178 6573 3d46  e, shared_axes=F
+0000eb40: 616c 7365 2c20 796c 696d 3d28 625b 315d  alse, ylim=(b[1]
+0000eb50: 2c20 625b 335d 292c 2078 6c69 6d3d 2862  , b[3]), xlim=(b
+0000eb60: 5b30 5d2c 2062 5b32 5d29 0a20 2020 2020  [0], b[2]).     
+0000eb70: 2020 2029 0a0a 2020 2020 6465 6620 7368     )..    def sh
+0000eb80: 6f77 280a 2020 2020 2020 2020 7365 6c66  ow(.        self
+0000eb90: 2c0a 2020 2020 2020 2020 7368 6f77 5f70  ,.        show_p
+0000eba0: 6f72 7473 3a20 626f 6f6c 203d 2046 616c  orts: bool = Fal
+0000ebb0: 7365 2c0a 2020 2020 2020 2020 7368 6f77  se,.        show
+0000ebc0: 5f73 7562 706f 7274 733a 2062 6f6f 6c20  _subports: bool 
+0000ebd0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+0000ebe0: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
+0000ebf0: 6572 3a20 4c61 7965 7220 3d20 2831 2c20  er: Layer = (1, 
+0000ec00: 3130 292c 0a20 2020 2020 2020 202a 2a6b  10),.        **k
+0000ec10: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
+0000ec20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000ec30: 2253 686f 7720 636f 6d70 6f6e 656e 7420  "Show component 
+0000ec40: 696e 204b 4c61 796f 7574 2e0a 0a20 2020  in KLayout...   
+0000ec50: 2020 2020 2072 6574 7572 6e73 2061 2063       returns a c
+0000ec60: 6f70 7920 6f66 2074 6865 2043 6f6d 706f  opy of the Compo
+0000ec70: 6e65 6e74 2c20 736f 2074 6865 206f 7269  nent, so the ori
+0000ec80: 6769 6e61 6c20 636f 6d70 6f6e 656e 7420  ginal component 
+0000ec90: 7265 6d61 696e 7320 696e 7461 6374 2e0a  remains intact..
+0000eca0: 2020 2020 2020 2020 7769 7468 2070 696e          with pin
+0000ecb0: 7320 6d61 726b 6572 7320 6f6e 2065 6163  s markers on eac
+0000ecc0: 6820 706f 7274 2073 686f 775f 706f 7274  h port show_port
+0000ecd0: 7320 3d20 5472 7565 2c20 616e 6420 6f70  s = True, and op
+0000ece0: 7469 6f6e 616c 6c79 2061 6c73 6f0a 2020  tionally also.  
+0000ecf0: 2020 2020 2020 7468 6520 706f 7274 7320        the ports 
+0000ed00: 6672 6f6d 2074 6865 2072 6566 6572 656e  from the referen
+0000ed10: 6365 7320 2873 686f 775f 7375 6270 6f72  ces (show_subpor
+0000ed20: 7473 3d54 7275 6529 0a0a 2020 2020 2020  ts=True)..      
+0000ed30: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000ed40: 2020 2020 7368 6f77 5f70 6f72 7473 3a20      show_ports: 
+0000ed50: 7368 6f77 7320 636f 6d70 6f6e 656e 7420  shows component 
+0000ed60: 7769 7468 2070 6f72 7420 6d61 726b 6572  with port marker
+0000ed70: 7320 616e 6420 6c61 6265 6c73 2e0a 2020  s and labels..  
+0000ed80: 2020 2020 2020 2020 2020 7368 6f77 5f73            show_s
+0000ed90: 7562 706f 7274 733a 2061 6464 2070 6f72  ubports: add por
+0000eda0: 7473 206d 6172 6b65 7273 2061 6e64 206c  ts markers and l
+0000edb0: 6162 656c 7320 746f 2072 6566 6572 656e  abels to referen
+0000edc0: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
+0000edd0: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
+0000ede0: 6572 3a20 666f 7220 7468 6520 706f 7274  er: for the port
+0000edf0: 732e 0a0a 2020 2020 2020 2020 4b65 7977  s...        Keyw
+0000ee00: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
+0000ee10: 2020 2020 2020 6764 7370 6174 683a 2047        gdspath: G
+0000ee20: 4453 2066 696c 6520 7061 7468 2074 6f20  DS file path to 
+0000ee30: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
+0000ee40: 2020 2020 2020 6764 7364 6972 3a20 6469        gdsdir: di
+0000ee50: 7265 6374 6f72 7920 666f 7220 7468 6520  rectory for the 
+0000ee60: 4744 5320 6669 6c65 2e20 4465 6661 756c  GDS file. Defaul
+0000ee70: 7473 2074 6f20 2f74 6d70 2f2e 0a20 2020  ts to /tmp/..   
+0000ee80: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
+0000ee90: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
+0000eea0: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
+0000eeb0: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
+0000eec0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+0000eed0: 6369 7369 6f6e 3a20 666f 7220 6f62 6a65  cision: for obje
+0000eee0: 6374 2064 696d 656e 7369 6f6e 7320 696e  ct dimensions in
+0000eef0: 2074 6865 206c 6962 7261 7279 2028 6d29   the library (m)
+0000ef00: 2e20 316e 6d20 6279 2064 6566 6175 6c74  . 1nm by default
+0000ef10: 2e0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
+0000ef20: 6d65 7374 616d 703a 2044 6566 6175 6c74  mestamp: Default
+0000ef30: 7320 746f 2032 3031 392d 3130 2d32 352e  s to 2019-10-25.
+0000ef40: 2049 6620 4e6f 6e65 2075 7365 7320 6375   If None uses cu
+0000ef50: 7272 656e 7420 7469 6d65 2e0a 2020 2020  rrent time..    
+0000ef60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ef70: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000ef80: 6164 645f 7069 6e73 2069 6d70 6f72 7420  add_pins import 
+0000ef90: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
+0000efa0: 650a 2020 2020 2020 2020 6672 6f6d 2067  e.        from g
+0000efb0: 6473 6661 6374 6f72 792e 7368 6f77 2069  dsfactory.show i
+0000efc0: 6d70 6f72 7420 7368 6f77 0a0a 2020 2020  mport show..    
+0000efd0: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
+0000efe0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000eff0: 6c66 2e61 6464 5f70 696e 735f 7472 6961  lf.add_pins_tria
+0000f000: 6e67 6c65 280a 2020 2020 2020 2020 2020  ngle(.          
+0000f010: 2020 2020 2020 706f 7274 5f6d 6172 6b65        port_marke
+0000f020: 725f 6c61 7965 723d 706f 7274 5f6d 6172  r_layer=port_mar
+0000f030: 6b65 725f 6c61 7965 722c 206c 6179 6572  ker_layer, layer
+0000f040: 5f6c 6162 656c 3d70 6f72 745f 6d61 726b  _label=port_mark
+0000f050: 6572 5f6c 6179 6572 0a20 2020 2020 2020  er_layer.       
+0000f060: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000f070: 2020 2069 6620 7368 6f77 5f70 6f72 7473     if show_ports
+0000f080: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000f090: 6520 7365 6c66 0a20 2020 2020 2020 2029  e self.        )
+0000f0a0: 0a0a 2020 2020 2020 2020 6966 2073 686f  ..        if sho
+0000f0b0: 775f 7375 6270 6f72 7473 3a0a 2020 2020  w_subports:.    
+0000f0c0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+0000f0d0: 7420 3d20 7365 6c66 2e63 6f70 7928 290a  t = self.copy().
+0000f0e0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+0000f0f0: 6f6e 656e 742e 6e61 6d65 203d 2073 656c  onent.name = sel
+0000f100: 662e 6e61 6d65 0a20 2020 2020 2020 2020  f.name.         
+0000f110: 2020 2066 6f72 2072 6566 6572 656e 6365     for reference
+0000f120: 2069 6e20 636f 6d70 6f6e 656e 742e 7265   in component.re
+0000f130: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
+0000f140: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0000f150: 6e73 7461 6e63 6528 636f 6d70 6f6e 656e  nstance(componen
+0000f160: 742c 2043 6f6d 706f 6e65 6e74 5265 6665  t, ComponentRefe
+0000f170: 7265 6e63 6529 3a0a 2020 2020 2020 2020  rence):.        
+0000f180: 2020 2020 2020 2020 2020 2020 6164 645f              add_
+0000f190: 7069 6e73 5f74 7269 616e 676c 6528 0a20  pins_triangle(. 
 0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1b0: 7661 6c69 6461 7469 6f6e 2028 2263 7263  validation ("crc
-0000f1c0: 3332 222c 2022 6368 6563 6b73 756d 3332  32", "checksum32
-0000f1d0: 222c 204e 6f6e 6529 3a20 7479 7065 206f  ", None): type o
-0000f1e0: 6620 7661 6c69 6461 7469 6f6e 2074 6f20  f validation to 
-0000f1f0: 696e 636c 7564 6520 696e 2074 6865 2073  include in the s
-0000f200: 6176 6564 2066 696c 652e 0a20 2020 2020  aved file..     
-0000f210: 2020 2020 2020 2020 2020 2073 7461 6e64             stand
-0000f220: 6172 645f 7072 6f70 6572 7469 6573 3a20  ard_properties: 
-0000f230: 5374 6f72 6520 7374 616e 6461 7264 204f  Store standard O
-0000f240: 4153 4953 2070 726f 7065 7274 6965 7320  ASIS properties 
-0000f250: 696e 2074 6865 2066 696c 652e 0a0a 2020  in the file...  
-0000f260: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000f270: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000f280: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
-0000f290: 745f 6163 7469 7665 5f70 646b 0a0a 2020  t_active_pdk..  
-0000f2a0: 2020 2020 2020 6966 2067 6473 7061 7468        if gdspath
-0000f2b0: 2061 6e64 2067 6473 6469 723a 0a20 2020   and gdsdir:.   
-0000f2c0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0000f2d0: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-0000f2e0: 2020 2020 2020 2020 2267 6473 7061 7468          "gdspath
-0000f2f0: 2061 6e64 2067 6473 6469 7220 6861 7665   and gdsdir have
-0000f300: 2062 6f74 6820 6265 656e 2073 7065 6369   both been speci
-0000f310: 6669 6564 2e20 6764 7370 6174 6820 7769  fied. gdspath wi
-0000f320: 6c6c 2074 616b 6520 7072 6563 6564 656e  ll take preceden
-0000f330: 6365 2061 6e64 2067 6473 6469 7220 7769  ce and gdsdir wi
-0000f340: 6c6c 2062 6520 6967 6e6f 7265 642e 222c  ll be ignored.",
-0000f350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f360: 2073 7461 636b 6c65 7665 6c3d 332c 0a20   stacklevel=3,. 
-0000f370: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000f380: 2020 2020 2020 6465 6661 756c 745f 7365        default_se
-0000f390: 7474 696e 6773 203d 2067 6574 5f61 6374  ttings = get_act
-0000f3a0: 6976 655f 7064 6b28 292e 6764 735f 7772  ive_pdk().gds_wr
-0000f3b0: 6974 655f 7365 7474 696e 6773 0a20 2020  ite_settings.   
-0000f3c0: 2020 2020 2064 6566 6175 6c74 5f6f 6173       default_oas
-0000f3d0: 6973 5f73 6574 7469 6e67 7320 3d20 6765  is_settings = ge
-0000f3e0: 745f 6163 7469 7665 5f70 646b 2829 2e6f  t_active_pdk().o
-0000f3f0: 6173 6973 5f73 6574 7469 6e67 730a 0a20  asis_settings.. 
-0000f400: 2020 2020 2020 2065 7870 6c69 6369 745f         explicit_
-0000f410: 6764 735f 7365 7474 696e 6773 203d 207b  gds_settings = {
-0000f420: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
-0000f430: 760a 2020 2020 2020 2020 2020 2020 666f  v.            fo
-0000f440: 7220 6b2c 2076 2069 6e20 6b77 6172 6773  r k, v in kwargs
-0000f450: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
-0000f460: 2020 2020 2069 6620 7620 6973 206e 6f74       if v is not
-0000f470: 204e 6f6e 6520 616e 6420 6b20 696e 2064   None and k in d
-0000f480: 6566 6175 6c74 5f73 6574 7469 6e67 732e  efault_settings.
-0000f490: 6469 6374 2829 0a20 2020 2020 2020 207d  dict().        }
-0000f4a0: 0a20 2020 2020 2020 2065 7870 6c69 6369  .        explici
-0000f4b0: 745f 6f61 735f 7365 7474 696e 6773 203d  t_oas_settings =
-0000f4c0: 207b 0a20 2020 2020 2020 2020 2020 206b   {.            k
-0000f4d0: 3a20 760a 2020 2020 2020 2020 2020 2020  : v.            
-0000f4e0: 666f 7220 6b2c 2076 2069 6e20 6b77 6172  for k, v in kwar
-0000f4f0: 6773 2e69 7465 6d73 2829 0a20 2020 2020  gs.items().     
-0000f500: 2020 2020 2020 2069 6620 7620 6973 206e         if v is n
-0000f510: 6f74 204e 6f6e 6520 616e 6420 6b20 696e  ot None and k in
-0000f520: 2064 6566 6175 6c74 5f6f 6173 6973 5f73   default_oasis_s
-0000f530: 6574 7469 6e67 732e 6469 6374 2829 0a20  ettings.dict(). 
-0000f540: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0000f550: 2023 2075 7064 6174 6520 7468 6520 7772   # update the wr
-0000f560: 6974 6520 7365 7474 696e 6773 2077 6974  ite settings wit
-0000f570: 6820 616e 7920 7365 7474 696e 6773 2065  h any settings e
-0000f580: 7870 6c69 6369 746c 7920 7061 7373 6564  xplicitly passed
-0000f590: 0a20 2020 2020 2020 2077 7269 7465 5f73  .        write_s
-0000f5a0: 6574 7469 6e67 7320 3d20 6465 6661 756c  ettings = defaul
-0000f5b0: 745f 7365 7474 696e 6773 2e63 6f70 7928  t_settings.copy(
-0000f5c0: 7570 6461 7465 3d65 7870 6c69 6369 745f  update=explicit_
-0000f5d0: 6764 735f 7365 7474 696e 6773 290a 2020  gds_settings).  
-0000f5e0: 2020 2020 2020 6f61 7369 735f 7365 7474        oasis_sett
-0000f5f0: 696e 6773 203d 2064 6566 6175 6c74 5f6f  ings = default_o
-0000f600: 6173 6973 5f73 6574 7469 6e67 732e 636f  asis_settings.co
-0000f610: 7079 2875 7064 6174 653d 6578 706c 6963  py(update=explic
-0000f620: 6974 5f6f 6173 5f73 6574 7469 6e67 7329  it_oas_settings)
-0000f630: 0a0a 2020 2020 2020 2020 5f63 6865 636b  ..        _check
-0000f640: 5f75 6e63 6163 6865 645f 636f 6d70 6f6e  _uncached_compon
-0000f650: 656e 7473 280a 2020 2020 2020 2020 2020  ents(.          
-0000f660: 2020 636f 6d70 6f6e 656e 743d 7365 6c66    component=self
-0000f670: 2c20 6d6f 6465 3d77 7269 7465 5f73 6574  , mode=write_set
-0000f680: 7469 6e67 732e 6f6e 5f75 6e63 6163 6865  tings.on_uncache
-0000f690: 645f 636f 6d70 6f6e 656e 740a 2020 2020  d_component.    
-0000f6a0: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
-0000f6b0: 6620 7772 6974 655f 7365 7474 696e 6773  f write_settings
-0000f6c0: 2e66 6c61 7474 656e 5f69 6e76 616c 6964  .flatten_invalid
-0000f6d0: 5f72 6566 733a 0a20 2020 2020 2020 2020  _refs:.         
-0000f6e0: 2020 2074 6f70 5f63 656c 6c20 3d20 666c     top_cell = fl
-0000f6f0: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
-0000f700: 6673 5f72 6563 7572 7369 7665 2873 656c  fs_recursive(sel
-0000f710: 6629 0a20 2020 2020 2020 2065 6c73 653a  f).        else:
-0000f720: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
-0000f730: 5f63 656c 6c20 3d20 7365 6c66 0a0a 2020  _cell = self..  
-0000f740: 2020 2020 2020 6764 7364 6972 203d 2067        gdsdir = g
-0000f750: 6473 6469 7220 6f72 2047 4453 4449 525f  dsdir or GDSDIR_
-0000f760: 5445 4d50 0a20 2020 2020 2020 2067 6473  TEMP.        gds
-0000f770: 6469 7220 3d20 7061 7468 6c69 622e 5061  dir = pathlib.Pa
-0000f780: 7468 2867 6473 6469 7229 0a20 2020 2020  th(gdsdir).     
-0000f790: 2020 2069 6620 7769 7468 5f6f 6173 6973     if with_oasis
-0000f7a0: 3a0a 2020 2020 2020 2020 2020 2020 6764  :.            gd
-0000f7b0: 7370 6174 6820 3d20 6764 7370 6174 6820  spath = gdspath 
-0000f7c0: 6f72 2067 6473 6469 7220 2f20 6622 7b74  or gdsdir / f"{t
-0000f7d0: 6f70 5f63 656c 6c2e 6e61 6d65 7d2e 6f61  op_cell.name}.oa
-0000f7e0: 7322 0a20 2020 2020 2020 2065 6c73 653a  s".        else:
-0000f7f0: 0a20 2020 2020 2020 2020 2020 2067 6473  .            gds
-0000f800: 7061 7468 203d 2067 6473 7061 7468 206f  path = gdspath o
-0000f810: 7220 6764 7364 6972 202f 2066 227b 746f  r gdsdir / f"{to
-0000f820: 705f 6365 6c6c 2e6e 616d 657d 2e67 6473  p_cell.name}.gds
-0000f830: 220a 2020 2020 2020 2020 6764 7370 6174  ".        gdspat
-0000f840: 6820 3d20 7061 7468 6c69 622e 5061 7468  h = pathlib.Path
-0000f850: 2867 6473 7061 7468 290a 2020 2020 2020  (gdspath).      
-0000f860: 2020 6764 7364 6972 203d 2067 6473 7061    gdsdir = gdspa
-0000f870: 7468 2e70 6172 656e 740a 2020 2020 2020  th.parent.      
-0000f880: 2020 6764 7364 6972 2e6d 6b64 6972 2865    gdsdir.mkdir(e
-0000f890: 7869 7374 5f6f 6b3d 5472 7565 2c20 7061  xist_ok=True, pa
-0000f8a0: 7265 6e74 733d 5472 7565 290a 0a20 2020  rents=True)..   
-0000f8b0: 2020 2020 2063 656c 6c73 203d 2074 6f70       cells = top
-0000f8c0: 5f63 656c 6c2e 6765 745f 6465 7065 6e64  _cell.get_depend
-0000f8d0: 656e 6369 6573 2872 6563 7572 7369 7665  encies(recursive
-0000f8e0: 3d54 7275 6529 0a20 2020 2020 2020 2063  =True).        c
-0000f8f0: 656c 6c5f 6e61 6d65 7320 3d20 5b63 656c  ell_names = [cel
-0000f900: 6c2e 6e61 6d65 2066 6f72 2063 656c 6c20  l.name for cell 
-0000f910: 696e 206c 6973 7428 6365 6c6c 7329 5d0a  in list(cells)].
-0000f920: 2020 2020 2020 2020 6365 6c6c 5f6e 616d          cell_nam
-0000f930: 6573 5f75 6e69 7175 6520 3d20 7365 7428  es_unique = set(
-0000f940: 6365 6c6c 5f6e 616d 6573 290a 0a20 2020  cell_names)..   
-0000f950: 2020 2020 2069 6620 6c65 6e28 6365 6c6c       if len(cell
-0000f960: 5f6e 616d 6573 2920 213d 206c 656e 2873  _names) != len(s
-0000f970: 6574 2863 656c 6c5f 6e61 6d65 7329 293a  et(cell_names)):
-0000f980: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000f990: 2063 656c 6c5f 6e61 6d65 2069 6e20 6365   cell_name in ce
-0000f9a0: 6c6c 5f6e 616d 6573 5f75 6e69 7175 653a  ll_names_unique:
-0000f9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f9c0: 2063 656c 6c5f 6e61 6d65 732e 7265 6d6f   cell_names.remo
-0000f9d0: 7665 2863 656c 6c5f 6e61 6d65 290a 0a20  ve(cell_name).. 
-0000f9e0: 2020 2020 2020 2020 2020 2069 6620 7772             if wr
-0000f9f0: 6974 655f 7365 7474 696e 6773 2e6f 6e5f  ite_settings.on_
-0000fa00: 6475 706c 6963 6174 655f 6365 6c6c 203d  duplicate_cell =
-0000fa10: 3d20 2265 7272 6f72 223a 0a20 2020 2020  = "error":.     
-0000fa20: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000fa30: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0000fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa50: 2066 2244 7570 6c69 6361 7465 6420 6365   f"Duplicated ce
-0000fa60: 6c6c 206e 616d 6573 2069 6e20 7b74 6f70  ll names in {top
-0000fa70: 5f63 656c 6c2e 6e61 6d65 2172 7d3a 207b  _cell.name!r}: {
-0000fa80: 6365 6c6c 5f6e 616d 6573 2172 7d22 0a20  cell_names!r}". 
-0000fa90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000faa0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000fab0: 6620 7772 6974 655f 7365 7474 696e 6773  f write_settings
-0000fac0: 2e6f 6e5f 6475 706c 6963 6174 655f 6365  .on_duplicate_ce
-0000fad0: 6c6c 2069 6e20 7b22 7761 726e 222c 2022  ll in {"warn", "
-0000fae0: 6f76 6572 7772 6974 6522 7d3a 0a20 2020  overwrite"}:.   
-0000faf0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000fb00: 7772 6974 655f 7365 7474 696e 6773 2e6f  write_settings.o
-0000fb10: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
-0000fb20: 203d 3d20 2277 6172 6e22 3a0a 2020 2020   == "warn":.    
-0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb40: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-0000fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb60: 2020 2020 2020 2066 2244 7570 6c69 6361         f"Duplica
-0000fb70: 7465 6420 6365 6c6c 206e 616d 6573 2069  ted cell names i
-0000fb80: 6e20 7b74 6f70 5f63 656c 6c2e 6e61 6d65  n {top_cell.name
-0000fb90: 2172 7d3a 2020 7b63 656c 6c5f 6e61 6d65  !r}:  {cell_name
-0000fba0: 737d 222c 0a20 2020 2020 2020 2020 2020  s}",.           
-0000fbb0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-0000fbc0: 636b 6c65 7665 6c3d 332c 0a20 2020 2020  cklevel=3,.     
-0000fbd0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000fbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fbf0: 2063 656c 6c73 5f64 6963 7420 3d20 7b63   cells_dict = {c
-0000fc00: 656c 6c2e 6e61 6d65 3a20 6365 6c6c 2e5f  ell.name: cell._
-0000fc10: 6365 6c6c 2066 6f72 2063 656c 6c20 696e  cell for cell in
-0000fc20: 2063 656c 6c73 7d0a 2020 2020 2020 2020   cells}.        
-0000fc30: 2020 2020 2020 2020 6365 6c6c 7320 3d20          cells = 
-0000fc40: 6365 6c6c 735f 6469 6374 2e76 616c 7565  cells_dict.value
-0000fc50: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0000fc60: 656c 6966 2077 7269 7465 5f73 6574 7469  elif write_setti
-0000fc70: 6e67 732e 6f6e 5f64 7570 6c69 6361 7465  ngs.on_duplicate
-0000fc80: 5f63 656c 6c20 6973 206e 6f74 204e 6f6e  _cell is not Non
-0000fc90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000fca0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000fcb0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000fcc0: 2020 2020 2020 2020 2066 226f 6e5f 6475           f"on_du
-0000fcd0: 706c 6963 6174 655f 6365 6c6c 3a20 7b77  plicate_cell: {w
-0000fce0: 7269 7465 5f73 6574 7469 6e67 732e 6f6e  rite_settings.on
-0000fcf0: 5f64 7570 6c69 6361 7465 5f63 656c 6c21  _duplicate_cell!
-0000fd00: 727d 206e 6f74 2069 6e20 284e 6f6e 652c  r} not in (None,
-0000fd10: 2077 6172 6e2c 2065 7272 6f72 2c20 6f76   warn, error, ov
-0000fd20: 6572 7772 6974 6529 220a 2020 2020 2020  erwrite)".      
-0000fd30: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000fd40: 2020 2020 2061 6c6c 5f63 656c 6c73 203d       all_cells =
-0000fd50: 205b 746f 705f 6365 6c6c 2e5f 6365 6c6c   [top_cell._cell
-0000fd60: 5d20 2b20 736f 7274 6564 2863 656c 6c73  ] + sorted(cells
-0000fd70: 2c20 6b65 793d 6c61 6d62 6461 2063 633a  , key=lambda cc:
-0000fd80: 2063 632e 6e61 6d65 290a 0a20 2020 2020   cc.name)..     
-0000fd90: 2020 206e 6f5f 6e61 6d65 5f63 656c 6c73     no_name_cells
-0000fda0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-0000fdb0: 2063 656c 6c2e 6e61 6d65 2066 6f72 2063   cell.name for c
-0000fdc0: 656c 6c20 696e 2061 6c6c 5f63 656c 6c73  ell in all_cells
-0000fdd0: 2069 6620 6365 6c6c 2e6e 616d 652e 7374   if cell.name.st
-0000fde0: 6172 7473 7769 7468 2822 556e 6e61 6d65  artswith("Unname
-0000fdf0: 6422 290a 2020 2020 2020 2020 5d0a 0a20  d").        ].. 
-0000fe00: 2020 2020 2020 2069 6620 6e6f 5f6e 616d         if no_nam
-0000fe10: 655f 6365 6c6c 733a 0a20 2020 2020 2020  e_cells:.       
-0000fe20: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-0000fe30: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
-0000fe40: 2020 2020 6622 436f 6d70 6f6e 656e 7420      f"Component 
-0000fe50: 7b74 6f70 5f63 656c 6c2e 6e61 6d65 2172  {top_cell.name!r
-0000fe60: 7d20 636f 6e74 6169 6e73 207b 6c65 6e28  } contains {len(
-0000fe70: 6e6f 5f6e 616d 655f 6365 6c6c 7329 7d20  no_name_cells)} 
-0000fe80: 556e 6e61 6d65 6420 6365 6c6c 7322 2c0a  Unnamed cells",.
-0000fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fea0: 7374 6163 6b6c 6576 656c 3d33 2c0a 2020  stacklevel=3,.  
-0000feb0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000fec0: 2020 2020 2023 2066 6f72 2063 656c 6c20       # for cell 
-0000fed0: 696e 2061 6c6c 5f63 656c 6c73 3a0a 2020  in all_cells:.  
-0000fee0: 2020 2020 2020 2320 2020 2020 7072 696e        #     prin
-0000fef0: 7428 6365 6c6c 2e6e 616d 652c 2074 7970  t(cell.name, typ
-0000ff00: 6528 6365 6c6c 2929 0a0a 2020 2020 2020  e(cell))..      
-0000ff10: 2020 6c69 6220 3d20 6764 7374 6b2e 4c69    lib = gdstk.Li
-0000ff20: 6272 6172 7928 0a20 2020 2020 2020 2020  brary(.         
-0000ff30: 2020 2075 6e69 743d 7772 6974 655f 7365     unit=write_se
-0000ff40: 7474 696e 6773 2e75 6e69 742c 2070 7265  ttings.unit, pre
-0000ff50: 6369 7369 6f6e 3d77 7269 7465 5f73 6574  cision=write_set
-0000ff60: 7469 6e67 732e 7072 6563 6973 696f 6e0a  tings.precision.
-0000ff70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000ff80: 2020 6c69 622e 6164 6428 746f 705f 6365    lib.add(top_ce
-0000ff90: 6c6c 2e5f 6365 6c6c 290a 2020 2020 2020  ll._cell).      
-0000ffa0: 2020 6c69 622e 6164 6428 2a74 6f70 5f63    lib.add(*top_c
-0000ffb0: 656c 6c2e 5f63 656c 6c2e 6465 7065 6e64  ell._cell.depend
-0000ffc0: 656e 6369 6573 2854 7275 6529 290a 0a20  encies(True)).. 
-0000ffd0: 2020 2020 2020 2069 6620 7769 7468 5f6f         if with_o
-0000ffe0: 6173 6973 3a0a 2020 2020 2020 2020 2020  asis:.          
-0000fff0: 2020 6c69 622e 7772 6974 655f 6f61 7328    lib.write_oas(
-00010000: 6764 7370 6174 682c 202a 2a6f 6173 6973  gdspath, **oasis
-00010010: 5f73 6574 7469 6e67 732e 6469 6374 2829  _settings.dict()
-00010020: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00010030: 2020 2020 2020 2020 2020 2020 6c69 622e              lib.
-00010040: 7772 6974 655f 6764 7328 0a20 2020 2020  write_gds(.     
-00010050: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
-00010060: 7468 2c20 7469 6d65 7374 616d 703d 7469  th, timestamp=ti
-00010070: 6d65 7374 616d 702c 206d 6178 5f70 6f69  mestamp, max_poi
-00010080: 6e74 733d 7772 6974 655f 7365 7474 696e  nts=write_settin
-00010090: 6773 2e6d 6178 5f70 6f69 6e74 730a 2020  gs.max_points.  
-000100a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000100b0: 2020 2020 6966 206c 6f67 6769 6e67 3a0a      if logging:.
-000100c0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-000100d0: 6572 2e69 6e66 6f28 6622 5772 6f74 6520  er.info(f"Wrote 
-000100e0: 746f 207b 7374 7228 6764 7370 6174 6829  to {str(gdspath)
-000100f0: 2172 7d22 290a 2020 2020 2020 2020 6966  !r}").        if
-00010100: 2077 6974 685f 6d65 7461 6461 7461 3a0a   with_metadata:.
-00010110: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
-00010120: 6461 7461 203d 2067 6473 7061 7468 2e77  data = gdspath.w
-00010130: 6974 685f 7375 6666 6978 2822 2e79 6d6c  ith_suffix(".yml
-00010140: 2229 0a20 2020 2020 2020 2020 2020 206d  ").            m
-00010150: 6574 6164 6174 612e 7772 6974 655f 7465  etadata.write_te
-00010160: 7874 2873 656c 662e 746f 5f79 616d 6c28  xt(self.to_yaml(
-00010170: 7769 7468 5f63 656c 6c73 3d54 7275 652c  with_cells=True,
-00010180: 2077 6974 685f 706f 7274 733d 5472 7565   with_ports=True
-00010190: 2929 0a20 2020 2020 2020 2020 2020 206c  )).            l
-000101a0: 6f67 6765 722e 696e 666f 2866 2257 7269  ogger.info(f"Wri
-000101b0: 7465 2059 414d 4c20 6d65 7461 6461 7461  te YAML metadata
-000101c0: 2074 6f20 7b73 7472 286d 6574 6164 6174   to {str(metadat
-000101d0: 6129 2172 7d22 290a 0a20 2020 2020 2020  a)!r}")..       
-000101e0: 2072 6574 7572 6e20 6764 7370 6174 680a   return gdspath.
-000101f0: 0a20 2020 2064 6566 2077 7269 7465 5f67  .    def write_g
-00010200: 6473 280a 2020 2020 2020 2020 7365 6c66  ds(.        self
-00010210: 2c0a 2020 2020 2020 2020 6764 7370 6174  ,.        gdspat
-00010220: 683a 204f 7074 696f 6e61 6c5b 5061 7468  h: Optional[Path
-00010230: 5479 7065 5d20 3d20 4e6f 6e65 2c0a 2020  Type] = None,.  
-00010240: 2020 2020 2020 6764 7364 6972 3a20 4f70        gdsdir: Op
-00010250: 7469 6f6e 616c 5b50 6174 6854 7970 655d  tional[PathType]
-00010260: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00010270: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
-00010280: 202d 3e20 5061 7468 3a0a 2020 2020 2020   -> Path:.      
-00010290: 2020 2222 2257 7269 7465 2063 6f6d 706f    """Write compo
-000102a0: 6e65 6e74 2074 6f20 4744 5320 616e 6420  nent to GDS and 
-000102b0: 7265 7475 726e 7320 6764 7370 6174 682e  returns gdspath.
-000102c0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-000102d0: 2020 2020 2020 2020 2020 2020 6764 7370              gdsp
-000102e0: 6174 683a 2047 4453 2066 696c 6520 7061  ath: GDS file pa
-000102f0: 7468 2074 6f20 7772 6974 6520 746f 2e0a  th to write to..
-00010300: 2020 2020 2020 2020 2020 2020 6764 7364              gdsd
-00010310: 6972 3a20 6469 7265 6374 6f72 7920 666f  ir: directory fo
-00010320: 7220 7468 6520 4744 5320 6669 6c65 2e20  r the GDS file. 
-00010330: 4465 6661 756c 7473 2074 6f20 2f74 6d70  Defaults to /tmp
-00010340: 2f72 616e 646f 6d46 696c 652f 6764 7366  /randomFile/gdsf
-00010350: 6163 746f 7279 2e0a 0a20 2020 2020 2020  actory...       
-00010360: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
-00010370: 2020 2020 2020 2020 2020 2075 6e69 743a             unit:
-00010380: 2075 6e69 7420 7369 7a65 2066 6f72 206f   unit size for o
-00010390: 626a 6563 7473 2069 6e20 6c69 6272 6172  bjects in librar
-000103a0: 792e 2031 756d 2062 7920 6465 6661 756c  y. 1um by defaul
-000103b0: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
-000103c0: 7265 6369 7369 6f6e 3a20 666f 7220 6469  recision: for di
-000103d0: 6d65 6e73 696f 6e73 2069 6e20 7468 6520  mensions in the 
-000103e0: 6c69 6272 6172 7920 286d 292e 2031 6e6d  library (m). 1nm
-000103f0: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
-00010400: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
-00010410: 3a20 6469 7361 626c 6520 4744 5320 7061  : disable GDS pa
-00010420: 7468 206c 6f67 6769 6e67 2c20 666f 7220  th logging, for 
-00010430: 6578 616d 706c 6520 666f 7220 7368 6f77  example for show
-00010440: 696e 6720 6974 2069 6e20 4b4c 6179 6f75  ing it in KLayou
-00010450: 742e 0a20 2020 2020 2020 2020 2020 206f  t..            o
-00010460: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
-00010470: 3a20 7370 6563 6966 7920 686f 7720 746f  : specify how to
-00010480: 2072 6573 6f6c 7665 2064 7570 6c69 6361   resolve duplica
-00010490: 7465 2d6e 616d 6564 2063 656c 6c73 2e20  te-named cells. 
-000104a0: 4368 6f6f 7365 206f 6e65 206f 6620 7468  Choose one of th
-000104b0: 6520 666f 6c6c 6f77 696e 673a 0a20 2020  e following:.   
-000104c0: 2020 2020 2020 2020 2020 2020 2022 7761               "wa
-000104d0: 726e 2220 2864 6566 6175 6c74 293a 206f  rn" (default): o
-000104e0: 7665 7277 7269 7465 2061 6c6c 2064 7570  verwrite all dup
-000104f0: 6c69 6361 7465 2063 656c 6c73 2077 6974  licate cells wit
-00010500: 6820 6f6e 6520 6f66 2074 6865 2064 7570  h one of the dup
-00010510: 6c69 6361 7465 7320 2861 7262 6974 7261  licates (arbitra
-00010520: 7269 6c79 292e 0a20 2020 2020 2020 2020  rily)..         
-00010530: 2020 2020 2020 2022 6572 726f 7222 3a20         "error": 
-00010540: 7468 726f 7720 6120 5661 6c75 6545 7272  throw a ValueErr
-00010550: 6f72 2077 6865 6e20 6174 7465 6d70 7469  or when attempti
-00010560: 6e67 2074 6f20 7772 6974 6520 6120 6764  ng to write a gd
-00010570: 7320 7769 7468 2064 7570 6c69 6361 7465  s with duplicate
-00010580: 2063 656c 6c73 2e0a 2020 2020 2020 2020   cells..        
-00010590: 2020 2020 2020 2020 226f 7665 7277 7269          "overwri
-000105a0: 7465 223a 206f 7665 7277 7269 7465 2061  te": overwrite a
-000105b0: 6c6c 2064 7570 6c69 6361 7465 2063 656c  ll duplicate cel
-000105c0: 6c73 2077 6974 6820 6f6e 6520 6f66 2074  ls with one of t
-000105d0: 6865 2064 7570 6c69 6361 7465 732c 2077  he duplicates, w
-000105e0: 6974 686f 7574 2077 6172 6e69 6e67 2e0a  ithout warning..
-000105f0: 2020 2020 2020 2020 2020 2020 6f6e 5f75              on_u
-00010600: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
-00010610: 743a 204c 6974 6572 616c 5b22 7761 726e  t: Literal["warn
-00010620: 222c 2022 6572 726f 7222 5d20 3d20 2277  ", "error"] = "w
-00010630: 6172 6e22 0a20 2020 2020 2020 2020 2020  arn".           
-00010640: 2066 6c61 7474 656e 5f69 6e76 616c 6964   flatten_invalid
-00010650: 5f72 6566 733a 2066 6c61 7474 656e 7320  _refs: flattens 
-00010660: 636f 6d70 6f6e 656e 7420 7265 6665 7265  component refere
-00010670: 6e63 6573 2077 6869 6368 2068 6176 6520  nces which have 
-00010680: 696e 7661 6c69 6420 7472 616e 7366 6f72  invalid transfor
-00010690: 6d61 7469 6f6e 732e 0a20 2020 2020 2020  mations..       
-000106a0: 2020 2020 206d 6178 5f70 6f69 6e74 733a       max_points:
-000106b0: 204d 6178 696d 616c 206e 756d 6265 7220   Maximal number 
-000106c0: 6f66 2076 6572 7469 6365 7320 7065 7220  of vertices per 
-000106d0: 706f 6c79 676f 6e2e 0a20 2020 2020 2020  polygon..       
-000106e0: 2020 2020 2020 2020 2050 6f6c 7967 6f6e           Polygon
-000106f0: 7320 7769 7468 206d 6f72 6520 7665 7274  s with more vert
-00010700: 6963 6573 2074 6861 7420 7468 6973 2061  ices that this a
-00010710: 7265 2061 7574 6f6d 6174 6963 616c 6c79  re automatically
-00010720: 2066 7261 6374 7572 6564 2e0a 2020 2020   fractured..    
-00010730: 2020 2020 2020 2020 7769 7468 5f6d 6574          with_met
-00010740: 6164 6174 613a 2077 7269 7465 7320 6d65  adata: writes me
-00010750: 7461 6461 7461 2069 6e20 5941 4d4c 2066  tadata in YAML f
-00010760: 6f72 6d61 742e 0a20 2020 2020 2020 2022  ormat..        "
-00010770: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-00010780: 726e 2073 656c 662e 5f77 7269 7465 5f6c  rn self._write_l
-00010790: 6962 7261 7279 280a 2020 2020 2020 2020  ibrary(.        
-000107a0: 2020 2020 6764 7370 6174 683d 6764 7370      gdspath=gdsp
-000107b0: 6174 682c 2067 6473 6469 723d 6764 7364  ath, gdsdir=gdsd
-000107c0: 6972 2c20 7769 7468 5f6f 6173 6973 3d46  ir, with_oasis=F
-000107d0: 616c 7365 2c20 2a2a 6b77 6172 6773 0a20  alse, **kwargs. 
-000107e0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000107f0: 6620 7772 6974 655f 6f61 7328 0a20 2020  f write_oas(.   
-00010800: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00010810: 2020 2067 6473 7061 7468 3a20 4f70 7469     gdspath: Opti
-00010820: 6f6e 616c 5b50 6174 6854 7970 655d 203d  onal[PathType] =
-00010830: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
-00010840: 6473 6469 723a 204f 7074 696f 6e61 6c5b  dsdir: Optional[
-00010850: 5061 7468 5479 7065 5d20 3d20 4e6f 6e65  PathType] = None
-00010860: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
-00010870: 6773 2c0a 2020 2020 2920 2d3e 2050 6174  gs,.    ) -> Pat
-00010880: 683a 0a20 2020 2020 2020 2022 2222 5772  h:.        """Wr
-00010890: 6974 6520 636f 6d70 6f6e 656e 7420 746f  ite component to
-000108a0: 2047 4453 2061 6e64 2072 6574 7572 6e73   GDS and returns
-000108b0: 2067 6473 7061 7468 2e0a 0a20 2020 2020   gdspath...     
-000108c0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-000108d0: 2020 2020 2067 6473 7061 7468 3a20 4744       gdspath: GD
-000108e0: 5320 6669 6c65 2070 6174 6820 746f 2077  S file path to w
-000108f0: 7269 7465 2074 6f2e 0a20 2020 2020 2020  rite to..       
-00010900: 2020 2020 2067 6473 6469 723a 2064 6972       gdsdir: dir
-00010910: 6563 746f 7279 2066 6f72 2074 6865 2047  ectory for the G
-00010920: 4453 2066 696c 652e 2044 6566 6175 6c74  DS file. Default
-00010930: 7320 746f 202f 746d 702f 7261 6e64 6f6d  s to /tmp/random
-00010940: 4669 6c65 2f67 6473 6661 6374 6f72 792e  File/gdsfactory.
-00010950: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
-00010960: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
-00010970: 2020 2020 756e 6974 3a20 756e 6974 2073      unit: unit s
-00010980: 697a 6520 666f 7220 6f62 6a65 6374 7320  ize for objects 
-00010990: 696e 206c 6962 7261 7279 2e20 3175 6d20  in library. 1um 
-000109a0: 6279 2064 6566 6175 6c74 2e0a 2020 2020  by default..    
-000109b0: 2020 2020 2020 2020 7072 6563 6973 696f          precisio
-000109c0: 6e3a 2066 6f72 2064 696d 656e 7369 6f6e  n: for dimension
-000109d0: 7320 696e 2074 6865 206c 6962 7261 7279  s in the library
-000109e0: 2028 6d29 2e20 316e 6d20 6279 2064 6566   (m). 1nm by def
-000109f0: 6175 6c74 2e0a 2020 2020 2020 2020 2020  ault..          
-00010a00: 2020 6c6f 6767 696e 673a 2064 6973 6162    logging: disab
-00010a10: 6c65 2047 4453 2070 6174 6820 6c6f 6767  le GDS path logg
-00010a20: 696e 672c 2066 6f72 2065 7861 6d70 6c65  ing, for example
-00010a30: 2066 6f72 2073 686f 7769 6e67 2069 7420   for showing it 
-00010a40: 696e 204b 4c61 796f 7574 2e0a 2020 2020  in KLayout..    
-00010a50: 2020 2020 2020 2020 6f6e 5f64 7570 6c69          on_dupli
-00010a60: 6361 7465 5f63 656c 6c3a 2073 7065 6369  cate_cell: speci
-00010a70: 6679 2068 6f77 2074 6f20 7265 736f 6c76  fy how to resolv
-00010a80: 6520 6475 706c 6963 6174 652d 6e61 6d65  e duplicate-name
-00010a90: 6420 6365 6c6c 732e 2043 686f 6f73 6520  d cells. Choose 
-00010aa0: 6f6e 6520 6f66 2074 6865 2066 6f6c 6c6f  one of the follo
-00010ab0: 7769 6e67 3a0a 2020 2020 2020 2020 2020  wing:.          
-00010ac0: 2020 2020 2020 2277 6172 6e22 2028 6465        "warn" (de
-00010ad0: 6661 756c 7429 3a20 6f76 6572 7772 6974  fault): overwrit
-00010ae0: 6520 616c 6c20 6475 706c 6963 6174 6520  e all duplicate 
-00010af0: 6365 6c6c 7320 7769 7468 206f 6e65 206f  cells with one o
-00010b00: 6620 7468 6520 6475 706c 6963 6174 6573  f the duplicates
-00010b10: 2028 6172 6269 7472 6172 696c 7929 2e0a   (arbitrarily)..
-00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b30: 2265 7272 6f72 223a 2074 6872 6f77 2061  "error": throw a
-00010b40: 2056 616c 7565 4572 726f 7220 7768 656e   ValueError when
-00010b50: 2061 7474 656d 7074 696e 6720 746f 2077   attempting to w
-00010b60: 7269 7465 2061 2067 6473 2077 6974 6820  rite a gds with 
-00010b70: 6475 706c 6963 6174 6520 6365 6c6c 732e  duplicate cells.
-00010b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010b90: 2022 6f76 6572 7772 6974 6522 3a20 6f76   "overwrite": ov
-00010ba0: 6572 7772 6974 6520 616c 6c20 6475 706c  erwrite all dupl
-00010bb0: 6963 6174 6520 6365 6c6c 7320 7769 7468  icate cells with
-00010bc0: 206f 6e65 206f 6620 7468 6520 6475 706c   one of the dupl
-00010bd0: 6963 6174 6573 2c20 7769 7468 6f75 7420  icates, without 
-00010be0: 7761 726e 696e 672e 0a20 2020 2020 2020  warning..       
-00010bf0: 2020 2020 2020 2020 204e 6f6e 653a 2064           None: d
-00010c00: 6f20 6e6f 7420 7472 7920 746f 2072 6573  o not try to res
-00010c10: 6f6c 7665 2028 6174 2079 6f75 7220 6f77  olve (at your ow
-00010c20: 6e20 7269 736b 2129 0a20 2020 2020 2020  n risk!).       
-00010c30: 2020 2020 206f 6e5f 756e 6361 6368 6564       on_uncached
-00010c40: 5f63 6f6d 706f 6e65 6e74 3a20 4c69 7465  _component: Lite
-00010c50: 7261 6c5b 2277 6172 6e22 2c20 2265 7272  ral["warn", "err
-00010c60: 6f72 225d 203d 2022 7761 726e 220a 2020  or"] = "warn".  
-00010c70: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
-00010c80: 6e5f 696e 7661 6c69 645f 7265 6673 3a20  n_invalid_refs: 
-00010c90: 666c 6174 7465 6e73 2063 6f6d 706f 6e65  flattens compone
-00010ca0: 6e74 2072 6566 6572 656e 6365 7320 7768  nt references wh
-00010cb0: 6963 6820 6861 7665 2069 6e76 616c 6964  ich have invalid
-00010cc0: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
-00010cd0: 2e0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00010ce0: 6d70 7265 7373 696f 6e5f 6c65 7665 6c3a  mpression_level:
-00010cf0: 204c 6576 656c 206f 6620 636f 6d70 7265   Level of compre
-00010d00: 7373 696f 6e20 666f 7220 6365 6c6c 7320  ssion for cells 
-00010d10: 2862 6574 7765 656e 2030 2061 6e64 2039  (between 0 and 9
-00010d20: 292e 0a20 2020 2020 2020 2020 2020 2020  )..             
-00010d30: 2020 2053 6574 7469 6e67 2074 6f20 3020     Setting to 0 
-00010d40: 7769 6c6c 2064 6973 6162 6c65 2063 656c  will disable cel
-00010d50: 6c20 636f 6d70 7265 7373 696f 6e2c 2031  l compression, 1
-00010d60: 2067 6976 6573 2074 6865 2062 6573 7420   gives the best 
-00010d70: 7370 6565 6420 616e 6420 392c 2074 6865  speed and 9, the
-00010d80: 2062 6573 7420 636f 6d70 7265 7373 696f   best compressio
-00010d90: 6e2e 0a20 2020 2020 2020 2020 2020 2064  n..            d
-00010da0: 6574 6563 745f 7265 6374 616e 676c 6573  etect_rectangles
-00010db0: 3a20 5374 6f72 6520 7265 6374 616e 676c  : Store rectangl
-00010dc0: 6573 2069 6e20 636f 6d70 7265 7373 6564  es in compressed
-00010dd0: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
-00010de0: 2020 2020 2064 6574 6563 745f 7472 6170       detect_trap
-00010df0: 657a 6f69 6473 3a20 5374 6f72 6520 7472  ezoids: Store tr
-00010e00: 6170 657a 6f69 6473 2069 6e20 636f 6d70  apezoids in comp
-00010e10: 7265 7373 6564 2066 6f72 6d61 742e 0a20  ressed format.. 
-00010e20: 2020 2020 2020 2020 2020 2063 6972 636c             circl
-00010e30: 655f 746f 6c65 7261 6e63 653a 2054 6f6c  e_tolerance: Tol
-00010e40: 6572 616e 6365 2066 6f72 2064 6574 6563  erance for detec
-00010e50: 7469 6e67 2063 6972 636c 6573 2e20 4966  ting circles. If
-00010e60: 206c 6573 7320 6f72 2065 7175 616c 2074   less or equal t
-00010e70: 6f20 302c 206e 6f20 6465 7465 6374 696f  o 0, no detectio
-00010e80: 6e20 6973 2070 6572 666f 726d 6564 2e0a  n is performed..
-00010e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ea0: 4369 7263 6c65 7320 6172 6520 7374 6f72  Circles are stor
-00010eb0: 6564 2069 6e20 636f 6d70 7265 7373 6564  ed in compressed
-00010ec0: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
-00010ed0: 2020 2020 2076 616c 6964 6174 696f 6e20       validation 
-00010ee0: 2822 6372 6333 3222 2c20 2263 6865 636b  ("crc32", "check
-00010ef0: 7375 6d33 3222 2c20 4e6f 6e65 2920 e280  sum32", None) ..
-00010f00: 9320 7479 7065 206f 6620 7661 6c69 6461  . type of valida
-00010f10: 7469 6f6e 2074 6f20 696e 636c 7564 6520  tion to include 
-00010f20: 696e 2074 6865 2073 6176 6564 2066 696c  in the saved fil
-00010f30: 652e 0a20 2020 2020 2020 2020 2020 2073  e..            s
-00010f40: 7461 6e64 6172 645f 7072 6f70 6572 7469  tandard_properti
-00010f50: 6573 3a20 5374 6f72 6520 7374 616e 6461  es: Store standa
-00010f60: 7264 204f 4153 4953 2070 726f 7065 7274  rd OASIS propert
-00010f70: 6965 7320 696e 2074 6865 2066 696c 652e  ies in the file.
-00010f80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00010f90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00010fa0: 2e5f 7772 6974 655f 6c69 6272 6172 7928  ._write_library(
-00010fb0: 0a20 2020 2020 2020 2020 2020 2067 6473  .            gds
-00010fc0: 7061 7468 3d67 6473 7061 7468 2c0a 2020  path=gdspath,.  
-00010fd0: 2020 2020 2020 2020 2020 6764 7364 6972            gdsdir
-00010fe0: 3d67 6473 6469 722c 0a20 2020 2020 2020  =gdsdir,.       
-00010ff0: 2020 2020 2077 6974 685f 6f61 7369 733d       with_oasis=
-00011000: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-00011010: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-00011020: 2020 2020 290a 0a20 2020 2064 6566 2077      )..    def w
-00011030: 7269 7465 5f67 6473 5f77 6974 685f 6d65  rite_gds_with_me
-00011040: 7461 6461 7461 2873 656c 662c 202a 6172  tadata(self, *ar
-00011050: 6773 2c20 2a2a 6b77 6172 6773 2920 2d3e  gs, **kwargs) ->
-00011060: 2050 6174 683a 0a20 2020 2020 2020 2022   Path:.        "
-00011070: 2222 5772 6974 6520 636f 6d70 6f6e 656e  ""Write componen
-00011080: 7420 696e 2047 4453 2061 6e64 206d 6574  t in GDS and met
-00011090: 6164 6174 6120 2863 6f6d 706f 6e65 6e74  adata (component
-000110a0: 2073 6574 7469 6e67 7329 2069 6e20 5941   settings) in YA
-000110b0: 4d4c 2e22 2222 0a20 2020 2020 2020 2077  ML.""".        w
-000110c0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-000110d0: 2020 2020 2020 2020 2020 2243 6f6d 706f            "Compo
-000110e0: 6e65 6e74 2e77 7269 7465 5f67 6473 5f77  nent.write_gds_w
-000110f0: 6974 685f 6d65 7461 6461 7461 2829 2069  ith_metadata() i
-00011100: 7320 6465 7072 6563 6174 6564 2e20 220a  s deprecated. ".
-00011110: 2020 2020 2020 2020 2020 2020 2255 7365              "Use
-00011120: 2043 6f6d 706f 6e65 6e74 2e77 7269 7465   Component.write
-00011130: 5f67 6473 2877 6974 685f 6d65 7461 6461  _gds(with_metada
-00011140: 7461 3d54 7275 6529 206f 7220 436f 6d70  ta=True) or Comp
-00011150: 6f6e 656e 742e 7772 6974 655f 6f61 7328  onent.write_oas(
-00011160: 7769 7468 5f6d 6574 6164 6174 613d 5472  with_metadata=Tr
-00011170: 7565 292e 222c 0a20 2020 2020 2020 2020  ue).",.         
-00011180: 2020 2073 7461 636b 6c65 7665 6c3d 332c     stacklevel=3,
-00011190: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000111a0: 2020 2067 6473 7061 7468 203d 2073 656c     gdspath = sel
-000111b0: 662e 7772 6974 655f 6764 7328 2a61 7267  f.write_gds(*arg
-000111c0: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
-000111d0: 2020 2020 206d 6574 6164 6174 6120 3d20       metadata = 
-000111e0: 6764 7370 6174 682e 7769 7468 5f73 7566  gdspath.with_suf
-000111f0: 6669 7828 222e 796d 6c22 290a 2020 2020  fix(".yml").    
-00011200: 2020 2020 6d65 7461 6461 7461 2e77 7269      metadata.wri
-00011210: 7465 5f74 6578 7428 7365 6c66 2e74 6f5f  te_text(self.to_
-00011220: 7961 6d6c 2877 6974 685f 6365 6c6c 733d  yaml(with_cells=
-00011230: 5472 7565 2c20 7769 7468 5f70 6f72 7473  True, with_ports
-00011240: 3d54 7275 6529 290a 2020 2020 2020 2020  =True)).        
-00011250: 6c6f 6767 6572 2e69 6e66 6f28 6622 5772  logger.info(f"Wr
-00011260: 6974 6520 5941 4d4c 206d 6574 6164 6174  ite YAML metadat
-00011270: 6120 746f 207b 7374 7228 6d65 7461 6461  a to {str(metada
-00011280: 7461 2921 727d 2229 0a20 2020 2020 2020  ta)!r}").       
-00011290: 2072 6574 7572 6e20 6764 7370 6174 680a   return gdspath.
-000112a0: 0a20 2020 2064 6566 2074 6f5f 6469 6374  .    def to_dict
-000112b0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000112c0: 2020 2020 2020 2020 6967 6e6f 7265 5f63          ignore_c
-000112d0: 6f6d 706f 6e65 6e74 735f 7072 6566 6978  omponents_prefix
-000112e0: 3a20 4f70 7469 6f6e 616c 5b4c 6973 745b  : Optional[List[
-000112f0: 7374 725d 5d20 3d20 4e6f 6e65 2c0a 2020  str]] = None,.  
-00011300: 2020 2020 2020 6967 6e6f 7265 5f66 756e        ignore_fun
-00011310: 6374 696f 6e73 5f70 7265 6669 783a 204f  ctions_prefix: O
-00011320: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
-00011330: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
-00011340: 2020 2077 6974 685f 6365 6c6c 733a 2062     with_cells: b
-00011350: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-00011360: 2020 2020 2077 6974 685f 706f 7274 733a       with_ports:
-00011370: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-00011380: 2020 2920 2d3e 2044 6963 745b 7374 722c    ) -> Dict[str,
-00011390: 2041 6e79 5d3a 0a20 2020 2020 2020 2022   Any]:.        "
-000113a0: 2222 5265 7475 726e 7320 4469 6374 2072  ""Returns Dict r
-000113b0: 6570 7265 7365 6e74 6174 696f 6e20 6f66  epresentation of
-000113c0: 2061 2063 6f6d 706f 6e65 6e74 2e0a 0a20   a component... 
-000113d0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000113e0: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-000113f0: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
-00011400: 783a 2066 6f72 2063 6f6d 706f 6e65 6e74  x: for component
-00011410: 7320 746f 2069 676e 6f72 6520 7768 656e  s to ignore when
-00011420: 2065 7870 6f72 7469 6e67 2e0a 2020 2020   exporting..    
-00011430: 2020 2020 2020 2020 6967 6e6f 7265 5f66          ignore_f
-00011440: 756e 6374 696f 6e73 5f70 7265 6669 783a  unctions_prefix:
-00011450: 2066 6f72 2066 756e 6374 696f 6e73 2074   for functions t
-00011460: 6f20 6967 6e6f 7265 2077 6865 6e20 6578  o ignore when ex
-00011470: 706f 7274 696e 672e 0a20 2020 2020 2020  porting..       
-00011480: 2020 2020 2077 6974 685f 6365 6c6c 733a       with_cells:
-00011490: 2077 7269 7465 2063 656c 6c73 2072 6563   write cells rec
-000114a0: 7572 7369 7665 6c79 2e0a 2020 2020 2020  ursively..      
-000114b0: 2020 2020 2020 7769 7468 5f70 6f72 7473        with_ports
-000114c0: 3a20 7772 6974 6520 706f 7274 2069 6e66  : write port inf
-000114d0: 6f72 6d61 7469 6f6e 2064 6963 742e 0a20  ormation dict.. 
-000114e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000114f0: 2020 2064 203d 207b 7d0a 2020 2020 2020     d = {}.      
-00011500: 2020 6966 2077 6974 685f 706f 7274 733a    if with_ports:
-00011510: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
-00011520: 7473 203d 207b 706f 7274 2e6e 616d 653a  ts = {port.name:
-00011530: 2070 6f72 742e 746f 5f64 6963 7428 2920   port.to_dict() 
-00011540: 666f 7220 706f 7274 2069 6e20 7365 6c66  for port in self
-00011550: 2e67 6574 5f70 6f72 7473 5f6c 6973 7428  .get_ports_list(
-00011560: 297d 0a20 2020 2020 2020 2020 2020 2064  )}.            d
-00011570: 5b22 706f 7274 7322 5d20 3d20 706f 7274  ["ports"] = port
-00011580: 730a 0a20 2020 2020 2020 2069 6620 7769  s..        if wi
-00011590: 7468 5f63 656c 6c73 3a0a 2020 2020 2020  th_cells:.      
-000115a0: 2020 2020 2020 6365 6c6c 7320 3d20 7265        cells = re
-000115b0: 6375 7273 655f 7374 7275 6374 7572 6573  curse_structures
-000115c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000115d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000115e0: 2020 2020 2020 2020 6967 6e6f 7265 5f66          ignore_f
-000115f0: 756e 6374 696f 6e73 5f70 7265 6669 783d  unctions_prefix=
-00011600: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
-00011610: 5f70 7265 6669 782c 0a20 2020 2020 2020  _prefix,.       
-00011620: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-00011630: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
-00011640: 783d 6967 6e6f 7265 5f63 6f6d 706f 6e65  x=ignore_compone
-00011650: 6e74 735f 7072 6566 6978 2c0a 2020 2020  nts_prefix,.    
-00011660: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00011670: 2020 2020 2020 645b 2263 656c 6c73 225d        d["cells"]
-00011680: 203d 2063 6c65 616e 5f64 6963 7428 6365   = clean_dict(ce
-00011690: 6c6c 7329 0a0a 2020 2020 2020 2020 645b  lls)..        d[
-000116a0: 226e 616d 6522 5d20 3d20 7365 6c66 2e6e  "name"] = self.n
-000116b0: 616d 650a 2020 2020 2020 2020 645b 2273  ame.        d["s
-000116c0: 6574 7469 6e67 7322 5d20 3d20 636c 6561  ettings"] = clea
-000116d0: 6e5f 6469 6374 2864 6963 7428 7365 6c66  n_dict(dict(self
-000116e0: 2e73 6574 7469 6e67 7329 290a 2020 2020  .settings)).    
-000116f0: 2020 2020 7265 7475 726e 2064 0a0a 2020      return d..  
-00011700: 2020 6465 6620 746f 5f79 616d 6c28 7365    def to_yaml(se
-00011710: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
-00011720: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
-00011730: 2257 7269 7465 2044 6963 7420 7265 7072  "Write Dict repr
-00011740: 6573 656e 7461 7469 6f6e 206f 6620 6120  esentation of a 
-00011750: 636f 6d70 6f6e 656e 7420 696e 2059 414d  component in YAM
-00011760: 4c20 666f 726d 6174 2e0a 0a20 2020 2020  L format...     
-00011770: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00011780: 2020 2020 2069 676e 6f72 655f 636f 6d70       ignore_comp
-00011790: 6f6e 656e 7473 5f70 7265 6669 783a 2066  onents_prefix: f
-000117a0: 6f72 2063 6f6d 706f 6e65 6e74 7320 746f  or components to
-000117b0: 2069 676e 6f72 6520 7768 656e 2065 7870   ignore when exp
-000117c0: 6f72 7469 6e67 2e0a 2020 2020 2020 2020  orting..        
-000117d0: 2020 2020 6967 6e6f 7265 5f66 756e 6374      ignore_funct
-000117e0: 696f 6e73 5f70 7265 6669 783a 2066 6f72  ions_prefix: for
-000117f0: 2066 756e 6374 696f 6e73 2074 6f20 6967   functions to ig
-00011800: 6e6f 7265 2077 6865 6e20 6578 706f 7274  nore when export
-00011810: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
-00011820: 2077 6974 685f 6365 6c6c 733a 2077 7269   with_cells: wri
-00011830: 7465 2063 656c 6c73 2072 6563 7572 7369  te cells recursi
-00011840: 7665 6c79 2e0a 2020 2020 2020 2020 2020  vely..          
-00011850: 2020 7769 7468 5f70 6f72 7473 3a20 7772    with_ports: wr
-00011860: 6974 6520 706f 7274 2069 6e66 6f72 6d61  ite port informa
-00011870: 7469 6f6e 2e0a 2020 2020 2020 2020 2222  tion..        ""
-00011880: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00011890: 204f 6d65 6761 436f 6e66 2e74 6f5f 7961   OmegaConf.to_ya
-000118a0: 6d6c 2863 6c65 616e 5f64 6963 7428 7365  ml(clean_dict(se
-000118b0: 6c66 2e74 6f5f 6469 6374 282a 2a6b 7761  lf.to_dict(**kwa
-000118c0: 7267 7329 2929 0a0a 2020 2020 6465 6620  rgs)))..    def 
-000118d0: 746f 5f64 6963 745f 706f 6c79 676f 6e73  to_dict_polygons
-000118e0: 2873 656c 6629 202d 3e20 4469 6374 5b73  (self) -> Dict[s
-000118f0: 7472 2c20 416e 795d 3a0a 2020 2020 2020  tr, Any]:.      
-00011900: 2020 2222 2252 6574 7572 6e73 2061 2064    """Returns a d
-00011910: 6963 7420 7265 7072 6573 656e 7461 7469  ict representati
-00011920: 6f6e 206f 6620 7468 6520 666c 6174 7465  on of the flatte
-00011930: 6e65 6420 636f 6d70 6f6e 656e 742e 2222  ned component.""
-00011940: 220a 2020 2020 2020 2020 6420 3d20 7b7d  ".        d = {}
-00011950: 0a20 2020 2020 2020 2070 6f6c 7967 6f6e  .        polygon
-00011960: 7320 3d20 7b7d 0a20 2020 2020 2020 206c  s = {}.        l
-00011970: 6179 6572 5f74 6f5f 706f 6c79 676f 6e73  ayer_to_polygons
-00011980: 203d 2073 656c 662e 6765 745f 706f 6c79   = self.get_poly
-00011990: 676f 6e73 2862 795f 7370 6563 3d54 7275  gons(by_spec=Tru
-000119a0: 6529 0a0a 2020 2020 2020 2020 666f 7220  e)..        for 
-000119b0: 6c61 7965 722c 2070 6f6c 7967 6f6e 735f  layer, polygons_
-000119c0: 6c61 7965 7220 696e 206c 6179 6572 5f74  layer in layer_t
-000119d0: 6f5f 706f 6c79 676f 6e73 2e69 7465 6d73  o_polygons.items
-000119e0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000119f0: 6c61 7965 725f 6e61 6d65 203d 2066 227b  layer_name = f"{
-00011a00: 6c61 7965 725b 305d 7d5f 7b6c 6179 6572  layer[0]}_{layer
-00011a10: 5b31 5d7d 220a 2020 2020 2020 2020 2020  [1]}".          
-00011a20: 2020 666f 7220 706f 6c79 676f 6e20 696e    for polygon in
-00011a30: 2070 6f6c 7967 6f6e 735f 6c61 7965 723a   polygons_layer:
-00011a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011a50: 2070 6f6c 7967 6f6e 735b 6c61 7965 725f   polygons[layer_
-00011a60: 6e61 6d65 5d20 3d20 5b74 7570 6c65 2873  name] = [tuple(s
-00011a70: 6e61 705f 746f 5f67 7269 6428 7629 2920  nap_to_grid(v)) 
-00011a80: 666f 7220 7620 696e 2070 6f6c 7967 6f6e  for v in polygon
-00011a90: 5d0a 0a20 2020 2020 2020 2070 6f72 7473  ]..        ports
-00011aa0: 203d 207b 706f 7274 2e6e 616d 653a 2070   = {port.name: p
-00011ab0: 6f72 742e 7365 7474 696e 6773 2066 6f72  ort.settings for
-00011ac0: 2070 6f72 7420 696e 2073 656c 662e 6765   port in self.ge
-00011ad0: 745f 706f 7274 735f 6c69 7374 2829 7d0a  t_ports_list()}.
-00011ae0: 2020 2020 2020 2020 636c 6561 6e5f 6469          clean_di
-00011af0: 6374 2870 6f72 7473 290a 2020 2020 2020  ct(ports).      
-00011b00: 2020 636c 6561 6e5f 6469 6374 2870 6f6c    clean_dict(pol
-00011b10: 7967 6f6e 7329 0a20 2020 2020 2020 2064  ygons).        d
-00011b20: 2e69 6e66 6f20 3d20 7365 6c66 2e69 6e66  .info = self.inf
-00011b30: 6f0a 2020 2020 2020 2020 642e 706f 6c79  o.        d.poly
-00011b40: 676f 6e73 203d 2070 6f6c 7967 6f6e 730a  gons = polygons.
-00011b50: 2020 2020 2020 2020 642e 706f 7274 7320          d.ports 
-00011b60: 3d20 706f 7274 730a 2020 2020 2020 2020  = ports.        
-00011b70: 7265 7475 726e 2064 0a0a 2020 2020 6465  return d..    de
-00011b80: 6620 6175 746f 5f72 656e 616d 655f 706f  f auto_rename_po
-00011b90: 7274 7328 7365 6c66 2c20 2a2a 6b77 6172  rts(self, **kwar
-00011ba0: 6773 2920 2d3e 204e 6f6e 653a 0a20 2020  gs) -> None:.   
-00011bb0: 2020 2020 2022 2222 5265 6e61 6d65 2070       """Rename p
-00011bc0: 6f72 7473 2062 7920 6f72 6965 6e74 6174  orts by orientat
-00011bd0: 696f 6e20 4e53 4557 2028 6e6f 7274 682c  ion NSEW (north,
-00011be0: 2073 6f75 7468 2c20 6561 7374 2c20 7765   south, east, we
-00011bf0: 7374 292e 0a0a 2020 2020 2020 2020 4b65  st)...        Ke
-00011c00: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-00011c10: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
-00011c20: 3a20 746f 2072 656e 616d 6520 706f 7274  : to rename port
-00011c30: 732e 0a20 2020 2020 2020 2020 2020 2073  s..            s
-00011c40: 656c 6563 745f 706f 7274 735f 6f70 7469  elect_ports_opti
-00011c50: 6361 6c3a 2074 6f20 7365 6c65 6374 206f  cal: to select o
-00011c60: 7074 6963 616c 2070 6f72 7473 2e0a 2020  ptical ports..  
-00011c70: 2020 2020 2020 2020 2020 7365 6c65 6374            select
-00011c80: 5f70 6f72 7473 5f65 6c65 6374 7269 6361  _ports_electrica
-00011c90: 6c3a 2074 6f20 7365 6c65 6374 2065 6c65  l: to select ele
-00011ca0: 6374 7269 6361 6c20 706f 7274 732e 0a20  ctrical ports.. 
-00011cb0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00011cc0: 785f 6f70 7469 6361 6c3a 2070 7265 6669  x_optical: prefi
-00011cd0: 782e 0a20 2020 2020 2020 2020 2020 2070  x..            p
-00011ce0: 7265 6669 785f 656c 6563 7472 6963 616c  refix_electrical
-00011cf0: 3a20 7072 6566 6978 2e0a 0a20 2020 2020  : prefix...     
-00011d00: 2020 202e 2e20 636f 6465 3a3a 0a0a 2020     .. code::..  
-00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d20: 3320 2034 0a20 2020 2020 2020 2020 2020  3  4.           
-00011d30: 2020 2020 2020 5f7c 5f5f 7c5f 0a20 2020        _|__|_.   
-00011d40: 2020 2020 2020 2020 2020 3220 2d7c 2020            2 -|  
-00011d50: 2020 2020 7c2d 2035 0a20 2020 2020 2020      |- 5.       
-00011d60: 2020 2020 2020 2020 207c 2020 2020 2020           |      
-00011d70: 7c0a 2020 2020 2020 2020 2020 2020 2031  |.             1
-00011d80: 202d 7c5f 5f5f 5f5f 5f7c 2d20 360a 2020   -|______|- 6.  
-00011d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011da0: 7c20 207c 0a20 2020 2020 2020 2020 2020  |  |.           
-00011db0: 2020 2020 2020 2038 2020 370a 2020 2020         8  7.    
-00011dc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00011dd0: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
-00011de0: 2829 0a20 2020 2020 2020 2061 7574 6f5f  ().        auto_
-00011df0: 7265 6e61 6d65 5f70 6f72 7473 2873 656c  rename_ports(sel
-00011e00: 662c 202a 2a6b 7761 7267 7329 0a0a 2020  f, **kwargs)..  
-00011e10: 2020 6465 6620 6175 746f 5f72 656e 616d    def auto_renam
-00011e20: 655f 706f 7274 735f 636f 756e 7465 725f  e_ports_counter_
-00011e30: 636c 6f63 6b77 6973 6528 7365 6c66 2c20  clockwise(self, 
-00011e40: 2a2a 6b77 6172 6773 2920 2d3e 204e 6f6e  **kwargs) -> Non
-00011e50: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-00011e60: 6973 5f75 6e6c 6f63 6b65 6428 290a 2020  is_unlocked().  
-00011e70: 2020 2020 2020 6175 746f 5f72 656e 616d        auto_renam
-00011e80: 655f 706f 7274 735f 636f 756e 7465 725f  e_ports_counter_
-00011e90: 636c 6f63 6b77 6973 6528 7365 6c66 2c20  clockwise(self, 
-00011ea0: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-00011eb0: 6566 2061 7574 6f5f 7265 6e61 6d65 5f70  ef auto_rename_p
-00011ec0: 6f72 7473 5f6c 6179 6572 5f6f 7269 656e  orts_layer_orien
-00011ed0: 7461 7469 6f6e 2873 656c 662c 202a 2a6b  tation(self, **k
-00011ee0: 7761 7267 7329 202d 3e20 4e6f 6e65 3a0a  wargs) -> None:.
-00011ef0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
-00011f00: 756e 6c6f 636b 6564 2829 0a20 2020 2020  unlocked().     
-00011f10: 2020 2061 7574 6f5f 7265 6e61 6d65 5f70     auto_rename_p
-00011f20: 6f72 7473 5f6c 6179 6572 5f6f 7269 656e  orts_layer_orien
-00011f30: 7461 7469 6f6e 2873 656c 662c 202a 2a6b  tation(self, **k
-00011f40: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-00011f50: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
-00011f60: 735f 6f72 6965 6e74 6174 696f 6e28 7365  s_orientation(se
-00011f70: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
-00011f80: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00011f90: 2222 5265 6e61 6d65 2070 6f72 7473 2062  ""Rename ports b
-00011fa0: 7920 6f72 6965 6e74 6174 696f 6e20 4e53  y orientation NS
-00011fb0: 4557 2028 6e6f 7274 682c 2073 6f75 7468  EW (north, south
-00011fc0: 2c20 6561 7374 2c20 7765 7374 292e 0a0a  , east, west)...
-00011fd0: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
-00011fe0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00011ff0: 2020 6675 6e63 7469 6f6e 3a20 746f 2072    function: to r
-00012000: 656e 616d 6520 706f 7274 732e 0a20 2020  ename ports..   
-00012010: 2020 2020 2020 2020 2073 656c 6563 745f           select_
-00012020: 706f 7274 735f 6f70 7469 6361 6c3a 2074  ports_optical: t
-00012030: 6f20 7365 6c65 6374 2070 6f72 7473 2e0a  o select ports..
-00012040: 2020 2020 2020 2020 2020 2020 7365 6c65              sele
-00012050: 6374 5f70 6f72 7473 5f65 6c65 6374 7269  ct_ports_electri
-00012060: 6361 6c3a 0a20 2020 2020 2020 2020 2020  cal:.           
-00012070: 2070 7265 6669 785f 6f70 7469 6361 6c3a   prefix_optical:
-00012080: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00012090: 6669 785f 656c 6563 7472 6963 616c 3a0a  fix_electrical:.
-000120a0: 0a20 2020 2020 2020 202e 2e20 636f 6465  .        .. code
-000120b0: 3a3a 0a0a 2020 2020 2020 2020 2020 2020  ::..            
-000120c0: 2020 2020 204e 3020 204e 310a 2020 2020       N0  N1.    
-000120d0: 2020 2020 2020 2020 2020 2020 207c 5f5f               |__
-000120e0: 5f7c 5f0a 2020 2020 2020 2020 2020 2020  _|_.            
-000120f0: 5731 202d 7c20 2020 2020 207c 2d20 4531  W1 -|      |- E1
-00012100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012110: 207c 2020 2020 2020 7c0a 2020 2020 2020   |      |.      
-00012120: 2020 2020 2020 5730 202d 7c5f 5f5f 5f5f        W0 -|_____
-00012130: 5f7c 2d20 4530 0a20 2020 2020 2020 2020  _|- E0.         
-00012140: 2020 2020 2020 2020 7c20 2020 7c0a 2020          |   |.  
-00012150: 2020 2020 2020 2020 2020 2020 2020 5330                S0
-00012160: 2020 2053 310a 2020 2020 2020 2020 2222     S1.        ""
-00012170: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
-00012180: 735f 756e 6c6f 636b 6564 2829 0a20 2020  s_unlocked().   
-00012190: 2020 2020 2061 7574 6f5f 7265 6e61 6d65       auto_rename
-000121a0: 5f70 6f72 7473 5f6f 7269 656e 7461 7469  _ports_orientati
-000121b0: 6f6e 2873 656c 662c 202a 2a6b 7761 7267  on(self, **kwarg
-000121c0: 7329 0a0a 2020 2020 6465 6620 6d6f 7665  s)..    def move
-000121d0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000121e0: 2020 2020 2020 2020 6f72 6967 696e 3a20          origin: 
-000121f0: 466c 6f61 7432 203d 2028 302c 2030 292c  Float2 = (0, 0),
-00012200: 0a20 2020 2020 2020 2064 6573 7469 6e61  .        destina
-00012210: 7469 6f6e 3a20 4f70 7469 6f6e 616c 5b46  tion: Optional[F
-00012220: 6c6f 6174 325d 203d 204e 6f6e 652c 0a20  loat2] = None,. 
-00012230: 2020 2020 2020 2061 7869 733a 204f 7074         axis: Opt
-00012240: 696f 6e61 6c5b 4178 6973 5d20 3d20 4e6f  ional[Axis] = No
-00012250: 6e65 2c0a 2020 2020 2920 2d3e 2043 6f6d  ne,.    ) -> Com
-00012260: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
-00012270: 2222 2252 6574 7572 6e73 206e 6577 2043  """Returns new C
-00012280: 6f6d 706f 6e65 6e74 2077 6974 6820 6120  omponent with a 
-00012290: 6d6f 7665 6420 7265 6665 7265 6e63 6520  moved reference 
-000122a0: 746f 2074 6865 206f 7269 6769 6e61 6c2e  to the original.
-000122b0: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
-000122c0: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
-000122d0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-000122e0: 6f72 6967 696e 3a20 6f66 2063 6f6d 706f  origin: of compo
-000122f0: 6e65 6e74 2e0a 2020 2020 2020 2020 2020  nent..          
-00012300: 2020 6465 7374 696e 6174 696f 6e3a 2078    destination: x
-00012310: 2c20 792e 0a20 2020 2020 2020 2020 2020  , y..           
-00012320: 2061 7869 733a 2078 206f 7220 792e 0a20   axis: x or y.. 
-00012330: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00012340: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00012350: 726f 7228 6d6f 7665 5f65 7272 6f72 5f6d  ror(move_error_m
-00012360: 6573 7361 6765 290a 0a20 2020 2064 6566  essage)..    def
-00012370: 206d 6972 726f 7228 7365 6c66 2c20 7031   mirror(self, p1
-00012380: 3a20 466c 6f61 7432 203d 2028 302c 2031  : Float2 = (0, 1
-00012390: 292c 2070 323a 2046 6c6f 6174 3220 3d20  ), p2: Float2 = 
-000123a0: 2830 2c20 3029 2c20 2a2a 6b77 6172 6773  (0, 0), **kwargs
-000123b0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
-000123c0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-000123d0: 6e73 206e 6577 2043 6f6d 706f 6e65 6e74  ns new Component
-000123e0: 2077 6974 6820 6120 6d69 7272 6f72 6564   with a mirrored
-000123f0: 2072 6566 6572 656e 6365 2e0a 0a20 2020   reference...   
-00012400: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00012410: 2020 2020 2020 2070 313a 2066 6972 7374         p1: first
-00012420: 2070 6f69 6e74 2074 6f20 6465 6669 6e65   point to define
-00012430: 206d 6972 726f 7220 6178 6973 2e0a 2020   mirror axis..  
-00012440: 2020 2020 2020 2020 2020 7032 3a20 7365            p2: se
-00012450: 636f 6e64 2070 6f69 6e74 2074 6f20 6465  cond point to de
-00012460: 6669 6e65 206d 6972 726f 7220 6178 6973  fine mirror axis
-00012470: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00012480: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-00012490: 6374 6f72 792e 6675 6e63 7469 6f6e 7320  ctory.functions 
-000124a0: 696d 706f 7274 206d 6972 726f 720a 0a20  import mirror.. 
-000124b0: 2020 2020 2020 2072 6574 7572 6e20 6d69         return mi
-000124c0: 7272 6f72 2863 6f6d 706f 6e65 6e74 3d73  rror(component=s
-000124d0: 656c 662c 2070 313d 7031 2c20 7032 3d70  elf, p1=p1, p2=p
-000124e0: 322c 202a 2a6b 7761 7267 7329 0a0a 2020  2, **kwargs)..  
-000124f0: 2020 6465 6620 726f 7461 7465 2873 656c    def rotate(sel
-00012500: 662c 2061 6e67 6c65 3a20 666c 6f61 7420  f, angle: float 
-00012510: 3d20 3930 2c20 2a2a 6b77 6172 6773 2920  = 90, **kwargs) 
-00012520: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-00012530: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00012540: 206e 6577 2063 6f6d 706f 6e65 6e74 2077   new component w
-00012550: 6974 6820 6120 726f 7461 7465 6420 7265  ith a rotated re
-00012560: 6665 7265 6e63 6520 746f 2074 6865 206f  ference to the o
-00012570: 7269 6769 6e61 6c2e 0a0a 2020 2020 2020  riginal...      
-00012580: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00012590: 2020 2020 616e 676c 653a 2069 6e20 6465      angle: in de
-000125a0: 6772 6565 732e 0a20 2020 2020 2020 2022  grees..        "
-000125b0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-000125c0: 6764 7366 6163 746f 7279 2e66 756e 6374  gdsfactory.funct
-000125d0: 696f 6e73 2069 6d70 6f72 7420 726f 7461  ions import rota
-000125e0: 7465 0a0a 2020 2020 2020 2020 7265 7475  te..        retu
-000125f0: 726e 2072 6f74 6174 6528 636f 6d70 6f6e  rn rotate(compon
-00012600: 656e 743d 7365 6c66 2c20 616e 676c 653d  ent=self, angle=
-00012610: 616e 676c 652c 202a 2a6b 7761 7267 7329  angle, **kwargs)
-00012620: 0a0a 2020 2020 6465 6620 6164 645f 7061  ..    def add_pa
-00012630: 6464 696e 6728 7365 6c66 2c20 2a2a 6b77  dding(self, **kw
-00012640: 6172 6773 2920 2d3e 2043 6f6d 706f 6e65  args) -> Compone
-00012650: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
-00012660: 6574 7572 6e73 2073 616d 6520 636f 6d70  eturns same comp
-00012670: 6f6e 656e 7420 7769 7468 2070 6164 6469  onent with paddi
-00012680: 6e67 2e0a 0a20 2020 2020 2020 204b 6579  ng...        Key
-00012690: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-000126a0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-000126b0: 3a20 666f 7220 7061 6464 696e 672e 0a20  : for padding.. 
-000126c0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-000126d0: 733a 206c 6973 7420 6f66 206c 6179 6572  s: list of layer
-000126e0: 732e 0a20 2020 2020 2020 2020 2020 2073  s..            s
-000126f0: 7566 6669 7820 666f 7220 6e61 6d65 2e0a  uffix for name..
-00012700: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00012710: 756c 743a 2064 6566 6175 6c74 2070 6164  ult: default pad
-00012720: 6469 6e67 2028 3530 756d 292e 0a20 2020  ding (50um)..   
-00012730: 2020 2020 2020 2020 2074 6f70 3a20 6e6f           top: no
-00012740: 7274 6820 7061 6464 696e 672e 0a20 2020  rth padding..   
-00012750: 2020 2020 2020 2020 2062 6f74 746f 6d3a           bottom:
-00012760: 2073 6f75 7468 2070 6164 6469 6e67 2e0a   south padding..
-00012770: 2020 2020 2020 2020 2020 2020 7269 6768              righ
-00012780: 743a 2065 6173 7420 7061 6464 696e 672e  t: east padding.
-00012790: 0a20 2020 2020 2020 2020 2020 206c 6566  .            lef
-000127a0: 743a 2077 6573 7420 7061 6464 696e 672e  t: west padding.
-000127b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000127c0: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-000127d0: 746f 7279 2e61 6464 5f70 6164 6469 6e67  tory.add_padding
-000127e0: 2069 6d70 6f72 7420 6164 645f 7061 6464   import add_padd
-000127f0: 696e 670a 0a20 2020 2020 2020 2072 6574  ing..        ret
-00012800: 7572 6e20 6164 645f 7061 6464 696e 6728  urn add_padding(
-00012810: 636f 6d70 6f6e 656e 743d 7365 6c66 2c20  component=self, 
-00012820: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-00012830: 6566 2061 6273 6f72 6228 7365 6c66 2c20  ef absorb(self, 
-00012840: 7265 6665 7265 6e63 6529 202d 3e20 436f  reference) -> Co
-00012850: 6d70 6f6e 656e 743a 0a20 2020 2020 2020  mponent:.       
-00012860: 2022 2222 4162 736f 7262 7320 706f 6c79   """Absorbs poly
-00012870: 676f 6e73 2066 726f 6d20 436f 6d70 6f6e  gons from Compon
-00012880: 656e 7452 6566 6572 656e 6365 2069 6e74  entReference int
-00012890: 6f20 436f 6d70 6f6e 656e 742e 0a0a 2020  o Component...  
-000128a0: 2020 2020 2020 4465 7374 726f 7973 2074        Destroys t
-000128b0: 6865 2072 6566 6572 656e 6365 2069 6e20  he reference in 
-000128c0: 7468 6520 7072 6f63 6573 7320 6275 7420  the process but 
-000128d0: 6b65 6570 696e 6720 7468 6520 706f 6c79  keeping the poly
-000128e0: 676f 6e20 6765 6f6d 6574 7279 2e0a 0a20  gon geometry... 
-000128f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00012900: 2020 2020 2020 2020 2072 6566 6572 656e           referen
-00012910: 6365 3a20 436f 6d70 6f6e 656e 7452 6566  ce: ComponentRef
-00012920: 6572 656e 6365 2074 6f20 6265 2061 6273  erence to be abs
-00012930: 6f72 6265 6420 696e 746f 2074 6865 2043  orbed into the C
-00012940: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
-00012950: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00012960: 2072 6566 6572 656e 6365 206e 6f74 2069   reference not i
-00012970: 6e20 7365 6c66 2e72 6566 6572 656e 6365  n self.reference
-00012980: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-00012990: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000129a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000129b0: 2022 5468 6520 7265 6665 7265 6e63 6520   "The reference 
-000129c0: 796f 7520 6173 6b65 6420 746f 2061 6273  you asked to abs
-000129d0: 6f72 6220 646f 6573 206e 6f74 2065 7869  orb does not exi
-000129e0: 7374 2069 6e20 7468 6973 2043 6f6d 706f  st in this Compo
-000129f0: 6e65 6e74 2e22 0a20 2020 2020 2020 2020  nent.".         
-00012a00: 2020 2029 0a20 2020 2020 2020 2072 6566     ).        ref
-00012a10: 5f70 6f6c 7967 6f6e 7320 3d20 7265 6665  _polygons = refe
-00012a20: 7265 6e63 652e 6765 745f 706f 6c79 676f  rence.get_polygo
-00012a30: 6e73 280a 2020 2020 2020 2020 2020 2020  ns(.            
-00012a40: 6279 5f73 7065 633d 4661 6c73 652c 2069  by_spec=False, i
-00012a50: 6e63 6c75 6465 5f70 6174 6873 3d46 616c  nclude_paths=Fal
-00012a60: 7365 2c20 6173 5f61 7272 6179 3d46 616c  se, as_array=Fal
-00012a70: 7365 0a20 2020 2020 2020 2029 0a20 2020  se.        ).   
-00012a80: 2020 2020 2073 656c 662e 5f61 6464 5f70       self._add_p
-00012a90: 6f6c 7967 6f6e 7328 2a72 6566 5f70 6f6c  olygons(*ref_pol
-00012aa0: 7967 6f6e 7329 0a0a 2020 2020 2020 2020  ygons)..        
-00012ab0: 7365 6c66 2e61 6464 2872 6566 6572 656e  self.add(referen
-00012ac0: 6365 2e67 6574 5f6c 6162 656c 7328 2929  ce.get_labels())
-00012ad0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00012ae0: 6428 7265 6665 7265 6e63 652e 6765 745f  d(reference.get_
-00012af0: 7061 7468 7328 2929 0a20 2020 2020 2020  paths()).       
-00012b00: 2073 656c 662e 7265 6d6f 7665 2872 6566   self.remove(ref
-00012b10: 6572 656e 6365 290a 2020 2020 2020 2020  erence).        
-00012b20: 7265 7475 726e 2073 656c 660a 0a20 2020  return self..   
-00012b30: 2064 6566 2072 656d 6f76 6528 7365 6c66   def remove(self
-00012b40: 2c20 6974 656d 7329 3a0a 2020 2020 2020  , items):.      
-00012b50: 2020 2222 2252 656d 6f76 6573 2069 7465    """Removes ite
-00012b60: 6d73 2066 726f 6d20 6120 436f 6d70 6f6e  ms from a Compon
-00012b70: 656e 742c 2077 6869 6368 2063 616e 2069  ent, which can i
-00012b80: 6e63 6c75 6465 2050 6f72 7473 2c20 506f  nclude Ports, Po
-00012b90: 6c79 676f 6e53 6574 7320 5c0a 2020 2020  lygonSets \.    
-00012ba0: 2020 2020 4365 6c6c 5265 6665 7265 6e63      CellReferenc
-00012bb0: 6573 2c20 436f 6d70 6f6e 656e 7452 6566  es, ComponentRef
-00012bc0: 6572 656e 6365 7320 616e 6420 4c61 6265  erences and Labe
-00012bd0: 6c73 2e0a 0a20 2020 2020 2020 2041 7267  ls...        Arg
-00012be0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00012bf0: 7465 6d73 3a20 6c69 7374 206f 6620 4974  tems: list of It
-00012c00: 656d 7320 746f 2062 6520 7265 6d6f 7665  ems to be remove
-00012c10: 6420 6672 6f6d 2074 6865 2043 6f6d 706f  d from the Compo
-00012c20: 6e65 6e74 2e0a 2020 2020 2020 2020 2222  nent..        ""
-00012c30: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-00012c40: 2068 6173 6174 7472 2869 7465 6d73 2c20   hasattr(items, 
-00012c50: 225f 5f69 7465 725f 5f22 293a 0a20 2020  "__iter__"):.   
-00012c60: 2020 2020 2020 2020 2069 7465 6d73 203d           items =
-00012c70: 205b 6974 656d 735d 0a20 2020 2020 2020   [items].       
-00012c80: 2066 6f72 2069 7465 6d20 696e 2069 7465   for item in ite
-00012c90: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00012ca0: 6966 2069 7369 6e73 7461 6e63 6528 6974  if isinstance(it
-00012cb0: 656d 2c20 506f 7274 293a 0a20 2020 2020  em, Port):.     
-00012cc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012cd0: 706f 7274 7320 3d20 7b6b 3a20 7620 666f  ports = {k: v fo
-00012ce0: 7220 6b2c 2076 2069 6e20 7365 6c66 2e70  r k, v in self.p
-00012cf0: 6f72 7473 2e69 7465 6d73 2829 2069 6620  orts.items() if 
-00012d00: 7620 213d 2069 7465 6d7d 0a20 2020 2020  v != item}.     
-00012d10: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00012d20: 7374 616e 6365 2869 7465 6d2c 2067 6473  stance(item, gds
-00012d30: 746b 2e52 6566 6572 656e 6365 293a 0a20  tk.Reference):. 
-00012d40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012d50: 656c 662e 5f63 656c 6c2e 7265 6d6f 7665  elf._cell.remove
-00012d60: 2869 7465 6d29 0a20 2020 2020 2020 2020  (item).         
-00012d70: 2020 2020 2020 2069 7465 6d2e 6f77 6e65         item.owne
-00012d80: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
-00012d90: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00012da0: 616e 6365 2869 7465 6d2c 2043 6f6d 706f  ance(item, Compo
-00012db0: 6e65 6e74 5265 6665 7265 6e63 6529 3a0a  nentReference):.
-00012dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012dd0: 7365 6c66 2e72 6566 6572 656e 6365 732e  self.references.
-00012de0: 7265 6d6f 7665 2869 7465 6d29 0a20 2020  remove(item).   
-00012df0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012e00: 662e 5f63 656c 6c2e 7265 6d6f 7665 2869  f._cell.remove(i
-00012e10: 7465 6d2e 5f72 6566 6572 656e 6365 290a  tem._reference).
-00012e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e30: 6974 656d 2e6f 776e 6572 203d 204e 6f6e  item.owner = Non
-00012e40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00012e50: 2020 7365 6c66 2e5f 6e61 6d65 645f 7265    self._named_re
-00012e60: 6665 7265 6e63 6573 2e70 6f70 2869 7465  ferences.pop(ite
-00012e70: 6d2e 6e61 6d65 290a 2020 2020 2020 2020  m.name).        
-00012e80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012e90: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00012ea0: 6365 6c6c 2e72 656d 6f76 6528 6974 656d  cell.remove(item
-00012eb0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00012ec0: 5f62 625f 7661 6c69 6420 3d20 4661 6c73  _bb_valid = Fals
-00012ed0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00012ee0: 2073 656c 660a 0a20 2020 2064 6566 2068   self..    def h
-00012ef0: 6173 685f 6765 6f6d 6574 7279 2873 656c  ash_geometry(sel
-00012f00: 662c 2070 7265 6369 7369 6f6e 3a20 666c  f, precision: fl
-00012f10: 6f61 7420 3d20 3165 2d34 2920 2d3e 2073  oat = 1e-4) -> s
-00012f20: 7472 3a0a 2020 2020 2020 2020 2222 2252  tr:.        """R
-00012f30: 6574 7572 6e73 2061 6e20 5348 4131 2068  eturns an SHA1 h
-00012f40: 6173 6820 6f66 2074 6865 2067 656f 6d65  ash of the geome
-00012f50: 7472 7920 696e 2074 6865 2043 6f6d 706f  try in the Compo
-00012f60: 6e65 6e74 2e0a 0a20 2020 2020 2020 2046  nent...        F
-00012f70: 6f72 2065 6163 6820 6c61 7965 722c 2065  or each layer, e
-00012f80: 6163 6820 706f 6c79 676f 6e20 6973 2069  ach polygon is i
-00012f90: 6e64 6976 6964 7561 6c6c 7920 6861 7368  ndividually hash
-00012fa0: 6564 2061 6e64 2074 6865 6e20 7468 6520  ed and then the 
-00012fb0: 706f 6c79 676f 6e20 6861 7368 6573 0a20  polygon hashes. 
-00012fc0: 2020 2020 2020 2061 7265 2073 6f72 7465         are sorte
-00012fd0: 642c 2074 6f20 656e 7375 7265 2074 6865  d, to ensure the
-00012fe0: 2068 6173 6820 7374 6179 7320 636f 6e73   hash stays cons
-00012ff0: 7461 6e74 2072 6567 6172 646c 6573 7320  tant regardless 
-00013000: 6f66 2074 6865 206f 7264 6572 696e 670a  of the ordering.
-00013010: 2020 2020 2020 2020 7468 6520 706f 6c79          the poly
-00013020: 676f 6e73 2e20 2053 696d 696c 6172 6c79  gons.  Similarly
-00013030: 2c20 7468 6520 6c61 7965 7273 2061 7265  , the layers are
-00013040: 2073 6f72 7465 6420 6279 2028 6c61 7965   sorted by (laye
-00013050: 722c 2064 6174 6174 7970 6529 2e0a 0a20  r, datatype)... 
-00013060: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00013070: 2020 2020 2020 2020 2070 7265 6369 7369           precisi
-00013080: 6f6e 3a20 526f 756e 6469 6e67 2070 7265  on: Rounding pre
-00013090: 6369 7369 6f6e 2066 6f72 2074 6865 2074  cision for the t
-000130a0: 6865 206f 626a 6563 7473 2069 6e20 7468  he objects in th
-000130b0: 6520 436f 6d70 6f6e 656e 742e 0a20 2020  e Component..   
-000130c0: 2020 2020 2020 2020 2020 2020 2046 6f72               For
-000130d0: 2069 6e73 7461 6e63 652c 2061 2070 7265   instance, a pre
-000130e0: 6369 7369 6f6e 206f 6620 3165 2d32 2077  cision of 1e-2 w
-000130f0: 696c 6c20 726f 756e 6420 6120 706f 696e  ill round a poin
-00013100: 7420 6174 0a20 2020 2020 2020 2020 2020  t at.           
-00013110: 2020 2020 2028 302e 3132 342c 2031 2e37       (0.124, 1.7
-00013120: 3438 2920 746f 2028 302e 3132 2c20 312e  48) to (0.12, 1.
-00013130: 3735 292e 0a0a 2020 2020 2020 2020 2222  75)...        ""
-00013140: 220a 2020 2020 2020 2020 706f 6c79 676f  ".        polygo
-00013150: 6e73 5f62 795f 7370 6563 203d 2073 656c  ns_by_spec = sel
-00013160: 662e 6765 745f 706f 6c79 676f 6e73 2862  f.get_polygons(b
-00013170: 795f 7370 6563 3d54 7275 652c 2061 735f  y_spec=True, as_
-00013180: 6172 7261 793d 4661 6c73 6529 0a20 2020  array=False).   
-00013190: 2020 2020 206c 6179 6572 7320 3d20 6e70       layers = np
-000131a0: 2e61 7272 6179 286c 6973 7428 706f 6c79  .array(list(poly
-000131b0: 676f 6e73 5f62 795f 7370 6563 2e6b 6579  gons_by_spec.key
-000131c0: 7328 2929 290a 2020 2020 2020 2020 736f  s())).        so
-000131d0: 7274 6564 5f6c 6179 6572 7320 3d20 6c61  rted_layers = la
-000131e0: 7965 7273 5b6e 702e 6c65 7873 6f72 7428  yers[np.lexsort(
-000131f0: 286c 6179 6572 735b 3a2c 2030 5d2c 206c  (layers[:, 0], l
-00013200: 6179 6572 735b 3a2c 2031 5d29 295d 0a0a  ayers[:, 1]))]..
-00013210: 2020 2020 2020 2020 6669 6e61 6c5f 6861          final_ha
-00013220: 7368 203d 2068 6173 686c 6962 2e73 6861  sh = hashlib.sha
-00013230: 3128 290a 2020 2020 2020 2020 666f 7220  1().        for 
-00013240: 6c61 7965 7220 696e 2073 6f72 7465 645f  layer in sorted_
-00013250: 6c61 7965 7273 3a0a 2020 2020 2020 2020  layers:.        
-00013260: 2020 2020 6c61 7965 725f 6861 7368 203d      layer_hash =
-00013270: 2068 6173 686c 6962 2e73 6861 3128 6c61   hashlib.sha1(la
-00013280: 7965 722e 6173 7479 7065 286e 702e 696e  yer.astype(np.in
-00013290: 7436 3429 292e 6469 6765 7374 2829 0a20  t64)).digest(). 
-000132a0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
-000132b0: 6f6e 7320 3d20 706f 6c79 676f 6e73 5f62  ons = polygons_b
-000132c0: 795f 7370 6563 5b74 7570 6c65 286c 6179  y_spec[tuple(lay
-000132d0: 6572 295d 0a20 2020 2020 2020 2020 2020  er)].           
-000132e0: 2070 6f6c 7967 6f6e 7320 3d20 5b5f 726e   polygons = [_rn
-000132f0: 6428 702e 706f 696e 7473 2c20 7072 6563  d(p.points, prec
-00013300: 6973 696f 6e29 2066 6f72 2070 2069 6e20  ision) for p in 
-00013310: 706f 6c79 676f 6e73 5d0a 2020 2020 2020  polygons].      
-00013320: 2020 2020 2020 706f 6c79 676f 6e5f 6861        polygon_ha
-00013330: 7368 6573 203d 206e 702e 736f 7274 285b  shes = np.sort([
-00013340: 6861 7368 6c69 622e 7368 6131 2870 292e  hashlib.sha1(p).
-00013350: 6469 6765 7374 2829 2066 6f72 2070 2069  digest() for p i
-00013360: 6e20 706f 6c79 676f 6e73 5d29 0a20 2020  n polygons]).   
-00013370: 2020 2020 2020 2020 2066 696e 616c 5f68           final_h
-00013380: 6173 682e 7570 6461 7465 286c 6179 6572  ash.update(layer
-00013390: 5f68 6173 6829 0a20 2020 2020 2020 2020  _hash).         
-000133a0: 2020 2066 6f72 2070 6820 696e 2070 6f6c     for ph in pol
-000133b0: 7967 6f6e 5f68 6173 6865 733a 0a20 2020  ygon_hashes:.   
-000133c0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-000133d0: 616c 5f68 6173 682e 7570 6461 7465 2870  al_hash.update(p
-000133e0: 6829 0a0a 2020 2020 2020 2020 7265 7475  h)..        retu
-000133f0: 726e 2066 696e 616c 5f68 6173 682e 6865  rn final_hash.he
-00013400: 7864 6967 6573 7428 290a 0a20 2020 2064  xdigest()..    d
-00013410: 6566 2067 6574 5f6c 6162 656c 7328 0a20  ef get_labels(. 
-00013420: 2020 2020 2020 2073 656c 662c 2061 7070         self, app
-00013430: 6c79 5f72 6570 6574 6974 696f 6e73 3d54  ly_repetitions=T
-00013440: 7275 652c 2064 6570 7468 3a20 4f70 7469  rue, depth: Opti
-00013450: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
-00013460: 2c20 6c61 7965 723d 4e6f 6e65 0a20 2020  , layer=None.   
-00013470: 2029 202d 3e20 4c69 7374 5b4c 6162 656c   ) -> List[Label
-00013480: 5d3a 0a20 2020 2020 2020 2022 2222 5265  ]:.        """Re
-00013490: 7475 726e 206c 6162 656c 732e 0a0a 2020  turn labels...  
-000134a0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-000134b0: 2020 2020 2020 2020 6170 706c 795f 7265          apply_re
-000134c0: 7065 7469 7469 6f6e 733a 2e0a 2020 2020  petitions:..    
-000134d0: 2020 2020 2020 2020 6465 7074 683a 204e          depth: N
-000134e0: 6f6e 6520 7265 7475 726e 7320 616c 6c20  one returns all 
-000134f0: 6c61 6265 6c73 2061 6e64 2030 2074 6f70  labels and 0 top
-00013500: 206c 6576 656c 2e0a 2020 2020 2020 2020   level..        
-00013510: 2020 2020 6c61 7965 723a 206c 6179 6572      layer: layer
-00013520: 7370 6563 2e0a 2020 2020 2020 2020 2222  spec..        ""
-00013530: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
-00013540: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
-00013550: 706f 7274 2067 6574 5f6c 6179 6572 0a0a  port get_layer..
-00013560: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
-00013570: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-00013580: 7965 722c 2074 6578 7474 7970 6520 3d20  yer, texttype = 
-00013590: 6765 745f 6c61 7965 7228 6c61 7965 7229  get_layer(layer)
-000135a0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000135b0: 2020 2020 2020 2020 2020 2074 6578 7474             textt
-000135c0: 7970 6520 3d20 4e6f 6e65 0a20 2020 2020  ype = None.     
-000135d0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000135e0: 6365 6c6c 2e67 6574 5f6c 6162 656c 7328  cell.get_labels(
-000135f0: 0a20 2020 2020 2020 2020 2020 2061 7070  .            app
-00013600: 6c79 5f72 6570 6574 6974 696f 6e73 3d61  ly_repetitions=a
-00013610: 7070 6c79 5f72 6570 6574 6974 696f 6e73  pply_repetitions
-00013620: 2c0a 2020 2020 2020 2020 2020 2020 6465  ,.            de
-00013630: 7074 683d 6465 7074 682c 0a20 2020 2020  pth=depth,.     
-00013640: 2020 2020 2020 206c 6179 6572 3d6c 6179         layer=lay
-00013650: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00013660: 7465 7874 7479 7065 3d74 6578 7474 7970  texttype=texttyp
-00013670: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-00013680: 2020 6465 6620 7265 6d6f 7665 5f6c 6162    def remove_lab
-00013690: 656c 7328 7365 6c66 2920 2d3e 204e 6f6e  els(self) -> Non
-000136a0: 653a 0a20 2020 2020 2020 2022 2222 5265  e:.        """Re
-000136b0: 6d6f 7665 206c 6162 656c 732e 2222 220a  move labels.""".
-000136c0: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
-000136d0: 6c6c 2e72 656d 6f76 6528 2a73 656c 662e  ll.remove(*self.
-000136e0: 6c61 6265 6c73 290a 0a20 2020 2023 2044  labels)..    # D
-000136f0: 6570 7265 6361 7465 640a 2020 2020 6465  eprecated.    de
-00013700: 6620 6765 745f 696e 666f 2873 656c 6629  f get_info(self)
-00013710: 3a0a 2020 2020 2020 2020 2222 2247 6174  :.        """Gat
-00013720: 6865 7273 2074 6865 202e 696e 666f 2064  hers the .info d
-00013730: 6963 7469 6f6e 6172 6965 7320 6672 6f6d  ictionaries from
-00013740: 2065 7665 7279 2073 7562 2d43 6f6d 706f   every sub-Compo
-00013750: 6e65 6e74 2061 6e64 2072 6574 7572 6e73  nent and returns
-00013760: 2074 6865 6d20 696e 2061 206c 6973 742e   them in a list.
-00013770: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00013780: 2020 2020 2020 2020 2020 2020 6465 7074              dept
-00013790: 683a 2069 6e74 206f 7220 4e6f 6e65 0a20  h: int or None. 
-000137a0: 2020 2020 2020 2020 2020 2020 2020 2049                 I
-000137b0: 6620 6e6f 7420 4e6f 6e65 2c20 6465 6669  f not None, defi
-000137c0: 6e65 7320 6672 6f6d 2068 6f77 206d 616e  nes from how man
-000137d0: 7920 7265 6665 7265 6e63 6520 6c65 7665  y reference leve
-000137e0: 6c73 2074 6f0a 2020 2020 2020 2020 2020  ls to.          
-000137f0: 2020 2020 2020 7265 7472 6965 7665 2050        retrieve P
-00013800: 6f72 7473 2066 726f 6d2e 0a0a 2020 2020  orts from...    
-00013810: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-00013820: 2020 2020 2020 2020 206c 6973 7420 6f66           list of
-00013830: 2064 6963 7469 6f6e 6172 6965 730a 2020   dictionaries.  
-00013840: 2020 2020 2020 2020 2020 2020 2020 4c69                Li
-00013850: 7374 206f 6620 7468 6520 222e 696e 666f  st of the ".info
-00013860: 2220 7072 6f70 6572 7479 2064 6963 7469  " property dicti
-00013870: 6f6e 6172 6965 7320 6672 6f6d 2061 6c6c  onaries from all
-00013880: 2073 7562 2d43 6f6d 706f 6e65 6e74 730a   sub-Components.
-00013890: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000138a0: 2020 2020 445f 6c69 7374 203d 2073 656c      D_list = sel
-000138b0: 662e 6765 745f 6465 7065 6e64 656e 6369  f.get_dependenci
-000138c0: 6573 2872 6563 7572 7369 7665 3d54 7275  es(recursive=Tru
-000138d0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-000138e0: 6e20 5b44 2e69 6e66 6f2e 636f 7079 2829  n [D.info.copy()
-000138f0: 2066 6f72 2044 2069 6e20 445f 6c69 7374   for D in D_list
-00013900: 5d0a 0a20 2020 2064 6566 2072 656d 6170  ]..    def remap
-00013910: 5f6c 6179 6572 7328 0a20 2020 2020 2020  _layers(.       
-00013920: 2073 656c 662c 206c 6179 6572 6d61 702c   self, layermap,
-00013930: 2069 6e63 6c75 6465 5f6c 6162 656c 733a   include_labels:
-00013940: 2062 6f6f 6c20 3d20 5472 7565 2c20 696e   bool = True, in
-00013950: 636c 7564 655f 7061 7468 733a 2062 6f6f  clude_paths: boo
-00013960: 6c20 3d20 5472 7565 0a20 2020 2029 202d  l = True.    ) -
-00013970: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
-00013980: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00013990: 6120 636f 7079 206f 6620 7468 6520 636f  a copy of the co
-000139a0: 6d70 6f6e 656e 7420 7769 7468 2072 656d  mponent with rem
-000139b0: 6170 7065 6420 6c61 7965 7273 2e0a 0a20  apped layers... 
-000139c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000139d0: 2020 2020 2020 2020 206c 6179 6572 6d61           layerma
-000139e0: 703a 2044 6963 7469 6f6e 6172 7920 6f66  p: Dictionary of
-000139f0: 2076 616c 7565 7320 696e 2066 6f72 6d61   values in forma
-00013a00: 7420 7b6c 6179 6572 5f66 726f 6d20 3a20  t {layer_from : 
-00013a10: 6c61 7965 725f 746f 7d2e 0a20 2020 2020  layer_to}..     
-00013a20: 2020 2020 2020 2069 6e63 6c75 6465 5f6c         include_l
-00013a30: 6162 656c 733a 2053 656c 6563 7473 2077  abels: Selects w
-00013a40: 6865 7468 6572 2074 6f20 6d6f 7665 204c  hether to move L
-00013a50: 6162 656c 7320 616c 6f6e 6720 7769 7468  abels along with
-00013a60: 2070 6f6c 7967 6f6e 732e 0a20 2020 2020   polygons..     
-00013a70: 2020 2020 2020 2069 6e63 6c75 6465 5f70         include_p
-00013a80: 6174 6873 3a20 5365 6c65 6374 7320 7768  aths: Selects wh
-00013a90: 6574 6865 7220 746f 206d 6f76 6520 5061  ether to move Pa
-00013aa0: 7468 7320 616c 6f6e 6720 7769 7468 2070  ths along with p
-00013ab0: 6f6c 7967 6f6e 732e 0a20 2020 2020 2020  olygons..       
-00013ac0: 2022 2222 0a20 2020 2020 2020 2063 6f6d   """.        com
-00013ad0: 706f 6e65 6e74 203d 2073 656c 662e 636f  ponent = self.co
-00013ae0: 7079 2829 0a20 2020 2020 2020 206c 6179  py().        lay
-00013af0: 6572 6d61 7020 3d20 7b5f 7061 7273 655f  ermap = {_parse_
-00013b00: 6c61 7965 7228 6b29 3a20 5f70 6172 7365  layer(k): _parse
-00013b10: 5f6c 6179 6572 2876 2920 666f 7220 6b2c  _layer(v) for k,
-00013b20: 2076 2069 6e20 6c61 7965 726d 6170 2e69   v in layermap.i
-00013b30: 7465 6d73 2829 7d0a 0a20 2020 2020 2020  tems()}..       
-00013b40: 2061 6c6c 5f44 203d 206c 6973 7428 636f   all_D = list(co
-00013b50: 6d70 6f6e 656e 742e 6765 745f 6465 7065  mponent.get_depe
-00013b60: 6e64 656e 6369 6573 2854 7275 6529 290a  ndencies(True)).
-00013b70: 2020 2020 2020 2020 616c 6c5f 442e 6170          all_D.ap
-00013b80: 7065 6e64 2863 6f6d 706f 6e65 6e74 290a  pend(component).
-00013b90: 2020 2020 2020 2020 666f 7220 4420 696e          for D in
-00013ba0: 2061 6c6c 5f44 3a0a 2020 2020 2020 2020   all_D:.        
-00013bb0: 2020 2020 666f 7220 7020 696e 2044 2e70      for p in D.p
-00013bc0: 6f6c 7967 6f6e 733a 0a20 2020 2020 2020  olygons:.       
-00013bd0: 2020 2020 2020 2020 206c 6179 6572 203d           layer =
-00013be0: 2028 702e 6c61 7965 722c 2070 2e64 6174   (p.layer, p.dat
-00013bf0: 6174 7970 6529 0a20 2020 2020 2020 2020  atype).         
-00013c00: 2020 2020 2020 2069 6620 6c61 7965 7220         if layer 
-00013c10: 696e 206c 6179 6572 6d61 703a 0a20 2020  in layermap:.   
-00013c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c30: 206e 6577 5f6c 6179 6572 203d 206c 6179   new_layer = lay
-00013c40: 6572 6d61 705b 6c61 7965 725d 0a20 2020  ermap[layer].   
-00013c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c60: 2070 2e6c 6179 6572 203d 206e 6577 5f6c   p.layer = new_l
-00013c70: 6179 6572 5b30 5d0a 2020 2020 2020 2020  ayer[0].        
-00013c80: 2020 2020 2020 2020 2020 2020 702e 6461              p.da
-00013c90: 7461 7479 7065 203d 206e 6577 5f6c 6179  tatype = new_lay
-00013ca0: 6572 5b31 5d0a 2020 2020 2020 2020 2020  er[1].          
-00013cb0: 2020 6966 2069 6e63 6c75 6465 5f6c 6162    if include_lab
-00013cc0: 656c 733a 0a20 2020 2020 2020 2020 2020  els:.           
-00013cd0: 2020 2020 2066 6f72 206c 6162 656c 2069       for label i
-00013ce0: 6e20 442e 6c61 6265 6c73 3a0a 2020 2020  n D.labels:.    
-00013cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d00: 6f72 6967 696e 616c 5f6c 6179 6572 203d  original_layer =
-00013d10: 2028 6c61 6265 6c2e 6c61 7965 722c 206c   (label.layer, l
-00013d20: 6162 656c 2e74 6578 7474 7970 6529 0a20  abel.texttype). 
-00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d40: 2020 206f 7269 6769 6e61 6c5f 6c61 7965     original_laye
-00013d50: 7220 3d20 5f70 6172 7365 5f6c 6179 6572  r = _parse_layer
-00013d60: 286f 7269 6769 6e61 6c5f 6c61 7965 7229  (original_layer)
-00013d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d80: 2020 2020 2069 6620 6f72 6967 696e 616c       if original
-00013d90: 5f6c 6179 6572 2069 6e20 6c61 7965 726d  _layer in layerm
-00013da0: 6170 3a0a 2020 2020 2020 2020 2020 2020  ap:.            
-00013db0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00013dc0: 6c61 7965 7220 3d20 6c61 7965 726d 6170  layer = layermap
-00013dd0: 5b6f 7269 6769 6e61 6c5f 6c61 7965 725d  [original_layer]
-00013de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013df0: 2020 2020 2020 2020 206c 6162 656c 2e6c           label.l
-00013e00: 6179 6572 203d 206e 6577 5f6c 6179 6572  ayer = new_layer
-00013e10: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00013e20: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-00013e30: 6c2e 7465 7874 7479 7065 203d 206e 6577  l.texttype = new
-00013e40: 5f6c 6179 6572 5b31 5d0a 0a20 2020 2020  _layer[1]..     
-00013e50: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
-00013e60: 655f 7061 7468 733a 0a20 2020 2020 2020  e_paths:.       
-00013e70: 2020 2020 2020 2020 2066 6f72 2070 6174           for pat
-00013e80: 6820 696e 2044 2e70 6174 6873 3a0a 2020  h in D.paths:.  
-00013e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ea0: 2020 6e65 775f 6c61 7965 7273 203d 206c    new_layers = l
-00013eb0: 6973 7428 7061 7468 2e6c 6179 6572 7329  ist(path.layers)
-00013ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ed0: 2020 2020 206e 6577 5f64 6174 6174 7970       new_datatyp
-00013ee0: 6573 203d 206c 6973 7428 7061 7468 2e64  es = list(path.d
-00013ef0: 6174 6174 7970 6573 290a 2020 2020 2020  atatypes).      
-00013f00: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00013f10: 7220 6c61 7965 725f 6e75 6d62 6572 2069  r layer_number i
-00013f20: 6e20 7261 6e67 6528 6c65 6e28 6e65 775f  n range(len(new_
-00013f30: 6c61 7965 7273 2929 3a0a 2020 2020 2020  layers)):.      
-00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f50: 2020 6f72 6967 696e 616c 5f6c 6179 6572    original_layer
-00013f60: 203d 205f 7061 7273 655f 6c61 7965 7228   = _parse_layer(
-00013f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013f80: 2020 2020 2020 2020 2020 2020 2028 6e65               (ne
-00013f90: 775f 6c61 7965 7273 5b6c 6179 6572 5f6e  w_layers[layer_n
-00013fa0: 756d 6265 725d 2c20 6e65 775f 6461 7461  umber], new_data
-00013fb0: 7479 7065 735b 6c61 7965 725f 6e75 6d62  types[layer_numb
-00013fc0: 6572 5d29 0a20 2020 2020 2020 2020 2020  er]).           
-00013fd0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00013fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ff0: 2020 2020 2020 2069 6620 6f72 6967 696e         if origin
-00014000: 616c 5f6c 6179 6572 2069 6e20 6c61 7965  al_layer in laye
-00014010: 726d 6170 3a0a 2020 2020 2020 2020 2020  rmap:.          
-00014020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014030: 2020 6e65 775f 6c61 7965 7220 3d20 6c61    new_layer = la
-00014040: 7965 726d 6170 5b6f 7269 6769 6e61 6c5f  yermap[original_
-00014050: 6c61 7965 725d 0a20 2020 2020 2020 2020  layer].         
-00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014070: 2020 206e 6577 5f6c 6179 6572 735b 6c61     new_layers[la
-00014080: 7965 725f 6e75 6d62 6572 5d20 3d20 6e65  yer_number] = ne
-00014090: 775f 6c61 7965 725b 305d 0a20 2020 2020  w_layer[0].     
-000140a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140b0: 2020 2020 2020 206e 6577 5f64 6174 6174         new_datat
-000140c0: 7970 6573 5b6c 6179 6572 5f6e 756d 6265  ypes[layer_numbe
-000140d0: 725d 203d 206e 6577 5f6c 6179 6572 5b31  r] = new_layer[1
-000140e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000140f0: 2020 2020 2020 7061 7468 2e73 6574 5f6c        path.set_l
-00014100: 6179 6572 7328 2a6e 6577 5f6c 6179 6572  ayers(*new_layer
-00014110: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00014120: 2020 2020 2020 2070 6174 682e 7365 745f         path.set_
-00014130: 6461 7461 7479 7065 7328 2a6e 6577 5f64  datatypes(*new_d
-00014140: 6174 6174 7970 6573 290a 2020 2020 2020  atatypes).      
-00014150: 2020 7265 7475 726e 2063 6f6d 706f 6e65    return compone
-00014160: 6e74 0a0a 2020 2020 6465 6620 746f 5f33  nt..    def to_3
-00014170: 6428 0a20 2020 2020 2020 2073 656c 662c  d(.        self,
-00014180: 0a20 2020 2020 2020 206c 6179 6572 5f76  .        layer_v
-00014190: 6965 7773 3a20 4f70 7469 6f6e 616c 5b4c  iews: Optional[L
-000141a0: 6179 6572 5669 6577 735d 203d 204e 6f6e  ayerViews] = Non
-000141b0: 652c 0a20 2020 2020 2020 206c 6179 6572  e,.        layer
-000141c0: 5f73 7461 636b 3a20 4f70 7469 6f6e 616c  _stack: Optional
-000141d0: 5b4c 6179 6572 5374 6163 6b5d 203d 204e  [LayerStack] = N
-000141e0: 6f6e 652c 0a20 2020 2020 2020 2065 7863  one,.        exc
-000141f0: 6c75 6465 5f6c 6179 6572 733a 204f 7074  lude_layers: Opt
-00014200: 696f 6e61 6c5b 5475 706c 655b 4c61 7965  ional[Tuple[Laye
-00014210: 722c 202e 2e2e 5d5d 203d 204e 6f6e 652c  r, ...]] = None,
-00014220: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00014230: 2222 2252 6574 7572 6e20 436f 6d70 6f6e  """Return Compon
-00014240: 656e 7420 3344 2074 7269 6d65 7368 2053  ent 3D trimesh S
-00014250: 6365 6e65 2e0a 0a20 2020 2020 2020 2041  cene...        A
-00014260: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00014270: 2063 6f6d 706f 6e65 6e74 3a20 746f 2065   component: to e
-00014280: 7874 7275 6465 2069 6e20 3344 2e0a 2020  xtrude in 3D..  
-00014290: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
-000142a0: 7669 6577 733a 206c 6179 6572 2063 6f6c  views: layer col
-000142b0: 6f72 7320 6672 6f6d 204b 6c61 796f 7574  ors from Klayout
-000142c0: 204c 6179 6572 2050 726f 7065 7274 6965   Layer Propertie
-000142d0: 7320 6669 6c65 2e0a 2020 2020 2020 2020  s file..        
-000142e0: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-000142f0: 2074 6f20 6163 7469 7665 2050 444b 2e6c   to active PDK.l
-00014300: 6179 6572 5f76 6965 7773 2e0a 2020 2020  ayer_views..    
-00014310: 2020 2020 2020 2020 6c61 7965 725f 7374          layer_st
-00014320: 6163 6b3a 2063 6f6e 7461 696e 7320 7468  ack: contains th
-00014330: 6963 6b6e 6573 7320 616e 6420 7a6d 696e  ickness and zmin
-00014340: 2066 6f72 2065 6163 6820 6c61 7965 722e   for each layer.
-00014350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014360: 2044 6566 6175 6c74 7320 746f 2061 6374   Defaults to act
-00014370: 6976 6520 5044 4b2e 6c61 7965 725f 7374  ive PDK.layer_st
-00014380: 6163 6b2e 0a20 2020 2020 2020 2020 2020  ack..           
-00014390: 2065 7863 6c75 6465 5f6c 6179 6572 733a   exclude_layers:
-000143a0: 206c 6179 6572 7320 746f 2065 7863 6c75   layers to exclu
-000143b0: 6465 2e0a 0a20 2020 2020 2020 2022 2222  de...        """
-000143c0: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-000143d0: 7366 6163 746f 7279 2e65 7870 6f72 742e  sfactory.export.
-000143e0: 746f 5f33 6420 696d 706f 7274 2074 6f5f  to_3d import to_
-000143f0: 3364 0a0a 2020 2020 2020 2020 7265 7475  3d..        retu
-00014400: 726e 2074 6f5f 3364 280a 2020 2020 2020  rn to_3d(.      
-00014410: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00014420: 2020 2020 2020 2020 6c61 7965 725f 7669          layer_vi
-00014430: 6577 733d 6c61 7965 725f 7669 6577 732c  ews=layer_views,
-00014440: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00014450: 6572 5f73 7461 636b 3d6c 6179 6572 5f73  er_stack=layer_s
-00014460: 7461 636b 2c0a 2020 2020 2020 2020 2020  tack,.          
-00014470: 2020 6578 636c 7564 655f 6c61 7965 7273    exclude_layers
-00014480: 3d65 7863 6c75 6465 5f6c 6179 6572 732c  =exclude_layers,
-00014490: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000144a0: 6465 6620 746f 5f6e 7028 0a20 2020 2020  def to_np(.     
-000144b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000144c0: 206e 6d5f 7065 725f 7069 7865 6c3a 2069   nm_per_pixel: i
-000144d0: 6e74 203d 2032 302c 0a20 2020 2020 2020  nt = 20,.       
-000144e0: 206c 6179 6572 733a 204c 6179 6572 7320   layers: Layers 
-000144f0: 3d20 2828 312c 2030 292c 292c 0a20 2020  = ((1, 0),),.   
-00014500: 2020 2020 2076 616c 7565 733a 204f 7074       values: Opt
-00014510: 696f 6e61 6c5b 5475 706c 655b 666c 6f61  ional[Tuple[floa
-00014520: 742c 202e 2e2e 5d5d 203d 204e 6f6e 652c  t, ...]] = None,
-00014530: 0a20 2020 2020 2020 2070 6164 5f77 6964  .        pad_wid
-00014540: 7468 3a20 696e 7420 3d20 312c 0a20 2020  th: int = 1,.   
-00014550: 2029 202d 3e20 6e70 2e6e 6461 7272 6179   ) -> np.ndarray
-00014560: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00014570: 7572 6e73 2061 2070 6978 656c 6174 6564  urns a pixelated
-00014580: 206e 756d 7079 2061 7272 6179 2066 726f   numpy array fro
-00014590: 6d20 436f 6d70 6f6e 656e 7420 706f 6c79  m Component poly
-000145a0: 676f 6e73 2e0a 0a20 2020 2020 2020 2041  gons...        A
-000145b0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-000145c0: 2063 6f6d 706f 6e65 6e74 3a20 436f 6d70   component: Comp
-000145d0: 6f6e 656e 742e 0a20 2020 2020 2020 2020  onent..         
-000145e0: 2020 206e 6d5f 7065 725f 7069 7865 6c3a     nm_per_pixel:
-000145f0: 2079 6f75 2063 616e 2067 6f20 6672 6f6d   you can go from
-00014600: 2032 3020 2863 6f61 7273 6529 2074 6f20   20 (coarse) to 
-00014610: 3420 2866 696e 6529 2e0a 2020 2020 2020  4 (fine)..      
-00014620: 2020 2020 2020 6c61 7965 7273 3a20 746f        layers: to
-00014630: 2063 6f6e 7665 7274 2e20 4f72 6465 7220   convert. Order 
-00014640: 6d61 7474 6572 7320 286c 6174 7465 7220  matters (latter 
-00014650: 6f76 6572 7772 6974 6520 666f 726d 6572  overwrite former
-00014660: 292e 0a20 2020 2020 2020 2020 2020 2076  )..            v
-00014670: 616c 7565 733a 2061 7373 6f63 6961 7465  alues: associate
-00014680: 6420 746f 2065 6163 6820 6c61 7965 7220  d to each layer 
-00014690: 2864 6566 6175 6c74 7320 746f 2031 292e  (defaults to 1).
-000146a0: 0a20 2020 2020 2020 2020 2020 2070 6164  .            pad
-000146b0: 5f77 6964 7468 3a20 7061 6464 696e 6720  _width: padding 
-000146c0: 7069 7865 6c73 2061 726f 756e 6420 7468  pixels around th
-000146d0: 6520 696d 6167 652e 0a0a 2020 2020 2020  e image...      
-000146e0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-000146f0: 6f6d 2067 6473 6661 6374 6f72 792e 6578  om gdsfactory.ex
-00014700: 706f 7274 2e74 6f5f 6e70 2069 6d70 6f72  port.to_np impor
-00014710: 7420 746f 5f6e 700a 0a20 2020 2020 2020  t to_np..       
-00014720: 2072 6574 7572 6e20 746f 5f6e 7028 0a20   return to_np(. 
-00014730: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-00014740: 0a20 2020 2020 2020 2020 2020 206e 6d5f  .            nm_
-00014750: 7065 725f 7069 7865 6c3d 6e6d 5f70 6572  per_pixel=nm_per
-00014760: 5f70 6978 656c 2c0a 2020 2020 2020 2020  _pixel,.        
-00014770: 2020 2020 6c61 7965 7273 3d6c 6179 6572      layers=layer
-00014780: 732c 0a20 2020 2020 2020 2020 2020 2076  s,.            v
-00014790: 616c 7565 733d 7661 6c75 6573 2c0a 2020  alues=values,.  
-000147a0: 2020 2020 2020 2020 2020 7061 645f 7769            pad_wi
-000147b0: 6474 683d 7061 645f 7769 6474 682c 0a20  dth=pad_width,. 
-000147c0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000147d0: 6620 7772 6974 655f 7374 6c28 0a20 2020  f write_stl(.   
-000147e0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000147f0: 2020 2066 696c 6570 6174 683a 2073 7472     filepath: str
-00014800: 2c0a 2020 2020 2020 2020 6c61 7965 725f  ,.        layer_
-00014810: 7374 6163 6b3a 204f 7074 696f 6e61 6c5b  stack: Optional[
-00014820: 4c61 7965 7253 7461 636b 5d20 3d20 4e6f  LayerStack] = No
-00014830: 6e65 2c0a 2020 2020 2020 2020 6578 636c  ne,.        excl
-00014840: 7564 655f 6c61 7965 7273 3a20 4f70 7469  ude_layers: Opti
-00014850: 6f6e 616c 5b54 7570 6c65 5b4c 6179 6572  onal[Tuple[Layer
-00014860: 2c20 2e2e 2e5d 5d20 3d20 4e6f 6e65 2c0a  , ...]] = None,.
-00014870: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-00014880: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
-00014890: 6120 436f 6d70 6f6e 656e 7420 746f 2053  a Component to S
-000148a0: 544c 2066 6f72 2033 4420 7072 696e 7469  TL for 3D printi
-000148b0: 6e67 2e0a 0a20 2020 2020 2020 2041 7267  ng...        Arg
-000148c0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-000148d0: 696c 6570 6174 683a 2074 6f20 7772 6974  ilepath: to writ
-000148e0: 6520 5354 4c20 746f 2e0a 2020 2020 2020  e STL to..      
-000148f0: 2020 2020 2020 6c61 7965 725f 7374 6163        layer_stac
-00014900: 6b3a 2063 6f6e 7461 696e 7320 7468 6963  k: contains thic
-00014910: 6b6e 6573 7320 616e 6420 7a6d 696e 2066  kness and zmin f
-00014920: 6f72 2065 6163 6820 6c61 7965 722e 0a20  or each layer.. 
-00014930: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-00014940: 6465 5f6c 6179 6572 733a 206c 6179 6572  de_layers: layer
-00014950: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
-00014960: 2020 2020 2020 2020 2020 7573 655f 6c61            use_la
-00014970: 7965 725f 6e61 6d65 3a20 4966 2054 7275  yer_name: If Tru
-00014980: 652c 2075 7365 7320 4c61 7965 724c 6576  e, uses LayerLev
-00014990: 656c 206e 616d 6573 2069 6e20 6f75 7470  el names in outp
-000149a0: 7574 2066 696c 656e 616d 6573 2072 6174  ut filenames rat
-000149b0: 6865 7220 7468 616e 2067 6473 5f6c 6179  her than gds_lay
-000149c0: 6572 2061 6e64 2067 6473 5f64 6174 6174  er and gds_datat
-000149d0: 7970 652e 0a20 2020 2020 2020 2020 2020  ype..           
-000149e0: 2068 756c 6c5f 696e 7661 6c69 645f 706f   hull_invalid_po
-000149f0: 6c79 676f 6e73 3a20 4966 2054 7275 652c  lygons: If True,
-00014a00: 2072 6570 6c61 6365 7320 696e 7661 6c69   replaces invali
-00014a10: 6420 706f 6c79 676f 6e73 2028 6465 7465  d polygons (dete
-00014a20: 726d 696e 6564 2062 7920 7368 6170 656c  rmined by shapel
-00014a30: 792e 506f 6c79 676f 6e2e 6973 5f76 616c  y.Polygon.is_val
-00014a40: 6964 2920 7769 7468 2069 7473 2063 6f6e  id) with its con
-00014a50: 7665 7820 6875 6c6c 2e0a 2020 2020 2020  vex hull..      
-00014a60: 2020 2020 2020 7363 616c 653a 204f 7074        scale: Opt
-00014a70: 696f 6e61 6c20 6661 6374 6f72 2062 7920  ional factor by 
-00014a80: 7768 6963 6820 746f 2073 6361 6c65 206d  which to scale m
-00014a90: 6573 6865 7320 6265 666f 7265 2077 7269  eshes before wri
-00014aa0: 7469 6e67 2e0a 0a20 2020 2020 2020 2022  ting...        "
-00014ab0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00014ac0: 6764 7366 6163 746f 7279 2e65 7870 6f72  gdsfactory.expor
-00014ad0: 742e 746f 5f73 746c 2069 6d70 6f72 7420  t.to_stl import 
-00014ae0: 746f 5f73 746c 0a0a 2020 2020 2020 2020  to_stl..        
-00014af0: 746f 5f73 746c 280a 2020 2020 2020 2020  to_stl(.        
-00014b00: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00014b10: 2020 2020 2020 6669 6c65 7061 7468 3d66        filepath=f
-00014b20: 696c 6570 6174 682c 0a20 2020 2020 2020  ilepath,.       
-00014b30: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
-00014b40: 3d6c 6179 6572 5f73 7461 636b 2c0a 2020  =layer_stack,.  
-00014b50: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
-00014b60: 655f 6c61 7965 7273 3d65 7863 6c75 6465  e_layers=exclude
-00014b70: 5f6c 6179 6572 732c 0a20 2020 2020 2020  _layers,.       
-00014b80: 2029 0a0a 2020 2020 6465 6620 7772 6974   )..    def writ
-00014b90: 655f 6765 7262 6572 2873 656c 662c 2064  e_gerber(self, d
-00014ba0: 6972 7061 7468 2c20 6c61 7965 726d 6170  irpath, layermap
-00014bb0: 5f74 6f5f 6765 7262 6572 5f6c 6179 6572  _to_gerber_layer
-00014bc0: 2c20 6f70 7469 6f6e 7329 202d 3e20 4e6f  , options) -> No
-00014bd0: 6e65 3a0a 2020 2020 2020 2020 6672 6f6d  ne:.        from
-00014be0: 2067 6473 6661 6374 6f72 792e 6578 706f   gdsfactory.expo
-00014bf0: 7274 2e74 6f5f 6765 7262 6572 2069 6d70  rt.to_gerber imp
-00014c00: 6f72 7420 746f 5f67 6572 6265 720a 0a20  ort to_gerber.. 
-00014c10: 2020 2020 2020 2074 6f5f 6765 7262 6572         to_gerber
-00014c20: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00014c30: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00014c40: 6469 7270 6174 683d 6469 7270 6174 682c  dirpath=dirpath,
-00014c50: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00014c60: 6572 6d61 705f 746f 5f67 6572 6265 725f  ermap_to_gerber_
-00014c70: 6c61 7965 723d 6c61 7965 726d 6170 5f74  layer=layermap_t
-00014c80: 6f5f 6765 7262 6572 5f6c 6179 6572 2c0a  o_gerber_layer,.
-00014c90: 2020 2020 2020 2020 2020 2020 6f70 7469              opti
-00014ca0: 6f6e 733d 6f70 7469 6f6e 732c 0a20 2020  ons=options,.   
-00014cb0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00014cc0: 746f 5f67 6d73 6828 0a20 2020 2020 2020  to_gmsh(.       
-00014cd0: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
-00014ce0: 7970 652c 0a20 2020 2020 2020 207a 3d4e  ype,.        z=N
-00014cf0: 6f6e 652c 0a20 2020 2020 2020 2078 7365  one,.        xse
-00014d00: 6374 696f 6e5f 626f 756e 6473 3d4e 6f6e  ction_bounds=Non
-00014d10: 652c 0a20 2020 2020 2020 206c 6179 6572  e,.        layer
-00014d20: 5f73 7461 636b 3d4e 6f6e 652c 0a20 2020  _stack=None,.   
-00014d30: 2020 2020 2077 6166 6572 5f70 6164 6469       wafer_paddi
-00014d40: 6e67 3d30 2e30 2c0a 2020 2020 2020 2020  ng=0.0,.        
-00014d50: 7761 6665 725f 6c61 7965 723d 4c41 5945  wafer_layer=LAYE
-00014d60: 522e 5741 4645 522c 0a20 2020 2020 2020  R.WAFER,.       
-00014d70: 202a 6172 6773 2c0a 2020 2020 2020 2020   *args,.        
-00014d80: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
-00014d90: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00014da0: 726e 7320 6120 676d 7368 206d 7368 206f  rns a gmsh msh o
-00014db0: 6620 7468 6520 636f 6d70 6f6e 656e 7420  f the component 
-00014dc0: 666f 7220 6669 6e69 7465 2065 6c65 6d65  for finite eleme
-00014dd0: 6e74 2073 696d 756c 6174 696f 6e2e 0a0a  nt simulation...
-00014de0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
-00014df0: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-00014e00: 7970 653a 206f 6e65 206f 6620 2278 7922  ype: one of "xy"
-00014e10: 2c20 2275 7a22 2c20 6f72 2022 3344 222e  , "uz", or "3D".
-00014e20: 2044 6574 6572 6d69 6e65 7320 7468 6520   Determines the 
-00014e30: 7479 7065 206f 6620 6d65 7368 2074 6f20  type of mesh to 
-00014e40: 7265 7475 726e 2e0a 2020 2020 2020 2020  return..        
-00014e50: 2020 2020 7a3a 2075 7365 6420 746f 2064      z: used to d
-00014e60: 6566 696e 6520 7a2d 736c 6963 6520 666f  efine z-slice fo
-00014e70: 7220 7879 206d 6573 6869 6e67 0a20 2020  r xy meshing.   
-00014e80: 2020 2020 2020 2020 2078 7365 6374 696f           xsectio
-00014e90: 6e5f 626f 756e 6473 3a20 7573 6564 2074  n_bounds: used t
-00014ea0: 6f20 6465 6669 6e65 2069 6e2d 706c 616e  o define in-plan
-00014eb0: 6520 6c69 6e65 2066 6f72 2075 7a20 6d65  e line for uz me
-00014ec0: 7368 696e 670a 2020 2020 2020 2020 2020  shing.          
-00014ed0: 2020 7761 6665 725f 7061 6464 696e 673a    wafer_padding:
-00014ee0: 2070 6164 6469 6e67 2062 6579 6f6e 6420   padding beyond 
-00014ef0: 6262 6f78 2074 6f20 6164 6420 746f 2057  bbox to add to W
-00014f00: 4146 4552 206c 6179 6572 732e 0a0a 2020  AFER layers...  
-00014f10: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
-00014f20: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00014f30: 4172 6775 6d65 6e74 7320 666f 7220 7468  Arguments for th
-00014f40: 6520 7461 7267 6574 206d 6573 6869 6e67  e target meshing
-00014f50: 2066 756e 6374 696f 6e20 696e 2067 6473   function in gds
-00014f60: 6661 6374 6f72 792e 7369 6d75 6c61 7469  factory.simulati
-00014f70: 6f6e 2e67 6d73 680a 2020 2020 2020 2020  on.gmsh.        
-00014f80: 2222 220a 2020 2020 2020 2020 2320 4164  """.        # Ad
-00014f90: 6420 5741 4645 5220 6c61 7965 723a 0a20  d WAFER layer:. 
-00014fa0: 2020 2020 2020 2070 6164 6465 645f 636f         padded_co
-00014fb0: 6d70 6f6e 656e 7420 3d20 436f 6d70 6f6e  mponent = Compon
-00014fc0: 656e 7428 290a 2020 2020 2020 2020 7061  ent().        pa
-00014fd0: 6464 6564 5f63 6f6d 706f 6e65 6e74 203c  dded_component <
-00014fe0: 3c20 7365 6c66 0a20 2020 2020 2020 2028  < self.        (
-00014ff0: 786d 696e 2c20 796d 696e 292c 2028 786d  xmin, ymin), (xm
-00015000: 6178 2c20 796d 6178 2920 3d20 7365 6c66  ax, ymax) = self
-00015010: 2e62 626f 780a 2020 2020 2020 2020 706f  .bbox.        po
-00015020: 696e 7473 203d 205b 0a20 2020 2020 2020  ints = [.       
-00015030: 2020 2020 205b 786d 696e 202d 2077 6166       [xmin - waf
-00015040: 6572 5f70 6164 6469 6e67 2c20 796d 696e  er_padding, ymin
-00015050: 202d 2077 6166 6572 5f70 6164 6469 6e67   - wafer_padding
-00015060: 5d2c 0a20 2020 2020 2020 2020 2020 205b  ],.            [
-00015070: 786d 6178 202b 2077 6166 6572 5f70 6164  xmax + wafer_pad
-00015080: 6469 6e67 2c20 796d 696e 202d 2077 6166  ding, ymin - waf
-00015090: 6572 5f70 6164 6469 6e67 5d2c 0a20 2020  er_padding],.   
-000150a0: 2020 2020 2020 2020 205b 786d 6178 202b           [xmax +
-000150b0: 2077 6166 6572 5f70 6164 6469 6e67 2c20   wafer_padding, 
-000150c0: 796d 6178 202b 2077 6166 6572 5f70 6164  ymax + wafer_pad
-000150d0: 6469 6e67 5d2c 0a20 2020 2020 2020 2020  ding],.         
-000150e0: 2020 205b 786d 696e 202d 2077 6166 6572     [xmin - wafer
-000150f0: 5f70 6164 6469 6e67 2c20 796d 6178 202b  _padding, ymax +
-00015100: 2077 6166 6572 5f70 6164 6469 6e67 5d2c   wafer_padding],
-00015110: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-00015120: 2020 2070 6164 6465 645f 636f 6d70 6f6e     padded_compon
-00015130: 656e 742e 6164 645f 706f 6c79 676f 6e28  ent.add_polygon(
-00015140: 706f 696e 7473 2c20 6c61 7965 723d 7761  points, layer=wa
-00015150: 6665 725f 6c61 7965 7229 0a0a 2020 2020  fer_layer)..    
-00015160: 2020 2020 6966 206c 6179 6572 5f73 7461      if layer_sta
-00015170: 636b 2069 7320 4e6f 6e65 3a0a 2020 2020  ck is None:.    
-00015180: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00015190: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-000151a0: 2020 2020 2020 2020 2020 2741 204c 6179            'A Lay
-000151b0: 6572 5374 6163 6b20 6d75 7374 2062 6520  erStack must be 
-000151c0: 7072 6f76 6964 6564 2074 6872 6f75 6768  provided through
-000151d0: 2061 7267 756d 656e 7420 226c 6179 6572   argument "layer
-000151e0: 5f73 7461 636b 222e 270a 2020 2020 2020  _stack".'.      
-000151f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00015200: 6966 2074 7970 6520 3d3d 2022 7879 223a  if type == "xy":
-00015210: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015220: 7a20 6973 204e 6f6e 653a 0a20 2020 2020  z is None:.     
-00015230: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00015240: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015260: 2027 466f 7220 7879 2d6d 6573 6869 6e67   'For xy-meshing
-00015270: 2c20 6120 7a2d 7661 6c75 6520 6d75 7374  , a z-value must
-00015280: 2062 6520 7072 6f76 6964 6564 2076 6961   be provided via
-00015290: 2074 6865 2066 6c6f 6174 2061 7267 756d   the float argum
-000152a0: 656e 7420 227a 222e 270a 2020 2020 2020  ent "z".'.      
-000152b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000152c0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
-000152d0: 6661 6374 6f72 792e 7369 6d75 6c61 7469  factory.simulati
-000152e0: 6f6e 2e67 6d73 682e 7879 5f78 7365 6374  on.gmsh.xy_xsect
-000152f0: 696f 6e5f 6d65 7368 2069 6d70 6f72 7420  ion_mesh import 
-00015300: 7879 5f78 7365 6374 696f 6e5f 6d65 7368  xy_xsection_mesh
-00015310: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00015320: 7475 726e 2078 795f 7873 6563 7469 6f6e  turn xy_xsection
-00015330: 5f6d 6573 6828 7061 6464 6564 5f63 6f6d  _mesh(padded_com
-00015340: 706f 6e65 6e74 2c20 7a2c 206c 6179 6572  ponent, z, layer
-00015350: 5f73 7461 636b 2c20 2a2a 6b77 6172 6773  _stack, **kwargs
-00015360: 290a 2020 2020 2020 2020 656c 6966 2074  ).        elif t
-00015370: 7970 6520 3d3d 2022 757a 223a 0a20 2020  ype == "uz":.   
-00015380: 2020 2020 2020 2020 2069 6620 7873 6563           if xsec
-00015390: 7469 6f6e 5f62 6f75 6e64 7320 6973 204e  tion_bounds is N
-000153a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000153b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-000153c0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-000153d0: 2020 2020 2020 2020 2020 2022 466f 7220             "For 
-000153e0: 757a 2d6d 6573 6869 6e67 2c20 796f 7520  uz-meshing, you 
-000153f0: 6d75 7374 2070 726f 7669 6465 2061 206c  must provide a l
-00015400: 696e 6520 696e 2074 6865 2078 792d 706c  ine in the xy-pl
-00015410: 616e 6520 220a 2020 2020 2020 2020 2020  ane ".          
-00015420: 2020 2020 2020 2020 2020 2276 6961 2074            "via t
-00015430: 6865 2054 7570 6c65 2061 7267 756d 656e  he Tuple argumen
-00015440: 7420 5b5b 7831 2c79 315d 2c20 5b78 322c  t [[x1,y1], [x2,
-00015450: 7932 5d5d 2078 7365 6374 696f 6e5f 626f  y2]] xsection_bo
-00015460: 756e 6473 2e22 0a20 2020 2020 2020 2020  unds.".         
-00015470: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00015480: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
-00015490: 746f 7279 2e73 696d 756c 6174 696f 6e2e  tory.simulation.
-000154a0: 676d 7368 2e75 7a5f 7873 6563 7469 6f6e  gmsh.uz_xsection
-000154b0: 5f6d 6573 6820 696d 706f 7274 2075 7a5f  _mesh import uz_
-000154c0: 7873 6563 7469 6f6e 5f6d 6573 680a 0a20  xsection_mesh.. 
-000154d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000154e0: 6e20 757a 5f78 7365 6374 696f 6e5f 6d65  n uz_xsection_me
-000154f0: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
-00015500: 2020 2020 7061 6464 6564 5f63 6f6d 706f      padded_compo
-00015510: 6e65 6e74 2c20 7873 6563 7469 6f6e 5f62  nent, xsection_b
-00015520: 6f75 6e64 732c 206c 6179 6572 5f73 7461  ounds, layer_sta
-00015530: 636b 2c20 2a2a 6b77 6172 6773 0a20 2020  ck, **kwargs.   
-00015540: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00015550: 2020 2065 6c69 6620 7479 7065 203d 3d20     elif type == 
-00015560: 2233 4422 3a0a 2020 2020 2020 2020 2020  "3D":.          
-00015570: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-00015580: 792e 7369 6d75 6c61 7469 6f6e 2e67 6d73  y.simulation.gms
-00015590: 682e 7879 7a5f 6d65 7368 2069 6d70 6f72  h.xyz_mesh impor
-000155a0: 7420 7879 7a5f 6d65 7368 0a0a 2020 2020  t xyz_mesh..    
-000155b0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
-000155c0: 797a 5f6d 6573 6828 7061 6464 6564 5f63  yz_mesh(padded_c
-000155d0: 6f6d 706f 6e65 6e74 2c20 6c61 7965 725f  omponent, layer_
-000155e0: 7374 6163 6b2c 202a 2a6b 7761 7267 7329  stack, **kwargs)
-000155f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015600: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00015610: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00015620: 2020 2020 2020 2020 2020 2020 2027 5265               'Re
-00015630: 7175 6972 6564 2061 7267 756d 656e 7420  quired argument 
-00015640: 2274 7970 6522 206d 7573 7420 6265 206f  "type" must be o
-00015650: 6e65 206f 6620 2278 7922 2c20 2275 7a22  ne of "xy", "uz"
-00015660: 2c20 6f72 2022 3344 222e 270a 2020 2020  , or "3D".'.    
-00015670: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00015680: 6566 206f 6666 7365 7428 0a20 2020 2020  ef offset(.     
-00015690: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000156a0: 2064 6973 7461 6e63 653a 2066 6c6f 6174   distance: float
-000156b0: 203d 2030 2e31 2c0a 2020 2020 2020 2020   = 0.1,.        
-000156c0: 706f 6c79 676f 6e73 3d4e 6f6e 652c 0a20  polygons=None,. 
-000156d0: 2020 2020 2020 2075 7365 5f75 6e69 6f6e         use_union
-000156e0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-000156f0: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
-00015700: 3a20 666c 6f61 7420 3d20 3165 2d34 2c0a  : float = 1e-4,.
-00015710: 2020 2020 2020 2020 6a6f 696e 3a20 7374          join: st
-00015720: 7220 3d20 226d 6974 6572 222c 0a20 2020  r = "miter",.   
-00015730: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
-00015740: 696e 7420 3d20 322c 0a20 2020 2020 2020  int = 2,.       
-00015750: 206c 6179 6572 3a20 4c61 7965 7253 7065   layer: LayerSpe
-00015760: 6320 3d20 2257 4722 2c0a 2020 2020 2920  c = "WG",.    ) 
-00015770: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-00015780: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-00015790: 206e 6577 2043 6f6d 706f 6e65 6e74 2077   new Component w
-000157a0: 6974 6820 706f 6c79 676f 6e73 2065 726f  ith polygons ero
-000157b0: 6465 6420 6f72 2064 696c 6174 6564 2062  ded or dilated b
-000157c0: 7920 616e 206f 6666 7365 742e 0a0a 2020  y an offset...  
-000157d0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-000157e0: 2020 2020 2020 2020 6469 7374 616e 6365          distance
-000157f0: 3a20 4469 7374 616e 6365 2074 6f20 6f66  : Distance to of
-00015800: 6673 6574 2070 6f6c 7967 6f6e 732e 2050  fset polygons. P
-00015810: 6f73 6974 6976 6520 7661 6c75 6573 2065  ositive values e
-00015820: 7870 616e 642c 206e 6567 6174 6976 6520  xpand, negative 
-00015830: 7368 7269 6e6b 2e0a 2020 2020 2020 2020  shrink..        
-00015840: 2020 2020 7072 6563 6973 696f 6e3a 2044      precision: D
-00015850: 6573 6972 6564 2070 7265 6369 7369 6f6e  esired precision
-00015860: 2066 6f72 2072 6f75 6e64 696e 6720 7665   for rounding ve
-00015870: 7274 6578 2063 6f6f 7264 696e 6174 6573  rtex coordinates
-00015880: 2e0a 2020 2020 2020 2020 2020 2020 6a6f  ..            jo
-00015890: 696e 3a20 7b27 6d69 7465 7227 2c20 2762  in: {'miter', 'b
-000158a0: 6576 656c 272c 2027 726f 756e 6427 7d20  evel', 'round'} 
-000158b0: 5479 7065 206f 6620 6a6f 696e 2075 7365  Type of join use
-000158c0: 6420 746f 2063 7265 6174 6520 706f 6c79  d to create poly
-000158d0: 676f 6e20 6f66 6673 6574 0a20 2020 2020  gon offset.     
-000158e0: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
-000158f0: 3a20 466f 7220 6d69 7465 7220 6a6f 696e  : For miter join
-00015900: 7473 2c20 7468 6973 206e 756d 6265 7220  ts, this number 
-00015910: 6d75 7374 2062 6520 6174 206c 6561 7374  must be at least
-00015920: 2032 2072 6570 7265 7365 6e74 7320 7468   2 represents th
-00015930: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00015940: 6d61 7869 6d61 6c20 6469 7374 616e 6365  maximal distance
-00015950: 2069 6e20 6d75 6c74 6970 6c65 7320 6f66   in multiples of
-00015960: 206f 6666 7365 7420 6265 7477 6565 6e20   offset between 
-00015970: 6e65 7720 7665 7274 6963 6573 2061 6e64  new vertices and
-00015980: 2074 6865 6972 0a20 2020 2020 2020 2020   their.         
-00015990: 2020 2020 206f 7269 6769 6e61 6c20 706f       original po
-000159a0: 7369 7469 6f6e 2062 6566 6f72 6520 6265  sition before be
-000159b0: 7665 6c69 6e67 2074 6f20 6176 6f69 6420  veling to avoid 
-000159c0: 7370 696b 6573 2061 7420 6163 7574 6520  spikes at acute 
-000159d0: 6a6f 696e 7473 2e20 466f 720a 2020 2020  joints. For.    
-000159e0: 2020 2020 2020 2020 2020 726f 756e 6420            round 
-000159f0: 6a6f 696e 7473 2c20 6974 2069 6e64 6963  joints, it indic
-00015a00: 6174 6573 2074 6865 2063 7572 7661 7475  ates the curvatu
-00015a10: 7265 2072 6573 6f6c 7574 696f 6e20 696e  re resolution in
-00015a20: 206e 756d 6265 7220 6f66 0a20 2020 2020   number of.     
-00015a30: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
-00015a40: 7065 7220 6675 6c6c 2063 6972 636c 652e  per full circle.
-00015a50: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00015a60: 6572 3a20 5370 6563 6966 6963 206c 6179  er: Specific lay
-00015a70: 6572 2066 6f72 206e 6577 2070 6f6c 7967  er for new polyg
-00015a80: 6f6e 732e 0a0a 2020 2020 2020 2020 2222  ons...        ""
-00015a90: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
-00015aa0: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
-00015ab0: 660a 0a20 2020 2020 2020 2067 6473 5f6c  f..        gds_l
-00015ac0: 6179 6572 2c20 6764 735f 6461 7461 7479  ayer, gds_dataty
-00015ad0: 7065 203d 2067 662e 6765 745f 6c61 7965  pe = gf.get_laye
-00015ae0: 7228 6c61 7965 7229 0a20 2020 2020 2020  r(layer).       
-00015af0: 2070 203d 2067 6473 746b 2e6f 6666 7365   p = gdstk.offse
-00015b00: 7428 0a20 2020 2020 2020 2020 2020 2070  t(.            p
-00015b10: 6f6c 7967 6f6e 7320 6f72 2073 656c 662e  olygons or self.
-00015b20: 6765 745f 706f 6c79 676f 6e73 2829 2c0a  get_polygons(),.
-00015b30: 2020 2020 2020 2020 2020 2020 6469 7374              dist
-00015b40: 616e 6365 3d64 6973 7461 6e63 652c 0a20  ance=distance,. 
-00015b50: 2020 2020 2020 2020 2020 206a 6f69 6e3d             join=
-00015b60: 6a6f 696e 2c0a 2020 2020 2020 2020 2020  join,.          
-00015b70: 2020 746f 6c65 7261 6e63 653d 746f 6c65    tolerance=tole
-00015b80: 7261 6e63 652c 0a20 2020 2020 2020 2020  rance,.         
-00015b90: 2020 2070 7265 6369 7369 6f6e 3d70 7265     precision=pre
-00015ba0: 6369 7369 6f6e 2c0a 2020 2020 2020 2020  cision,.        
-00015bb0: 2020 2020 7573 655f 756e 696f 6e3d 7573      use_union=us
-00015bc0: 655f 756e 696f 6e2c 0a20 2020 2020 2020  e_union,.       
-00015bd0: 2020 2020 206c 6179 6572 3d67 6473 5f6c       layer=gds_l
-00015be0: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
-00015bf0: 2020 6461 7461 7479 7065 3d67 6473 5f64    datatype=gds_d
-00015c00: 6174 6174 7970 652c 0a20 2020 2020 2020  atatype,.       
-00015c10: 2029 0a0a 2020 2020 2020 2020 636f 6d70   )..        comp
-00015c20: 6f6e 656e 7420 3d20 6766 2e43 6f6d 706f  onent = gf.Compo
-00015c30: 6e65 6e74 2829 0a20 2020 2020 2020 2063  nent().        c
-00015c40: 6f6d 706f 6e65 6e74 2e61 6464 5f70 6f6c  omponent.add_pol
-00015c50: 7967 6f6e 2870 2c20 6c61 7965 723d 6c61  ygon(p, layer=la
-00015c60: 7965 7229 0a20 2020 2020 2020 2072 6574  yer).        ret
-00015c70: 7572 6e20 636f 6d70 6f6e 656e 740a 0a0a  urn component...
-00015c80: 6465 6620 636f 7079 280a 2020 2020 443a  def copy(.    D:
-00015c90: 2043 6f6d 706f 6e65 6e74 2c0a 2020 2020   Component,.    
-00015ca0: 7265 6665 7265 6e63 6573 3d4e 6f6e 652c  references=None,
-00015cb0: 0a20 2020 2070 6f72 7473 3d4e 6f6e 652c  .    ports=None,
-00015cc0: 0a20 2020 2070 6f6c 7967 6f6e 733d 4e6f  .    polygons=No
-00015cd0: 6e65 2c0a 2020 2020 7061 7468 733d 4e6f  ne,.    paths=No
-00015ce0: 6e65 2c0a 2020 2020 6e61 6d65 3d4e 6f6e  ne,.    name=Non
-00015cf0: 652c 0a20 2020 206c 6162 656c 733d 4e6f  e,.    labels=No
-00015d00: 6e65 2c0a 2920 2d3e 2043 6f6d 706f 6e65  ne,.) -> Compone
-00015d10: 6e74 3a0a 2020 2020 2222 2252 6574 7572  nt:.    """Retur
-00015d20: 6e73 2061 2043 6f6d 706f 6e65 6e74 2063  ns a Component c
-00015d30: 6f70 792e 0a0a 2020 2020 4172 6773 3a0a  opy...    Args:.
-00015d40: 2020 2020 2020 2020 443a 2063 6f6d 706f          D: compo
-00015d50: 6e65 6e74 2074 6f20 636f 7079 2e0a 2020  nent to copy..  
-00015d60: 2020 2222 220a 2020 2020 445f 636f 7079    """.    D_copy
-00015d70: 203d 2043 6f6d 706f 6e65 6e74 2829 0a20   = Component(). 
-00015d80: 2020 2044 5f63 6f70 792e 696e 666f 203d     D_copy.info =
-00015d90: 2044 2e69 6e66 6f0a 2020 2020 2320 445f   D.info.    # D_
-00015da0: 636f 7079 2e5f 6365 6c6c 203d 2044 2e5f  copy._cell = D._
-00015db0: 6365 6c6c 2e63 6f70 7928 6e61 6d65 3d44  cell.copy(name=D
-00015dc0: 5f63 6f70 792e 6e61 6d65 290a 0a20 2020  _copy.name)..   
-00015dd0: 2066 6f72 2072 6566 2069 6e20 7265 6665   for ref in refe
-00015de0: 7265 6e63 6573 2069 6620 7265 6665 7265  rences if refere
-00015df0: 6e63 6573 2069 7320 6e6f 7420 4e6f 6e65  nces is not None
-00015e00: 2065 6c73 6520 442e 7265 6665 7265 6e63   else D.referenc
-00015e10: 6573 3a0a 2020 2020 2020 2020 445f 636f  es:.        D_co
-00015e20: 7079 2e61 6464 2863 6f70 795f 7265 6665  py.add(copy_refe
-00015e30: 7265 6e63 6528 7265 6629 290a 2020 2020  rence(ref)).    
-00015e40: 666f 7220 706f 7274 2069 6e20 2870 6f72  for port in (por
-00015e50: 7473 2069 6620 706f 7274 7320 6973 206e  ts if ports is n
-00015e60: 6f74 204e 6f6e 6520 656c 7365 2044 2e70  ot None else D.p
-00015e70: 6f72 7473 292e 7661 6c75 6573 2829 3a0a  orts).values():.
-00015e80: 2020 2020 2020 2020 445f 636f 7079 2e61          D_copy.a
-00015e90: 6464 5f70 6f72 7428 706f 7274 3d70 6f72  dd_port(port=por
-00015ea0: 7429 0a20 2020 2066 6f72 2070 6f6c 7920  t).    for poly 
-00015eb0: 696e 2070 6f6c 7967 6f6e 7320 6966 2070  in polygons if p
-00015ec0: 6f6c 7967 6f6e 7320 6973 206e 6f74 204e  olygons is not N
-00015ed0: 6f6e 6520 656c 7365 2044 2e70 6f6c 7967  one else D.polyg
-00015ee0: 6f6e 733a 0a20 2020 2020 2020 2044 5f63  ons:.        D_c
-00015ef0: 6f70 792e 6164 645f 706f 6c79 676f 6e28  opy.add_polygon(
-00015f00: 706f 6c79 290a 2020 2020 666f 7220 7061  poly).    for pa
-00015f10: 7468 2069 6e20 7061 7468 7320 6966 2070  th in paths if p
-00015f20: 6174 6873 2069 7320 6e6f 7420 4e6f 6e65  aths is not None
-00015f30: 2065 6c73 6520 442e 7061 7468 733a 0a20   else D.paths:. 
-00015f40: 2020 2020 2020 2044 5f63 6f70 792e 6164         D_copy.ad
-00015f50: 6428 7061 7468 290a 2020 2020 666f 7220  d(path).    for 
-00015f60: 6c61 6265 6c20 696e 206c 6162 656c 7320  label in labels 
-00015f70: 6966 206c 6162 656c 7320 6973 206e 6f74  if labels is not
-00015f80: 204e 6f6e 6520 656c 7365 2044 2e6c 6162   None else D.lab
-00015f90: 656c 733a 0a20 2020 2020 2020 2044 5f63  els:.        D_c
-00015fa0: 6f70 792e 6164 645f 6c61 6265 6c28 0a20  opy.add_label(. 
-00015fb0: 2020 2020 2020 2020 2020 2074 6578 743d             text=
-00015fc0: 6c61 6265 6c2e 7465 7874 2c0a 2020 2020  label.text,.    
-00015fd0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
-00015fe0: 3d6c 6162 656c 2e6f 7269 6769 6e2c 0a20  =label.origin,. 
-00015ff0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00016000: 3d28 6c61 6265 6c2e 6c61 7965 722c 206c  =(label.layer, l
-00016010: 6162 656c 2e74 6578 7474 7970 6529 2c0a  abel.texttype),.
-00016020: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
-00016030: 6620 6e61 6d65 2069 7320 6e6f 7420 4e6f  f name is not No
-00016040: 6e65 3a0a 2020 2020 2020 2020 445f 636f  ne:.        D_co
-00016050: 7079 2e6e 616d 6520 3d20 6e61 6d65 0a0a  py.name = name..
-00016060: 2020 2020 7265 7475 726e 2044 5f63 6f70      return D_cop
-00016070: 790a 0a0a 6465 6620 636f 7079 5f72 6566  y...def copy_ref
-00016080: 6572 656e 6365 280a 2020 2020 7265 662c  erence(.    ref,
-00016090: 0a20 2020 2070 6172 656e 743d 4e6f 6e65  .    parent=None
-000160a0: 2c0a 2020 2020 636f 6c75 6d6e 733d 4e6f  ,.    columns=No
-000160b0: 6e65 2c0a 2020 2020 726f 7773 3d4e 6f6e  ne,.    rows=Non
-000160c0: 652c 0a20 2020 2073 7061 6369 6e67 3d4e  e,.    spacing=N
-000160d0: 6f6e 652c 0a20 2020 206f 7269 6769 6e3d  one,.    origin=
-000160e0: 4e6f 6e65 2c0a 2020 2020 726f 7461 7469  None,.    rotati
-000160f0: 6f6e 3d4e 6f6e 652c 0a20 2020 206d 6167  on=None,.    mag
-00016100: 6e69 6669 6361 7469 6f6e 3d4e 6f6e 652c  nification=None,
-00016110: 0a20 2020 2078 5f72 6566 6c65 6374 696f  .    x_reflectio
-00016120: 6e3d 4e6f 6e65 2c0a 2020 2020 6e61 6d65  n=None,.    name
-00016130: 3d4e 6f6e 652c 0a20 2020 2076 313d 4e6f  =None,.    v1=No
-00016140: 6e65 2c0a 2020 2020 7632 3d4e 6f6e 652c  ne,.    v2=None,
-00016150: 0a29 202d 3e20 436f 6d70 6f6e 656e 7452  .) -> ComponentR
-00016160: 6566 6572 656e 6365 3a0a 2020 2020 7265  eference:.    re
-00016170: 7475 726e 2043 6f6d 706f 6e65 6e74 5265  turn ComponentRe
-00016180: 6665 7265 6e63 6528 0a20 2020 2020 2020  ference(.       
-00016190: 2063 6f6d 706f 6e65 6e74 3d70 6172 656e   component=paren
-000161a0: 7420 6f72 2072 6566 2e70 6172 656e 742c  t or ref.parent,
-000161b0: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
-000161c0: 3d63 6f6c 756d 6e73 206f 7220 7265 662e  =columns or ref.
-000161d0: 636f 6c75 6d6e 732c 0a20 2020 2020 2020  columns,.       
-000161e0: 2072 6f77 733d 726f 7773 206f 7220 7265   rows=rows or re
-000161f0: 662e 726f 7773 2c0a 2020 2020 2020 2020  f.rows,.        
-00016200: 7370 6163 696e 673d 7370 6163 696e 6720  spacing=spacing 
-00016210: 6f72 2072 6566 2e73 7061 6369 6e67 2c0a  or ref.spacing,.
-00016220: 2020 2020 2020 2020 6f72 6967 696e 3d6f          origin=o
-00016230: 7269 6769 6e20 6f72 2072 6566 2e6f 7269  rigin or ref.ori
-00016240: 6769 6e2c 0a20 2020 2020 2020 2072 6f74  gin,.        rot
-00016250: 6174 696f 6e3d 726f 7461 7469 6f6e 206f  ation=rotation o
-00016260: 7220 7265 662e 726f 7461 7469 6f6e 2c0a  r ref.rotation,.
-00016270: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
-00016280: 6174 696f 6e3d 6d61 676e 6966 6963 6174  ation=magnificat
-00016290: 696f 6e20 6f72 2072 6566 2e6d 6167 6e69  ion or ref.magni
-000162a0: 6669 6361 7469 6f6e 2c0a 2020 2020 2020  fication,.      
-000162b0: 2020 785f 7265 666c 6563 7469 6f6e 3d78    x_reflection=x
-000162c0: 5f72 6566 6c65 6374 696f 6e20 6f72 2072  _reflection or r
-000162d0: 6566 2e78 5f72 6566 6c65 6374 696f 6e2c  ef.x_reflection,
-000162e0: 0a20 2020 2020 2020 206e 616d 653d 6e61  .        name=na
-000162f0: 6d65 206f 7220 7265 662e 6e61 6d65 2c0a  me or ref.name,.
-00016300: 2020 2020 2020 2020 7631 3d76 3120 6f72          v1=v1 or
-00016310: 2072 6566 2e76 312c 0a20 2020 2020 2020   ref.v1,.       
-00016320: 2076 323d 7632 206f 7220 7265 662e 7632   v2=v2 or ref.v2
-00016330: 2c0a 2020 2020 290a 0a0a 6465 6620 7465  ,.    )...def te
-00016340: 7374 5f67 6574 5f6c 6179 6572 7328 2920  st_get_layers() 
-00016350: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-00016360: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
-00016370: 6f72 7920 6173 2067 660a 0a20 2020 2063  ory as gf..    c
-00016380: 3120 3d20 6766 2e63 6f6d 706f 6e65 6e74  1 = gf.component
-00016390: 732e 7374 7261 6967 6874 280a 2020 2020  s.straight(.    
-000163a0: 2020 2020 6c65 6e67 7468 3d31 302c 0a20      length=10,. 
-000163b0: 2020 2020 2020 2077 6964 7468 3d30 2e35         width=0.5
-000163c0: 2c0a 2020 2020 2020 2020 6c61 7965 723d  ,.        layer=
-000163d0: 2832 2c20 3029 2c0a 2020 2020 2020 2020  (2, 0),.        
-000163e0: 6262 6f78 5f6c 6179 6572 733d 5b28 3131  bbox_layers=[(11
-000163f0: 312c 2030 295d 2c0a 2020 2020 2020 2020  1, 0)],.        
-00016400: 6262 6f78 5f6f 6666 7365 7473 3d5b 335d  bbox_offsets=[3]
-00016410: 2c0a 2020 2020 2020 2020 7769 7468 5f62  ,.        with_b
-00016420: 626f 783d 5472 7565 2c0a 2020 2020 2020  box=True,.      
-00016430: 2020 636c 6164 6469 6e67 5f6c 6179 6572    cladding_layer
-00016440: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-00016450: 6164 645f 7069 6e73 3d4e 6f6e 652c 0a20  add_pins=None,. 
-00016460: 2020 2020 2020 2061 6464 5f62 626f 783d         add_bbox=
-00016470: 4e6f 6e65 2c0a 2020 2020 290a 2020 2020  None,.    ).    
-00016480: 6173 7365 7274 2063 312e 6765 745f 6c61  assert c1.get_la
-00016490: 7965 7273 2829 203d 3d20 7b28 322c 2030  yers() == {(2, 0
-000164a0: 292c 2028 3131 312c 2030 297d 2c20 6331  ), (111, 0)}, c1
-000164b0: 2e67 6574 5f6c 6179 6572 7328 290a 2020  .get_layers().  
-000164c0: 2020 2320 7265 7475 726e 2063 310a 2020    # return c1.  
-000164d0: 2020 6332 203d 2063 312e 7265 6d6f 7665    c2 = c1.remove
-000164e0: 5f6c 6179 6572 7328 5b28 3131 312c 2030  _layers([(111, 0
-000164f0: 295d 290a 2020 2020 6173 7365 7274 2063  )]).    assert c
-00016500: 322e 6765 745f 6c61 7965 7273 2829 203d  2.get_layers() =
-00016510: 3d20 7b28 322c 2030 297d 2c20 6332 2e67  = {(2, 0)}, c2.g
-00016520: 6574 5f6c 6179 6572 7328 290a 2020 2020  et_layers().    
-00016530: 7265 7475 726e 2063 320a 0a0a 6465 6620  return c2...def 
-00016540: 5f66 696c 7465 725f 706f 6c79 7328 706f  _filter_polys(po
-00016550: 6c79 676f 6e73 2c20 6c61 7965 7273 5f65  lygons, layers_e
-00016560: 7863 6c29 3a0a 2020 2020 7265 7475 726e  xcl):.    return
-00016570: 205b 0a20 2020 2020 2020 2070 6f6c 7967   [.        polyg
-00016580: 6f6e 0a20 2020 2020 2020 2066 6f72 2070  on.        for p
-00016590: 6f6c 7967 6f6e 2c20 6c61 7965 722c 2064  olygon, layer, d
-000165a0: 6174 6174 7970 6520 696e 207a 6970 280a  atatype in zip(.
-000165b0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-000165c0: 676f 6e73 2e70 6f6c 7967 6f6e 732c 2070  gons.polygons, p
-000165d0: 6f6c 7967 6f6e 732e 6c61 7965 7273 2c20  olygons.layers, 
-000165e0: 706f 6c79 676f 6e73 2e64 6174 6174 7970  polygons.datatyp
-000165f0: 6573 0a20 2020 2020 2020 2029 0a20 2020  es.        ).   
-00016600: 2020 2020 2069 6620 286c 6179 6572 2c20       if (layer, 
-00016610: 6461 7461 7479 7065 2920 6e6f 7420 696e  datatype) not in
-00016620: 206c 6179 6572 735f 6578 636c 0a20 2020   layers_excl.   
-00016630: 205d 0a0a 0a64 6566 2072 6563 7572 7365   ]...def recurse
-00016640: 5f73 7472 7563 7475 7265 7328 0a20 2020  _structures(.   
-00016650: 2063 6f6d 706f 6e65 6e74 3a20 436f 6d70   component: Comp
-00016660: 6f6e 656e 742c 0a20 2020 2069 676e 6f72  onent,.    ignor
-00016670: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
-00016680: 6669 783a 204f 7074 696f 6e61 6c5b 4c69  fix: Optional[Li
-00016690: 7374 5b73 7472 5d5d 203d 204e 6f6e 652c  st[str]] = None,
-000166a0: 0a20 2020 2069 676e 6f72 655f 6675 6e63  .    ignore_func
-000166b0: 7469 6f6e 735f 7072 6566 6978 3a20 4f70  tions_prefix: Op
-000166c0: 7469 6f6e 616c 5b4c 6973 745b 7374 725d  tional[List[str]
-000166d0: 5d20 3d20 4e6f 6e65 2c0a 2920 2d3e 2044  ] = None,.) -> D
-000166e0: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
-000166f0: 2020 2022 2222 5265 6375 7273 6520 636f     """Recurse co
-00016700: 6d70 6f6e 656e 7420 616e 6420 636f 6d70  mponent and comp
-00016710: 6f6e 656e 7473 2072 6566 6572 656e 6365  onents reference
-00016720: 7320 7265 6375 7273 6976 656c 792e 0a0a  s recursively...
-00016730: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00016740: 2020 636f 6d70 6f6e 656e 743a 2063 6f6d    component: com
-00016750: 706f 6e65 6e74 2074 6f20 7265 6375 7273  ponent to recurs
-00016760: 652e 0a20 2020 2020 2020 2069 676e 6f72  e..        ignor
-00016770: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
-00016780: 6669 783a 206c 6973 7420 6f66 2070 7265  fix: list of pre
-00016790: 6669 7820 746f 2069 676e 6f72 652e 0a20  fix to ignore.. 
-000167a0: 2020 2020 2020 2069 676e 6f72 655f 6675         ignore_fu
-000167b0: 6e63 7469 6f6e 735f 7072 6566 6978 3a20  nctions_prefix: 
-000167c0: 6c69 7374 206f 6620 7072 6566 6978 2074  list of prefix t
-000167d0: 6f20 6967 6e6f 7265 2e0a 2020 2020 2222  o ignore..    ""
-000167e0: 220a 2020 2020 6967 6e6f 7265 5f66 756e  ".    ignore_fun
-000167f0: 6374 696f 6e73 5f70 7265 6669 7820 3d20  ctions_prefix = 
-00016800: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
-00016810: 5f70 7265 6669 7820 6f72 205b 5d0a 2020  _prefix or [].  
-00016820: 2020 6967 6e6f 7265 5f63 6f6d 706f 6e65    ignore_compone
-00016830: 6e74 735f 7072 6566 6978 203d 2069 676e  nts_prefix = ign
-00016840: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
-00016850: 7265 6669 7820 6f72 205b 5d0a 0a20 2020  refix or []..   
-00016860: 2069 6620 280a 2020 2020 2020 2020 6861   if (.        ha
-00016870: 7361 7474 7228 636f 6d70 6f6e 656e 742c  sattr(component,
-00016880: 2022 6675 6e63 7469 6f6e 5f6e 616d 6522   "function_name"
-00016890: 290a 2020 2020 2020 2020 616e 6420 636f  ).        and co
-000168a0: 6d70 6f6e 656e 742e 6675 6e63 7469 6f6e  mponent.function
-000168b0: 5f6e 616d 6520 696e 2069 676e 6f72 655f  _name in ignore_
-000168c0: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
-000168d0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-000168e0: 7265 7475 726e 207b 7d0a 0a20 2020 2069  return {}..    i
-000168f0: 6620 6861 7361 7474 7228 636f 6d70 6f6e  f hasattr(compon
-00016900: 656e 742c 2022 6e61 6d65 2229 2061 6e64  ent, "name") and
-00016910: 2061 6e79 280a 2020 2020 2020 2020 636f   any(.        co
-00016920: 6d70 6f6e 656e 742e 6e61 6d65 2e73 7461  mponent.name.sta
-00016930: 7274 7377 6974 6828 6929 2066 6f72 2069  rtswith(i) for i
-00016940: 2069 6e20 6967 6e6f 7265 5f63 6f6d 706f   in ignore_compo
-00016950: 6e65 6e74 735f 7072 6566 6978 0a20 2020  nents_prefix.   
-00016960: 2029 3a0a 2020 2020 2020 2020 7265 7475   ):.        retu
-00016970: 726e 207b 7d0a 0a20 2020 206f 7574 7075  rn {}..    outpu
-00016980: 7420 3d20 7b63 6f6d 706f 6e65 6e74 2e6e  t = {component.n
-00016990: 616d 653a 2064 6963 7428 636f 6d70 6f6e  ame: dict(compon
-000169a0: 656e 742e 7365 7474 696e 6773 297d 0a20  ent.settings)}. 
-000169b0: 2020 2066 6f72 2072 6566 6572 656e 6365     for reference
-000169c0: 2069 6e20 636f 6d70 6f6e 656e 742e 7265   in component.re
-000169d0: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
-000169e0: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-000169f0: 2020 2069 7369 6e73 7461 6e63 6528 7265     isinstance(re
-00016a00: 6665 7265 6e63 652c 2043 6f6d 706f 6e65  ference, Compone
-00016a10: 6e74 5265 6665 7265 6e63 6529 0a20 2020  ntReference).   
-00016a20: 2020 2020 2020 2020 2061 6e64 2072 6566           and ref
-00016a30: 6572 656e 6365 2e72 6566 5f63 656c 6c2e  erence.ref_cell.
-00016a40: 6e61 6d65 206e 6f74 2069 6e20 6f75 7470  name not in outp
-00016a50: 7574 0a20 2020 2020 2020 2029 3a0a 2020  ut.        ):.  
-00016a60: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00016a70: 2e75 7064 6174 6528 7265 6375 7273 655f  .update(recurse_
-00016a80: 7374 7275 6374 7572 6573 2872 6566 6572  structures(refer
-00016a90: 656e 6365 2e72 6566 5f63 656c 6c29 290a  ence.ref_cell)).
-00016aa0: 0a20 2020 2072 6574 7572 6e20 6f75 7470  .    return outp
-00016ab0: 7574 0a0a 0a64 6566 2066 6c61 7474 656e  ut...def flatten
-00016ac0: 5f69 6e76 616c 6964 5f72 6566 735f 7265  _invalid_refs_re
-00016ad0: 6375 7273 6976 6528 0a20 2020 2063 6f6d  cursive(.    com
-00016ae0: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
-00016af0: 742c 0a20 2020 2067 7269 645f 7369 7a65  t,.    grid_size
-00016b00: 3a20 4f70 7469 6f6e 616c 5b66 6c6f 6174  : Optional[float
-00016b10: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 7570  ] = None,.    up
-00016b20: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
-00016b30: 3d4e 6f6e 652c 0a20 2020 2074 7261 7665  =None,.    trave
-00016b40: 7273 6564 5f63 6f6d 706f 6e65 6e74 733d  rsed_components=
-00016b50: 4e6f 6e65 2c0a 293a 0a20 2020 2022 2222  None,.):.    """
-00016b60: 5265 6375 7273 6976 656c 7920 666c 6174  Recursively flat
-00016b70: 7465 6e73 2063 6f6d 706f 6e65 6e74 2072  tens component r
-00016b80: 6566 6572 656e 6365 7320 7768 6963 6820  eferences which 
-00016b90: 6861 7665 2069 6e76 616c 6964 2074 7261  have invalid tra
-00016ba0: 6e73 666f 726d 6174 696f 6e73 2028 692e  nsformations (i.
-00016bb0: 652e 206e 6f6e 2d39 3020 6465 6720 726f  e. non-90 deg ro
-00016bc0: 7461 7469 6f6e 7320 6f72 2073 7562 2d67  tations or sub-g
-00016bd0: 7269 6420 7472 616e 736c 6174 696f 6e73  rid translations
-00016be0: 2920 616e 6420 7265 7475 726e 7320 6120  ) and returns a 
-00016bf0: 636f 7079 2069 6620 616e 7920 7375 6263  copy if any subc
-00016c00: 656c 6c73 2068 6176 6520 6265 656e 206d  ells have been m
-00016c10: 6f64 6966 6965 642e 0a0a 2020 2020 5741  odified...    WA
-00016c20: 524e 494e 473a 2074 6869 7320 6675 6e63  RNING: this func
-00016c30: 7469 6f6e 2077 696c 6c20 7072 6f64 7563  tion will produc
-00016c40: 6520 7361 6d65 2d6e 616d 6520 636f 7069  e same-name copi
-00016c50: 6573 206f 6620 6365 6c6c 732e 2049 7420  es of cells. It 
-00016c60: 6973 2073 7472 6963 746c 7920 6d65 616e  is strictly mean
-00016c70: 7420 746f 2062 6520 7573 6564 206f 6e20  t to be used on 
-00016c80: 7772 6974 6520 6f66 2074 6865 2047 4453  write of the GDS
-00016c90: 2066 696c 6520 616e 640a 2020 2020 7368   file and.    sh
-00016ca0: 6f75 6c64 206e 6f74 2062 6520 6d69 7865  ould not be mixe
-00016cb0: 6420 7769 7468 206f 7468 6572 2063 656c  d with other cel
-00016cc0: 6c73 2c20 6f72 2079 6f75 2077 696c 6c20  ls, or you will 
-00016cd0: 6c69 6b65 6c79 2065 7870 6572 6965 6e63  likely experienc
-00016ce0: 6520 6973 7375 6573 2077 6974 6820 6475  e issues with du
-00016cf0: 706c 6963 6174 6520 6365 6c6c 730a 0a20  plicate cells.. 
-00016d00: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00016d10: 2063 6f6d 706f 6e65 6e74 3a20 7468 6520   component: the 
-00016d20: 636f 6d70 6f6e 656e 7420 746f 2066 6978  component to fix
-00016d30: 2028 696e 2070 6c61 6365 292e 0a20 2020   (in place)..   
-00016d40: 2020 2020 2067 7269 645f 7369 7a65 3a20       grid_size: 
-00016d50: 7468 6520 4744 5320 6772 6964 2073 697a  the GDS grid siz
-00016d60: 652c 2069 6e20 756d 2c20 6465 6661 756c  e, in um, defaul
-00016d70: 7473 2074 6f20 6163 7469 7665 2050 444b  ts to active PDK
-00016d80: 2e67 6574 5f67 7269 645f 7369 7a65 2829  .get_grid_size()
-00016d90: 0a20 2020 2020 2020 2020 2020 2061 6e79  .            any
-00016da0: 2074 7261 6e73 6c61 7469 6f6e 7320 7769   translations wi
-00016db0: 7468 2068 6967 6865 7220 7265 736f 6c75  th higher resolu
-00016dc0: 7469 6f6e 2074 6861 6e20 7468 6973 2061  tion than this a
-00016dd0: 7265 2063 6f6e 7369 6465 7265 6420 696e  re considered in
-00016de0: 7661 6c69 642e 0a20 2020 2020 2020 2075  valid..        u
-00016df0: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
-00016e00: 733a 2074 6865 2072 756e 6e69 6e67 2064  s: the running d
-00016e10: 6963 7469 6f6e 6172 7920 6f66 2063 6f6d  ictionary of com
-00016e20: 706f 6e65 6e74 7320 7768 6963 6820 6861  ponents which ha
-00016e30: 7665 2062 6565 6e20 6d6f 6469 6669 6564  ve been modified
-00016e40: 2062 7920 7468 6973 2074 7261 6e73 666f   by this transfo
-00016e50: 726d 6174 696f 6e2e 2053 686f 756c 6420  rmation. Should 
-00016e60: 616c 7761 7973 2062 6520 4e6f 6e65 2c20  always be None, 
-00016e70: 6578 6365 7074 2066 6f72 2072 6563 7572  except for recur
-00016e80: 7369 7665 2069 6e76 6f63 6174 696f 6e73  sive invocations
-00016e90: 2e0a 2020 2020 2020 2020 7472 6176 6572  ..        traver
-00016ea0: 7365 645f 636f 6d70 6f6e 656e 7473 3a20  sed_components: 
-00016eb0: 7468 6520 7365 7420 6f66 2063 6f6d 706f  the set of compo
-00016ec0: 6e65 6e74 206e 616d 6573 2077 6869 6368  nent names which
-00016ed0: 2068 6176 6520 6265 656e 2074 7261 7665   have been trave
-00016ee0: 7273 6564 2e20 5368 6f75 6c64 2061 6c77  rsed. Should alw
-00016ef0: 6179 7320 6265 204e 6f6e 652c 2065 7863  ays be None, exc
-00016f00: 6570 7420 666f 7220 7265 6375 7273 6976  ept for recursiv
-00016f10: 6520 696e 766f 6361 7469 6f6e 732e 0a20  e invocations.. 
-00016f20: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
-00016f30: 6764 7366 6163 746f 7279 2e64 6563 6f72  gdsfactory.decor
-00016f40: 6174 6f72 7320 696d 706f 7274 2069 735f  ators import is_
-00016f50: 696e 7661 6c69 645f 7265 660a 0a20 2020  invalid_ref..   
-00016f60: 2069 6e76 616c 6964 5f72 6566 7320 3d20   invalid_refs = 
-00016f70: 5b5d 0a20 2020 2072 6566 7320 3d20 636f  [].    refs = co
-00016f80: 6d70 6f6e 656e 742e 7265 6665 7265 6e63  mponent.referenc
-00016f90: 6573 0a20 2020 2073 7562 6365 6c6c 5f6d  es.    subcell_m
-00016fa0: 6f64 6966 6965 6420 3d20 4661 6c73 650a  odified = False.
-00016fb0: 2020 2020 6966 2075 7064 6174 6564 5f63      if updated_c
-00016fc0: 6f6d 706f 6e65 6e74 7320 6973 204e 6f6e  omponents is Non
-00016fd0: 653a 0a20 2020 2020 2020 2075 7064 6174  e:.        updat
-00016fe0: 6564 5f63 6f6d 706f 6e65 6e74 7320 3d20  ed_components = 
-00016ff0: 7b7d 0a20 2020 2069 6620 7472 6176 6572  {}.    if traver
-00017000: 7365 645f 636f 6d70 6f6e 656e 7473 2069  sed_components i
-00017010: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00017020: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
-00017030: 656e 7473 203d 2073 6574 2829 0a20 2020  ents = set().   
-00017040: 2066 6f72 2072 6566 2069 6e20 7265 6673   for ref in refs
-00017050: 3a0a 2020 2020 2020 2020 2320 6d61 726b  :.        # mark
-00017060: 2061 6e79 2069 6e76 616c 6964 2072 6566   any invalid ref
-00017070: 7320 666f 7220 666c 6174 7465 6e69 6e67  s for flattening
-00017080: 0a20 2020 2020 2020 2023 206f 7468 6572  .        # other
-00017090: 7769 7365 2c20 6368 6563 6b20 6966 2074  wise, check if t
-000170a0: 6865 7265 2061 7265 2061 6e79 206d 6f64  here are any mod
-000170b0: 6966 6965 6420 6365 6c6c 7320 6265 6e65  ified cells bene
-000170c0: 6174 6820 2877 6520 6e65 6564 206e 6f74  ath (we need not
-000170d0: 2064 6f20 7468 6973 2069 6620 7468 6520   do this if the 
-000170e0: 7265 6620 7769 6c6c 2062 6520 666c 6174  ref will be flat
-000170f0: 7465 6e65 6420 616e 7977 6179 7329 0a20  tened anyways). 
-00017100: 2020 2020 2020 2069 6620 6973 5f69 6e76         if is_inv
-00017110: 616c 6964 5f72 6566 2872 6566 2c20 6772  alid_ref(ref, gr
-00017120: 6964 5f73 697a 6529 3a0a 2020 2020 2020  id_size):.      
-00017130: 2020 2020 2020 696e 7661 6c69 645f 7265        invalid_re
-00017140: 6673 2e61 7070 656e 6428 7265 662e 6e61  fs.append(ref.na
-00017150: 6d65 290a 2020 2020 2020 2020 656c 7365  me).        else
-00017160: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00017170: 6f74 6865 7277 6973 652c 2072 6563 7572  otherwise, recur
-00017180: 7369 7665 6c79 2066 6c61 7474 656e 2072  sively flatten r
-00017190: 6566 7320 6966 2074 6865 2073 7562 6365  efs if the subce
-000171a0: 6c6c 2068 6173 206e 6f74 2061 6c72 6561  ll has not alrea
-000171b0: 6479 2062 6565 6e20 7472 6176 6572 7365  dy been traverse
-000171c0: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
-000171d0: 2072 6566 2e70 6172 656e 742e 6e61 6d65   ref.parent.name
-000171e0: 206e 6f74 2069 6e20 7472 6176 6572 7365   not in traverse
-000171f0: 645f 636f 6d70 6f6e 656e 7473 3a0a 2020  d_components:.  
-00017200: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00017210: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
-00017220: 6673 5f72 6563 7572 7369 7665 280a 2020  fs_recursive(.  
-00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017240: 2020 7265 662e 7061 7265 6e74 2c0a 2020    ref.parent,.  
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 2020 6772 6964 5f73 697a 653d 6772 6964    grid_size=grid
-00017270: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
-00017280: 2020 2020 2020 2020 2020 2075 7064 6174             updat
-00017290: 6564 5f63 6f6d 706f 6e65 6e74 733d 7570  ed_components=up
-000172a0: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
-000172b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000172c0: 2020 2020 2020 7472 6176 6572 7365 645f        traversed_
-000172d0: 636f 6d70 6f6e 656e 7473 3d74 7261 7665  components=trave
-000172e0: 7273 6564 5f63 6f6d 706f 6e65 6e74 732c  rsed_components,
-000172f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017300: 2029 0a20 2020 2020 2020 2020 2020 2023   ).            #
-00017310: 206e 6f77 2c20 6966 2074 6865 2072 6566   now, if the ref
-00017320: 2773 2063 656c 6c20 6265 656e 206d 6f64  's cell been mod
-00017330: 6966 6965 642c 206d 6172 6b20 6974 2061  ified, mark it a
-00017340: 7320 7375 6368 0a20 2020 2020 2020 2020  s such.         
-00017350: 2020 2069 6620 7265 662e 7061 7265 6e74     if ref.parent
-00017360: 2e6e 616d 6520 696e 2075 7064 6174 6564  .name in updated
-00017370: 5f63 6f6d 706f 6e65 6e74 733a 0a20 2020  _components:.   
-00017380: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-00017390: 6365 6c6c 5f6d 6f64 6966 6965 6420 3d20  cell_modified = 
-000173a0: 5472 7565 0a20 2020 2069 6620 696e 7661  True.    if inva
-000173b0: 6c69 645f 7265 6673 206f 7220 7375 6263  lid_refs or subc
-000173c0: 656c 6c5f 6d6f 6469 6669 6564 3a0a 2020  ell_modified:.  
-000173d0: 2020 2020 2020 6e65 775f 636f 6d70 6f6e        new_compon
-000173e0: 656e 7420 3d20 636f 6d70 6f6e 656e 742e  ent = component.
-000173f0: 636f 7079 2829 0a20 2020 2020 2020 206e  copy().        n
-00017400: 6577 5f63 6f6d 706f 6e65 6e74 2e6e 616d  ew_component.nam
-00017410: 6520 3d20 636f 6d70 6f6e 656e 742e 6e61  e = component.na
-00017420: 6d65 0a20 2020 2020 2020 2023 206d 616b  me.        # mak
-00017430: 6520 7375 7265 2061 6c6c 206d 6f64 6966  e sure all modif
-00017440: 6965 6420 6365 6c6c 7320 6861 7665 2074  ied cells have t
-00017450: 6865 6972 2072 6566 6572 656e 6365 7320  heir references 
-00017460: 7570 6461 7465 640a 2020 2020 2020 2020  updated.        
-00017470: 6e65 775f 7265 6673 203d 206e 6577 5f63  new_refs = new_c
-00017480: 6f6d 706f 6e65 6e74 2e72 6566 6572 656e  omponent.referen
-00017490: 6365 732e 636f 7079 2829 0a20 2020 2020  ces.copy().     
-000174a0: 2020 2066 6f72 2072 6566 2069 6e20 6e65     for ref in ne
-000174b0: 775f 7265 6673 3a0a 2020 2020 2020 2020  w_refs:.        
-000174c0: 2020 2020 6966 2072 6566 2e6e 616d 6520      if ref.name 
-000174d0: 696e 2069 6e76 616c 6964 5f72 6566 733a  in invalid_refs:
-000174e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000174f0: 206e 6577 5f63 6f6d 706f 6e65 6e74 2e66   new_component.f
-00017500: 6c61 7474 656e 5f72 6566 6572 656e 6365  latten_reference
-00017510: 2872 6566 290a 2020 2020 2020 2020 2020  (ref).          
-00017520: 2020 656c 6966 2028 0a20 2020 2020 2020    elif (.       
-00017530: 2020 2020 2020 2020 2072 6566 2e70 6172           ref.par
-00017540: 656e 742e 6e61 6d65 2069 6e20 7570 6461  ent.name in upda
-00017550: 7465 645f 636f 6d70 6f6e 656e 7473 0a20  ted_components. 
-00017560: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00017570: 6e64 2072 6566 2e70 6172 656e 7420 6973  nd ref.parent is
-00017580: 206e 6f74 2075 7064 6174 6564 5f63 6f6d   not updated_com
-00017590: 706f 6e65 6e74 735b 7265 662e 7061 7265  ponents[ref.pare
-000175a0: 6e74 2e6e 616d 655d 0a20 2020 2020 2020  nt.name].       
-000175b0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-000175c0: 2020 2020 2020 2020 7265 662e 7061 7265          ref.pare
-000175d0: 6e74 203d 2075 7064 6174 6564 5f63 6f6d  nt = updated_com
-000175e0: 706f 6e65 6e74 735b 7265 662e 7061 7265  ponents[ref.pare
-000175f0: 6e74 2e6e 616d 655d 0a20 2020 2020 2020  nt.name].       
-00017600: 2063 6f6d 706f 6e65 6e74 203d 206e 6577   component = new
-00017610: 5f63 6f6d 706f 6e65 6e74 0a20 2020 2020  _component.     
-00017620: 2020 2075 7064 6174 6564 5f63 6f6d 706f     updated_compo
-00017630: 6e65 6e74 735b 636f 6d70 6f6e 656e 742e  nents[component.
-00017640: 6e61 6d65 5d20 3d20 6e65 775f 636f 6d70  name] = new_comp
-00017650: 6f6e 656e 740a 2020 2020 7472 6176 6572  onent.    traver
-00017660: 7365 645f 636f 6d70 6f6e 656e 7473 2e61  sed_components.a
-00017670: 6464 2863 6f6d 706f 6e65 6e74 2e6e 616d  dd(component.nam
-00017680: 6529 0a20 2020 2072 6574 7572 6e20 636f  e).    return co
-00017690: 6d70 6f6e 656e 740a 0a0a 6465 6620 5f63  mponent...def _c
-000176a0: 6865 636b 5f75 6e63 6163 6865 645f 636f  heck_uncached_co
-000176b0: 6d70 6f6e 656e 7473 2863 6f6d 706f 6e65  mponents(compone
-000176c0: 6e74 2c20 6d6f 6465 293a 0a20 2020 2076  nt, mode):.    v
-000176d0: 616c 6964 5f6d 6f64 6573 203d 205b 2277  alid_modes = ["w
-000176e0: 6172 6e22 2c20 2265 7272 6f72 222c 2022  arn", "error", "
-000176f0: 6967 6e6f 7265 225d 0a0a 2020 2020 6966  ignore"]..    if
-00017700: 206d 6f64 6520 3d3d 2022 6967 6e6f 7265   mode == "ignore
-00017710: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
-00017720: 6e0a 2020 2020 656c 6966 206d 6f64 6520  n.    elif mode 
-00017730: 6e6f 7420 696e 2076 616c 6964 5f6d 6f64  not in valid_mod
-00017740: 6573 3a0a 2020 2020 2020 2020 7261 6973  es:.        rais
-00017750: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-00017760: 2020 2020 2020 2020 2020 6622 7b6d 6f64            f"{mod
-00017770: 657d 2069 7320 6e6f 7420 6120 7661 6c69  e} is not a vali
-00017780: 6420 7661 6c75 6520 666f 7220 6f6e 5f75  d value for on_u
-00017790: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
-000177a0: 742e 2054 7279 206f 6e65 206f 6620 7468  t. Try one of th
-000177b0: 6573 653a 207b 7661 6c69 645f 6d6f 6465  ese: {valid_mode
-000177c0: 737d 2e22 0a20 2020 2020 2020 2029 0a0a  s}.".        )..
-000177d0: 2020 2020 666f 7220 7375 625f 636f 6d70      for sub_comp
-000177e0: 6f6e 656e 7420 696e 2063 6f6d 706f 6e65  onent in compone
-000177f0: 6e74 2e67 6574 5f64 6570 656e 6465 6e63  nt.get_dependenc
-00017800: 6965 7328 7265 6375 7273 6976 653d 5472  ies(recursive=Tr
-00017810: 7565 293a 0a20 2020 2020 2020 2069 6620  ue):.        if 
-00017820: 6e6f 7420 7375 625f 636f 6d70 6f6e 656e  not sub_componen
-00017830: 742e 5f6c 6f63 6b65 643a 0a20 2020 2020  t._locked:.     
-00017840: 2020 2020 2020 206d 6573 7361 6765 203d         message =
-00017850: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00017860: 2020 2066 2243 6f6d 706f 6e65 6e74 207b     f"Component {
-00017870: 7375 625f 636f 6d70 6f6e 656e 742e 6e61  sub_component.na
-00017880: 6d65 2172 7d20 7761 7320 4e4f 5420 7072  me!r} was NOT pr
-00017890: 6f70 6572 6c79 206c 6f63 6b65 642e 2022  operly locked. "
-000178a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000178b0: 2022 596f 7520 6e65 6564 2074 6f20 7772   "You need to wr
-000178c0: 6974 6520 6974 2069 6e74 6f20 6120 6675  ite it into a fu
-000178d0: 6e63 7469 6f6e 2074 6861 7420 6861 7320  nction that has 
-000178e0: 7468 6520 4063 656c 6c20 6465 636f 7261  the @cell decora
-000178f0: 746f 722e 220a 2020 2020 2020 2020 2020  tor.".          
-00017900: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00017910: 6966 206d 6f64 6520 3d3d 2022 7761 726e  if mode == "warn
-00017920: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00017930: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-00017940: 286d 6573 7361 6765 2c20 556e 6361 6368  (message, Uncach
-00017950: 6564 436f 6d70 6f6e 656e 7457 6172 6e69  edComponentWarni
-00017960: 6e67 2c20 7374 6163 6b6c 6576 656c 3d33  ng, stacklevel=3
-00017970: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00017980: 6c69 6620 6d6f 6465 203d 3d20 2265 7272  lif mode == "err
-00017990: 6f72 223a 0a20 2020 2020 2020 2020 2020  or":.           
-000179a0: 2020 2020 2072 6169 7365 2055 6e63 6163       raise Uncac
-000179b0: 6865 6443 6f6d 706f 6e65 6e74 4572 726f  hedComponentErro
-000179c0: 7228 6d65 7373 6167 6529 0a0a 0a64 6566  r(message)...def
-000179d0: 2074 6573 745f 7361 6d65 5f75 6964 2829   test_same_uid()
-000179e0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
-000179f0: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
-00017a00: 6173 2067 660a 0a20 2020 2063 203d 2043  as gf..    c = C
-00017a10: 6f6d 706f 6e65 6e74 2829 0a20 2020 2063  omponent().    c
-00017a20: 203c 3c20 6766 2e63 6f6d 706f 6e65 6e74   << gf.component
-00017a30: 732e 7265 6374 616e 676c 6528 290a 2020  s.rectangle().  
-00017a40: 2020 6320 3c3c 2067 662e 636f 6d70 6f6e    c << gf.compon
-00017a50: 656e 7473 2e72 6563 7461 6e67 6c65 2829  ents.rectangle()
-00017a60: 0a0a 2020 2020 7231 203d 2063 2e72 6566  ..    r1 = c.ref
-00017a70: 6572 656e 6365 735b 305d 2e70 6172 656e  erences[0].paren
-00017a80: 740a 2020 2020 7232 203d 2063 2e72 6566  t.    r2 = c.ref
-00017a90: 6572 656e 6365 735b 315d 2e70 6172 656e  erences[1].paren
-00017aa0: 740a 0a20 2020 2061 7373 6572 7420 7231  t..    assert r1
-00017ab0: 2e75 6964 203d 3d20 7232 2e75 6964 2c20  .uid == r2.uid, 
-00017ac0: 6622 7b72 312e 7569 647d 206d 7573 7420  f"{r1.uid} must 
-00017ad0: 6571 7561 6c20 7b72 322e 7569 647d 220a  equal {r2.uid}".
-00017ae0: 0a0a 6465 6620 7465 7374 5f6e 6574 6c69  ..def test_netli
-00017af0: 7374 5f73 696d 706c 6528 2920 2d3e 204e  st_simple() -> N
-00017b00: 6f6e 653a 0a20 2020 2069 6d70 6f72 7420  one:.    import 
-00017b10: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
-00017b20: 0a0a 2020 2020 6320 3d20 6766 2e43 6f6d  ..    c = gf.Com
-00017b30: 706f 6e65 6e74 2829 0a20 2020 2063 3120  ponent().    c1 
-00017b40: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
-00017b50: 656e 7473 2e73 7472 6169 6768 7428 6c65  ents.straight(le
-00017b60: 6e67 7468 3d31 2c20 7769 6474 683d 3229  ngth=1, width=2)
-00017b70: 0a20 2020 2063 3220 3d20 6320 3c3c 2067  .    c2 = c << g
-00017b80: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
-00017b90: 6169 6768 7428 6c65 6e67 7468 3d32 2c20  aight(length=2, 
-00017ba0: 7769 6474 683d 3229 0a20 2020 2063 322e  width=2).    c2.
-00017bb0: 636f 6e6e 6563 7428 706f 7274 3d22 6f31  connect(port="o1
-00017bc0: 222c 2064 6573 7469 6e61 7469 6f6e 3d63  ", destination=c
-00017bd0: 312e 706f 7274 735b 226f 3222 5d29 0a20  1.ports["o2"]). 
-00017be0: 2020 2063 2e61 6464 5f70 6f72 7428 226f     c.add_port("o
-00017bf0: 3122 2c20 706f 7274 3d63 312e 706f 7274  1", port=c1.port
-00017c00: 735b 226f 3122 5d29 0a20 2020 2063 2e61  s["o1"]).    c.a
-00017c10: 6464 5f70 6f72 7428 226f 3222 2c20 706f  dd_port("o2", po
-00017c20: 7274 3d63 322e 706f 7274 735b 226f 3222  rt=c2.ports["o2"
-00017c30: 5d29 0a20 2020 206e 6574 6c69 7374 203d  ]).    netlist =
-00017c40: 2063 2e67 6574 5f6e 6574 6c69 7374 2829   c.get_netlist()
-00017c50: 0a20 2020 2023 2070 7269 6e74 286e 6574  .    # print(net
-00017c60: 6c69 7374 2e70 7265 7474 7928 2929 0a20  list.pretty()). 
-00017c70: 2020 2061 7373 6572 7420 6c65 6e28 6e65     assert len(ne
-00017c80: 746c 6973 745b 2269 6e73 7461 6e63 6573  tlist["instances
-00017c90: 225d 2920 3d3d 2032 0a0a 0a64 6566 2074  "]) == 2...def t
-00017ca0: 6573 745f 6e65 746c 6973 745f 7369 6d70  est_netlist_simp
-00017cb0: 6c65 5f77 6964 7468 5f6d 6973 6d61 7463  le_width_mismatc
-00017cc0: 685f 7468 726f 7773 5f65 7272 6f72 2829  h_throws_error()
-00017cd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
-00017ce0: 706f 7274 2070 7974 6573 740a 0a20 2020  port pytest..   
-00017cf0: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
-00017d00: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
-00017d10: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
-00017d20: 0a20 2020 2063 3120 3d20 6320 3c3c 2067  .    c1 = c << g
-00017d30: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
-00017d40: 6169 6768 7428 6c65 6e67 7468 3d31 2c20  aight(length=1, 
-00017d50: 7769 6474 683d 3129 0a20 2020 2063 3220  width=1).    c2 
-00017d60: 3d20 6320 3c3c 2067 662e 636f 6d70 6f6e  = c << gf.compon
-00017d70: 656e 7473 2e73 7472 6169 6768 7428 6c65  ents.straight(le
-00017d80: 6e67 7468 3d32 2c20 7769 6474 683d 3229  ngth=2, width=2)
-00017d90: 0a20 2020 2063 322e 636f 6e6e 6563 7428  .    c2.connect(
-00017da0: 706f 7274 3d22 6f31 222c 2064 6573 7469  port="o1", desti
-00017db0: 6e61 7469 6f6e 3d63 312e 706f 7274 735b  nation=c1.ports[
-00017dc0: 226f 3222 5d29 0a20 2020 2063 2e61 6464  "o2"]).    c.add
-00017dd0: 5f70 6f72 7428 226f 3122 2c20 706f 7274  _port("o1", port
-00017de0: 3d63 312e 706f 7274 735b 226f 3122 5d29  =c1.ports["o1"])
-00017df0: 0a20 2020 2063 2e61 6464 5f70 6f72 7428  .    c.add_port(
-00017e00: 226f 3222 2c20 706f 7274 3d63 322e 706f  "o2", port=c2.po
-00017e10: 7274 735b 226f 3222 5d29 0a20 2020 2077  rts["o2"]).    w
-00017e20: 6974 6820 7079 7465 7374 2e72 6169 7365  ith pytest.raise
-00017e30: 7328 5661 6c75 6545 7272 6f72 293a 0a20  s(ValueError):. 
-00017e40: 2020 2020 2020 2063 2e67 6574 5f6e 6574         c.get_net
-00017e50: 6c69 7374 2829 0a0a 0a64 6566 2074 6573  list()...def tes
-00017e60: 745f 6e65 746c 6973 745f 636f 6d70 6c65  t_netlist_comple
-00017e70: 7828 2920 2d3e 204e 6f6e 653a 0a20 2020  x() -> None:.   
-00017e80: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
-00017e90: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
-00017ea0: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
-00017eb0: 6d7a 695f 6172 6d73 2829 0a20 2020 206e  mzi_arms().    n
-00017ec0: 6574 6c69 7374 203d 2063 2e67 6574 5f6e  etlist = c.get_n
-00017ed0: 6574 6c69 7374 2829 0a20 2020 2023 2070  etlist().    # p
-00017ee0: 7269 6e74 286e 6574 6c69 7374 2e70 7265  rint(netlist.pre
-00017ef0: 7474 7928 2929 0a20 2020 2061 7373 6572  tty()).    asser
-00017f00: 7420 6c65 6e28 6e65 746c 6973 745b 2269  t len(netlist["i
-00017f10: 6e73 7461 6e63 6573 225d 2920 3d3d 2034  nstances"]) == 4
-00017f20: 2c20 6c65 6e28 6e65 746c 6973 745b 2269  , len(netlist["i
-00017f30: 6e73 7461 6e63 6573 225d 290a 0a0a 6465  nstances"])...de
-00017f40: 6620 7465 7374 5f65 7874 7261 6374 2829  f test_extract()
-00017f50: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
-00017f60: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
-00017f70: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
-00017f80: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
-00017f90: 732e 7374 7261 6967 6874 280a 2020 2020  s.straight(.    
-00017fa0: 2020 2020 6c65 6e67 7468 3d31 302c 0a20      length=10,. 
-00017fb0: 2020 2020 2020 2077 6964 7468 3d30 2e35         width=0.5
-00017fc0: 2c0a 2020 2020 2020 2020 6262 6f78 5f6c  ,.        bbox_l
-00017fd0: 6179 6572 733d 5b67 662e 4c41 5945 522e  ayers=[gf.LAYER.
-00017fe0: 5747 434c 4144 5d2c 0a20 2020 2020 2020  WGCLAD],.       
-00017ff0: 2062 626f 785f 6f66 6673 6574 733d 5b33   bbox_offsets=[3
-00018000: 5d2c 0a20 2020 2020 2020 2077 6974 685f  ],.        with_
-00018010: 6262 6f78 3d54 7275 652c 0a20 2020 2020  bbox=True,.     
-00018020: 2020 2063 6c61 6464 696e 675f 6c61 7965     cladding_laye
-00018030: 7273 3d4e 6f6e 652c 0a20 2020 2020 2020  rs=None,.       
-00018040: 2061 6464 5f70 696e 733d 4e6f 6e65 2c0a   add_pins=None,.
-00018050: 2020 2020 2020 2020 6164 645f 6262 6f78          add_bbox
-00018060: 3d4e 6f6e 652c 0a20 2020 2029 0a20 2020  =None,.    ).   
-00018070: 2063 3220 3d20 632e 6578 7472 6163 7428   c2 = c.extract(
-00018080: 6c61 7965 7273 3d5b 6766 2e4c 4159 4552  layers=[gf.LAYER
-00018090: 2e57 4743 4c41 445d 290a 0a20 2020 2061  .WGCLAD])..    a
-000180a0: 7373 6572 7420 6c65 6e28 632e 706f 6c79  ssert len(c.poly
-000180b0: 676f 6e73 2920 3d3d 2032 2c20 6c65 6e28  gons) == 2, len(
-000180c0: 632e 706f 6c79 676f 6e73 290a 2020 2020  c.polygons).    
-000180d0: 6173 7365 7274 206c 656e 2863 322e 706f  assert len(c2.po
-000180e0: 6c79 676f 6e73 2920 3d3d 2031 2c20 6c65  lygons) == 1, le
-000180f0: 6e28 6332 2e70 6f6c 7967 6f6e 7329 0a20  n(c2.polygons). 
-00018100: 2020 2061 7373 6572 7420 6766 2e4c 4159     assert gf.LAY
-00018110: 4552 2e57 4743 4c41 4420 696e 2063 322e  ER.WGCLAD in c2.
-00018120: 6c61 7965 7273 0a20 2020 2072 6574 7572  layers.    retur
-00018130: 6e20 6332 0a0a 0a64 6566 2068 6173 685f  n c2...def hash_
-00018140: 6669 6c65 2866 696c 6570 6174 6829 3a0a  file(filepath):.
-00018150: 2020 2020 6d64 3520 3d20 6861 7368 6c69      md5 = hashli
-00018160: 622e 6d64 3528 290a 2020 2020 6d64 352e  b.md5().    md5.
-00018170: 7570 6461 7465 2866 696c 6570 6174 682e  update(filepath.
-00018180: 7265 6164 5f62 7974 6573 2829 290a 2020  read_bytes()).  
-00018190: 2020 7265 7475 726e 206d 6435 2e68 6578    return md5.hex
-000181a0: 6469 6765 7374 2829 0a0a 0a64 6566 2074  digest()...def t
-000181b0: 6573 745f 6262 6f78 5f72 6566 6572 656e  est_bbox_referen
-000181c0: 6365 2829 202d 3e20 436f 6d70 6f6e 656e  ce() -> Componen
-000181d0: 743a 0a20 2020 2069 6d70 6f72 7420 6764  t:.    import gd
-000181e0: 7366 6163 746f 7279 2061 7320 6766 0a0a  sfactory as gf..
-000181f0: 2020 2020 6320 3d20 6766 2e43 6f6d 706f      c = gf.Compo
-00018200: 6e65 6e74 2822 636f 6d70 6f6e 656e 745f  nent("component_
-00018210: 7769 7468 5f6f 6666 6772 6964 5f70 6f6c  with_offgrid_pol
-00018220: 7967 6f6e 7322 290a 2020 2020 6331 203d  ygons").    c1 =
-00018230: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
-00018240: 6e74 732e 7265 6374 616e 676c 6528 7369  nts.rectangle(si
-00018250: 7a65 3d28 312e 3565 2d33 2c20 312e 3565  ze=(1.5e-3, 1.5e
-00018260: 2d33 292c 2070 6f72 745f 7479 7065 3d4e  -3), port_type=N
-00018270: 6f6e 6529 0a20 2020 2063 3220 3d20 6320  one).    c2 = c 
-00018280: 3c3c 2067 662e 636f 6d70 6f6e 656e 7473  << gf.components
-00018290: 2e72 6563 7461 6e67 6c65 2873 697a 653d  .rectangle(size=
-000182a0: 2831 2e35 652d 332c 2031 2e35 652d 3329  (1.5e-3, 1.5e-3)
-000182b0: 2c20 706f 7274 5f74 7970 653d 4e6f 6e65  , port_type=None
-000182c0: 290a 2020 2020 6332 2e78 6d69 6e20 3d20  ).    c2.xmin = 
-000182d0: 6331 2e78 6d61 780a 0a20 2020 2061 7373  c1.xmax..    ass
-000182e0: 6572 7420 6332 2e78 7369 7a65 203d 3d20  ert c2.xsize == 
-000182f0: 3265 2d33 0a20 2020 2072 6574 7572 6e20  2e-3.    return 
-00018300: 6332 0a0a 0a64 6566 2074 6573 745f 6262  c2...def test_bb
-00018310: 6f78 5f63 6f6d 706f 6e65 6e74 2829 202d  ox_component() -
-00018320: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
-00018330: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-00018340: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
-00018350: 636f 6d70 6f6e 656e 7473 2e72 6563 7461  components.recta
-00018360: 6e67 6c65 2873 697a 653d 2831 2e35 652d  ngle(size=(1.5e-
-00018370: 332c 2031 2e35 652d 3329 2c20 706f 7274  3, 1.5e-3), port
-00018380: 5f74 7970 653d 4e6f 6e65 290a 2020 2020  _type=None).    
-00018390: 6173 7365 7274 2063 2e78 7369 7a65 203d  assert c.xsize =
-000183a0: 3d20 3265 2d33 0a0a 0a64 6566 2074 6573  = 2e-3...def tes
-000183b0: 745f 7265 6d61 705f 6c61 7965 7273 2829  t_remap_layers()
-000183c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
-000183d0: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
-000183e0: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
-000183f0: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
-00018400: 6169 6768 7428 6c61 7965 723d 2832 2c20  aight(layer=(2, 
-00018410: 3029 290a 2020 2020 7265 6d61 7020 3d20  0)).    remap = 
-00018420: 632e 7265 6d61 705f 6c61 7965 7273 286c  c.remap_layers(l
-00018430: 6179 6572 6d61 703d 7b28 322c 2030 293a  ayermap={(2, 0):
-00018440: 2067 662e 4c41 5945 522e 5747 4e7d 290a   gf.LAYER.WGN}).
-00018450: 2020 2020 6861 7368 5f67 656f 6d65 7472      hash_geometr
-00018460: 7920 3d20 2233 3263 6431 3465 6137 6365  y = "32cd14ea7ce
-00018470: 3133 6366 3166 3433 3032 3737 6234 3530  13cf1f430277b450
-00018480: 3534 6130 6137 3930 3961 3363 3422 0a0a  54a0a7909a3c4"..
-00018490: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
-000184a0: 2020 2020 2072 656d 6170 2e68 6173 685f       remap.hash_
-000184b0: 6765 6f6d 6574 7279 2829 203d 3d20 6861  geometry() == ha
-000184c0: 7368 5f67 656f 6d65 7472 790a 2020 2020  sh_geometry.    
-000184d0: 292c 2066 2268 6173 685f 6765 6f6d 6574  ), f"hash_geomet
-000184e0: 7279 203d 207b 7265 6d61 702e 6861 7368  ry = {remap.hash
-000184f0: 5f67 656f 6d65 7472 7928 2921 727d 220a  _geometry()!r}".
-00018500: 0a0a 6465 6620 7465 7374 5f72 656d 6f76  ..def test_remov
-00018510: 655f 6c61 6265 6c73 2829 202d 3e20 4e6f  e_labels() -> No
-00018520: 6e65 3a0a 2020 2020 696d 706f 7274 2067  ne:.    import g
-00018530: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-00018540: 0a20 2020 2063 203d 2067 662e 632e 7374  .    c = gf.c.st
-00018550: 7261 6967 6874 2829 0a20 2020 2063 2e72  raight().    c.r
-00018560: 656d 6f76 655f 6c61 6265 6c73 2829 0a0a  emove_labels()..
-00018570: 2020 2020 6173 7365 7274 206c 656e 2863      assert len(c
-00018580: 2e6c 6162 656c 7329 203d 3d20 300a 0a0a  .labels) == 0...
-00018590: 6465 6620 7465 7374 5f69 6d70 6f72 745f  def test_import_
-000185a0: 6764 735f 7365 7474 696e 6773 2829 202d  gds_settings() -
-000185b0: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
-000185c0: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-000185d0: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
-000185e0: 636f 6d70 6f6e 656e 7473 2e6d 7a69 2829  components.mzi()
-000185f0: 0a20 2020 2067 6473 7061 7468 203d 2063  .    gdspath = c
-00018600: 2e77 7269 7465 5f67 6473 5f77 6974 685f  .write_gds_with_
-00018610: 6d65 7461 6461 7461 2829 0a20 2020 2063  metadata().    c
-00018620: 3220 3d20 6766 2e69 6d70 6f72 745f 6764  2 = gf.import_gd
-00018630: 7328 6764 7370 6174 682c 206e 616d 653d  s(gdspath, name=
-00018640: 226d 7a69 5f73 616d 706c 6522 2c20 7265  "mzi_sample", re
-00018650: 6164 5f6d 6574 6164 6174 613d 5472 7565  ad_metadata=True
-00018660: 290a 2020 2020 6333 203d 2067 662e 726f  ).    c3 = gf.ro
-00018670: 7574 696e 672e 6164 645f 6669 6265 725f  uting.add_fiber_
-00018680: 7369 6e67 6c65 2863 3229 0a20 2020 2061  single(c2).    a
-00018690: 7373 6572 7420 6333 0a0a 0a69 6620 5f5f  ssert c3...if __
-000186a0: 6e61 6d65 5f5f 203d 3d20 225f 5f6d 6169  name__ == "__mai
-000186b0: 6e5f 5f22 3a0a 2020 2020 2320 696d 706f  n__":.    # impo
-000186c0: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-000186d0: 2067 660a 0a20 2020 2074 6573 745f 7265   gf..    test_re
-000186e0: 6d61 705f 6c61 7965 7273 2829 0a20 2020  map_layers().   
-000186f0: 2023 2063 203d 2067 662e 436f 6d70 6f6e   # c = gf.Compon
-00018700: 656e 7428 290a 2020 2020 2320 7020 3d20  ent().    # p = 
-00018710: 632e 6164 645f 706f 6c79 676f 6e28 0a20  c.add_polygon(. 
-00018720: 2020 2023 2020 2020 205b 282d 382c 2036     #     [(-8, 6
-00018730: 2c20 372c 2039 292c 2028 2d36 2c20 382c  , 7, 9), (-6, 8,
-00018740: 2031 372c 2035 295d 2c20 6c61 7965 723d   17, 5)], layer=
-00018750: 2831 2c20 3029 0a20 2020 2023 2029 2020  (1, 0).    # )  
-00018760: 2320 4744 5320 6c61 7965 7273 2061 7265  # GDS layers are
-00018770: 2074 7570 6c65 7320 6f66 2069 6e74 7320   tuples of ints 
-00018780: 2862 7574 2069 6620 7765 2075 7365 206f  (but if we use o
-00018790: 6e6c 7920 6f6e 6520 6e75 6d62 6572 2069  nly one number i
-000187a0: 7420 6173 7375 6d65 7320 7468 6520 6f74  t assumes the ot
-000187b0: 6865 7220 6e75 6d62 6572 2069 7320 3029  her number is 0)
-000187c0: 0a0a 2020 2020 2320 6332 203d 2067 662e  ..    # c2 = gf.
-000187d0: 436f 6d70 6f6e 656e 7428 290a 2020 2020  Component().    
-000187e0: 2320 6320 3d20 6766 2e63 6f6d 706f 6e65  # c = gf.compone
-000187f0: 6e74 732e 6d7a 6928 290a 2020 2020 2320  nts.mzi().    # 
-00018800: 7072 696e 7428 632e 6765 745f 6c61 7965  print(c.get_laye
-00018810: 725f 6e61 6d65 7328 2929 0a20 2020 2023  r_names()).    #
-00018820: 2063 203d 2067 662e 636f 6d70 6f6e 656e   c = gf.componen
-00018830: 7473 2e6d 7a69 2829 0a20 2020 2023 2070  ts.mzi().    # p
-00018840: 7269 6e74 2863 2e67 6574 5f6c 6179 6572  rint(c.get_layer
-00018850: 5f6e 616d 6573 2829 290a 2020 2020 2320  _names()).    # 
-00018860: 7220 3d20 632e 7265 6628 290a 2020 2020  r = c.ref().    
-00018870: 2320 6332 2e63 6f70 795f 6368 696c 645f  # c2.copy_child_
-00018880: 696e 666f 2863 2e6e 616d 6564 5f72 6566  info(c.named_ref
-00018890: 6572 656e 6365 735b 2273 7874 225d 290a  erences["sxt"]).
-000188a0: 2020 2020 2320 7465 7374 5f72 656d 6170      # test_remap
-000188b0: 5f6c 6179 6572 7328 290a 2020 2020 2320  _layers().    # 
-000188c0: 6320 3d20 7465 7374 5f67 6574 5f6c 6179  c = test_get_lay
-000188d0: 6572 7328 290a 2020 2020 2320 632e 706c  ers().    # c.pl
-000188e0: 6f74 5f71 7428 290a 2020 2020 2320 632e  ot_qt().    # c.
-000188f0: 706c 6f74 6828 290a 2020 2020 2320 6320  ploth().    # c 
-00018900: 3d20 7465 7374 5f65 7874 7261 6374 2829  = test_extract()
-00018910: 0a20 2020 2023 2067 6473 7061 7468 203d  .    # gdspath =
-00018920: 2063 2e77 7269 7465 5f67 6473 2829 0a20   c.write_gds(). 
-00018930: 2020 2023 2067 662e 7368 6f77 2867 6473     # gf.show(gds
-00018940: 7061 7468 290a 2020 2020 2320 632e 7368  path).    # c.sh
-00018950: 6f77 2873 686f 775f 706f 7274 733d 5472  ow(show_ports=Tr
-00018960: 7565 290a 2020 2020 2320 632e 7368 6f77  ue).    # c.show
-00018970: 2829 0a                                  ().
+0000f1b0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+0000f1c0: 3d63 6f6d 706f 6e65 6e74 2c0a 2020 2020  =component,.    
+0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1e0: 2020 2020 7265 6665 7265 6e63 653d 7265      reference=re
+0000f1f0: 6665 7265 6e63 652c 0a20 2020 2020 2020  ference,.       
+0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f210: 206c 6179 6572 3d70 6f72 745f 6d61 726b   layer=port_mark
+0000f220: 6572 5f6c 6179 6572 2c0a 2020 2020 2020  er_layer,.      
+0000f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f240: 2020 6c61 7965 725f 6c61 6265 6c3d 706f    layer_label=po
+0000f250: 7274 5f6d 6172 6b65 725f 6c61 7965 722c  rt_marker_layer,
+0000f260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f270: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000f280: 7368 6f77 2863 6f6d 706f 6e65 6e74 2c20  show(component, 
+0000f290: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
+0000f2a0: 6566 205f 7772 6974 655f 6c69 6272 6172  ef _write_librar
+0000f2b0: 7928 0a20 2020 2020 2020 2073 656c 662c  y(.        self,
+0000f2c0: 0a20 2020 2020 2020 2067 6473 7061 7468  .        gdspath
+0000f2d0: 3a20 5061 7468 5479 7065 207c 204e 6f6e  : PathType | Non
+0000f2e0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+0000f2f0: 2020 6764 7364 6972 3a20 5061 7468 5479    gdsdir: PathTy
+0000f300: 7065 207c 204e 6f6e 6520 3d20 4e6f 6e65  pe | None = None
+0000f310: 2c0a 2020 2020 2020 2020 7469 6d65 7374  ,.        timest
+0000f320: 616d 703a 2064 6174 6574 696d 652e 6461  amp: datetime.da
+0000f330: 7465 7469 6d65 207c 204e 6f6e 6520 3d20  tetime | None = 
+0000f340: 5f74 696d 6573 7461 6d70 3230 3139 2c0a  _timestamp2019,.
+0000f350: 2020 2020 2020 2020 6c6f 6767 696e 673a          logging:
+0000f360: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+0000f370: 2020 2020 2020 7769 7468 5f6f 6173 6973        with_oasis
+0000f380: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0000f390: 2020 2020 2020 2020 7769 7468 5f6d 6574          with_met
+0000f3a0: 6164 6174 613a 2062 6f6f 6c20 3d20 4661  adata: bool = Fa
+0000f3b0: 6c73 652c 0a20 2020 2020 2020 202a 2a6b  lse,.        **k
+0000f3c0: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
+0000f3d0: 5061 7468 3a0a 2020 2020 2020 2020 2222  Path:.        ""
+0000f3e0: 2257 7269 7465 2063 6f6d 706f 6e65 6e74  "Write component
+0000f3f0: 2074 6f20 4744 5320 6f72 204f 4153 4953   to GDS or OASIS
+0000f400: 2061 6e64 2072 6574 7572 6e73 2067 6473   and returns gds
+0000f410: 7061 7468 2e0a 0a20 2020 2020 2020 2041  path...        A
+0000f420: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0000f430: 2067 6473 7061 7468 3a20 4744 5320 6669   gdspath: GDS fi
+0000f440: 6c65 2070 6174 6820 746f 2077 7269 7465  le path to write
+0000f450: 2074 6f2e 0a20 2020 2020 2020 2020 2020   to..           
+0000f460: 2067 6473 6469 723a 2064 6972 6563 746f   gdsdir: directo
+0000f470: 7279 2066 6f72 2074 6865 2047 4453 2066  ry for the GDS f
+0000f480: 696c 652e 2044 6566 6175 6c74 7320 746f  ile. Defaults to
+0000f490: 202f 746d 702f 7261 6e64 6f6d 4669 6c65   /tmp/randomFile
+0000f4a0: 2f67 6473 6661 6374 6f72 792e 0a20 2020  /gdsfactory..   
+0000f4b0: 2020 2020 2020 2020 2074 696d 6573 7461           timesta
+0000f4c0: 6d70 3a20 4465 6661 756c 7473 2074 6f20  mp: Defaults to 
+0000f4d0: 3230 3139 2d31 302d 3235 2066 6f72 2063  2019-10-25 for c
+0000f4e0: 6f6e 7369 7374 656e 7420 6861 7368 2e0a  onsistent hash..
+0000f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f500: 4966 204e 6f6e 6520 7573 6573 2063 7572  If None uses cur
+0000f510: 7265 6e74 2074 696d 652e 0a20 2020 2020  rent time..     
+0000f520: 2020 2020 2020 206c 6f67 6769 6e67 3a20         logging: 
+0000f530: 6469 7361 626c 6520 4744 5320 7061 7468  disable GDS path
+0000f540: 206c 6f67 6769 6e67 2c20 666f 7220 6578   logging, for ex
+0000f550: 616d 706c 6520 666f 7220 7368 6f77 696e  ample for showin
+0000f560: 6720 6974 2069 6e20 4b4c 6179 6f75 742e  g it in KLayout.
+0000f570: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0000f580: 685f 6f61 7369 733a 2049 6620 5472 7565  h_oasis: If True
+0000f590: 2c20 6669 6c65 2077 696c 6c20 6265 2077  , file will be w
+0000f5a0: 7269 7474 656e 2074 6f20 4f41 5349 532e  ritten to OASIS.
+0000f5b0: 204f 7468 6572 7769 7365 2c20 6669 6c65   Otherwise, file
+0000f5c0: 2077 696c 6c20 6265 2077 7269 7474 656e   will be written
+0000f5d0: 2074 6f20 4744 532e 0a20 2020 2020 2020   to GDS..       
+0000f5e0: 2020 2020 2077 6974 685f 6d65 7461 6461       with_metada
+0000f5f0: 7461 3a20 7772 6974 6573 206d 6574 6164  ta: writes metad
+0000f600: 6174 6120 696e 2059 414d 4c20 666f 726d  ata in YAML form
+0000f610: 6174 2e0a 0a20 2020 2020 2020 204b 6579  at...        Key
+0000f620: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+0000f630: 2020 2020 2020 204b 6579 776f 7264 2061         Keyword a
+0000f640: 7267 756d 656e 7473 2077 696c 6c20 6f76  rguments will ov
+0000f650: 6572 7269 6465 2074 6865 2061 6374 6976  erride the activ
+0000f660: 6520 5044 4b27 7320 6465 6661 756c 7420  e PDK's default 
+0000f670: 4764 7357 7269 7465 5365 7474 696e 6773  GdsWriteSettings
+0000f680: 2061 6e64 204f 6173 6973 5772 6974 6553   and OasisWriteS
+0000f690: 6574 7469 6e67 732e 0a0a 2020 2020 2020  ettings...      
+0000f6a0: 2020 2020 2020 4764 7320 7365 7474 696e        Gds settin
+0000f6b0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0000f6c0: 2020 2020 756e 6974 3a20 756e 6974 2073      unit: unit s
+0000f6d0: 697a 6520 666f 7220 6f62 6a65 6374 7320  ize for objects 
+0000f6e0: 696e 206c 6962 7261 7279 2e20 3175 6d20  in library. 1um 
+0000f6f0: 6279 2064 6566 6175 6c74 2e0a 2020 2020  by default..    
+0000f700: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+0000f710: 6973 696f 6e3a 2066 6f72 2064 696d 656e  ision: for dimen
+0000f720: 7369 6f6e 7320 696e 2074 6865 206c 6962  sions in the lib
+0000f730: 7261 7279 2028 6d29 2e20 316e 6d20 6279  rary (m). 1nm by
+0000f740: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
+0000f750: 2020 2020 2020 2020 2020 6f6e 5f64 7570            on_dup
+0000f760: 6c69 6361 7465 5f63 656c 6c3a 2073 7065  licate_cell: spe
+0000f770: 6369 6679 2068 6f77 2074 6f20 7265 736f  cify how to reso
+0000f780: 6c76 6520 6475 706c 6963 6174 652d 6e61  lve duplicate-na
+0000f790: 6d65 6420 6365 6c6c 732e 2043 686f 6f73  med cells. Choos
+0000f7a0: 6520 6f6e 6520 6f66 2074 6865 2066 6f6c  e one of the fol
+0000f7b0: 6c6f 7769 6e67 3a0a 2020 2020 2020 2020  lowing:.        
+0000f7c0: 2020 2020 2020 2020 2020 2020 2277 6172              "war
+0000f7d0: 6e22 2028 6465 6661 756c 7429 3a20 6f76  n" (default): ov
+0000f7e0: 6572 7772 6974 6520 616c 6c20 6475 706c  erwrite all dupl
+0000f7f0: 6963 6174 6520 6365 6c6c 7320 7769 7468  icate cells with
+0000f800: 206f 6e65 206f 6620 7468 6520 6475 706c   one of the dupl
+0000f810: 6963 6174 6573 2028 6172 6269 7472 6172  icates (arbitrar
+0000f820: 696c 7929 2e0a 2020 2020 2020 2020 2020  ily)..          
+0000f830: 2020 2020 2020 2020 2020 2265 7272 6f72            "error
+0000f840: 223a 2074 6872 6f77 2061 2056 616c 7565  ": throw a Value
+0000f850: 4572 726f 7220 7768 656e 2061 7474 656d  Error when attem
+0000f860: 7074 696e 6720 746f 2077 7269 7465 2061  pting to write a
+0000f870: 2067 6473 2077 6974 6820 6475 706c 6963   gds with duplic
+0000f880: 6174 6520 6365 6c6c 732e 0a20 2020 2020  ate cells..     
+0000f890: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000f8a0: 6f76 6572 7772 6974 6522 3a20 6f76 6572  overwrite": over
+0000f8b0: 7772 6974 6520 616c 6c20 6475 706c 6963  write all duplic
+0000f8c0: 6174 6520 6365 6c6c 7320 7769 7468 206f  ate cells with o
+0000f8d0: 6e65 206f 6620 7468 6520 6475 706c 6963  ne of the duplic
+0000f8e0: 6174 6573 2c20 7769 7468 6f75 7420 7761  ates, without wa
+0000f8f0: 726e 696e 672e 0a20 2020 2020 2020 2020  rning..         
+0000f900: 2020 2020 2020 2020 2020 204e 6f6e 653a             None:
+0000f910: 2064 6f20 6e6f 7420 7472 7920 746f 2072   do not try to r
+0000f920: 6573 6f6c 7665 2028 6174 2079 6f75 7220  esolve (at your 
+0000f930: 6f77 6e20 7269 736b 2129 0a20 2020 2020  own risk!).     
+0000f940: 2020 2020 2020 2020 2020 2066 6c61 7474             flatt
+0000f950: 656e 5f69 6e76 616c 6964 5f72 6566 733a  en_invalid_refs:
+0000f960: 2066 6c61 7474 656e 7320 636f 6d70 6f6e   flattens compon
+0000f970: 656e 7420 7265 6665 7265 6e63 6573 2077  ent references w
+0000f980: 6869 6368 2068 6176 6520 696e 7661 6c69  hich have invali
+0000f990: 6420 7472 616e 7366 6f72 6d61 7469 6f6e  d transformation
+0000f9a0: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
+0000f9b0: 2020 206d 6178 5f70 6f69 6e74 733a 204d     max_points: M
+0000f9c0: 6178 696d 616c 206e 756d 6265 7220 6f66  aximal number of
+0000f9d0: 2076 6572 7469 6365 7320 7065 7220 706f   vertices per po
+0000f9e0: 6c79 676f 6e2e 2050 6f6c 7967 6f6e 7320  lygon. Polygons 
+0000f9f0: 7769 7468 206d 6f72 6520 7665 7274 6963  with more vertic
+0000fa00: 6573 2074 6861 7420 7468 6973 2061 7265  es that this are
+0000fa10: 2061 7574 6f6d 6174 6963 616c 6c79 2066   automatically f
+0000fa20: 7261 6374 7572 6564 2e0a 0a20 2020 2020  ractured...     
+0000fa30: 2020 2020 2020 204f 6173 6973 2073 6574         Oasis set
+0000fa40: 7469 6e67 733a 0a20 2020 2020 2020 2020  tings:.         
+0000fa50: 2020 2020 2020 2063 6f6d 7072 6573 7369         compressi
+0000fa60: 6f6e 5f6c 6576 656c 3a20 4c65 7665 6c20  on_level: Level 
+0000fa70: 6f66 2063 6f6d 7072 6573 7369 6f6e 2066  of compression f
+0000fa80: 6f72 2063 656c 6c73 2028 6265 7477 6565  or cells (betwee
+0000fa90: 6e20 3020 616e 6420 3929 2e0a 2020 2020  n 0 and 9)..    
+0000faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fab0: 5365 7474 696e 6720 746f 2030 2077 696c  Setting to 0 wil
+0000fac0: 6c20 6469 7361 626c 6520 6365 6c6c 2063  l disable cell c
+0000fad0: 6f6d 7072 6573 7369 6f6e 2c20 3120 6769  ompression, 1 gi
+0000fae0: 7665 7320 7468 6520 6265 7374 2073 7065  ves the best spe
+0000faf0: 6564 2061 6e64 2039 2c20 7468 6520 6265  ed and 9, the be
+0000fb00: 7374 2063 6f6d 7072 6573 7369 6f6e 2e0a  st compression..
+0000fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb20: 6465 7465 6374 5f72 6563 7461 6e67 6c65  detect_rectangle
+0000fb30: 733a 2053 746f 7265 2072 6563 7461 6e67  s: Store rectang
+0000fb40: 6c65 7320 696e 2063 6f6d 7072 6573 7365  les in compresse
+0000fb50: 6420 666f 726d 6174 2e0a 2020 2020 2020  d format..      
+0000fb60: 2020 2020 2020 2020 2020 6465 7465 6374            detect
+0000fb70: 5f74 7261 7065 7a6f 6964 733a 2053 746f  _trapezoids: Sto
+0000fb80: 7265 2074 7261 7065 7a6f 6964 7320 696e  re trapezoids in
+0000fb90: 2063 6f6d 7072 6573 7365 6420 666f 726d   compressed form
+0000fba0: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
+0000fbb0: 2020 2020 6369 7263 6c65 5f74 6f6c 6572      circle_toler
+0000fbc0: 616e 6365 3a20 546f 6c65 7261 6e63 6520  ance: Tolerance 
+0000fbd0: 666f 7220 6465 7465 6374 696e 6720 6369  for detecting ci
+0000fbe0: 7263 6c65 732e 2049 6620 6c65 7373 206f  rcles. If less o
+0000fbf0: 7220 6571 7561 6c20 746f 2030 2c20 6e6f  r equal to 0, no
+0000fc00: 2064 6574 6563 7469 6f6e 2069 7320 7065   detection is pe
+0000fc10: 7266 6f72 6d65 642e 2043 6972 636c 6573  rformed. Circles
+0000fc20: 2061 7265 2073 746f 7265 6420 696e 2063   are stored in c
+0000fc30: 6f6d 7072 6573 7365 6420 666f 726d 6174  ompressed format
+0000fc40: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fc50: 2020 7661 6c69 6461 7469 6f6e 2028 2263    validation ("c
+0000fc60: 7263 3332 222c 2022 6368 6563 6b73 756d  rc32", "checksum
+0000fc70: 3332 222c 204e 6f6e 6529 3a20 7479 7065  32", None): type
+0000fc80: 206f 6620 7661 6c69 6461 7469 6f6e 2074   of validation t
+0000fc90: 6f20 696e 636c 7564 6520 696e 2074 6865  o include in the
+0000fca0: 2073 6176 6564 2066 696c 652e 0a20 2020   saved file..   
+0000fcb0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0000fcc0: 6e64 6172 645f 7072 6f70 6572 7469 6573  ndard_properties
+0000fcd0: 3a20 5374 6f72 6520 7374 616e 6461 7264  : Store standard
+0000fce0: 204f 4153 4953 2070 726f 7065 7274 6965   OASIS propertie
+0000fcf0: 7320 696e 2074 6865 2066 696c 652e 0a0a  s in the file...
+0000fd00: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000fd10: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+0000fd20: 746f 7279 2e70 646b 2069 6d70 6f72 7420  tory.pdk import 
+0000fd30: 6765 745f 6163 7469 7665 5f70 646b 0a0a  get_active_pdk..
+0000fd40: 2020 2020 2020 2020 6966 2067 6473 7061          if gdspa
+0000fd50: 7468 2061 6e64 2067 6473 6469 723a 0a20  th and gdsdir:. 
+0000fd60: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0000fd70: 6e67 732e 7761 726e 280a 2020 2020 2020  ngs.warn(.      
+0000fd80: 2020 2020 2020 2020 2020 2267 6473 7061            "gdspa
+0000fd90: 7468 2061 6e64 2067 6473 6469 7220 6861  th and gdsdir ha
+0000fda0: 7665 2062 6f74 6820 6265 656e 2073 7065  ve both been spe
+0000fdb0: 6369 6669 6564 2e20 6764 7370 6174 6820  cified. gdspath 
+0000fdc0: 7769 6c6c 2074 616b 6520 7072 6563 6564  will take preced
+0000fdd0: 656e 6365 2061 6e64 2067 6473 6469 7220  ence and gdsdir 
+0000fde0: 7769 6c6c 2062 6520 6967 6e6f 7265 642e  will be ignored.
+0000fdf0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000fe00: 2020 2073 7461 636b 6c65 7665 6c3d 332c     stacklevel=3,
+0000fe10: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0000fe20: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+0000fe30: 7365 7474 696e 6773 203d 2067 6574 5f61  settings = get_a
+0000fe40: 6374 6976 655f 7064 6b28 292e 6764 735f  ctive_pdk().gds_
+0000fe50: 7772 6974 655f 7365 7474 696e 6773 0a20  write_settings. 
+0000fe60: 2020 2020 2020 2064 6566 6175 6c74 5f6f         default_o
+0000fe70: 6173 6973 5f73 6574 7469 6e67 7320 3d20  asis_settings = 
+0000fe80: 6765 745f 6163 7469 7665 5f70 646b 2829  get_active_pdk()
+0000fe90: 2e6f 6173 6973 5f73 6574 7469 6e67 730a  .oasis_settings.
+0000fea0: 0a20 2020 2020 2020 2065 7870 6c69 6369  .        explici
+0000feb0: 745f 6764 735f 7365 7474 696e 6773 203d  t_gds_settings =
+0000fec0: 207b 0a20 2020 2020 2020 2020 2020 206b   {.            k
+0000fed0: 3a20 760a 2020 2020 2020 2020 2020 2020  : v.            
+0000fee0: 666f 7220 6b2c 2076 2069 6e20 6b77 6172  for k, v in kwar
+0000fef0: 6773 2e69 7465 6d73 2829 0a20 2020 2020  gs.items().     
+0000ff00: 2020 2020 2020 2069 6620 7620 6973 206e         if v is n
+0000ff10: 6f74 204e 6f6e 6520 616e 6420 6b20 696e  ot None and k in
+0000ff20: 2064 6566 6175 6c74 5f73 6574 7469 6e67   default_setting
+0000ff30: 732e 6469 6374 2829 0a20 2020 2020 2020  s.dict().       
+0000ff40: 207d 0a20 2020 2020 2020 2065 7870 6c69   }.        expli
+0000ff50: 6369 745f 6f61 735f 7365 7474 696e 6773  cit_oas_settings
+0000ff60: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0000ff70: 206b 3a20 760a 2020 2020 2020 2020 2020   k: v.          
+0000ff80: 2020 666f 7220 6b2c 2076 2069 6e20 6b77    for k, v in kw
+0000ff90: 6172 6773 2e69 7465 6d73 2829 0a20 2020  args.items().   
+0000ffa0: 2020 2020 2020 2020 2069 6620 7620 6973           if v is
+0000ffb0: 206e 6f74 204e 6f6e 6520 616e 6420 6b20   not None and k 
+0000ffc0: 696e 2064 6566 6175 6c74 5f6f 6173 6973  in default_oasis
+0000ffd0: 5f73 6574 7469 6e67 732e 6469 6374 2829  _settings.dict()
+0000ffe0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0000fff0: 2020 2023 2075 7064 6174 6520 7468 6520     # update the 
+00010000: 7772 6974 6520 7365 7474 696e 6773 2077  write settings w
+00010010: 6974 6820 616e 7920 7365 7474 696e 6773  ith any settings
+00010020: 2065 7870 6c69 6369 746c 7920 7061 7373   explicitly pass
+00010030: 6564 0a20 2020 2020 2020 2077 7269 7465  ed.        write
+00010040: 5f73 6574 7469 6e67 7320 3d20 6465 6661  _settings = defa
+00010050: 756c 745f 7365 7474 696e 6773 2e63 6f70  ult_settings.cop
+00010060: 7928 7570 6461 7465 3d65 7870 6c69 6369  y(update=explici
+00010070: 745f 6764 735f 7365 7474 696e 6773 290a  t_gds_settings).
+00010080: 2020 2020 2020 2020 6f61 7369 735f 7365          oasis_se
+00010090: 7474 696e 6773 203d 2064 6566 6175 6c74  ttings = default
+000100a0: 5f6f 6173 6973 5f73 6574 7469 6e67 732e  _oasis_settings.
+000100b0: 636f 7079 2875 7064 6174 653d 6578 706c  copy(update=expl
+000100c0: 6963 6974 5f6f 6173 5f73 6574 7469 6e67  icit_oas_setting
+000100d0: 7329 0a0a 2020 2020 2020 2020 5f63 6865  s)..        _che
+000100e0: 636b 5f75 6e63 6163 6865 645f 636f 6d70  ck_uncached_comp
+000100f0: 6f6e 656e 7473 280a 2020 2020 2020 2020  onents(.        
+00010100: 2020 2020 636f 6d70 6f6e 656e 743d 7365      component=se
+00010110: 6c66 2c20 6d6f 6465 3d77 7269 7465 5f73  lf, mode=write_s
+00010120: 6574 7469 6e67 732e 6f6e 5f75 6e63 6163  ettings.on_uncac
+00010130: 6865 645f 636f 6d70 6f6e 656e 740a 2020  hed_component.  
+00010140: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00010150: 2069 6620 7772 6974 655f 7365 7474 696e   if write_settin
+00010160: 6773 2e66 6c61 7474 656e 5f69 6e76 616c  gs.flatten_inval
+00010170: 6964 5f72 6566 733a 0a20 2020 2020 2020  id_refs:.       
+00010180: 2020 2020 2074 6f70 5f63 656c 6c20 3d20       top_cell = 
+00010190: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
+000101a0: 7265 6673 5f72 6563 7572 7369 7665 2873  refs_recursive(s
+000101b0: 656c 6629 0a20 2020 2020 2020 2065 6c73  elf).        els
+000101c0: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+000101d0: 6f70 5f63 656c 6c20 3d20 7365 6c66 0a0a  op_cell = self..
+000101e0: 2020 2020 2020 2020 6764 7364 6972 203d          gdsdir =
+000101f0: 2067 6473 6469 7220 6f72 2047 4453 4449   gdsdir or GDSDI
+00010200: 525f 5445 4d50 0a20 2020 2020 2020 2067  R_TEMP.        g
+00010210: 6473 6469 7220 3d20 7061 7468 6c69 622e  dsdir = pathlib.
+00010220: 5061 7468 2867 6473 6469 7229 0a20 2020  Path(gdsdir).   
+00010230: 2020 2020 2069 6620 7769 7468 5f6f 6173       if with_oas
+00010240: 6973 3a0a 2020 2020 2020 2020 2020 2020  is:.            
+00010250: 6764 7370 6174 6820 3d20 6764 7370 6174  gdspath = gdspat
+00010260: 6820 6f72 2067 6473 6469 7220 2f20 6622  h or gdsdir / f"
+00010270: 7b74 6f70 5f63 656c 6c2e 6e61 6d65 7d2e  {top_cell.name}.
+00010280: 6f61 7322 0a20 2020 2020 2020 2065 6c73  oas".        els
+00010290: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
+000102a0: 6473 7061 7468 203d 2067 6473 7061 7468  dspath = gdspath
+000102b0: 206f 7220 6764 7364 6972 202f 2066 227b   or gdsdir / f"{
+000102c0: 746f 705f 6365 6c6c 2e6e 616d 657d 2e67  top_cell.name}.g
+000102d0: 6473 220a 2020 2020 2020 2020 6764 7370  ds".        gdsp
+000102e0: 6174 6820 3d20 7061 7468 6c69 622e 5061  ath = pathlib.Pa
+000102f0: 7468 2867 6473 7061 7468 290a 2020 2020  th(gdspath).    
+00010300: 2020 2020 6764 7364 6972 203d 2067 6473      gdsdir = gds
+00010310: 7061 7468 2e70 6172 656e 740a 2020 2020  path.parent.    
+00010320: 2020 2020 6764 7364 6972 2e6d 6b64 6972      gdsdir.mkdir
+00010330: 2865 7869 7374 5f6f 6b3d 5472 7565 2c20  (exist_ok=True, 
+00010340: 7061 7265 6e74 733d 5472 7565 290a 0a20  parents=True).. 
+00010350: 2020 2020 2020 2063 656c 6c73 203d 2074         cells = t
+00010360: 6f70 5f63 656c 6c2e 6765 745f 6465 7065  op_cell.get_depe
+00010370: 6e64 656e 6369 6573 2872 6563 7572 7369  ndencies(recursi
+00010380: 7665 3d54 7275 6529 0a20 2020 2020 2020  ve=True).       
+00010390: 2063 656c 6c5f 6e61 6d65 7320 3d20 5b63   cell_names = [c
+000103a0: 656c 6c2e 6e61 6d65 2066 6f72 2063 656c  ell.name for cel
+000103b0: 6c20 696e 206c 6973 7428 6365 6c6c 7329  l in list(cells)
+000103c0: 5d0a 2020 2020 2020 2020 6365 6c6c 5f6e  ].        cell_n
+000103d0: 616d 6573 5f75 6e69 7175 6520 3d20 7365  ames_unique = se
+000103e0: 7428 6365 6c6c 5f6e 616d 6573 290a 0a20  t(cell_names).. 
+000103f0: 2020 2020 2020 2069 6620 6c65 6e28 6365         if len(ce
+00010400: 6c6c 5f6e 616d 6573 2920 213d 206c 656e  ll_names) != len
+00010410: 2873 6574 2863 656c 6c5f 6e61 6d65 7329  (set(cell_names)
+00010420: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00010430: 6f72 2063 656c 6c5f 6e61 6d65 2069 6e20  or cell_name in 
+00010440: 6365 6c6c 5f6e 616d 6573 5f75 6e69 7175  cell_names_uniqu
+00010450: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00010460: 2020 2063 656c 6c5f 6e61 6d65 732e 7265     cell_names.re
+00010470: 6d6f 7665 2863 656c 6c5f 6e61 6d65 290a  move(cell_name).
+00010480: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010490: 7772 6974 655f 7365 7474 696e 6773 2e6f  write_settings.o
+000104a0: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
+000104b0: 203d 3d20 2265 7272 6f72 223a 0a20 2020   == "error":.   
+000104c0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+000104d0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+000104e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104f0: 2020 2066 2244 7570 6c69 6361 7465 6420     f"Duplicated 
+00010500: 6365 6c6c 206e 616d 6573 2069 6e20 7b74  cell names in {t
+00010510: 6f70 5f63 656c 6c2e 6e61 6d65 2172 7d3a  op_cell.name!r}:
+00010520: 207b 6365 6c6c 5f6e 616d 6573 2172 7d22   {cell_names!r}"
+00010530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010540: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
+00010550: 6c69 6620 7772 6974 655f 7365 7474 696e  lif write_settin
+00010560: 6773 2e6f 6e5f 6475 706c 6963 6174 655f  gs.on_duplicate_
+00010570: 6365 6c6c 2069 6e20 7b22 7761 726e 222c  cell in {"warn",
+00010580: 2022 6f76 6572 7772 6974 6522 7d3a 0a20   "overwrite"}:. 
+00010590: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000105a0: 6620 7772 6974 655f 7365 7474 696e 6773  f write_settings
+000105b0: 2e6f 6e5f 6475 706c 6963 6174 655f 6365  .on_duplicate_ce
+000105c0: 6c6c 203d 3d20 2277 6172 6e22 3a0a 2020  ll == "warn":.  
+000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105e0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+000105f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010600: 2020 2020 2020 2020 2066 2244 7570 6c69           f"Dupli
+00010610: 6361 7465 6420 6365 6c6c 206e 616d 6573  cated cell names
+00010620: 2069 6e20 7b74 6f70 5f63 656c 6c2e 6e61   in {top_cell.na
+00010630: 6d65 2172 7d3a 2020 7b63 656c 6c5f 6e61  me!r}:  {cell_na
+00010640: 6d65 737d 222c 0a20 2020 2020 2020 2020  mes}",.         
+00010650: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010660: 7461 636b 6c65 7665 6c3d 332c 0a20 2020  tacklevel=3,.   
+00010670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010680: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00010690: 2020 2063 656c 6c73 5f64 6963 7420 3d20     cells_dict = 
+000106a0: 7b63 656c 6c2e 6e61 6d65 3a20 6365 6c6c  {cell.name: cell
+000106b0: 2e5f 6365 6c6c 2066 6f72 2063 656c 6c20  ._cell for cell 
+000106c0: 696e 2063 656c 6c73 7d0a 2020 2020 2020  in cells}.      
+000106d0: 2020 2020 2020 2020 2020 6365 6c6c 7320            cells 
+000106e0: 3d20 6365 6c6c 735f 6469 6374 2e76 616c  = cells_dict.val
+000106f0: 7565 7328 290a 2020 2020 2020 2020 2020  ues().          
+00010700: 2020 656c 6966 2077 7269 7465 5f73 6574    elif write_set
+00010710: 7469 6e67 732e 6f6e 5f64 7570 6c69 6361  tings.on_duplica
+00010720: 7465 5f63 656c 6c20 6973 206e 6f74 204e  te_cell is not N
+00010730: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00010740: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00010750: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00010760: 2020 2020 2020 2020 2020 2066 226f 6e5f             f"on_
+00010770: 6475 706c 6963 6174 655f 6365 6c6c 3a20  duplicate_cell: 
+00010780: 7b77 7269 7465 5f73 6574 7469 6e67 732e  {write_settings.
+00010790: 6f6e 5f64 7570 6c69 6361 7465 5f63 656c  on_duplicate_cel
+000107a0: 6c21 727d 206e 6f74 2069 6e20 284e 6f6e  l!r} not in (Non
+000107b0: 652c 2077 6172 6e2c 2065 7272 6f72 2c20  e, warn, error, 
+000107c0: 6f76 6572 7772 6974 6529 220a 2020 2020  overwrite)".    
+000107d0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000107e0: 2020 2020 2020 2061 6c6c 5f63 656c 6c73         all_cells
+000107f0: 203d 205b 746f 705f 6365 6c6c 2e5f 6365   = [top_cell._ce
+00010800: 6c6c 5d20 2b20 736f 7274 6564 2863 656c  ll] + sorted(cel
+00010810: 6c73 2c20 6b65 793d 6c61 6d62 6461 2063  ls, key=lambda c
+00010820: 633a 2063 632e 6e61 6d65 290a 0a20 2020  c: cc.name)..   
+00010830: 2020 2020 206e 6f5f 6e61 6d65 5f63 656c       no_name_cel
+00010840: 6c73 203d 205b 0a20 2020 2020 2020 2020  ls = [.         
+00010850: 2020 2063 656c 6c2e 6e61 6d65 2066 6f72     cell.name for
+00010860: 2063 656c 6c20 696e 2061 6c6c 5f63 656c   cell in all_cel
+00010870: 6c73 2069 6620 6365 6c6c 2e6e 616d 652e  ls if cell.name.
+00010880: 7374 6172 7473 7769 7468 2822 556e 6e61  startswith("Unna
+00010890: 6d65 6422 290a 2020 2020 2020 2020 5d0a  med").        ].
+000108a0: 0a20 2020 2020 2020 2069 6620 6e6f 5f6e  .        if no_n
+000108b0: 616d 655f 6365 6c6c 733a 0a20 2020 2020  ame_cells:.     
+000108c0: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+000108d0: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+000108e0: 2020 2020 2020 6622 436f 6d70 6f6e 656e        f"Componen
+000108f0: 7420 7b74 6f70 5f63 656c 6c2e 6e61 6d65  t {top_cell.name
+00010900: 2172 7d20 636f 6e74 6169 6e73 207b 6c65  !r} contains {le
+00010910: 6e28 6e6f 5f6e 616d 655f 6365 6c6c 7329  n(no_name_cells)
+00010920: 7d20 556e 6e61 6d65 6420 6365 6c6c 7322  } Unnamed cells"
+00010930: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010940: 2020 7374 6163 6b6c 6576 656c 3d33 2c0a    stacklevel=3,.
+00010950: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00010960: 2020 2020 2020 2023 2066 6f72 2063 656c         # for cel
+00010970: 6c20 696e 2061 6c6c 5f63 656c 6c73 3a0a  l in all_cells:.
+00010980: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
+00010990: 696e 7428 6365 6c6c 2e6e 616d 652c 2074  int(cell.name, t
+000109a0: 7970 6528 6365 6c6c 2929 0a0a 2020 2020  ype(cell))..    
+000109b0: 2020 2020 6c69 6220 3d20 6764 7374 6b2e      lib = gdstk.
+000109c0: 4c69 6272 6172 7928 0a20 2020 2020 2020  Library(.       
+000109d0: 2020 2020 206e 616d 653d 7772 6974 655f       name=write_
+000109e0: 7365 7474 696e 6773 2e6c 6962 5f6e 616d  settings.lib_nam
+000109f0: 652c 0a20 2020 2020 2020 2020 2020 2075  e,.            u
+00010a00: 6e69 743d 7772 6974 655f 7365 7474 696e  nit=write_settin
+00010a10: 6773 2e75 6e69 742c 0a20 2020 2020 2020  gs.unit,.       
+00010a20: 2020 2020 2070 7265 6369 7369 6f6e 3d77       precision=w
+00010a30: 7269 7465 5f73 6574 7469 6e67 732e 7072  rite_settings.pr
+00010a40: 6563 6973 696f 6e2c 0a20 2020 2020 2020  ecision,.       
+00010a50: 2029 0a20 2020 2020 2020 206c 6962 2e61   ).        lib.a
+00010a60: 6464 2874 6f70 5f63 656c 6c2e 5f63 656c  dd(top_cell._cel
+00010a70: 6c29 0a20 2020 2020 2020 206c 6962 2e61  l).        lib.a
+00010a80: 6464 282a 746f 705f 6365 6c6c 2e5f 6365  dd(*top_cell._ce
+00010a90: 6c6c 2e64 6570 656e 6465 6e63 6965 7328  ll.dependencies(
+00010aa0: 5472 7565 2929 0a0a 2020 2020 2020 2020  True))..        
+00010ab0: 6966 2077 6974 685f 6f61 7369 733a 0a20  if with_oasis:. 
+00010ac0: 2020 2020 2020 2020 2020 206c 6962 2e77             lib.w
+00010ad0: 7269 7465 5f6f 6173 2867 6473 7061 7468  rite_oas(gdspath
+00010ae0: 2c20 2a2a 6f61 7369 735f 7365 7474 696e  , **oasis_settin
+00010af0: 6773 2e64 6963 7428 2929 0a20 2020 2020  gs.dict()).     
+00010b00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00010b10: 2020 2020 206c 6962 2e77 7269 7465 5f67       lib.write_g
+00010b20: 6473 280a 2020 2020 2020 2020 2020 2020  ds(.            
+00010b30: 2020 2020 6764 7370 6174 682c 2074 696d      gdspath, tim
+00010b40: 6573 7461 6d70 3d74 696d 6573 7461 6d70  estamp=timestamp
+00010b50: 2c20 6d61 785f 706f 696e 7473 3d77 7269  , max_points=wri
+00010b60: 7465 5f73 6574 7469 6e67 732e 6d61 785f  te_settings.max_
+00010b70: 706f 696e 7473 0a20 2020 2020 2020 2020  points.         
+00010b80: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00010b90: 6c6f 6767 696e 673a 0a20 2020 2020 2020  logging:.       
+00010ba0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+00010bb0: 2866 2257 726f 7465 2074 6f20 7b73 7472  (f"Wrote to {str
+00010bc0: 2867 6473 7061 7468 2921 727d 2229 0a20  (gdspath)!r}"). 
+00010bd0: 2020 2020 2020 2069 6620 7769 7468 5f6d         if with_m
+00010be0: 6574 6164 6174 613a 0a20 2020 2020 2020  etadata:.       
+00010bf0: 2020 2020 206d 6574 6164 6174 6120 3d20       metadata = 
+00010c00: 6764 7370 6174 682e 7769 7468 5f73 7566  gdspath.with_suf
+00010c10: 6669 7828 222e 796d 6c22 290a 2020 2020  fix(".yml").    
+00010c20: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+00010c30: 2e77 7269 7465 5f74 6578 7428 7365 6c66  .write_text(self
+00010c40: 2e74 6f5f 7961 6d6c 2877 6974 685f 6365  .to_yaml(with_ce
+00010c50: 6c6c 733d 5472 7565 2c20 7769 7468 5f70  lls=True, with_p
+00010c60: 6f72 7473 3d54 7275 6529 290a 2020 2020  orts=True)).    
+00010c70: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+00010c80: 6e66 6f28 6622 5772 6974 6520 5941 4d4c  nfo(f"Write YAML
+00010c90: 206d 6574 6164 6174 6120 746f 207b 7374   metadata to {st
+00010ca0: 7228 6d65 7461 6461 7461 2921 727d 2229  r(metadata)!r}")
+00010cb0: 0a0a 2020 2020 2020 2020 434f 4e46 2e6c  ..        CONF.l
+00010cc0: 6173 745f 7361 7665 645f 6669 6c65 732e  ast_saved_files.
+00010cd0: 6170 7065 6e64 2867 6473 7061 7468 290a  append(gdspath).
+00010ce0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00010cf0: 6473 7061 7468 0a0a 2020 2020 6465 6620  dspath..    def 
+00010d00: 7772 6974 655f 6764 7328 0a20 2020 2020  write_gds(.     
+00010d10: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00010d20: 2067 6473 7061 7468 3a20 5061 7468 5479   gdspath: PathTy
+00010d30: 7065 207c 204e 6f6e 6520 3d20 4e6f 6e65  pe | None = None
+00010d40: 2c0a 2020 2020 2020 2020 6764 7364 6972  ,.        gdsdir
+00010d50: 3a20 5061 7468 5479 7065 207c 204e 6f6e  : PathType | Non
+00010d60: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
+00010d70: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00010d80: 2920 2d3e 2050 6174 683a 0a20 2020 2020  ) -> Path:.     
+00010d90: 2020 2022 2222 5772 6974 6520 636f 6d70     """Write comp
+00010da0: 6f6e 656e 7420 746f 2047 4453 2061 6e64  onent to GDS and
+00010db0: 2072 6574 7572 6e73 2067 6473 7061 7468   returns gdspath
+00010dc0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00010dd0: 0a20 2020 2020 2020 2020 2020 2067 6473  .            gds
+00010de0: 7061 7468 3a20 4744 5320 6669 6c65 2070  path: GDS file p
+00010df0: 6174 6820 746f 2077 7269 7465 2074 6f2e  ath to write to.
+00010e00: 0a20 2020 2020 2020 2020 2020 2067 6473  .            gds
+00010e10: 6469 723a 2064 6972 6563 746f 7279 2066  dir: directory f
+00010e20: 6f72 2074 6865 2047 4453 2066 696c 652e  or the GDS file.
+00010e30: 2044 6566 6175 6c74 7320 746f 202f 746d   Defaults to /tm
+00010e40: 702f 7261 6e64 6f6d 4669 6c65 2f67 6473  p/randomFile/gds
+00010e50: 6661 6374 6f72 792e 0a0a 2020 2020 2020  factory...      
+00010e60: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+00010e70: 2020 2020 2020 2020 2020 2020 756e 6974              unit
+00010e80: 3a20 756e 6974 2073 697a 6520 666f 7220  : unit size for 
+00010e90: 6f62 6a65 6374 7320 696e 206c 6962 7261  objects in libra
+00010ea0: 7279 2e20 3175 6d20 6279 2064 6566 6175  ry. 1um by defau
+00010eb0: 6c74 2e0a 2020 2020 2020 2020 2020 2020  lt..            
+00010ec0: 7072 6563 6973 696f 6e3a 2066 6f72 2064  precision: for d
+00010ed0: 696d 656e 7369 6f6e 7320 696e 2074 6865  imensions in the
+00010ee0: 206c 6962 7261 7279 2028 6d29 2e20 316e   library (m). 1n
+00010ef0: 6d20 6279 2064 6566 6175 6c74 2e0a 2020  m by default..  
+00010f00: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
+00010f10: 673a 2064 6973 6162 6c65 2047 4453 2070  g: disable GDS p
+00010f20: 6174 6820 6c6f 6767 696e 672c 2066 6f72  ath logging, for
+00010f30: 2065 7861 6d70 6c65 2066 6f72 2073 686f   example for sho
+00010f40: 7769 6e67 2069 7420 696e 204b 4c61 796f  wing it in KLayo
+00010f50: 7574 2e0a 2020 2020 2020 2020 2020 2020  ut..            
+00010f60: 6f6e 5f64 7570 6c69 6361 7465 5f63 656c  on_duplicate_cel
+00010f70: 6c3a 2073 7065 6369 6679 2068 6f77 2074  l: specify how t
+00010f80: 6f20 7265 736f 6c76 6520 6475 706c 6963  o resolve duplic
+00010f90: 6174 652d 6e61 6d65 6420 6365 6c6c 732e  ate-named cells.
+00010fa0: 2043 686f 6f73 6520 6f6e 6520 6f66 2074   Choose one of t
+00010fb0: 6865 2066 6f6c 6c6f 7769 6e67 3a0a 2020  he following:.  
+00010fc0: 2020 2020 2020 2020 2020 2020 2020 2277                "w
+00010fd0: 6172 6e22 2028 6465 6661 756c 7429 3a20  arn" (default): 
+00010fe0: 6f76 6572 7772 6974 6520 616c 6c20 6475  overwrite all du
+00010ff0: 706c 6963 6174 6520 6365 6c6c 7320 7769  plicate cells wi
+00011000: 7468 206f 6e65 206f 6620 7468 6520 6475  th one of the du
+00011010: 706c 6963 6174 6573 2028 6172 6269 7472  plicates (arbitr
+00011020: 6172 696c 7929 2e0a 2020 2020 2020 2020  arily)..        
+00011030: 2020 2020 2020 2020 2265 7272 6f72 223a          "error":
+00011040: 2074 6872 6f77 2061 2056 616c 7565 4572   throw a ValueEr
+00011050: 726f 7220 7768 656e 2061 7474 656d 7074  ror when attempt
+00011060: 696e 6720 746f 2077 7269 7465 2061 2067  ing to write a g
+00011070: 6473 2077 6974 6820 6475 706c 6963 6174  ds with duplicat
+00011080: 6520 6365 6c6c 732e 0a20 2020 2020 2020  e cells..       
+00011090: 2020 2020 2020 2020 2022 6f76 6572 7772           "overwr
+000110a0: 6974 6522 3a20 6f76 6572 7772 6974 6520  ite": overwrite 
+000110b0: 616c 6c20 6475 706c 6963 6174 6520 6365  all duplicate ce
+000110c0: 6c6c 7320 7769 7468 206f 6e65 206f 6620  lls with one of 
+000110d0: 7468 6520 6475 706c 6963 6174 6573 2c20  the duplicates, 
+000110e0: 7769 7468 6f75 7420 7761 726e 696e 672e  without warning.
+000110f0: 0a20 2020 2020 2020 2020 2020 206f 6e5f  .            on_
+00011100: 756e 6361 6368 6564 5f63 6f6d 706f 6e65  uncached_compone
+00011110: 6e74 3a20 4c69 7465 7261 6c5b 2277 6172  nt: Literal["war
+00011120: 6e22 2c20 2265 7272 6f72 225d 203d 2022  n", "error"] = "
+00011130: 7761 726e 220a 2020 2020 2020 2020 2020  warn".          
+00011140: 2020 666c 6174 7465 6e5f 696e 7661 6c69    flatten_invali
+00011150: 645f 7265 6673 3a20 666c 6174 7465 6e73  d_refs: flattens
+00011160: 2063 6f6d 706f 6e65 6e74 2072 6566 6572   component refer
+00011170: 656e 6365 7320 7768 6963 6820 6861 7665  ences which have
+00011180: 2069 6e76 616c 6964 2074 7261 6e73 666f   invalid transfo
+00011190: 726d 6174 696f 6e73 2e0a 2020 2020 2020  rmations..      
+000111a0: 2020 2020 2020 6d61 785f 706f 696e 7473        max_points
+000111b0: 3a20 4d61 7869 6d61 6c20 6e75 6d62 6572  : Maximal number
+000111c0: 206f 6620 7665 7274 6963 6573 2070 6572   of vertices per
+000111d0: 2070 6f6c 7967 6f6e 2e0a 2020 2020 2020   polygon..      
+000111e0: 2020 2020 2020 2020 2020 506f 6c79 676f            Polygo
+000111f0: 6e73 2077 6974 6820 6d6f 7265 2076 6572  ns with more ver
+00011200: 7469 6365 7320 7468 6174 2074 6869 7320  tices that this 
+00011210: 6172 6520 6175 746f 6d61 7469 6361 6c6c  are automaticall
+00011220: 7920 6672 6163 7475 7265 642e 0a20 2020  y fractured..   
+00011230: 2020 2020 2020 2020 2077 6974 685f 6d65           with_me
+00011240: 7461 6461 7461 3a20 7772 6974 6573 206d  tadata: writes m
+00011250: 6574 6164 6174 6120 696e 2059 414d 4c20  etadata in YAML 
+00011260: 666f 726d 6174 2e0a 2020 2020 2020 2020  format..        
+00011270: 2222 220a 0a20 2020 2020 2020 2072 6574  """..        ret
+00011280: 7572 6e20 7365 6c66 2e5f 7772 6974 655f  urn self._write_
+00011290: 6c69 6272 6172 7928 0a20 2020 2020 2020  library(.       
+000112a0: 2020 2020 2067 6473 7061 7468 3d67 6473       gdspath=gds
+000112b0: 7061 7468 2c20 6764 7364 6972 3d67 6473  path, gdsdir=gds
+000112c0: 6469 722c 2077 6974 685f 6f61 7369 733d  dir, with_oasis=
+000112d0: 4661 6c73 652c 202a 2a6b 7761 7267 730a  False, **kwargs.
+000112e0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+000112f0: 6566 2077 7269 7465 5f6f 6173 280a 2020  ef write_oas(.  
+00011300: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00011310: 2020 2020 6764 7370 6174 683a 2050 6174      gdspath: Pat
+00011320: 6854 7970 6520 7c20 4e6f 6e65 203d 204e  hType | None = N
+00011330: 6f6e 652c 0a20 2020 2020 2020 2067 6473  one,.        gds
+00011340: 6469 723a 2050 6174 6854 7970 6520 7c20  dir: PathType | 
+00011350: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00011360: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
+00011370: 2020 2029 202d 3e20 5061 7468 3a0a 2020     ) -> Path:.  
+00011380: 2020 2020 2020 2222 2257 7269 7465 2063        """Write c
+00011390: 6f6d 706f 6e65 6e74 2074 6f20 4744 5320  omponent to GDS 
+000113a0: 616e 6420 7265 7475 726e 7320 6764 7370  and returns gdsp
+000113b0: 6174 682e 0a0a 2020 2020 2020 2020 4172  ath...        Ar
+000113c0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000113d0: 6764 7370 6174 683a 2047 4453 2066 696c  gdspath: GDS fil
+000113e0: 6520 7061 7468 2074 6f20 7772 6974 6520  e path to write 
+000113f0: 746f 2e0a 2020 2020 2020 2020 2020 2020  to..            
+00011400: 6764 7364 6972 3a20 6469 7265 6374 6f72  gdsdir: director
+00011410: 7920 666f 7220 7468 6520 4744 5320 6669  y for the GDS fi
+00011420: 6c65 2e20 4465 6661 756c 7473 2074 6f20  le. Defaults to 
+00011430: 2f74 6d70 2f72 616e 646f 6d46 696c 652f  /tmp/randomFile/
+00011440: 6764 7366 6163 746f 7279 2e0a 0a20 2020  gdsfactory...   
+00011450: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
+00011460: 733a 0a20 2020 2020 2020 2020 2020 2075  s:.            u
+00011470: 6e69 743a 2075 6e69 7420 7369 7a65 2066  nit: unit size f
+00011480: 6f72 206f 626a 6563 7473 2069 6e20 6c69  or objects in li
+00011490: 6272 6172 792e 2031 756d 2062 7920 6465  brary. 1um by de
+000114a0: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
+000114b0: 2020 2070 7265 6369 7369 6f6e 3a20 666f     precision: fo
+000114c0: 7220 6469 6d65 6e73 696f 6e73 2069 6e20  r dimensions in 
+000114d0: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
+000114e0: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
+000114f0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00011500: 6769 6e67 3a20 6469 7361 626c 6520 4744  ging: disable GD
+00011510: 5320 7061 7468 206c 6f67 6769 6e67 2c20  S path logging, 
+00011520: 666f 7220 6578 616d 706c 6520 666f 7220  for example for 
+00011530: 7368 6f77 696e 6720 6974 2069 6e20 4b4c  showing it in KL
+00011540: 6179 6f75 742e 0a20 2020 2020 2020 2020  ayout..         
+00011550: 2020 206f 6e5f 6475 706c 6963 6174 655f     on_duplicate_
+00011560: 6365 6c6c 3a20 7370 6563 6966 7920 686f  cell: specify ho
+00011570: 7720 746f 2072 6573 6f6c 7665 2064 7570  w to resolve dup
+00011580: 6c69 6361 7465 2d6e 616d 6564 2063 656c  licate-named cel
+00011590: 6c73 2e20 4368 6f6f 7365 206f 6e65 206f  ls. Choose one o
+000115a0: 6620 7468 6520 666f 6c6c 6f77 696e 673a  f the following:
+000115b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000115c0: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
+000115d0: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
+000115e0: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
+000115f0: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
+00011600: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
+00011610: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
+00011620: 2020 2020 2020 2020 2020 2022 6572 726f             "erro
+00011630: 7222 3a20 7468 726f 7720 6120 5661 6c75  r": throw a Valu
+00011640: 6545 7272 6f72 2077 6865 6e20 6174 7465  eError when atte
+00011650: 6d70 7469 6e67 2074 6f20 7772 6974 6520  mpting to write 
+00011660: 6120 6764 7320 7769 7468 2064 7570 6c69  a gds with dupli
+00011670: 6361 7465 2063 656c 6c73 2e0a 2020 2020  cate cells..    
+00011680: 2020 2020 2020 2020 2020 2020 226f 7665              "ove
+00011690: 7277 7269 7465 223a 206f 7665 7277 7269  rwrite": overwri
+000116a0: 7465 2061 6c6c 2064 7570 6c69 6361 7465  te all duplicate
+000116b0: 2063 656c 6c73 2077 6974 6820 6f6e 6520   cells with one 
+000116c0: 6f66 2074 6865 2064 7570 6c69 6361 7465  of the duplicate
+000116d0: 732c 2077 6974 686f 7574 2077 6172 6e69  s, without warni
+000116e0: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
+000116f0: 2020 2020 4e6f 6e65 3a20 646f 206e 6f74      None: do not
+00011700: 2074 7279 2074 6f20 7265 736f 6c76 6520   try to resolve 
+00011710: 2861 7420 796f 7572 206f 776e 2072 6973  (at your own ris
+00011720: 6b21 290a 2020 2020 2020 2020 2020 2020  k!).            
+00011730: 6f6e 5f75 6e63 6163 6865 645f 636f 6d70  on_uncached_comp
+00011740: 6f6e 656e 743a 204c 6974 6572 616c 5b22  onent: Literal["
+00011750: 7761 726e 222c 2022 6572 726f 7222 5d20  warn", "error"] 
+00011760: 3d20 2277 6172 6e22 0a20 2020 2020 2020  = "warn".       
+00011770: 2020 2020 2066 6c61 7474 656e 5f69 6e76       flatten_inv
+00011780: 616c 6964 5f72 6566 733a 2066 6c61 7474  alid_refs: flatt
+00011790: 656e 7320 636f 6d70 6f6e 656e 7420 7265  ens component re
+000117a0: 6665 7265 6e63 6573 2077 6869 6368 2068  ferences which h
+000117b0: 6176 6520 696e 7661 6c69 6420 7472 616e  ave invalid tran
+000117c0: 7366 6f72 6d61 7469 6f6e 732e 0a20 2020  sformations..   
+000117d0: 2020 2020 2020 2020 2063 6f6d 7072 6573           compres
+000117e0: 7369 6f6e 5f6c 6576 656c 3a20 4c65 7665  sion_level: Leve
+000117f0: 6c20 6f66 2063 6f6d 7072 6573 7369 6f6e  l of compression
+00011800: 2066 6f72 2063 656c 6c73 2028 6265 7477   for cells (betw
+00011810: 6565 6e20 3020 616e 6420 3929 2e0a 2020  een 0 and 9)..  
+00011820: 2020 2020 2020 2020 2020 2020 2020 5365                Se
+00011830: 7474 696e 6720 746f 2030 2077 696c 6c20  tting to 0 will 
+00011840: 6469 7361 626c 6520 6365 6c6c 2063 6f6d  disable cell com
+00011850: 7072 6573 7369 6f6e 2c20 3120 6769 7665  pression, 1 give
+00011860: 7320 7468 6520 6265 7374 2073 7065 6564  s the best speed
+00011870: 2061 6e64 2039 2c20 7468 6520 6265 7374   and 9, the best
+00011880: 2063 6f6d 7072 6573 7369 6f6e 2e0a 2020   compression..  
+00011890: 2020 2020 2020 2020 2020 6465 7465 6374            detect
+000118a0: 5f72 6563 7461 6e67 6c65 733a 2053 746f  _rectangles: Sto
+000118b0: 7265 2072 6563 7461 6e67 6c65 7320 696e  re rectangles in
+000118c0: 2063 6f6d 7072 6573 7365 6420 666f 726d   compressed form
+000118d0: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
+000118e0: 6465 7465 6374 5f74 7261 7065 7a6f 6964  detect_trapezoid
+000118f0: 733a 2053 746f 7265 2074 7261 7065 7a6f  s: Store trapezo
+00011900: 6964 7320 696e 2063 6f6d 7072 6573 7365  ids in compresse
+00011910: 6420 666f 726d 6174 2e0a 2020 2020 2020  d format..      
+00011920: 2020 2020 2020 6369 7263 6c65 5f74 6f6c        circle_tol
+00011930: 6572 616e 6365 3a20 546f 6c65 7261 6e63  erance: Toleranc
+00011940: 6520 666f 7220 6465 7465 6374 696e 6720  e for detecting 
+00011950: 6369 7263 6c65 732e 2049 6620 6c65 7373  circles. If less
+00011960: 206f 7220 6571 7561 6c20 746f 2030 2c20   or equal to 0, 
+00011970: 6e6f 2064 6574 6563 7469 6f6e 2069 7320  no detection is 
+00011980: 7065 7266 6f72 6d65 642e 0a20 2020 2020  performed..     
+00011990: 2020 2020 2020 2020 2020 2043 6972 636c             Circl
+000119a0: 6573 2061 7265 2073 746f 7265 6420 696e  es are stored in
+000119b0: 2063 6f6d 7072 6573 7365 6420 666f 726d   compressed form
+000119c0: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
+000119d0: 7661 6c69 6461 7469 6f6e 2028 2263 7263  validation ("crc
+000119e0: 3332 222c 2022 6368 6563 6b73 756d 3332  32", "checksum32
+000119f0: 222c 204e 6f6e 6529 20e2 8093 2074 7970  ", None) ... typ
+00011a00: 6520 6f66 2076 616c 6964 6174 696f 6e20  e of validation 
+00011a10: 746f 2069 6e63 6c75 6465 2069 6e20 7468  to include in th
+00011a20: 6520 7361 7665 6420 6669 6c65 2e0a 2020  e saved file..  
+00011a30: 2020 2020 2020 2020 2020 7374 616e 6461            standa
+00011a40: 7264 5f70 726f 7065 7274 6965 733a 2053  rd_properties: S
+00011a50: 746f 7265 2073 7461 6e64 6172 6420 4f41  tore standard OA
+00011a60: 5349 5320 7072 6f70 6572 7469 6573 2069  SIS properties i
+00011a70: 6e20 7468 6520 6669 6c65 2e0a 2020 2020  n the file..    
+00011a80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00011a90: 7265 7475 726e 2073 656c 662e 5f77 7269  return self._wri
+00011aa0: 7465 5f6c 6962 7261 7279 280a 2020 2020  te_library(.    
+00011ab0: 2020 2020 2020 2020 6764 7370 6174 683d          gdspath=
+00011ac0: 6764 7370 6174 682c 0a20 2020 2020 2020  gdspath,.       
+00011ad0: 2020 2020 2067 6473 6469 723d 6764 7364       gdsdir=gdsd
+00011ae0: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+00011af0: 7769 7468 5f6f 6173 6973 3d54 7275 652c  with_oasis=True,
+00011b00: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+00011b10: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
+00011b20: 0a0a 2020 2020 6465 6620 7772 6974 655f  ..    def write_
+00011b30: 6764 735f 7769 7468 5f6d 6574 6164 6174  gds_with_metadat
+00011b40: 6128 7365 6c66 2c20 2a61 7267 732c 202a  a(self, *args, *
+00011b50: 2a6b 7761 7267 7329 202d 3e20 5061 7468  *kwargs) -> Path
+00011b60: 3a0a 2020 2020 2020 2020 2222 2257 7269  :.        """Wri
+00011b70: 7465 2063 6f6d 706f 6e65 6e74 2069 6e20  te component in 
+00011b80: 4744 5320 616e 6420 6d65 7461 6461 7461  GDS and metadata
+00011b90: 2028 636f 6d70 6f6e 656e 7420 7365 7474   (component sett
+00011ba0: 696e 6773 2920 696e 2059 414d 4c2e 2222  ings) in YAML.""
+00011bb0: 220a 2020 2020 2020 2020 7761 726e 696e  ".        warnin
+00011bc0: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+00011bd0: 2020 2020 2022 436f 6d70 6f6e 656e 742e       "Component.
+00011be0: 7772 6974 655f 6764 735f 7769 7468 5f6d  write_gds_with_m
+00011bf0: 6574 6164 6174 6128 2920 6973 2064 6570  etadata() is dep
+00011c00: 7265 6361 7465 642e 2022 0a20 2020 2020  recated. ".     
+00011c10: 2020 2020 2020 2022 5573 6520 436f 6d70         "Use Comp
+00011c20: 6f6e 656e 742e 7772 6974 655f 6764 7328  onent.write_gds(
+00011c30: 7769 7468 5f6d 6574 6164 6174 613d 5472  with_metadata=Tr
+00011c40: 7565 2920 6f72 2043 6f6d 706f 6e65 6e74  ue) or Component
+00011c50: 2e77 7269 7465 5f6f 6173 2877 6974 685f  .write_oas(with_
+00011c60: 6d65 7461 6461 7461 3d54 7275 6529 2e22  metadata=True)."
+00011c70: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+00011c80: 6163 6b6c 6576 656c 3d33 2c0a 2020 2020  acklevel=3,.    
+00011c90: 2020 2020 290a 2020 2020 2020 2020 6764      ).        gd
+00011ca0: 7370 6174 6820 3d20 7365 6c66 2e77 7269  spath = self.wri
+00011cb0: 7465 5f67 6473 282a 6172 6773 2c20 2a2a  te_gds(*args, **
+00011cc0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00011cd0: 6d65 7461 6461 7461 203d 2067 6473 7061  metadata = gdspa
+00011ce0: 7468 2e77 6974 685f 7375 6666 6978 2822  th.with_suffix("
+00011cf0: 2e79 6d6c 2229 0a20 2020 2020 2020 206d  .yml").        m
+00011d00: 6574 6164 6174 612e 7772 6974 655f 7465  etadata.write_te
+00011d10: 7874 2873 656c 662e 746f 5f79 616d 6c28  xt(self.to_yaml(
+00011d20: 7769 7468 5f63 656c 6c73 3d54 7275 652c  with_cells=True,
+00011d30: 2077 6974 685f 706f 7274 733d 5472 7565   with_ports=True
+00011d40: 2929 0a20 2020 2020 2020 206c 6f67 6765  )).        logge
+00011d50: 722e 696e 666f 2866 2257 7269 7465 2059  r.info(f"Write Y
+00011d60: 414d 4c20 6d65 7461 6461 7461 2074 6f20  AML metadata to 
+00011d70: 7b73 7472 286d 6574 6164 6174 6129 2172  {str(metadata)!r
+00011d80: 7d22 290a 2020 2020 2020 2020 7265 7475  }").        retu
+00011d90: 726e 2067 6473 7061 7468 0a0a 2020 2020  rn gdspath..    
+00011da0: 6465 6620 746f 5f64 6963 7428 0a20 2020  def to_dict(.   
+00011db0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00011dc0: 2020 2069 676e 6f72 655f 636f 6d70 6f6e     ignore_compon
+00011dd0: 656e 7473 5f70 7265 6669 783a 206c 6973  ents_prefix: lis
+00011de0: 745b 7374 725d 207c 204e 6f6e 6520 3d20  t[str] | None = 
+00011df0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6967  None,.        ig
+00011e00: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
+00011e10: 7265 6669 783a 206c 6973 745b 7374 725d  refix: list[str]
+00011e20: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00011e30: 2020 2020 2020 2020 7769 7468 5f63 656c          with_cel
+00011e40: 6c73 3a20 626f 6f6c 203d 2046 616c 7365  ls: bool = False
+00011e50: 2c0a 2020 2020 2020 2020 7769 7468 5f70  ,.        with_p
+00011e60: 6f72 7473 3a20 626f 6f6c 203d 2054 7275  orts: bool = Tru
+00011e70: 652c 0a20 2020 2029 202d 3e20 6469 6374  e,.    ) -> dict
+00011e80: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
+00011e90: 2020 2020 2222 2252 6574 7572 6e73 2044      """Returns D
+00011ea0: 6963 7420 7265 7072 6573 656e 7461 7469  ict representati
+00011eb0: 6f6e 206f 6620 6120 636f 6d70 6f6e 656e  on of a componen
+00011ec0: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+00011ed0: 3a0a 2020 2020 2020 2020 2020 2020 6967  :.            ig
+00011ee0: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
+00011ef0: 7072 6566 6978 3a20 666f 7220 636f 6d70  prefix: for comp
+00011f00: 6f6e 656e 7473 2074 6f20 6967 6e6f 7265  onents to ignore
+00011f10: 2077 6865 6e20 6578 706f 7274 696e 672e   when exporting.
+00011f20: 0a20 2020 2020 2020 2020 2020 2069 676e  .            ign
+00011f30: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+00011f40: 6566 6978 3a20 666f 7220 6675 6e63 7469  efix: for functi
+00011f50: 6f6e 7320 746f 2069 676e 6f72 6520 7768  ons to ignore wh
+00011f60: 656e 2065 7870 6f72 7469 6e67 2e0a 2020  en exporting..  
+00011f70: 2020 2020 2020 2020 2020 7769 7468 5f63            with_c
+00011f80: 656c 6c73 3a20 7772 6974 6520 6365 6c6c  ells: write cell
+00011f90: 7320 7265 6375 7273 6976 656c 792e 0a20  s recursively.. 
+00011fa0: 2020 2020 2020 2020 2020 2077 6974 685f             with_
+00011fb0: 706f 7274 733a 2077 7269 7465 2070 6f72  ports: write por
+00011fc0: 7420 696e 666f 726d 6174 696f 6e20 6469  t information di
+00011fd0: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+00011fe0: 2020 2020 2020 2020 6420 3d20 7b7d 0a20          d = {}. 
+00011ff0: 2020 2020 2020 2069 6620 7769 7468 5f70         if with_p
+00012000: 6f72 7473 3a0a 2020 2020 2020 2020 2020  orts:.          
+00012010: 2020 706f 7274 7320 3d20 7b70 6f72 742e    ports = {port.
+00012020: 6e61 6d65 3a20 706f 7274 2e74 6f5f 6469  name: port.to_di
+00012030: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
+00012040: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
+00012050: 6c69 7374 2829 7d0a 2020 2020 2020 2020  list()}.        
+00012060: 2020 2020 645b 2270 6f72 7473 225d 203d      d["ports"] =
+00012070: 2070 6f72 7473 0a0a 2020 2020 2020 2020   ports..        
+00012080: 6966 2077 6974 685f 6365 6c6c 733a 0a20  if with_cells:. 
+00012090: 2020 2020 2020 2020 2020 2063 656c 6c73             cells
+000120a0: 203d 2072 6563 7572 7365 5f73 7472 7563   = recurse_struc
+000120b0: 7475 7265 7328 0a20 2020 2020 2020 2020  tures(.         
+000120c0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+000120d0: 2020 2020 2020 2020 2020 2020 2069 676e               ign
+000120e0: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+000120f0: 6566 6978 3d69 676e 6f72 655f 6675 6e63  efix=ignore_func
+00012100: 7469 6f6e 735f 7072 6566 6978 2c0a 2020  tions_prefix,.  
+00012110: 2020 2020 2020 2020 2020 2020 2020 6967                ig
+00012120: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
+00012130: 7072 6566 6978 3d69 676e 6f72 655f 636f  prefix=ignore_co
+00012140: 6d70 6f6e 656e 7473 5f70 7265 6669 782c  mponents_prefix,
+00012150: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00012160: 2020 2020 2020 2020 2020 2064 5b22 6365             d["ce
+00012170: 6c6c 7322 5d20 3d20 636c 6561 6e5f 6469  lls"] = clean_di
+00012180: 6374 2863 656c 6c73 290a 0a20 2020 2020  ct(cells)..     
+00012190: 2020 2064 5b22 6e61 6d65 225d 203d 2073     d["name"] = s
+000121a0: 656c 662e 6e61 6d65 0a20 2020 2020 2020  elf.name.       
+000121b0: 2064 5b22 7365 7474 696e 6773 225d 203d   d["settings"] =
+000121c0: 2063 6c65 616e 5f64 6963 7428 6469 6374   clean_dict(dict
+000121d0: 2873 656c 662e 7365 7474 696e 6773 2929  (self.settings))
+000121e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000121f0: 640a 0a20 2020 2064 6566 2074 6f5f 7961  d..    def to_ya
+00012200: 6d6c 2873 656c 662c 202a 2a6b 7761 7267  ml(self, **kwarg
+00012210: 7329 202d 3e20 7374 723a 0a20 2020 2020  s) -> str:.     
+00012220: 2020 2022 2222 5772 6974 6520 4469 6374     """Write Dict
+00012230: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+00012240: 6f66 2061 2063 6f6d 706f 6e65 6e74 2069  of a component i
+00012250: 6e20 5941 4d4c 2066 6f72 6d61 742e 0a0a  n YAML format...
+00012260: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00012270: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
+00012280: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
+00012290: 6978 3a20 666f 7220 636f 6d70 6f6e 656e  ix: for componen
+000122a0: 7473 2074 6f20 6967 6e6f 7265 2077 6865  ts to ignore whe
+000122b0: 6e20 6578 706f 7274 696e 672e 0a20 2020  n exporting..   
+000122c0: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
+000122d0: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
+000122e0: 3a20 666f 7220 6675 6e63 7469 6f6e 7320  : for functions 
+000122f0: 746f 2069 676e 6f72 6520 7768 656e 2065  to ignore when e
+00012300: 7870 6f72 7469 6e67 2e0a 2020 2020 2020  xporting..      
+00012310: 2020 2020 2020 7769 7468 5f63 656c 6c73        with_cells
+00012320: 3a20 7772 6974 6520 6365 6c6c 7320 7265  : write cells re
+00012330: 6375 7273 6976 656c 792e 0a20 2020 2020  cursively..     
+00012340: 2020 2020 2020 2077 6974 685f 706f 7274         with_port
+00012350: 733a 2077 7269 7465 2070 6f72 7420 696e  s: write port in
+00012360: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
+00012370: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00012380: 6574 7572 6e20 7961 6d6c 2e64 756d 7028  eturn yaml.dump(
+00012390: 636c 6561 6e5f 6469 6374 2873 656c 662e  clean_dict(self.
+000123a0: 746f 5f64 6963 7428 2a2a 6b77 6172 6773  to_dict(**kwargs
+000123b0: 2929 290a 0a20 2020 2064 6566 2061 7574  )))..    def aut
+000123c0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 2873  o_rename_ports(s
+000123d0: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
+000123e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000123f0: 2222 2252 656e 616d 6520 706f 7274 7320  """Rename ports 
+00012400: 6279 206f 7269 656e 7461 7469 6f6e 204e  by orientation N
+00012410: 5345 5720 286e 6f72 7468 2c20 736f 7574  SEW (north, sout
+00012420: 682c 2065 6173 742c 2077 6573 7429 2e0a  h, east, west)..
+00012430: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+00012440: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00012450: 2020 2066 756e 6374 696f 6e3a 2074 6f20     function: to 
+00012460: 7265 6e61 6d65 2070 6f72 7473 2e0a 2020  rename ports..  
+00012470: 2020 2020 2020 2020 2020 7365 6c65 6374            select
+00012480: 5f70 6f72 7473 5f6f 7074 6963 616c 3a20  _ports_optical: 
+00012490: 746f 2073 656c 6563 7420 6f70 7469 6361  to select optica
+000124a0: 6c20 706f 7274 732e 0a20 2020 2020 2020  l ports..       
+000124b0: 2020 2020 2073 656c 6563 745f 706f 7274       select_port
+000124c0: 735f 656c 6563 7472 6963 616c 3a20 746f  s_electrical: to
+000124d0: 2073 656c 6563 7420 656c 6563 7472 6963   select electric
+000124e0: 616c 2070 6f72 7473 2e0a 2020 2020 2020  al ports..      
+000124f0: 2020 2020 2020 7072 6566 6978 5f6f 7074        prefix_opt
+00012500: 6963 616c 3a20 7072 6566 6978 2e0a 2020  ical: prefix..  
+00012510: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00012520: 5f65 6c65 6374 7269 6361 6c3a 2070 7265  _electrical: pre
+00012530: 6669 782e 0a0a 2020 2020 2020 2020 2e2e  fix...        ..
+00012540: 2063 6f64 653a 3a0a 0a20 2020 2020 2020   code::..       
+00012550: 2020 2020 2020 2020 2020 2033 2020 340a             3  4.
+00012560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012570: 205f 7c5f 5f7c 5f0a 2020 2020 2020 2020   _|__|_.        
+00012580: 2020 2020 2032 202d 7c20 2020 2020 207c       2 -|      |
+00012590: 2d20 350a 2020 2020 2020 2020 2020 2020  - 5.            
+000125a0: 2020 2020 7c20 2020 2020 207c 0a20 2020      |      |.   
+000125b0: 2020 2020 2020 2020 2020 3120 2d7c 5f5f            1 -|__
+000125c0: 5f5f 5f5f 7c2d 2036 0a20 2020 2020 2020  ____|- 6.       
+000125d0: 2020 2020 2020 2020 2020 207c 2020 7c0a             |  |.
+000125e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125f0: 2020 3820 2037 0a20 2020 2020 2020 2022    8  7.        "
+00012600: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+00012610: 6973 5f75 6e6c 6f63 6b65 6428 290a 2020  is_unlocked().  
+00012620: 2020 2020 2020 6175 746f 5f72 656e 616d        auto_renam
+00012630: 655f 706f 7274 7328 7365 6c66 2c20 2a2a  e_ports(self, **
+00012640: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
+00012650: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
+00012660: 7473 5f63 6f75 6e74 6572 5f63 6c6f 636b  ts_counter_clock
+00012670: 7769 7365 2873 656c 662c 202a 2a6b 7761  wise(self, **kwa
+00012680: 7267 7329 202d 3e20 4e6f 6e65 3a0a 2020  rgs) -> None:.  
+00012690: 2020 2020 2020 7365 6c66 2e69 735f 756e        self.is_un
+000126a0: 6c6f 636b 6564 2829 0a20 2020 2020 2020  locked().       
+000126b0: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
+000126c0: 7473 5f63 6f75 6e74 6572 5f63 6c6f 636b  ts_counter_clock
+000126d0: 7769 7365 2873 656c 662c 202a 2a6b 7761  wise(self, **kwa
+000126e0: 7267 7329 0a0a 2020 2020 6465 6620 6175  rgs)..    def au
+000126f0: 746f 5f72 656e 616d 655f 706f 7274 735f  to_rename_ports_
+00012700: 6c61 7965 725f 6f72 6965 6e74 6174 696f  layer_orientatio
+00012710: 6e28 7365 6c66 2c20 2a2a 6b77 6172 6773  n(self, **kwargs
+00012720: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00012730: 2020 2073 656c 662e 6973 5f75 6e6c 6f63     self.is_unloc
+00012740: 6b65 6428 290a 2020 2020 2020 2020 6175  ked().        au
+00012750: 746f 5f72 656e 616d 655f 706f 7274 735f  to_rename_ports_
+00012760: 6c61 7965 725f 6f72 6965 6e74 6174 696f  layer_orientatio
+00012770: 6e28 7365 6c66 2c20 2a2a 6b77 6172 6773  n(self, **kwargs
+00012780: 290a 0a20 2020 2064 6566 2061 7574 6f5f  )..    def auto_
+00012790: 7265 6e61 6d65 5f70 6f72 7473 5f6f 7269  rename_ports_ori
+000127a0: 656e 7461 7469 6f6e 2873 656c 662c 202a  entation(self, *
+000127b0: 2a6b 7761 7267 7329 202d 3e20 4e6f 6e65  *kwargs) -> None
+000127c0: 3a0a 2020 2020 2020 2020 2222 2252 656e  :.        """Ren
+000127d0: 616d 6520 706f 7274 7320 6279 206f 7269  ame ports by ori
+000127e0: 656e 7461 7469 6f6e 204e 5345 5720 286e  entation NSEW (n
+000127f0: 6f72 7468 2c20 736f 7574 682c 2065 6173  orth, south, eas
+00012800: 742c 2077 6573 7429 2e0a 0a20 2020 2020  t, west)...     
+00012810: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
+00012820: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
+00012830: 6374 696f 6e3a 2074 6f20 7265 6e61 6d65  ction: to rename
+00012840: 2070 6f72 7473 2e0a 2020 2020 2020 2020   ports..        
+00012850: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
+00012860: 5f6f 7074 6963 616c 3a20 746f 2073 656c  _optical: to sel
+00012870: 6563 7420 706f 7274 732e 0a20 2020 2020  ect ports..     
+00012880: 2020 2020 2020 2073 656c 6563 745f 706f         select_po
+00012890: 7274 735f 656c 6563 7472 6963 616c 3a0a  rts_electrical:.
+000128a0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+000128b0: 6978 5f6f 7074 6963 616c 3a0a 2020 2020  ix_optical:.    
+000128c0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+000128d0: 6c65 6374 7269 6361 6c3a 0a0a 2020 2020  lectrical:..    
+000128e0: 2020 2020 2e2e 2063 6f64 653a 3a0a 0a20      .. code::.. 
+000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012900: 4e30 2020 4e31 0a20 2020 2020 2020 2020  N0  N1.         
+00012910: 2020 2020 2020 2020 7c5f 5f5f 7c5f 0a20          |___|_. 
+00012920: 2020 2020 2020 2020 2020 2057 3120 2d7c             W1 -|
+00012930: 2020 2020 2020 7c2d 2045 310a 2020 2020        |- E1.    
+00012940: 2020 2020 2020 2020 2020 2020 7c20 2020              |   
+00012950: 2020 207c 0a20 2020 2020 2020 2020 2020     |.           
+00012960: 2057 3020 2d7c 5f5f 5f5f 5f5f 7c2d 2045   W0 -|______|- E
+00012970: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+00012980: 2020 207c 2020 207c 0a20 2020 2020 2020     |   |.       
+00012990: 2020 2020 2020 2020 2053 3020 2020 5331           S0   S1
+000129a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000129b0: 2020 2020 2073 656c 662e 6973 5f75 6e6c       self.is_unl
+000129c0: 6f63 6b65 6428 290a 2020 2020 2020 2020  ocked().        
+000129d0: 6175 746f 5f72 656e 616d 655f 706f 7274  auto_rename_port
+000129e0: 735f 6f72 6965 6e74 6174 696f 6e28 7365  s_orientation(se
+000129f0: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
+00012a00: 2020 2064 6566 206d 6f76 6528 0a20 2020     def move(.   
+00012a10: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00012a20: 2020 206f 7269 6769 6e3a 2046 6c6f 6174     origin: Float
+00012a30: 3220 3d20 2830 2c20 3029 2c0a 2020 2020  2 = (0, 0),.    
+00012a40: 2020 2020 6465 7374 696e 6174 696f 6e3a      destination:
+00012a50: 2046 6c6f 6174 3220 7c20 4e6f 6e65 203d   Float2 | None =
+00012a60: 204e 6f6e 652c 0a20 2020 2020 2020 2061   None,.        a
+00012a70: 7869 733a 2041 7869 7320 7c20 4e6f 6e65  xis: Axis | None
+00012a80: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+00012a90: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+00012aa0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00012ab0: 6e65 7720 436f 6d70 6f6e 656e 7420 7769  new Component wi
+00012ac0: 7468 2061 206d 6f76 6564 2072 6566 6572  th a moved refer
+00012ad0: 656e 6365 2074 6f20 7468 6520 6f72 6967  ence to the orig
+00012ae0: 696e 616c 2e0a 0a20 2020 2020 2020 2063  inal...        c
+00012af0: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
+00012b00: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00012b10: 2020 2020 206f 7269 6769 6e3a 206f 6620       origin: of 
+00012b20: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
+00012b30: 2020 2020 2020 2064 6573 7469 6e61 7469         destinati
+00012b40: 6f6e 3a20 782c 2079 2e0a 2020 2020 2020  on: x, y..      
+00012b50: 2020 2020 2020 6178 6973 3a20 7820 6f72        axis: x or
+00012b60: 2079 2e0a 2020 2020 2020 2020 2222 220a   y..        """.
+00012b70: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00012b80: 6c75 6545 7272 6f72 286d 6f76 655f 6572  lueError(move_er
+00012b90: 726f 725f 6d65 7373 6167 6529 0a0a 2020  ror_message)..  
+00012ba0: 2020 6465 6620 6d69 7272 6f72 2873 656c    def mirror(sel
+00012bb0: 662c 2070 313a 2046 6c6f 6174 3220 3d20  f, p1: Float2 = 
+00012bc0: 2830 2c20 3129 2c20 7032 3a20 466c 6f61  (0, 1), p2: Floa
+00012bd0: 7432 203d 2028 302c 2030 292c 202a 2a6b  t2 = (0, 0), **k
+00012be0: 7761 7267 7329 202d 3e20 436f 6d70 6f6e  wargs) -> Compon
+00012bf0: 656e 743a 0a20 2020 2020 2020 2022 2222  ent:.        """
+00012c00: 5265 7475 726e 7320 6e65 7720 436f 6d70  Returns new Comp
+00012c10: 6f6e 656e 7420 7769 7468 2061 206d 6972  onent with a mir
+00012c20: 726f 7265 6420 7265 6665 7265 6e63 652e  rored reference.
+00012c30: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00012c40: 2020 2020 2020 2020 2020 2020 7031 3a20              p1: 
+00012c50: 6669 7273 7420 706f 696e 7420 746f 2064  first point to d
+00012c60: 6566 696e 6520 6d69 7272 6f72 2061 7869  efine mirror axi
+00012c70: 732e 0a20 2020 2020 2020 2020 2020 2070  s..            p
+00012c80: 323a 2073 6563 6f6e 6420 706f 696e 7420  2: second point 
+00012c90: 746f 2064 6566 696e 6520 6d69 7272 6f72  to define mirror
+00012ca0: 2061 7869 732e 0a20 2020 2020 2020 2022   axis..        "
+00012cb0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00012cc0: 6764 7366 6163 746f 7279 2e66 756e 6374  gdsfactory.funct
+00012cd0: 696f 6e73 2069 6d70 6f72 7420 6d69 7272  ions import mirr
+00012ce0: 6f72 0a0a 2020 2020 2020 2020 7265 7475  or..        retu
+00012cf0: 726e 206d 6972 726f 7228 636f 6d70 6f6e  rn mirror(compon
+00012d00: 656e 743d 7365 6c66 2c20 7031 3d70 312c  ent=self, p1=p1,
+00012d10: 2070 323d 7032 2c20 2a2a 6b77 6172 6773   p2=p2, **kwargs
+00012d20: 290a 0a20 2020 2064 6566 2072 6f74 6174  )..    def rotat
+00012d30: 6528 7365 6c66 2c20 616e 676c 653a 2066  e(self, angle: f
+00012d40: 6c6f 6174 203d 2039 302c 202a 2a6b 7761  loat = 90, **kwa
+00012d50: 7267 7329 202d 3e20 436f 6d70 6f6e 656e  rgs) -> Componen
+00012d60: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
+00012d70: 7475 726e 7320 6e65 7720 636f 6d70 6f6e  turns new compon
+00012d80: 656e 7420 7769 7468 2061 2072 6f74 6174  ent with a rotat
+00012d90: 6564 2072 6566 6572 656e 6365 2074 6f20  ed reference to 
+00012da0: 7468 6520 6f72 6967 696e 616c 2e0a 0a20  the original... 
+00012db0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00012dc0: 2020 2020 2020 2020 2061 6e67 6c65 3a20           angle: 
+00012dd0: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
+00012de0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00012df0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00012e00: 6675 6e63 7469 6f6e 7320 696d 706f 7274  functions import
+00012e10: 2072 6f74 6174 650a 0a20 2020 2020 2020   rotate..       
+00012e20: 2072 6574 7572 6e20 726f 7461 7465 2863   return rotate(c
+00012e30: 6f6d 706f 6e65 6e74 3d73 656c 662c 2061  omponent=self, a
+00012e40: 6e67 6c65 3d61 6e67 6c65 2c20 2a2a 6b77  ngle=angle, **kw
+00012e50: 6172 6773 290a 0a20 2020 2064 6566 2061  args)..    def a
+00012e60: 6464 5f70 6164 6469 6e67 2873 656c 662c  dd_padding(self,
+00012e70: 202a 2a6b 7761 7267 7329 202d 3e20 436f   **kwargs) -> Co
+00012e80: 6d70 6f6e 656e 743a 0a20 2020 2020 2020  mponent:.       
+00012e90: 2022 2222 5265 7475 726e 7320 7361 6d65   """Returns same
+00012ea0: 2063 6f6d 706f 6e65 6e74 2077 6974 6820   component with 
+00012eb0: 7061 6464 696e 672e 0a0a 2020 2020 2020  padding...      
+00012ec0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+00012ed0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00012ee0: 6f6e 656e 743a 2066 6f72 2070 6164 6469  onent: for paddi
+00012ef0: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
+00012f00: 6c61 7965 7273 3a20 6c69 7374 206f 6620  layers: list of 
+00012f10: 6c61 7965 7273 2e0a 2020 2020 2020 2020  layers..        
+00012f20: 2020 2020 7375 6666 6978 2066 6f72 206e      suffix for n
+00012f30: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+00012f40: 2064 6566 6175 6c74 3a20 6465 6661 756c   default: defaul
+00012f50: 7420 7061 6464 696e 6720 2835 3075 6d29  t padding (50um)
+00012f60: 2e0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+00012f70: 703a 206e 6f72 7468 2070 6164 6469 6e67  p: north padding
+00012f80: 2e0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
+00012f90: 7474 6f6d 3a20 736f 7574 6820 7061 6464  ttom: south padd
+00012fa0: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+00012fb0: 2072 6967 6874 3a20 6561 7374 2070 6164   right: east pad
+00012fc0: 6469 6e67 2e0a 2020 2020 2020 2020 2020  ding..          
+00012fd0: 2020 6c65 6674 3a20 7765 7374 2070 6164    left: west pad
+00012fe0: 6469 6e67 2e0a 2020 2020 2020 2020 2222  ding..        ""
+00012ff0: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+00013000: 6473 6661 6374 6f72 792e 6164 645f 7061  dsfactory.add_pa
+00013010: 6464 696e 6720 696d 706f 7274 2061 6464  dding import add
+00013020: 5f70 6164 6469 6e67 0a0a 2020 2020 2020  _padding..      
+00013030: 2020 7265 7475 726e 2061 6464 5f70 6164    return add_pad
+00013040: 6469 6e67 2863 6f6d 706f 6e65 6e74 3d73  ding(component=s
+00013050: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
+00013060: 2020 2020 6465 6620 6162 736f 7262 2873      def absorb(s
+00013070: 656c 662c 2072 6566 6572 656e 6365 2920  elf, reference) 
+00013080: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+00013090: 2020 2020 2020 2222 2241 6273 6f72 6273        """Absorbs
+000130a0: 2070 6f6c 7967 6f6e 7320 6672 6f6d 2043   polygons from C
+000130b0: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+000130c0: 6520 696e 746f 2043 6f6d 706f 6e65 6e74  e into Component
+000130d0: 2e0a 0a20 2020 2020 2020 2044 6573 7472  ...        Destr
+000130e0: 6f79 7320 7468 6520 7265 6665 7265 6e63  oys the referenc
+000130f0: 6520 696e 2074 6865 2070 726f 6365 7373  e in the process
+00013100: 2062 7574 206b 6565 7069 6e67 2074 6865   but keeping the
+00013110: 2070 6f6c 7967 6f6e 2067 656f 6d65 7472   polygon geometr
+00013120: 792e 0a0a 2020 2020 2020 2020 4172 6773  y...        Args
+00013130: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00013140: 6665 7265 6e63 653a 2043 6f6d 706f 6e65  ference: Compone
+00013150: 6e74 5265 6665 7265 6e63 6520 746f 2062  ntReference to b
+00013160: 6520 6162 736f 7262 6564 2069 6e74 6f20  e absorbed into 
+00013170: 7468 6520 436f 6d70 6f6e 656e 742e 0a20  the Component.. 
+00013180: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013190: 2020 2069 6620 7265 6665 7265 6e63 6520     if reference 
+000131a0: 6e6f 7420 696e 2073 656c 662e 7265 6665  not in self.refe
+000131b0: 7265 6e63 6573 3a0a 2020 2020 2020 2020  rences:.        
+000131c0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000131d0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+000131e0: 2020 2020 2020 2254 6865 2072 6566 6572        "The refer
+000131f0: 656e 6365 2079 6f75 2061 736b 6564 2074  ence you asked t
+00013200: 6f20 6162 736f 7262 2064 6f65 7320 6e6f  o absorb does no
+00013210: 7420 6578 6973 7420 696e 2074 6869 7320  t exist in this 
+00013220: 436f 6d70 6f6e 656e 742e 220a 2020 2020  Component.".    
+00013230: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00013240: 2020 7265 665f 706f 6c79 676f 6e73 203d    ref_polygons =
+00013250: 2072 6566 6572 656e 6365 2e67 6574 5f70   reference.get_p
+00013260: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
+00013270: 2020 2020 2062 795f 7370 6563 3d46 616c       by_spec=Fal
+00013280: 7365 2c20 696e 636c 7564 655f 7061 7468  se, include_path
+00013290: 733d 4661 6c73 652c 2061 735f 6172 7261  s=False, as_arra
+000132a0: 793d 4661 6c73 650a 2020 2020 2020 2020  y=False.        
+000132b0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+000132c0: 6164 645f 706f 6c79 676f 6e73 282a 7265  add_polygons(*re
+000132d0: 665f 706f 6c79 676f 6e73 290a 0a20 2020  f_polygons)..   
+000132e0: 2020 2020 2073 656c 662e 6164 6428 7265       self.add(re
+000132f0: 6665 7265 6e63 652e 6765 745f 6c61 6265  ference.get_labe
+00013300: 6c73 2829 290a 2020 2020 2020 2020 7365  ls()).        se
+00013310: 6c66 2e61 6464 2872 6566 6572 656e 6365  lf.add(reference
+00013320: 2e67 6574 5f70 6174 6873 2829 290a 2020  .get_paths()).  
+00013330: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+00013340: 6528 7265 6665 7265 6e63 6529 0a20 2020  e(reference).   
+00013350: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013360: 0a0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
+00013370: 2873 656c 662c 2069 7465 6d73 293a 0a20  (self, items):. 
+00013380: 2020 2020 2020 2022 2222 5265 6d6f 7665         """Remove
+00013390: 7320 6974 656d 7320 6672 6f6d 2061 2043  s items from a C
+000133a0: 6f6d 706f 6e65 6e74 2c20 7768 6963 6820  omponent, which 
+000133b0: 6361 6e20 696e 636c 7564 6520 506f 7274  can include Port
+000133c0: 732c 2050 6f6c 7967 6f6e 5365 7473 205c  s, PolygonSets \
+000133d0: 0a20 2020 2020 2020 2043 656c 6c52 6566  .        CellRef
+000133e0: 6572 656e 6365 732c 2043 6f6d 706f 6e65  erences, Compone
+000133f0: 6e74 5265 6665 7265 6e63 6573 2061 6e64  ntReferences and
+00013400: 204c 6162 656c 732e 0a0a 2020 2020 2020   Labels...      
+00013410: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+00013420: 2020 2020 6974 656d 733a 206c 6973 7420      items: list 
+00013430: 6f66 2049 7465 6d73 2074 6f20 6265 2072  of Items to be r
+00013440: 656d 6f76 6564 2066 726f 6d20 7468 6520  emoved from the 
+00013450: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
+00013460: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00013470: 6620 6e6f 7420 6861 7361 7474 7228 6974  f not hasattr(it
+00013480: 656d 732c 2022 5f5f 6974 6572 5f5f 2229  ems, "__iter__")
+00013490: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
+000134a0: 656d 7320 3d20 5b69 7465 6d73 5d0a 2020  ems = [items].  
+000134b0: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+000134c0: 6e20 6974 656d 733a 0a20 2020 2020 2020  n items:.       
+000134d0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+000134e0: 6365 2869 7465 6d2c 2050 6f72 7429 3a0a  ce(item, Port):.
+000134f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013500: 7365 6c66 2e70 6f72 7473 203d 207b 6b3a  self.ports = {k:
+00013510: 2076 2066 6f72 206b 2c20 7620 696e 2073   v for k, v in s
+00013520: 656c 662e 706f 7274 732e 6974 656d 7328  elf.ports.items(
+00013530: 2920 6966 2076 2021 3d20 6974 656d 7d0a  ) if v != item}.
+00013540: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00013550: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+00013560: 2c20 6764 7374 6b2e 5265 6665 7265 6e63  , gdstk.Referenc
+00013570: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00013580: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e72      self._cell.r
+00013590: 656d 6f76 6528 6974 656d 290a 2020 2020  emove(item).    
+000135a0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+000135b0: 2e6f 776e 6572 203d 204e 6f6e 650a 2020  .owner = None.  
+000135c0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+000135d0: 7369 6e73 7461 6e63 6528 6974 656d 2c20  sinstance(item, 
+000135e0: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
+000135f0: 6365 293a 0a20 2020 2020 2020 2020 2020  ce):.           
+00013600: 2020 2020 2073 656c 662e 7265 6665 7265       self.refere
+00013610: 6e63 6573 2e72 656d 6f76 6528 6974 656d  nces.remove(item
+00013620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013630: 2020 7365 6c66 2e5f 6365 6c6c 2e72 656d    self._cell.rem
+00013640: 6f76 6528 6974 656d 2e5f 7265 6665 7265  ove(item._refere
+00013650: 6e63 6529 0a20 2020 2020 2020 2020 2020  nce).           
+00013660: 2020 2020 2069 7465 6d2e 6f77 6e65 7220       item.owner 
+00013670: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+00013680: 2020 2020 2020 2073 656c 662e 5f6e 616d         self._nam
+00013690: 6564 5f72 6566 6572 656e 6365 732e 706f  ed_references.po
+000136a0: 7028 6974 656d 2e6e 616d 6529 0a20 2020  p(item.name).   
+000136b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000136c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000136d0: 656c 662e 5f63 656c 6c2e 7265 6d6f 7665  elf._cell.remove
+000136e0: 2869 7465 6d29 0a0a 2020 2020 2020 2020  (item)..        
+000136f0: 7365 6c66 2e5f 6262 5f76 616c 6964 203d  self._bb_valid =
+00013700: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
+00013710: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
+00013720: 6465 6620 6861 7368 5f67 656f 6d65 7472  def hash_geometr
+00013730: 7928 7365 6c66 2c20 7072 6563 6973 696f  y(self, precisio
+00013740: 6e3a 2066 6c6f 6174 203d 2031 652d 3429  n: float = 1e-4)
+00013750: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+00013760: 2022 2222 5265 7475 726e 7320 616e 2053   """Returns an S
+00013770: 4841 3120 6861 7368 206f 6620 7468 6520  HA1 hash of the 
+00013780: 6765 6f6d 6574 7279 2069 6e20 7468 6520  geometry in the 
+00013790: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+000137a0: 2020 2020 466f 7220 6561 6368 206c 6179      For each lay
+000137b0: 6572 2c20 6561 6368 2070 6f6c 7967 6f6e  er, each polygon
+000137c0: 2069 7320 696e 6469 7669 6475 616c 6c79   is individually
+000137d0: 2068 6173 6865 6420 616e 6420 7468 656e   hashed and then
+000137e0: 2074 6865 2070 6f6c 7967 6f6e 2068 6173   the polygon has
+000137f0: 6865 730a 2020 2020 2020 2020 6172 6520  hes.        are 
+00013800: 736f 7274 6564 2c20 746f 2065 6e73 7572  sorted, to ensur
+00013810: 6520 7468 6520 6861 7368 2073 7461 7973  e the hash stays
+00013820: 2063 6f6e 7374 616e 7420 7265 6761 7264   constant regard
+00013830: 6c65 7373 206f 6620 7468 6520 6f72 6465  less of the orde
+00013840: 7269 6e67 0a20 2020 2020 2020 2074 6865  ring.        the
+00013850: 2070 6f6c 7967 6f6e 732e 2020 5369 6d69   polygons.  Simi
+00013860: 6c61 726c 792c 2074 6865 206c 6179 6572  larly, the layer
+00013870: 7320 6172 6520 736f 7274 6564 2062 7920  s are sorted by 
+00013880: 286c 6179 6572 2c20 6461 7461 7479 7065  (layer, datatype
+00013890: 292e 0a0a 2020 2020 2020 2020 4172 6773  )...        Args
+000138a0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000138b0: 6563 6973 696f 6e3a 2052 6f75 6e64 696e  ecision: Roundin
+000138c0: 6720 7072 6563 6973 696f 6e20 666f 7220  g precision for 
+000138d0: 7468 6520 7468 6520 6f62 6a65 6374 7320  the the objects 
+000138e0: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
+000138f0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013900: 2020 466f 7220 696e 7374 616e 6365 2c20    For instance, 
+00013910: 6120 7072 6563 6973 696f 6e20 6f66 2031  a precision of 1
+00013920: 652d 3220 7769 6c6c 2072 6f75 6e64 2061  e-2 will round a
+00013930: 2070 6f69 6e74 2061 740a 2020 2020 2020   point at.      
+00013940: 2020 2020 2020 2020 2020 2830 2e31 3234            (0.124
+00013950: 2c20 312e 3734 3829 2074 6f20 2830 2e31  , 1.748) to (0.1
+00013960: 322c 2031 2e37 3529 2e0a 0a20 2020 2020  2, 1.75)...     
+00013970: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+00013980: 6f6c 7967 6f6e 735f 6279 5f73 7065 6320  olygons_by_spec 
+00013990: 3d20 7365 6c66 2e67 6574 5f70 6f6c 7967  = self.get_polyg
+000139a0: 6f6e 7328 6279 5f73 7065 633d 5472 7565  ons(by_spec=True
+000139b0: 2c20 6173 5f61 7272 6179 3d46 616c 7365  , as_array=False
+000139c0: 290a 2020 2020 2020 2020 6c61 7965 7273  ).        layers
+000139d0: 203d 206e 702e 6172 7261 7928 6c69 7374   = np.array(list
+000139e0: 2870 6f6c 7967 6f6e 735f 6279 5f73 7065  (polygons_by_spe
+000139f0: 632e 6b65 7973 2829 2929 0a20 2020 2020  c.keys())).     
+00013a00: 2020 2073 6f72 7465 645f 6c61 7965 7273     sorted_layers
+00013a10: 203d 206c 6179 6572 735b 6e70 2e6c 6578   = layers[np.lex
+00013a20: 736f 7274 2828 6c61 7965 7273 5b3a 2c20  sort((layers[:, 
+00013a30: 305d 2c20 6c61 7965 7273 5b3a 2c20 315d  0], layers[:, 1]
+00013a40: 2929 5d0a 0a20 2020 2020 2020 2066 696e  ))]..        fin
+00013a50: 616c 5f68 6173 6820 3d20 6861 7368 6c69  al_hash = hashli
+00013a60: 622e 7368 6131 2829 0a20 2020 2020 2020  b.sha1().       
+00013a70: 2066 6f72 206c 6179 6572 2069 6e20 736f   for layer in so
+00013a80: 7274 6564 5f6c 6179 6572 733a 0a20 2020  rted_layers:.   
+00013a90: 2020 2020 2020 2020 206c 6179 6572 5f68           layer_h
+00013aa0: 6173 6820 3d20 6861 7368 6c69 622e 7368  ash = hashlib.sh
+00013ab0: 6131 286c 6179 6572 2e61 7374 7970 6528  a1(layer.astype(
+00013ac0: 6e70 2e69 6e74 3634 2929 2e64 6967 6573  np.int64)).diges
+00013ad0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00013ae0: 706f 6c79 676f 6e73 203d 2070 6f6c 7967  polygons = polyg
+00013af0: 6f6e 735f 6279 5f73 7065 635b 7475 706c  ons_by_spec[tupl
+00013b00: 6528 6c61 7965 7229 5d0a 2020 2020 2020  e(layer)].      
+00013b10: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
+00013b20: 205b 5f72 6e64 2870 2e70 6f69 6e74 732c   [_rnd(p.points,
+00013b30: 2070 7265 6369 7369 6f6e 2920 666f 7220   precision) for 
+00013b40: 7020 696e 2070 6f6c 7967 6f6e 735d 0a20  p in polygons]. 
+00013b50: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00013b60: 6f6e 5f68 6173 6865 7320 3d20 6e70 2e73  on_hashes = np.s
+00013b70: 6f72 7428 5b68 6173 686c 6962 2e73 6861  ort([hashlib.sha
+00013b80: 3128 7029 2e64 6967 6573 7428 2920 666f  1(p).digest() fo
+00013b90: 7220 7020 696e 2070 6f6c 7967 6f6e 735d  r p in polygons]
+00013ba0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
+00013bb0: 6e61 6c5f 6861 7368 2e75 7064 6174 6528  nal_hash.update(
+00013bc0: 6c61 7965 725f 6861 7368 290a 2020 2020  layer_hash).    
+00013bd0: 2020 2020 2020 2020 666f 7220 7068 2069          for ph i
+00013be0: 6e20 706f 6c79 676f 6e5f 6861 7368 6573  n polygon_hashes
+00013bf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013c00: 2020 6669 6e61 6c5f 6861 7368 2e75 7064    final_hash.upd
+00013c10: 6174 6528 7068 290a 0a20 2020 2020 2020  ate(ph)..       
+00013c20: 2072 6574 7572 6e20 6669 6e61 6c5f 6861   return final_ha
+00013c30: 7368 2e68 6578 6469 6765 7374 2829 0a0a  sh.hexdigest()..
+00013c40: 2020 2020 6465 6620 6765 745f 6c61 6265      def get_labe
+00013c50: 6c73 280a 2020 2020 2020 2020 7365 6c66  ls(.        self
+00013c60: 2c20 6170 706c 795f 7265 7065 7469 7469  , apply_repetiti
+00013c70: 6f6e 733d 5472 7565 2c20 6465 7074 683a  ons=True, depth:
+00013c80: 2069 6e74 207c 204e 6f6e 6520 3d20 4e6f   int | None = No
+00013c90: 6e65 2c20 6c61 7965 723d 4e6f 6e65 0a20  ne, layer=None. 
+00013ca0: 2020 2029 202d 3e20 6c69 7374 5b4c 6162     ) -> list[Lab
+00013cb0: 656c 5d3a 0a20 2020 2020 2020 2022 2222  el]:.        """
+00013cc0: 5265 7475 726e 206c 6162 656c 732e 0a0a  Return labels...
+00013cd0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00013ce0: 2020 2020 2020 2020 2020 6170 706c 795f            apply_
+00013cf0: 7265 7065 7469 7469 6f6e 733a 2e0a 2020  repetitions:..  
+00013d00: 2020 2020 2020 2020 2020 6465 7074 683a            depth:
+00013d10: 204e 6f6e 6520 7265 7475 726e 7320 616c   None returns al
+00013d20: 6c20 6c61 6265 6c73 2061 6e64 2030 2074  l labels and 0 t
+00013d30: 6f70 206c 6576 656c 2e0a 2020 2020 2020  op level..      
+00013d40: 2020 2020 2020 6c61 7965 723a 206c 6179        layer: lay
+00013d50: 6572 7370 6563 2e0a 2020 2020 2020 2020  erspec..        
+00013d60: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00013d70: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
+00013d80: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+00013d90: 0a0a 2020 2020 2020 2020 6966 206c 6179  ..        if lay
+00013da0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00013db0: 6c61 7965 722c 2074 6578 7474 7970 6520  layer, texttype 
+00013dc0: 3d20 6765 745f 6c61 7965 7228 6c61 7965  = get_layer(laye
+00013dd0: 7229 0a20 2020 2020 2020 2065 6c73 653a  r).        else:
+00013de0: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
+00013df0: 7474 7970 6520 3d20 4e6f 6e65 0a20 2020  ttype = None.   
+00013e00: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013e10: 2e5f 6365 6c6c 2e67 6574 5f6c 6162 656c  ._cell.get_label
+00013e20: 7328 0a20 2020 2020 2020 2020 2020 2061  s(.            a
+00013e30: 7070 6c79 5f72 6570 6574 6974 696f 6e73  pply_repetitions
+00013e40: 3d61 7070 6c79 5f72 6570 6574 6974 696f  =apply_repetitio
+00013e50: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+00013e60: 6465 7074 683d 6465 7074 682c 0a20 2020  depth=depth,.   
+00013e70: 2020 2020 2020 2020 206c 6179 6572 3d6c           layer=l
+00013e80: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
+00013e90: 2020 7465 7874 7479 7065 3d74 6578 7474    texttype=textt
+00013ea0: 7970 652c 0a20 2020 2020 2020 2029 0a0a  ype,.        )..
+00013eb0: 2020 2020 6465 6620 7265 6d6f 7665 5f6c      def remove_l
+00013ec0: 6162 656c 7328 7365 6c66 2920 2d3e 204e  abels(self) -> N
+00013ed0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00013ee0: 5265 6d6f 7665 206c 6162 656c 732e 2222  Remove labels.""
+00013ef0: 220a 2020 2020 2020 2020 7365 6c66 2e5f  ".        self._
+00013f00: 6365 6c6c 2e72 656d 6f76 6528 2a73 656c  cell.remove(*sel
+00013f10: 662e 6c61 6265 6c73 290a 0a20 2020 2023  f.labels)..    #
+00013f20: 2044 6570 7265 6361 7465 640a 2020 2020   Deprecated.    
+00013f30: 6465 6620 6765 745f 696e 666f 2873 656c  def get_info(sel
+00013f40: 6629 3a0a 2020 2020 2020 2020 2222 2247  f):.        """G
+00013f50: 6174 6865 7273 2074 6865 202e 696e 666f  athers the .info
+00013f60: 2064 6963 7469 6f6e 6172 6965 7320 6672   dictionaries fr
+00013f70: 6f6d 2065 7665 7279 2073 7562 2d43 6f6d  om every sub-Com
+00013f80: 706f 6e65 6e74 2061 6e64 2072 6574 7572  ponent and retur
+00013f90: 6e73 2074 6865 6d20 696e 2061 206c 6973  ns them in a lis
+00013fa0: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+00013fb0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+00013fc0: 7074 683a 2069 6e74 206f 7220 4e6f 6e65  pth: int or None
+00013fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013fe0: 2049 6620 6e6f 7420 4e6f 6e65 2c20 6465   If not None, de
+00013ff0: 6669 6e65 7320 6672 6f6d 2068 6f77 206d  fines from how m
+00014000: 616e 7920 7265 6665 7265 6e63 6520 6c65  any reference le
+00014010: 7665 6c73 2074 6f0a 2020 2020 2020 2020  vels to.        
+00014020: 2020 2020 2020 2020 7265 7472 6965 7665          retrieve
+00014030: 2050 6f72 7473 2066 726f 6d2e 0a0a 2020   Ports from...  
+00014040: 2020 2020 2020 5265 7475 726e 733a 0a20        Returns:. 
+00014050: 2020 2020 2020 2020 2020 206c 6973 7420             list 
+00014060: 6f66 2064 6963 7469 6f6e 6172 6965 730a  of dictionaries.
+00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014080: 4c69 7374 206f 6620 7468 6520 222e 696e  List of the ".in
+00014090: 666f 2220 7072 6f70 6572 7479 2064 6963  fo" property dic
+000140a0: 7469 6f6e 6172 6965 7320 6672 6f6d 2061  tionaries from a
+000140b0: 6c6c 2073 7562 2d43 6f6d 706f 6e65 6e74  ll sub-Component
+000140c0: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
+000140d0: 2020 2020 2020 445f 6c69 7374 203d 2073        D_list = s
+000140e0: 656c 662e 6765 745f 6465 7065 6e64 656e  elf.get_dependen
+000140f0: 6369 6573 2872 6563 7572 7369 7665 3d54  cies(recursive=T
+00014100: 7275 6529 0a20 2020 2020 2020 2072 6574  rue).        ret
+00014110: 7572 6e20 5b44 2e69 6e66 6f2e 636f 7079  urn [D.info.copy
+00014120: 2829 2066 6f72 2044 2069 6e20 445f 6c69  () for D in D_li
+00014130: 7374 5d0a 0a20 2020 2064 6566 2072 656d  st]..    def rem
+00014140: 6170 5f6c 6179 6572 7328 0a20 2020 2020  ap_layers(.     
+00014150: 2020 2073 656c 662c 206c 6179 6572 6d61     self, layerma
+00014160: 702c 2069 6e63 6c75 6465 5f6c 6162 656c  p, include_label
+00014170: 733a 2062 6f6f 6c20 3d20 5472 7565 2c20  s: bool = True, 
+00014180: 696e 636c 7564 655f 7061 7468 733a 2062  include_paths: b
+00014190: 6f6f 6c20 3d20 5472 7565 0a20 2020 2029  ool = True.    )
+000141a0: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
+000141b0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+000141c0: 7320 6120 636f 7079 206f 6620 7468 6520  s a copy of the 
+000141d0: 636f 6d70 6f6e 656e 7420 7769 7468 2072  component with r
+000141e0: 656d 6170 7065 6420 6c61 7965 7273 2e0a  emapped layers..
+000141f0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00014200: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00014210: 6d61 703a 2044 6963 7469 6f6e 6172 7920  map: Dictionary 
+00014220: 6f66 2076 616c 7565 7320 696e 2066 6f72  of values in for
+00014230: 6d61 7420 7b6c 6179 6572 5f66 726f 6d20  mat {layer_from 
+00014240: 3a20 6c61 7965 725f 746f 7d2e 0a20 2020  : layer_to}..   
+00014250: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+00014260: 5f6c 6162 656c 733a 2053 656c 6563 7473  _labels: Selects
+00014270: 2077 6865 7468 6572 2074 6f20 6d6f 7665   whether to move
+00014280: 204c 6162 656c 7320 616c 6f6e 6720 7769   Labels along wi
+00014290: 7468 2070 6f6c 7967 6f6e 732e 0a20 2020  th polygons..   
+000142a0: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+000142b0: 5f70 6174 6873 3a20 5365 6c65 6374 7320  _paths: Selects 
+000142c0: 7768 6574 6865 7220 746f 206d 6f76 6520  whether to move 
+000142d0: 5061 7468 7320 616c 6f6e 6720 7769 7468  Paths along with
+000142e0: 2070 6f6c 7967 6f6e 732e 0a20 2020 2020   polygons..     
+000142f0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
+00014300: 6f6d 706f 6e65 6e74 203d 2073 656c 662e  omponent = self.
+00014310: 636f 7079 2829 0a20 2020 2020 2020 206c  copy().        l
+00014320: 6179 6572 6d61 7020 3d20 7b5f 7061 7273  ayermap = {_pars
+00014330: 655f 6c61 7965 7228 6b29 3a20 5f70 6172  e_layer(k): _par
+00014340: 7365 5f6c 6179 6572 2876 2920 666f 7220  se_layer(v) for 
+00014350: 6b2c 2076 2069 6e20 6c61 7965 726d 6170  k, v in layermap
+00014360: 2e69 7465 6d73 2829 7d0a 0a20 2020 2020  .items()}..     
+00014370: 2020 2061 6c6c 5f44 203d 206c 6973 7428     all_D = list(
+00014380: 636f 6d70 6f6e 656e 742e 6765 745f 6465  component.get_de
+00014390: 7065 6e64 656e 6369 6573 2854 7275 6529  pendencies(True)
+000143a0: 290a 2020 2020 2020 2020 616c 6c5f 442e  ).        all_D.
+000143b0: 6170 7065 6e64 2863 6f6d 706f 6e65 6e74  append(component
+000143c0: 290a 2020 2020 2020 2020 666f 7220 4420  ).        for D 
+000143d0: 696e 2061 6c6c 5f44 3a0a 2020 2020 2020  in all_D:.      
+000143e0: 2020 2020 2020 666f 7220 7020 696e 2044        for p in D
+000143f0: 2e70 6f6c 7967 6f6e 733a 0a20 2020 2020  .polygons:.     
+00014400: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00014410: 203d 2028 702e 6c61 7965 722c 2070 2e64   = (p.layer, p.d
+00014420: 6174 6174 7970 6529 0a20 2020 2020 2020  atatype).       
+00014430: 2020 2020 2020 2020 2069 6620 6c61 7965           if laye
+00014440: 7220 696e 206c 6179 6572 6d61 703a 0a20  r in layermap:. 
+00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014460: 2020 206e 6577 5f6c 6179 6572 203d 206c     new_layer = l
+00014470: 6179 6572 6d61 705b 6c61 7965 725d 0a20  ayermap[layer]. 
+00014480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014490: 2020 2070 2e6c 6179 6572 203d 206e 6577     p.layer = new
+000144a0: 5f6c 6179 6572 5b30 5d0a 2020 2020 2020  _layer[0].      
+000144b0: 2020 2020 2020 2020 2020 2020 2020 702e                p.
+000144c0: 6461 7461 7479 7065 203d 206e 6577 5f6c  datatype = new_l
+000144d0: 6179 6572 5b31 5d0a 2020 2020 2020 2020  ayer[1].        
+000144e0: 2020 2020 6966 2069 6e63 6c75 6465 5f6c      if include_l
+000144f0: 6162 656c 733a 0a20 2020 2020 2020 2020  abels:.         
+00014500: 2020 2020 2020 2066 6f72 206c 6162 656c         for label
+00014510: 2069 6e20 442e 6c61 6265 6c73 3a0a 2020   in D.labels:.  
+00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014530: 2020 6f72 6967 696e 616c 5f6c 6179 6572    original_layer
+00014540: 203d 2028 6c61 6265 6c2e 6c61 7965 722c   = (label.layer,
+00014550: 206c 6162 656c 2e74 6578 7474 7970 6529   label.texttype)
+00014560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014570: 2020 2020 206f 7269 6769 6e61 6c5f 6c61       original_la
+00014580: 7965 7220 3d20 5f70 6172 7365 5f6c 6179  yer = _parse_lay
+00014590: 6572 286f 7269 6769 6e61 6c5f 6c61 7965  er(original_laye
+000145a0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+000145b0: 2020 2020 2020 2069 6620 6f72 6967 696e         if origin
+000145c0: 616c 5f6c 6179 6572 2069 6e20 6c61 7965  al_layer in laye
+000145d0: 726d 6170 3a0a 2020 2020 2020 2020 2020  rmap:.          
+000145e0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000145f0: 775f 6c61 7965 7220 3d20 6c61 7965 726d  w_layer = layerm
+00014600: 6170 5b6f 7269 6769 6e61 6c5f 6c61 7965  ap[original_laye
+00014610: 725d 0a20 2020 2020 2020 2020 2020 2020  r].             
+00014620: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00014630: 2e6c 6179 6572 203d 206e 6577 5f6c 6179  .layer = new_lay
+00014640: 6572 5b30 5d0a 2020 2020 2020 2020 2020  er[0].          
+00014650: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00014660: 6265 6c2e 7465 7874 7479 7065 203d 206e  bel.texttype = n
+00014670: 6577 5f6c 6179 6572 5b31 5d0a 0a20 2020  ew_layer[1]..   
+00014680: 2020 2020 2020 2020 2069 6620 696e 636c           if incl
+00014690: 7564 655f 7061 7468 733a 0a20 2020 2020  ude_paths:.     
+000146a0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+000146b0: 6174 6820 696e 2044 2e70 6174 6873 3a0a  ath in D.paths:.
+000146c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146d0: 2020 2020 6e65 775f 6c61 7965 7273 203d      new_layers =
+000146e0: 206c 6973 7428 7061 7468 2e6c 6179 6572   list(path.layer
+000146f0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00014700: 2020 2020 2020 206e 6577 5f64 6174 6174         new_datat
+00014710: 7970 6573 203d 206c 6973 7428 7061 7468  ypes = list(path
+00014720: 2e64 6174 6174 7970 6573 290a 2020 2020  .datatypes).    
+00014730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014740: 666f 7220 6c61 7965 725f 6e75 6d62 6572  for layer_number
+00014750: 2069 6e20 7261 6e67 6528 6c65 6e28 6e65   in range(len(ne
+00014760: 775f 6c61 7965 7273 2929 3a0a 2020 2020  w_layers)):.    
+00014770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014780: 2020 2020 6f72 6967 696e 616c 5f6c 6179      original_lay
+00014790: 6572 203d 205f 7061 7273 655f 6c61 7965  er = _parse_laye
+000147a0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+000147b0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000147c0: 6e65 775f 6c61 7965 7273 5b6c 6179 6572  new_layers[layer
+000147d0: 5f6e 756d 6265 725d 2c20 6e65 775f 6461  _number], new_da
+000147e0: 7461 7479 7065 735b 6c61 7965 725f 6e75  tatypes[layer_nu
+000147f0: 6d62 6572 5d29 0a20 2020 2020 2020 2020  mber]).         
+00014800: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00014810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014820: 2020 2020 2020 2020 2069 6620 6f72 6967           if orig
+00014830: 696e 616c 5f6c 6179 6572 2069 6e20 6c61  inal_layer in la
+00014840: 7965 726d 6170 3a0a 2020 2020 2020 2020  yermap:.        
+00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014860: 2020 2020 6e65 775f 6c61 7965 7220 3d20      new_layer = 
+00014870: 6c61 7965 726d 6170 5b6f 7269 6769 6e61  layermap[origina
+00014880: 6c5f 6c61 7965 725d 0a20 2020 2020 2020  l_layer].       
+00014890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148a0: 2020 2020 206e 6577 5f6c 6179 6572 735b       new_layers[
+000148b0: 6c61 7965 725f 6e75 6d62 6572 5d20 3d20  layer_number] = 
+000148c0: 6e65 775f 6c61 7965 725b 305d 0a20 2020  new_layer[0].   
+000148d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148e0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+000148f0: 6174 7970 6573 5b6c 6179 6572 5f6e 756d  atypes[layer_num
+00014900: 6265 725d 203d 206e 6577 5f6c 6179 6572  ber] = new_layer
+00014910: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
+00014920: 2020 2020 2020 2020 7061 7468 2e73 6574          path.set
+00014930: 5f6c 6179 6572 7328 2a6e 6577 5f6c 6179  _layers(*new_lay
+00014940: 6572 7329 0a20 2020 2020 2020 2020 2020  ers).           
+00014950: 2020 2020 2020 2020 2070 6174 682e 7365           path.se
+00014960: 745f 6461 7461 7479 7065 7328 2a6e 6577  t_datatypes(*new
+00014970: 5f64 6174 6174 7970 6573 290a 2020 2020  _datatypes).    
+00014980: 2020 2020 7265 7475 726e 2063 6f6d 706f      return compo
+00014990: 6e65 6e74 0a0a 2020 2020 6465 6620 746f  nent..    def to
+000149a0: 5f33 6428 0a20 2020 2020 2020 2073 656c  _3d(.        sel
+000149b0: 662c 0a20 2020 2020 2020 206c 6179 6572  f,.        layer
+000149c0: 5f76 6965 7773 3a20 4c61 7965 7256 6965  _views: LayerVie
+000149d0: 7773 207c 204e 6f6e 6520 3d20 4e6f 6e65  ws | None = None
+000149e0: 2c0a 2020 2020 2020 2020 6c61 7965 725f  ,.        layer_
+000149f0: 7374 6163 6b3a 204c 6179 6572 5374 6163  stack: LayerStac
+00014a00: 6b20 7c20 4e6f 6e65 203d 204e 6f6e 652c  k | None = None,
+00014a10: 0a20 2020 2020 2020 2065 7863 6c75 6465  .        exclude
+00014a20: 5f6c 6179 6572 733a 2074 7570 6c65 5b4c  _layers: tuple[L
+00014a30: 6179 6572 2c20 2e2e 2e5d 207c 204e 6f6e  ayer, ...] | Non
+00014a40: 6520 3d20 4e6f 6e65 2c0a 2020 2020 293a  e = None,.    ):
+00014a50: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00014a60: 726e 2043 6f6d 706f 6e65 6e74 2033 4420  rn Component 3D 
+00014a70: 7472 696d 6573 6820 5363 656e 652e 0a0a  trimesh Scene...
+00014a80: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00014a90: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
+00014aa0: 656e 743a 2074 6f20 6578 7472 7564 6520  ent: to extrude 
+00014ab0: 696e 2033 442e 0a20 2020 2020 2020 2020  in 3D..         
+00014ac0: 2020 206c 6179 6572 5f76 6965 7773 3a20     layer_views: 
+00014ad0: 6c61 7965 7220 636f 6c6f 7273 2066 726f  layer colors fro
+00014ae0: 6d20 4b6c 6179 6f75 7420 4c61 7965 7220  m Klayout Layer 
+00014af0: 5072 6f70 6572 7469 6573 2066 696c 652e  Properties file.
+00014b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014b10: 2044 6566 6175 6c74 7320 746f 2061 6374   Defaults to act
+00014b20: 6976 6520 5044 4b2e 6c61 7965 725f 7669  ive PDK.layer_vi
+00014b30: 6577 732e 0a20 2020 2020 2020 2020 2020  ews..           
+00014b40: 206c 6179 6572 5f73 7461 636b 3a20 636f   layer_stack: co
+00014b50: 6e74 6169 6e73 2074 6869 636b 6e65 7373  ntains thickness
+00014b60: 2061 6e64 207a 6d69 6e20 666f 7220 6561   and zmin for ea
+00014b70: 6368 206c 6179 6572 2e0a 2020 2020 2020  ch layer..      
+00014b80: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+00014b90: 7473 2074 6f20 6163 7469 7665 2050 444b  ts to active PDK
+00014ba0: 2e6c 6179 6572 5f73 7461 636b 2e0a 2020  .layer_stack..  
+00014bb0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00014bc0: 655f 6c61 7965 7273 3a20 6c61 7965 7273  e_layers: layers
+00014bd0: 2074 6f20 6578 636c 7564 652e 0a0a 2020   to exclude...  
+00014be0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00014bf0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+00014c00: 792e 6578 706f 7274 2e74 6f5f 3364 2069  y.export.to_3d i
+00014c10: 6d70 6f72 7420 746f 5f33 640a 0a20 2020  mport to_3d..   
+00014c20: 2020 2020 2072 6574 7572 6e20 746f 5f33       return to_3
+00014c30: 6428 0a20 2020 2020 2020 2020 2020 2073  d(.            s
+00014c40: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+00014c50: 206c 6179 6572 5f76 6965 7773 3d6c 6179   layer_views=lay
+00014c60: 6572 5f76 6965 7773 2c0a 2020 2020 2020  er_views,.      
+00014c70: 2020 2020 2020 6c61 7965 725f 7374 6163        layer_stac
+00014c80: 6b3d 6c61 7965 725f 7374 6163 6b2c 0a20  k=layer_stack,. 
+00014c90: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00014ca0: 6465 5f6c 6179 6572 733d 6578 636c 7564  de_layers=exclud
+00014cb0: 655f 6c61 7965 7273 2c0a 2020 2020 2020  e_layers,.      
+00014cc0: 2020 290a 0a20 2020 2064 6566 2074 6f5f    )..    def to_
+00014cd0: 6e70 280a 2020 2020 2020 2020 7365 6c66  np(.        self
+00014ce0: 2c0a 2020 2020 2020 2020 6e6d 5f70 6572  ,.        nm_per
+00014cf0: 5f70 6978 656c 3a20 696e 7420 3d20 3230  _pixel: int = 20
+00014d00: 2c0a 2020 2020 2020 2020 6c61 7965 7273  ,.        layers
+00014d10: 3a20 4c61 7965 7273 203d 2028 2831 2c20  : Layers = ((1, 
+00014d20: 3029 2c29 2c0a 2020 2020 2020 2020 7661  0),),.        va
+00014d30: 6c75 6573 3a20 7475 706c 655b 666c 6f61  lues: tuple[floa
+00014d40: 742c 202e 2e2e 5d20 7c20 4e6f 6e65 203d  t, ...] | None =
+00014d50: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
+00014d60: 6164 5f77 6964 7468 3a20 696e 7420 3d20  ad_width: int = 
+00014d70: 312c 0a20 2020 2029 202d 3e20 6e70 2e6e  1,.    ) -> np.n
+00014d80: 6461 7272 6179 3a0a 2020 2020 2020 2020  darray:.        
+00014d90: 2222 2252 6574 7572 6e73 2061 2070 6978  """Returns a pix
+00014da0: 656c 6174 6564 206e 756d 7079 2061 7272  elated numpy arr
+00014db0: 6179 2066 726f 6d20 436f 6d70 6f6e 656e  ay from Componen
+00014dc0: 7420 706f 6c79 676f 6e73 2e0a 0a20 2020  t polygons...   
+00014dd0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+00014de0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+00014df0: 3a20 436f 6d70 6f6e 656e 742e 0a20 2020  : Component..   
+00014e00: 2020 2020 2020 2020 206e 6d5f 7065 725f           nm_per_
+00014e10: 7069 7865 6c3a 2079 6f75 2063 616e 2067  pixel: you can g
+00014e20: 6f20 6672 6f6d 2032 3020 2863 6f61 7273  o from 20 (coars
+00014e30: 6529 2074 6f20 3420 2866 696e 6529 2e0a  e) to 4 (fine)..
+00014e40: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00014e50: 7273 3a20 746f 2063 6f6e 7665 7274 2e20  rs: to convert. 
+00014e60: 4f72 6465 7220 6d61 7474 6572 7320 286c  Order matters (l
+00014e70: 6174 7465 7220 6f76 6572 7772 6974 6520  atter overwrite 
+00014e80: 666f 726d 6572 292e 0a20 2020 2020 2020  former)..       
+00014e90: 2020 2020 2076 616c 7565 733a 2061 7373       values: ass
+00014ea0: 6f63 6961 7465 6420 746f 2065 6163 6820  ociated to each 
+00014eb0: 6c61 7965 7220 2864 6566 6175 6c74 7320  layer (defaults 
+00014ec0: 746f 2031 292e 0a20 2020 2020 2020 2020  to 1)..         
+00014ed0: 2020 2070 6164 5f77 6964 7468 3a20 7061     pad_width: pa
+00014ee0: 6464 696e 6720 7069 7865 6c73 2061 726f  dding pixels aro
+00014ef0: 756e 6420 7468 6520 696d 6167 652e 0a0a  und the image...
+00014f00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014f10: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+00014f20: 6f72 792e 6578 706f 7274 2e74 6f5f 6e70  ory.export.to_np
+00014f30: 2069 6d70 6f72 7420 746f 5f6e 700a 0a20   import to_np.. 
+00014f40: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
+00014f50: 5f6e 7028 0a20 2020 2020 2020 2020 2020  _np(.           
+00014f60: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+00014f70: 2020 206e 6d5f 7065 725f 7069 7865 6c3d     nm_per_pixel=
+00014f80: 6e6d 5f70 6572 5f70 6978 656c 2c0a 2020  nm_per_pixel,.  
+00014f90: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+00014fa0: 3d6c 6179 6572 732c 0a20 2020 2020 2020  =layers,.       
+00014fb0: 2020 2020 2076 616c 7565 733d 7661 6c75       values=valu
+00014fc0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00014fd0: 7061 645f 7769 6474 683d 7061 645f 7769  pad_width=pad_wi
+00014fe0: 6474 682c 0a20 2020 2020 2020 2029 0a0a  dth,.        )..
+00014ff0: 2020 2020 6465 6620 7772 6974 655f 7374      def write_st
+00015000: 6c28 0a20 2020 2020 2020 2073 656c 662c  l(.        self,
+00015010: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
+00015020: 683a 2073 7472 2c0a 2020 2020 2020 2020  h: str,.        
+00015030: 6c61 7965 725f 7374 6163 6b3a 204c 6179  layer_stack: Lay
+00015040: 6572 5374 6163 6b20 7c20 4e6f 6e65 203d  erStack | None =
+00015050: 204e 6f6e 652c 0a20 2020 2020 2020 2065   None,.        e
+00015060: 7863 6c75 6465 5f6c 6179 6572 733a 2074  xclude_layers: t
+00015070: 7570 6c65 5b4c 6179 6572 2c20 2e2e 2e5d  uple[Layer, ...]
+00015080: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00015090: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+000150a0: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
+000150b0: 6120 436f 6d70 6f6e 656e 7420 746f 2053  a Component to S
+000150c0: 544c 2066 6f72 2033 4420 7072 696e 7469  TL for 3D printi
+000150d0: 6e67 2e0a 0a20 2020 2020 2020 2041 7267  ng...        Arg
+000150e0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+000150f0: 696c 6570 6174 683a 2074 6f20 7772 6974  ilepath: to writ
+00015100: 6520 5354 4c20 746f 2e0a 2020 2020 2020  e STL to..      
+00015110: 2020 2020 2020 6c61 7965 725f 7374 6163        layer_stac
+00015120: 6b3a 2063 6f6e 7461 696e 7320 7468 6963  k: contains thic
+00015130: 6b6e 6573 7320 616e 6420 7a6d 696e 2066  kness and zmin f
+00015140: 6f72 2065 6163 6820 6c61 7965 722e 0a20  or each layer.. 
+00015150: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
+00015160: 6465 5f6c 6179 6572 733a 206c 6179 6572  de_layers: layer
+00015170: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
+00015180: 2020 2020 2020 2020 2020 7573 655f 6c61            use_la
+00015190: 7965 725f 6e61 6d65 3a20 4966 2054 7275  yer_name: If Tru
+000151a0: 652c 2075 7365 7320 4c61 7965 724c 6576  e, uses LayerLev
+000151b0: 656c 206e 616d 6573 2069 6e20 6f75 7470  el names in outp
+000151c0: 7574 2066 696c 656e 616d 6573 2072 6174  ut filenames rat
+000151d0: 6865 7220 7468 616e 2067 6473 5f6c 6179  her than gds_lay
+000151e0: 6572 2061 6e64 2067 6473 5f64 6174 6174  er and gds_datat
+000151f0: 7970 652e 0a20 2020 2020 2020 2020 2020  ype..           
+00015200: 2068 756c 6c5f 696e 7661 6c69 645f 706f   hull_invalid_po
+00015210: 6c79 676f 6e73 3a20 4966 2054 7275 652c  lygons: If True,
+00015220: 2072 6570 6c61 6365 7320 696e 7661 6c69   replaces invali
+00015230: 6420 706f 6c79 676f 6e73 2028 6465 7465  d polygons (dete
+00015240: 726d 696e 6564 2062 7920 7368 6170 656c  rmined by shapel
+00015250: 792e 506f 6c79 676f 6e2e 6973 5f76 616c  y.Polygon.is_val
+00015260: 6964 2920 7769 7468 2069 7473 2063 6f6e  id) with its con
+00015270: 7665 7820 6875 6c6c 2e0a 2020 2020 2020  vex hull..      
+00015280: 2020 2020 2020 7363 616c 653a 204f 7074        scale: Opt
+00015290: 696f 6e61 6c20 6661 6374 6f72 2062 7920  ional factor by 
+000152a0: 7768 6963 6820 746f 2073 6361 6c65 206d  which to scale m
+000152b0: 6573 6865 7320 6265 666f 7265 2077 7269  eshes before wri
+000152c0: 7469 6e67 2e0a 0a20 2020 2020 2020 2022  ting...        "
+000152d0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+000152e0: 6764 7366 6163 746f 7279 2e65 7870 6f72  gdsfactory.expor
+000152f0: 742e 746f 5f73 746c 2069 6d70 6f72 7420  t.to_stl import 
+00015300: 746f 5f73 746c 0a0a 2020 2020 2020 2020  to_stl..        
+00015310: 746f 5f73 746c 280a 2020 2020 2020 2020  to_stl(.        
+00015320: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00015330: 2020 2020 2020 6669 6c65 7061 7468 3d66        filepath=f
+00015340: 696c 6570 6174 682c 0a20 2020 2020 2020  ilepath,.       
+00015350: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
+00015360: 3d6c 6179 6572 5f73 7461 636b 2c0a 2020  =layer_stack,.  
+00015370: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00015380: 655f 6c61 7965 7273 3d65 7863 6c75 6465  e_layers=exclude
+00015390: 5f6c 6179 6572 732c 0a20 2020 2020 2020  _layers,.       
+000153a0: 2029 0a0a 2020 2020 6465 6620 7772 6974   )..    def writ
+000153b0: 655f 6765 7262 6572 2873 656c 662c 2064  e_gerber(self, d
+000153c0: 6972 7061 7468 2c20 6c61 7965 726d 6170  irpath, layermap
+000153d0: 5f74 6f5f 6765 7262 6572 5f6c 6179 6572  _to_gerber_layer
+000153e0: 2c20 6f70 7469 6f6e 7329 202d 3e20 4e6f  , options) -> No
+000153f0: 6e65 3a0a 2020 2020 2020 2020 6672 6f6d  ne:.        from
+00015400: 2067 6473 6661 6374 6f72 792e 6578 706f   gdsfactory.expo
+00015410: 7274 2e74 6f5f 6765 7262 6572 2069 6d70  rt.to_gerber imp
+00015420: 6f72 7420 746f 5f67 6572 6265 720a 0a20  ort to_gerber.. 
+00015430: 2020 2020 2020 2074 6f5f 6765 7262 6572         to_gerber
+00015440: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00015450: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00015460: 6469 7270 6174 683d 6469 7270 6174 682c  dirpath=dirpath,
+00015470: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00015480: 6572 6d61 705f 746f 5f67 6572 6265 725f  ermap_to_gerber_
+00015490: 6c61 7965 723d 6c61 7965 726d 6170 5f74  layer=layermap_t
+000154a0: 6f5f 6765 7262 6572 5f6c 6179 6572 2c0a  o_gerber_layer,.
+000154b0: 2020 2020 2020 2020 2020 2020 6f70 7469              opti
+000154c0: 6f6e 733d 6f70 7469 6f6e 732c 0a20 2020  ons=options,.   
+000154d0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+000154e0: 746f 5f67 6d73 6828 0a20 2020 2020 2020  to_gmsh(.       
+000154f0: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
+00015500: 7970 652c 0a20 2020 2020 2020 207a 3d4e  ype,.        z=N
+00015510: 6f6e 652c 0a20 2020 2020 2020 2078 7365  one,.        xse
+00015520: 6374 696f 6e5f 626f 756e 6473 3d4e 6f6e  ction_bounds=Non
+00015530: 652c 0a20 2020 2020 2020 206c 6179 6572  e,.        layer
+00015540: 5f73 7461 636b 3d4e 6f6e 652c 0a20 2020  _stack=None,.   
+00015550: 2020 2020 2077 6166 6572 5f70 6164 6469       wafer_paddi
+00015560: 6e67 3d30 2e30 2c0a 2020 2020 2020 2020  ng=0.0,.        
+00015570: 7761 6665 725f 6c61 7965 723d 4c41 5945  wafer_layer=LAYE
+00015580: 522e 5741 4645 522c 0a20 2020 2020 2020  R.WAFER,.       
+00015590: 202a 6172 6773 2c0a 2020 2020 2020 2020   *args,.        
+000155a0: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
+000155b0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+000155c0: 726e 7320 6120 676d 7368 206d 7368 206f  rns a gmsh msh o
+000155d0: 6620 7468 6520 636f 6d70 6f6e 656e 7420  f the component 
+000155e0: 666f 7220 6669 6e69 7465 2065 6c65 6d65  for finite eleme
+000155f0: 6e74 2073 696d 756c 6174 696f 6e2e 0a0a  nt simulation...
+00015600: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+00015610: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
+00015620: 7970 653a 206f 6e65 206f 6620 2278 7922  ype: one of "xy"
+00015630: 2c20 2275 7a22 2c20 6f72 2022 3344 222e  , "uz", or "3D".
+00015640: 2044 6574 6572 6d69 6e65 7320 7468 6520   Determines the 
+00015650: 7479 7065 206f 6620 6d65 7368 2074 6f20  type of mesh to 
+00015660: 7265 7475 726e 2e0a 2020 2020 2020 2020  return..        
+00015670: 2020 2020 7a3a 2075 7365 6420 746f 2064      z: used to d
+00015680: 6566 696e 6520 7a2d 736c 6963 6520 666f  efine z-slice fo
+00015690: 7220 7879 206d 6573 6869 6e67 0a20 2020  r xy meshing.   
+000156a0: 2020 2020 2020 2020 2078 7365 6374 696f           xsectio
+000156b0: 6e5f 626f 756e 6473 3a20 7573 6564 2074  n_bounds: used t
+000156c0: 6f20 6465 6669 6e65 2069 6e2d 706c 616e  o define in-plan
+000156d0: 6520 6c69 6e65 2066 6f72 2075 7a20 6d65  e line for uz me
+000156e0: 7368 696e 670a 2020 2020 2020 2020 2020  shing.          
+000156f0: 2020 7761 6665 725f 7061 6464 696e 673a    wafer_padding:
+00015700: 2070 6164 6469 6e67 2062 6579 6f6e 6420   padding beyond 
+00015710: 6262 6f78 2074 6f20 6164 6420 746f 2057  bbox to add to W
+00015720: 4146 4552 206c 6179 6572 732e 0a0a 2020  AFER layers...  
+00015730: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
+00015740: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00015750: 4172 6775 6d65 6e74 7320 666f 7220 7468  Arguments for th
+00015760: 6520 7461 7267 6574 206d 6573 6869 6e67  e target meshing
+00015770: 2066 756e 6374 696f 6e20 696e 2067 706c   function in gpl
+00015780: 7567 696e 732e 676d 7368 0a20 2020 2020  ugins.gmsh.     
+00015790: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+000157a0: 2041 6464 2057 4146 4552 206c 6179 6572   Add WAFER layer
+000157b0: 3a0a 2020 2020 2020 2020 7061 6464 6564  :.        padded
+000157c0: 5f63 6f6d 706f 6e65 6e74 203d 2043 6f6d  _component = Com
+000157d0: 706f 6e65 6e74 2829 0a20 2020 2020 2020  ponent().       
+000157e0: 2070 6164 6465 645f 636f 6d70 6f6e 656e   padded_componen
+000157f0: 7420 3c3c 2073 656c 660a 2020 2020 2020  t << self.      
+00015800: 2020 2878 6d69 6e2c 2079 6d69 6e29 2c20    (xmin, ymin), 
+00015810: 2878 6d61 782c 2079 6d61 7829 203d 2073  (xmax, ymax) = s
+00015820: 656c 662e 6262 6f78 0a20 2020 2020 2020  elf.bbox.       
+00015830: 2070 6f69 6e74 7320 3d20 5b0a 2020 2020   points = [.    
+00015840: 2020 2020 2020 2020 5b78 6d69 6e20 2d20          [xmin - 
+00015850: 7761 6665 725f 7061 6464 696e 672c 2079  wafer_padding, y
+00015860: 6d69 6e20 2d20 7761 6665 725f 7061 6464  min - wafer_padd
+00015870: 696e 675d 2c0a 2020 2020 2020 2020 2020  ing],.          
+00015880: 2020 5b78 6d61 7820 2b20 7761 6665 725f    [xmax + wafer_
+00015890: 7061 6464 696e 672c 2079 6d69 6e20 2d20  padding, ymin - 
+000158a0: 7761 6665 725f 7061 6464 696e 675d 2c0a  wafer_padding],.
+000158b0: 2020 2020 2020 2020 2020 2020 5b78 6d61              [xma
+000158c0: 7820 2b20 7761 6665 725f 7061 6464 696e  x + wafer_paddin
+000158d0: 672c 2079 6d61 7820 2b20 7761 6665 725f  g, ymax + wafer_
+000158e0: 7061 6464 696e 675d 2c0a 2020 2020 2020  padding],.      
+000158f0: 2020 2020 2020 5b78 6d69 6e20 2d20 7761        [xmin - wa
+00015900: 6665 725f 7061 6464 696e 672c 2079 6d61  fer_padding, yma
+00015910: 7820 2b20 7761 6665 725f 7061 6464 696e  x + wafer_paddin
+00015920: 675d 2c0a 2020 2020 2020 2020 5d0a 2020  g],.        ].  
+00015930: 2020 2020 2020 7061 6464 6564 5f63 6f6d        padded_com
+00015940: 706f 6e65 6e74 2e61 6464 5f70 6f6c 7967  ponent.add_polyg
+00015950: 6f6e 2870 6f69 6e74 732c 206c 6179 6572  on(points, layer
+00015960: 3d77 6166 6572 5f6c 6179 6572 290a 2020  =wafer_layer).  
+00015970: 2020 2020 2020 7061 6464 6564 5f63 6f6d        padded_com
+00015980: 706f 6e65 6e74 2e61 6464 5f70 6f72 7473  ponent.add_ports
+00015990: 2873 656c 662e 6765 745f 706f 7274 735f  (self.get_ports_
+000159a0: 6c69 7374 2829 290a 0a20 2020 2020 2020  list())..       
+000159b0: 2069 6620 6c61 7965 725f 7374 6163 6b20   if layer_stack 
+000159c0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000159d0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000159e0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+000159f0: 2020 2020 2020 2027 4120 4c61 7965 7253         'A LayerS
+00015a00: 7461 636b 206d 7573 7420 6265 2070 726f  tack must be pro
+00015a10: 7669 6465 6420 7468 726f 7567 6820 6172  vided through ar
+00015a20: 6775 6d65 6e74 2022 6c61 7965 725f 7374  gument "layer_st
+00015a30: 6163 6b22 2e27 0a20 2020 2020 2020 2020  ack".'.         
+00015a40: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00015a50: 7479 7065 203d 3d20 2278 7922 3a0a 2020  type == "xy":.  
+00015a60: 2020 2020 2020 2020 2020 6966 207a 2069            if z i
+00015a70: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00015a80: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00015a90: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00015aa0: 2020 2020 2020 2020 2020 2020 2020 2746                'F
+00015ab0: 6f72 2078 792d 6d65 7368 696e 672c 2061  or xy-meshing, a
+00015ac0: 207a 2d76 616c 7565 206d 7573 7420 6265   z-value must be
+00015ad0: 2070 726f 7669 6465 6420 7669 6120 7468   provided via th
+00015ae0: 6520 666c 6f61 7420 6172 6775 6d65 6e74  e float argument
+00015af0: 2022 7a22 2e27 0a20 2020 2020 2020 2020   "z".'.         
+00015b00: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00015b10: 2020 2020 2066 726f 6d20 6770 6c75 6769       from gplugi
+00015b20: 6e73 2e67 6d73 682e 7879 5f78 7365 6374  ns.gmsh.xy_xsect
+00015b30: 696f 6e5f 6d65 7368 2069 6d70 6f72 7420  ion_mesh import 
+00015b40: 7879 5f78 7365 6374 696f 6e5f 6d65 7368  xy_xsection_mesh
+00015b50: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00015b60: 7475 726e 2078 795f 7873 6563 7469 6f6e  turn xy_xsection
+00015b70: 5f6d 6573 6828 7061 6464 6564 5f63 6f6d  _mesh(padded_com
+00015b80: 706f 6e65 6e74 2c20 7a2c 206c 6179 6572  ponent, z, layer
+00015b90: 5f73 7461 636b 2c20 2a2a 6b77 6172 6773  _stack, **kwargs
+00015ba0: 290a 2020 2020 2020 2020 656c 6966 2074  ).        elif t
+00015bb0: 7970 6520 3d3d 2022 757a 223a 0a20 2020  ype == "uz":.   
+00015bc0: 2020 2020 2020 2020 2069 6620 7873 6563           if xsec
+00015bd0: 7469 6f6e 5f62 6f75 6e64 7320 6973 204e  tion_bounds is N
+00015be0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00015bf0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00015c00: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00015c10: 2020 2020 2020 2020 2020 2022 466f 7220             "For 
+00015c20: 757a 2d6d 6573 6869 6e67 2c20 796f 7520  uz-meshing, you 
+00015c30: 6d75 7374 2070 726f 7669 6465 2061 206c  must provide a l
+00015c40: 696e 6520 696e 2074 6865 2078 792d 706c  ine in the xy-pl
+00015c50: 616e 6520 220a 2020 2020 2020 2020 2020  ane ".          
+00015c60: 2020 2020 2020 2020 2020 2276 6961 2074            "via t
+00015c70: 6865 2054 7570 6c65 2061 7267 756d 656e  he Tuple argumen
+00015c80: 7420 5b5b 7831 2c79 315d 2c20 5b78 322c  t [[x1,y1], [x2,
+00015c90: 7932 5d5d 2078 7365 6374 696f 6e5f 626f  y2]] xsection_bo
+00015ca0: 756e 6473 2e22 0a20 2020 2020 2020 2020  unds.".         
+00015cb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00015cc0: 2020 2020 2066 726f 6d20 6770 6c75 6769       from gplugi
+00015cd0: 6e73 2e67 6d73 682e 757a 5f78 7365 6374  ns.gmsh.uz_xsect
+00015ce0: 696f 6e5f 6d65 7368 2069 6d70 6f72 7420  ion_mesh import 
+00015cf0: 757a 5f78 7365 6374 696f 6e5f 6d65 7368  uz_xsection_mesh
+00015d00: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00015d10: 7475 726e 2075 7a5f 7873 6563 7469 6f6e  turn uz_xsection
+00015d20: 5f6d 6573 6828 0a20 2020 2020 2020 2020  _mesh(.         
+00015d30: 2020 2020 2020 2070 6164 6465 645f 636f         padded_co
+00015d40: 6d70 6f6e 656e 742c 2078 7365 6374 696f  mponent, xsectio
+00015d50: 6e5f 626f 756e 6473 2c20 6c61 7965 725f  n_bounds, layer_
+00015d60: 7374 6163 6b2c 202a 2a6b 7761 7267 730a  stack, **kwargs.
+00015d70: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00015d80: 2020 2020 2020 656c 6966 2074 7970 6520        elif type 
+00015d90: 3d3d 2022 3344 223a 0a20 2020 2020 2020  == "3D":.       
+00015da0: 2020 2020 2073 7065 6320 3d20 696d 706f       spec = impo
+00015db0: 7274 6c69 622e 7574 696c 2e66 696e 645f  rtlib.util.find_
+00015dc0: 7370 6563 2822 6d65 7368 7765 6c6c 2229  spec("meshwell")
+00015dd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00015de0: 7370 6563 2069 7320 4e6f 6e65 3a0a 2020  spec is None:.  
+00015df0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00015e00: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+00015e10: 2020 2020 2020 2020 2022 3344 206d 6573           "3D mes
+00015e20: 6869 6e67 2072 6571 7569 7265 7320 6d65  hing requires me
+00015e30: 7368 7765 6c6c 2c20 7365 6520 6874 7470  shwell, see http
+00015e40: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f73  s://github.com/s
+00015e50: 696d 6269 6c6f 642f 6d65 7368 7765 6c6c  imbilod/meshwell
+00015e60: 206f 7220 7275 6e20 7069 7020 696e 7374   or run pip inst
+00015e70: 616c 6c20 6d65 7368 7765 6c6c 2e22 0a20  all meshwell.". 
+00015e80: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00015e90: 0a0a 2020 2020 2020 2020 2020 2020 6672  ..            fr
+00015ea0: 6f6d 2067 706c 7567 696e 732e 676d 7368  om gplugins.gmsh
+00015eb0: 2e78 797a 5f6d 6573 6820 696d 706f 7274  .xyz_mesh import
+00015ec0: 2078 797a 5f6d 6573 680a 0a20 2020 2020   xyz_mesh..     
+00015ed0: 2020 2020 2020 2072 6574 7572 6e20 7879         return xy
+00015ee0: 7a5f 6d65 7368 2870 6164 6465 645f 636f  z_mesh(padded_co
+00015ef0: 6d70 6f6e 656e 742c 206c 6179 6572 5f73  mponent, layer_s
+00015f00: 7461 636b 2c20 2a2a 6b77 6172 6773 290a  tack, **kwargs).
+00015f10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00015f20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00015f30: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00015f40: 2020 2020 2020 2020 2020 2020 2752 6571              'Req
+00015f50: 7569 7265 6420 6172 6775 6d65 6e74 2022  uired argument "
+00015f60: 7479 7065 2220 6d75 7374 2062 6520 6f6e  type" must be on
+00015f70: 6520 6f66 2022 7879 222c 2022 757a 222c  e of "xy", "uz",
+00015f80: 206f 7220 2233 4422 2e27 0a20 2020 2020   or "3D".'.     
+00015f90: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00015fa0: 6620 6f66 6673 6574 280a 2020 2020 2020  f offset(.      
+00015fb0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00015fc0: 6469 7374 616e 6365 3a20 666c 6f61 7420  distance: float 
+00015fd0: 3d20 302e 312c 0a20 2020 2020 2020 2070  = 0.1,.        p
+00015fe0: 6f6c 7967 6f6e 733d 4e6f 6e65 2c0a 2020  olygons=None,.  
+00015ff0: 2020 2020 2020 7573 655f 756e 696f 6e3a        use_union:
+00016000: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+00016010: 2020 2020 2020 7072 6563 6973 696f 6e3a        precision:
+00016020: 2066 6c6f 6174 203d 2031 652d 342c 0a20   float = 1e-4,. 
+00016030: 2020 2020 2020 206a 6f69 6e3a 2073 7472         join: str
+00016040: 203d 2022 6d69 7465 7222 2c0a 2020 2020   = "miter",.    
+00016050: 2020 2020 746f 6c65 7261 6e63 653a 2069      tolerance: i
+00016060: 6e74 203d 2032 2c0a 2020 2020 2020 2020  nt = 2,.        
+00016070: 6c61 7965 723a 204c 6179 6572 5370 6563  layer: LayerSpec
+00016080: 203d 2022 5747 222c 0a20 2020 2029 202d   = "WG",.    ) -
+00016090: 3e20 436f 6d70 6f6e 656e 743a 0a20 2020  > Component:.   
+000160a0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+000160b0: 6e65 7720 436f 6d70 6f6e 656e 7420 7769  new Component wi
+000160c0: 7468 2070 6f6c 7967 6f6e 7320 6572 6f64  th polygons erod
+000160d0: 6564 206f 7220 6469 6c61 7465 6420 6279  ed or dilated by
+000160e0: 2061 6e20 6f66 6673 6574 2e0a 0a20 2020   an offset...   
+000160f0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+00016100: 2020 2020 2020 2064 6973 7461 6e63 653a         distance:
+00016110: 2044 6973 7461 6e63 6520 746f 206f 6666   Distance to off
+00016120: 7365 7420 706f 6c79 676f 6e73 2e20 506f  set polygons. Po
+00016130: 7369 7469 7665 2076 616c 7565 7320 6578  sitive values ex
+00016140: 7061 6e64 2c20 6e65 6761 7469 7665 2073  pand, negative s
+00016150: 6872 696e 6b2e 0a20 2020 2020 2020 2020  hrink..         
+00016160: 2020 2070 7265 6369 7369 6f6e 3a20 4465     precision: De
+00016170: 7369 7265 6420 7072 6563 6973 696f 6e20  sired precision 
+00016180: 666f 7220 726f 756e 6469 6e67 2076 6572  for rounding ver
+00016190: 7465 7820 636f 6f72 6469 6e61 7465 732e  tex coordinates.
+000161a0: 0a20 2020 2020 2020 2020 2020 206a 6f69  .            joi
+000161b0: 6e3a 207b 276d 6974 6572 272c 2027 6265  n: {'miter', 'be
+000161c0: 7665 6c27 2c20 2772 6f75 6e64 277d 2054  vel', 'round'} T
+000161d0: 7970 6520 6f66 206a 6f69 6e20 7573 6564  ype of join used
+000161e0: 2074 6f20 6372 6561 7465 2070 6f6c 7967   to create polyg
+000161f0: 6f6e 206f 6666 7365 740a 2020 2020 2020  on offset.      
+00016200: 2020 2020 2020 746f 6c65 7261 6e63 653a        tolerance:
+00016210: 2046 6f72 206d 6974 6572 206a 6f69 6e74   For miter joint
+00016220: 732c 2074 6869 7320 6e75 6d62 6572 206d  s, this number m
+00016230: 7573 7420 6265 2061 7420 6c65 6173 7420  ust be at least 
+00016240: 3220 7265 7072 6573 656e 7473 2074 6865  2 represents the
+00016250: 0a20 2020 2020 2020 2020 2020 2020 206d  .              m
+00016260: 6178 696d 616c 2064 6973 7461 6e63 6520  aximal distance 
+00016270: 696e 206d 756c 7469 706c 6573 206f 6620  in multiples of 
+00016280: 6f66 6673 6574 2062 6574 7765 656e 206e  offset between n
+00016290: 6577 2076 6572 7469 6365 7320 616e 6420  ew vertices and 
+000162a0: 7468 6569 720a 2020 2020 2020 2020 2020  their.          
+000162b0: 2020 2020 6f72 6967 696e 616c 2070 6f73      original pos
+000162c0: 6974 696f 6e20 6265 666f 7265 2062 6576  ition before bev
+000162d0: 656c 696e 6720 746f 2061 766f 6964 2073  eling to avoid s
+000162e0: 7069 6b65 7320 6174 2061 6375 7465 206a  pikes at acute j
+000162f0: 6f69 6e74 732e 2046 6f72 0a20 2020 2020  oints. For.     
+00016300: 2020 2020 2020 2020 2072 6f75 6e64 206a           round j
+00016310: 6f69 6e74 732c 2069 7420 696e 6469 6361  oints, it indica
+00016320: 7465 7320 7468 6520 6375 7276 6174 7572  tes the curvatur
+00016330: 6520 7265 736f 6c75 7469 6f6e 2069 6e20  e resolution in 
+00016340: 6e75 6d62 6572 206f 660a 2020 2020 2020  number of.      
+00016350: 2020 2020 2020 2020 706f 696e 7473 2070          points p
+00016360: 6572 2066 756c 6c20 6369 7263 6c65 2e0a  er full circle..
+00016370: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00016380: 723a 2053 7065 6369 6669 6320 6c61 7965  r: Specific laye
+00016390: 7220 666f 7220 6e65 7720 706f 6c79 676f  r for new polygo
+000163a0: 6e73 2e0a 0a20 2020 2020 2020 2022 2222  ns...        """
+000163b0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+000163c0: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
+000163d0: 0a0a 2020 2020 2020 2020 6764 735f 6c61  ..        gds_la
+000163e0: 7965 722c 2067 6473 5f64 6174 6174 7970  yer, gds_datatyp
+000163f0: 6520 3d20 6766 2e67 6574 5f6c 6179 6572  e = gf.get_layer
+00016400: 286c 6179 6572 290a 2020 2020 2020 2020  (layer).        
+00016410: 7020 3d20 6764 7374 6b2e 6f66 6673 6574  p = gdstk.offset
+00016420: 280a 2020 2020 2020 2020 2020 2020 706f  (.            po
+00016430: 6c79 676f 6e73 206f 7220 7365 6c66 2e67  lygons or self.g
+00016440: 6574 5f70 6f6c 7967 6f6e 7328 292c 0a20  et_polygons(),. 
+00016450: 2020 2020 2020 2020 2020 2064 6973 7461             dista
+00016460: 6e63 653d 6469 7374 616e 6365 2c0a 2020  nce=distance,.  
+00016470: 2020 2020 2020 2020 2020 6a6f 696e 3d6a            join=j
+00016480: 6f69 6e2c 0a20 2020 2020 2020 2020 2020  oin,.           
+00016490: 2074 6f6c 6572 616e 6365 3d74 6f6c 6572   tolerance=toler
+000164a0: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
+000164b0: 2020 7072 6563 6973 696f 6e3d 7072 6563    precision=prec
+000164c0: 6973 696f 6e2c 0a20 2020 2020 2020 2020  ision,.         
+000164d0: 2020 2075 7365 5f75 6e69 6f6e 3d75 7365     use_union=use
+000164e0: 5f75 6e69 6f6e 2c0a 2020 2020 2020 2020  _union,.        
+000164f0: 2020 2020 6c61 7965 723d 6764 735f 6c61      layer=gds_la
+00016500: 7965 722c 0a20 2020 2020 2020 2020 2020  yer,.           
+00016510: 2064 6174 6174 7970 653d 6764 735f 6461   datatype=gds_da
+00016520: 7461 7479 7065 2c0a 2020 2020 2020 2020  tatype,.        
+00016530: 290a 0a20 2020 2020 2020 2063 6f6d 706f  )..        compo
+00016540: 6e65 6e74 203d 2067 662e 436f 6d70 6f6e  nent = gf.Compon
+00016550: 656e 7428 290a 2020 2020 2020 2020 636f  ent().        co
+00016560: 6d70 6f6e 656e 742e 6164 645f 706f 6c79  mponent.add_poly
+00016570: 676f 6e28 702c 206c 6179 6572 3d6c 6179  gon(p, layer=lay
+00016580: 6572 290a 2020 2020 2020 2020 7265 7475  er).        retu
+00016590: 726e 2063 6f6d 706f 6e65 6e74 0a0a 0a64  rn component...d
+000165a0: 6566 2063 6f70 7928 0a20 2020 2044 3a20  ef copy(.    D: 
+000165b0: 436f 6d70 6f6e 656e 742c 0a20 2020 2072  Component,.    r
+000165c0: 6566 6572 656e 6365 733d 4e6f 6e65 2c0a  eferences=None,.
+000165d0: 2020 2020 706f 7274 733d 4e6f 6e65 2c0a      ports=None,.
+000165e0: 2020 2020 706f 6c79 676f 6e73 3d4e 6f6e      polygons=Non
+000165f0: 652c 0a20 2020 2070 6174 6873 3d4e 6f6e  e,.    paths=Non
+00016600: 652c 0a20 2020 206e 616d 653d 4e6f 6e65  e,.    name=None
+00016610: 2c0a 2020 2020 6c61 6265 6c73 3d4e 6f6e  ,.    labels=Non
+00016620: 652c 0a29 202d 3e20 436f 6d70 6f6e 656e  e,.) -> Componen
+00016630: 743a 0a20 2020 2022 2222 5265 7475 726e  t:.    """Return
+00016640: 7320 6120 436f 6d70 6f6e 656e 7420 636f  s a Component co
+00016650: 7079 2e0a 0a20 2020 2041 7267 733a 0a20  py...    Args:. 
+00016660: 2020 2020 2020 2044 3a20 636f 6d70 6f6e         D: compon
+00016670: 656e 7420 746f 2063 6f70 792e 0a20 2020  ent to copy..   
+00016680: 2022 2222 0a20 2020 2044 5f63 6f70 7920   """.    D_copy 
+00016690: 3d20 436f 6d70 6f6e 656e 7428 290a 2020  = Component().  
+000166a0: 2020 445f 636f 7079 2e69 6e66 6f20 3d20    D_copy.info = 
+000166b0: 442e 696e 666f 0a20 2020 2023 2044 5f63  D.info.    # D_c
+000166c0: 6f70 792e 5f63 656c 6c20 3d20 442e 5f63  opy._cell = D._c
+000166d0: 656c 6c2e 636f 7079 286e 616d 653d 445f  ell.copy(name=D_
+000166e0: 636f 7079 2e6e 616d 6529 0a0a 2020 2020  copy.name)..    
+000166f0: 666f 7220 7265 6620 696e 2072 6566 6572  for ref in refer
+00016700: 656e 6365 7320 6966 2072 6566 6572 656e  ences if referen
+00016710: 6365 7320 6973 206e 6f74 204e 6f6e 6520  ces is not None 
+00016720: 656c 7365 2044 2e72 6566 6572 656e 6365  else D.reference
+00016730: 733a 0a20 2020 2020 2020 2044 5f63 6f70  s:.        D_cop
+00016740: 792e 6164 6428 636f 7079 5f72 6566 6572  y.add(copy_refer
+00016750: 656e 6365 2872 6566 2929 0a20 2020 2066  ence(ref)).    f
+00016760: 6f72 2070 6f72 7420 696e 2028 706f 7274  or port in (port
+00016770: 7320 6966 2070 6f72 7473 2069 7320 6e6f  s if ports is no
+00016780: 7420 4e6f 6e65 2065 6c73 6520 442e 706f  t None else D.po
+00016790: 7274 7329 2e76 616c 7565 7328 293a 0a20  rts).values():. 
+000167a0: 2020 2020 2020 2044 5f63 6f70 792e 6164         D_copy.ad
+000167b0: 645f 706f 7274 2870 6f72 743d 706f 7274  d_port(port=port
+000167c0: 290a 2020 2020 666f 7220 706f 6c79 2069  ).    for poly i
+000167d0: 6e20 706f 6c79 676f 6e73 2069 6620 706f  n polygons if po
+000167e0: 6c79 676f 6e73 2069 7320 6e6f 7420 4e6f  lygons is not No
+000167f0: 6e65 2065 6c73 6520 442e 706f 6c79 676f  ne else D.polygo
+00016800: 6e73 3a0a 2020 2020 2020 2020 445f 636f  ns:.        D_co
+00016810: 7079 2e61 6464 5f70 6f6c 7967 6f6e 2870  py.add_polygon(p
+00016820: 6f6c 7929 0a20 2020 2066 6f72 2070 6174  oly).    for pat
+00016830: 6820 696e 2070 6174 6873 2069 6620 7061  h in paths if pa
+00016840: 7468 7320 6973 206e 6f74 204e 6f6e 6520  ths is not None 
+00016850: 656c 7365 2044 2e70 6174 6873 3a0a 2020  else D.paths:.  
+00016860: 2020 2020 2020 445f 636f 7079 2e61 6464        D_copy.add
+00016870: 2870 6174 6829 0a20 2020 2066 6f72 206c  (path).    for l
+00016880: 6162 656c 2069 6e20 6c61 6265 6c73 2069  abel in labels i
+00016890: 6620 6c61 6265 6c73 2069 7320 6e6f 7420  f labels is not 
+000168a0: 4e6f 6e65 2065 6c73 6520 442e 6c61 6265  None else D.labe
+000168b0: 6c73 3a0a 2020 2020 2020 2020 445f 636f  ls:.        D_co
+000168c0: 7079 2e61 6464 5f6c 6162 656c 280a 2020  py.add_label(.  
+000168d0: 2020 2020 2020 2020 2020 7465 7874 3d6c            text=l
+000168e0: 6162 656c 2e74 6578 742c 0a20 2020 2020  abel.text,.     
+000168f0: 2020 2020 2020 2070 6f73 6974 696f 6e3d         position=
+00016900: 6c61 6265 6c2e 6f72 6967 696e 2c0a 2020  label.origin,.  
+00016910: 2020 2020 2020 2020 2020 6c61 7965 723d            layer=
+00016920: 286c 6162 656c 2e6c 6179 6572 2c20 6c61  (label.layer, la
+00016930: 6265 6c2e 7465 7874 7479 7065 292c 0a20  bel.texttype),. 
+00016940: 2020 2020 2020 2029 0a0a 2020 2020 6966         )..    if
+00016950: 206e 616d 6520 6973 206e 6f74 204e 6f6e   name is not Non
+00016960: 653a 0a20 2020 2020 2020 2044 5f63 6f70  e:.        D_cop
+00016970: 792e 6e61 6d65 203d 206e 616d 650a 0a20  y.name = name.. 
+00016980: 2020 2072 6574 7572 6e20 445f 636f 7079     return D_copy
+00016990: 0a0a 0a64 6566 2063 6f70 795f 7265 6665  ...def copy_refe
+000169a0: 7265 6e63 6528 0a20 2020 2072 6566 2c0a  rence(.    ref,.
+000169b0: 2020 2020 7061 7265 6e74 3d4e 6f6e 652c      parent=None,
+000169c0: 0a20 2020 2063 6f6c 756d 6e73 3d4e 6f6e  .    columns=Non
+000169d0: 652c 0a20 2020 2072 6f77 733d 4e6f 6e65  e,.    rows=None
+000169e0: 2c0a 2020 2020 7370 6163 696e 673d 4e6f  ,.    spacing=No
+000169f0: 6e65 2c0a 2020 2020 6f72 6967 696e 3d4e  ne,.    origin=N
+00016a00: 6f6e 652c 0a20 2020 2072 6f74 6174 696f  one,.    rotatio
+00016a10: 6e3d 4e6f 6e65 2c0a 2020 2020 6d61 676e  n=None,.    magn
+00016a20: 6966 6963 6174 696f 6e3d 4e6f 6e65 2c0a  ification=None,.
+00016a30: 2020 2020 785f 7265 666c 6563 7469 6f6e      x_reflection
+00016a40: 3d4e 6f6e 652c 0a20 2020 206e 616d 653d  =None,.    name=
+00016a50: 4e6f 6e65 2c0a 2020 2020 7631 3d4e 6f6e  None,.    v1=Non
+00016a60: 652c 0a20 2020 2076 323d 4e6f 6e65 2c0a  e,.    v2=None,.
+00016a70: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
+00016a80: 6665 7265 6e63 653a 0a20 2020 2072 6574  ference:.    ret
+00016a90: 7572 6e20 436f 6d70 6f6e 656e 7452 6566  urn ComponentRef
+00016aa0: 6572 656e 6365 280a 2020 2020 2020 2020  erence(.        
+00016ab0: 636f 6d70 6f6e 656e 743d 7061 7265 6e74  component=parent
+00016ac0: 206f 7220 7265 662e 7061 7265 6e74 2c0a   or ref.parent,.
+00016ad0: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+00016ae0: 636f 6c75 6d6e 7320 6f72 2072 6566 2e63  columns or ref.c
+00016af0: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
+00016b00: 726f 7773 3d72 6f77 7320 6f72 2072 6566  rows=rows or ref
+00016b10: 2e72 6f77 732c 0a20 2020 2020 2020 2073  .rows,.        s
+00016b20: 7061 6369 6e67 3d73 7061 6369 6e67 206f  pacing=spacing o
+00016b30: 7220 7265 662e 7370 6163 696e 672c 0a20  r ref.spacing,. 
+00016b40: 2020 2020 2020 206f 7269 6769 6e3d 6f72         origin=or
+00016b50: 6967 696e 206f 7220 7265 662e 6f72 6967  igin or ref.orig
+00016b60: 696e 2c0a 2020 2020 2020 2020 726f 7461  in,.        rota
+00016b70: 7469 6f6e 3d72 6f74 6174 696f 6e20 6f72  tion=rotation or
+00016b80: 2072 6566 2e72 6f74 6174 696f 6e2c 0a20   ref.rotation,. 
+00016b90: 2020 2020 2020 206d 6167 6e69 6669 6361         magnifica
+00016ba0: 7469 6f6e 3d6d 6167 6e69 6669 6361 7469  tion=magnificati
+00016bb0: 6f6e 206f 7220 7265 662e 6d61 676e 6966  on or ref.magnif
+00016bc0: 6963 6174 696f 6e2c 0a20 2020 2020 2020  ication,.       
+00016bd0: 2078 5f72 6566 6c65 6374 696f 6e3d 785f   x_reflection=x_
+00016be0: 7265 666c 6563 7469 6f6e 206f 7220 7265  reflection or re
+00016bf0: 662e 785f 7265 666c 6563 7469 6f6e 2c0a  f.x_reflection,.
+00016c00: 2020 2020 2020 2020 6e61 6d65 3d6e 616d          name=nam
+00016c10: 6520 6f72 2072 6566 2e6e 616d 652c 0a20  e or ref.name,. 
+00016c20: 2020 2020 2020 2076 313d 7631 206f 7220         v1=v1 or 
+00016c30: 7265 662e 7631 2c0a 2020 2020 2020 2020  ref.v1,.        
+00016c40: 7632 3d76 3220 6f72 2072 6566 2e76 322c  v2=v2 or ref.v2,
+00016c50: 0a20 2020 2029 0a0a 0a64 6566 2074 6573  .    )...def tes
+00016c60: 745f 6765 745f 6c61 7965 7273 2829 202d  t_get_layers() -
+00016c70: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
+00016c80: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
+00016c90: 2067 660a 0a20 2020 2063 3120 3d20 6766   gf..    c1 = gf
+00016ca0: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
+00016cb0: 6967 6874 280a 2020 2020 2020 2020 6c65  ight(.        le
+00016cc0: 6e67 7468 3d31 302c 0a20 2020 2020 2020  ngth=10,.       
+00016cd0: 2077 6964 7468 3d30 2e35 2c0a 2020 2020   width=0.5,.    
+00016ce0: 2020 2020 6c61 7965 723d 2832 2c20 3029      layer=(2, 0)
+00016cf0: 2c0a 2020 2020 2020 2020 6262 6f78 5f6c  ,.        bbox_l
+00016d00: 6179 6572 733d 5b28 3131 312c 2030 295d  ayers=[(111, 0)]
+00016d10: 2c0a 2020 2020 2020 2020 6262 6f78 5f6f  ,.        bbox_o
+00016d20: 6666 7365 7473 3d5b 335d 2c0a 2020 2020  ffsets=[3],.    
+00016d30: 2020 2020 7769 7468 5f62 626f 783d 5472      with_bbox=Tr
+00016d40: 7565 2c0a 2020 2020 2020 2020 636c 6164  ue,.        clad
+00016d50: 6469 6e67 5f6c 6179 6572 733d 4e6f 6e65  ding_layers=None
+00016d60: 2c0a 2020 2020 2020 2020 6164 645f 7069  ,.        add_pi
+00016d70: 6e73 3d4e 6f6e 652c 0a20 2020 2020 2020  ns=None,.       
+00016d80: 2061 6464 5f62 626f 783d 4e6f 6e65 2c0a   add_bbox=None,.
+00016d90: 2020 2020 290a 2020 2020 6173 7365 7274      ).    assert
+00016da0: 2063 312e 6765 745f 6c61 7965 7273 2829   c1.get_layers()
+00016db0: 203d 3d20 7b28 322c 2030 292c 2028 3131   == {(2, 0), (11
+00016dc0: 312c 2030 297d 2c20 6331 2e67 6574 5f6c  1, 0)}, c1.get_l
+00016dd0: 6179 6572 7328 290a 2020 2020 2320 7265  ayers().    # re
+00016de0: 7475 726e 2063 310a 2020 2020 6332 203d  turn c1.    c2 =
+00016df0: 2063 312e 7265 6d6f 7665 5f6c 6179 6572   c1.remove_layer
+00016e00: 7328 5b28 3131 312c 2030 295d 290a 2020  s([(111, 0)]).  
+00016e10: 2020 6173 7365 7274 2063 322e 6765 745f    assert c2.get_
+00016e20: 6c61 7965 7273 2829 203d 3d20 7b28 322c  layers() == {(2,
+00016e30: 2030 297d 2c20 6332 2e67 6574 5f6c 6179   0)}, c2.get_lay
+00016e40: 6572 7328 290a 0a0a 6465 6620 5f66 696c  ers()...def _fil
+00016e50: 7465 725f 706f 6c79 7328 706f 6c79 676f  ter_polys(polygo
+00016e60: 6e73 2c20 6c61 7965 7273 5f65 7863 6c29  ns, layers_excl)
+00016e70: 3a0a 2020 2020 7265 7475 726e 205b 0a20  :.    return [. 
+00016e80: 2020 2020 2020 2070 6f6c 7967 6f6e 0a20         polygon. 
+00016e90: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
+00016ea0: 6f6e 2c20 6c61 7965 722c 2064 6174 6174  on, layer, datat
+00016eb0: 7970 6520 696e 207a 6970 280a 2020 2020  ype in zip(.    
+00016ec0: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00016ed0: 2e70 6f6c 7967 6f6e 732c 2070 6f6c 7967  .polygons, polyg
+00016ee0: 6f6e 732e 6c61 7965 7273 2c20 706f 6c79  ons.layers, poly
+00016ef0: 676f 6e73 2e64 6174 6174 7970 6573 0a20  gons.datatypes. 
+00016f00: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00016f10: 2069 6620 286c 6179 6572 2c20 6461 7461   if (layer, data
+00016f20: 7479 7065 2920 6e6f 7420 696e 206c 6179  type) not in lay
+00016f30: 6572 735f 6578 636c 0a20 2020 205d 0a0a  ers_excl.    ]..
+00016f40: 0a64 6566 2072 6563 7572 7365 5f73 7472  .def recurse_str
+00016f50: 7563 7475 7265 7328 0a20 2020 2063 6f6d  uctures(.    com
+00016f60: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
+00016f70: 742c 0a20 2020 2069 676e 6f72 655f 636f  t,.    ignore_co
+00016f80: 6d70 6f6e 656e 7473 5f70 7265 6669 783a  mponents_prefix:
+00016f90: 206c 6973 745b 7374 725d 207c 204e 6f6e   list[str] | Non
+00016fa0: 6520 3d20 4e6f 6e65 2c0a 2020 2020 6967  e = None,.    ig
+00016fb0: 6e6f 7265 5f66 756e 6374 696f 6e73 5f70  nore_functions_p
+00016fc0: 7265 6669 783a 206c 6973 745b 7374 725d  refix: list[str]
+00016fd0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00016fe0: 2920 2d3e 2064 6963 745b 7374 722c 2041  ) -> dict[str, A
+00016ff0: 6e79 5d3a 0a20 2020 2022 2222 5265 6375  ny]:.    """Recu
+00017000: 7273 6520 636f 6d70 6f6e 656e 7420 616e  rse component an
+00017010: 6420 636f 6d70 6f6e 656e 7473 2072 6566  d components ref
+00017020: 6572 656e 6365 7320 7265 6375 7273 6976  erences recursiv
+00017030: 656c 792e 0a0a 2020 2020 4172 6773 3a0a  ely...    Args:.
+00017040: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00017050: 743a 2063 6f6d 706f 6e65 6e74 2074 6f20  t: component to 
+00017060: 7265 6375 7273 652e 0a20 2020 2020 2020  recurse..       
+00017070: 2069 676e 6f72 655f 636f 6d70 6f6e 656e   ignore_componen
+00017080: 7473 5f70 7265 6669 783a 206c 6973 7420  ts_prefix: list 
+00017090: 6f66 2070 7265 6669 7820 746f 2069 676e  of prefix to ign
+000170a0: 6f72 652e 0a20 2020 2020 2020 2069 676e  ore..        ign
+000170b0: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+000170c0: 6566 6978 3a20 6c69 7374 206f 6620 7072  efix: list of pr
+000170d0: 6566 6978 2074 6f20 6967 6e6f 7265 2e0a  efix to ignore..
+000170e0: 2020 2020 2222 220a 2020 2020 6967 6e6f      """.    igno
+000170f0: 7265 5f66 756e 6374 696f 6e73 5f70 7265  re_functions_pre
+00017100: 6669 7820 3d20 6967 6e6f 7265 5f66 756e  fix = ignore_fun
+00017110: 6374 696f 6e73 5f70 7265 6669 7820 6f72  ctions_prefix or
+00017120: 205b 5d0a 2020 2020 6967 6e6f 7265 5f63   [].    ignore_c
+00017130: 6f6d 706f 6e65 6e74 735f 7072 6566 6978  omponents_prefix
+00017140: 203d 2069 676e 6f72 655f 636f 6d70 6f6e   = ignore_compon
+00017150: 656e 7473 5f70 7265 6669 7820 6f72 205b  ents_prefix or [
+00017160: 5d0a 0a20 2020 2069 6620 280a 2020 2020  ]..    if (.    
+00017170: 2020 2020 6861 7361 7474 7228 636f 6d70      hasattr(comp
+00017180: 6f6e 656e 742c 2022 6675 6e63 7469 6f6e  onent, "function
+00017190: 5f6e 616d 6522 290a 2020 2020 2020 2020  _name").        
+000171a0: 616e 6420 636f 6d70 6f6e 656e 742e 6675  and component.fu
+000171b0: 6e63 7469 6f6e 5f6e 616d 6520 696e 2069  nction_name in i
+000171c0: 676e 6f72 655f 6675 6e63 7469 6f6e 735f  gnore_functions_
+000171d0: 7072 6566 6978 0a20 2020 2029 3a0a 2020  prefix.    ):.  
+000171e0: 2020 2020 2020 7265 7475 726e 207b 7d0a        return {}.
+000171f0: 0a20 2020 2069 6620 6861 7361 7474 7228  .    if hasattr(
+00017200: 636f 6d70 6f6e 656e 742c 2022 6e61 6d65  component, "name
+00017210: 2229 2061 6e64 2061 6e79 280a 2020 2020  ") and any(.    
+00017220: 2020 2020 636f 6d70 6f6e 656e 742e 6e61      component.na
+00017230: 6d65 2e73 7461 7274 7377 6974 6828 6929  me.startswith(i)
+00017240: 2066 6f72 2069 2069 6e20 6967 6e6f 7265   for i in ignore
+00017250: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
+00017260: 6978 0a20 2020 2029 3a0a 2020 2020 2020  ix.    ):.      
+00017270: 2020 7265 7475 726e 207b 7d0a 0a20 2020    return {}..   
+00017280: 206f 7574 7075 7420 3d20 7b63 6f6d 706f   output = {compo
+00017290: 6e65 6e74 2e6e 616d 653a 2064 6963 7428  nent.name: dict(
+000172a0: 636f 6d70 6f6e 656e 742e 7365 7474 696e  component.settin
+000172b0: 6773 297d 0a20 2020 2066 6f72 2072 6566  gs)}.    for ref
+000172c0: 6572 656e 6365 2069 6e20 636f 6d70 6f6e  erence in compon
+000172d0: 656e 742e 7265 6665 7265 6e63 6573 3a0a  ent.references:.
+000172e0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+000172f0: 2020 2020 2020 2020 2069 7369 6e73 7461           isinsta
+00017300: 6e63 6528 7265 6665 7265 6e63 652c 2043  nce(reference, C
+00017310: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00017320: 6529 0a20 2020 2020 2020 2020 2020 2061  e).            a
+00017330: 6e64 2072 6566 6572 656e 6365 2e72 6566  nd reference.ref
+00017340: 5f63 656c 6c2e 6e61 6d65 206e 6f74 2069  _cell.name not i
+00017350: 6e20 6f75 7470 7574 0a20 2020 2020 2020  n output.       
+00017360: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00017370: 6f75 7470 7574 2e75 7064 6174 6528 7265  output.update(re
+00017380: 6375 7273 655f 7374 7275 6374 7572 6573  curse_structures
+00017390: 2872 6566 6572 656e 6365 2e72 6566 5f63  (reference.ref_c
+000173a0: 656c 6c29 290a 0a20 2020 2072 6574 7572  ell))..    retur
+000173b0: 6e20 6f75 7470 7574 0a0a 0a64 6566 2066  n output...def f
+000173c0: 6c61 7474 656e 5f69 6e76 616c 6964 5f72  latten_invalid_r
+000173d0: 6566 735f 7265 6375 7273 6976 6528 0a20  efs_recursive(. 
+000173e0: 2020 2063 6f6d 706f 6e65 6e74 3a20 436f     component: Co
+000173f0: 6d70 6f6e 656e 742c 0a20 2020 2067 7269  mponent,.    gri
+00017400: 645f 7369 7a65 3a20 666c 6f61 7420 7c20  d_size: float | 
+00017410: 4e6f 6e65 203d 204e 6f6e 652c 0a20 2020  None = None,.   
+00017420: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
+00017430: 6e74 733d 4e6f 6e65 2c0a 2020 2020 7472  nts=None,.    tr
+00017440: 6176 6572 7365 645f 636f 6d70 6f6e 656e  aversed_componen
+00017450: 7473 3d4e 6f6e 652c 0a29 3a0a 2020 2020  ts=None,.):.    
+00017460: 2222 2252 6563 7572 7369 7665 6c79 2066  """Recursively f
+00017470: 6c61 7474 656e 7320 636f 6d70 6f6e 656e  lattens componen
+00017480: 7420 7265 6665 7265 6e63 6573 2077 6869  t references whi
+00017490: 6368 2068 6176 6520 696e 7661 6c69 6420  ch have invalid 
+000174a0: 7472 616e 7366 6f72 6d61 7469 6f6e 7320  transformations 
+000174b0: 2869 2e65 2e20 6e6f 6e2d 3930 2064 6567  (i.e. non-90 deg
+000174c0: 2072 6f74 6174 696f 6e73 206f 7220 7375   rotations or su
+000174d0: 622d 6772 6964 2074 7261 6e73 6c61 7469  b-grid translati
+000174e0: 6f6e 7329 2061 6e64 2072 6574 7572 6e73  ons) and returns
+000174f0: 2061 2063 6f70 7920 6966 2061 6e79 2073   a copy if any s
+00017500: 7562 6365 6c6c 7320 6861 7665 2062 6565  ubcells have bee
+00017510: 6e20 6d6f 6469 6669 6564 2e0a 0a20 2020  n modified...   
+00017520: 2057 4152 4e49 4e47 3a20 7468 6973 2066   WARNING: this f
+00017530: 756e 6374 696f 6e20 7769 6c6c 2070 726f  unction will pro
+00017540: 6475 6365 2073 616d 652d 6e61 6d65 2063  duce same-name c
+00017550: 6f70 6965 7320 6f66 2063 656c 6c73 2e20  opies of cells. 
+00017560: 4974 2069 7320 7374 7269 6374 6c79 206d  It is strictly m
+00017570: 6561 6e74 2074 6f20 6265 2075 7365 6420  eant to be used 
+00017580: 6f6e 2077 7269 7465 206f 6620 7468 6520  on write of the 
+00017590: 4744 5320 6669 6c65 2061 6e64 0a20 2020  GDS file and.   
+000175a0: 2073 686f 756c 6420 6e6f 7420 6265 206d   should not be m
+000175b0: 6978 6564 2077 6974 6820 6f74 6865 7220  ixed with other 
+000175c0: 6365 6c6c 732c 206f 7220 796f 7520 7769  cells, or you wi
+000175d0: 6c6c 206c 696b 656c 7920 6578 7065 7269  ll likely experi
+000175e0: 656e 6365 2069 7373 7565 7320 7769 7468  ence issues with
+000175f0: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
+00017600: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
+00017610: 2020 2020 636f 6d70 6f6e 656e 743a 2074      component: t
+00017620: 6865 2063 6f6d 706f 6e65 6e74 2074 6f20  he component to 
+00017630: 6669 7820 2869 6e20 706c 6163 6529 2e0a  fix (in place)..
+00017640: 2020 2020 2020 2020 6772 6964 5f73 697a          grid_siz
+00017650: 653a 2074 6865 2047 4453 2067 7269 6420  e: the GDS grid 
+00017660: 7369 7a65 2c20 696e 2075 6d2c 2064 6566  size, in um, def
+00017670: 6175 6c74 7320 746f 2061 6374 6976 6520  aults to active 
+00017680: 5044 4b2e 6765 745f 6772 6964 5f73 697a  PDK.get_grid_siz
+00017690: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+000176a0: 616e 7920 7472 616e 736c 6174 696f 6e73  any translations
+000176b0: 2077 6974 6820 6869 6768 6572 2072 6573   with higher res
+000176c0: 6f6c 7574 696f 6e20 7468 616e 2074 6869  olution than thi
+000176d0: 7320 6172 6520 636f 6e73 6964 6572 6564  s are considered
+000176e0: 2069 6e76 616c 6964 2e0a 2020 2020 2020   invalid..      
+000176f0: 2020 7570 6461 7465 645f 636f 6d70 6f6e    updated_compon
+00017700: 656e 7473 3a20 7468 6520 7275 6e6e 696e  ents: the runnin
+00017710: 6720 6469 6374 696f 6e61 7279 206f 6620  g dictionary of 
+00017720: 636f 6d70 6f6e 656e 7473 2077 6869 6368  components which
+00017730: 2068 6176 6520 6265 656e 206d 6f64 6966   have been modif
+00017740: 6965 6420 6279 2074 6869 7320 7472 616e  ied by this tran
+00017750: 7366 6f72 6d61 7469 6f6e 2e20 5368 6f75  sformation. Shou
+00017760: 6c64 2061 6c77 6179 7320 6265 204e 6f6e  ld always be Non
+00017770: 652c 2065 7863 6570 7420 666f 7220 7265  e, except for re
+00017780: 6375 7273 6976 6520 696e 766f 6361 7469  cursive invocati
+00017790: 6f6e 732e 0a20 2020 2020 2020 2074 7261  ons..        tra
+000177a0: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
+000177b0: 733a 2074 6865 2073 6574 206f 6620 636f  s: the set of co
+000177c0: 6d70 6f6e 656e 7420 6e61 6d65 7320 7768  mponent names wh
+000177d0: 6963 6820 6861 7665 2062 6565 6e20 7472  ich have been tr
+000177e0: 6176 6572 7365 642e 2053 686f 756c 6420  aversed. Should 
+000177f0: 616c 7761 7973 2062 6520 4e6f 6e65 2c20  always be None, 
+00017800: 6578 6365 7074 2066 6f72 2072 6563 7572  except for recur
+00017810: 7369 7665 2069 6e76 6f63 6174 696f 6e73  sive invocations
+00017820: 2e0a 2020 2020 2222 220a 2020 2020 6672  ..    """.    fr
+00017830: 6f6d 2067 6473 6661 6374 6f72 792e 6465  om gdsfactory.de
+00017840: 636f 7261 746f 7273 2069 6d70 6f72 7420  corators import 
+00017850: 6973 5f69 6e76 616c 6964 5f72 6566 0a0a  is_invalid_ref..
+00017860: 2020 2020 696e 7661 6c69 645f 7265 6673      invalid_refs
+00017870: 203d 205b 5d0a 2020 2020 7265 6673 203d   = [].    refs =
+00017880: 2063 6f6d 706f 6e65 6e74 2e72 6566 6572   component.refer
+00017890: 656e 6365 730a 2020 2020 7375 6263 656c  ences.    subcel
+000178a0: 6c5f 6d6f 6469 6669 6564 203d 2046 616c  l_modified = Fal
+000178b0: 7365 0a20 2020 2069 6620 7570 6461 7465  se.    if update
+000178c0: 645f 636f 6d70 6f6e 656e 7473 2069 7320  d_components is 
+000178d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7570  None:.        up
+000178e0: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
+000178f0: 203d 207b 7d0a 2020 2020 6966 2074 7261   = {}.    if tra
+00017900: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
+00017910: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00017920: 2020 2074 7261 7665 7273 6564 5f63 6f6d     traversed_com
+00017930: 706f 6e65 6e74 7320 3d20 7365 7428 290a  ponents = set().
+00017940: 2020 2020 666f 7220 7265 6620 696e 2072      for ref in r
+00017950: 6566 733a 0a20 2020 2020 2020 2023 206d  efs:.        # m
+00017960: 6172 6b20 616e 7920 696e 7661 6c69 6420  ark any invalid 
+00017970: 7265 6673 2066 6f72 2066 6c61 7474 656e  refs for flatten
+00017980: 696e 670a 2020 2020 2020 2020 2320 6f74  ing.        # ot
+00017990: 6865 7277 6973 652c 2063 6865 636b 2069  herwise, check i
+000179a0: 6620 7468 6572 6520 6172 6520 616e 7920  f there are any 
+000179b0: 6d6f 6469 6669 6564 2063 656c 6c73 2062  modified cells b
+000179c0: 656e 6561 7468 2028 7765 206e 6565 6420  eneath (we need 
+000179d0: 6e6f 7420 646f 2074 6869 7320 6966 2074  not do this if t
+000179e0: 6865 2072 6566 2077 696c 6c20 6265 2066  he ref will be f
+000179f0: 6c61 7474 656e 6564 2061 6e79 7761 7973  lattened anyways
+00017a00: 290a 2020 2020 2020 2020 6966 2069 735f  ).        if is_
+00017a10: 696e 7661 6c69 645f 7265 6628 7265 662c  invalid_ref(ref,
+00017a20: 2067 7269 645f 7369 7a65 293a 0a20 2020   grid_size):.   
+00017a30: 2020 2020 2020 2020 2069 6e76 616c 6964           invalid
+00017a40: 5f72 6566 732e 6170 7065 6e64 2872 6566  _refs.append(ref
+00017a50: 2e6e 616d 6529 0a20 2020 2020 2020 2065  .name).        e
+00017a60: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00017a70: 2023 206f 7468 6572 7769 7365 2c20 7265   # otherwise, re
+00017a80: 6375 7273 6976 656c 7920 666c 6174 7465  cursively flatte
+00017a90: 6e20 7265 6673 2069 6620 7468 6520 7375  n refs if the su
+00017aa0: 6263 656c 6c20 6861 7320 6e6f 7420 616c  bcell has not al
+00017ab0: 7265 6164 7920 6265 656e 2074 7261 7665  ready been trave
+00017ac0: 7273 6564 0a20 2020 2020 2020 2020 2020  rsed.           
+00017ad0: 2069 6620 7265 662e 7061 7265 6e74 2e6e   if ref.parent.n
+00017ae0: 616d 6520 6e6f 7420 696e 2074 7261 7665  ame not in trave
+00017af0: 7273 6564 5f63 6f6d 706f 6e65 6e74 733a  rsed_components:
+00017b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017b10: 2066 6c61 7474 656e 5f69 6e76 616c 6964   flatten_invalid
+00017b20: 5f72 6566 735f 7265 6375 7273 6976 6528  _refs_recursive(
+00017b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017b40: 2020 2020 2072 6566 2e70 6172 656e 742c       ref.parent,
+00017b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017b60: 2020 2020 2067 7269 645f 7369 7a65 3d67       grid_size=g
+00017b70: 7269 645f 7369 7a65 2c0a 2020 2020 2020  rid_size,.      
+00017b80: 2020 2020 2020 2020 2020 2020 2020 7570                up
+00017b90: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
+00017ba0: 3d75 7064 6174 6564 5f63 6f6d 706f 6e65  =updated_compone
+00017bb0: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
+00017bc0: 2020 2020 2020 2020 2074 7261 7665 7273           travers
+00017bd0: 6564 5f63 6f6d 706f 6e65 6e74 733d 7472  ed_components=tr
+00017be0: 6176 6572 7365 645f 636f 6d70 6f6e 656e  aversed_componen
+00017bf0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00017c00: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00017c10: 2020 2320 6e6f 772c 2069 6620 7468 6520    # now, if the 
+00017c20: 7265 6627 7320 6365 6c6c 2062 6565 6e20  ref's cell been 
+00017c30: 6d6f 6469 6669 6564 2c20 6d61 726b 2069  modified, mark i
+00017c40: 7420 6173 2073 7563 680a 2020 2020 2020  t as such.      
+00017c50: 2020 2020 2020 6966 2072 6566 2e70 6172        if ref.par
+00017c60: 656e 742e 6e61 6d65 2069 6e20 7570 6461  ent.name in upda
+00017c70: 7465 645f 636f 6d70 6f6e 656e 7473 3a0a  ted_components:.
+00017c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c90: 7375 6263 656c 6c5f 6d6f 6469 6669 6564  subcell_modified
+00017ca0: 203d 2054 7275 650a 2020 2020 6966 2069   = True.    if i
+00017cb0: 6e76 616c 6964 5f72 6566 7320 6f72 2073  nvalid_refs or s
+00017cc0: 7562 6365 6c6c 5f6d 6f64 6966 6965 643a  ubcell_modified:
+00017cd0: 0a20 2020 2020 2020 206e 6577 5f63 6f6d  .        new_com
+00017ce0: 706f 6e65 6e74 203d 2063 6f6d 706f 6e65  ponent = compone
+00017cf0: 6e74 2e63 6f70 7928 290a 2020 2020 2020  nt.copy().      
+00017d00: 2020 6e65 775f 636f 6d70 6f6e 656e 742e    new_component.
+00017d10: 6e61 6d65 203d 2063 6f6d 706f 6e65 6e74  name = component
+00017d20: 2e6e 616d 650a 2020 2020 2020 2020 2320  .name.        # 
+00017d30: 6d61 6b65 2073 7572 6520 616c 6c20 6d6f  make sure all mo
+00017d40: 6469 6669 6564 2063 656c 6c73 2068 6176  dified cells hav
+00017d50: 6520 7468 6569 7220 7265 6665 7265 6e63  e their referenc
+00017d60: 6573 2075 7064 6174 6564 0a20 2020 2020  es updated.     
+00017d70: 2020 206e 6577 5f72 6566 7320 3d20 6e65     new_refs = ne
+00017d80: 775f 636f 6d70 6f6e 656e 742e 7265 6665  w_component.refe
+00017d90: 7265 6e63 6573 2e63 6f70 7928 290a 2020  rences.copy().  
+00017da0: 2020 2020 2020 666f 7220 7265 6620 696e        for ref in
+00017db0: 206e 6577 5f72 6566 733a 0a20 2020 2020   new_refs:.     
+00017dc0: 2020 2020 2020 2069 6620 7265 662e 6e61         if ref.na
+00017dd0: 6d65 2069 6e20 696e 7661 6c69 645f 7265  me in invalid_re
+00017de0: 6673 3a0a 2020 2020 2020 2020 2020 2020  fs:.            
+00017df0: 2020 2020 6e65 775f 636f 6d70 6f6e 656e      new_componen
+00017e00: 742e 666c 6174 7465 6e5f 7265 6665 7265  t.flatten_refere
+00017e10: 6e63 6528 7265 6629 0a20 2020 2020 2020  nce(ref).       
+00017e20: 2020 2020 2065 6c69 6620 280a 2020 2020       elif (.    
+00017e30: 2020 2020 2020 2020 2020 2020 7265 662e              ref.
+00017e40: 7061 7265 6e74 2e6e 616d 6520 696e 2075  parent.name in u
+00017e50: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
+00017e60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00017e70: 2020 616e 6420 7265 662e 7061 7265 6e74    and ref.parent
+00017e80: 2069 7320 6e6f 7420 7570 6461 7465 645f   is not updated_
+00017e90: 636f 6d70 6f6e 656e 7473 5b72 6566 2e70  components[ref.p
+00017ea0: 6172 656e 742e 6e61 6d65 5d0a 2020 2020  arent.name].    
+00017eb0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00017ec0: 2020 2020 2020 2020 2020 2072 6566 2e70             ref.p
+00017ed0: 6172 656e 7420 3d20 7570 6461 7465 645f  arent = updated_
+00017ee0: 636f 6d70 6f6e 656e 7473 5b72 6566 2e70  components[ref.p
+00017ef0: 6172 656e 742e 6e61 6d65 5d0a 2020 2020  arent.name].    
+00017f00: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
+00017f10: 6e65 775f 636f 6d70 6f6e 656e 740a 2020  new_component.  
+00017f20: 2020 2020 2020 7570 6461 7465 645f 636f        updated_co
+00017f30: 6d70 6f6e 656e 7473 5b63 6f6d 706f 6e65  mponents[compone
+00017f40: 6e74 2e6e 616d 655d 203d 206e 6577 5f63  nt.name] = new_c
+00017f50: 6f6d 706f 6e65 6e74 0a20 2020 2074 7261  omponent.    tra
+00017f60: 7665 7273 6564 5f63 6f6d 706f 6e65 6e74  versed_component
+00017f70: 732e 6164 6428 636f 6d70 6f6e 656e 742e  s.add(component.
+00017f80: 6e61 6d65 290a 2020 2020 7265 7475 726e  name).    return
+00017f90: 2063 6f6d 706f 6e65 6e74 0a0a 0a64 6566   component...def
+00017fa0: 205f 6368 6563 6b5f 756e 6361 6368 6564   _check_uncached
+00017fb0: 5f63 6f6d 706f 6e65 6e74 7328 636f 6d70  _components(comp
+00017fc0: 6f6e 656e 742c 206d 6f64 6529 3a0a 2020  onent, mode):.  
+00017fd0: 2020 7661 6c69 645f 6d6f 6465 7320 3d20    valid_modes = 
+00017fe0: 5b22 7761 726e 222c 2022 6572 726f 7222  ["warn", "error"
+00017ff0: 2c20 2269 676e 6f72 6522 5d0a 0a20 2020  , "ignore"]..   
+00018000: 2069 6620 6d6f 6465 203d 3d20 2269 676e   if mode == "ign
+00018010: 6f72 6522 3a0a 2020 2020 2020 2020 7265  ore":.        re
+00018020: 7475 726e 0a20 2020 2065 6c69 6620 6d6f  turn.    elif mo
+00018030: 6465 206e 6f74 2069 6e20 7661 6c69 645f  de not in valid_
+00018040: 6d6f 6465 733a 0a20 2020 2020 2020 2072  modes:.        r
+00018050: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00018060: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
+00018070: 6d6f 6465 7d20 6973 206e 6f74 2061 2076  mode} is not a v
+00018080: 616c 6964 2076 616c 7565 2066 6f72 206f  alid value for o
+00018090: 6e5f 756e 6361 6368 6564 5f63 6f6d 706f  n_uncached_compo
+000180a0: 6e65 6e74 2e20 5472 7920 6f6e 6520 6f66  nent. Try one of
+000180b0: 2074 6865 7365 3a20 7b76 616c 6964 5f6d   these: {valid_m
+000180c0: 6f64 6573 7d2e 220a 2020 2020 2020 2020  odes}.".        
+000180d0: 290a 0a20 2020 2066 6f72 2073 7562 5f63  )..    for sub_c
+000180e0: 6f6d 706f 6e65 6e74 2069 6e20 636f 6d70  omponent in comp
+000180f0: 6f6e 656e 742e 6765 745f 6465 7065 6e64  onent.get_depend
+00018100: 656e 6369 6573 2872 6563 7572 7369 7665  encies(recursive
+00018110: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+00018120: 6966 206e 6f74 2073 7562 5f63 6f6d 706f  if not sub_compo
+00018130: 6e65 6e74 2e5f 6c6f 636b 6564 3a0a 2020  nent._locked:.  
+00018140: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+00018150: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
+00018160: 2020 2020 2020 6622 436f 6d70 6f6e 656e        f"Componen
+00018170: 7420 7b73 7562 5f63 6f6d 706f 6e65 6e74  t {sub_component
+00018180: 2e6e 616d 6521 727d 2077 6173 204e 4f54  .name!r} was NOT
+00018190: 2070 726f 7065 726c 7920 6c6f 636b 6564   properly locked
+000181a0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+000181b0: 2020 2020 2259 6f75 206e 6565 6420 746f      "You need to
+000181c0: 2077 7269 7465 2069 7420 696e 746f 2061   write it into a
+000181d0: 2066 756e 6374 696f 6e20 7468 6174 2068   function that h
+000181e0: 6173 2074 6865 2040 6365 6c6c 2064 6563  as the @cell dec
+000181f0: 6f72 6174 6f72 2e22 0a20 2020 2020 2020  orator.".       
+00018200: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00018210: 2020 2069 6620 6d6f 6465 203d 3d20 2277     if mode == "w
+00018220: 6172 6e22 3a0a 2020 2020 2020 2020 2020  arn":.          
+00018230: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+00018240: 6172 6e28 6d65 7373 6167 652c 2055 6e63  arn(message, Unc
+00018250: 6163 6865 6443 6f6d 706f 6e65 6e74 5761  achedComponentWa
+00018260: 726e 696e 672c 2073 7461 636b 6c65 7665  rning, stackleve
+00018270: 6c3d 3329 0a0a 2020 2020 2020 2020 2020  l=3)..          
+00018280: 2020 656c 6966 206d 6f64 6520 3d3d 2022    elif mode == "
+00018290: 6572 726f 7222 3a0a 2020 2020 2020 2020  error":.        
+000182a0: 2020 2020 2020 2020 7261 6973 6520 556e          raise Un
+000182b0: 6361 6368 6564 436f 6d70 6f6e 656e 7445  cachedComponentE
+000182c0: 7272 6f72 286d 6573 7361 6765 290a 0a0a  rror(message)...
+000182d0: 6465 6620 7465 7374 5f73 616d 655f 7569  def test_same_ui
+000182e0: 6428 2920 2d3e 204e 6f6e 653a 0a20 2020  d() -> None:.   
+000182f0: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
+00018300: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
+00018310: 3d20 436f 6d70 6f6e 656e 7428 290a 2020  = Component().  
+00018320: 2020 6320 3c3c 2067 662e 636f 6d70 6f6e    c << gf.compon
+00018330: 656e 7473 2e72 6563 7461 6e67 6c65 2829  ents.rectangle()
+00018340: 0a20 2020 2063 203c 3c20 6766 2e63 6f6d  .    c << gf.com
+00018350: 706f 6e65 6e74 732e 7265 6374 616e 676c  ponents.rectangl
+00018360: 6528 290a 0a20 2020 2072 3120 3d20 632e  e()..    r1 = c.
+00018370: 7265 6665 7265 6e63 6573 5b30 5d2e 7061  references[0].pa
+00018380: 7265 6e74 0a20 2020 2072 3220 3d20 632e  rent.    r2 = c.
+00018390: 7265 6665 7265 6e63 6573 5b31 5d2e 7061  references[1].pa
+000183a0: 7265 6e74 0a0a 2020 2020 6173 7365 7274  rent..    assert
+000183b0: 2072 312e 7569 6420 3d3d 2072 322e 7569   r1.uid == r2.ui
+000183c0: 642c 2066 227b 7231 2e75 6964 7d20 6d75  d, f"{r1.uid} mu
+000183d0: 7374 2065 7175 616c 207b 7232 2e75 6964  st equal {r2.uid
+000183e0: 7d22 0a0a 0a64 6566 2074 6573 745f 6e65  }"...def test_ne
+000183f0: 746c 6973 745f 7369 6d70 6c65 2829 202d  tlist_simple() -
+00018400: 3e20 4e6f 6e65 3a0a 2020 2020 696d 706f  > None:.    impo
+00018410: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
+00018420: 2067 660a 0a20 2020 2063 203d 2067 662e   gf..    c = gf.
+00018430: 436f 6d70 6f6e 656e 7428 290a 2020 2020  Component().    
+00018440: 6331 203d 2063 203c 3c20 6766 2e63 6f6d  c1 = c << gf.com
+00018450: 706f 6e65 6e74 732e 7374 7261 6967 6874  ponents.straight
+00018460: 286c 656e 6774 683d 312c 2077 6964 7468  (length=1, width
+00018470: 3d32 290a 2020 2020 6332 203d 2063 203c  =2).    c2 = c <
+00018480: 3c20 6766 2e63 6f6d 706f 6e65 6e74 732e  < gf.components.
+00018490: 7374 7261 6967 6874 286c 656e 6774 683d  straight(length=
+000184a0: 322c 2077 6964 7468 3d32 290a 2020 2020  2, width=2).    
+000184b0: 6332 2e63 6f6e 6e65 6374 2870 6f72 743d  c2.connect(port=
+000184c0: 226f 3122 2c20 6465 7374 696e 6174 696f  "o1", destinatio
+000184d0: 6e3d 6331 2e70 6f72 7473 5b22 6f32 225d  n=c1.ports["o2"]
+000184e0: 290a 2020 2020 632e 6164 645f 706f 7274  ).    c.add_port
+000184f0: 2822 6f31 222c 2070 6f72 743d 6331 2e70  ("o1", port=c1.p
+00018500: 6f72 7473 5b22 6f31 225d 290a 2020 2020  orts["o1"]).    
+00018510: 632e 6164 645f 706f 7274 2822 6f32 222c  c.add_port("o2",
+00018520: 2070 6f72 743d 6332 2e70 6f72 7473 5b22   port=c2.ports["
+00018530: 6f32 225d 290a 2020 2020 6e65 746c 6973  o2"]).    netlis
+00018540: 7420 3d20 632e 6765 745f 6e65 746c 6973  t = c.get_netlis
+00018550: 7428 290a 2020 2020 2320 7072 696e 7428  t().    # print(
+00018560: 6e65 746c 6973 742e 7072 6574 7479 2829  netlist.pretty()
+00018570: 290a 2020 2020 6173 7365 7274 206c 656e  ).    assert len
+00018580: 286e 6574 6c69 7374 5b22 696e 7374 616e  (netlist["instan
+00018590: 6365 7322 5d29 203d 3d20 320a 0a0a 6465  ces"]) == 2...de
+000185a0: 6620 7465 7374 5f6e 6574 6c69 7374 5f73  f test_netlist_s
+000185b0: 696d 706c 655f 7769 6474 685f 6d69 736d  imple_width_mism
+000185c0: 6174 6368 5f74 6872 6f77 735f 6572 726f  atch_throws_erro
+000185d0: 7228 2920 2d3e 204e 6f6e 653a 0a20 2020  r() -> None:.   
+000185e0: 2069 6d70 6f72 7420 7079 7465 7374 0a0a   import pytest..
+000185f0: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+00018600: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
+00018610: 2063 203d 2067 662e 436f 6d70 6f6e 656e   c = gf.Componen
+00018620: 7428 290a 2020 2020 6331 203d 2063 203c  t().    c1 = c <
+00018630: 3c20 6766 2e63 6f6d 706f 6e65 6e74 732e  < gf.components.
+00018640: 7374 7261 6967 6874 286c 656e 6774 683d  straight(length=
+00018650: 312c 2077 6964 7468 3d31 290a 2020 2020  1, width=1).    
+00018660: 6332 203d 2063 203c 3c20 6766 2e63 6f6d  c2 = c << gf.com
+00018670: 706f 6e65 6e74 732e 7374 7261 6967 6874  ponents.straight
+00018680: 286c 656e 6774 683d 322c 2077 6964 7468  (length=2, width
+00018690: 3d32 290a 2020 2020 6332 2e63 6f6e 6e65  =2).    c2.conne
+000186a0: 6374 2870 6f72 743d 226f 3122 2c20 6465  ct(port="o1", de
+000186b0: 7374 696e 6174 696f 6e3d 6331 2e70 6f72  stination=c1.por
+000186c0: 7473 5b22 6f32 225d 290a 2020 2020 632e  ts["o2"]).    c.
+000186d0: 6164 645f 706f 7274 2822 6f31 222c 2070  add_port("o1", p
+000186e0: 6f72 743d 6331 2e70 6f72 7473 5b22 6f31  ort=c1.ports["o1
+000186f0: 225d 290a 2020 2020 632e 6164 645f 706f  "]).    c.add_po
+00018700: 7274 2822 6f32 222c 2070 6f72 743d 6332  rt("o2", port=c2
+00018710: 2e70 6f72 7473 5b22 6f32 225d 290a 2020  .ports["o2"]).  
+00018720: 2020 7769 7468 2070 7974 6573 742e 7261    with pytest.ra
+00018730: 6973 6573 2856 616c 7565 4572 726f 7229  ises(ValueError)
+00018740: 3a0a 2020 2020 2020 2020 632e 6765 745f  :.        c.get_
+00018750: 6e65 746c 6973 7428 290a 0a0a 6465 6620  netlist()...def 
+00018760: 7465 7374 5f6e 6574 6c69 7374 5f63 6f6d  test_netlist_com
+00018770: 706c 6578 2829 202d 3e20 4e6f 6e65 3a0a  plex() -> None:.
+00018780: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+00018790: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
+000187a0: 2063 203d 2067 662e 636f 6d70 6f6e 656e   c = gf.componen
+000187b0: 7473 2e6d 7a69 5f61 726d 7328 290a 2020  ts.mzi_arms().  
+000187c0: 2020 6e65 746c 6973 7420 3d20 632e 6765    netlist = c.ge
+000187d0: 745f 6e65 746c 6973 7428 290a 2020 2020  t_netlist().    
+000187e0: 2320 7072 696e 7428 6e65 746c 6973 742e  # print(netlist.
+000187f0: 7072 6574 7479 2829 290a 2020 2020 6173  pretty()).    as
+00018800: 7365 7274 206c 656e 286e 6574 6c69 7374  sert len(netlist
+00018810: 5b22 696e 7374 616e 6365 7322 5d29 203d  ["instances"]) =
+00018820: 3d20 342c 206c 656e 286e 6574 6c69 7374  = 4, len(netlist
+00018830: 5b22 696e 7374 616e 6365 7322 5d29 0a0a  ["instances"])..
+00018840: 0a64 6566 2074 6573 745f 6578 7472 6163  .def test_extrac
+00018850: 7428 2920 2d3e 204e 6f6e 653a 0a20 2020  t() -> None:.   
+00018860: 2069 6d70 6f72 7420 6764 7366 6163 746f   import gdsfacto
+00018870: 7279 2061 7320 6766 0a0a 2020 2020 6320  ry as gf..    c 
+00018880: 3d20 6766 2e63 6f6d 706f 6e65 6e74 732e  = gf.components.
+00018890: 7374 7261 6967 6874 280a 2020 2020 2020  straight(.      
+000188a0: 2020 6c65 6e67 7468 3d31 302c 0a20 2020    length=10,.   
+000188b0: 2020 2020 2077 6964 7468 3d30 2e35 2c0a       width=0.5,.
+000188c0: 2020 2020 2020 2020 6262 6f78 5f6c 6179          bbox_lay
+000188d0: 6572 733d 5b67 662e 4c41 5945 522e 5747  ers=[gf.LAYER.WG
+000188e0: 434c 4144 5d2c 0a20 2020 2020 2020 2062  CLAD],.        b
+000188f0: 626f 785f 6f66 6673 6574 733d 5b33 5d2c  box_offsets=[3],
+00018900: 0a20 2020 2020 2020 2077 6974 685f 6262  .        with_bb
+00018910: 6f78 3d54 7275 652c 0a20 2020 2020 2020  ox=True,.       
+00018920: 2063 6c61 6464 696e 675f 6c61 7965 7273   cladding_layers
+00018930: 3d4e 6f6e 652c 0a20 2020 2020 2020 2061  =None,.        a
+00018940: 6464 5f70 696e 733d 4e6f 6e65 2c0a 2020  dd_pins=None,.  
+00018950: 2020 2020 2020 6164 645f 6262 6f78 3d4e        add_bbox=N
+00018960: 6f6e 652c 0a20 2020 2029 0a20 2020 2063  one,.    ).    c
+00018970: 3220 3d20 632e 6578 7472 6163 7428 6c61  2 = c.extract(la
+00018980: 7965 7273 3d5b 6766 2e4c 4159 4552 2e57  yers=[gf.LAYER.W
+00018990: 4743 4c41 445d 290a 0a20 2020 2061 7373  GCLAD])..    ass
+000189a0: 6572 7420 6c65 6e28 632e 706f 6c79 676f  ert len(c.polygo
+000189b0: 6e73 2920 3d3d 2032 2c20 6c65 6e28 632e  ns) == 2, len(c.
+000189c0: 706f 6c79 676f 6e73 290a 2020 2020 6173  polygons).    as
+000189d0: 7365 7274 206c 656e 2863 322e 706f 6c79  sert len(c2.poly
+000189e0: 676f 6e73 2920 3d3d 2031 2c20 6c65 6e28  gons) == 1, len(
+000189f0: 6332 2e70 6f6c 7967 6f6e 7329 0a20 2020  c2.polygons).   
+00018a00: 2061 7373 6572 7420 6766 2e4c 4159 4552   assert gf.LAYER
+00018a10: 2e57 4743 4c41 4420 696e 2063 322e 6c61  .WGCLAD in c2.la
+00018a20: 7965 7273 0a0a 0a64 6566 2068 6173 685f  yers...def hash_
+00018a30: 6669 6c65 2866 696c 6570 6174 6829 3a0a  file(filepath):.
+00018a40: 2020 2020 6d64 3520 3d20 6861 7368 6c69      md5 = hashli
+00018a50: 622e 6d64 3528 290a 2020 2020 6d64 352e  b.md5().    md5.
+00018a60: 7570 6461 7465 2866 696c 6570 6174 682e  update(filepath.
+00018a70: 7265 6164 5f62 7974 6573 2829 290a 2020  read_bytes()).  
+00018a80: 2020 7265 7475 726e 206d 6435 2e68 6578    return md5.hex
+00018a90: 6469 6765 7374 2829 0a0a 0a64 6566 2074  digest()...def t
+00018aa0: 6573 745f 6262 6f78 5f72 6566 6572 656e  est_bbox_referen
+00018ab0: 6365 2829 202d 3e20 4e6f 6e65 3a0a 2020  ce() -> None:.  
+00018ac0: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
+00018ad0: 6f72 7920 6173 2067 660a 0a20 2020 2063  ory as gf..    c
+00018ae0: 203d 2067 662e 436f 6d70 6f6e 656e 7428   = gf.Component(
+00018af0: 290a 2020 2020 6331 203d 2063 203c 3c20  ).    c1 = c << 
+00018b00: 6766 2e63 6f6d 706f 6e65 6e74 732e 7265  gf.components.re
+00018b10: 6374 616e 676c 6528 7369 7a65 3d28 312e  ctangle(size=(1.
+00018b20: 3565 2d33 2c20 312e 3565 2d33 292c 2070  5e-3, 1.5e-3), p
+00018b30: 6f72 745f 7479 7065 3d4e 6f6e 6529 0a20  ort_type=None). 
+00018b40: 2020 2063 3220 3d20 6320 3c3c 2067 662e     c2 = c << gf.
+00018b50: 636f 6d70 6f6e 656e 7473 2e72 6563 7461  components.recta
+00018b60: 6e67 6c65 2873 697a 653d 2831 2e35 652d  ngle(size=(1.5e-
+00018b70: 332c 2031 2e35 652d 3329 2c20 706f 7274  3, 1.5e-3), port
+00018b80: 5f74 7970 653d 4e6f 6e65 290a 2020 2020  _type=None).    
+00018b90: 6332 2e78 6d69 6e20 3d20 6331 2e78 6d61  c2.xmin = c1.xma
+00018ba0: 780a 0a20 2020 2061 7373 6572 7420 6332  x..    assert c2
+00018bb0: 2e78 7369 7a65 203d 3d20 312e 3565 2d33  .xsize == 1.5e-3
+00018bc0: 0a0a 0a64 6566 2074 6573 745f 7265 6d6f  ...def test_remo
+00018bd0: 7665 5f6c 6162 656c 7328 2920 2d3e 204e  ve_labels() -> N
+00018be0: 6f6e 653a 0a20 2020 2069 6d70 6f72 7420  one:.    import 
+00018bf0: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
+00018c00: 0a0a 2020 2020 6320 3d20 6766 2e63 2e73  ..    c = gf.c.s
+00018c10: 7472 6169 6768 7428 290a 2020 2020 632e  traight().    c.
+00018c20: 7265 6d6f 7665 5f6c 6162 656c 7328 290a  remove_labels().
+00018c30: 0a20 2020 2061 7373 6572 7420 6c65 6e28  .    assert len(
+00018c40: 632e 6c61 6265 6c73 2920 3d3d 2030 0a0a  c.labels) == 0..
+00018c50: 0a64 6566 2074 6573 745f 696d 706f 7274  .def test_import
+00018c60: 5f67 6473 5f73 6574 7469 6e67 7328 2920  _gds_settings() 
+00018c70: 2d3e 204e 6f6e 653a 0a20 2020 2069 6d70  -> None:.    imp
+00018c80: 6f72 7420 6764 7366 6163 746f 7279 2061  ort gdsfactory a
+00018c90: 7320 6766 0a0a 2020 2020 6320 3d20 6766  s gf..    c = gf
+00018ca0: 2e63 6f6d 706f 6e65 6e74 732e 6d7a 6928  .components.mzi(
+00018cb0: 290a 2020 2020 6764 7370 6174 6820 3d20  ).    gdspath = 
+00018cc0: 632e 7772 6974 655f 6764 7328 7769 7468  c.write_gds(with
+00018cd0: 5f6d 6574 6164 6174 613d 5472 7565 290a  _metadata=True).
+00018ce0: 2020 2020 6332 203d 2067 662e 696d 706f      c2 = gf.impo
+00018cf0: 7274 5f67 6473 2867 6473 7061 7468 2c20  rt_gds(gdspath, 
+00018d00: 6e61 6d65 3d22 6d7a 695f 7361 6d70 6c65  name="mzi_sample
+00018d10: 222c 2072 6561 645f 6d65 7461 6461 7461  ", read_metadata
+00018d20: 3d54 7275 6529 0a20 2020 2063 3320 3d20  =True).    c3 = 
+00018d30: 6766 2e72 6f75 7469 6e67 2e61 6464 5f66  gf.routing.add_f
+00018d40: 6962 6572 5f73 696e 676c 6528 6332 290a  iber_single(c2).
+00018d50: 2020 2020 6173 7365 7274 2063 330a 0a0a      assert c3...
+00018d60: 6966 205f 5f6e 616d 655f 5f20 3d3d 2022  if __name__ == "
+00018d70: 5f5f 6d61 696e 5f5f 223a 0a20 2020 2069  __main__":.    i
+00018d80: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
+00018d90: 2061 7320 6766 0a0a 2020 2020 6320 3d20   as gf..    c = 
+00018da0: 6766 2e63 2e6d 7a69 2829 0a20 2020 2063  gf.c.mzi().    c
+00018db0: 2e70 7072 696e 745f 706f 7274 7328 290a  .pprint_ports().
+00018dc0: 0a20 2020 2023 2063 203d 2067 662e 436f  .    # c = gf.Co
+00018dd0: 6d70 6f6e 656e 7428 290a 2020 2020 2320  mponent().    # 
+00018de0: 7020 3d20 632e 6164 645f 706f 6c79 676f  p = c.add_polygo
+00018df0: 6e28 0a20 2020 2023 2020 2020 205b 282d  n(.    #     [(-
+00018e00: 382c 2036 2c20 372c 2039 292c 2028 2d36  8, 6, 7, 9), (-6
+00018e10: 2c20 382c 2031 372c 2035 295d 2c20 6c61  , 8, 17, 5)], la
+00018e20: 7965 723d 2831 2c20 3029 0a20 2020 2023  yer=(1, 0).    #
+00018e30: 2029 2020 2320 4744 5320 6c61 7965 7273   )  # GDS layers
+00018e40: 2061 7265 2074 7570 6c65 7320 6f66 2069   are tuples of i
+00018e50: 6e74 7320 2862 7574 2069 6620 7765 2075  nts (but if we u
+00018e60: 7365 206f 6e6c 7920 6f6e 6520 6e75 6d62  se only one numb
+00018e70: 6572 2069 7420 6173 7375 6d65 7320 7468  er it assumes th
+00018e80: 6520 6f74 6865 7220 6e75 6d62 6572 2069  e other number i
+00018e90: 7320 3029 0a20 2020 2023 2063 2e77 7269  s 0).    # c.wri
+00018ea0: 7465 5f67 6473 2822 6869 2e67 6473 2229  te_gds("hi.gds")
+00018eb0: 0a20 2020 2023 2063 2e73 686f 7728 290a  .    # c.show().
+00018ec0: 2020 2020 2320 7072 696e 7428 434f 4e46      # print(CONF
+00018ed0: 2e6c 6173 745f 7361 7665 645f 6669 6c65  .last_saved_file
+00018ee0: 7329 0a                                  s).
```

### Comparing `gdsfactory-6.99.0/gdsfactory/component_layout.py` & `gdsfactory-7.0.0/gdsfactory/component_layout.py`

 * *Files 6% similar despite different names*

```diff
@@ -2,35 +2,37 @@
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 from __future__ import annotations
 
 import numbers
 from collections import defaultdict
-from typing import Dict, List, Optional, Tuple, Union
 
 import numpy as np
-from gdstk import Polygon
+import shapely as sp
 from gdstk import Label as _Label
+from gdstk import Polygon
 from numpy import cos, pi, sin
 from numpy.linalg import norm
 
 
 class Label(_Label):
     def __repr__(self) -> str:
         return f"Label(text={self.text!r}, origin={self.origin}, layer=({self.layer}, {self.texttype}))"
 
 
 def get_polygons(
     instance,
-    by_spec: Union[bool, Tuple[int, int]] = False,
-    depth: Optional[int] = None,
+    by_spec: bool | tuple[int, int] = False,
+    depth: int | None = None,
     include_paths: bool = True,
     as_array: bool = True,
-) -> Union[List[Polygon], Dict[Tuple[int, int], List[Polygon]]]:
+    as_shapely: bool = False,
+    as_shapely_merged: bool = False,
+) -> list[Polygon] | dict[tuple[int, int], list[Polygon]]:
     """Return a list of polygons in this cell.
 
     Args:
         by_spec: bool or layer
             If True, the return value is a dictionary with the
             polygons of each individual pair (layer, datatype), which
             are used as keys.  If set to a tuple of (layer, datatype),
@@ -39,14 +41,15 @@
             If not None, defines from how many reference levels to
             retrieve polygons.  References below this level will result
             in a bounding box.  If `by_spec` is True the key will be the
             name of this cell.
         include_paths: If True, polygonal representation of paths are also included in the result.
         as_array: when as_array=false, return the Polygon objects instead.
             polygon objects have more information (especially when by_spec=False) and are faster to retrieve.
+        as_shapely: returns shapely polygons.
 
     Returns
         out: list of array-like[N][2] or dictionary
             List containing the coordinates of the vertices of each
             polygon, or dictionary with with the list of polygons (if
             `by_spec` is True).
 
@@ -85,15 +88,25 @@
             layer=by_spec[0],
             datatype=by_spec[1],
             include_paths=include_paths,
         )
 
     if not as_array:
         return polygons
-    if by_spec is not True:
+    elif as_shapely_merged:
+        polygons = [sp.Polygon(polygon.points) for polygon in polygons]
+        p = sp.Polygon()
+        for polygon in polygons:
+            p = p | polygon
+        return p
+
+    elif as_shapely:
+        return [sp.Polygon(polygon.points) for polygon in polygons]
+
+    elif by_spec is not True:
         return [polygon.points for polygon in polygons]
     layer_to_polygons = defaultdict(list)
     for layer, polygons_list in polygons.items():
         for polygon in polygons_list:
             layer_to_polygons[layer].append(polygon.points)
     return layer_to_polygons
 
@@ -121,14 +134,18 @@
         gds_layer, gds_datatype = layer, 0
     else:
         raise ValueError(
             """_parse_layer() was passed something
             that could not be interpreted as a layer: layer = %s"""
             % layer
         )
+    if not isinstance(gds_layer, int):
+        raise ValueError(f"invalid layer {layer}")
+    if not isinstance(gds_datatype, int):
+        raise ValueError(f"invalid layer {layer}")
     return (gds_layer, gds_datatype)
 
 
 class _GeometryHelper:
     """Helper class for a class with functions move() and the property bbox.
 
     It uses that function+property to enable you to do things like check what the
@@ -276,15 +293,15 @@
             destination : array-like[2], Port, or key Destination point of the move.
         """
         if destination is None:
             destination = origin
             origin = 0
         return self.move(origin=(0, origin), destination=(0, destination))
 
-    def __add__(self, element):
+    def __add__(self, element) -> Group:
         """Adds an element to a Group.
 
         Args:
             element: Component, ComponentReference, Port, Polygon,
                 Label, or Group to add.
         """
         if isinstance(self, Group):
@@ -349,15 +366,15 @@
         from gdsfactory.component_reference import ComponentReference
 
         if _is_iterable(element):
             [self.add(e) for e in element]
         elif element is None:
             return self
         elif isinstance(
-            element, (Component, ComponentReference, Polygon, Label, Group)
+            element, Component | ComponentReference | Polygon | Label | Group
         ):
             self.elements.append(element)
         else:
             raise ValueError(
                 "add() Could not add element to Group, the only "
                 "allowed element types are "
                 "(Component, ComponentReference, Polygon, Label, Group)"
@@ -523,15 +540,15 @@
 
 def _is_iterable(items):
     """Checks if the passed variable is iterable.
 
     Args:
         items: any Item to check for iterability.
     """
-    return isinstance(items, (list, tuple, set, np.ndarray))
+    return isinstance(items, list | tuple | set | np.ndarray)
 
 
 def _parse_coordinate(c):
     """Translates various inputs (lists, tuples, Ports) to an (x,y) coordinate.
 
     Args:
         c: array-like[N] or Port
@@ -712,12 +729,21 @@
 
     return np.vstack((result1[:-1], result2))
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
-    c = gf.Component()
-    label = c.add_label("hi")
-    print(c.labels[0])
+    # c = gf.Component()
+    # label = c.add_label("hi")
+    # print(c.labels[0])
     # _demo()
     # s = Step()
+
+    c = gf.Component("bend")
+    b = c << gf.components.bend_circular(angle=30)
+    s = c << gf.components.straight(length=5)
+    s.connect("o1", b.ports["o2"])
+    p = c.get_polygons(as_shapely_merged=True)
+    c2 = gf.Component()
+    c2.add_polygon(p, layer=(1, 0))
+    c2.show()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/component_reference.py` & `gdsfactory-7.0.0/gdsfactory/component_reference.py`

 * *Files 5% similar despite different names*

```diff
@@ -2,36 +2,32 @@
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 
 from __future__ import annotations
 
 import typing
-from typing import Any, Dict, List, Optional, Tuple, Union, cast, Set
+from typing import Any, cast
 
 import gdstk
 import numpy as np
-from numpy import cos, float64, int64, mod, ndarray, pi, sin
+import shapely
+from numpy import cos, mod, ndarray, pi, sin
 
 from gdsfactory.component_layout import Polygon, _GeometryHelper, get_polygons
 from gdsfactory.port import (
     Port,
     map_ports_layer_to_orientation,
     map_ports_to_orientation_ccw,
     map_ports_to_orientation_cw,
     select_ports,
 )
-from gdsfactory.snap import snap_to_grid
 
 if typing.TYPE_CHECKING:
-    from gdsfactory.component import Component
-
-Number = Union[float64, int64, float, int]
-Coordinate = Union[Tuple[Number, Number], ndarray, List[Number]]
-Coordinates = Union[List[Coordinate], ndarray, List[Number], Tuple[Number, ...]]
+    from gdsfactory.component import Component, Coordinate, Coordinates
 
 
 class SizeInfo:
     def __init__(self, bbox: ndarray) -> None:
         """Initialize this object."""
         self.west = bbox[0, 0]
         self.east = bbox[1, 0]
@@ -53,15 +49,15 @@
         self.ce = np.array([self.east, yc])
         self.nc = np.array([xc, self.north])
         self.sc = np.array([xc, self.south])
         self.cc = self.center = np.array([xc, yc])
 
     def get_rect(
         self, padding=0, padding_w=None, padding_e=None, padding_n=None, padding_s=None
-    ) -> Tuple[Coordinate, Coordinate, Coordinate, Coordinate]:
+    ) -> tuple[Coordinate, Coordinate, Coordinate, Coordinate]:
         w, e, s, n = self.west, self.east, self.south, self.north
 
         padding_n = padding if padding_n is None else padding_n
         padding_e = padding if padding_e is None else padding_e
         padding_w = padding if padding_w is None else padding_w
         padding_s = padding if padding_s is None else padding_s
 
@@ -69,15 +65,15 @@
         e = e + padding_e
         s = s - padding_s
         n = n + padding_n
 
         return ((w, s), (e, s), (e, n), (w, n))
 
     @property
-    def rect(self) -> Tuple[Coordinate, Coordinate]:
+    def rect(self) -> tuple[Coordinate, Coordinate]:
         return self.get_rect()
 
     def __str__(self) -> str:
         """Return a string representation of the object."""
         return f"w: {self.west}\ne: {self.east}\ns: {self.south}\nn: {self.north}\n"
 
 
@@ -150,17 +146,17 @@
         rotation: float = 0,
         magnification: float = 1,
         x_reflection: bool = False,
         visual_label: str = "",
         columns: int = 1,
         rows: int = 1,
         spacing=None,
-        name: Optional[str] = None,
-        v1: Optional[Tuple[float, float]] = None,
-        v2: Optional[Tuple[float, float]] = None,
+        name: str | None = None,
+        v1: tuple[float, float] | None = None,
+        v2: tuple[float, float] | None = None,
     ) -> None:
         """Initialize the ComponentReference object."""
         self._reference = gdstk.Reference(
             cell=component._cell,
             origin=origin,
             rotation=np.deg2rad(rotation),
             magnification=magnification,
@@ -184,31 +180,31 @@
         self._local_ports = {
             name: port._copy() for name, port in component.ports.items()
         }
         self.visual_label = visual_label
         # self.uid = str(uuid.uuid4())[:8]
 
     @property
-    def v1(self) -> Optional[Tuple[float, float]]:
+    def v1(self) -> tuple[float, float] | None:
         return self._reference.repetition.v1
 
     @property
-    def v2(self) -> Optional[Tuple[float, float]]:
+    def v2(self) -> tuple[float, float] | None:
         return self._reference.repetition.v2
 
     @property
     def rows(self) -> int:
         return self._reference.repetition.rows or 1
 
     @property
     def columns(self) -> int:
         return self._reference.repetition.columns or 1
 
     @property
-    def spacing(self) -> Optional[Tuple[float, float]]:
+    def spacing(self) -> tuple[float, float] | None:
         return self._reference.repetition.spacing
 
     @property
     def ref_cell(self):
         return self._ref_cell
 
     @property
@@ -255,21 +251,56 @@
     def ref_cell(self, value) -> None:
         self._set_ref_cell(value)
 
     @parent.setter
     def parent(self, value) -> None:
         self._set_ref_cell(value)
 
+    def get_polygon_enclosure(self) -> shapely.Polygon:
+        return shapely.Polygon(self._reference.convex_hull())
+
+    def get_polygon_bbox(
+        self,
+        default: float = 0.0,
+        top: float | None = None,
+        bottom: float | None = None,
+        right: float | None = None,
+        left: float | None = None,
+    ) -> shapely.Polygon:
+        """Returns shapely Polygon with padding.
+
+        Args:
+            default: default padding in um.
+            top: north padding in um.
+            bottom: south padding in um.
+            right: east padding in um.
+            left: west padding in um.
+        """
+        (xmin, ymin), (xmax, ymax) = self.bbox
+        top = top if top is not None else default
+        bottom = bottom if bottom is not None else default
+        right = right if right is not None else default
+        left = left if left is not None else default
+        points = [
+            [xmin - left, ymin - bottom],
+            [xmax + right, ymin - bottom],
+            [xmax + right, ymax + top],
+            [xmin - left, ymax + top],
+        ]
+        return shapely.Polygon(points)
+
     def get_polygons(
         self,
         by_spec: bool = False,
-        depth: Optional[int] = None,
+        depth: int | None = None,
         include_paths: bool = True,
         as_array: bool = True,
-    ) -> Union[List[Polygon], Dict[Tuple[int, int], List[Polygon]]]:
+        as_shapely: bool = False,
+        as_shapely_merged: bool = False,
+    ) -> list[Polygon] | dict[tuple[int, int], list[Polygon]]:
         """Return the list of polygons created by this reference.
 
         Args:
             by_spec : bool or tuple
                 If True, the return value is a dictionary with the
                 polygons of each individual pair (layer, datatype).
                 If set to a tuple of (layer, datatype), only polygons
@@ -279,14 +310,16 @@
                 retrieve polygons.  References below this level will result
                 in a bounding box.  If `by_spec` is True the key will be the
                 name of the referenced cell.
             include_paths: If True, polygonal representation of paths are also included in the result.
             as_array: when as_array=false, return the Polygon objects instead.
                 polygon objects have more information (especially when by_spec=False)
                 and are faster to retrieve.
+            as_shapely: returns shapely polygons.
+            as_shapely_merged: returns a shapely polygonize.
 
         Returns
             out : list of array-like[N][2] or dictionary
                 List containing the coordinates of the vertices of each
                 polygon, or dictionary with the list of polygons (if
                 `by_spec` is True).
 
@@ -296,14 +329,16 @@
         """
         return get_polygons(
             instance=self,
             by_spec=by_spec,
             depth=depth,
             include_paths=include_paths,
             as_array=as_array,
+            as_shapely=as_shapely,
+            as_shapely_merged=as_shapely_merged,
         )
 
     def get_labels(self, depth=None, set_transform=True):
         """Return the list of labels created by this reference.
 
         Args:
             depth : integer or None
@@ -322,15 +357,15 @@
         else:
             return self.parent.get_labels(depth=depth)
 
     def get_bounding_box(self):
         return self._reference.bounding_box()
 
     @property
-    def layers(self) -> Set[Tuple[int, int]]:
+    def layers(self) -> set[tuple[int, int]]:
         return self.parent.layers
 
     @property
     def settings(self):
         return self.parent.settings
 
     def get_paths(self, depth=None):
@@ -343,17 +378,17 @@
 
         Returns:
             list of `FlexPath` or `RobustPath`
                 List containing the paths in this cell and its references.
         """
         return self._reference.get_paths(depth=depth)
 
-    def translate(self, dx, dy):
+    def translate(self, dx, dy) -> ComponentReference:
         x0, y0 = self._reference.origin
-        self._reference.origin = (x0 + dx, y0 + dy)
+        self.origin = (x0 + dx, y0 + dy)
         return self
 
     def area(self, by_spec=False):
         """Calculate total area.
 
         Args:
             by_spec : bool
@@ -396,17 +431,16 @@
                 self.owner._named_references.pop(self._name, None)
                 self.owner._named_references[value] = self
             self._name = value
 
     def __repr__(self) -> str:
         """Return a string representation of the object."""
         return (
-            'ComponentReference (parent Component "%s", ports %s, origin %s, rotation %s,'
-            " x_reflection %s)"
-            % (
+            'ComponentReference (parent Component "{}", ports {}, origin {}, rotation {},'
+            " x_reflection {})".format(
                 self.parent.name,
                 list(self.ports.keys()),
                 self.origin,
                 self.rotation,
                 self.x_reflection,
             )
         )
@@ -426,15 +460,15 @@
         """Return the bounding box of the ComponentReference.
 
         it snaps to 3 decimals in um (0.001um = 1nm precision)
         """
         bbox = self.get_bounding_box()
         if bbox is None:
             bbox = ((0, 0), (0, 0))
-        return np.round(bbox, 3)
+        return np.array(bbox)
 
     @classmethod
     def __get_validators__(cls):
         """Get validators."""
         yield cls.validate
 
     @classmethod
@@ -450,15 +484,15 @@
         if key not in self.ports:
             ports = list(self.ports.keys())
             raise ValueError(f"{key!r} not in {ports}")
 
         return self.ports[key]
 
     @property
-    def ports(self) -> Dict[str, Port]:
+    def ports(self) -> dict[str, Port]:
         """This property allows you to access myref.ports, and receive a copy.
 
         of the ports dict which is correctly rotated and translated.
         """
         for name, port in self.parent.ports.items():
             port = self.parent.ports[name]
             new_center, new_orientation = self._transform_port(
@@ -482,19 +516,19 @@
             if name not in parent_names:
                 self._local_ports.pop(name)
         for k in list(self._local_ports):
             self._local_ports[k].reference = self
         return self._local_ports
 
     @property
-    def info(self) -> Dict[str, Any]:
+    def info(self) -> dict[str, Any]:
         return self.parent.info
 
     @property
-    def metadata_child(self) -> Dict[str, Any]:
+    def metadata_child(self) -> dict[str, Any]:
         return self.parent.metadata_child
 
     @property
     def size_info(self) -> SizeInfo:
         return SizeInfo(self.bbox)
 
     def pprint_ports(self) -> None:
@@ -504,17 +538,17 @@
             print(port)
 
     def _transform_port(
         self,
         point: ndarray,
         orientation: float,
         origin: Coordinate = (0, 0),
-        rotation: Optional[int] = None,
+        rotation: int | None = None,
         x_reflection: bool = False,
-    ) -> Tuple[ndarray, float]:
+    ) -> tuple[ndarray, float]:
         """Apply GDS-type transformation to a port (x_ref)."""
         new_point = np.array(point)
         new_orientation = orientation
 
         if x_reflection:
             new_point[1] = -new_point[1]
             new_orientation = None if orientation is None else -orientation
@@ -529,15 +563,15 @@
 
         return new_point, new_orientation
 
     def _transform_point(
         self,
         point: ndarray,
         origin: Coordinate = (0, 0),
-        rotation: Optional[int] = None,
+        rotation: int | None = None,
         x_reflection: bool = False,
     ) -> ndarray:
         """Apply GDS-type transformation to a point."""
         new_point = np.array(point)
 
         if x_reflection:
             new_point[1] = -new_point[1]
@@ -546,17 +580,17 @@
         if origin is not None:
             new_point = new_point + np.array(origin)
 
         return new_point
 
     def move(
         self,
-        origin: Union[Port, Coordinate, str] = (0, 0),
-        destination: Optional[Union[Port, Coordinate, str]] = None,
-        axis: Optional[str] = None,
+        origin: Port | Coordinate | str = (0, 0),
+        destination: Port | Coordinate | str | None = None,
+        axis: str | None = None,
     ) -> ComponentReference:
         """Move the ComponentReference from origin point to destination.
 
         Both origin and destination can be 1x2 array-like, Port, or a key
         corresponding to one of the Ports in this device_ref.
 
         Args:
@@ -622,37 +656,37 @@
         self.origin = np.array(self.origin) + dxdy
         self._bb_valid = False
         return self
 
     def rotate(
         self,
         angle: float = 45,
-        center: Union[Coordinate, str, int] = (0.0, 0.0),
+        center: Coordinate | str | int = (0.0, 0.0),
     ) -> ComponentReference:
         """Return rotated ComponentReference.
 
         Args:
             angle: in degrees.
             center: x, y.
         """
         if angle == 0:
             return self
-        if isinstance(center, (int, str)):
+        if isinstance(center, int | str):
             center = self.ports[center].center
 
         if isinstance(center, Port):
             center = center.center
         self.rotation += angle
         self.rotation %= 360
         self.origin = _rotate_points(self.origin, angle, center)
         self._bb_valid = False
         return self
 
     def mirror_x(
-        self, port_name: Optional[str] = None, x0: Optional[Coordinate] = None
+        self, port_name: str | None = None, x0: Coordinate | None = None
     ) -> ComponentReference:
         """Perform horizontal mirror using x0 or port as axis (default, x0=0).
 
         This is the default for mirror along X=x0 axis
         """
         if port_name is None and x0 is None:
             x0 = -self.x
@@ -660,15 +694,15 @@
         if port_name is not None:
             position = self.ports[port_name]
             x0 = position.x
         self.mirror((x0, 1), (x0, 0))
         return self
 
     def mirror_y(
-        self, port_name: Optional[str] = None, y0: Optional[float] = None
+        self, port_name: str | None = None, y0: float | None = None
     ) -> ComponentReference:
         """Perform vertical mirror using y0 as axis (default, y0=0)."""
         if port_name is None and y0 is None:
             y0 = 0.0
 
         if port_name is not None:
             position = self.ports[port_name]
@@ -714,26 +748,27 @@
         self.origin = self.origin + p1
 
         self._bb_valid = False
         return self
 
     def connect(
         self,
-        port: Union[str, Port],
+        port: str | Port,
         destination: Port,
         overlap: float = 0.0,
         preserve_orientation: bool = False,
     ) -> ComponentReference:
         """Return ComponentReference where port connects to a destination.
 
         Args:
             port: origin (port, or port name) to connect.
             destination: destination port.
             overlap: how deep does the port go inside.
-            preserve_orientation: if True, will not rotate the reference to align the port orientations; reference will keep its orientation pre-connection.
+            preserve_orientation: True, does not rotate the reference to align port
+                orientation and reference keep its orientation pre-connection.
 
         Returns:
             ComponentReference: with correct rotation to connect to destination.
         """
         # port can either be a string with the name, port index, or an actual Port
         if port in self.ports:
             p = self.ports[port]
@@ -765,44 +800,44 @@
                         sin(destination.orientation * pi / 180),
                     ]
                 )
             )
 
         return self
 
-    def get_ports_list(self, **kwargs) -> List[Port]:
+    def get_ports_list(self, **kwargs) -> list[Port]:
         """Return a list of ports.
 
         Keyword Args:
             layer: port GDS layer.
             prefix: port name prefix.
             orientation: in degrees.
             width: port width.
             layers_excluded: List of layers to exclude.
             port_type: optical, electrical, ...
             clockwise: if True, sort ports clockwise, False: counter-clockwise.
         """
         return list(select_ports(self.ports, **kwargs).values())
 
-    def get_ports_dict(self, **kwargs) -> Dict[str, Port]:
+    def get_ports_dict(self, **kwargs) -> dict[str, Port]:
         """Return a dict of ports.
 
         Keyword Args:
             layer: port GDS layer.
             prefix: port name prefix.
             orientation: in degrees.
             width: port width.
             layers_excluded: List of layers to exclude.
             port_type: optical, electrical, ...
             clockwise: if True, sort ports clockwise, False: counter-clockwise.
         """
         return select_ports(self.ports, **kwargs)
 
     @property
-    def ports_layer(self) -> Dict[str, str]:
+    def ports_layer(self) -> dict[str, str]:
         """Return a mapping from layer0_layer1_E0: portName."""
         return map_ports_layer_to_orientation(self.ports)
 
     def port_by_orientation_cw(self, key: str, **kwargs):
         """Return port by indexing them clockwise."""
         m = map_ports_to_orientation_cw(self.ports, **kwargs)
         if key not in m:
@@ -814,33 +849,29 @@
         """Return port by indexing them clockwise."""
         m = map_ports_to_orientation_ccw(self.ports, **kwargs)
         if key not in m:
             raise KeyError(f"{key} not in {list(m.keys())}")
         key2 = m[key]
         return self.ports[key2]
 
-    def snap_ports_to_grid(self, nm: int = 1) -> None:
-        for port in self.ports.values():
-            port.snap_to_grid(nm=nm)
-
     def get_ports_xsize(self, **kwargs) -> float:
         """Return xdistance from east to west ports.
 
         Keyword Args:
             kwargs: orientation, port_type, layer.
         """
         ports_cw = self.get_ports_list(clockwise=True, **kwargs)
         ports_ccw = self.get_ports_list(clockwise=False, **kwargs)
-        return snap_to_grid(ports_ccw[0].x - ports_cw[0].x)
+        return ports_ccw[0].x - ports_cw[0].x
 
     def get_ports_ysize(self, **kwargs) -> float:
         """Returns ydistance from east to west ports."""
         ports_cw = self.get_ports_list(clockwise=True, **kwargs)
         ports_ccw = self.get_ports_list(clockwise=False, **kwargs)
-        return snap_to_grid(ports_ccw[0].y - ports_cw[0].y)
+        return ports_ccw[0].y - ports_cw[0].y
 
 
 def test_move() -> None:
     import gdsfactory as gf
 
     c = gf.Component()
     mzi = c.add_ref(gf.components.mzi())
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/C.py` & `gdsfactory-7.0.0/gdsfactory/components/C.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,20 +1,18 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def C(
     width: float = 1.0,
-    size: Tuple[float, float] = (10.0, 20.0),
+    size: tuple[float, float] = (10.0, 20.0),
     layer: LayerSpec = "WG",
 ) -> Component:
     """C geometry with ports on both ends.
 
     based on phidl.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/L.py` & `gdsfactory-7.0.0/gdsfactory/components/L.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,20 +1,18 @@
 from __future__ import annotations
 
-from typing import Tuple, Union
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def L(
-    width: Union[int, float] = 1,
-    size: Tuple[int, int] = (10, 20),
+    width: int | float = 1,
+    size: tuple[int, int] = (10, 20),
     layer: LayerSpec = "M3",
     port_type: str = "electrical",
 ) -> Component:
     """Generates an 'L' geometry with ports on both ends.
 
     Based on phidl.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/__init__.py` & `gdsfactory-7.0.0/gdsfactory/components/__init__.py`

 * *Files 3% similar despite different names*

```diff
@@ -4,21 +4,21 @@
 """
 
 from __future__ import annotations
 
 import sys
 from functools import partial
 
-from gdsfactory.components.add_trenches import add_trenches, add_trenches90
 from gdsfactory.components.add_fiducials import add_fiducials, add_fiducials_offsets
 from gdsfactory.components.add_grating_couplers import (
     add_grating_couplers,
     add_grating_couplers_with_loopback_fiber_array,
     add_grating_couplers_with_loopback_fiber_single,
 )
+from gdsfactory.components.add_trenches import add_trenches, add_trenches90
 from gdsfactory.components.align import add_frame, align_wafer
 from gdsfactory.components.array_component import array
 from gdsfactory.components.array_with_fanout import (
     array_with_fanout,
     array_with_fanout_2d,
 )
 from gdsfactory.components.array_with_via import array_with_via, array_with_via_2d
@@ -42,23 +42,25 @@
 from gdsfactory.components.circle import circle
 from gdsfactory.components.coh_rx_dual_pol import coh_rx_dual_pol
 from gdsfactory.components.coh_rx_single_pol import coh_rx_single_pol
 from gdsfactory.components.coh_tx_dual_pol import coh_tx_dual_pol
 from gdsfactory.components.coh_tx_single_pol import coh_tx_single_pol
 from gdsfactory.components.compass import compass
 from gdsfactory.components.component_lattice import component_lattice
+from gdsfactory.components.component_lattice_generic import component_lattice_generic
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.copy_layers import copy_layers
 from gdsfactory.components.coupler import coupler
 from gdsfactory.components.coupler90 import coupler90, coupler90circular
 from gdsfactory.components.coupler90bend import coupler90bend
 from gdsfactory.components.coupler_adiabatic import coupler_adiabatic
 from gdsfactory.components.coupler_asymmetric import coupler_asymmetric
+from gdsfactory.components.coupler_bent import coupler_bent
 from gdsfactory.components.coupler_full import coupler_full
-from gdsfactory.components.coupler_ring import coupler_ring
+from gdsfactory.components.coupler_ring import coupler_ring, coupler_ring_point
 from gdsfactory.components.coupler_straight import coupler_straight
 from gdsfactory.components.coupler_straight_asymmetric import (
     coupler_straight_asymmetric,
 )
 from gdsfactory.components.coupler_symmetric import coupler_symmetric
 from gdsfactory.components.cross import cross
 from gdsfactory.components.crossing_waveguide import (
@@ -148,84 +150,87 @@
 )
 from gdsfactory.components.grating_coupler_rectangular_arbitrary_slab import (
     grating_coupler_rectangular_arbitrary_slab,
 )
 from gdsfactory.components.grating_coupler_tree import grating_coupler_tree
 from gdsfactory.components.greek_cross import (
     greek_cross,
-    greek_cross_with_pads,
     greek_cross_offset_pads,
+    greek_cross_with_pads,
 )
 from gdsfactory.components.hline import hline
 from gdsfactory.components.interdigital_capacitor import interdigital_capacitor
 from gdsfactory.components.L import L
 from gdsfactory.components.litho_calipers import litho_calipers
 from gdsfactory.components.litho_ruler import litho_ruler
 from gdsfactory.components.litho_steps import litho_steps
 from gdsfactory.components.logo import logo
 from gdsfactory.components.loop_mirror import loop_mirror
+from gdsfactory.components.mmi import mmi
 from gdsfactory.components.mmi1x2 import mmi1x2
-from gdsfactory.components.mmi2x2 import mmi2x2
 from gdsfactory.components.mmi1x2_with_sbend import mmi1x2_with_sbend
+from gdsfactory.components.mmi2x2 import mmi2x2
 from gdsfactory.components.mmi2x2_with_sbend import mmi2x2_with_sbend
 from gdsfactory.components.mmi_90degree_hybrid import mmi_90degree_hybrid
 from gdsfactory.components.mode_converter import mode_converter
 from gdsfactory.components.mzi import mzi, mzi1x2_2x2, mzi2x2_2x2, mzi_coupler
-from gdsfactory.components.mzm import mzm
 from gdsfactory.components.mzi_arm import mzi_arm
 from gdsfactory.components.mzi_arms import mzi_arms
 from gdsfactory.components.mzi_lattice import mzi_lattice, mzi_lattice_mmi
 from gdsfactory.components.mzi_pads_center import mzi_pads_center
 from gdsfactory.components.mzi_phase_shifter import (
+    mzi2x2_2x2_phase_shifter,
     mzi_phase_shifter,
     mzi_phase_shifter_top_heater_metal,
 )
 from gdsfactory.components.mzit import mzit
 from gdsfactory.components.mzit_lattice import mzit_lattice
+from gdsfactory.components.mzm import mzm
 from gdsfactory.components.nxn import nxn
 from gdsfactory.components.optimal_90deg import optimal_90deg
 from gdsfactory.components.optimal_hairpin import optimal_hairpin
 from gdsfactory.components.optimal_step import optimal_step
 from gdsfactory.components.pack_doe import generate_doe, pack_doe, pack_doe_grid
 from gdsfactory.components.pad import (
     pad,
-    pad_rectangular,
     pad_array,
     pad_array0,
     pad_array90,
     pad_array180,
     pad_array270,
+    pad_rectangular,
 )
 from gdsfactory.components.pad_gsg import pad_gsg_open, pad_gsg_short
 from gdsfactory.components.pads_shorted import pads_shorted
 from gdsfactory.components.polarization_splitter_rotator import (
     polarization_splitter_rotator,
 )
 from gdsfactory.components.ramp import ramp
-from gdsfactory.components.rectangle import rectangle, marker_te, marker_tm
+from gdsfactory.components.rectangle import marker_te, marker_tm, rectangle
 from gdsfactory.components.rectangle_with_slits import rectangle_with_slits
+from gdsfactory.components.rectangular_ring import rectangular_ring
 from gdsfactory.components.regular_polygon import regular_polygon
 from gdsfactory.components.resistance_meander import resistance_meander
 from gdsfactory.components.resistance_sheet import resistance_sheet
 from gdsfactory.components.ring import ring
 from gdsfactory.components.ring_crow import ring_crow
 from gdsfactory.components.ring_crow_couplers import ring_crow_couplers
 from gdsfactory.components.ring_double import ring_double
 from gdsfactory.components.ring_double_heater import ring_double_heater
 from gdsfactory.components.ring_double_pn import ring_double_pn
+from gdsfactory.components.ring_section_based import ring_section_based
 from gdsfactory.components.ring_single import ring_single
-from gdsfactory.components.ring_single_pn import ring_single_pn
 from gdsfactory.components.ring_single_array import ring_single_array
 from gdsfactory.components.ring_single_bend_coupler import (
     coupler_bend,
     ring_single_bend_coupler,
 )
 from gdsfactory.components.ring_single_dut import ring_single_dut, taper2
 from gdsfactory.components.ring_single_heater import ring_single_heater
-from gdsfactory.components.ring_section_based import ring_section_based
+from gdsfactory.components.ring_single_pn import ring_single_pn
 from gdsfactory.components.seal_ring import seal_ring
 from gdsfactory.components.snspd import snspd
 from gdsfactory.components.spiral_double import spiral_double
 from gdsfactory.components.spiral_external_io import spiral_external_io
 from gdsfactory.components.spiral_heater import (
     spiral_racetrack,
     spiral_racetrack_fixed_length,
@@ -262,14 +267,15 @@
     taper,
     taper_sc_nc,
     taper_strip_to_ridge,
     taper_strip_to_ridge_trenches,
 )
 from gdsfactory.components.taper_adiabatic import taper_adiabatic
 from gdsfactory.components.taper_cross_section import (
+    taper_cross_section,
     taper_cross_section_linear,
     taper_cross_section_parabolic,
     taper_cross_section_sine,
 )
 from gdsfactory.components.taper_from_csv import (
     taper_0p5_to_3_l36,
     taper_from_csv,
@@ -293,25 +299,24 @@
 from gdsfactory.components.via import via, via1, via2, viac
 from gdsfactory.components.via_corner import via_corner
 from gdsfactory.components.via_cutback import via_cutback
 from gdsfactory.components.via_stack import (
     via_stack,
     via_stack_from_rules,
     via_stack_heater_m3,
-    via_stack_slab_m3,
     via_stack_heater_mtop,
+    via_stack_slab_m3,
 )
 from gdsfactory.components.via_stack_slot import via_stack_slot, via_stack_slot_m1_m2
 from gdsfactory.components.via_stack_with_offset import via_stack_with_offset
 from gdsfactory.components.wafer import wafer
-from gdsfactory.components.wire import wire_corner, wire_straight, wire_corner45
+from gdsfactory.components.wire import wire_corner, wire_corner45, wire_straight
 from gdsfactory.components.wire_sbend import wire_sbend
 from gdsfactory.get_factories import get_cells
 
-
 bend_euler_trenches = partial(add_trenches90, component=bend_euler)
 coupler_trenches = partial(add_trenches, component=coupler)
 ring_single_trenches = partial(add_trenches, component=ring_single)
 ring_double_trenches = partial(add_trenches, component=ring_double)
 
 
 _factory_passives = dict(
@@ -321,14 +326,15 @@
     bend_s=bend_s,
     cdc=cdc,
     coupler=coupler,
     coupler_adiabatic=coupler_adiabatic,
     coupler_asymmetric=coupler_asymmetric,
     coupler_full=coupler_full,
     coupler_ring=coupler_ring,
+    coupler_ring_point=coupler_ring_point,
     coupler_symmetric=coupler_symmetric,
     crossing=crossing,
     crossing45=crossing45,
     taper_cross_section_linear=taper_cross_section_linear,
     taper_cross_section_sine=taper_cross_section_sine,
     taper_cross_section_parabolic=taper_cross_section_parabolic,
     taper=taper,
@@ -395,21 +401,23 @@
     "coh_tx_dual_pol",
     "coh_tx_single_pol",
     "coh_rx_dual_pol",
     "coh_rx_single_pol",
     "coupler",
     "coupler_trenches",
     "coupler_bend",
+    "coupler_bent",
     "coupler90",
     "coupler90bend",
     "coupler90circular",
     "coupler_adiabatic",
     "coupler_asymmetric",
     "coupler_full",
     "coupler_ring",
+    "coupler_ring_point",
     "coupler_straight",
     "coupler_straight_asymmetric",
     "coupler_symmetric",
     "cross",
     "crossing",
     "crossing45",
     "crossing_arm",
@@ -443,14 +451,15 @@
     "extend_ports_list",
     "fiber",
     "fiber_array",
     "fiducial_squares",
     "text_lines",
     "ge_detector_straight_si_contacts",
     "generate_doe",
+    "component_lattice_generic",
     "grating_coupler_array",
     "grating_coupler_elliptical",
     "grating_coupler_elliptical_arbitrary",
     "grating_coupler_elliptical_uniform",
     "grating_coupler_elliptical_lumerical",
     "grating_coupler_elliptical_te",
     "grating_coupler_elliptical_tm",
@@ -479,24 +488,26 @@
     "loop_mirror",
     "loss_deembedding_ch12_34",
     "loss_deembedding_ch13_24",
     "loss_deembedding_ch14_23",
     "marker_te",
     "marker_tm",
     "mmi_90degree_hybrid",
+    "mmi",
     "mmi1x2",
     "mmi2x2",
     "mmi1x2_with_sbend",
     "mmi2x2_with_sbend",
     "mode_converter",
     "mzi",
     "mzi_arms",
     "mzi_pads_center",
     "mzi1x2_2x2",
     "mzi2x2_2x2",
+    "mzi2x2_2x2_phase_shifter",
     "mzi_coupler",
     "mzi_arm",
     "mzi_lattice",
     "mzi_lattice_mmi",
     "mzi_phase_shifter",
     "mzi_phase_shifter_top_heater_metal",
     "mzit",
@@ -512,23 +523,23 @@
     "pad",
     "pad_rectangular",
     "pad_array",
     "pad_array0",
     "pad_array180",
     "pad_array270",
     "pad_array90",
-    "pad_gsg",
     "pad_gsg_open",
     "pad_gsg_short",
     "pads_shorted",
     "polarization_splitter_rotator",
     "pixel",
     "qrcode",
     "ramp",
     "rectangle",
+    "rectangular_ring",
     "regular_polygon",
     "rectangle_with_slits",
     "resistance_meander",
     "resistance_sheet",
     "ring",
     "ring_crow",
     "ring_crow_couplers",
@@ -572,14 +583,15 @@
     "spiral_racetrack_heater_metal",
     "spiral_racetrack_heater_doped",
     "spiral_racetrack_fixed_length",
     "taper",
     "taper_adiabatic",
     "taper2",
     "taper_0p5_to_3_l36",
+    "taper_cross_section",
     "taper_from_csv",
     "taper_parabolic",
     "taper_strip_to_ridge",
     "taper_strip_to_ridge_trenches",
     "taper_sc_nc",
     "taper_w10_l100",
     "taper_w10_l150",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/add_fiducials.py` & `gdsfactory-7.0.0/gdsfactory/components/add_fiducials.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.pad import pad_array
-from gdsfactory.typings import ComponentSpec, Coordinates, Float2, Optional
+from gdsfactory.typings import ComponentSpec, Coordinates, Float2
 
 
 @cell
 def add_fiducials(
     component: ComponentSpec = pad_array,
     gap: float = 50,
-    left: Optional[ComponentSpec] = "cross",
-    right: Optional[ComponentSpec] = "cross",
-    top: Optional[ComponentSpec] = None,
-    bottom: Optional[ComponentSpec] = None,
+    left: ComponentSpec | None = "cross",
+    right: ComponentSpec | None = "cross",
+    top: ComponentSpec | None = None,
+    bottom: ComponentSpec | None = None,
     offset: Float2 = (0, 0),
     **kwargs,
 ) -> Component:
     """Return component with fiducials.
 
     Args:
         component: component to add to the new component.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/add_grating_couplers.py` & `gdsfactory-7.0.0/gdsfactory/components/add_grating_couplers.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 """Add grating_couplers to a component."""
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Tuple
+from collections.abc import Callable
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.add_labels import get_input_label_text_loopback
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
@@ -23,28 +23,28 @@
 from gdsfactory.routing.utils import (
     check_ports_have_equal_spacing,
     direction_ports_from_list_ports,
 )
 from gdsfactory.typings import (
     ComponentSpec,
     CrossSectionSpec,
-    PortsDict,
     LabelListFactory,
+    PortsDict,
 )
 
 
 @cell
 def add_grating_couplers(
     component: ComponentSpec = straight,
     grating_coupler: ComponentSpec = grating_coupler_te,
-    layer_label: Tuple[int, int] = (200, 0),
+    layer_label: tuple[int, int] = (200, 0),
     gc_port_name: str = "o1",
-    get_input_labels_function: Optional[LabelListFactory] = get_input_labels,
+    get_input_labels_function: LabelListFactory | None = get_input_labels,
     select_ports: Callable[..., PortsDict] = select_ports_optical,
-    component_name: Optional[str] = None,
+    component_name: str | None = None,
 ) -> Component:
     """Returns new component with grating couplers and labels.
 
     Args:
         component: to add grating_couplers.
         grating_coupler: grating_coupler spec.
         layer_label: for label.
@@ -87,22 +87,22 @@
     return c
 
 
 @cell
 def add_grating_couplers_with_loopback_fiber_single(
     component: ComponentSpec = spiral_inner_io_fiber_single,
     grating_coupler: ComponentSpec = grating_coupler_te,
-    layer_label: Optional[Tuple[int, int]] = (200, 0),
+    layer_label: tuple[int, int] | None = (200, 0),
     gc_port_name: str = "o1",
-    get_input_labels_function: Optional[LabelListFactory] = get_input_labels,
+    get_input_labels_function: LabelListFactory | None = get_input_labels,
     get_input_label_text_loopback_function: Callable = get_input_label_text_loopback,
     select_ports: Callable[..., PortsDict] = select_ports_optical,
     with_loopback: bool = True,
     cross_section: CrossSectionSpec = strip,
-    component_name: Optional[str] = None,
+    component_name: str | None = None,
     loopback_xspacing: float = 5.0,
     rotation: int = 90,
 ) -> Component:
     """Returns new component with all ports terminated with grating couplers.
 
     Args:
         component: to add grating_couplers.
@@ -206,27 +206,27 @@
     return c
 
 
 @cell
 def add_grating_couplers_with_loopback_fiber_array(
     component: ComponentSpec = spiral_inner_io,
     grating_coupler: ComponentSpec = grating_coupler_te,
-    excluded_ports: Optional[List[str]] = None,
+    excluded_ports: list[str] | None = None,
     grating_separation: float = 127.0,
-    bend_radius_loopback: Optional[float] = None,
+    bend_radius_loopback: float | None = None,
     gc_port_name: str = "o1",
     gc_rotation: int = -90,
     straight_separation: float = 5.0,
     bend: ComponentSpec = bend_euler,
-    layer_label: Tuple[int, int] = (200, 0),
-    layer_label_loopback: Optional[Tuple[int, int]] = None,
-    component_name: Optional[str] = None,
+    layer_label: tuple[int, int] = (200, 0),
+    layer_label_loopback: tuple[int, int] | None = None,
+    component_name: str | None = None,
     with_loopback: bool = False,
     nlabels_loopback: int = 2,
-    get_input_labels_function: Optional[LabelListFactory] = get_input_labels,
+    get_input_labels_function: LabelListFactory | None = get_input_labels,
     cross_section: CrossSectionSpec = strip,
     select_ports: Callable = select_ports_optical,
     loopback_yspacing: float = 4.0,
     **kwargs,
 ) -> Component:
     """Returns a component with grating_couplers and loopback.
 
@@ -373,18 +373,14 @@
                 "valid (0: no labels, 1: first port, 2: both ports2)"
             )
     c.copy_child_info(component)
     return c
 
 
 if __name__ == "__main__":
-    from gdsfactory.generic_tech import get_generic_pdk
-
-    PDK = get_generic_pdk()
-    PDK.activate()
     # from gdsfactory.add_labels import get_optical_text
     # c = gf.components.grating_coupler_elliptical_te()
     # print(c.wavelength)
     # print(c.get_property('wavelength'))
     # c = gf.components.straight()
     # c = gf.components.mzi_phase_shifter()
     # c = add_grating_couplers_with_loopback_fiber_single(component=c, rotation=0)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/add_trenches.py` & `gdsfactory-7.0.0/gdsfactory/components/add_trenches.py`

 * *Ordering differences only*

 * *Files 2% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 from __future__ import annotations
+
 from functools import partial
 
 import gdsfactory as gf
-
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 from gdsfactory.components.bbox import bbox
-from gdsfactory.components.coupler import coupler
 from gdsfactory.components.bend_euler import bend_euler
+from gdsfactory.components.coupler import coupler
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def add_trenches(
     component: ComponentSpec = coupler,
     cross_section: CrossSectionSpec = "rib_with_trenches",
     top: bool = True,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/align.py` & `gdsfactory-7.0.0/gdsfactory/components/align.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.typings import ComponentSpec, LayerSpec
 
 
 @cell
 def align_wafer(
     width: float = 10.0,
     spacing: float = 10.0,
     cross_length: float = 80.0,
     layer: LayerSpec = "WG",
-    layer_cladding: Optional[Tuple[int, int]] = None,
+    layer_cladding: tuple[int, int] | None = None,
     square_corner: str = "bottom_left",
 ) -> Component:
     """Returns cross inside a frame to align wafer.
 
     Args:
         width: in um.
         spacing: in um.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/array_component.py` & `gdsfactory-7.0.0/gdsfactory/components/array_component.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,26 +1,23 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
-from gdsfactory.components.straight import straight
-from gdsfactory.typings import ComponentSpec, Optional, Float2
+from gdsfactory.typings import ComponentSpec, Float2
 
 
 @cell
 def array(
-    component: ComponentSpec = straight,
-    spacing: Tuple[float, float] = (150.0, 150.0),
+    component: ComponentSpec = "pad",
+    spacing: tuple[float, float] = (150.0, 150.0),
     columns: int = 6,
     rows: int = 1,
     add_ports: bool = True,
-    size: Optional[Float2] = None,
+    size: Float2 | None = None,
 ) -> Component:
     """Returns an array of components.
 
     Args:
         component: to replicate.
         spacing: x, y spacing.
         columns: in x.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/array_with_fanout.py` & `gdsfactory-7.0.0/gdsfactory/components/array_with_fanout.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.array_component import array
 from gdsfactory.components.straight import straight
 from gdsfactory.port import auto_rename_ports
 from gdsfactory.routing.sort_ports import sort_ports_x
@@ -19,16 +17,16 @@
     pitch: float = 150.0,
     waveguide_pitch: float = 10.0,
     start_straight_length: float = 5.0,
     end_straight_length: float = 40.0,
     radius: float = 5.0,
     component_port_name: str = "e4",
     bend: ComponentSpec = "bend_euler",
-    bend_port_name1: Optional[str] = None,
-    bend_port_name2: Optional[str] = None,
+    bend_port_name1: str | None = None,
+    bend_port_name2: str | None = None,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Returns component array in X axis with west facing waveguides.
 
     Args:
         component: to replicate.
@@ -78,16 +76,16 @@
     auto_rename_ports(c)
     return c
 
 
 @cell
 def array_with_fanout_2d(
     pitch: float = 150.0,
-    pitch_x: Optional[float] = None,
-    pitch_y: Optional[float] = None,
+    pitch_x: float | None = None,
+    pitch_y: float | None = None,
     columns: int = 3,
     rows: int = 2,
     **kwargs,
 ) -> Component:
     """Returns 2D array with fanout waveguides facing west.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/array_with_via.py` & `gdsfactory-7.0.0/gdsfactory/components/array_with_via.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.array_component import array
@@ -18,19 +18,19 @@
 @cell
 def array_with_via(
     component: ComponentSpec = pad,
     columns: int = 3,
     spacing: float = 150.0,
     via_spacing: float = 10.0,
     straight_length: float = 60.0,
-    cross_section: Optional[CrossSectionSpec] = metal2,
+    cross_section: CrossSectionSpec | None = metal2,
     via_stack: ComponentSpec = via_stack_factory,
     via_stack_dy: float = 0,
     port_orientation: float = 180,
-    port_offset: Optional[Float2] = None,
+    port_offset: Float2 | None = None,
     **kwargs,
 ) -> Component:
     """Returns an array of vias in X axis with fanout waveguides facing west.
 
     Args:
         component: to replicate in the array.
         columns: number of components.
@@ -94,36 +94,36 @@
     columns: int = 3,
     rows: int = 2,
     **kwargs,
 ) -> Component:
     """Returns 2D array with fanout waveguides facing west.
 
     Args:
-        spacing: 2D spacing
-        columns:
-        rows:
-        kwargs:
-            component: to replicate
-            columns: number of components
-            spacing: float
-            via_spacing: for fanout
-            straight_length: length of the straight at the end
-            via_stack_port_name:
-            **kwargs
+        spacing: 2D spacing x,y in um.
+        columns: number of columns.
+        rows: number of rows.
+
+    Keyword Args:
+        component: to replicate
+        columns: number of components
+        spacing: float
+        via_spacing: for fanout
+        straight_length: length of the straight at the end
+        via_stack_port_name:
     """
     row = array_with_via(columns=columns, spacing=spacing[0], **kwargs)
     return array(component=row, rows=rows, columns=1, spacing=(0, spacing[1]))
 
 
 if __name__ == "__main__":
     from gdsfactory.generic_tech import get_generic_pdk
 
     PDK = get_generic_pdk()
     PDK.activate()
-    via_stack_big = gf.partial(via_stack_factory, size=(30, 20))
+    via_stack_big = partial(via_stack_factory, size=(30, 20))
     # c = array_with_via(columns=3, width=10, via_spacing=20, port_orientation=90)
     c = array_with_via_2d(
         columns=2,
         rows=3,
         via_spacing=27.3,
         spacing=(150, 218),
         port_orientation=270,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/awg.py` & `gdsfactory-7.0.0/gdsfactory/components/awg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/bbox.py` & `gdsfactory-7.0.0/gdsfactory/components/bbox.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,23 +1,39 @@
 from __future__ import annotations
 
-from typing import Tuple, Union
+import gdsfactory as gf
 
-from numpy import array
+Float2 = tuple[float, float]
+Coordinate = tuple[Float2, Float2]
 
-import gdsfactory as gf
 
-Float2 = Tuple[float, float]
-Coordinate = Union[Tuple[Float2, Float2], array]
+def bbox_to_points(
+    bbox,
+    top: float = 0,
+    bottom: float = 0,
+    left: float = 0,
+    right: float = 0,
+) -> list[list[float]]:
+    (xmin, ymin), (xmax, ymax) = bbox
+    xmin = float(xmin)
+    xmax = float(xmax)
+    ymin = float(ymin)
+    ymax = float(ymax)
+    return [
+        [xmin - left, ymin - bottom],
+        [xmax + right, ymin - bottom],
+        [xmax + right, ymax + top],
+        [xmin - left, ymax + top],
+    ]
 
 
 @gf.cell_without_validator
 def bbox(
-    bbox: Tuple[Coordinate, Coordinate] = ((-1.0, -1.0), (3.0, 4.0)),
-    layer: Tuple[int, int] = (1, 0),
+    bbox: tuple[Coordinate, Coordinate] = ((-1.0, -1.0), (3.0, 4.0)),
+    layer: tuple[int, int] = (1, 0),
     top: float = 0,
     bottom: float = 0,
     left: float = 0,
     right: float = 0,
 ) -> gf.Component:
     """Returns bounding box rectangle from coordinates.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/bend_circular.py` & `gdsfactory-7.0.0/gdsfactory/components/bend_circular.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,21 +1,24 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.component import Component
 from gdsfactory.path import arc
+from gdsfactory.route_info import route_info_from_cs
 from gdsfactory.snap import snap_to_grid
-from gdsfactory.typings import CrossSectionSpec, Optional
+from gdsfactory.typings import CrossSectionSpec
 
 
 @gf.cell
 def bend_circular(
     angle: float = 90.0,
-    npoints: Optional[int] = None,
+    npoints: int | None = None,
     with_bbox: bool = True,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Returns a radial arc.
 
     Args:
@@ -43,20 +46,23 @@
     ref = c << path
     c.add_ports(ref.ports)
 
     c.absorb(ref)
     c.info["length"] = float(snap_to_grid(p.length()))
     c.info["dy"] = snap_to_grid(float(abs(p.points[0][0] - p.points[-1][0])))
     c.info["radius"] = float(radius)
+    c.info["route_info"] = route_info_from_cs(
+        cross_section, length=c.info["length"], n_bend_90=abs(angle / 90.0)
+    )
 
     if with_bbox and x.bbox_layers:
         padding = []
         for offset in x.bbox_offsets:
-            top = offset if angle in [180, -180, -90] else 0
-            bottom = 0 if angle in [-90] else offset
+            top = offset if angle in {180, -180, -90} else 0
+            bottom = 0 if angle in {-90} else offset
             points = get_padding_points(
                 component=c,
                 default=0,
                 bottom=bottom,
                 right=offset,
                 top=top,
             )
@@ -64,15 +70,15 @@
 
         for layer, points in zip(x.bbox_layers, padding):
             c.add_polygon(points, layer=layer)
 
     return c
 
 
-bend_circular180 = gf.partial(bend_circular, angle=180)
+bend_circular180 = partial(bend_circular, angle=180)
 
 
 if __name__ == "__main__":
     from gdsfactory.generic_tech import get_generic_pdk
 
     PDK = get_generic_pdk()
     PDK.activate()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/bend_circular_heater.py` & `gdsfactory-7.0.0/gdsfactory/components/bend_circular_heater.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,22 +1,23 @@
 from __future__ import annotations
 
+import numpy as np
+
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.component import Component
 from gdsfactory.path import arc
-from gdsfactory.snap import snap_to_grid
-from gdsfactory.typings import CrossSectionSpec, LayerSpec, Optional
+from gdsfactory.typings import CrossSectionSpec, LayerSpec
 
 
 @gf.cell
 def bend_circular_heater(
     radius: float = 10,
     angle: float = 90,
-    npoints: Optional[int] = None,
+    npoints: int | None = None,
     heater_to_wg_distance: float = 1.2,
     heater_width: float = 0.5,
     layer_heater: LayerSpec = "HEATER",
     with_bbox: bool = True,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
@@ -50,23 +51,23 @@
     )
     x = gf.CrossSection(
         width=width, offset=0, layer=layer, port_names=["in", "out"], sections=[s1, s2]
     )
 
     p = arc(radius=radius, angle=angle, npoints=npoints)
     c = p.extrude(x)
-    c.length = snap_to_grid(p.length())
+    c.length = np.round(p.length(), 3)
     c.dx = abs(p.points[0][0] - p.points[-1][0])
     c.dy = abs(p.points[0][0] - p.points[-1][0])
 
     if with_bbox and x.bbox_layers:
         padding = []
         for offset in x.bbox_offsets:
-            top = offset if angle in [180, -180, -90] else 0
-            bottom = 0 if angle in [-90] else offset
+            top = offset if angle in {180, -180, -90} else 0
+            bottom = 0 if angle in {-90} else offset
             points = get_padding_points(
                 component=c,
                 default=0,
                 bottom=bottom,
                 right=offset,
                 top=top,
             )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/bend_euler.py` & `gdsfactory-7.0.0/gdsfactory/components/bend_euler.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,32 +1,36 @@
 from __future__ import annotations
 
+from functools import partial
+
+import numpy as np
+
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.component import Component
 from gdsfactory.components.straight import straight
 from gdsfactory.components.wire import wire_corner
 from gdsfactory.cross_section import strip
 from gdsfactory.path import euler
-from gdsfactory.snap import snap_to_grid
-from gdsfactory.typings import CrossSectionSpec, Optional
+from gdsfactory.route_info import route_info_from_cs
+from gdsfactory.typings import CrossSectionSpec
 
 
 @gf.cell
 def bend_euler(
     angle: float = 90.0,
     p: float = 0.5,
     with_arc_floorplan: bool = True,
-    npoints: Optional[int] = None,
+    npoints: int | None = None,
     direction: str = "ccw",
     with_bbox: bool = True,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
-    """Returns an euler bend that transitions from straight to curved.
+    """Euler bend with changing bend radius.
 
     By default, `radius` corresponds to the minimum radius of curvature of the bend.
     However, if `with_arc_floorplan` is True, `radius` corresponds to the effective
     radius of curvature (making the curve a drop-in replacement for an arc). If
     p < 1.0, will create a "partial euler" curve as described in Vogelbacher et.
     al. https://dx.doi.org/10.1364/oe.27.031394
 
@@ -62,29 +66,32 @@
 
     c = Component()
     p = euler(
         radius=radius, angle=angle, p=p, use_eff=with_arc_floorplan, npoints=npoints
     )
     ref = c << p.extrude(x)
     c.add_ports(ref.ports)
-    c.info["length"] = snap_to_grid(p.length())
-    c.info["dy"] = snap_to_grid(abs(float(p.points[0][0] - p.points[-1][0])))
-    c.info["radius_min"] = snap_to_grid(p.info["Rmin"])
+    c.info["length"] = np.round(p.length(), 3)
+    c.info["dy"] = np.round(abs(float(p.points[0][0] - p.points[-1][0])), 3)
+    c.info["radius_min"] = np.round(p.info["Rmin"], 3)
     c.info["radius"] = radius
     c.info["width"] = x.width
+    c.info["route_info"] = route_info_from_cs(
+        cross_section, length=c.info["length"], n_bend_90=abs(angle / 90.0)
+    )
 
     if x.info:
         c.info.update(x.info)
 
     if with_bbox and x.bbox_layers:
         padding = []
         angle = int(angle)
         for offset in x.bbox_offsets:
-            top = offset if angle in [180, -180, -90] else 0
-            bottom = 0 if angle in [-90] else offset
+            top = offset if angle in {180, -180, -90} else 0
+            bottom = 0 if angle in {-90} else offset
             points = get_padding_points(
                 component=c,
                 default=0,
                 bottom=bottom,
                 right=offset,
                 top=top,
             )
@@ -96,15 +103,15 @@
     if direction == "cw":
         ref.mirror(p1=[0, 0], p2=[1, 0])
 
     c.absorb(ref)
     return c
 
 
-bend_euler180 = gf.partial(bend_euler, angle=180)
+bend_euler180 = partial(bend_euler, angle=180)
 
 
 @gf.cell
 def bend_euler_s(**kwargs) -> Component:
     r"""Sbend made of 2 euler bends.
 
     Keyword Args:
@@ -228,27 +235,25 @@
 if __name__ == "__main__":
     # PDK = get_generic_pdk()
     # PDK.activate()
     # c = bend_euler_s()
     # c = bend_euler(cross_section="rib", angle=180)
     # c = bend_euler(bbox_layers=[(2, 0), (3, 0)], bbox_offsets=[3, 3])
 
-    import numpy as np
-
-    c = gf.Component()
-    ps = np.arange(0, 1.1, 0.2)
-    for p in ps:
-        b = bend_euler(p=p, radius=10)
-        print(p, b.info["radius_min"])
-        c << b
+    # c = gf.Component()
+    # ps = np.arange(0, 1.1, 0.2)
+    # for p in ps:
+    #     b = bend_euler(p=p, radius=10)
+    #     print(p, b.info["radius_min"])
+    #     c << b
 
-    c.show(show_ports=True)
+    # c.show(show_ports=True)
 
     # c = bend_euler(direction="cw")
-    # c = bend_euler(angle=270)
+    c = bend_euler()
     # c.pprint()
     # p = euler()
     # c = bend_straight_bend()
     # c = _compare_bend_euler90()
 
     # c = gf.Component()
     # b1 = c << bend_euler()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/bend_port.py` & `gdsfactory-7.0.0/gdsfactory/components/bend_port.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,36 +1,34 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.components.bend_circular import bend_circular
 from gdsfactory.components.straight_heater_metal import straight_heater_metal
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def bend_port(
     component: ComponentSpec = straight_heater_metal,
-    port_name: str = "e1",
-    port_name2: str = "e2",
-    port_name1_bend: Optional[str] = None,
-    port_name2_bend: Optional[str] = None,
+    port_name: str = "l_e1",
+    port_name2: str = "r_e1",
+    port_name1_bend: str | None = None,
+    port_name2_bend: str | None = None,
     cross_section: CrossSectionSpec = "metal3_with_bend",
     bend: ComponentSpec = bend_circular,
     angle: float = 180,
-    extension_length: Optional[float] = None,
+    extension_length: float | None = None,
     **kwargs,
 ) -> gf.Component:
     """Returns a component with a bend and a straight extension.
 
     Args:
         component: to bend.
-        port_name: of the component.
-        port_name2: of the component, to extend to.
+        port_name: of the component port origin.
+        port_name2: of the component port destination.
         port_name1_bend: for bend port.
         port_name2_bend: for bend port.
         cross_section: for the bend.
         bend: factory for the bend.
         angle: for the bend.
         extension_length: for the straight after the bend.
         kwargs: cross_section settings.
@@ -73,11 +71,10 @@
 
 
 if __name__ == "__main__":
     # c = gf.components.straight_pin()
     # c = gf.components.straight_heater_metal()
     # c = bend_port(component=c, port_name="e1")
     # c = bend_port(component=gf.components.mzi_phase_shifter)
-
-    c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
-    c = bend_port(c)
+    # c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
+    c = bend_port()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/bend_s.py` & `gdsfactory-7.0.0/gdsfactory/components/bend_s.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,19 @@
 from __future__ import annotations
 
 import copy
+
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bezier import bezier
-from gdsfactory.typings import CrossSectionSpec, Float2
 from gdsfactory.config import logger
+from gdsfactory.typings import CrossSectionSpec, Float2
 
 
 @cell
 def bend_s(
     size: Float2 = (11.0, 2.0),
     npoints: int = 99,
     cross_section: CrossSectionSpec = "strip",
@@ -116,14 +117,15 @@
         except ValueError:
             break
 
     return min_size
 
 
 if __name__ == "__main__":
-    c = bend_s(bbox_offsets=[0.5], bbox_layers=[(111, 0)], width=2)
+    c = bend_s()
+    # c = bend_s(bbox_offsets=[0.5], bbox_layers=[(111, 0)], width=2)
     # c = bend_s(size=[10, 2.5])  # 10um bend radius
     # c = bend_s(size=[20, 3], cross_section="rib")  # 10um bend radius
     # c.pprint()
     # c = bend_s_biased()
     # print(c.info["min_bend_radius"])
     c.show(show_ports=False)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/bezier.py` & `gdsfactory-7.0.0/gdsfactory/components/bezier.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import numpy as np
 from numpy import ndarray
 
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.component import Component
 from gdsfactory.geometry.functions import angles_deg, curvature, path_length, snap_angle
@@ -33,16 +31,16 @@
 
 
 @gf.cell
 def bezier(
     control_points: Coordinates = ((0.0, 0.0), (5.0, 0.0), (5.0, 2.0), (10.0, 2.0)),
     npoints: int = 201,
     with_manhattan_facing_angles: bool = True,
-    start_angle: Optional[int] = None,
-    end_angle: Optional[int] = None,
+    start_angle: int | None = None,
+    end_angle: int | None = None,
     cross_section: CrossSectionSpec = "strip",
     with_bbox: bool = True,
     **kwargs,
 ) -> Component:
     """Returns Bezier bend.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cavity.py` & `gdsfactory-7.0.0/gdsfactory/components/cavity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cdc.py` & `gdsfactory-7.0.0/gdsfactory/components/cdc.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory import Component
 from gdsfactory.cross_section import strip
 from gdsfactory.typings import CrossSectionSpec
 
 
 def _generate_fins(c, x, fin_size, bend):
@@ -102,15 +100,15 @@
     period: float = 0.220,
     dc: float = 0.5,
     dx: float = 10.0,
     dy: float = 5.0,
     width_top: float = 2.0,
     width_bot: float = 0.75,
     fins: bool = False,
-    fin_size: Tuple[float, float] = (0.2, 0.05),
+    fin_size: tuple[float, float] = (0.2, 0.05),
     cross_section: CrossSectionSpec = strip,
     **kwargs,
 ) -> Component:
     """Grating-Assisted Contra-Directional Coupler.
 
     Args:
        length : Length of the coupling region.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cdsem_all.py` & `gdsfactory-7.0.0/gdsfactory/components/cdsem_all.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,33 +1,32 @@
 """CD SEM structures."""
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional, Tuple
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.cdsem_bend180 import cdsem_bend180
 from gdsfactory.components.cdsem_straight import cdsem_straight
 from gdsfactory.components.cdsem_straight_density import cdsem_straight_density
 from gdsfactory.components.text_rectangular import text_rectangular
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 text_rectangular_mini = partial(text_rectangular, size=1)
 
 
 @cell
 def cdsem_all(
-    widths: Tuple[float, ...] = (0.4, 0.45, 0.5, 0.6, 0.8, 1.0),
-    dense_lines_width: Optional[float] = 0.3,
+    widths: tuple[float, ...] = (0.4, 0.45, 0.5, 0.6, 0.8, 1.0),
+    dense_lines_width: float | None = 0.3,
     dense_lines_width_difference: float = 20e-3,
     dense_lines_gap: float = 0.3,
-    dense_lines_labels: Tuple[str, ...] = ("DL", "DM", "DH"),
+    dense_lines_labels: tuple[str, ...] = ("DL", "DM", "DH"),
     straight: ComponentSpec = "straight",
-    bend90: Optional[ComponentSpec] = "bend_circular",
+    bend90: ComponentSpec | None = "bend_circular",
     cross_section: CrossSectionSpec = "strip",
     text: ComponentSpec = text_rectangular_mini,
 ) -> Component:
     """Column with all optical PCMs.
 
     Args:
         widths: for straight lines.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cdsem_bend180.py` & `gdsfactory-7.0.0/gdsfactory/components/cdsem_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cdsem_coupler.py` & `gdsfactory-7.0.0/gdsfactory/components/cdsem_coupler.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 """CD SEM structures."""
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional, Tuple
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.coupler_straight import coupler_straight
 from gdsfactory.components.text_rectangular import text_rectangular
 from gdsfactory.grid import grid
@@ -15,17 +14,17 @@
 text_rectangular_mini = partial(text_rectangular, size=1)
 
 
 @cell
 def cdsem_coupler(
     width: float = 0.45,
     length: float = 420.0,
-    gaps: Tuple[float, ...] = (0.15, 0.2, 0.25),
+    gaps: tuple[float, ...] = (0.15, 0.2, 0.25),
     cross_section: CrossSectionSpec = "strip",
-    text: Optional[ComponentSpec] = text_rectangular_mini,
+    text: ComponentSpec | None = text_rectangular_mini,
     spacing: float = 3,
 ) -> Component:
     """Returns 2 coupled waveguides gap sweep.
 
     Args:
         width: for the waveguide.
         length: for the line.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cdsem_straight.py` & `gdsfactory-7.0.0/gdsfactory/components/cdsem_straight.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,30 +1,29 @@
 """CD SEM structures."""
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional, Tuple
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.straight import straight
 from gdsfactory.components.text_rectangular import text_rectangular
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 text_rectangular_mini = partial(text_rectangular, size=1)
 
 LINE_LENGTH = 420.0
 
 
 @cell
 def cdsem_straight(
-    widths: Tuple[float, ...] = (0.4, 0.45, 0.5, 0.6, 0.8, 1.0),
+    widths: tuple[float, ...] = (0.4, 0.45, 0.5, 0.6, 0.8, 1.0),
     length: float = LINE_LENGTH,
     cross_section: CrossSectionSpec = "strip",
-    text: Optional[ComponentSpec] = text_rectangular_mini,
+    text: ComponentSpec | None = text_rectangular_mini,
     spacing: float = 5,
 ) -> Component:
     """Returns straight waveguide lines width sweep.
 
     Args:
         widths: for the sweep.
         length: for the line.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cdsem_straight_density.py` & `gdsfactory-7.0.0/gdsfactory/components/cdsem_straight_density.py`

 * *Files 6% similar despite different names*

```diff
@@ -4,30 +4,30 @@
 from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.straight import straight
 from gdsfactory.components.text_rectangular import text_rectangular
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Floats, Optional
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Floats
 
 text_rectangular_mini = partial(text_rectangular, size=1)
 
 widths = 10 * [0.3]
 gaps = 10 * [0.3]
 
 
 @cell
 def cdsem_straight_density(
     widths: Floats = widths,
     gaps: Floats = gaps,
     length: float = 420.0,
     label: str = "",
     cross_section: CrossSectionSpec = "strip",
-    text: Optional[ComponentSpec] = text_rectangular_mini,
+    text: ComponentSpec | None = text_rectangular_mini,
 ) -> Component:
     """Returns sweep of dense straight lines.
 
     Args:
         widths: list of widths.
         gaps: list of gaps.
         length: of the lines.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/circle.py` & `gdsfactory-7.0.0/gdsfactory/components/circle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coh_rx_dual_pol.py` & `gdsfactory-7.0.0/gdsfactory/components/coh_rx_dual_pol.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,31 +1,29 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.coh_rx_single_pol import coh_rx_single_pol
 from gdsfactory.routing.get_route import get_route, get_route_from_waypoints
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @cell
 def coh_rx_dual_pol(
     bend: ComponentSpec = bend_euler,
     cross_section: CrossSectionSpec = "strip",
     lo_splitter: ComponentSpec = "mmi1x2",
-    signal_splitter: Optional[ComponentSpec] = None,
+    signal_splitter: ComponentSpec | None = None,
     spol_coh_rx: ComponentSpec = coh_rx_single_pol,
     single_pol_rx_spacing: float = 50.0,
     splitter_coh_rx_spacing: float = 40.0,
-    lo_input_coupler: Optional[ComponentSpec] = None,
-    signal_input_coupler: Optional[ComponentSpec] = None,
+    lo_input_coupler: ComponentSpec | None = None,
+    signal_input_coupler: ComponentSpec | None = None,
 ) -> Component:
     """Dual polarization coherent receiver.
 
     Args:
         bend: 90 degrees bend library.
         cross_section: for routing (splitter to mzms and mzms to combiners).
         lo_splitter: splitter function for the LO input.
@@ -155,18 +153,22 @@
 
     if lo_input_coupler is not None:
         lo_coupler = gf.get_component(lo_input_coupler)
         lo_coup = c << lo_coupler
         lo_coup.connect("o1", lo_split.ports["o1"])
 
     # ------ Extract electrical ports (if no pads) -------
-    c.add_ports(single_rx_1.get_ports_list(port_type="electrical"), prefix="pol1")
-    c.add_ports(single_rx_2.get_ports_list(port_type="electrical"), prefix="pol2")
-    c.auto_rename_ports()
+    c.add_ports(single_rx_1.get_ports_list(port_type="electrical"), prefix="pol1_")
+    c.add_ports(single_rx_2.get_ports_list(port_type="electrical"), prefix="pol2_")
+    c.add_ports(single_rx_1.get_ports_list(port_type="placement"), prefix="pol1_")
+    c.add_ports(single_rx_2.get_ports_list(port_type="placement"), prefix="pol2_")
 
+    c.add_ports(
+        lo_split.get_ports_list(port_type="optical", orientation=180), prefix="lo_"
+    )
     return c
 
 
 if __name__ == "__main__":
-    # c = coh_rx_dual_pol()
-    c = coh_rx_single_pol()
+    c = coh_rx_dual_pol()
+    # c = coh_rx_single_pol()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coh_rx_single_pol.py` & `gdsfactory-7.0.0/gdsfactory/components/coh_rx_single_pol.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.ge_detector_straight_si_contacts import (
     ge_detector_straight_si_contacts,
@@ -16,20 +14,20 @@
 
 @cell
 def coh_rx_single_pol(
     bend: ComponentSpec = "bend_euler",
     cross_section: CrossSectionSpec = "strip",
     hybrid_90deg: ComponentSpec = mmi_90degree_hybrid,
     detector: ComponentSpec = ge_detector_straight_si_contacts,
-    det_spacing: Tuple[float, float] = (60.0, 50.0),
+    det_spacing: tuple[float, float] = (60.0, 50.0),
     with_pads: bool = True,
     pad_det_spacing: float = 80.0,
     in_wg_length: float = 20.0,
-    lo_input_coupler: Optional[ComponentSpec] = None,
-    signal_input_coupler: Optional[ComponentSpec] = None,
+    lo_input_coupler: ComponentSpec | None = None,
+    signal_input_coupler: ComponentSpec | None = None,
 ) -> Component:
     r"""Single polarization coherent receiver.
 
     Args:
         bend: 90 degrees bend library.
         cross_section: for routing.
         hybrid_90deg: generates the 90 degree hybrid.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coh_tx_dual_pol.py` & `gdsfactory-7.0.0/gdsfactory/components/coh_tx_dual_pol.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,27 +1,25 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.routing.get_route import get_route
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @cell
 def coh_tx_dual_pol(
     splitter: ComponentSpec = "mmi1x2",
-    combiner: Optional[ComponentSpec] = None,
+    combiner: ComponentSpec | None = None,
     spol_coh_tx: ComponentSpec = "coh_tx_single_pol",
     yspacing: float = 10.0,
     xspacing: float = 40.0,
-    input_coupler: Optional[ComponentSpec] = None,
-    output_coupler: Optional[ComponentSpec] = None,
+    input_coupler: ComponentSpec | None = None,
+    output_coupler: ComponentSpec | None = None,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Dual polarization coherent transmitter.
 
     Args:
         splitter: splitter function.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coh_tx_single_pol.py` & `gdsfactory-7.0.0/gdsfactory/components/coh_tx_single_pol.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.routing.get_route import get_route
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 default_mzm = dict(
@@ -22,21 +20,21 @@
 def coh_tx_single_pol(
     balanced_phase_shifters: bool = False,
     mzm_y_spacing: float = 50.0,
     phase_shifter: ComponentSpec = "straight_pin",
     phase_shifter_length: float = 100.0,
     mzm_ps_spacing: float = 40.0,
     splitter: ComponentSpec = "mmi1x2",
-    combiner: Optional[ComponentSpec] = None,
+    combiner: ComponentSpec | None = None,
     mzm: ComponentSpec = default_mzm,
     mzm_length: float = 200.0,
     with_pads: bool = False,
     xspacing: float = 40.0,
-    input_coupler: Optional[ComponentSpec] = None,
-    output_coupler: Optional[ComponentSpec] = None,
+    input_coupler: ComponentSpec | None = None,
+    output_coupler: ComponentSpec | None = None,
     pad_array: ComponentSpec = "pad_array",
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """MZM-based single polarization coherent transmitter.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/compass.py` & `gdsfactory-7.0.0/gdsfactory/components/compass.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,24 +1,22 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.typings import Ints, LayerSpec
 
 
 @cell
 def compass(
     size=(4.0, 2.0),
     layer: LayerSpec = "WG",
-    port_type: Optional[str] = "placement",
+    port_type: str | None = "electrical",
     port_inclusion: float = 0.0,
-    port_orientations: Optional[Ints] = (180, 90, 0, -90),
+    port_orientations: Ints | None = (180, 90, 0, -90),
 ) -> Component:
     """Rectangle with ports on each edge (north, south, east, and west).
 
     Args:
         size: rectangle size.
         layer: tuple (int, int).
         port_type: optical, electrical.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/component_lattice.py` & `gdsfactory-7.0.0/gdsfactory/components/component_lattice.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
 import itertools
-from typing import Optional, Dict, List, Tuple
 
 from numpy import float64
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.coupler import coupler
 from gdsfactory.components.crossing_waveguide import compensation_path, crossing45
@@ -133,15 +132,15 @@
 def component_lattice(
     lattice: str = """
         C-X
         CXX
         CXX
         C-X
         """,
-    symbol_to_component: Optional[Dict[str, Component]] = None,
+    symbol_to_component: dict[str, Component] | None = None,
     grid_per_unit: int = 1000,
 ) -> Component:
     """Return a lattice Component of N inputs and outputs Columns must have.
 
     components with the same x spacing between input/output ports Lines must
     have components with the same y spacing between input/output ports.
 
@@ -258,16 +257,16 @@
         x += L
 
     component.auto_rename_ports()
     return component
 
 
 def parse_lattice(
-    lattice: str, symbol_to_component: Dict[str, Component]
-) -> Tuple[Dict[int, List[str]], Dict[int, float64]]:
+    lattice: str, symbol_to_component: dict[str, Component]
+) -> tuple[dict[int, list[str]], dict[int, float64]]:
     """Extract each column.
 
     Args:
         lattice: string describing lattice.
         symbol_to_component: dict of ASCII character to component.
     """
     lines = lattice.replace(" ", "").split("\n")
@@ -290,18 +289,20 @@
                         cmp.ports[pccw[0].name].x - cmp.ports[pcw[0].name].x
                     )
 
     return columns, columns_to_length
 
 
 if __name__ == "__main__":
-    components_dict = {
-        "C": gf.routing.fanout2x2(component=gf.components.coupler(), port_spacing=40.0),
-        "X": crossing45(port_spacing=40.0),
-        "-": compensation_path(crossing45=crossing45(port_spacing=40.0)),
-    }
-    c = gf.components.component_lattice(symbol_to_component=components_dict)
+    # components_dict = {
+    #     "C": gf.routing.fanout2x2(component=gf.components.coupler(), port_spacing=40.0),
+    #     "X": crossing45(port_spacing=40.0),
+    #     "-": compensation_path(crossing45=crossing45(port_spacing=40.0)),
+    # }
+    # c = gf.components.component_lattice(symbol_to_component=components_dict)
     # c= gf.routing.fanout2x2(component=gf.components.coupler(), port_spacing=40.0)
     # c= crossing45(port_spacing=40.0)
     # c = compensation_path(crossing45=crossing45(port_spacing=40.0))
-    c.pprint_ports()
+    # c.pprint_ports()
+    # c = compensation_path()
+    c = component_lattice()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/component_sequence.py` & `gdsfactory-7.0.0/gdsfactory/components/component_sequence.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
 from collections import Counter
-from typing import Dict, Optional, Tuple
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import ComponentSpec
 
 
 class SequenceGenerator:
@@ -43,15 +42,15 @@
         self.end_sequence = end_sequence
         self.repeated_sequence = repeated_sequence
 
     def get_sequence(self, n=2):
         return self.start_sequence + n * self.repeated_sequence + self.end_sequence
 
 
-def parse_component_name(name: str) -> Tuple[str, bool]:
+def parse_component_name(name: str) -> tuple[str, bool]:
     """If the component name has more than one character and starts with "!".
 
     then we need to flip along the axis given by the input port angle.
     """
     return (name[1:], True) if len(name) != 1 and name[0] == "!" else (name, False)
 
 
@@ -63,16 +62,16 @@
         c_ref.mirror_x(port_name)
     return c_ref
 
 
 @gf.cell
 def component_sequence(
     sequence: str,
-    symbol_to_component: Dict[str, Tuple[ComponentSpec, str, str]],
-    ports_map: Optional[Dict[str, Tuple[str, str]]] = None,
+    symbol_to_component: dict[str, tuple[ComponentSpec, str, str]],
+    ports_map: dict[str, tuple[str, str]] | None = None,
     port_name1: str = "o1",
     port_name2: str = "o2",
     start_orientation: float = 0.0,
 ) -> Component:
     """Returns component from ASCII sequence.
 
     if you prefix a symbol with ! it mirrors the component
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/copy_layers.py` & `gdsfactory-7.0.0/gdsfactory/components/copy_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler90.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler90.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,25 +1,27 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_circular import bend_circular
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Optional
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def coupler90(
     gap: float = 0.2,
     radius: float = 10.0,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight,
     cross_section: CrossSectionSpec = "strip",
-    bend_cross_section: Optional[CrossSectionSpec] = None,
+    bend_cross_section: CrossSectionSpec | None = None,
     **kwargs,
 ) -> Component:
     r"""Straight coupled to a bend.
 
     Args:
         gap: um.
         radius: um.
@@ -62,15 +64,15 @@
 
     c.add_ports(wg_ref.ports, prefix="wg")
     c.add_ports(bend_ref.ports, prefix="bend")
     c.auto_rename_ports()
     return c
 
 
-coupler90circular = gf.partial(coupler90, bend=bend_circular)
+coupler90circular = partial(coupler90, bend=bend_circular)
 
 
 if __name__ == "__main__":
     # c = coupler90circular(gap=0.3)
     # c << coupler90(gap=0.3)
     c = coupler90(radius=3, layer=(2, 0))
     c = coupler90(radius=10, cross_section="strip_heater_metal")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler90bend.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler90bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler_adiabatic.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler_asymmetric.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler_full.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler_full.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler_ring.py` & `gdsfactory-7.0.0/gdsfactory/samples/14_component_connectivity.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,114 +1,96 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.components.bend_euler import bend_euler
-from gdsfactory.components.straight import straight
-from gdsfactory.components.coupler90 import coupler90
-from gdsfactory.components.coupler_straight import coupler_straight
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
-def coupler_ring(
+def ring_single_sample(
     gap: float = 0.2,
-    radius: float = 5.0,
+    radius: float = 10.0,
     length_x: float = 4.0,
-    coupler90: ComponentSpec = coupler90,
-    bend: ComponentSpec = bend_euler,
-    coupler_straight: ComponentSpec = coupler_straight,
+    length_y: float = 0.010,
+    coupler_ring: ComponentSpec = "coupler_ring",
+    straight: ComponentSpec = "straight",
+    bend: ComponentSpec = "bend_euler",
     cross_section: CrossSectionSpec = "strip",
-    bend_cross_section: Optional[CrossSectionSpec] = None,
-    length_extension: float = 3,
     **kwargs,
 ) -> Component:
-    r"""Coupler for ring.
+    """Single bus ring made of a ring coupler.
+
+    (cb: bottom) connected with two vertical straights (wl: left, wr: right)
+    two bends (bl, br) and horizontal straight (wg: top).
 
     Args:
-        gap: spacing between parallel coupled straight waveguides.
-        radius: of the bends.
-        length_x: length of the parallel coupled straight waveguides.
-        coupler90: straight coupled to a 90deg bend.
-        bend: bend spec.
-        coupler_straight: two parallel coupled straight waveguides.
-        cross_section: cross_section spec.
-        bend_cross_section: optional bend cross_section spec.
-        length_extension: for the ports.
-        kwargs: cross_section settings for bend and coupler.
+        gap: gap between for coupler.
+        radius: for the bend and coupler.
+        length_x: ring coupler length.
+        length_y: vertical straight length.
+        coupler_ring: ring coupler function.
+        straight: straight function.
+        bend: 90 degrees bend function.
+        cross_section: spec.
+        kwargs: cross_section settings.
+
 
     .. code::
 
-           2             3
-           |             |
-            \           /
-             \         /
-           ---=========---
-         1    length_x    4
+          bl-wt-br
+          |      |
+          wl     wr length_y
+          |      |
+         --==cb==-- gap
+
+          length_x
 
     """
-    c = Component()
     gap = gf.snap.snap_to_grid(gap, nm=2)
 
-    # define subcells
-    coupler90_component = gf.get_component(
-        coupler90,
+    coupler_ring_component = gf.get_component(
+        coupler_ring,
+        bend=bend,
         gap=gap,
         radius=radius,
-        bend=bend,
+        length_x=length_x,
         cross_section=cross_section,
-        bend_cross_section=bend_cross_section,
         **kwargs,
     )
-    coupler_straight_component = gf.get_component(
-        coupler_straight,
-        gap=gap,
-        length=length_x,
-        cross_section=cross_section,
-        **kwargs,
+    straight_side = gf.get_component(
+        straight, length=length_y, cross_section=cross_section, **kwargs
     )
+    straight_top = gf.get_component(
+        straight, length=length_x, cross_section=cross_section, **kwargs
+    )
+
+    bend = gf.get_component(bend, radius=radius, cross_section=cross_section, **kwargs)
 
-    # add references to subcells
-    cbl = c << coupler90_component
-    cbr = c << coupler90_component
-    cs = c << coupler_straight_component
-
-    # connect references
-    y = coupler90_component.y
-    cs.connect(port="o4", destination=cbr.ports["o1"])
-    cbl.mirror(p1=(0, y), p2=(1, y))
-    cbl.connect(port="o2", destination=cs.ports["o2"])
-
-    s = straight(length=length_extension, cross_section=cross_section, **kwargs)
-
-    s1 = c << s
-    s2 = c << s
-
-    s1.connect("o2", cbl["o4"])
-    s2.connect("o1", cbr["o4"])
-
-    c.add_port("o1", port=s1["o1"])
-    c.add_port("o2", port=cbl["o3"])
-    c.add_port("o3", port=cbr["o3"])
-    c.add_port("o4", port=s2["o2"])
-
-    c.add_ports(cbl.get_ports_list(port_type="electrical"), prefix="cbl")
-    c.add_ports(cbr.get_ports_list(port_type="electrical"), prefix="cbr")
-    c.auto_rename_ports()
+    c = Component()
+    cb = c << coupler_ring_component
+    wl = c << straight_side
+    wr = c << straight_side
+    bl = c << bend
+    br = c << bend
+    wt = c << straight_top
+    # wt.mirror(p1=(0, 0), p2=(1, 0))
+
+    wl.connect(port="o2", destination=cb.ports["o2"])
+    bl.connect(port="o2", destination=wl.ports["o1"])
+
+    wt.connect(port="o2", destination=bl.ports["o1"])
+    br.connect(port="o2", destination=wt.ports["o1"])
+    wr.connect(port="o1", destination=br.ports["o1"])
+
+    c.add_port("o2", port=cb.ports["o2"])
+    c.add_port("o1", port=cb.ports["o1"])
     return c
 
 
+def test_ring_single_sample() -> None:
+    assert ring_single_sample()
+
+
 if __name__ == "__main__":
-    c = coupler_ring()
-    # c = coupler_ring(width=1, layer=(2, 0), length_x=20)
-    # c = coupler_ring(cross_section="strip_heater_metal", length_x=20)
-
-    # c = gf.Component()
-    # c1 = coupler_ring(cladding_layers=[(111, 0)], cladding_offsets=[0.5])
-    # d = 0.8
-    # c2 = gf.geometry.offset(c1, distance=+d, layer=(111, 0))
-    # c3 = gf.geometry.offset(c2, distance=-d, layer=(111, 0))
-    # c << c1
-    # c << c3
+    c = ring_single_sample(width=2, gap=1, layer=(2, 0))
+    print(c.ports)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler_straight.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler_straight_asymmetric.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler_straight_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/coupler_symmetric.py` & `gdsfactory-7.0.0/gdsfactory/components/coupler_symmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cross.py` & `gdsfactory-7.0.0/gdsfactory/components/cross.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def cross(
     length: float = 10.0,
     width: float = 3.0,
     layer: LayerSpec = "WG",
-    port_type: Optional[str] = None,
+    port_type: str | None = None,
 ) -> Component:
     """Returns a cross from two rectangles of length and width.
 
     Args:
         length: float Length of the cross from one end to the other.
         width: float Width of the arms of the cross.
         layer: layer for geometry.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/crossing_waveguide.py` & `gdsfactory-7.0.0/gdsfactory/components/crossing_waveguide.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import numpy as np
 from numpy import float64
 
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.cell import cell
@@ -228,18 +228,19 @@
     return c
 
 
 @cell
 def crossing45(
     crossing: ComponentSpec = crossing,
     port_spacing: float = 40.0,
-    dx: Optional[float] = None,
+    dx: float | None = None,
     alpha: float = 0.08,
     npoints: int = 101,
     cross_section: CrossSectionSpec = "strip",
+    cross_section_bends: CrossSectionSpec = "strip_no_pins",
 ) -> Component:
     r"""Returns 45deg crossing with bends.
 
     Args:
         crossing: crossing function.
         port_spacing: target I/O port spacing.
         dx: target length.
@@ -256,28 +257,29 @@
         ----   ----
             \ /
              X
             / \
         ---    ----
 
     """
-    crossing = gf.get_component(crossing)
+    crossing = gf.get_component(
+        crossing, cross_section=cross_section_bends or cross_section
+    )
 
     c = Component()
     x = c << crossing
     x.rotate(45)
 
     # Add bends
     p_e = x.ports["o3"].center
     p_w = x.ports["o1"].center
     p_n = x.ports["o2"].center
     p_s = x.ports["o4"].center
 
     # Flatten the crossing - not an SRef anymore
-    c.absorb(x)
     dx = dx or port_spacing
     dy = port_spacing / 2
 
     start_angle = 45
     end_angle = 0
     cpts = find_min_curv_bezier_control_points(
         start_point=p_e,
@@ -289,14 +291,15 @@
     )
 
     bend = bezier(
         control_points=cpts,
         start_angle=start_angle,
         end_angle=end_angle,
         npoints=npoints,
+        cross_section=cross_section_bends,
     )
 
     tol = 1e-2
     assert abs(bend.info["start_angle"] - start_angle) < tol, print(
         f"{bend.info['start_angle']} differs from {start_angle}"
     )
     assert abs(bend.info["end_angle"] - end_angle) < tol, bend.info["end_angle"]
@@ -306,14 +309,15 @@
     b_bl = bend.ref(position=p_w, port_id="o1", rotation=180)
     b_br = bend.ref(position=p_s, port_id="o1", v_mirror=True)
 
     for cmp_ref in [b_tr, b_br, b_tl, b_bl]:
         # cmp_ref = _cmp.ref()
         c.add(cmp_ref)
         c.absorb(cmp_ref)
+    c.absorb(x)
 
     c.info["bezier_length"] = bend.info["length"]
     c.info["min_bend_radius"] = b_br.info["min_bend_radius"]
     c.bezier = bend
     c.crossing = crossing
 
     c.add_port("o1", port=b_bl.ports["o2"])
@@ -327,17 +331,21 @@
         c = x.add_bbox(c)
     if x.add_pins:
         c = x.add_pins(c)
 
     return c
 
 
+crossing45_pins = partial(crossing45, cross_section="strip")
+
+
 @cell
 def compensation_path(
-    crossing45: ComponentSpec = crossing45,
+    crossing45: ComponentSpec = crossing45_pins,
+    crossing: ComponentSpec = crossing,
     direction: str = "top",
     cross_section: CrossSectionSpec = "strip",
 ) -> Component:
     r"""Returns Component Path with same path length as the crossing.
 
     with input and output ports having same y coordinates
 
@@ -415,15 +423,15 @@
     y_bend = solution.root
     y_bend = snap_to_grid(y_bend)
 
     v_mirror = direction != "top"
     sbend = bezier(control_points=get_control_pts(x0, y_bend))
 
     c = Component()
-    crossing0 = c << crossing45.crossing
+    crossing0 = c << gf.get_component(crossing)
 
     sbend_left = sbend.ref(
         position=crossing0.ports["o1"], port_id="o2", v_mirror=v_mirror
     )
     sbend_right = sbend.ref(
         position=crossing0.ports["o3"], port_id="o2", h_mirror=True, v_mirror=v_mirror
     )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv` & `gdsfactory-7.0.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv` & `gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv` & `gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv` & `gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv` & `gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv` & `gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv` & `gdsfactory-7.0.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cutback_2x2.py` & `gdsfactory-7.0.0/gdsfactory/components/cutback_2x2.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_circular import bend_circular180
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.mmi2x2 import mmi2x2
 from gdsfactory.components.straight import straight
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Optional
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def bendu_double(
     component: ComponentSpec,
     cross_section: CrossSectionSpec = "strip",
     bend180: ComponentSpec = bend_circular180,
@@ -41,15 +41,15 @@
 
 @gf.cell
 def straight_double(
     component: ComponentSpec,
     cross_section: CrossSectionSpec = "strip",
     port1: str = "o1",
     port2: str = "o2",
-    straight_length: Optional[float] = None,
+    straight_length: float | None = None,
     **kwargs,
 ) -> ComponentSpec:
     """Returns double straight"""
     xs = gf.get_cross_section(cross_section, **kwargs)
 
     straight_double = gf.Component("straight_double")
     straight_component = straight(
@@ -78,15 +78,15 @@
     rows: int = 5,
     port1: str = "o1",
     port2: str = "o2",
     port3: str = "o3",
     port4: str = "o4",
     bend180: ComponentSpec = bend_circular180,
     mirror: bool = False,
-    straight_length: Optional[float] = None,
+    straight_length: float | None = None,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Returns a daisy chain of splitters for measuring their loss.
 
     Args:
         component: for cutback.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cutback_bend.py` & `gdsfactory-7.0.0/gdsfactory/components/cutback_bend.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 from __future__ import annotations
 
+from functools import partial
+
 from numpy import float64
 
-import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_circular import bend_circular, bend_circular180
 from gdsfactory.components.bend_euler import bend_euler, bend_euler180
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.straight import straight
 from gdsfactory.typings import ComponentSpec
@@ -18,25 +19,27 @@
     bsy = abs(p2.y - p1.y)
     return max(bsx, bsy)
 
 
 @cell
 def cutback_bend(
     bend90: ComponentSpec = bend_euler,
+    straight: ComponentSpec = straight,
     straight_length: float = 5.0,
     rows: int = 6,
     columns: int = 5,
     **kwargs,
 ) -> Component:
     """Deprecated.
 
     Use cutback_bend90 instead with smaller footprint.
 
     Args:
         bend90: bend spec.
+        straight: straight spec.
         straight_length: in um.
         rows: number of rows.
         columns: number of columns.
         kwargs: cross_section settings.
 
     .. code::
 
@@ -72,24 +75,26 @@
     c.info["n_bends"] = rows * columns * 2 + columns * 2 - 2
     return c
 
 
 @cell
 def cutback_bend90(
     bend90: ComponentSpec = bend_euler,
+    straight: ComponentSpec = straight,
     straight_length: float = 5.0,
     rows: int = 6,
     columns: int = 6,
     spacing: int = 5,
     **kwargs,
 ) -> Component:
     """Returns bend90 cutback.
 
     Args:
         bend90: bend spec.
+        straight: straight spec.
         straight_length: in um.
         rows: number of rows.
         columns: number of columns.
         kwargs: cross_section settings.
 
     .. code::
 
@@ -125,23 +130,25 @@
     c.info["n_bends"] = rows * columns * 4
     return c
 
 
 @cell
 def staircase(
     bend90: ComponentSpec = bend_euler,
+    straight: ComponentSpec = straight,
     length_v: float = 5.0,
     length_h: float = 5.0,
     rows: int = 4,
     **kwargs,
 ) -> Component:
     """Returns staircase.
 
     Args:
         bend90: bend spec.
+        straight: straight spec.
         length_v: vertical length.
         length_h: vertical length.
         rows: number of rows.
         columns: number of columns.
         kwargs: cross_section settings.
     """
     bend90 = bend90(**kwargs) if callable(bend90) else bend90
@@ -166,24 +173,26 @@
     c.info["n_bends"] = 2 * rows
     return c
 
 
 @cell
 def cutback_bend180(
     bend180: ComponentSpec = bend_euler180,
+    straight: ComponentSpec = straight,
     straight_length: float = 5.0,
     rows: int = 6,
     columns: int = 6,
     spacing: int = 3,
     **kwargs,
 ) -> Component:
     """Returns cutback to measure u bend loss.
 
     Args:
         bend180: bend spec.
+        straight: straight spec.
         straight_length: in um.
         rows: number of rows.
         columns: number of columns.
         spacing: in um.
         kwargs: cross_section settings.
 
     .. code::
@@ -221,16 +230,16 @@
     c = component_sequence(
         sequence=s, symbol_to_component=symbol_to_component, start_orientation=0
     )
     c.info["n_bends"] = rows * columns * 2 + columns * 2 - 2
     return c
 
 
-cutback_bend180circular = gf.partial(cutback_bend180, bend180=bend_circular180)
-cutback_bend90circular = gf.partial(cutback_bend90, bend90=bend_circular)
+cutback_bend180circular = partial(cutback_bend180, bend180=bend_circular180)
+cutback_bend90circular = partial(cutback_bend90, bend90=bend_circular)
 
 if __name__ == "__main__":
     # c = cutback_bend()
     # c = cutback_bend90()
     # c = cutback_bend_circular(rows=7, columns=4, radius=5) #62
     # c = cutback_bend_circular(rows=14, columns=4) #118
     # c = cutback_bend90()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cutback_component.py` & `gdsfactory-7.0.0/gdsfactory/components/cutback_component.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,32 +1,34 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler180
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.straight import straight
 from gdsfactory.components.taper import taper
 from gdsfactory.components.taper_from_csv import taper_0p5_to_3_l36
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Optional
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def cutback_component(
     component: ComponentSpec = taper_0p5_to_3_l36,
     cols: int = 4,
     rows: int = 5,
     port1: str = "o1",
     port2: str = "o2",
     bend180: ComponentSpec = bend_euler180,
     mirror: bool = False,
     mirror1: bool = False,
     mirror2: bool = False,
-    straight_length: Optional[float] = None,
-    straight_length_pair: Optional[float] = None,
+    straight_length: float | None = None,
+    straight_length_pair: float | None = None,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Returns a daisy chain of components for measuring their loss.
 
     Works only for components with 2 ports (input, output).
 
@@ -68,25 +70,25 @@
     # Generate the sequence of staircases
 
     s = ""
     for i in range(rows):
         a = "!A" if mirror1 else "A"
         b = "!B" if mirror2 else "B"
 
-        s += (a + "." + b) * cols if straight_length_pair else (a + b) * cols
+        s += f"{a}.{b}" * cols if straight_length_pair else (a + b) * cols
         if mirror:
             s += "C" if i % 2 == 0 else "D"
         else:
             s += "D" if i % 2 == 0 else "C"
 
     s = s[:-1]
     s += "-_"
 
     for i in range(rows):
-        s += (a + "." + b) * cols if straight_length_pair else (a + b) * cols
+        s += f"{a}.{b}" * cols if straight_length_pair else (a + b) * cols
         s += "D" if (i + rows) % 2 == 0 else "C"
 
     s = s[:-1]
 
     seq = component_sequence(sequence=s, symbol_to_component=symbol_to_component)
 
     c = gf.Component()
@@ -95,19 +97,19 @@
 
     n = 2 * s.count("A")
     c.copy_child_info(component)
     c.info["components"] = n
     return c
 
 
-# straight_wide = gf.partial(straight, width=3, length=20)
-# bend180_wide = gf.partial(bend_euler180, width=3)
-component_flipped = gf.partial(taper, width2=0.5, width1=3)
-straight_long = gf.partial(straight, length=20)
-cutback_component_mirror = gf.partial(cutback_component, mirror=True)
+# straight_wide = partial(straight, width=3, length=20)
+# bend180_wide = partial(bend_euler180, width=3)
+component_flipped = partial(taper, width2=0.5, width1=3)
+straight_long = partial(straight, length=20)
+cutback_component_mirror = partial(cutback_component, mirror=True)
 
 
 if __name__ == "__main__":
     c = cutback_component()
     # c = cutback_component_mirror(component=component_flipped)
     # c = gf.routing.add_fiber_single(c)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/cutback_splitter.py` & `gdsfactory-7.0.0/gdsfactory/components/cutback_splitter.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,28 +2,28 @@
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler180
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.mmi1x2 import mmi1x2
 from gdsfactory.components.straight import straight
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Optional
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def cutback_splitter(
     component: ComponentSpec = mmi1x2,
     cols: int = 4,
     rows: int = 5,
     port1: str = "o1",
     port2: str = "o2",
     port3: str = "o3",
     bend180: ComponentSpec = bend_euler180,
     mirror: bool = False,
-    straight_length: Optional[float] = None,
+    straight_length: float | None = None,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Returns a daisy chain of splitters for measuring their loss.
 
     Args:
         component: for cutback.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/dbr.py` & `gdsfactory-7.0.0/gdsfactory/components/dbr.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/dbr_tapered.py` & `gdsfactory-7.0.0/gdsfactory/components/dbr_tapered.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,19 +1,17 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory import Component
 from gdsfactory.typings import CrossSectionSpec
 
 
 def _generate_fins(
     c: Component,
-    fin_size: Tuple[float, float],
+    fin_size: tuple[float, float],
     taper_length: float,
     length: float,
     xs: CrossSectionSpec,
 ) -> Component:
     num_fins = xs.width // (2 * fin_size[1])
     x0, y0 = (
         0,
@@ -57,15 +55,15 @@
     length: float = 10.0,
     period: float = 0.85,
     dc: float = 0.5,
     w1: float = 0.4,
     w2: float = 1.0,
     taper_length: float = 20.0,
     fins: bool = False,
-    fin_size: Tuple[float, float] = (0.2, 0.05),
+    fin_size: tuple[float, float] = (0.2, 0.05),
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Distributed Bragg Reflector Cell class.
 
     Tapers the input straight to a
     periodic straight structure with varying width (1-D photonic crystal).
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/delay_snake.py` & `gdsfactory-7.0.0/gdsfactory/components/delay_snake.py`

 * *Files 1% similar despite different names*

```diff
@@ -82,19 +82,18 @@
     )
     c.add(route.references)
     c.add_port("o1", port=route.ports[0])
     c.add_port("o2", port=route.ports[1])
     return c
 
 
-def test_delay_snake_length():
+def test_delay_snake_length() -> None:
     length = 200.0
     c = delay_snake(n=1, length=length, cross_section="strip_no_pins")
     length_computed = c.area() / 0.5
     np.isclose(length, length_computed)
-    return c
 
 
 if __name__ == "__main__":
     c = test_delay_snake_length()
     # c = delay_snake(cross_section="strip_auto_widen", auto_widen_minimum_length=50)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/delay_snake2.py` & `gdsfactory-7.0.0/gdsfactory/components/delay_snake2.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,15 +2,14 @@
 
 import warnings
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
-
 diagram = """
        | length0 | length1 |
 
                  >---------|
                            | bend180.length
        |-------------------|
        |
@@ -88,22 +87,21 @@
     sequence = sequence[:-1]
     sequence += "."
     return gf.components.component_sequence(
         sequence=sequence, symbol_to_component=symbol_to_component
     )
 
 
-def test_length_delay_snake2():
+def test_length_delay_snake2() -> Component:
     import numpy as np
 
     length = 200.0
     c = delay_snake2(length=length, cross_section="strip_no_pins")
     length_computed = c.area() / 0.5
     np.isclose(length, length_computed)
-    return c
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
     # c = test_length_delay_snake2()
     # c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/delay_snake3.py` & `gdsfactory-7.0.0/gdsfactory/components/delay_snake3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/delay_snake_sbend.py` & `gdsfactory-7.0.0/gdsfactory/components/delay_snake_sbend.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,15 +1,14 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.straight import straight
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
-
 diagram = r"""
 
                          length1
          <----------------------------
                length2    spacing    |
                 _______              |
                |        \            |
@@ -121,22 +120,21 @@
     c.add_port("o2", port=s4.ports["o2"])
 
     c.info["min_bend_radius"] = sbend.info["min_bend_radius"]
     c.info["bend180_radius"] = bend180_radius
     return c
 
 
-def test_delay_snake_sbend_length():
+def test_delay_snake_sbend_length() -> None:
     import numpy as np
 
     length = 200.0
     c = delay_snake_sbend(length=length, cross_section="strip_no_pins")
     length_computed = c.area() / 0.5
     np.isclose(length, length_computed)
-    return c
 
 
 if __name__ == "__main__":
     c = test_delay_snake_sbend_length()
     # c = gf.grid(
     #     [
     #         delay_snake_sbend(length=length, cross_section="rib")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/dicing_lane.py` & `gdsfactory-7.0.0/gdsfactory/components/dicing_lane.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,16 +1,18 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.components.triangles import triangle
 from gdsfactory.typings import ComponentSpec, Float2, LayerSpec
 
-triangle_metal = gf.partial(triangle, layer="M3", xtop=2)
+triangle_metal = partial(triangle, layer="M3", xtop=2)
 
 
 @gf.cell
 def dicing_lane(
     size: Float2 = (50, 300),
     marker: ComponentSpec = triangle_metal,
     layer_dicing: LayerSpec = "DICING",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/die.py` & `gdsfactory-7.0.0/gdsfactory/components/die.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,32 +1,31 @@
 """based on phidl.geometry."""
 
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.components.text import text
-from gdsfactory.typings import LayerSpec
+from gdsfactory.typings import ComponentSpec, Float2, LayerSpec
 
 
 @gf.cell
 def die(
-    size: Tuple[float, float] = (10000.0, 10000.0),
+    size: tuple[float, float] = (10000.0, 10000.0),
     street_width: float = 100.0,
     street_length: float = 1000.0,
-    die_name: Optional[str] = "chip99",
+    die_name: str | None = "chip99",
     text_size: float = 100.0,
-    text_location: str = "SW",
+    text_location: str | Float2 = "SW",
     layer: LayerSpec = "FLOORPLAN",
-    bbox_layer: Optional[LayerSpec] = "FLOORPLAN",
+    bbox_layer: LayerSpec | None = "FLOORPLAN",
     draw_corners: bool = True,
     draw_dicing_lane: bool = True,
+    text_component: ComponentSpec = text,
 ) -> gf.Component:
     """Returns basic die with 4 right angle corners marking the boundary of the.
 
     chip/die and a label with the name of the die.
 
     Args:
         size: x, y dimensions of the die.
@@ -35,14 +34,15 @@
         die_name: Label text.
         text_size: Label text size.
         text_location: {'NW', 'N', 'NE', 'SW', 'S', 'SE'} Label text compass location.
         layer: Specific layer to put polygon geometry on.
         bbox_layer: optional bbox layer.
         draw_corners: around die.
         draw_dicing_lane: around die.
+        text_component: component to use for generating text
     """
     c = gf.Component(name="die")
     sx, sy = size[0] / 2, size[1] / 2
 
     if draw_dicing_lane:
         street_length = sy
 
@@ -63,18 +63,18 @@
         c.add_polygon([xpts, -ypts], layer=layer)
         c.add_polygon([-xpts, -ypts], layer=layer)
 
     if bbox_layer:
         c.add_polygon([[sx, sy], [sx, -sy], [-sx, -sy], [-sx, sy]], layer=bbox_layer)
 
     if die_name:
-        t = c.add_ref(text(text=die_name, size=text_size, layer=layer))
+        t = c.add_ref(text_component(text=die_name, size=text_size, layer=layer))
 
         d = street_width + 20
-        if type(text_location) is str:
+        if isinstance(text_location, str):
             text_location = text_location.upper()
             if text_location == "N":
                 t.x, t.ymax = [0, sy - d]
             elif text_location == "NE":
                 t.xmax, t.ymax = [sx - d, sy - d]
             elif text_location == "NW":
                 t.xmin, t.ymax = [-sx + d, sy - d]
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/die_bbox.py` & `gdsfactory-7.0.0/gdsfactory/components/die_bbox.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 """based on phidl.geometry."""
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.components.text import text
 from gdsfactory.typings import Anchor, ComponentSpec, LayerSpec
 
-big_square = gf.partial(rectangle, size=(1300, 2600))
+big_square = partial(rectangle, size=(1300, 2600))
 
 
 @gf.cell
 def die_bbox(
     component: ComponentSpec = big_square,
     street_width: float = 100.0,
-    street_length: Optional[float] = None,
-    die_name: Optional[str] = None,
+    street_length: float | None = None,
+    die_name: str | None = None,
     text_size: float = 100.0,
     text_anchor: Anchor = "sw",
     layer: LayerSpec = "M3",
     padding: float = 10.0,
 ) -> gf.Component:
     """Returns component with boundary box frame around it.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/die_bbox_frame.py` & `gdsfactory-7.0.0/gdsfactory/components/die_bbox_frame.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,26 +1,25 @@
 from __future__ import annotations
 
-from typing import Optional, Tuple, Union
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.components.text import text
 from gdsfactory.typings import Anchor, LayerSpec
 
-Coordinate = Union[Tuple[float, float], Tuple[int, int]]
+Number = float | int
+Coordinate = tuple[Number, Number]
 
 
 @gf.cell_without_validator
 def die_bbox_frame(
-    bbox: Tuple[Coordinate, Coordinate] = ((-1.0, -1.0), (3.0, 4.0)),
+    bbox: tuple[Coordinate, Coordinate] = ((-1.0, -1.0), (3.0, 4.0)),
     street_width: float = 100.0,
     street_length: float = 1000.0,
-    die_name: Optional[str] = None,
+    die_name: str | None = None,
     text_size: float = 100.0,
     text_anchor: Anchor = "sw",
     layer: LayerSpec = "M3",
     padding: float = 10.0,
 ) -> gf.Component:
     """Return boundary box frame.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/disk.py` & `gdsfactory-7.0.0/gdsfactory/components/disk.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,15 +1,14 @@
 from __future__ import annotations
-from typing import Optional
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory import Component
-from gdsfactory.typings import CrossSectionSpec, LayerSpec, ComponentSpec
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec, LayerSpec
 
 
 def _compute_parameters(xs_bend, wrap_angle_deg, radius):
     r_bend = xs_bend.radius
     theta = wrap_angle_deg / 2.0
     size_x, dy = r_bend * np.sin(theta * np.pi / 180), r_bend - r_bend * np.cos(
         theta * np.pi / 180
@@ -196,15 +195,15 @@
     parity: int = 1,
     cross_section: CrossSectionSpec = "strip",
     heater_layer: LayerSpec = "HEATER",
     via_stack: ComponentSpec = "via_stack_heater_mtop",
     heater_width: float = 5.0,
     heater_extent: float = 2.0,
     via_width: float = 10.0,
-    port_orientation: Optional[float] = 90,
+    port_orientation: float | None = 90,
     **kwargs,
 ) -> Component:
     """Disk Resonator with top metal heater.
 
     Args:
        radius: disk resonator radius.
        gap: Distance between the bus straight and resonator.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/edge_coupler_array.py` & `gdsfactory-7.0.0/gdsfactory/components/edge_coupler_array.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,28 +1,30 @@
 from __future__ import annotations
 
+from functools import partial
+
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.extension import extend_ports
 from gdsfactory.components.taper import taper
 from gdsfactory.components.text import text_rectangular
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Float2, Optional
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Float2
 
-edge_coupler_silicon = gf.partial(taper, width2=0.2, length=100, with_two_ports=False)
+edge_coupler_silicon = partial(taper, width2=0.2, length=100, with_two_ports=False)
 
 
 @gf.cell
 def edge_coupler_array(
     edge_coupler: ComponentSpec = edge_coupler_silicon,
     n: int = 5,
     pitch: float = 127.0,
     x_reflection: bool = False,
-    text: Optional[ComponentSpec] = text_rectangular,
+    text: ComponentSpec | None = text_rectangular,
     text_offset: Float2 = (10, 20),
     text_rotation: float = 0,
 ) -> Component:
     """Fiber array edge coupler based on an inverse taper.
 
     Each edge coupler adds a ruler for polishing.
 
@@ -64,15 +66,15 @@
     cross_section: CrossSectionSpec = "strip",
     radius: float = 30,
     n: int = 8,
     pitch: float = 127.0,
     extension_length: float = 1.0,
     right_loopback: bool = True,
     x_reflection: bool = False,
-    text: Optional[ComponentSpec] = text_rectangular,
+    text: ComponentSpec | None = text_rectangular,
     text_offset: Float2 = (0, 0),
     text_rotation: float = 0,
 ) -> Component:
     """Fiber array edge coupler.
 
     Args:
         edge_coupler: edge coupler.
@@ -98,15 +100,15 @@
         text_rotation=text_rotation,
     )
     if extension_length > 0:
         ec = extend_ports(
             component=ec,
             port_names=("o1", "o2"),
             length=extension_length,
-            extension=gf.partial(
+            extension=partial(
                 gf.c.straight, cross_section=cross_section, length=extension_length
             ),
         )
 
     ec_ref = c << ec
     route1 = gf.routing.get_route(
         ec_ref.ports["o1"],
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ellipse.py` & `gdsfactory-7.0.0/gdsfactory/components/ellipse.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import numpy as np
 from numpy import cos, pi, sin, sqrt
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def ellipse(
-    radii: Tuple[float, float] = (10.0, 5.0),
+    radii: tuple[float, float] = (10.0, 5.0),
     angle_resolution: float = 2.5,
     layer: LayerSpec = "WG",
 ) -> Component:
     """Returns ellipse component.
 
     Args:
         radii: Semimajor and semiminor axis lengths of the ellipse.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/extend_ports_list.py` & `gdsfactory-7.0.0/gdsfactory/components/extend_ports_list.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 from __future__ import annotations
 
-from typing import List, Optional
-
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.port import Port
 from gdsfactory.typings import ComponentSpec, Strs
 
 
 @cell
 def extend_ports_list(
-    ports: List[Port],
+    ports: list[Port],
     extension: ComponentSpec,
-    extension_port_name: Optional[str] = None,
-    ignore_ports: Optional[Strs] = None,
+    extension_port_name: str | None = None,
+    ignore_ports: Strs | None = None,
 ) -> Component:
     """Returns a component with the extensions for a list of ports.
 
     Args:
         ports: list of ports.
         extension: function for extension.
         extension_port_name: to connect extension.
@@ -51,15 +49,15 @@
     e = extend_ports_list(c0.get_ports_list(), extension="straight")
     c << c0
     c << e
     c.show(show_ports=True)
 
     # c = gf.Component("mmi_extended")
     # m = gf.components.mmi1x2()
-    # t = gf.partial(gf.components.taper, width2=0.1)
+    # t = partial(gf.components.taper, width2=0.1)
     # e = extend_ports_list(
     #     ports=m.get_ports_list(), extension=t, extension_port_name="o1"
     # )
 
     # c << m
     # c << e
     # c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/extension.py` & `gdsfactory-7.0.0/gdsfactory/components/extension.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from __future__ import annotations
 
 import warnings
-from typing import List, Optional, Tuple, Union
+from functools import partial
 
 import numpy as np
 from numpy import ndarray
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
@@ -14,18 +14,18 @@
 from gdsfactory.port import Port
 from gdsfactory.typings import ComponentSpec, Coordinate, CrossSectionSpec, Layer
 
 DEG2RAD = np.pi / 180
 
 
 def line(
-    p_start: Union[Port, Coordinate],
-    p_end: Union[Port, Coordinate],
-    width: Optional[float] = None,
-) -> Tuple[float, float, float, float]:
+    p_start: Port | Coordinate,
+    p_end: Port | Coordinate,
+    width: float | None = None,
+) -> tuple[float, float, float, float]:
     if isinstance(p_start, gf.Port):
         width = p_start.width
         p_start = p_start.center
 
     if isinstance(p_end, gf.Port):
         p_end = p_end.center
 
@@ -36,30 +36,28 @@
     p1 = move_polar_rad_copy(p_start, angle - a, w / 2)
     p2 = move_polar_rad_copy(p_end, angle - a, w / 2)
     p3 = move_polar_rad_copy(p_end, angle + a, w / 2)
     return p0, p1, p2, p3
 
 
 def move_polar_rad_copy(pos: Coordinate, angle: float, length: float) -> ndarray:
-    """Returns the points of a position (pos) with angle, by shifted by certain.
-
-    length.
+    """Returns the points of a position (pos) with angle, shifted by length.
 
     Args:
         pos: position.
         angle: in radians.
         length: extension length in um.
     """
     c = np.cos(angle)
     s = np.sin(angle)
     return pos + length * np.array([c, s])
 
 
 @cell
-def extend_port(port: Port, length: float, layer: Optional[Layer] = None) -> Component:
+def extend_port(port: Port, length: float, layer: Layer | None = None) -> Component:
     """Returns a straight extension component out of a port.
 
     Args:
         port: port to extend.
         length: extension length in um.
         layer: for the straight section.
     """
@@ -73,33 +71,33 @@
     w = port.width
 
     _line = line(p_start, p_end, w)
 
     c.add_polygon(_line, layer=layer)
     c.add_port(name="original", port=port)
 
-    port_settings = port.settings.copy()
+    port_settings = port.to_dict()
     port_settings.update(center=p_end)
     c.add_port(**port_settings)
 
     return c
 
 
 @gf.cell
 def extend_ports(
     component: ComponentSpec = mmi1x2,
-    port_names: Optional[Tuple[str, ...]] = None,
+    port_names: tuple[str, ...] | None = None,
     length: float = 5.0,
-    extension: Optional[ComponentSpec] = None,
-    port1: Optional[str] = None,
-    port2: Optional[str] = None,
+    extension: ComponentSpec | None = None,
+    port1: str | None = None,
+    port2: str | None = None,
     port_type: str = "optical",
     centered: bool = False,
-    cross_section: Optional[CrossSectionSpec] = None,
-    extension_port_names: Optional[List[str]] = None,
+    cross_section: CrossSectionSpec | None = None,
+    extension_port_names: list[str] | None = None,
     **kwargs,
 ) -> Component:
     """Returns a new component with some ports extended.
 
     You can define extension Spec
     defaults to port cross_section of each port to extend.
 
@@ -124,15 +122,14 @@
         layers_excluded: List of layers to exclude.
         port_type: optical, electrical, ....
         clockwise: if True, sort ports clockwise, False: counter-clockwise.
     """
     c = gf.Component()
     component = gf.get_component(component)
     cref = c << component
-    c.component = component
 
     if centered:
         cref.x = 0
         cref.y = 0
 
     ports_all = cref.get_ports_list()
     port_names_all = [p.name for p in ports_all]
@@ -173,29 +170,29 @@
             port2 = port2 or port_labels[-1]
 
             extension_ref = c << extension_component
             extension_ref.connect(port1, port)
             c.add_port(port_name, port=extension_ref.ports[port2])
             extension_port_names = extension_port_names or []
             [
-                c.add_port(name, port=extension_ref.ports[name], prefix=port_name)
+                c.add_port(name, port=extension_ref.ports[name])
                 for name in extension_port_names
             ]
         else:
             c.add_port(port_name, port=component.ports[port_name])
 
     c.copy_child_info(component)
     return c
 
 
-def test_extend_ports() -> Component:
+def test_extend_ports() -> None:
     import gdsfactory.components as pc
 
     width = 0.5
-    xs_strip = gf.partial(
+    xs_strip = partial(
         gf.cross_section.strip,
         width=width,
         cladding_layers=None,
         add_pins=None,
         add_bbox=None,
     )
 
@@ -220,46 +217,16 @@
     assert p == 0, p
 
     c4 = extend_ports(component=c, port_type="electrical")
     p = len(c4.polygons)
     assert p == 0, p
     assert len(c4.references) == 1, len(c4.references)
 
-    return c4
-
 
 __all__ = ["extend_ports", "extend_port"]
 
 
 if __name__ == "__main__":
-    # c0 = gf.components.taper(width2=10)
-    extension = gf.components.straight_heater_meander()
-    c0 = gf.components.straight()
-    # c1 = extend_ports(c0, orientation=0, extension=extension)
-
-    c1 = extend_ports(
-        c0,
-        extension=extension,
-        orientation=0,
-        extension_port_names=["e1", "e2"],
-        port1="o1",
-        port2="o2",
-    )
-    c1.pprint_ports()
-    c1.show(show_ports=True)
-
-    # c = extend_ports(gf.components.mzi_phase_shifter_top_heater_metal)
-    # c = test_extend_ports()
-
-    # width = 0.5
-    # xs_strip = gf.partial(
-    #     gf.cross_section.strip,
-    #     width=width,
-    #     cladding_layers=None,
-    #     add_pins=None,
-    #     add_bbox=None,
-    # )
-
-    # import gdsfactory.components as pc
-    # c = pc.straight(cross_section=xs_strip)
-    # c4 = extend_ports(component=c, port_type='electrical')
-    # c4.show()
+    c0 = gf.c.straight()
+    p0 = c0["o1"]
+    c = extend_port(p0, length=100)
+    c.show()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/fiber.py` & `gdsfactory-7.0.0/gdsfactory/components/fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/fiber_array.py` & `gdsfactory-7.0.0/gdsfactory/components/fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/fiducial_squares.py` & `gdsfactory-7.0.0/gdsfactory/components/fiducial_squares.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ge_detector_straight_si_contacts.py` & `gdsfactory-7.0.0/gdsfactory/components/ge_detector_straight_si_contacts.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,36 +1,33 @@
 """Straight Ge photodetector."""
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.taper import taper as taper_func
-from gdsfactory.components.via_stack import via_stack_slab_m3, via_stack_slab_m2
+from gdsfactory.components.via_stack import via_stack_slab_m2, via_stack_slab_m3
 from gdsfactory.cross_section import pn_ge_detector_si_contacts
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Tuple, Union
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 default_taper = partial(
     taper_func, length=20.0, width1=0.5, width2=0.8, cross_section="strip"
 )
 
 
 @gf.cell
 def ge_detector_straight_si_contacts(
     length: float = 80.0,
     cross_section: CrossSectionSpec = pn_ge_detector_si_contacts,
-    via_stack: Union[
-        ComponentSpec, Tuple[ComponentSpec, ComponentSpec]
-    ] = via_stack_slab_m3,
+    via_stack: ComponentSpec | tuple[ComponentSpec, ComponentSpec] = via_stack_slab_m3,
     via_stack_width: float = 10.0,
     via_stack_spacing: float = 5.0,
     via_stack_offset: float = 0.0,
-    taper: Optional[ComponentSpec] = default_taper,
+    taper: ComponentSpec | None = default_taper,
     **kwargs,
 ) -> Component:
     """Returns a straight Ge on Si detector with silicon contacts.
 
     There are no contacts on the Ge. These detectors could have lower
     dark current and sensitivity compared to those with contacts in the
     Ge. See Chen et al., "High-Responsivity Low-Voltage 28-Gb/s Ge p-i-n
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_dual_pol.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_dual_pol.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.components.taper import taper as taper_function
@@ -28,15 +27,15 @@
     x_span: float = 11,
     y_span: float = 11,
     length_taper: float = 150.0,
     width_taper: float = 10.0,
     polarization: str = "dual",
     wavelength: float = 1.55,
     taper: ComponentSpec = taper_function,
-    base_layer: Optional[LayerSpec] = "WG",
+    base_layer: LayerSpec | None = "WG",
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     r"""2 dimensional, dual polarization grating coupler.
 
     Based on a photonic crystal with a unit cell that is usually an ellipse,
     a rectangle or a circle.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,10 @@
 from __future__ import annotations
 
+from functools import partial
 
 import numpy as np
 from numpy import ndarray
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.geometry.functions import DEG2RAD, extrude_path
@@ -235,15 +236,15 @@
         orientation=0,
         layer=layer,
         port_type=name,
     )
     return c
 
 
-grating_coupler_elliptical_tm = gf.partial(
+grating_coupler_elliptical_tm = partial(
     grating_coupler_elliptical,
     grating_line_width=0.707,
     polarization="tm",
     taper_length=30,
     slab_xmin=-2,
     neff=1.8,
     n_periods=16,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py`

 * *Files 2% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.grating_coupler_elliptical import (
     grating_taper_points,
     grating_tooth_points,
 )
 from gdsfactory.geometry.functions import DEG2RAD
-from gdsfactory.typings import CrossSectionSpec, Floats, LayerSpec, Optional
+from gdsfactory.typings import CrossSectionSpec, Floats, LayerSpec
 
 _gaps = (0.1,) * 10
 _widths = (0.5,) * 10
 
 
 @gf.cell
 def grating_coupler_elliptical_arbitrary(
@@ -21,15 +21,15 @@
     widths: Floats = _widths,
     taper_length: float = 16.6,
     taper_angle: float = 60.0,
     wavelength: float = 1.554,
     fiber_angle: float = 15.0,
     nclad: float = 1.443,
     layer_slab: LayerSpec = "SLAB150",
-    layer_grating: Optional[LayerSpec] = None,
+    layer_grating: LayerSpec | None = None,
     taper_to_slab_offset: float = -3.0,
     polarization: str = "te",
     spiked: bool = True,
     bias_gap: float = 0,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from __future__ import annotations
 
 from functools import partial
-from typing import Any, Dict, Optional
+from typing import Any
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.grating_coupler_elliptical_arbitrary import (
     grating_coupler_elliptical_arbitrary,
 )
 from gdsfactory.config import PATH
@@ -69,15 +69,15 @@
 def grating_coupler_elliptical_lumerical(
     parameters: Floats = parameters,
     layer: LayerSpec = "WG",
     layer_slab: LayerSpec = "SLAB150",
     taper_angle: float = 55,
     taper_length: float = 12.24 + 0.36,
     fiber_angle: float = 5,
-    info: Optional[Dict[str, Any]] = None,
+    info: dict[str, Any] | None = None,
     bias_gap: float = 0,
     **kwargs,
 ) -> Component:
     """Returns a grating coupler from lumerical inverse design 3D optimization.
 
     this is a wrapper of components.grating_coupler_elliptical_arbitrary
     https://support.lumerical.com/hc/en-us/articles/1500000306621
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_elliptical_trenches.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_elliptical_trenches.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,9 +1,11 @@
 from __future__ import annotations
 
+from functools import partial
+
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.grating_coupler_elliptical import grating_tooth_points
 from gdsfactory.geometry.functions import DEG2RAD
 from gdsfactory.typings import CrossSectionSpec, LayerSpec
@@ -41,14 +43,15 @@
         grating_line_width: of the 220 ridge.
         neff: tooth effective index.
         ncladding: cladding index.
         layer_trench: for the trench.
         p_start: first tooth.
         n_periods: number of grating teeth.
         end_straight_length: at the end of straight.
+        cross_section: cross_section spec.
         kwargs: cross_section settings.
 
 
     .. code::
 
                       fiber
 
@@ -97,17 +100,17 @@
     x_taper = x1 * p_taper_eff
     x_output = a_taper + x_taper - taper_length + grating_line_width / 2
 
     xmax = x_output + taper_length + n_periods * period + 3
     y = wg_width / 2 + np.tan(taper_angle / 2 * np.pi / 180) * xmax
     pts = [
         (x_output, -wg_width / 2),
-        (x_output, wg_width / 2),
-        (xmax, y),
-        (xmax + end_straight_length, y),
+        (x_output, +wg_width / 2),
+        (xmax, +y),
+        (xmax + end_straight_length, +y),
         (xmax + end_straight_length, -y),
         (xmax, -y),
     ]
     c.add_polygon(pts, layer)
 
     c.add_port(
         name="o1",
@@ -134,27 +137,28 @@
         orientation=0,
         layer=layer,
         port_type=name,
     )
     return c
 
 
-grating_coupler_te = gf.partial(
+grating_coupler_te = partial(
     grating_coupler_elliptical_trenches, polarization="te", taper_angle=35
 )
 
-grating_coupler_tm = gf.partial(
+grating_coupler_tm = partial(
     grating_coupler_elliptical_trenches,
     polarization="tm",
     neff=1.8,
     grating_line_width=0.6,
 )
 
 
 if __name__ == "__main__":
+    c = grating_coupler_te()
     # c = grating_coupler_elliptical_trenches(polarization="TE")
     # print(c.polarization)
     # c = grating_coupler_te(end_straight_length=10)
     # c = grating_coupler_tm()
     # print(c.ports.keys())
-    c = gf.routing.add_fiber_array(grating_coupler=grating_coupler_elliptical_trenches)
+    # c = gf.routing.add_fiber_array(grating_coupler=grating_coupler_elliptical_trenches)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_functions.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_functions.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 from numpy import pi, sin, sqrt
 
 neff_ridge = 2.8
 neff_shallow = 2.5
 
 
 def get_grating_period_curved(
     fiber_angle: float = 15.0,
     wavelength: float = 1.55,
     n_slab: float = (neff_ridge + neff_shallow) / 2,
     n_clad: float = 1.0,
-) -> Tuple[float, float]:
+) -> tuple[float, float]:
     """The following function calculates the confocal grating periods n_slab is.
 
     the "average slab index" of the grating. For 220nm silicon it is 2.8, for
     150nm it is 2.5. The average is approximately 2.65. n_clad is the cladding
     index in which the fiber is located, not the index of the layer above the
     straight. If the fiber is in air, then it is 1.0. If you use an index
     matching fluid or glue, then it should be 1.45.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_loss.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_loss.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from __future__ import annotations
 
 import inspect
-from typing import List, Tuple, Callable
+from collections.abc import Callable
 
 import gdsfactory as gf
 from gdsfactory.add_labels import get_input_label as get_input_label_function
 from gdsfactory.cell import cell
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.components.grating_coupler_elliptical_trenches import grating_coupler_te
 from gdsfactory.port import Port
@@ -18,15 +18,15 @@
     port0: Port,
     port1: Port,
     a: float,
     b: float,
     y_bot_align_route: float,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
-) -> List[ComponentReference]:
+) -> list[ComponentReference]:
     """Connects loopback structure."""
     p0 = port0.center
     p1 = port1.center
     points = [
         p0,
         p0 + (0, a),
         p0 + (b, a),
@@ -47,15 +47,15 @@
     ).references
 
 
 @cell
 def loss_deembedding_ch13_24(
     pitch: float = 127.0,
     grating_coupler: ComponentSpec = grating_coupler_te,
-    input_port_indexes: Tuple[int, ...] = (0, 1),
+    input_port_indexes: tuple[int, ...] = (0, 1),
     cross_section: CrossSectionSpec = "strip",
     port_name: str = "o1",
     get_input_label: Callable = get_input_label_function,
     **kwargs,
 ) -> Component:
     """Grating coupler test structure for fiber array.
 
@@ -115,15 +115,15 @@
     return c
 
 
 @cell
 def loss_deembedding_ch12_34(
     pitch: float = 127.0,
     grating_coupler: ComponentSpec = grating_coupler_te,
-    input_port_indexes: Tuple[int, ...] = (0, 2),
+    input_port_indexes: tuple[int, ...] = (0, 2),
     port_name: str = "o1",
     cross_section: CrossSectionSpec = "strip",
     get_input_label: Callable = get_input_label_function,
     **kwargs,
 ) -> Component:
     """Grating coupler test structure for fiber array.
 
@@ -179,15 +179,15 @@
     return c
 
 
 @cell
 def loss_deembedding_ch14_23(
     pitch: float = 127.0,
     grating_coupler: ComponentSpec = grating_coupler_te,
-    input_port_indexes: Tuple[int, ...] = (0, 1),
+    input_port_indexes: tuple[int, ...] = (0, 1),
     cross_section: CrossSectionSpec = "strip",
     port_name: str = "o1",
     get_input_label: Callable = get_input_label_function,
     **kwargs,
 ) -> Component:
     """Grating coupler test structure for fiber array.
 
@@ -243,15 +243,15 @@
     return c
 
 
 @cell
 def grating_coupler_loss_fiber_array(
     pitch: float = 127.0,
     grating_coupler: ComponentSpec = grating_coupler_te,
-    input_port_indexes: Tuple[int, ...] = (0, 1),
+    input_port_indexes: tuple[int, ...] = (0, 1),
     port_name: str = "o1",
     cross_section: CrossSectionSpec = "strip",
     get_input_label: Callable = get_input_label_function,
     **kwargs,
 ) -> Component:
     """Returns Grating coupler fiber array loopback.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_loss_fiber_single.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_loss_fiber_single.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,11 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.grating_coupler_elliptical_trenches import grating_coupler_te
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
@@ -43,12 +45,12 @@
     )
 
     c.copy_child_info(grating_coupler)
     return c
 
 
 if __name__ == "__main__":
-    xs_strip2 = gf.partial(gf.cross_section.strip, layer=(2, 0))
+    xs_strip2 = partial(gf.cross_section.strip, layer=(2, 0))
     c = grating_coupler_loss_fiber_single(
         min_input_to_output_spacing=300, cross_section=xs_strip2
     )
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_rectangular.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_rectangular.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, LayerSpec
@@ -17,15 +15,15 @@
     period: float = 0.75,
     fill_factor: float = 0.5,
     width_grating: float = 11.0,
     length_taper: float = 150.0,
     polarization: str = "te",
     wavelength: float = 1.55,
     taper: ComponentSpec = taper_function,
-    layer_slab: Optional[LayerSpec] = "SLAB150",
+    layer_slab: LayerSpec | None = "SLAB150",
     fiber_angle: float = 15,
     slab_xmin: float = -1.0,
     slab_offset: float = 1.0,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     r"""Grating coupler with rectangular shapes (not elliptical).
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.snap import snap_to_grid
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Floats, LayerSpec
@@ -18,16 +16,16 @@
 def grating_coupler_rectangular_arbitrary(
     gaps: Floats = _gaps,
     widths: Floats = _widths,
     width_grating: float = 11.0,
     length_taper: float = 150.0,
     polarization: str = "te",
     wavelength: float = 1.55,
-    taper: Optional[ComponentSpec] = taper_function,
-    layer_grating: Optional[LayerSpec] = None,
+    taper: ComponentSpec | None = taper_function,
+    layer_grating: LayerSpec | None = None,
     layer_slab: LayerSpec = "SLAB150",
     slab_xmin: float = -1.0,
     slab_offset: float = 1.0,
     fiber_angle: float = 15,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.components.taper import taper_strip_to_slab150
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Floats, LayerSpec
@@ -19,15 +17,15 @@
     gaps: Floats = _gaps,
     widths: Floats = _widths,
     width_grating: float = 11.0,
     length_taper: float = 150.0,
     polarization: str = "te",
     wavelength: float = 1.55,
     taper: ComponentSpec = taper_strip_to_slab150,
-    layer_slab: Optional[LayerSpec] = "SLAB150",
+    layer_slab: LayerSpec | None = "SLAB150",
     slab_offset: float = 2.0,
     fiber_angle: float = 15,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     r"""Grating coupler uniform (grating with rectangular shape not elliptical). Therefore it needs a longer taper. Grating teeth are straight instead of elliptical.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/grating_coupler_tree.py` & `gdsfactory-7.0.0/gdsfactory/components/grating_coupler_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/greek_cross.py` & `gdsfactory-7.0.0/gdsfactory/components/greek_cross.py`

 * *Files 5% similar despite different names*

```diff
@@ -3,41 +3,40 @@
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.components.cross import cross
 from gdsfactory.components.pad import pad
 from gdsfactory.components.rectangle import rectangle
-from gdsfactory.components.via_stack import via_stack
-from gdsfactory.typings import LayerSpecs, ComponentSpec, Floats, CrossSectionSpec
-from gdsfactory.components.via_stack import via_stack_npp_m1, via_stack_m1_m3
+from gdsfactory.components.via_stack import via_stack, via_stack_m1_m3, via_stack_npp_m1
 from gdsfactory.cross_section import metal1
-from typing import Optional
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Floats, LayerSpecs
 
 
 @gf.cell
 def greek_cross(
     length: float = 30,
     layers: LayerSpecs = (
         "WG",
         "N",
     ),
     widths: Floats = (2.0, 3.0),
-    offsets: Optional[Floats] = None,
+    offsets: Floats | None = None,
     via_stack: ComponentSpec = via_stack_npp_m1,
 ) -> gf.Component:
     """Simple greek cross with via stacks at the endpoints.
 
-    A greek cross is a process control monitor for dopant sheet resistivity and linewidth variation.
+    Process control monitor for dopant sheet resistivity and linewidth variation.
 
     Args:
-        length: length of cross arms
-        layers: list of layers
-        widths: list of widths (same order as layers)
-        offsets: how much to extend each layer beyond the cross of length "length" (negative shorter, positive longer)
+        length: length of cross arms.
+        layers: list of layers.
+        widths: list of widths (same order as layers).
+        offsets: how much to extend each layer beyond the cross length
+            negative shorter, positive longer.
         via: via component to attach to the cross.
 
     .. code::
 
             via_stack
             <------->
             _________       length          ________
@@ -45,23 +44,25 @@
         2x  |       |     |   ↓       |<-->|
             |       |======== width =======|
             |_______|<--> |   ↑       |<-->|________
                     offset            offset
 
 
     References:
+
     - Walton, Anthony J.. “MICROELECTRONIC TEST STRUCTURES.” (1999).
     - W. Versnel, Analysis of the Greek cross, a Van der Pauw structure with finite
         contacts, Solid-State Electronics, Volume 22, Issue 11, 1979, Pages 911-914,
         ISSN 0038-1101, https://doi.org/10.1016/0038-1101(79)90061-3.
     - S. Enderling et al., "Sheet resistance measurement of non-standard cleanroom
         materials using suspended Greek cross test structures," IEEE Transactions on
         Semiconductor Manufacturing, vol. 19, no. 1, pp. 2-9, Feb. 2006,
         doi: 10.1109/TSM.2005.863248.
     - https://download.tek.com/document/S530_VanDerPauwSheetRstnce.pdf
+
     """
     c = gf.Component()
 
     if len(layers) != len(widths):
         raise ValueError("len(layers) must equal len(widths).")
 
     offsets = offsets or (0.0,) * len(layers)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/hline.py` & `gdsfactory-7.0.0/gdsfactory/components/hline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/interdigital_capacitor.py` & `gdsfactory-7.0.0/gdsfactory/components/interdigital_capacitor.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,24 +1,23 @@
 from __future__ import annotations
 
 from itertools import chain
 from math import ceil, floor
-from typing import Union
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def interdigital_capacitor(
     fingers: int = 4,
-    finger_length: Union[float, int] = 20.0,
-    finger_gap: Union[float, int] = 2.0,
-    thickness: Union[float, int] = 5.0,
+    finger_length: float | int = 20.0,
+    finger_gap: float | int = 2.0,
+    thickness: float | int = 5.0,
     layer: LayerSpec = "WG",
 ) -> Component:
     """Generates an interdigital capacitor with ports on both ends.
 
     See for example Zhu et al., `Accurate circuit model of interdigital
     capacitor and its application to design of new uasi-lumped miniaturized
     filters with suppression of harmonic resonance`, doi: 10.1109/22.826833.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/litho_calipers.py` & `gdsfactory-7.0.0/gdsfactory/components/litho_calipers.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,21 +1,19 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.typings import LayerSpec
 
 
 @cell
 def litho_calipers(
-    notch_size: Tuple[float, float] = (2.0, 5.0),
+    notch_size: tuple[float, float] = (2.0, 5.0),
     notch_spacing: float = 2.0,
     num_notches: int = 11,
     offset_per_notch: float = 0.1,
     row_spacing: float = 0.0,
     layer1: LayerSpec = "WG",
     layer2: LayerSpec = "SLAB150",
 ) -> Component:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/litho_ruler.py` & `gdsfactory-7.0.0/gdsfactory/components/litho_ruler.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,21 +1,19 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def litho_ruler(
     height: float = 2,
     width: float = 0.5,
     spacing: float = 2.0,
-    scale: Tuple[float, ...] = (3, 1, 1, 1, 1, 2, 1, 1, 1, 1),
+    scale: tuple[float, ...] = (3, 1, 1, 1, 1, 2, 1, 1, 1, 1),
     num_marks: int = 21,
     layer: LayerSpec = "WG",
 ) -> gf.Component:
     """Ruler structure for lithographic measurement.
 
     Includes marks of varying scales to allow for easy reading by eye.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/litho_steps.py` & `gdsfactory-7.0.0/gdsfactory/components/litho_steps.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,20 +1,18 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory import components as pc
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def litho_steps(
-    line_widths: Tuple[float, ...] = (1.0, 2.0, 4.0, 8.0, 16.0),
+    line_widths: tuple[float, ...] = (1.0, 2.0, 4.0, 8.0, 16.0),
     line_spacing: float = 10.0,
     height: float = 100.0,
     layer: LayerSpec = "WG",
 ) -> Component:
     """Positive + negative tone linewidth test.
 
     used for lithography resolution test patterning
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/logo.py` & `gdsfactory-7.0.0/gdsfactory/components/logo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/loop_mirror.py` & `gdsfactory-7.0.0/gdsfactory/components/loop_mirror.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mmi1x2.py` & `gdsfactory-7.0.0/gdsfactory/components/mmi1x2.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,33 +1,34 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.component import Component
-from gdsfactory.components.straight import straight
+from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Optional
+from gdsfactory.typings import ComponentFactory, CrossSectionSpec
 
 
 @gf.cell
 def mmi1x2(
-    width: Optional[float] = None,
+    width: float | None = None,
     width_taper: float = 1.0,
     length_taper: float = 10.0,
     length_mmi: float = 5.5,
     width_mmi: float = 2.5,
     gap_mmi: float = 0.25,
-    taper: ComponentSpec = taper_function,
+    taper: ComponentFactory = taper_function,
+    straight: ComponentFactory = straight_function,
     with_bbox: bool = True,
     cross_section: CrossSectionSpec = "strip",
 ) -> Component:
-    r"""Mmi 1x2.
+    r"""1x2 MultiMode Interferometer (MMI).
 
     Args:
-        width: input and output straight width.
+        width: input and output straight width. Defaults to cross_section width.
         width_taper: interface between input straights and mmi region.
         length_taper: into the mmi region.
         length_mmi: in x direction.
         width_mmi: in y direction.
         gap_mmi:  gap between tapered wg.
         taper: taper function.
         straight: straight function.
@@ -39,47 +40,45 @@
     .. code::
 
                length_mmi
                 <------>
                 ________
                |        |
                |         \__
-               |          __  E1
+               |          __  o2
             __/          /_ _ _ _
-         W0 __          | _ _ _ _| gap_mmi
+         o1 __          | _ _ _ _| gap_mmi
               \          \__
-               |          __  E0
+               |          __  o3
                |         /
                |________|
 
              <->
         length_taper
 
     """
     c = Component()
     gap_mmi = gf.snap.snap_to_grid(gap_mmi, nm=2)
     w_mmi = width_mmi
     w_taper = width_taper
     x = gf.get_cross_section(cross_section)
     width = width or x.width
 
-    taper = gf.get_component(
-        taper,
+    _taper = taper(
         length=length_taper,
         width1=width,
         width2=w_taper,
         cross_section=cross_section,
         add_pins=None,
         add_bbox=None,
         decorator=None,
     )
 
     a = gap_mmi / 2 + width_taper / 2
-    mmi = c << gf.get_component(
-        straight,
+    mmi = c << straight(
         length=length_mmi,
         width=w_mmi,
         cross_section=cross_section,
         add_pins=None,
         add_bbox=None,
         decorator=None,
     )
@@ -108,15 +107,15 @@
             width=w_taper,
             layer=x.layer,
             cross_section=x,
         ),
     ]
 
     for port in ports:
-        taper_ref = c << taper
+        taper_ref = c << _taper
         taper_ref.connect(port="o2", destination=port)
         c.add_port(name=port.name, port=taper_ref.ports["o1"])
         c.absorb(taper_ref)
 
     if with_bbox:
         padding = []
         for offset in x.bbox_offsets:
@@ -140,14 +139,14 @@
         c = x.decorator(c)
     return c
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
-    c = gf.components.mmi1x2()
+    c = gf.components.mmi1x2(cross_section="rib_conformal")
 
     # print(c.xmin)
     # c.xmin = 0
     # print(c.xmin)
 
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mmi1x2_with_sbend.py` & `gdsfactory-7.0.0/gdsfactory/components/mmi1x2_with_sbend.py`

 * *Ordering differences only*

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 from gdsfactory.components.bend_s import bend_s
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def mmi1x2_with_sbend(
     with_sbend: bool = True,
     s_bend: ComponentSpec = bend_s,
     cross_section: CrossSectionSpec = "strip",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mmi2x2.py` & `gdsfactory-7.0.0/gdsfactory/components/mmi2x2.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,27 +1,27 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.component import Component
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Optional
+from gdsfactory.typings import ComponentFactory, CrossSectionSpec
 
 
 @gf.cell
 def mmi2x2(
-    width: Optional[float] = None,
+    width: float | None = None,
     width_taper: float = 1.0,
     length_taper: float = 10.0,
     length_mmi: float = 5.5,
     width_mmi: float = 2.5,
     gap_mmi: float = 0.25,
-    taper: ComponentSpec = taper_function,
-    straight: CrossSectionSpec = straight_function,
+    taper: ComponentFactory = taper_function,
+    straight: ComponentFactory = straight_function,
     with_bbox: bool = True,
     cross_section: CrossSectionSpec = "strip",
 ) -> Component:
     r"""Mmi 2x2.
 
     Args:
         width: input and output straight width.
@@ -39,47 +39,45 @@
     .. code::
 
                    length_mmi
                     <------>
                     ________
                    |        |
                 __/          \__
-            W1  __            __  E1
+            o2  __            __  o3
                   \          /_ _ _ _
                   |         | _ _ _ _| gap_mmi
                 __/          \__
-            W0  __            __  E0
+            o1  __            __  o4
                   \          /
                    |________|
 
                  <->
             length_taper
 
     """
     c = gf.Component()
     gap_mmi = gf.snap.snap_to_grid(gap_mmi, nm=2)
     w_mmi = width_mmi
     w_taper = width_taper
     x = gf.get_cross_section(cross_section)
     width = width or x.width
 
-    taper = gf.get_component(
-        taper,
+    _taper = taper(
         length=length_taper,
         width1=width,
         width2=w_taper,
         cross_section=cross_section,
         add_pins=None,
         add_bbox=None,
         decorator=None,
     )
 
     a = gap_mmi / 2 + width_taper / 2
-    mmi = c << gf.get_component(
-        straight,
+    mmi = c << straight(
         length=length_mmi,
         width=w_mmi,
         cross_section=cross_section,
         add_pins=None,
         add_bbox=None,
         decorator=None,
     )
@@ -100,15 +98,15 @@
             center=(length_mmi, -a),
             width=w_taper,
             cross_section=x,
         ),
     ]
 
     for port in ports:
-        taper_ref = c << taper
+        taper_ref = c << _taper
         taper_ref.connect(port="o2", destination=port)
         c.add_port(name=port.name, port=taper_ref.ports["o1"])
         c.absorb(taper_ref)
 
     if with_bbox:
         x = gf.get_cross_section(cross_section)
         padding = []
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mmi2x2_with_sbend.py` & `gdsfactory-7.0.0/gdsfactory/components/mmi2x2_with_sbend.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 import numpy as np
+
 import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 from gdsfactory.components.bend_s import bend_s
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def mmi2x2_with_sbend(
     with_sbend: bool = True,
     s_bend: ComponentSpec = bend_s,
     cross_section: CrossSectionSpec = "strip",
@@ -76,16 +77,16 @@
         c.absorb(topr_sbend)
         c.absorb(topl_sbend)
         c.absorb(botr_sbend)
         c.absorb(botl_sbend)
     else:
         c.add_port("o2", port=topl_taper.ports["o1"])
         c.add_port("o1", port=botl_taper.ports["o1"])
-        c.add_port("o3", port=topr_taper.ports["o2"])
-        c.add_port("o4", port=botr_taper.ports["o2"])
+        c.add_port("o3", port=topr_taper.ports["o1"])
+        c.add_port("o4", port=botr_taper.ports["o1"])
 
     xs = gf.get_cross_section(cross_section)
     if xs.add_pins:
         c = xs.add_pins(c)
 
     c.absorb(ref)
 
@@ -93,13 +94,13 @@
     c.absorb(topl_taper)
     c.absorb(botr_taper)
     c.absorb(botl_taper)
     return c
 
 
 if __name__ == "__main__":
-    c = mmi2x2_with_sbend(
-        with_sbend=True,
-        cross_section=dict(cross_section="strip", settings=dict(layer=(2, 0))),
-    )
-    c = mmi2x2_with_sbend()
-    c.show(show_ports=False)
+    # c = mmi2x2_with_sbend(
+    #     with_sbend=True,
+    #     cross_section=dict(cross_section="strip", settings=dict(layer=(2, 0))),
+    # )
+    c = mmi2x2_with_sbend(with_sbend=False)
+    c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mmi_90degree_hybrid.py` & `gdsfactory-7.0.0/gdsfactory/components/mmi_90degree_hybrid.py`

 * *Files 2% similar despite different names*

```diff
@@ -13,15 +13,15 @@
     width: float = 0.5,
     width_taper: float = 1.7,
     length_taper: float = 40.0,
     length_mmi: float = 175.0,
     width_mmi: float = 10.0,
     gap_mmi: float = 0.8,
     taper: ComponentSpec = taper_function,
-    straight: CrossSectionSpec = straight_function,
+    straight: ComponentSpec = straight_function,
     with_bbox: bool = True,
     cross_section: CrossSectionSpec = "strip",
 ) -> Component:
     r"""90 degree hybrid based on a 4x4 MMI.
 
     Default values from Watanabe et al.,
     "Coherent few mode demultiplexer realized as a
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mode_converter.py` & `gdsfactory-7.0.0/gdsfactory/components/mode_converter.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,25 +1,27 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.component import Component
+from gdsfactory.components.bend_euler import bend_euler_s
 from gdsfactory.components.coupler_straight_asymmetric import (
     coupler_straight_asymmetric as coupler_straight_asymmetric_function,
 )
-from gdsfactory.components.bend_euler import bend_euler_s
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def mode_converter(
     gap: float = 0.3,
     length: float = 10,
     coupler_straight_asymmetric: ComponentSpec = coupler_straight_asymmetric_function,
-    bend: ComponentSpec = gf.partial(bend_euler_s, angle=45),
+    bend: ComponentSpec = partial(bend_euler_s, angle=45),
     taper: ComponentSpec = taper_function,
     mm_width: float = 1.2,
     mc_mm_width: float = 1,
     sm_width: float = 0.5,
     taper_length: float = 25,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzi.py` & `gdsfactory-7.0.0/gdsfactory/components/mzi.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.coupler import coupler
 from gdsfactory.components.mmi1x2 import mmi1x2
@@ -15,31 +14,31 @@
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @cell
 def mzi(
     delta_length: float = 10.0,
     length_y: float = 2.0,
-    length_x: Optional[float] = 0.1,
+    length_x: float | None = 0.1,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
-    straight_y: Optional[ComponentSpec] = None,
-    straight_x_top: Optional[ComponentSpec] = None,
-    straight_x_bot: Optional[ComponentSpec] = None,
+    straight_y: ComponentSpec | None = None,
+    straight_x_top: ComponentSpec | None = None,
+    straight_x_bot: ComponentSpec | None = None,
     splitter: ComponentSpec = "mmi1x2",
-    combiner: Optional[ComponentSpec] = None,
+    combiner: ComponentSpec | None = None,
     with_splitter: bool = True,
     port_e1_splitter: str = "o2",
     port_e0_splitter: str = "o3",
     port_e1_combiner: str = "o2",
     port_e0_combiner: str = "o3",
     nbends: int = 2,
     cross_section: CrossSectionSpec = "strip",
-    cross_section_x_top: Optional[CrossSectionSpec] = None,
-    cross_section_x_bot: Optional[CrossSectionSpec] = None,
+    cross_section_x_top: CrossSectionSpec | None = None,
+    cross_section_x_bot: CrossSectionSpec | None = None,
     mirror_bot: bool = False,
     add_optical_ports_arms: bool = False,
 ) -> Component:
     """Mzi.
 
     Args:
         delta_length: bottom arm vertical extra length.
@@ -230,15 +229,15 @@
     # pdk.activate()
 
     # c = mzi(cross_section="strip")
     # c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
     # c.show(show_ports=True)
 
     # c = gf.components.mzi2x2_2x2(straight_x_top="straight_heater_metal")
-    # c = gf.routing.add_fiber_array(c)
+    c = gf.routing.add_fiber_array(c)
     # gdspath = c.write_gds(flatten_invalid_refs=True)
     # gf.show(gdspath)
     c.show()
 
     # c1.write_gds("a.gds")
 
     # c2 = gf.read.import_gds("a.gds")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzi_arm.py` & `gdsfactory-7.0.0/gdsfactory/components/mzi_arm.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.typings import ComponentSpec
 
@@ -13,16 +11,16 @@
 @cell
 def mzi_arm(
     length_y_left: float = 0.8,
     length_y_right: float = 0.8,
     length_x: float = 0.1,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
-    straight_x: Optional[ComponentSpec] = None,
-    straight_y: Optional[ComponentSpec] = None,
+    straight_x: ComponentSpec | None = None,
+    straight_y: ComponentSpec | None = None,
     **kwargs,
 ) -> Component:
     """Mzi.
 
     Args:
         length_y_left: vertical length.
         length_y_right: vertical length.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzi_arms.py` & `gdsfactory-7.0.0/gdsfactory/components/mzi_arms.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.mmi1x2 import mmi1x2
 from gdsfactory.components.mzi_arm import mzi_arm
 from gdsfactory.components.straight import straight as straight_function
@@ -14,19 +14,19 @@
 @cell
 def mzi_arms(
     delta_length: float = 10.0,
     length_y: float = 0.8,
     length_x: float = 0.1,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
-    straight_y: Optional[ComponentSpec] = None,
-    straight_x_top: Optional[ComponentSpec] = None,
-    straight_x_bot: Optional[ComponentSpec] = None,
+    straight_y: ComponentSpec | None = None,
+    straight_x_top: ComponentSpec | None = None,
+    straight_x_bot: ComponentSpec | None = None,
     splitter: ComponentSpec = mmi1x2,
-    combiner: Optional[ComponentSpec] = None,
+    combiner: ComponentSpec | None = None,
     with_splitter: bool = True,
     delta_yright: float = 0,
     **kwargs,
 ) -> Component:
     """Mzi made with arms.
 
     This MZI code is slightly deprecated.
@@ -156,15 +156,15 @@
 if __name__ == "__main__":
     import gdsfactory as gf
 
     # delta_length = 116.8 / 2
     # print(delta_length)
     # c = mzi_arms(delta_length=delta_length, with_splitter=False)
     # c.pprint_netlist()
-    mmi2x2 = gf.partial(gf.components.mmi2x2, width_mmi=5, gap_mmi=2)
+    mmi2x2 = partial(gf.components.mmi2x2, width_mmi=5, gap_mmi=2)
     c = mzi_arms(delta_length=10, combiner=mmi2x2)
     c.show(show_ports=True)
 
     def bend_s(length: float = 10, **kwargs):
         return gf.components.bend_s(size=(length, 10), **kwargs)
 
     # c = mzi_arms(
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzi_lattice.py` & `gdsfactory-7.0.0/gdsfactory/components/mzi_lattice.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,26 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.coupler import coupler as coupler_function
 from gdsfactory.components.mmi2x2 import mmi2x2 as mmi_splitter_function
 from gdsfactory.components.mzi import mzi2x2_2x2 as mmi_coupler_function
 from gdsfactory.components.mzi import mzi_coupler
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.typings import ComponentSpec
 
 
 @cell
 def mzi_lattice(
-    coupler_lengths: Tuple[float, ...] = (10.0, 20.0),
-    coupler_gaps: Tuple[float, ...] = (0.2, 0.3),
-    delta_lengths: Tuple[float, ...] = (10.0,),
+    coupler_lengths: tuple[float, ...] = (10.0, 20.0),
+    coupler_gaps: tuple[float, ...] = (0.2, 0.3),
+    delta_lengths: tuple[float, ...] = (10.0,),
     mzi: ComponentSpec = mzi_coupler,
     splitter: ComponentSpec = coupler_function,
     **kwargs,
 ) -> Component:
     r"""Mzi lattice filter.
 
     Args:
@@ -123,41 +121,41 @@
     c.auto_rename_ports()
     return c
 
 
 @cell
 def mzi_lattice_mmi(
     coupler_widths=(None, None),
-    coupler_widths_tapers: Tuple[float, ...] = (
+    coupler_widths_tapers: tuple[float, ...] = (
         1.0,
         1.0,
     ),
-    coupler_lengths_tapers: Tuple[float, ...] = (
+    coupler_lengths_tapers: tuple[float, ...] = (
         10.0,
         10.0,
     ),
-    coupler_lengths_mmis: Tuple[float, ...] = (
+    coupler_lengths_mmis: tuple[float, ...] = (
         5.5,
         5.5,
     ),
-    coupler_widths_mmis: Tuple[float, ...] = (
+    coupler_widths_mmis: tuple[float, ...] = (
         2.5,
         2.5,
     ),
-    coupler_gaps_mmis: Tuple[float, ...] = (
+    coupler_gaps_mmis: tuple[float, ...] = (
         0.25,
         0.25,
     ),
     taper_functions_mmis=(
         taper_function,
         taper_function,
     ),
     straight_functions_mmis=(straight_function, straight_function),
     cross_sections_mmis=("strip", "strip"),
-    delta_lengths: Tuple[float, ...] = (10.0,),
+    delta_lengths: tuple[float, ...] = (10.0,),
     mzi=mmi_coupler_function,
     splitter=mmi_splitter_function,
     **kwargs,
 ) -> Component:
     r"""Mzi lattice filter, with MMI couplers.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzi_pads_center.py` & `gdsfactory-7.0.0/gdsfactory/components/mzi_pads_center.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,37 +1,37 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.components.mzi import mzi as mzi_function
 from gdsfactory.components.pad import pad_small
 from gdsfactory.components.straight_heater_metal import straight_heater_metal
 from gdsfactory.routing.get_route import get_route
-from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Union
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def mzi_pads_center(
     ps_top: ComponentSpec = straight_heater_metal,
     ps_bot: ComponentSpec = straight_heater_metal,
     mzi: ComponentSpec = mzi_function,
     pad: ComponentSpec = pad_small,
     length_x: float = 500,
     length_y: float = 40,
-    mzi_sig_top: str = "top_e2",
-    mzi_gnd_top: str = "top_e1",
-    mzi_sig_bot: str = "bot_e1",
-    mzi_gnd_bot: str = "bot_e2",
+    mzi_sig_top: str = "top_r_e2",
+    mzi_gnd_top: str = "top_l_e2",
+    mzi_sig_bot: str = "bot_l_e2",
+    mzi_gnd_bot: str = "bot_r_e2",
     pad_sig_bot: str = "e1_1_1",
     pad_sig_top: str = "e3_1_3",
     pad_gnd_bot: str = "e4_1_2",
     pad_gnd_top: str = "e2_1_2",
     delta_length: float = 40.0,
     cross_section: CrossSectionSpec = "strip",
     cross_section_metal: CrossSectionSpec = "metal_routing",
-    pad_spacing: Union[float, str] = "pad_spacing",
+    pad_spacing: float | str = "pad_spacing",
     **kwargs,
 ) -> gf.Component:
     """Return Mzi phase shifter with pads in the middle.
 
     GND is the middle pad
     and is shared between top and bottom phase shifters.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzit.py` & `gdsfactory-7.0.0/gdsfactory/components/mzit.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.coupler import coupler as coupler_function
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.typings import ComponentSpec
@@ -23,15 +21,15 @@
     coupler_length2: float = 10.0,
     coupler_gap1: float = 0.2,
     coupler_gap2: float = 0.3,
     taper: ComponentSpec = taper_function,
     taper_length: float = 5.0,
     bend90: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
-    coupler1: Optional[ComponentSpec] = coupler_function,
+    coupler1: ComponentSpec | None = coupler_function,
     coupler2: ComponentSpec = coupler_function,
     **kwargs,
 ) -> Component:
     r"""Mzi tolerant to fabrication variations.
 
     based on Yufei Xing thesis
     http://photonics.intec.ugent.be/publications/PhD.asp?ID=250
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzit_lattice.py` & `gdsfactory-7.0.0/gdsfactory/components/mzit_lattice.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.mzit import mzit
 from gdsfactory.typings import ComponentSpec
 
 
 @gf.cell
 def mzit_lattice(
-    coupler_lengths: Tuple[float, ...] = (10.0, 20.0),
-    coupler_gaps: Tuple[float, ...] = (0.2, 0.3),
-    delta_lengths: Tuple[float, ...] = (10.0,),
+    coupler_lengths: tuple[float, ...] = (10.0, 20.0),
+    coupler_gaps: tuple[float, ...] = (0.2, 0.3),
+    delta_lengths: tuple[float, ...] = (10.0,),
     mzi: ComponentSpec = mzit,
 ) -> Component:
     r"""Mzi fab tolerant lattice filter.
 
     .. code::
 
                            cp1
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/mzm.py` & `gdsfactory-7.0.0/gdsfactory/components/mzm.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.coupler import coupler
 from gdsfactory.components.mmi1x2 import mmi1x2
@@ -21,15 +20,15 @@
     phase_shifter: ComponentSpec = straight_pin,
     length_x: float = 500,
     length_y: float = 2.0,
     delta_length: float = 0.0,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
     splitter: ComponentSpec = "mmi1x2",
-    combiner: Optional[ComponentSpec] = "mmi1x2",
+    combiner: ComponentSpec | None = "mmi1x2",
     with_splitter: bool = True,
     port_e1_splitter: str = "o2",
     port_e0_splitter: str = "o3",
     port_e1_combiner: str = "o2",
     port_e0_combiner: str = "o3",
     nbends: int = 2,
     cross_section: CrossSectionSpec = "strip",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/nxn.py` & `gdsfactory-7.0.0/gdsfactory/components/nxn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/optimal_90deg.py` & `gdsfactory-7.0.0/gdsfactory/components/optimal_90deg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/optimal_hairpin.py` & `gdsfactory-7.0.0/gdsfactory/components/optimal_hairpin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/optimal_step.py` & `gdsfactory-7.0.0/gdsfactory/components/optimal_step.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/pack_doe.py` & `gdsfactory-7.0.0/gdsfactory/components/pack_doe.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,29 +1,29 @@
 from __future__ import annotations
 
 import itertools as it
-from typing import Any, Dict, List, Tuple
+from typing import Any
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.grid import grid, grid_with_text
 from gdsfactory.pack import pack
-from gdsfactory.typings import CellSpec, ComponentSpec, Optional
+from gdsfactory.typings import CellSpec, ComponentSpec
 
 _doe = "mmi1x2"
 _settings = dict(length_mmi=[2.5, 100], width_mmi=[4, 10])
 
 
 def generate_doe(
     doe: ComponentSpec,
-    settings: Dict[str, List[Any]],
+    settings: dict[str, list[Any]],
     do_permutations: bool = False,
-    function: Optional[CellSpec] = None,
-) -> Tuple[List[Component], List[Dict]]:
+    function: CellSpec | None = None,
+) -> tuple[list[Component], list[dict]]:
     """Generates a component DOE (Design of Experiment).
 
     which can then be packed, or used elsewhere.
 
     Args:
         doe: function to return Components.
         settings: component settings.
@@ -48,17 +48,17 @@
         ]
     return component_list, settings_list
 
 
 @cell
 def pack_doe(
     doe: ComponentSpec = _doe,
-    settings: Dict[str, List[Any]] = _settings,
+    settings: dict[str, list[Any]] = _settings,
     do_permutations: bool = False,
-    function: Optional[CellSpec] = None,
+    function: CellSpec | None = None,
     **kwargs,
 ) -> Component:
     """Packs a component DOE (Design of Experiment) using pack.
 
     Args:
         doe: function to return Components.
         settings: component settings.
@@ -97,17 +97,17 @@
     c.doe_settings = settings_list
     return c
 
 
 @cell
 def pack_doe_grid(
     doe: ComponentSpec = _doe,
-    settings: Dict[str, List[Any]] = _settings,
+    settings: dict[str, list[Any]] = _settings,
     do_permutations: bool = False,
-    function: Optional[CellSpec] = None,
+    function: CellSpec | None = None,
     with_text: bool = False,
     **kwargs,
 ) -> Component:
     """Packs a component DOE (Design of Experiment) using grid.
 
     Args:
         component: function to return Components.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/pad.py` & `gdsfactory-7.0.0/gdsfactory/components/pad.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,27 +1,26 @@
 from __future__ import annotations
 
 from functools import partial
-from typing import Optional, Tuple
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.compass import compass
-from gdsfactory.typings import ComponentSpec, LayerSpec, Union, Float2
+from gdsfactory.typings import ComponentSpec, Float2, LayerSpec
 
 
 @cell
 def pad(
-    size: Union[str, Float2] = (100.0, 100.0),
+    size: str | Float2 = (100.0, 100.0),
     layer: LayerSpec = "MTOP",
-    bbox_layers: Optional[Tuple[LayerSpec, ...]] = None,
-    bbox_offsets: Optional[Tuple[float, ...]] = None,
+    bbox_layers: tuple[LayerSpec, ...] | None = None,
+    bbox_offsets: tuple[float, ...] | None = None,
     port_inclusion: float = 0,
-    port_orientation: Optional[float] = None,
+    port_orientation: float | None = None,
 ) -> Component:
     """Returns rectangular pad with ports.
 
     Args:
         size: x, y size.
         layer: pad layer.
         bbox_layers: list of layers.
@@ -30,36 +29,36 @@
         port_inclusion: from edge.
         port_orientation: in degrees.
     """
     c = Component()
     layer = gf.get_layer(layer)
     size = gf.get_constant(size)
     rect = compass(
-        size=size,
-        layer=layer,
-        port_inclusion=port_inclusion,  # port_type="electrical"
+        size=size, layer=layer, port_inclusion=port_inclusion, port_type="electrical"
     )
     c_ref = c.add_ref(rect)
     c.add_ports(c_ref.ports)
     c.info["size"] = (float(size[0]), float(size[1]))
     c.info["layer"] = layer
+    c.absorb(c_ref)
 
     if bbox_layers and bbox_offsets:
         sizes = []
         for cladding_offset in bbox_offsets:
             size = (size[0] + 2 * cladding_offset, size[1] + 2 * cladding_offset)
             sizes.append(size)
 
         for layer, size in zip(bbox_layers, sizes):
-            c.add_ref(
+            ref = c.add_ref(
                 compass(
                     size=size,
                     layer=layer,
                 )
             )
+            c.absorb(ref)
 
     width = size[1] if port_orientation in [0, 180] else size[0]
 
     c.add_port(
         name="pad",
         port_type="vertical_dc",
         layer=layer,
@@ -73,18 +72,18 @@
 pad_rectangular = partial(pad, size="pad_size")
 pad_small = partial(pad, size=(80, 80))
 
 
 @cell
 def pad_array(
     pad: ComponentSpec = "pad",
-    spacing: Tuple[float, float] = (150.0, 150.0),
+    spacing: tuple[float, float] = (150.0, 150.0),
     columns: int = 6,
     rows: int = 1,
-    orientation: Optional[float] = 270,
+    orientation: float | None = 270,
 ) -> Component:
     """Returns 2D array of pads.
 
     Args:
         pad: pad element.
         spacing: x, y pitch.
         columns: number of columns.
@@ -116,21 +115,21 @@
 pad_array270 = partial(pad_array, orientation=270)
 
 pad_array0 = partial(pad_array, orientation=0, columns=1, rows=3)
 pad_array180 = partial(pad_array, orientation=180, columns=1, rows=3)
 
 
 if __name__ == "__main__":
-    c = pad_rectangular()
+    # c = pad_rectangular()
     # c = pad()
     # c = pad(layer_to_inclusion={(3, 0): 10})
     # print(c.ports)
     # c = pad(width=10, height=10)
     # print(c.ports.keys())
     # c = pad_array90()
-    # c = pad_array0()
+    c = pad_array0()
     # c = pad_array270()
     # c.pprint_ports()
     # c = pad_array_2d(cols=2, rows=3, port_names=("e2",))
     # c = pad_array(columns=2, rows=2, orientation=270)
     # c.auto_rename_ports()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/pad_gsg.py` & `gdsfactory-7.0.0/gdsfactory/components/pad_gsg.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,17 +1,19 @@
 """High speed GSG pads."""
 
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.components.pad import pad as pad_function
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.typings import ComponentSpec, Float2, LayerSpec
 
-rectangle_m3 = gf.partial(rectangle, layer="M3")
+rectangle_m3 = partial(rectangle, layer="M3")
 
 
 @gf.cell
 def pad_gsg_short(
     via_stack: ComponentSpec = rectangle_m3,
     size: Float2 = (22, 7),
     layer_metal: LayerSpec = "M3",
@@ -56,15 +58,15 @@
     c << gf.routing.route_quad(
         gnd_top.ports["e2"], pads.ports["e1_3_1"], layer=layer_metal
     )
     c << gf.routing.route_quad(via.ports["e3"], pads.ports["e1_2_1"], layer=layer_metal)
     return c
 
 
-pad_gsg_open = gf.partial(pad_gsg_short, short=False)
+pad_gsg_open = partial(pad_gsg_short, short=False)
 
 
 if __name__ == "__main__":
     # c = pad_array_double()
     c = pad_gsg_short()
     # c = pad_gsg_open()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/pads_shorted.py` & `gdsfactory-7.0.0/gdsfactory/components/pads_shorted.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/polarization_splitter_rotator.py` & `gdsfactory-7.0.0/gdsfactory/components/polarization_splitter_rotator.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,29 +1,25 @@
 from __future__ import annotations
 
-from typing import Union
-
 from numpy import ndarray
 
 import gdsfactory as gf
 from gdsfactory.component import Component
-
-from gdsfactory.components.taper import taper
 from gdsfactory.components.bezier import bezier
 from gdsfactory.components.coupler_straight_asymmetric import (
     coupler_straight_asymmetric,
 )
-
+from gdsfactory.components.taper import taper
 from gdsfactory.typings import CrossSectionSpec, Float2, Float3
 
 
 @gf.cell
 def polarization_splitter_rotator(
     width_taper_in: Float3 = (0.54, 0.69, 0.83),
-    length_taper_in: Union[Float2, Float3] = (4.0, 44.0),
+    length_taper_in: Float2 | Float3 = (4.0, 44.0),
     width_coupler: Float2 = (0.9, 0.405),
     length_coupler: float = 7.0,
     gap: float = 0.15,
     width_out: float = 0.54,
     length_out: float = 14.33,
     dy: float = 5.0,
     cross_section: CrossSectionSpec = "strip",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ramp.py` & `gdsfactory-7.0.0/gdsfactory/components/ramp.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,21 +1,19 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def ramp(
     length: float = 10.0,
     width1: float = 5.0,
-    width2: Optional[float] = 8.0,
+    width2: float | None = 8.0,
     layer: LayerSpec = "WG",
 ) -> Component:
     """Return a ramp component.
 
     Based on phidl.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/rectangle.py` & `gdsfactory-7.0.0/gdsfactory/components/version_stamp.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,50 +1,100 @@
 from __future__ import annotations
 
-from typing import Optional
-from functools import partial
+import datetime
+import platform
 
-from gdsfactory.cell import cell
+import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.components.compass import compass
-from gdsfactory.typings import Ints, LayerSpec
+from gdsfactory.components.text import text
+from gdsfactory.typings import LayerSpec
 
 
-@cell
-def rectangle(
-    size=(4.0, 2.0),
+@gf.cell
+def pixel(size: int = 1.0, layer: LayerSpec = "WG") -> Component:
+    c = gf.Component()
+    a = size / 2
+    c.add_polygon([(a, a), (a, -a), (-a, -a), (-a, a)], layer)
+    return c
+
+
+@gf.cell
+def qrcode(data: str = "mask01", psize: int = 1, layer: LayerSpec = "WG") -> Component:
+    """Returns QRCode."""
+    import qrcode
+
+    pix = pixel(size=psize, layer=layer)
+    q = qrcode.QRCode()
+    q.add_data(data)
+    matrix = q.get_matrix()
+    c = gf.Component()
+    for i, row in enumerate(matrix):
+        for j, value in enumerate(row):
+            if value:
+                pix_ref = pix.ref((i * psize, j * psize))
+                c.add(pix_ref)
+                c.absorb(pix_ref)
+    return c
+
+
+@gf.cell
+def version_stamp(
+    labels: tuple[str, ...] = ("demo_label",),
+    with_qr_code: bool = False,
     layer: LayerSpec = "WG",
-    centered: bool = False,
-    port_type: Optional[str] = "placement",
-    port_orientations: Optional[Ints] = (180, 90, 0, -90),
+    pixel_size: int = 1,
+    version: str | None = None,
+    text_size: int = 10,
 ) -> Component:
-    """Returns a rectangle.
+    """Component with module version and date.
 
     Args:
-        size: (tuple) Width and height of rectangle.
-        layer: Specific layer to put polygon geometry on.
-        centered: True sets center to (0, 0), False sets south-west to (0, 0).
-        port_type: optical, electrical.
-        port_orientations: list of port_orientations to add.
+        labels: Iterable of labels
     """
-    c = Component()
-    ref = c << compass(
-        size=size, layer=layer, port_type=port_type, port_orientations=port_orientations
-    )
-    if not centered:
-        ref.move((size[0] / 2, size[1] / 2))
-    if port_type:
-        c.add_ports(ref.ports)
-    return c
-
+    now = datetime.datetime.now()
+    timestamp = f"{now:%Y-%m-%d %H:%M:%S}"
+    short_stamp = f"{now:%y.%m.%d.%H.%M.%S}"
+
+    c = gf.Component()
+    if with_qr_code:
+        data = f"{timestamp}/{platform.node()}"
+        q = qrcode(layer=layer, data=data, psize=pixel_size).ref_center()
+        c.add(q)
+        c.absorb(q)
+
+        x = q.size_info.width * 0.5 + 10
+
+    else:
+        x = 0
+
+    txt_params = {"layer": layer, "justify": "left", "size": text_size}
+    date = text(
+        position=(x, text_size + 2 * pixel_size), text=short_stamp, **txt_params
+    ).ref()
+    c.add(date)
+    c.absorb(date)
+
+    if version:
+        t = text(position=(x, 0), text=version, **txt_params).ref()
+        c.add(t)
+        c.absorb(t)
+
+    for i, line in enumerate(labels):
+        t = c << text(
+            position=(x, -(i + 1) * (text_size + 2 * pixel_size)),
+            text=line,
+            **txt_params,
+        )
+        c.absorb(t)
 
-fiber_size = 10.4
-marker_te = partial(rectangle, size=[fiber_size, fiber_size], layer="TE", centered=True)
-marker_tm = partial(rectangle, size=[fiber_size, fiber_size], layer="TM", centered=True)
+    return c
 
 
 if __name__ == "__main__":
-    c = rectangle(size=(3, 2), centered=False, layer=(2, 3))
-    # c = rectangle(size=(3, 2), centered=True, layer=(2, 3))
-    print(c.ports)
-    print(c.name)
+    c = version_stamp(
+        pixel_size=4,
+        layer="M1",
+        with_qr_code=True,
+        # text=["b1", "demo"],
+        text_size=20,
+    )
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/rectangle_with_slits.py` & `gdsfactory-7.0.0/gdsfactory/components/rectangle_with_slits.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,29 +1,27 @@
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.array_component import array
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.typings import Float2, LayerSpec
 
 
 @cell
 def rectangle_with_slits(
-    size: Tuple[float, float] = (100.0, 200.0),
+    size: tuple[float, float] = (100.0, 200.0),
     layer: LayerSpec = "WG",
     layer_slit: LayerSpec = "SLAB150",
     centered: bool = False,
-    port_type: Optional[str] = None,
-    slit_size: Tuple[float, float] = (1.0, 1.0),
+    port_type: str | None = None,
+    slit_size: tuple[float, float] = (1.0, 1.0),
     slit_spacing: Float2 = (20, 20),
     slit_enclosure: float = 10,
 ) -> Component:
     """Returns a rectangle with slits.
 
     Metal slits reduce stress.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/regular_polygon.py` & `gdsfactory-7.0.0/gdsfactory/components/regular_polygon.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import gdstk
 import numpy as np
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @cell
 def regular_polygon(
     sides: int = 6,
     side_length: float = 10,
     layer: LayerSpec = "WG",
-    port_type: Optional[str] = "placement",
+    port_type: str | None = "placement",
 ) -> Component:
     """Returns a regular N-sided polygon, with ports on each edge.
 
     Args:
         sides: number of sides for the polygon.
         side_length: of the edges.
         layer: Specific layer to put polygon geometry on.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/resistance_meander.py` & `gdsfactory-7.0.0/gdsfactory/components/resistance_meander.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import numpy as np
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.geometry.offset import offset
 from gdsfactory.typings import LayerSpec
 
 
 @cell
 def resistance_meander(
-    pad_size: Tuple[float, float] = (50.0, 50.0),
+    pad_size: tuple[float, float] = (50.0, 50.0),
     num_squares: int = 1000,
     width: float = 1.0,
     res_layer: LayerSpec = "MTOP",
     pad_layer: LayerSpec = "MTOP",
     gnd_layer: LayerSpec = "MTOP",
 ) -> Component:
     """Return meander to test resistance.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/resistance_sheet.py` & `gdsfactory-7.0.0/gdsfactory/components/resistance_sheet.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,27 +2,27 @@
 
 from functools import partial
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.compass import compass
 from gdsfactory.components.via_stack import via_stack_slab_npp_m3
-from gdsfactory.typings import ComponentSpec, Floats, LayerSpecs, Optional
+from gdsfactory.typings import ComponentSpec, Floats, LayerSpecs
 
 pad_via_stack_slab_npp = partial(via_stack_slab_npp_m3, size=(80, 80))
 
 
 @cell
 def resistance_sheet(
     width: float = 10,
     layers: LayerSpecs = ("SLAB90", "NPP"),
     layer_offsets: Floats = (0, 0.2),
     pad: ComponentSpec = pad_via_stack_slab_npp,
     pad_pitch: float = 100.0,
-    ohms_per_square: Optional[float] = None,
+    ohms_per_square: float | None = None,
     port_orientation1: int = 180,
     port_orientation2: int = 0,
 ) -> Component:
     """Returns Sheet resistance.
 
     keeps connectivity for pads and first layer in layers
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring.py` & `gdsfactory-7.0.0/gdsfactory/components/ring.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 from __future__ import annotations
 
 import numpy as np
 from numpy import cos, pi, sin
 
 import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.typings import LayerSpec, Optional
+from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def ring(
     radius: float = 10.0,
     width: float = 0.5,
     angle_resolution: float = 2.5,
     layer: LayerSpec = "WG",
-    angle: Optional[float] = 360,
+    angle: float | None = 360,
 ) -> Component:
     """Returns a ring.
 
     Args:
         radius: ring radius.
         width: of the ring.
         angle_resolution: number of points per degree.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_crow.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_crow.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,27 +1,25 @@
 from __future__ import annotations
 
-from typing import List
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_circular import bend_circular
 from gdsfactory.components.straight import straight
 from gdsfactory.cross_section import strip
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def ring_crow(
-    gaps: List[float] = [0.2] * 4,
-    radius: List[float] = [10.0] * 3,
+    gaps: list[float] = [0.2] * 4,
+    radius: list[float] = [10.0] * 3,
     input_straight_cross_section: CrossSectionSpec = strip,
     output_straight_cross_section: CrossSectionSpec = strip,
-    bends: List[ComponentSpec] = [bend_circular] * 3,
-    ring_cross_sections: List[CrossSectionSpec] = [strip] * 3,
+    bends: list[ComponentSpec] = [bend_circular] * 3,
+    ring_cross_sections: list[CrossSectionSpec] = [strip] * 3,
 ) -> Component:
     """Coupled ring resonators.
 
     Args:
         gap: gap between for coupler.
         radius: for the bend and coupler.
         length_x: ring coupler length.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_crow_couplers.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_crow_couplers.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 from __future__ import annotations
 
-from typing import List
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_circular import bend_circular
 from gdsfactory.components.coupler_full import coupler_full
 from gdsfactory.cross_section import strip
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def ring_crow_couplers(
-    radius: List[float] = [10.0] * 3,
-    bends: List[ComponentSpec] = [bend_circular] * 3,
-    ring_cross_sections: List[CrossSectionSpec] = [strip] * 3,
-    couplers: List[ComponentSpec] = [coupler_full] * 4,
+    radius: list[float] = [10.0] * 3,
+    bends: list[ComponentSpec] = [bend_circular] * 3,
+    ring_cross_sections: list[CrossSectionSpec] = [strip] * 3,
+    couplers: list[ComponentSpec] = [coupler_full] * 4,
 ) -> Component:
     """Coupled ring resonators with coupler components between gaps.
 
     Args:
         gap: gap between for coupler.
         radius: for the bend and coupler.
         length_x: ring coupler length.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_double.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_double.py`

 * *Files 2% similar despite different names*

```diff
@@ -58,23 +58,29 @@
     straight_component = straight(
         length=length_y, cross_section=cross_section, **kwargs
     )
 
     c = Component()
     cb = c.add_ref(coupler_component)
     ct = c.add_ref(coupler_component)
-    sl = c.add_ref(straight_component)
-    sr = c.add_ref(straight_component)
+
+    sl = straight_component.ref()
+    sr = straight_component.ref()
+
+    if length_y > 0:
+        c.add(sl)
+        c.add(sr)
 
     sl.connect(port="o1", destination=cb.ports["o2"])
     ct.connect(port="o3", destination=sl.ports["o2"])
     sr.connect(port="o2", destination=ct.ports["o2"])
     c.add_port("o1", port=cb.ports["o1"])
     c.add_port("o2", port=cb.ports["o4"])
     c.add_port("o3", port=ct.ports["o4"])
     c.add_port("o4", port=ct.ports["o1"])
     return c
 
 
 if __name__ == "__main__":
-    c = ring_double(width=1, layer=(2, 0), length_y=3)
+    c = ring_double(width=1, layer=(2, 0), length_y=0, length_x=0)
+    c.get_netlist()
     c.show(show_subports=False)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_double_bend_coupler.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_double_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_double_heater.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_single_heater.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,120 +1,139 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
-from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
-from gdsfactory.components.coupler_ring import coupler_ring
+from gdsfactory.components.coupler_ring import coupler_ring as _coupler_ring
 from gdsfactory.components.straight import straight
-from gdsfactory.components.via_stack import via_stack_heater_m3
+from gdsfactory.components.via_stack import via_stack_heater_mtop
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Float2
 
-via_stack_heater_m3_mini = gf.partial(via_stack_heater_m3, size=(4, 4))
+via_stack_heater_mtop_mini = partial(via_stack_heater_mtop, size=(4, 4))
 
 
 @gf.cell
-def ring_double_heater(
+def ring_single_heater(
     gap: float = 0.2,
     radius: float = 10.0,
-    length_x: float = 0.01,
-    length_y: float = 0.01,
-    coupler_ring: ComponentSpec = coupler_ring,
-    straight: ComponentSpec = straight,
+    length_x: float = 4.0,
+    length_y: float = 0.6,
+    coupler_ring: ComponentSpec = _coupler_ring,
     bend: ComponentSpec = bend_euler,
-    cross_section_heater: CrossSectionSpec = "heater_metal",
     cross_section_waveguide_heater: CrossSectionSpec = "strip_heater_metal",
     cross_section: CrossSectionSpec = "strip",
-    via_stack: gf.typings.ComponentSpec = via_stack_heater_m3_mini,
-    port_orientation: float = 90,
+    via_stack: ComponentSpec = via_stack_heater_mtop_mini,
+    port_orientation: float | None = None,
     via_stack_offset: Float2 = (0, 0),
     **kwargs,
-) -> Component:
-    """Returns a double bus ring with heater on top.
+) -> gf.Component:
+    """Returns a single ring with heater on top.
 
-    two couplers (ct: top, cb: bottom)
-    connected with two vertical straights (sl: left, sr: right)
+    ring coupler (cb: bottom) connects to two vertical straights (sl: left, sr: right),
+    two bends (bl, br) and horizontal straight (wg: top)
 
     Args:
         gap: gap between for coupler.
         radius: for the bend and coupler.
         length_x: ring coupler length.
         length_y: vertical straight length.
-        coupler_ring: ring coupler spec.
-        straight: straight spec.
-        bend: bend spec.
-        cross_section_heater: for heater.
-        cross_section_waveguide_heater: for waveguide with heater.
+        coupler_ring: ring coupler function.
+        bend: 90 degrees bend function.
+        cross_section_waveguide_heater: for heater.
         cross_section: for regular waveguide.
         via_stack: for heater to routing metal.
         port_orientation: for electrical ports to promote from via_stack.
         via_stack_offset: x,y offset for via_stack.
         kwargs: cross_section settings.
 
     .. code::
 
-         --==ct==--
+          bl-st-br
           |      |
           sl     sr length_y
           |      |
          --==cb==-- gap
 
           length_x
     """
     gap = gf.snap.snap_to_grid(gap, nm=2)
 
-    coupler_component = gf.get_component(
+    coupler_ring = gf.get_component(
         coupler_ring,
+        bend=bend,
         gap=gap,
         radius=radius,
         length_x=length_x,
-        bend=bend,
         cross_section=cross_section,
         bend_cross_section=cross_section_waveguide_heater,
         **kwargs,
     )
-    straight_component = gf.get_component(
-        straight,
+
+    straight_side = straight(
         length=length_y,
         cross_section=cross_section_waveguide_heater,
         **kwargs,
     )
+    straight_top = straight(
+        length=length_x,
+        cross_section=cross_section_waveguide_heater,
+        **kwargs,
+    )
 
-    c = Component()
-    cb = c.add_ref(coupler_component)
-    ct = c.add_ref(coupler_component)
-    sl = c.add_ref(straight_component)
-    sr = c.add_ref(straight_component)
+    bend = gf.get_component(
+        bend, radius=radius, cross_section=cross_section_waveguide_heater, **kwargs
+    )
+
+    c = gf.Component()
+    cb = c << coupler_ring
+    sl = c << straight_side
+    sr = c << straight_side
+    bl = c << bend
+    br = c << bend
+    st = c << straight_top
+    # st.mirror(p1=(0, 0), p2=(1, 0))
 
     sl.connect(port="o1", destination=cb.ports["o2"])
-    ct.connect(port="o3", destination=sl.ports["o2"])
-    sr.connect(port="o2", destination=ct.ports["o2"])
-    c.add_port("o1", port=cb.ports["o1"])
+    bl.connect(port="o2", destination=sl.ports["o2"])
+
+    st.connect(port="o2", destination=bl.ports["o1"])
+    br.connect(port="o2", destination=st.ports["o1"])
+    sr.connect(port="o1", destination=br.ports["o1"])
+    sr.connect(port="o2", destination=cb.ports["o3"])
+
     c.add_port("o2", port=cb.ports["o4"])
-    c.add_port("o3", port=ct.ports["o4"])
-    c.add_port("o4", port=ct.ports["o1"])
+    c.add_port("o1", port=cb.ports["o1"])
 
     via = gf.get_component(via_stack)
     c1 = c << via
     c2 = c << via
     c1.xmax = -length_x / 2 + cb.x - via_stack_offset[0]
     c2.xmin = +length_x / 2 + cb.x + via_stack_offset[0]
     c1.movey(via_stack_offset[1])
     c2.movey(via_stack_offset[1])
-    c.add_ports(c1.get_ports_list(orientation=port_orientation), prefix="e1")
-    c.add_ports(c2.get_ports_list(orientation=port_orientation), prefix="e2")
 
-    heater_top = c << gf.get_component(
-        straight,
-        length=length_x,
-        cross_section=cross_section_heater,
-    )
-    heater_top.connect("e1", ct.ports["e1"])
+    p1 = c1.get_ports_list(orientation=port_orientation)
+    p2 = c2.get_ports_list(orientation=port_orientation)
+    valid_orientations = {p.orientation for p in via.ports.values()}
+
+    if not p1:
+        raise ValueError(
+            f"No ports found for port_orientation {port_orientation} in {valid_orientations}"
+        )
 
-    c.auto_rename_ports()
+    c.add_ports(p1, prefix="l_")
+    c.add_ports(p2, prefix="r_")
     return c
 
 
 if __name__ == "__main__":
-    # c = ring_double_heater(width=1, layer=(2, 0), length_y=3)
-    c = ring_double_heater(length_x=5)
-    c.show(show_ports=True)
-    # c.pprint()
+    c = ring_single_heater(width=0.5, gap=1, layer=(2, 0), radius=10, length_y=1)
+    print(c.to_yaml())
+    # print(c.to_dict())
+    c.show(show_subports=False)
+    # c.pprint_ports()
+
+    # cc = gf.add_pins(c)
+    # print(c.settings)
+    # print(c.settings)
+    # cc.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_double_pn.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_double_pn.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,55 +1,57 @@
 from __future__ import annotations
 
 from functools import partial
+
 import numpy as np
+
 import gdsfactory as gf
+from gdsfactory.components.via import via
+from gdsfactory.components.via_stack import via_stack
 from gdsfactory.cross_section import Section
 from gdsfactory.typings import ComponentSpec, CrossSection, LayerSpec
-from gdsfactory.components.via_stack import via_stack
-from gdsfactory.components.via import via
 
 
 @gf.cell
 def ring_double_pn(
     add_gap: float = 0.3,
     drop_gap: float = 0.3,
     radius: float = 5.0,
     doping_angle: float = 85,
     cross_section: CrossSection = partial(
         gf.cross_section.strip,
         sections=(Section(width=2 * 2.425, layer="SLAB90", name="slab"),),
     ),
-    pn_cross_section: CrossSection = gf.partial(
+    pn_cross_section: CrossSection = partial(
         gf.cross_section.pn,
         width_doping=2.425,
         width_slab=2 * 2.425,
         layer_via="VIAC",
         width_via=0.5,
         layer_metal="M1",
         width_metal=0.5,
     ),
     doped_heater: bool = True,
     doped_heater_angle_buffer: float = 10,
     doped_heater_layer: LayerSpec = "NPP",
     doped_heater_width: float = 0.5,
     doped_heater_waveguide_offset: float = 2.175,
-    heater_vias: ComponentSpec = gf.partial(
+    heater_vias: ComponentSpec = partial(
         via_stack,
         size=(0.5, 0.5),
         layers=("M1", "M2"),
         vias=(
-            gf.partial(
+            partial(
                 via,
                 layer="VIAC",
                 size=(0.1, 0.1),
                 spacing=(0.2, 0.2),
                 enclosure=0.1,
             ),
-            gf.partial(
+            partial(
                 via,
                 layer="VIA1",
                 size=(0.1, 0.1),
                 spacing=(0.2, 0.2),
                 enclosure=0.1,
             ),
         ),
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_section_based.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_section_based.py`

 * *Files 6% similar despite different names*

```diff
@@ -2,40 +2,40 @@
 Generates a ring resonator based on a series of given cross sections.
 
 This is useful to generate interleaved junction rings or rings with relatively
 complex junction profiles
 """
 
 from functools import partial
-from typing import Dict, Optional
 
 import numpy as np
+
 import gdsfactory as gf
-from gdsfactory.typings import CrossSectionSpec, Union, List, Tuple, Floats
+from gdsfactory.cell import cell_without_validator
 from gdsfactory.components.bend_circular import bend_circular
 from gdsfactory.components.straight import straight
-from gdsfactory.cell import cell_without_validator
+from gdsfactory.typings import CrossSectionSpec, Floats
 
 def_dict = {"A": "rib", "B": "strip"}
 def_ang_dict = {"A": 6, "B": 6}
 
 
 @cell_without_validator
 def ring_section_based(
-    gap: Union[float, Floats] = 0.3,
+    gap: float | Floats = 0.3,
     radius: float = 5.0,
     add_drop: bool = False,
-    cross_sections: Dict[str, CrossSectionSpec] = def_dict,
-    cross_sections_sequence: Union[str, List[str], Tuple[str, ...]] = "AB",
-    cross_sections_angles: Optional[Dict[str, float]] = def_ang_dict,
-    start_cross_section: Optional[CrossSectionSpec] = None,
-    start_angle: Optional[float] = 10.0,
-    drop_cross_section: Optional[CrossSectionSpec] = None,
+    cross_sections: dict[str, CrossSectionSpec] = def_dict,
+    cross_sections_sequence: str | list[str] | tuple[str, ...] = "AB",
+    cross_sections_angles: dict[str, float] | None = def_ang_dict,
+    start_cross_section: CrossSectionSpec | None = None,
+    start_angle: float | None = 10.0,
+    drop_cross_section: CrossSectionSpec | None = None,
     bus_cross_section: CrossSectionSpec = "strip",
-    ang_res: Optional[int] = 0.1,
+    ang_res: int | None = 0.1,
 ) -> gf.Component:
     """Returns a ring made of the specified cross sections.
 
     We start with start_cross section if indicated, then repeat the sequence in
     cross_section_sequence until the whole ring is filled.
 
     Args:
@@ -65,27 +65,27 @@
     """
 
     c = gf.Component()
 
     # First of all we need to do a bunch of checks
     angular_extent_sequence = 360
 
-    if not isinstance(gap, Union[List, Tuple]):
+    if not isinstance(gap, list | tuple):
         gap = [gap] * 2
 
     # See if we need to add initial cross sections
     if start_cross_section is not None:
         start_xs = gf.get_cross_section(start_cross_section)
         angular_extent_sequence -= start_angle
 
     if add_drop:
         if start_cross_section is not None or drop_cross_section is not None:
             angular_extent_sequence -= start_angle
 
-        if not isinstance(cross_sections_sequence, Union[List, Tuple]):
+        if not isinstance(cross_sections_sequence, list | tuple):
             cross_sections_sequence = [cross_sections_sequence] * 2
 
     if cross_sections_angles is None:
         if add_drop:
             n_sections_0 = len(cross_sections_sequence[0])
             sing_sec_ang_1 = angular_extent_sequence / (2 * n_sections_0)
             n_sections_1 = len(cross_sections_sequence[1])
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_single.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_single.py`

 * *Files 4% similar despite different names*

```diff
@@ -54,19 +54,28 @@
         length_x=length_x,
         cross_section=cross_section,
         **kwargs,
     )
     sy = straight(length=length_y, cross_section=cross_section, **kwargs)
     b = gf.get_component(bend, cross_section=cross_section, radius=radius, **kwargs)
     sx = straight(length=length_x, cross_section=cross_section, **kwargs)
-    sl = c << sy
-    sr = c << sy
+
+    sl = sy.ref()
+    sr = sy.ref()
+    st = sx.ref()
+
+    if length_y > 0:
+        c.add(sl)
+        c.add(sr)
+
+    if length_x > 0:
+        c.add(st)
+
     bl = c << b
     br = c << b
-    st = c << sx
 
     sl.connect(port="o1", destination=cb.ports["o2"])
     bl.connect(port="o2", destination=sl.ports["o2"])
 
     st.connect(port="o2", destination=bl.ports["o1"])
     br.connect(port="o2", destination=st.ports["o1"])
     sr.connect(port="o1", destination=br.ports["o1"])
@@ -79,14 +88,16 @@
 
 if __name__ == "__main__":
     # c = ring_single(layer=(2, 0), cross_section_factory=gf.cross_section.pin, width=1)
     # c = ring_single(width=2, gap=1, layer=(2, 0), radius=7, length_y=1)
     # print(c.ports)
 
     # c = gf.routing.add_fiber_array(ring_single)
-    c = ring_single(cross_section="rib", width=2)
+    # c = ring_single(cross_section="rib", width=2)
+    c = ring_single(length_y=0, length_x=0)
+    c.get_netlist()
     c.show(show_ports=True)
 
     # cc = gf.add_pins(c)
     # print(c.settings)
     # print(c.settings)
     # cc.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_single_array.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_single_array.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Dict, Optional, Tuple
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.ring_single import ring_single
 from gdsfactory.components.straight import straight
 from gdsfactory.typings import ComponentFactory, CrossSectionSpec
 
 _list_of_dicts = (
@@ -14,15 +12,15 @@
 )
 
 
 @gf.cell
 def ring_single_array(
     ring: ComponentFactory = ring_single,
     spacing: float = 5.0,
-    list_of_dicts: Optional[Tuple[Dict[str, float], ...]] = None,
+    list_of_dicts: tuple[dict[str, float], ...] | None = None,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Ring of single bus connected with straights.
 
     Args:
         ring: ring function.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_single_bend_coupler.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_single_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_single_dut.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_single_dut.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,19 +1,21 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.coupler_ring import coupler_ring
 from gdsfactory.components.straight import straight
 from gdsfactory.components.taper import taper
 from gdsfactory.snap import assert_on_2nm_grid
 from gdsfactory.typings import ComponentSpec
 
-taper2 = gf.partial(taper, width2=3)
+taper2 = partial(taper, width2=3)
 
 
 @gf.cell
 def ring_single_dut(
     component: ComponentSpec = taper2,
     gap: float = 0.2,
     length_x: float = 4,
@@ -39,15 +41,15 @@
         coupler: coupler function.
         bend: bend function.
         with_component: True adds component. False adds waveguide.
         port_name: for component input.
         kwargs: cross_section settings.
 
     Args:
-        with_component: if False changes component for just a straight
+        with_component: if False changes component for just a straight.
 
     .. code::
 
           bl-wt-br
           |      | length_y
           wl     component
           |      |
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_single_heater.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_double_heater.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,130 +1,162 @@
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import gdsfactory as gf
+from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
-from gdsfactory.components.coupler_ring import coupler_ring as _coupler_ring
+from gdsfactory.components.coupler_ring import coupler_ring
 from gdsfactory.components.straight import straight
-from gdsfactory.components.via_stack import via_stack_heater_mtop
+from gdsfactory.components.via_stack import via_stack_heater_m3
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Float2
 
-via_stack_heater_mtop_mini = gf.partial(via_stack_heater_mtop, size=(4, 4))
+via_stack_heater_m3_mini = partial(via_stack_heater_m3, size=(4, 4))
 
 
 @gf.cell
-def ring_single_heater(
+def ring_double_heater(
     gap: float = 0.2,
     radius: float = 10.0,
-    length_x: float = 4.0,
-    length_y: float = 0.6,
-    coupler_ring: ComponentSpec = _coupler_ring,
+    length_x: float = 0.01,
+    length_y: float = 0.01,
+    coupler_ring: ComponentSpec = coupler_ring,
+    coupler_ring_top: ComponentSpec = None,
+    straight: ComponentSpec = straight,
     bend: ComponentSpec = bend_euler,
+    cross_section_heater: CrossSectionSpec = "heater_metal",
     cross_section_waveguide_heater: CrossSectionSpec = "strip_heater_metal",
     cross_section: CrossSectionSpec = "strip",
-    via_stack: ComponentSpec = via_stack_heater_mtop_mini,
-    port_orientation: Optional[float] = 90,
+    via_stack: gf.typings.ComponentSpec = via_stack_heater_m3_mini,
+    port_orientation: float | None = None,
     via_stack_offset: Float2 = (0, 0),
     **kwargs,
-) -> gf.Component:
-    """Returns a single ring with heater on top.
+) -> Component:
+    """Returns a double bus ring with heater on top.
 
-    ring coupler (cb: bottom) connects to two vertical straights (sl: left, sr: right),
-    two bends (bl, br) and horizontal straight (wg: top)
+    two couplers (ct: top, cb: bottom)
+    connected with two vertical straights (sl: left, sr: right)
 
     Args:
         gap: gap between for coupler.
         radius: for the bend and coupler.
         length_x: ring coupler length.
         length_y: vertical straight length.
-        coupler_ring: ring coupler function.
-        bend: 90 degrees bend function.
-        cross_section_waveguide_heater: for heater.
+        coupler_ring: ring coupler spec.
+        coupler_ring_top: ring coupler spec for coupler away from vias (defaults to coupler_ring)
+        straight: straight spec.
+        bend: bend spec.
+        cross_section_heater: for heater.
+        cross_section_waveguide_heater: for waveguide with heater.
         cross_section: for regular waveguide.
         via_stack: for heater to routing metal.
         port_orientation: for electrical ports to promote from via_stack.
         via_stack_offset: x,y offset for via_stack.
         kwargs: cross_section settings.
 
     .. code::
 
-          bl-st-br
+         --==ct==--
           |      |
           sl     sr length_y
           |      |
          --==cb==-- gap
 
           length_x
     """
     gap = gf.snap.snap_to_grid(gap, nm=2)
 
-    coupler_ring = gf.get_component(
+    coupler_ring_top = coupler_ring_top or coupler_ring
+
+    coupler_component = gf.get_component(
         coupler_ring,
-        bend=bend,
         gap=gap,
         radius=radius,
         length_x=length_x,
+        bend=bend,
         cross_section=cross_section,
         bend_cross_section=cross_section_waveguide_heater,
         **kwargs,
     )
-
-    straight_side = straight(
-        length=length_y,
-        cross_section=cross_section_waveguide_heater,
+    coupler_component_top = gf.get_component(
+        coupler_ring_top,
+        gap=gap,
+        radius=radius,
+        length_x=length_x,
+        bend=bend,
+        cross_section=cross_section,
+        bend_cross_section=cross_section_waveguide_heater,
         **kwargs,
     )
-    straight_top = straight(
-        length=length_x,
+    straight_component = gf.get_component(
+        straight,
+        length=length_y,
         cross_section=cross_section_waveguide_heater,
         **kwargs,
     )
 
-    bend = gf.get_component(
-        bend, radius=radius, cross_section=cross_section_waveguide_heater, **kwargs
-    )
-
-    c = gf.Component()
-    cb = c << coupler_ring
-    sl = c << straight_side
-    sr = c << straight_side
-    bl = c << bend
-    br = c << bend
-    st = c << straight_top
-    # st.mirror(p1=(0, 0), p2=(1, 0))
+    c = Component()
+    cb = c.add_ref(coupler_component)
+    ct = c.add_ref(coupler_component_top)
+    sl = c.add_ref(straight_component)
+    sr = c.add_ref(straight_component)
 
     sl.connect(port="o1", destination=cb.ports["o2"])
-    bl.connect(port="o2", destination=sl.ports["o2"])
-
-    st.connect(port="o2", destination=bl.ports["o1"])
-    br.connect(port="o2", destination=st.ports["o1"])
-    sr.connect(port="o1", destination=br.ports["o1"])
-    sr.connect(port="o2", destination=cb.ports["o3"])
-
-    c.add_port("o2", port=cb.ports["o4"])
+    ct.connect(port="o3", destination=sl.ports["o2"])
+    sr.connect(port="o2", destination=ct.ports["o2"])
     c.add_port("o1", port=cb.ports["o1"])
+    c.add_port("o2", port=cb.ports["o4"])
+    c.add_port("o3", port=ct.ports["o4"])
+    c.add_port("o4", port=ct.ports["o1"])
 
     via = gf.get_component(via_stack)
     c1 = c << via
     c2 = c << via
     c1.xmax = -length_x / 2 + cb.x - via_stack_offset[0]
     c2.xmin = +length_x / 2 + cb.x + via_stack_offset[0]
     c1.movey(via_stack_offset[1])
     c2.movey(via_stack_offset[1])
-    c.add_ports(c1.get_ports_list(orientation=port_orientation), prefix="e1")
-    c.add_ports(c2.get_ports_list(orientation=port_orientation), prefix="e2")
-    c.auto_rename_ports()
+
+    p1 = c1.get_ports_list(orientation=port_orientation)
+    p2 = c2.get_ports_list(orientation=port_orientation)
+    valid_orientations = {p.orientation for p in via.ports.values()}
+
+    if not p1:
+        raise ValueError(
+            f"No ports found for port_orientation {port_orientation} in {valid_orientations}"
+        )
+
+    c.add_ports(p1, prefix="l_")
+    c.add_ports(p2, prefix="r_")
+
+    heater_top = c << gf.get_component(
+        straight,
+        length=length_x,
+        cross_section=cross_section_heater,
+    )
+    heater_top.connect("e1", ct.ports["e1"])
+
     return c
 
 
 if __name__ == "__main__":
-    c = ring_single_heater(width=0.5, gap=1, layer=(2, 0), radius=10, length_y=1)
-    print(c.to_yaml())
-    # print(c.to_dict())
-    c.show(show_subports=False)
-    # c.pprint_ports()
-
-    # cc = gf.add_pins(c)
-    # print(c.settings)
-    # print(c.settings)
-    # cc.show(show_ports=True)
+    c1 = ring_double_heater(via_stack="via_stack")
+    c1.pprint_ports()
+
+    c2 = ring_double_heater(via_stack="via_stack_slot")
+    c2.pprint_ports()
+    # c = ring_double_heater(width=1, layer=(2, 0), length_y=3)
+    # c = ring_double_heater(
+    #     length_x=0,
+    #     port_orientation=90,
+    #     bend=gf.components.bend_circular,
+    #     via_stack_offset=(2, 0),
+    #     coupler_ring_top=coupler_ring,
+    #     coupler_ring=gf.partial(
+    #         coupler_ring_point,
+    #         coupler_ring=coupler_ring,
+    #         open_layers=("HEATER",),
+    #         open_sizes=((5, 7),),
+    #     ),
+    # )
+    c2.show(show_ports=True)
+    # c.pprint()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/ring_single_pn.py` & `gdsfactory-7.0.0/gdsfactory/components/ring_single_pn.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,54 +1,56 @@
 from __future__ import annotations
 
 from functools import partial
+
 import numpy as np
+
 import gdsfactory as gf
+from gdsfactory.components.via import via
+from gdsfactory.components.via_stack import via_stack
 from gdsfactory.cross_section import Section
 from gdsfactory.typings import ComponentSpec, CrossSection, LayerSpec
-from gdsfactory.components.via_stack import via_stack
-from gdsfactory.components.via import via
 
 
 @gf.cell
 def ring_single_pn(
     gap: float = 0.3,
     radius: float = 5.0,
     doping_angle: float = 250,
     cross_section: CrossSection = partial(
         gf.cross_section.strip,
         sections=(Section(width=2 * 2.425, layer="SLAB90", name="slab"),),
     ),
-    pn_cross_section: CrossSection = gf.partial(
+    pn_cross_section: CrossSection = partial(
         gf.cross_section.pn,
         width_doping=2.425,
         width_slab=2 * 2.425,
         layer_via="VIAC",
         width_via=0.5,
         layer_metal="M1",
         width_metal=0.5,
     ),
     doped_heater: bool = True,
     doped_heater_angle_buffer: float = 10,
     doped_heater_layer: LayerSpec = "NPP",
     doped_heater_width: float = 0.5,
     doped_heater_waveguide_offset: float = 2.175,
-    heater_vias: ComponentSpec = gf.partial(
+    heater_vias: ComponentSpec = partial(
         via_stack,
         size=(0.5, 0.5),
         layers=("M1", "M2"),
         vias=(
-            gf.partial(
+            partial(
                 via,
                 layer="VIAC",
                 size=(0.1, 0.1),
                 spacing=(0.2, 0.2),
                 enclosure=0.1,
             ),
-            gf.partial(
+            partial(
                 via,
                 layer="VIA1",
                 size=(0.1, 0.1),
                 spacing=(0.2, 0.2),
                 enclosure=0.1,
             ),
         ),
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/seal_ring.py` & `gdsfactory-7.0.0/gdsfactory/components/seal_ring.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,22 +1,23 @@
 from __future__ import annotations
 
-from typing import Tuple, Union
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.components.via_stack import via_stack
 from gdsfactory.snap import snap_to_grid
 
-Coordinate = Union[Tuple[float, float], Tuple[int, int]]
+Float2 = tuple[float, float]
+Coordinate = tuple[Float2, Float2]
 
 
 @gf.cell_without_validator
 def seal_ring(
-    bbox: Tuple[Coordinate, Coordinate] = ((-1.0, -1.0), (3.0, 4.0)),
+    bbox: tuple[Coordinate, Coordinate] = ((-1.0, -1.0), (3.0, 4.0)),
     seal: gf.typings.ComponentSpec = via_stack,
     width: float = 10,
     padding: float = 10.0,
     with_north: bool = True,
     with_south: bool = True,
     with_east: bool = True,
     with_west: bool = True,
@@ -39,15 +40,15 @@
     (xmin, ymin), (xmax, ymax) = bbox
 
     x = (xmax + xmin) / 2
 
     sx = xmax - xmin
     sy = ymax - ymin
 
-    snap = gf.partial(snap_to_grid, nm=2)
+    snap = partial(snap_to_grid, nm=2)
     sx = snap(sx)
     sy = snap(sy)
 
     ymin_north = snap(ymax + padding)
     ymax_south = snap(ymax - sy - padding)
 
     # north south
@@ -74,12 +75,12 @@
         south.ymax = ymax_south
         south.x = x
 
     return c
 
 
 if __name__ == "__main__":
-    big_square = gf.partial(rectangle, size=(1300, 2600))
+    big_square = partial(rectangle, size=(1300, 2600))
     c = gf.Component("demo")
     c << big_square()
     c << seal_ring(c.bbox + ((0, 0), (10, 0)), with_south=False)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/snspd.py` & `gdsfactory-7.0.0/gdsfactory/components/snspd.py`

 * *Files 3% similar despite different names*

```diff
@@ -2,23 +2,23 @@
 
 import numpy as np
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.compass import compass
 from gdsfactory.components.optimal_hairpin import optimal_hairpin
-from gdsfactory.typings import Float2, LayerSpec, Optional
+from gdsfactory.typings import Float2, LayerSpec
 
 
 @cell
 def snspd(
     wire_width: float = 0.2,
     wire_pitch: float = 0.6,
     size: Float2 = (10, 8),
-    num_squares: Optional[int] = None,
+    num_squares: int | None = None,
     turn_ratio: float = 4,
     terminals_same_side: bool = False,
     layer: LayerSpec = (1, 0),
 ) -> Component:
     """Creates an optimally-rounded SNSPD.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/spiral_double.py` & `gdsfactory-7.0.0/gdsfactory/components/spiral_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/spiral_external_io.py` & `gdsfactory-7.0.0/gdsfactory/components/spiral_external_io.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,41 +1,39 @@
 """Bends with grating couplers inside the spiral.
 
 maybe: need to add grating coupler loopback as well
 """
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import numpy as np
 from numpy import float64
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.routing.manhattan import round_corners
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
-def get_bend_port_distances(bend: Component) -> Tuple[float64, float64]:
+def get_bend_port_distances(bend: Component) -> tuple[float64, float64]:
     """Returns distance between bend ports."""
     p0, p1 = bend.ports.values()
     return abs(p0.x - p1.x), abs(p0.y - p1.y)
 
 
 @cell
 def spiral_external_io(
     N: int = 6,
     x_inner_length_cutback: float = 300.0,
     x_inner_offset: float = 0.0,
     y_straight_inner_top: float = 0.0,
     xspacing: float = 3.0,
     yspacing: float = 3.0,
     bend: ComponentSpec = bend_euler,
-    length: Optional[float] = None,
+    length: float | None = None,
     cross_section: CrossSectionSpec = "strip",
     with_inner_ports: bool = False,
     y_straight_outer_offset: float = 0.0,
     inner_loop_spacing_offset: float = 0.0,
     **kwargs,
 ) -> Component:
     """Returns spiral with input and output ports outside the spiral.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/spiral_heater.py` & `gdsfactory-7.0.0/gdsfactory/components/spiral_heater.py`

 * *Files 5% similar despite different names*

```diff
@@ -4,34 +4,29 @@
 from scipy.interpolate import interp1d
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.bend_s import bend_s, get_min_sbend_size
 from gdsfactory.components.straight import straight
-from gdsfactory.typings import (
-    ComponentFactory,
-    CrossSectionSpec,
-    Floats,
-)
 from gdsfactory.routing.get_route import get_route
-from typing import Optional
+from gdsfactory.typings import ComponentFactory, CrossSectionSpec, Floats
 
 
 @gf.cell
 def spiral_racetrack(
     min_radius: float = 5,
     straight_length: float = 10.0,
     spacings: Floats = (2, 2, 3, 3, 2, 2),
     straight_factory: ComponentFactory = straight,
     bend_factory: ComponentFactory = bend_euler,
     bend_s_factory: ComponentFactory = bend_s,
     cross_section: CrossSectionSpec = "strip",
-    cross_section_s: Optional[CrossSectionSpec] = None,
-    n_bend_points: Optional[int] = None,
+    cross_section_s: CrossSectionSpec | None = None,
+    n_bend_points: int | None = None,
     with_inner_ports: bool = False,
     extra_90_deg_bend: bool = False,
 ) -> Component:
     """Returns Racetrack-Spiral.
 
     Args:
         min_radius: smallest radius in um.
@@ -122,16 +117,16 @@
     n_straight_sections: int = 8,
     min_radius: float = 5,
     min_spacing: float = 5.0,
     straight_factory: ComponentFactory = straight,
     bend_factory: ComponentFactory = bend_euler,
     bend_s_factory: ComponentFactory = bend_s,
     cross_section: CrossSectionSpec = "strip",
-    cross_section_s: Optional[CrossSectionSpec] = None,
-    n_bend_points: Optional[int] = None,
+    cross_section_s: CrossSectionSpec | None = None,
+    n_bend_points: int | None = None,
     with_inner_ports: bool = False,
 ) -> Component:
     """Returns Racetrack-Spiral with a specified total length.
 
     The input and output ports are aligned in y. This class is meant to
     be used for generating interferometers with long waveguide lengths, where
     the most important parameter is the length difference between the arms.
@@ -324,15 +319,15 @@
     # get the required spacing to achieve the required length (interpolate)
     f = interp1d(lens, straight_lengths)
     return f(length)
 
 
 @gf.cell
 def spiral_racetrack_heater_metal(
-    min_radius: Optional[float] = None,
+    min_radius: float | None = None,
     straight_length: float = 30,
     spacing: float = 2,
     num: int = 8,
     straight_factory: ComponentFactory = straight,
     bend_factory: ComponentFactory = bend_euler,
     bend_s_factory: ComponentFactory = bend_s,
     waveguide_cross_section: CrossSectionSpec = "strip",
@@ -394,15 +389,15 @@
     c.add_port("e1", port=heater_bot["e2"])
     c.add_port("e2", port=heater_top["e2"])
     return c
 
 
 @gf.cell
 def spiral_racetrack_heater_doped(
-    min_radius: Optional[float] = None,
+    min_radius: float | None = None,
     straight_length: float = 30,
     spacing: float = 2,
     num: int = 8,
     straight_factory: ComponentFactory = straight,
     bend_factory: ComponentFactory = bend_euler,
     bend_s_factory: ComponentFactory = bend_s,
     waveguide_cross_section: CrossSectionSpec = "strip",
@@ -457,22 +452,21 @@
 
     c.add_ports(spiral.ports)
     c.add_ports(prefix="top_", ports=heater_top.ports)
     c.add_ports(prefix="bot_", ports=heater_bot.ports)
     return c
 
 
-def test_length_spiral_racetrack():
+def test_length_spiral_racetrack() -> None:
     import numpy as np
 
     length = 1000
     c = spiral_racetrack_fixed_length(length=length, cross_section="strip_no_pins")
     length_computed = c.area() / 0.5
     np.isclose(length, length_computed)
-    return c
 
 
 @gf.cell
 def spiral_slab(cross_section="strip", layer_slab=(3, 0), cladding_offset=3, **kwargs):
     xs = gf.get_cross_section(cross_section)
     xs_slab = gf.CrossSection(layer=layer_slab, width=xs.width + cladding_offset)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/spiral_inner_io.py` & `gdsfactory-7.0.0/gdsfactory/components/spiral_inner_io.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 """Spiral with grating couplers inside to save space."""
 from __future__ import annotations
 
-from typing import Optional, Tuple
+from functools import partial
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler, bend_euler180
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.routing.manhattan import round_corners
 from gdsfactory.snap import snap_to_grid
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
-def get_bend_port_distances(bend: Component) -> Tuple[float, float]:
+def get_bend_port_distances(bend: Component) -> tuple[float, float]:
     p0, p1 = bend.ports.values()
     return abs(p0.x - p1.x), abs(p0.y - p1.y)
 
 
 @gf.cell
 def spiral_inner_io(
     N: int = 6,
@@ -27,18 +27,18 @@
     y_straight_inner_top: float = 50.0,
     y_straight_inner_bottom: float = 10.0,
     grating_spacing: float = 127.0,
     waveguide_spacing: float = 3.0,
     bend90: ComponentSpec = bend_euler,
     bend180: ComponentSpec = bend_euler180,
     straight: ComponentSpec = straight_function,
-    length: Optional[float] = None,
+    length: float | None = None,
     cross_section: CrossSectionSpec = "strip",
-    cross_section_bend: Optional[CrossSectionSpec] = None,
-    cross_section_bend180: Optional[CrossSectionSpec] = None,
+    cross_section_bend: CrossSectionSpec | None = None,
+    cross_section_bend180: CrossSectionSpec | None = None,
     asymmetric_cross_section: bool = False,
     **kwargs,
 ) -> Component:
     """Returns Spiral with ports inside the spiral loop.
 
     You can add grating
     couplers inside.
@@ -169,16 +169,16 @@
     component.info["length"] = snap_to_grid(length + 2 * y_straight_inner_top)
     return component
 
 
 @gf.cell
 def spiral_inner_io_fiber_single(
     cross_section: CrossSectionSpec = "strip",
-    cross_section_bend: Optional[CrossSectionSpec] = None,
-    cross_section_ports: Optional[CrossSectionSpec] = None,
+    cross_section_bend: CrossSectionSpec | None = None,
+    cross_section_ports: CrossSectionSpec | None = None,
     x_straight_inner_right: float = 40.0,
     x_straight_inner_left: float = 75.0,
     y_straight_inner_top: float = 10.0,
     y_straight_inner_bottom: float = 0.0,
     grating_spacing: float = 200.0,
     **kwargs,
 ) -> Component:
@@ -257,14 +257,14 @@
     import gdsfactory as gf
 
     cross_section = gf.cross_section.rib_conformal2
     cross_section = gf.cross_section.pn
 
     c = gf.components.spiral_inner_io(
         cross_section=cross_section,
-        cross_section_bend=gf.partial(cross_section, mirror=True),
-        # cross_section_bend180=gf.partial(cross_section, mirror=True),
+        cross_section_bend=partial(cross_section, mirror=True),
+        # cross_section_bend180=partial(cross_section, mirror=True),
         waveguide_spacing=20,
         radius=30,
         asymmetric_cross_section=True,
     )
     c.show()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/splitter_chain.py` & `gdsfactory-7.0.0/gdsfactory/components/splitter_chain.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/splitter_tree.py` & `gdsfactory-7.0.0/gdsfactory/components/splitter_tree.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,27 +1,25 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.components.bend_s import bend_s as bend_s_function
 from gdsfactory.components.mmi1x2 import mmi1x2
 from gdsfactory.components.mmi2x2 import mmi2x2
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Float2
 
 
 @gf.cell
 def splitter_tree(
     coupler: ComponentSpec = mmi1x2,
     noutputs: int = 4,
     spacing: Float2 = (90.0, 50.0),
-    bend_s: Optional[ComponentSpec] = bend_s_function,
-    bend_s_xsize: Optional[float] = None,
+    bend_s: ComponentSpec | None = bend_s_function,
+    bend_s_xsize: float | None = None,
     cross_section: CrossSectionSpec = "strip",
 ) -> gf.Component:
     """Tree of power splitters.
 
     Args:
         coupler: coupler factory.
         noutputs: number of outputs.
@@ -145,15 +143,15 @@
 if __name__ == "__main__":
     test_splitter_tree_ports()
     test_splitter_tree_ports_no_sbend()
 
     import gdsfactory as gf
 
     # c = splitter_tree(
-    #     coupler=gf.partial(mmi2x2, gap_mmi=2.0, width_mmi=5.0),
+    #     coupler=partial(mmi2x2, gap_mmi=2.0, width_mmi=5.0),
     #     # noutputs=128 * 2,
     #     # noutputs=2 ** 3,
     #     noutputs=2**2,
     #     # bend_s=None,
     #     # dy=100.0,
     #     # layer=(2, 0),
     # )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight.py` & `gdsfactory-7.0.0/gdsfactory/components/straight.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 """Straight waveguide."""
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.component import Component
+from gdsfactory.route_info import route_info_from_cs
 from gdsfactory.typings import CrossSectionSpec
 
 
 @gf.cell
 def straight(
     length: float = 10.0,
     npoints: int = 2,
@@ -36,14 +37,16 @@
     path = p.extrude(x)
     ref = c << path
     c.add_ports(ref.ports)
     c.info["length"] = length
     c.info["width"] = x.width
     c.info["cross_section"] = cross_section
 
+    c.info["route_info"] = route_info_from_cs(x, length=length)
+
     if x.info:
         c.info.update(x.info)
 
     if with_bbox and length and x.bbox_layers:
         padding = []
         for offset in x.bbox_offsets:
             points = get_padding_points(
@@ -57,25 +60,25 @@
         for layer, points in zip(x.bbox_layers, padding):
             c.add_polygon(points, layer=layer)
     c.absorb(ref)
     return c
 
 
 if __name__ == "__main__":
-    # c = straight(cross_section=gf.partial('metal_routing', width=2), with_hash=False)
+    # c = straight(cross_section=partial('metal_routing', width=2), with_hash=False)
     # c = straight(
-    #     cross_section=gf.partial(gf.cross_section.strip, width=2), with_hash=False
+    #     cross_section=partial(gf.cross_section.strip, width=2), with_hash=False
     # )
     # c = straight(cladding_offset=2.5)
 
     nm = 1e-3
     xs = gf.cross_section.strip()
-    print(dict(xs))
-    c = straight(cross_section=xs)
-    print(c.name)
+    c = straight()
+    # print(c.settings)
+    print(c.settings.info["settings"]["add_pins"])
 
     # strip2 = gf.get_cross_section("strip", layer=(2, 0))
     # settings = dict(width=2)
 
     # c = straight(
     #     length=1, cross_section={"cross_section": "strip", "settings": settings}
     # )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_array.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_heater_doped_rib.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_heater_doped_rib.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Optional, Tuple
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.taper_cross_section import taper_cross_section
 from gdsfactory.components.via_stack import via_stack_m1_m3 as via_stack_metal_function
 from gdsfactory.components.via_stack import via_stack_slab_npp_m3
 from gdsfactory.cross_section import rib_heater_doped, strip_rib_tip
@@ -14,19 +14,19 @@
 
 @gf.cell
 def straight_heater_doped_rib(
     length: float = 320.0,
     nsections: int = 3,
     cross_section: CrossSectionSpec = strip_rib_tip,
     cross_section_heater: CrossSectionSpec = rib_heater_doped,
-    via_stack: Optional[ComponentSpec] = via_stack_slab_npp_m3,
-    via_stack_metal: Optional[ComponentSpec] = via_stack_metal_function,
-    via_stack_metal_size: Tuple[float, float] = (10.0, 10.0),
-    via_stack_size: Tuple[float, float] = (10.0, 10.0),
-    taper: Optional[ComponentSpec] = taper_cross_section,
+    via_stack: ComponentSpec | None = via_stack_slab_npp_m3,
+    via_stack_metal: ComponentSpec | None = via_stack_metal_function,
+    via_stack_metal_size: tuple[float, float] = (10.0, 10.0),
+    via_stack_size: tuple[float, float] = (10.0, 10.0),
+    taper: ComponentSpec | None = taper_cross_section,
     with_taper1: bool = True,
     with_taper2: bool = True,
     heater_width: float = 2.0,
     heater_gap: float = 0.8,
     via_stack_gap: float = 0.0,
     width: float = 0.5,
     xoffset_tip1: float = 0.2,
@@ -92,15 +92,15 @@
                                                                      <------------>
                                                                       heater_width
         <------------------------------------------------------------------------------>
                                        slab_width
 
     """
     c = Component()
-    cross_section_heater = gf.partial(
+    cross_section_heater = partial(
         cross_section_heater,
         heater_width=heater_width,
         heater_gap=heater_gap,
         width=width,
         **kwargs,
     )
 
@@ -190,20 +190,19 @@
         via_stack_bot.ymax = via_stacks[1].ymin
 
         c.add_ports(via_stack_top.ports, prefix="top_")
         c.add_ports(via_stack_bot.ports, prefix="bot_")
     return c
 
 
-def test_straight_heater_doped_rib_ports() -> Component:
+def test_straight_heater_doped_rib_ports() -> None:
     c = straight_heater_doped_rib(length=100.0)
     assert c.get_ports_xsize(port_type="optical") == 100.0, c.get_ports_xsize(
         port_type="optical"
     )
-    return c
 
 
 if __name__ == "__main__":
-    c = straight_heater_doped_rib(xoffset_tip1=10, via_stack=None)
+    c = straight_heater_doped_rib(xoffset_tip1=10)
     # c = straight_heater_doped_rib(with_taper1=False)
     # c = straight_heater_doped_rib(length=500)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_heater_doped_strip.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_heater_doped_strip.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_heater_meander.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_heater_meander.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,27 +1,29 @@
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.typings import ComponentSpec, Floats, LayerSpec, Optional
+from gdsfactory.typings import ComponentSpec, Floats, LayerSpec
 
 
 @gf.cell
 def straight_heater_meander(
     length: float = 300.0,
     spacing: float = 2.0,
     cross_section: gf.typings.CrossSectionSpec = "strip",
     heater_width: float = 2.5,
     extension_length: float = 15.0,
     layer_heater: LayerSpec = "HEATER",
     radius: float = 5.0,
-    via_stack: Optional[ComponentSpec] = "via_stack_heater_mtop",
-    port_orientation1: int = 180,
-    port_orientation2: int = 0,
-    heater_taper_length: Optional[float] = 10.0,
+    via_stack: ComponentSpec | None = "via_stack_heater_mtop",
+    port_orientation1: int | None = None,
+    port_orientation2: int | None = None,
+    heater_taper_length: float | None = 10.0,
     straight_widths: Floats = (0.8, 0.9, 0.8),
     taper_length: float = 10,
 ) -> Component:
     """Returns a meander based heater.
 
     based on SungWon Chung, Makoto Nakai, and Hossein Hashemi,
     Low-power thermo-optic silicon modulator for large-scale photonic integrated systems
@@ -33,16 +35,16 @@
         spacing: waveguide spacing (center to center).
         cross_section: for waveguide.
         heater_width: for heater.
         extension_length: of input and output optical ports.
         layer_heater: for top heater, if None, it does not add a heater.
         radius: for the meander bends.
         via_stack: for the heater to via_stack metal.
-        port_orientation1: in degrees.
-        port_orientation2: in degrees.
+        port_orientation1: in degrees. None adds all orientations.
+        port_orientation2: in degrees. None adds all orientations.
         heater_taper_length: minimizes current concentrations from heater to via_stack.
         straight_width: width of the straight section.
         taper_length: from the cross_section.
     """
     rows = len(straight_widths)
     c = gf.Component()
     x = gf.get_cross_section(cross_section)
@@ -67,40 +69,40 @@
     cross_section2 = cross_section
 
     straight_length = gf.snap.snap_to_grid(
         (length - (rows - 1) * route.length) / rows, nm=2
     )
     ports = {}
 
-    """
-    Straights
-    """
+    ##############
+    # Straights
+    ##############
     for row, straight_width in enumerate(straight_widths):
         cross_section1 = gf.get_cross_section(cross_section, width=straight_width)
         straight = gf.c.straight(
             length=straight_length - 2 * taper_length, cross_section=cross_section1
         )
 
-        taper = gf.partial(
+        taper = partial(
             gf.c.taper_cross_section_linear,
             cross_section1=cross_section1,
             cross_section2=cross_section2,
             length=taper_length,
         )
 
         straight_with_tapers = gf.c.extend_ports(straight, extension=taper)
 
         straight_ref = c << straight_with_tapers
         straight_ref.y = row * spacing
         ports[f"o1_{row+1}"] = straight_ref.ports["o1"]
         ports[f"o2_{row+1}"] = straight_ref.ports["o2"]
 
-    """
-    Loopbacks
-    """
+    ##############
+    # loopbacks
+    ##############
     for row in range(1, rows, 2):
         extra_length = 3 * (rows - row - 1) / 2 * radius
         extra_straight1 = c << gf.c.straight(
             length=extra_length, cross_section=cross_section
         )
         extra_straight1.connect("o1", ports[f"o1_{row+1}"])
         extra_straight2 = c << gf.c.straight(
@@ -139,43 +141,50 @@
     straight1.connect("o2", ports["o1_1"])
     straight2.connect("o1", ports[f"o2_{rows}"])
 
     c.add_port("o1", port=straight1.ports["o1"])
     c.add_port("o2", port=straight2.ports["o2"])
 
     if layer_heater:
-        heater_cross_section = gf.partial(
+        heater_cross_section = partial(
             gf.cross_section.cross_section, width=heater_width, layer=layer_heater
         )
 
         heater = c << gf.c.straight(
             length=straight_length,
             cross_section=heater_cross_section,
         )
         heater.movey(spacing * (rows // 2))
 
     if layer_heater and via_stack:
-        via_stacke = via_stackw = gf.get_component(via_stack)
+        via = via_stacke = via_stackw = gf.get_component(via_stack)
         dx = via_stackw.get_ports_xsize() / 2 + heater_taper_length or 0
         via_stack_west_center = heater.size_info.cw - (dx, 0)
         via_stack_east_center = heater.size_info.ce + (dx, 0)
 
-        via_stack_east_center = gf.snap.snap_to_grid(via_stack_east_center, nm=10)
-        via_stack_west_center = gf.snap.snap_to_grid(via_stack_west_center, nm=10)
-
         via_stack_west = c << via_stackw
         via_stack_east = c << via_stacke
         via_stack_west.move(via_stack_west_center)
         via_stack_east.move(via_stack_east_center)
-        c.add_port(
-            "e1", port=via_stack_west.get_ports_list(orientation=port_orientation1)[0]
-        )
-        c.add_port(
-            "e2", port=via_stack_east.get_ports_list(orientation=port_orientation2)[0]
-        )
+
+        valid_orientations = {p.orientation for p in via.ports.values()}
+        p1 = via_stack_west.get_ports_list(orientation=port_orientation1)
+        p2 = via_stack_east.get_ports_list(orientation=port_orientation2)
+
+        if not p1:
+            raise ValueError(
+                f"No ports for port_orientation1 {port_orientation1} in {valid_orientations}"
+            )
+        if not p2:
+            raise ValueError(
+                f"No ports for port_orientation2 {port_orientation2} in {valid_orientations}"
+            )
+
+        c.add_ports(p1, prefix="l_")
+        c.add_ports(p2, prefix="r_")
 
         if heater_taper_length:
             taper = gf.c.taper(
                 cross_section=heater_cross_section,
                 width1=via_stackw.ports["e1"].width,
                 width2=heater_width,
                 length=heater_taper_length,
@@ -218,12 +227,13 @@
     # c.add_port("o2", port=straight_array.ports[f"o2_{rows}_1"])
 
     c = straight_heater_meander(
         straight_widths=(0.5,) * 7,
         taper_length=10,
         # taper_length=10,
         length=1000,
-        # cross_section=gf.partial(gf.cross_section.strip, width=0.8),
+        # port_orientation1=0
+        # cross_section=partial(gf.cross_section.strip, width=0.8),
     )
     c.show(show_ports=True)
     # scene = c.to_3d()
     # scene.show()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_heater_meander_doped.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_heater_meander_doped.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,31 +1,31 @@
 from __future__ import annotations
 
-from typing import List
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.typings import ComponentSpec, Floats, LayerSpec, Optional
-from gdsfactory.cross_section import Section
-from gdsfactory.components.via_stack import via_stack
 from gdsfactory.components.via import via
+from gdsfactory.components.via_stack import via_stack
+from gdsfactory.cross_section import Section
+from gdsfactory.typings import ComponentSpec, Floats, LayerSpecs
 
-via_stack = gf.partial(
+via_stack = partial(
     via_stack,
     size=(1.5, 1.5),
     layers=("M1", "M2"),
     vias=(
-        gf.partial(
+        partial(
             via,
             layer="VIAC",
             size=(0.1, 0.1),
             spacing=(0.2, 0.2),
             enclosure=0.1,
         ),
-        gf.partial(
+        partial(
             via,
             layer="VIA1",
             size=(0.1, 0.1),
             spacing=(0.2, 0.2),
             enclosure=0.1,
         ),
     ),
@@ -35,19 +35,19 @@
 @gf.cell
 def straight_heater_meander_doped(
     length: float = 300.0,
     spacing: float = 2.0,
     cross_section: gf.typings.CrossSectionSpec = "strip",
     heater_width: float = 1.5,
     extension_length: float = 15.0,
-    layers_doping: List[LayerSpec] = ("P", "PP", "PPP"),
+    layers_doping: LayerSpecs = ("P", "PP", "PPP"),
     radius: float = 5.0,
-    via_stack: Optional[ComponentSpec] = via_stack,
-    port_orientation1: int = 180,
-    port_orientation2: int = 0,
+    via_stack: ComponentSpec | None = via_stack,
+    port_orientation1: int | None = None,
+    port_orientation2: int | None = None,
     straight_widths: Floats = (0.8, 0.9, 0.8),
     taper_length: float = 10,
 ) -> Component:
     """Returns a meander based heater.
 
     based on SungWon Chung, Makoto Nakai, and Hossein Hashemi,
     Low-power thermo-optic silicon modulator for large-scale photonic integrated systems
@@ -59,16 +59,16 @@
         spacing: waveguide spacing (center to center).
         cross_section: for waveguide.
         heater_width: for heater.
         extension_length: of input and output optical ports.
         layers_doping: doping layers to be used for heater.
         radius: for the meander bends.
         via_stack: for the heater to via_stack metal.
-        port_orientation1: in degrees.
-        port_orientation2: in degrees.
+        port_orientation1: in degrees. None adds all orientations.
+        port_orientation2: in degrees. None adds all orientations.
         straight_width: width of the straight section.
         taper_length: from the cross_section.
     """
     rows = len(straight_widths)
     c = gf.Component()
     x = gf.get_cross_section(cross_section)
     p1 = gf.Port(
@@ -101,15 +101,15 @@
     """
     for row, straight_width in enumerate(straight_widths):
         cross_section1 = gf.get_cross_section(cross_section, width=straight_width)
         straight = gf.c.straight(
             length=straight_length - 2 * taper_length, cross_section=cross_section1
         )
 
-        taper = gf.partial(
+        taper = partial(
             gf.c.taper_cross_section_linear,
             cross_section1=cross_section1,
             cross_section2=cross_section2,
             length=taper_length,
         )
 
         straight_with_tapers = gf.c.extend_ports(straight, extension=taper)
@@ -169,46 +169,56 @@
     c.add_port("o1", port=straight1.ports["o1"])
     c.add_port("o2", port=straight2.ports["o2"])
 
     if layers_doping:
         sectionlist = ()
         for doping_layer in layers_doping:
             sectionlist += (Section(layer=doping_layer, width=heater_width, offset=0),)
-        heater_cross_section = gf.partial(
+        heater_cross_section = partial(
             gf.cross_section.cross_section,
             width=heater_width,
             layer="WG",
             sections=sectionlist,
         )
 
         heater = c << gf.c.straight(
             length=straight_length,
             cross_section=heater_cross_section,
         )
         heater.movey(spacing * (rows // 2))
 
     if layers_doping and via_stack:
-        via_stacke = via_stackw = gf.get_component(via_stack)
+        via = via_stacke = via_stackw = gf.get_component(via_stack)
         dx = via_stackw.get_ports_xsize() / 2 or 0
         via_stack_west_center = heater.size_info.cw + (dx, 0)
         via_stack_east_center = heater.size_info.ce - (dx, 0)
 
         via_stack_east_center = gf.snap.snap_to_grid(via_stack_east_center, nm=10)
         via_stack_west_center = gf.snap.snap_to_grid(via_stack_west_center, nm=10)
 
         via_stack_west = c << via_stackw
         via_stack_east = c << via_stacke
         via_stack_west.move(via_stack_west_center)
         via_stack_east.move(via_stack_east_center)
-        c.add_port(
-            "e1", port=via_stack_west.get_ports_list(orientation=port_orientation1)[0]
-        )
-        c.add_port(
-            "e2", port=via_stack_east.get_ports_list(orientation=port_orientation2)[0]
-        )
+
+        valid_orientations = {p.orientation for p in via.ports.values()}
+        p1 = via_stack_west.get_ports_list(orientation=port_orientation1)
+        p2 = via_stack_east.get_ports_list(orientation=port_orientation2)
+
+        if not p1:
+            raise ValueError(
+                f"No ports for port_orientation1 {port_orientation1} in {valid_orientations}"
+            )
+        if not p2:
+            raise ValueError(
+                f"No ports for port_orientation2 {port_orientation2} in {valid_orientations}"
+            )
+
+        c.add_ports(p1, prefix="l_")
+        c.add_ports(p2, prefix="r_")
     return c
 
 
 if __name__ == "__main__":
     # rows = 3
     # length = 300.0
     # spacing = 3
@@ -235,12 +245,12 @@
     # c.add_port("o2", port=straight_array.ports[f"o2_{rows}_1"])
 
     c = straight_heater_meander_doped(
         straight_widths=(0.5,) * 7,
         taper_length=10,
         # taper_length=10,
         length=1000,
-        # cross_section=gf.partial(gf.cross_section.strip, width=0.8),
+        # cross_section=partial(gf.cross_section.strip, width=0.8),
     )
     c.show(show_ports=True)
     # scene = c.to_3d()
     # scene.show()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_heater_metal.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_heater_metal.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
@@ -15,19 +15,19 @@
     length_undercut: float = 30.0,
     length_straight_input: float = 15.0,
     heater_width: float = 2.5,
     cross_section_heater: CrossSectionSpec = "heater_metal",
     cross_section_waveguide_heater: CrossSectionSpec = "strip_heater_metal",
     cross_section_heater_undercut: CrossSectionSpec = "strip_heater_metal_undercut",
     with_undercut: bool = True,
-    via_stack: Optional[ComponentSpec] = "via_stack_heater_mtop",
-    port_orientation1: int = 180,
-    port_orientation2: int = 0,
-    heater_taper_length: Optional[float] = 5.0,
-    ohms_per_square: Optional[float] = None,
+    via_stack: ComponentSpec | None = "via_stack_heater_mtop",
+    port_orientation1: int | None = None,
+    port_orientation2: int | None = None,
+    heater_taper_length: float | None = 5.0,
+    ohms_per_square: float | None = None,
     **kwargs,
 ) -> Component:
     """Returns a thermal phase shifter.
 
     dimensions from https://doi.org/10.1364/OE.27.010456
 
     Args:
@@ -91,29 +91,39 @@
         sequence=sequence, symbol_to_component=symbol_to_component
     )
     c.add_ref(sequence)
     c.add_ports(sequence.ports)
 
     if via_stack:
         refs = list(sequence.named_references.keys())
-        via_stackw = via_stacke = gf.get_component(via_stack)
+        via = via_stackw = via_stacke = gf.get_component(via_stack)
         via_stack_west_center = sequence.named_references[refs[0]].size_info.cw
         via_stack_east_center = sequence.named_references[refs[-1]].size_info.ce
         dx = via_stackw.get_ports_xsize() / 2 + heater_taper_length or 0
 
         via_stack_west = c << via_stackw
         via_stack_east = c << via_stacke
         via_stack_west.move(via_stack_west_center - (dx, 0))
         via_stack_east.move(via_stack_east_center + (dx, 0))
-        c.add_port(
-            "e1", port=via_stack_west.get_ports_list(orientation=port_orientation1)[0]
-        )
-        c.add_port(
-            "e2", port=via_stack_east.get_ports_list(orientation=port_orientation2)[0]
-        )
+
+        valid_orientations = {p.orientation for p in via.ports.values()}
+        p1 = via_stack_west.get_ports_list(orientation=port_orientation1)
+        p2 = via_stack_east.get_ports_list(orientation=port_orientation2)
+
+        if not p1:
+            raise ValueError(
+                f"No ports for port_orientation1 {port_orientation1} in {valid_orientations}"
+            )
+        if not p2:
+            raise ValueError(
+                f"No ports for port_orientation2 {port_orientation2} in {valid_orientations}"
+            )
+
+        c.add_ports(p1, prefix="l_")
+        c.add_ports(p2, prefix="r_")
         if heater_taper_length:
             x = gf.get_cross_section(cross_section_heater, width=heater_width)
             taper = gf.components.taper(
                 width1=via_stackw.ports["e1"].width,
                 width2=heater_width,
                 length=heater_taper_length,
                 cross_section=x,
@@ -125,40 +135,38 @@
 
     c.info["resistance"] = (
         ohms_per_square * heater_width * length if ohms_per_square else None
     )
     return c
 
 
-straight_heater_metal = gf.partial(
+straight_heater_metal = partial(
     straight_heater_metal_undercut,
     with_undercut=False,
 )
-straight_heater_metal_90_90 = gf.partial(
+straight_heater_metal_90_90 = partial(
     straight_heater_metal_undercut,
     with_undercut=False,
     port_orientation1=90,
     port_orientation2=90,
 )
-straight_heater_metal_undercut_90_90 = gf.partial(
+straight_heater_metal_undercut_90_90 = partial(
     straight_heater_metal_undercut,
     with_undercut=False,
     port_orientation1=90,
     port_orientation2=90,
 )
 
 
-def test_ports():
+def test_ports() -> None:
     c = straight_heater_metal(length=50.0)
     assert c.ports["o2"].center[0] == 50.0, c.ports["o2"].center[0]
-    return c
 
 
 if __name__ == "__main__":
-    # c = test_ports()
     # c = straight_heater_metal_undercut()
     # print(c.ports['o2'].center[0])
     # c.pprint_ports()
     # c = straight_heater_metal(heater_width=5, length=50.0)
 
     c = straight_heater_metal(length=40)
     # n = c.get_netlist()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_pin.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_pin.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 """Straight Doped PIN waveguide."""
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.taper import taper_strip_to_ridge
 from gdsfactory.components.via_stack import via_stack_slab_m3
 from gdsfactory.cross_section import pin, pn
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
@@ -14,15 +14,15 @@
 @gf.cell
 def straight_pin(
     length: float = 500.0,
     cross_section: CrossSectionSpec = pin,
     via_stack: ComponentSpec = via_stack_slab_m3,
     via_stack_width: float = 10.0,
     via_stack_spacing: float = 2,
-    taper: Optional[ComponentSpec] = taper_strip_to_ridge,
+    taper: ComponentSpec | None = taper_strip_to_ridge,
     **kwargs,
 ) -> Component:
     """Returns rib waveguide with doping and via_stacks used for PN and PIN modulators.
 
     For PIN:
     https://doi.org/10.1364/OE.26.029983
 
@@ -83,13 +83,13 @@
     via_stack_bot.ymax = -via_stack_spacing / 2
 
     c.add_ports(via_stack_bot.ports, prefix="bot_")
     c.add_ports(via_stack_top.ports, prefix="top_")
     return c
 
 
-straight_pn = gf.partial(straight_pin, cross_section=pn, length=2000)
+straight_pn = partial(straight_pin, cross_section=pn, length=2000)
 
 if __name__ == "__main__":
     c = straight_pin(length=40)
     # print(c.ports.keys())
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_pin_slot.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_pin_slot.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,34 +1,34 @@
 """Straight Doped PIN waveguide."""
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.taper import taper_strip_to_ridge
 from gdsfactory.components.via_stack import via_stack_m1_m3
 from gdsfactory.components.via_stack_slot import via_stack_slot_slab_m1
 from gdsfactory.cross_section import pin, pn
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def straight_pin_slot(
     length: float = 500.0,
     cross_section: CrossSectionSpec = pin,
-    via_stack: Optional[ComponentSpec] = via_stack_m1_m3,
+    via_stack: ComponentSpec | None = via_stack_m1_m3,
     via_stack_width: float = 10.0,
-    via_stack_slab: Optional[ComponentSpec] = via_stack_slot_slab_m1,
-    via_stack_slab_top: Optional[ComponentSpec] = None,
-    via_stack_slab_bot: Optional[ComponentSpec] = None,
-    via_stack_slab_width: Optional[float] = None,
+    via_stack_slab: ComponentSpec | None = via_stack_slot_slab_m1,
+    via_stack_slab_top: ComponentSpec | None = None,
+    via_stack_slab_bot: ComponentSpec | None = None,
+    via_stack_slab_width: float | None = None,
     via_stack_spacing: float = 3.0,
     via_stack_slab_spacing: float = 2.0,
-    taper: Optional[ComponentSpec] = taper_strip_to_ridge,
+    taper: ComponentSpec | None = taper_strip_to_ridge,
     **kwargs,
 ) -> Component:
     """Returns a PIN straight waveguide with slotted via.
 
     https://doi.org/10.1364/OE.26.029983
 
     500um length for PI phase shift
@@ -110,12 +110,12 @@
         )
         slot_bot.x = wg.x
         slot_bot.ymax = -via_stack_slab_spacing / 2
 
     return c
 
 
-straight_pn_slot = gf.partial(straight_pin_slot, cross_section=pn)
+straight_pn_slot = partial(straight_pin_slot, cross_section=pn)
 
 if __name__ == "__main__":
     c = straight_pin_slot(via_stack_width=4, via_stack_slab_width=3, length=50)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/straight_rib.py` & `gdsfactory-7.0.0/gdsfactory/components/straight_rib.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,21 +1,22 @@
 """Straight Doped PIN waveguide."""
 
 from __future__ import annotations
 
-import gdsfactory as gf
+from functools import partial
+
 from gdsfactory.components.extension import extend_ports
 from gdsfactory.components.straight import straight
 from gdsfactory.components.taper import taper_strip_to_ridge
 from gdsfactory.cross_section import rib
 
-straight_rib = gf.partial(straight, cross_section=rib)
+straight_rib = partial(straight, cross_section=rib)
 
 
-straight_rib_tapered = gf.partial(
+straight_rib_tapered = partial(
     extend_ports,
     component=straight_rib,
     extension=taper_strip_to_ridge,
     port1="o2",
     port2="o1",
 )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/taper.py` & `gdsfactory-7.0.0/gdsfactory/components/taper.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 from __future__ import annotations
 
-from typing import List, Optional
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.add_padding import get_padding_points
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.port import Port
 from gdsfactory.typings import CrossSectionSpec, LayerSpec
 
 
 @cell
 def taper(
     length: float = 10.0,
     width1: float = 0.5,
-    width2: Optional[float] = None,
-    port: Optional[Port] = None,
+    width2: float | None = None,
+    port: Port | None = None,
     with_bbox: bool = True,
     with_two_ports: bool = True,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Linear taper.
 
@@ -40,26 +40,31 @@
     layer = x.layer
 
     if isinstance(port, gf.Port) and width1 is None:
         width1 = port.width
     if width2 is None:
         width2 = width1
 
+    c = gf.Component()
+
     y1 = width1 / 2
     y2 = width2 / 2
-
     x1 = x.copy(width=width1)
     x2 = x.copy(width=width2)
-
     xpts = [0, length, length, 0]
     ypts = [y1, y2, -y2, -y1]
-
-    c = gf.Component()
     c.add_polygon((xpts, ypts), layer=layer)
 
+    for section in x.sections:
+        layer = section.layer
+        y1 = section.width / 2
+        y2 = y1 + (width2 - width1)
+        ypts = [y1, y2, -y2, -y1]
+        c.add_polygon((xpts, ypts), layer=layer)
+
     if x.cladding_layers and x.cladding_offsets:
         for layer, offset in zip(x.cladding_layers, x.cladding_offsets):
             y1 = width1 / 2 + offset
             y2 = width2 / 2 + offset
             ypts = [y1, y2, -y2, -y1]
             c.add_polygon((xpts, ypts), layer=gf.get_layer(layer))
 
@@ -112,16 +117,16 @@
     width1: float = 0.5,
     width2: float = 0.5,
     w_slab1: float = 0.15,
     w_slab2: float = 6.0,
     layer_wg: LayerSpec = "WG",
     layer_slab: LayerSpec = "SLAB90",
     cross_section: CrossSectionSpec = "strip",
-    bbox_layers: Optional[List[LayerSpec]] = None,
-    bbox_offsets: Optional[List[float]] = None,
+    bbox_layers: list[LayerSpec] | None = None,
+    bbox_offsets: list[float] | None = None,
 ) -> Component:
     r"""Linear taper from strip to rib.
 
     Deprecated, use gf.components.taper_cross_section instead.
 
     Args:
         length: taper length (um).
@@ -238,18 +243,18 @@
     c.add_port(name="o1", center=(0, 0), width=width, orientation=180, layer=layer_wg)
     c.add_port(
         name="o2", center=(length, 0), width=width, orientation=0, layer=layer_wg
     )
     return c
 
 
-taper_strip_to_slab150 = gf.partial(taper_strip_to_ridge, layer_slab="SLAB150")
+taper_strip_to_slab150 = partial(taper_strip_to_ridge, layer_slab="SLAB150")
 
 # taper StripCband to NitrideCband
-taper_sc_nc = gf.partial(
+taper_sc_nc = partial(
     taper_strip_to_ridge,
     layer_wg="WG",
     layer_slab="WGN",
     length=20.0,
     width1=0.5,
     width2=0.15,
     w_slab1=0.15,
@@ -262,17 +267,18 @@
     #     [
     #         taper_sc_nc(
     #             length=length, info=dict(doe="taper_length", taper_length=length)
     #         )
     #         for length in [1, 2, 3]
     #     ]
     # )
-    # c.write_gds_with_metadata("extra/tapers.gds")
+    # c.("extra/tapers.gds")
+    xs = gf.get_cross_section("rib_conformal")
 
-    c = taper(width2=1)
+    c = taper(width2=1, cross_section="rib_conformal")
     # c = taper_strip_to_ridge()
     # print(c.get_optical_ports())
     # c = taper_strip_to_ridge_trenches()
     # c = taper()
     # c = gf.components.taper_strip_to_ridge(width1=1, width2=2)
     # c = gf.components.taper_strip_to_ridge(width1=1, width2=2)
     # c = gf.components.extend_ports(c)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/taper_adiabatic.py` & `gdsfactory-7.0.0/gdsfactory/components/taper_adiabatic.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Callable
+from collections.abc import Callable
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.path import transition_adiabatic
 from gdsfactory.typings import CrossSectionSpec
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/taper_cross_section.py` & `gdsfactory-7.0.0/gdsfactory/components/taper_cross_section.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,14 +1,16 @@
 from __future__ import annotations
+
 from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.cross_section import rib_conformal, strip_rib_tip
+from gdsfactory.route_info import route_info
 from gdsfactory.typings import CrossSectionSpec
 
 
 @cell
 def taper_cross_section(
     cross_section1: CrossSectionSpec = strip_rib_tip,
     cross_section2: CrossSectionSpec = rib_conformal,
@@ -39,25 +41,29 @@
        cross_section1  |        cross_section2
                   ______\_______________________
                          \
                           \_____________________
 
 
     """
+    x1 = gf.get_cross_section(cross_section1)
+    x2 = gf.get_cross_section(cross_section2, **kwargs)
     transition = gf.path.transition(
-        cross_section1=gf.get_cross_section(cross_section1),
-        cross_section2=gf.get_cross_section(cross_section2, **kwargs),
+        cross_section1=x1,
+        cross_section2=x2,
         width_type="linear" if linear else width_type,
     )
     taper_path = gf.path.straight(length=length, npoints=npoints)
 
     c = gf.Component()
     ref = c << gf.path.extrude(taper_path, cross_section=transition)
     c.add_ports(ref.ports)
     c.absorb(ref)
+    if "type" in x1.info and x1.info["type"] == x2.info.get("type"):
+        c.info["route_info"] = route_info(x1.info["type"], length=length, taper=True)
     return c
 
 
 taper_cross_section_linear = partial(taper_cross_section, linear=True, npoints=2)
 taper_cross_section_sine = partial(taper_cross_section, linear=False, npoints=101)
 taper_cross_section_parabolic = partial(
     taper_cross_section, linear=False, width_type="parabolic", npoints=101
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/taper_from_csv.py` & `gdsfactory-7.0.0/gdsfactory/components/taper_from_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/taper_parabolic.py` & `gdsfactory-7.0.0/gdsfactory/components/taper_parabolic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/terminator.py` & `gdsfactory-7.0.0/gdsfactory/components/terminator.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,34 +1,36 @@
 from __future__ import annotations
 
-from typing import Optional
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.taper_cross_section import taper_cross_section
 from gdsfactory.typings import CrossSectionSpec, LayerSpecs
 
 
 @gf.cell
 def terminator(
-    length: Optional[float] = 50,
+    length: float | None = 50,
     cross_section_input: CrossSectionSpec = "strip",
-    cross_section_tip: Optional[CrossSectionSpec] = None,
+    cross_section_tip: CrossSectionSpec | None = None,
     tapered_width: float = 0.2,
     doping_layers: LayerSpecs = ("NPP",),
+    doping_offset: float = 1,
 ) -> gf.Component:
     """Returns doped taper to terminate waveguides.
 
     Args:
         length: distance between input and narrow tapered end.
         cross_section_input: input cross-section.
         cross_section_tip: cross-section at the end of the termination.
         tapered_width: width of the default cross-section at the end of the termination.
             Only used if cross_section_tip is not None.
         doping_layers: doping layers to superimpose on the taper. Default N++.
+        doping_offset: offset of the doping layer beyond the bbox
     """
     c = Component()
 
     cross_section_tip = cross_section_tip or gf.get_cross_section(
         cross_section_input, width=tapered_width
     )
 
@@ -36,16 +38,18 @@
         taper_cross_section,
         length=length,
         cross_section1=cross_section_input,
         cross_section2=cross_section_tip,
     )
 
     for layer in doping_layers:
-        c << gf.components.bbox(bbox=taper.bbox, layer=layer)
+        c << gf.components.bbox(
+            bbox=taper.bbox, layer=layer, top=doping_offset, bottom=doping_offset
+        )
 
     c.add_port(name="o1", port=taper.ports["o1"])
     return c
 
 
 if __name__ == "__main__":
-    c = terminator(cross_section_input=gf.partial(gf.cross_section.strip, width=10))
+    c = terminator(cross_section_input=partial(gf.cross_section.strip, width=10))
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/text.py` & `gdsfactory-7.0.0/gdsfactory/components/text.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.text_rectangular import text_rectangular
 from gdsfactory.constants import _glyph, _indent, _width
 from gdsfactory.typings import Coordinate, LayerSpec
@@ -64,15 +62,15 @@
                 f"justify = {justify!r} not in ('center', 'right', 'left')"
             )
     return t
 
 
 @gf.cell
 def text_lines(
-    text: Tuple[str, ...] = ("Chip", "01"),
+    text: tuple[str, ...] = ("Chip", "01"),
     size: float = 0.4,
     layer: LayerSpec = "WG",
 ) -> Component:
     """Returns a Component from a text lines.
 
     Args:
         text: list of strings.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/text_freetype.py` & `gdsfactory-7.0.0/gdsfactory/components/text_freetype.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/text_rectangular.py` & `gdsfactory-7.0.0/gdsfactory/components/text_rectangular.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,23 +1,24 @@
 from __future__ import annotations
 
-from typing import Callable, Tuple
+from collections.abc import Callable
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.copy_layers import copy_layers
 from gdsfactory.components.text_rectangular_font import pixel_array, rectangular_font
 from gdsfactory.typings import ComponentSpec, LayerSpec, LayerSpecs
 
 
 @gf.cell
 def text_rectangular(
     text: str = "abcd",
     size: float = 10.0,
-    position: Tuple[float, float] = (0.0, 0.0),
+    position: tuple[float, float] = (0.0, 0.0),
     justify: str = "left",
     layer: LayerSpec = "WG",
     font: Callable = rectangular_font,
 ) -> Component:
     """Pixel based font, guaranteed to be manhattan, without acute angles.
 
     Args:
@@ -80,17 +81,17 @@
 
     Keyword Args:
         size: pixel size
         position: coordinate
         justify: left, right or center
         font: function that returns dictionary of characters
     """
-    func = gf.partial(
+    func = partial(
         copy_layers,
-        factory=gf.partial(text_factory, text=text, **kwargs),
+        factory=partial(text_factory, text=text, **kwargs),
         layers=layers,
     )
     return func()
 
 
 if __name__ == "__main__":
     import string
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/text_rectangular_font.py` & `gdsfactory-7.0.0/gdsfactory/components/text_rectangular_font.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
-from functools import lru_cache
-from typing import Dict
+from functools import cache
 
 import numpy as np
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
@@ -296,16 +295,16 @@
 0	0	0	0	0
 0	0	0	0	0
 0	0	0	0	0
 0	0	0	0	0
 """
 
 
-@lru_cache(maxsize=None)
-def rectangular_font() -> Dict[str, str]:
+@cache
+def rectangular_font() -> dict[str, str]:
     """Returns a rectangular font dict The keys of the dictionary are the.
 
     characters The values are the pixel representation of the character.
     """
     characters = {}
     lines = FONT.split("\n")
     while lines:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/triangles.py` & `gdsfactory-7.0.0/gdsfactory/components/triangles.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/verniers.py` & `gdsfactory-7.0.0/gdsfactory/components/verniers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/via.py` & `gdsfactory-7.0.0/gdsfactory/components/via.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 from __future__ import annotations
 
-from typing import Optional, Tuple
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
 def via(
-    size: Tuple[float, float] = (0.7, 0.7),
-    spacing: Optional[Tuple[float, float]] = (2.0, 2.0),
-    gap: Optional[Tuple[float, float]] = None,
+    size: tuple[float, float] = (0.7, 0.7),
+    spacing: tuple[float, float] | None = (2.0, 2.0),
+    gap: tuple[float, float] | None = None,
     enclosure: float = 1.0,
     layer: LayerSpec = "VIAC",
-    bbox_layers: Optional[Tuple[Tuple[int, int], ...]] = None,
+    bbox_layers: tuple[tuple[int, int], ...] | None = None,
     bbox_offset: float = 0,
 ) -> Component:
     """Rectangular via.
 
     Defaults to a square via.
 
     Args:
@@ -67,17 +67,17 @@
     b = (height + bbox_offset) / 2
     for layer in bbox_layers:
         c.add_polygon([(-a, -b), (a, -b), (a, b), (-a, b)], layer=layer)
 
     return c
 
 
-viac = gf.partial(via, layer="VIAC")
-via1 = gf.partial(via, layer="VIA1", enclosure=2)
-via2 = gf.partial(via, layer="VIA2")
+viac = partial(via, layer="VIAC")
+via1 = partial(via, layer="VIA1", enclosure=2)
+via2 = partial(via, layer="VIA2")
 
 
 if __name__ == "__main__":
     c = via()
     # c.pprint()
     print(c)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/via_corner.py` & `gdsfactory-7.0.0/gdsfactory/components/via_corner.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 from numpy import floor
 
 import gdsfactory as gf
 from gdsfactory.components.compass import compass
 from gdsfactory.components.via import via1
 from gdsfactory.cross_section import metal2, metal3
 from gdsfactory.port import select_ports
@@ -14,16 +12,16 @@
 
 @gf.cell
 def via_corner(
     cross_section: MultiCrossSectionAngleSpec = (
         (metal2, (0, 180)),
         (metal3, (90, 270)),
     ),
-    vias: Tuple[ComponentSpec] = (via1,),
-    layers_labels: Tuple[str, ...] = ("m2", "m3"),
+    vias: tuple[ComponentSpec] = (via1,),
+    layers_labels: tuple[str, ...] = ("m2", "m3"),
     **kwargs,
 ) -> gf.Component:
     """Returns Corner via.
 
     Use in place of wire_corner to route between two layers.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/via_cutback.py` & `gdsfactory-7.0.0/gdsfactory/components/via_cutback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/components/via_stack.py` & `gdsfactory-7.0.0/gdsfactory/components/via_stack.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 from __future__ import annotations
 
 import warnings
-from typing import Optional, Tuple
+from functools import partial
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.compass import compass
 from gdsfactory.components.via import via1, via2, viac
-from gdsfactory.typings import ComponentSpec, LayerSpec, LayerSpecs, Float2, Floats
+from gdsfactory.typings import ComponentSpec, Float2, Floats, LayerSpec, LayerSpecs
 
 
 @gf.cell
 def via_stack(
     size=(11.0, 11.0),
     layers: LayerSpecs = ("M1", "M2", "M3"),
-    layer_offsets: Optional[Floats] = None,
-    vias: Optional[Tuple[Optional[ComponentSpec], ...]] = (via1, via2, None),
-    layer_port: Optional[LayerSpec] = None,
+    layer_offsets: Floats | None = None,
+    vias: tuple[ComponentSpec | None, ...] | None = (via1, via2, None),
+    layer_port: LayerSpec | None = None,
     correct_size: bool = True,
 ) -> Component:
     """Rectangular via array stack.
 
     You can use it to connect different metal layers or metals to silicon.
     You can use the naming convention via_stack_layerSource_layerDestination
     contains 4 ports (e1, e2, e3, e4)
@@ -67,15 +67,15 @@
 
     for layer, offset in zip(layers, layer_offsets):
         size_m = (width_m + 2 * offset, height_m + 2 * offset)
         if layer == layer_port:
             ref = c << compass(size=size_m, layer=layer, port_type="electrical")
             c.add_ports(ref.ports)
         else:
-            ref = c << compass(size=size_m, layer=layer, port_type="placement")
+            ref = c << compass(size=size_m, layer=layer, port_type="electrical")
 
     vias = vias or []
     for via, offset in zip(vias, layer_offsets):
         if via is not None:
             width, height = size
             width += 2 * offset
             height += 2 * offset
@@ -132,16 +132,16 @@
 @gf.cell
 def via_stack_circular(
     radius: float = 10.0,
     angular_extent: float = 45,
     center_angle: float = 0,
     width: float = 5.0,
     layers: LayerSpecs = ("M1", "M2", "M3"),
-    vias: Tuple[Optional[ComponentSpec], ...] = (via1, via2),
-    layer_port: Optional[LayerSpec] = None,
+    vias: tuple[ComponentSpec | None, ...] = (via1, via2),
+    layer_port: LayerSpec | None = None,
 ) -> Component:
     """Circular via array stack.
 
     FIXME! does not work.
 
     Constructs a circular via array stack. It does so
     by stacking rectangular via stacks offset by a small amount
@@ -273,20 +273,20 @@
             return angle < angle2
 
 
 @gf.cell
 def via_stack_from_rules(
     size: Float2 = (1.2, 1.2),
     layers: LayerSpecs = ("M1", "M2", "M3"),
-    layer_offsets: Optional[Tuple[float, ...]] = None,
-    vias: Optional[Tuple[Optional[ComponentSpec], ...]] = (via1, via2),
-    via_min_size: Tuple[Float2, ...] = ((0.2, 0.2), (0.2, 0.2)),
-    via_min_gap: Tuple[Float2, ...] = ((0.1, 0.1), (0.1, 0.1)),
+    layer_offsets: tuple[float, ...] | None = None,
+    vias: tuple[ComponentSpec | None, ...] | None = (via1, via2),
+    via_min_size: tuple[Float2, ...] = ((0.2, 0.2), (0.2, 0.2)),
+    via_min_gap: tuple[Float2, ...] = ((0.1, 0.1), (0.1, 0.1)),
     via_min_enclosure: Float2 = (0.15, 0.25),
-    layer_port: Optional[LayerSpec] = None,
+    layer_port: LayerSpec | None = None,
 ) -> Component:
     """Rectangular via array stack, with optimized dimension for vias.
 
     Uses inclusion, minimum width, and minimum spacing rules to place the maximum number of individual vias,
     each with maximum via area.
 
     Args:
@@ -318,15 +318,15 @@
 
     for layer, offset in zip(layers, layer_offsets):
         size = (width + 2 * offset, height + 2 * offset)
         if layer == layer_port:
             ref = c << compass(size=size, layer=layer, port_type="electrical")
             c.add_ports(ref.ports)
         else:
-            ref = c << compass(size=size, layer=layer, port_type="placement")
+            ref = c << compass(size=size, layer=layer, port_type="electrical")
 
     vias = vias or []
     c.info["vias"] = []
     for current_via, min_size, min_gap, min_enclosure in zip(
         vias, via_min_size, via_min_gap, via_min_enclosure
     ):
         if current_via is not None:
@@ -356,17 +356,17 @@
             ref.move((x0, y0))
 
     return c
 
 
 def optimized_via(
     base_via: ComponentSpec = "VIAC",
-    size: Tuple[float, float] = (11.0, 11.0),
-    min_via_size: Tuple[float, float] = (0.3, 0.3),
-    min_via_gap: Tuple[float, float] = (0.1, 0.1),
+    size: tuple[float, float] = (11.0, 11.0),
+    min_via_size: tuple[float, float] = (0.3, 0.3),
+    min_via_gap: tuple[float, float] = (0.1, 0.1),
     min_via_enclosure: float = 0.2,
 ) -> Component:
     """Given a target total inclusion size, returns an optimized dimension for the via.
 
     Uses inclusion, minimum width, and minimum spacing rules to place the maximum number of individual vias, with maximum via area.
 
     Arguments:
@@ -383,15 +383,15 @@
         try:
             via_size[dim] = float(via_area / num_vias) - min_via_gap[dim]
         except ZeroDivisionError as e:
             raise RuntimeError(
                 "Cannot fit vias with specified minimum dimensions in provided space."
             ) from e
 
-    return gf.partial(
+    return partial(
         base_via,
         size=via_size,
         gap=min_via_gap,
         spacing=None,
         enclosure=min_via_enclosure,
     )
 
@@ -420,47 +420,62 @@
     assert c.info["vias"][0]["size"][1] > via_min_size[0][1]
     assert (
         c.info["vias"][0]["spacing"][0]
         == via_min_gap[0][0] + c.info["vias"][0]["size"][0]
     )
 
 
-via_stack_m1_m3 = gf.partial(
+via_stack_m1_m3 = partial(
     via_stack,
     layers=("M1", "M2", "M3"),
     vias=(via1, via2, None),
 )
 
-via_stack_slab_m3 = gf.partial(
+via_stack_slab_m3 = partial(
     via_stack,
     layers=("SLAB90", "M1", "M2", "M3"),
     vias=(viac, via1, via2, None),
 )
-via_stack_slab_m2 = gf.partial(
+via_stack_slab_m2 = partial(
     via_stack,
     layers=("SLAB90", "M1", "M2"),
     vias=(viac, via1, None),
 )
-via_stack_npp_m1 = gf.partial(
+via_stack_npp_m1 = partial(
     via_stack,
     layers=("WG", "NPP", "M1"),
     vias=(None, None, viac),
 )
-via_stack_slab_npp_m3 = gf.partial(
+via_stack_slab_npp_m3 = partial(
     via_stack,
     layers=("SLAB90", "NPP", "M1"),
     vias=(None, None, viac),
 )
-via_stack_heater_mtop = via_stack_heater_m3 = gf.partial(
-    via_stack, layers=("HEATER", "M2", "M3"), vias=(via1, via2)
+via_stack_heater_mtop = via_stack_heater_m3 = partial(
+    via_stack, layers=("HEATER", "M2", "M3"), vias=(None, via1, via2)
 )
 
 
 if __name__ == "__main__":
-    c = via_stack_slab_m3()
+    c = via_stack()
+    c.show()
+    # c = gf.pack([via_stack_slab_m3, via_stack_heater_mtop])[0]
+
+    # c = gf.Component("offgrid_demo")
+    # v1 = c << via_stack_slab_m3()
+    # v2 = c << via_stack_slab_m3()
+    # v2.x = 20.0005
+    # c.show()
+
+    # c2 = gf.Component()
+    # c21 = c2 << c
+    # c22 = c2 << c
+    # c22.x = 20.0005 + 30
+    # c2.show()
+
     # c = via_stack_heater_mtop(layer_offsets=(0, 1, 2))
     # c = via_stack_circular()
     # c = via_stack_m1_m3(size=(4.5, 4.5))
     # print(c.to_dict())
     # c.show(show_ports=True)
 
     # c = via_stack_from_rules()
@@ -471,8 +486,8 @@
     #     angular_extent=300,
     #     center_angle=0,
     #     width=5.0,
     #     layers=("M1", "M2", "M3"),
     #     vias=(via1, via2),
     #     layer_port=None,
     # )
-    c.show(show_ports=True)
+    # c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/via_stack_slot.py` & `gdsfactory-7.0.0/gdsfactory/components/via_stack_slot.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,29 +1,29 @@
 from __future__ import annotations
 
 import warnings
-from typing import Optional
+from functools import partial
 
 from numpy import floor
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.compass import compass
 from gdsfactory.components.via import via1, viac
 from gdsfactory.typings import ComponentSpec, Floats, LayerSpec, LayerSpecs
 
 
 @gf.cell
 def via_stack_slot(
     size=(11.0, 11.0),
     layers: LayerSpecs = ("M1", "M2"),
-    layer_offsets: Optional[Floats] = (0, 1.0),
-    layer_offsetsx: Optional[Floats] = None,
-    layer_offsetsy: Optional[Floats] = None,
-    layer_port: Optional[LayerSpec] = None,
+    layer_offsets: Floats | None = (0, 1.0),
+    layer_offsetsx: Floats | None = None,
+    layer_offsetsy: Floats | None = None,
+    layer_port: LayerSpec | None = None,
     via: ComponentSpec = via1,
     enclosure: float = 1.0,
     ysize: float = 0.5,
     yspacing: float = 2.0,
 ) -> Component:
     """Rectangular via_stack with slotted via in X direction.
 
@@ -92,15 +92,17 @@
     if len(elements) > 1:
         warnings.warn(
             f"Got {len(layers)} layers, {len(layer_offsetsx)} layer_offsetsx, {len(layer_offsetsy)} layer_offsetsy."
         )
 
     for layer, offsetx, offsety in zip(layers, layer_offsetsx, layer_offsetsy):
         ref = c << compass(
-            size=(size[0] + 2 * offsetx, size[1] + 2 * offsety), layer=layer
+            size=(size[0] + 2 * offsetx, size[1] + 2 * offsety),
+            layer=layer,
+            port_type="electrical",
         )
 
         if layer == layer_port:
             c.add_ports(ref.ports)
 
     via = gf.get_component(via, size=(size[0] - 2 * enclosure, ysize))
 
@@ -108,17 +110,20 @@
     nb_vias_y = int(floor(nb_vias_y)) or 1
     ref = c.add_array(via, columns=1, rows=nb_vias_y, spacing=(0, yspacing))
     dy = (size[1] - (nb_vias_y - 1) * yspacing - size[1]) / 2
     ref.move((0, dy))
     return c
 
 
-via_stack_slot_m1_m2 = gf.partial(via_stack_slot, layers=("M1", "M2"), via=via1)
+via_stack_slot_m1_m2 = partial(via_stack_slot, layers=("M1", "M2"), via=via1)
 
-via_stack_slot_slab_m1 = gf.partial(via_stack_slot, layers=("M1",), via=viac)
+via_stack_slot_slab_m1 = partial(
+    via_stack_slot, layers=("M1",), via=viac, layer_offsets=(0,)
+)
 
 
 if __name__ == "__main__":
+    c = via_stack_slot()
     # c = via_stack_slot_m1_m2(layer_offsets=(0.5, 1), enclosure=1, size=(3, 3))
     # c = via_stack_slot_m1_m2()
-    c = via_stack_slot_slab_m1()
+    # c = via_stack_slot_slab_m1()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/via_stack_with_offset.py` & `gdsfactory-7.0.0/gdsfactory/components/via_stack_with_offset.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,29 +1,29 @@
 from __future__ import annotations
-import warnings
 
-from typing import Optional, Tuple
+import warnings
+from functools import partial
 
 from numpy import floor
 
 import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.components.via import viac
 from gdsfactory.components.compass import compass
-from gdsfactory.typings import ComponentSpec, LayerSpecs, Float2, Floats
+from gdsfactory.components.via import viac
+from gdsfactory.typings import ComponentSpec, Float2, Floats, LayerSpecs
 
 
 @gf.cell
 def via_stack_with_offset(
     layers: LayerSpecs = ("PPP", "M1"),
     size: Float2 = (10, 10),
-    sizes: Optional[Tuple[Float2, ...]] = None,
-    layer_offsets: Optional[Floats] = None,
-    vias: Tuple[Optional[ComponentSpec], ...] = (None, viac),
-    offsets: Optional[Tuple[float, ...]] = None,
+    sizes: tuple[Float2, ...] | None = None,
+    layer_offsets: Floats | None = None,
+    vias: tuple[ComponentSpec | None, ...] = (None, viac),
+    offsets: tuple[float, ...] | None = None,
 ) -> Component:
     """Rectangular layer transition with offset between layers.
 
     Args:
         layers: layer specs between vias.
         size: for all vias array.
         sizes: Optional size for each via array. Overrides size.
@@ -125,27 +125,27 @@
         y0 += offset
         previous_layer = layer
 
     c.add_ports(ref_layer.ports)
     return c
 
 
-via_stack_with_offset_ppp_m1 = gf.partial(
+via_stack_with_offset_ppp_m1 = partial(
     via_stack_with_offset,
     layers=("PPP", "M1"),
     vias=(None, viac),
 )
 
-via_stack_with_offset_ppp_m1 = gf.partial(
+via_stack_with_offset_ppp_m1 = partial(
     via_stack_with_offset,
     layers=("PPP", "M1"),
     vias=(None, viac),
 )
 
-via_stack_with_offset_m1_m3 = gf.partial(
+via_stack_with_offset_m1_m3 = partial(
     via_stack_with_offset,
     layers=("M1", "M2", "M3"),
     vias=(None, "via1", "via2"),
 )
 
 
 if __name__ == "__main__":
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/wafer.py` & `gdsfactory-7.0.0/gdsfactory/components/wafer.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,21 +1,21 @@
 from __future__ import annotations
 
 import gdsfactory as gf
-from gdsfactory.typings import Component, ComponentSpec, Optional, Tuple
+from gdsfactory.typings import Component, ComponentSpec
 
 _cols_200mm_wafer = (2, 6, 6, 8, 8, 6, 6, 2)
 
 
 @gf.cell
 def wafer(
     reticle: ComponentSpec = "die",
-    cols: Tuple[int, ...] = _cols_200mm_wafer,
-    xspacing: Optional[float] = None,
-    yspacing: Optional[float] = None,
+    cols: tuple[int, ...] = _cols_200mm_wafer,
+    xspacing: float | None = None,
+    yspacing: float | None = None,
 ) -> Component:
     """Returns complete wafer. Useful for mask aligner steps.
 
     Args:
         reticle: spec for each wafer reticle.
         cols: how many columns per row.
         xspacing: optional spacing, defaults to reticle.xsize.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/components/wire_sbend.py` & `gdsfactory-7.0.0/gdsfactory/components/wire_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/config.py` & `gdsfactory-7.0.0/gdsfactory/config.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,45 +1,40 @@
-"""Gdsfactory loads configuration from 3 files, high priority overwrites low.
-
-priority:
-
-1. A config.yml found in the current working directory (highest priority)
-2. ~/.gdsfactory/config.yml specific for the machine
-3. the yamlpath_default in gdsfactory.technology.yml (lowest priority)
-
-You can access the CONF dictionary with `print_config`
-
-PATH has all your computer specific paths that we do not care to store
+"""Gdsfactory loads configuration pydantic.
 
+You can set environment variables.
 """
 
 from __future__ import annotations
 
-import warnings
-import sys
-import io
+import importlib
 import json
 import os
 import pathlib
+import re
 import subprocess
+import sys
 import tempfile
+import traceback
+import warnings
+from itertools import takewhile
 from pathlib import Path
 from pprint import pprint
-from typing import Any, Iterable, Optional, Union
-import importlib
-
-from loguru import logger
-import omegaconf
-from omegaconf import OmegaConf
+from typing import TYPE_CHECKING, Any, ClassVar, Literal
 
+import loguru
+from loguru import logger as logger
+from pydantic import BaseModel, BaseSettings, Field
 from rich.console import Console
 from rich.table import Table
 
-__version__ = "6.99.0"
-PathType = Union[str, pathlib.Path]
+if TYPE_CHECKING:
+    from loguru import Logger
+
+__version__ = "7.0.0"
+PathType = str | pathlib.Path
 
 home = pathlib.Path.home()
 cwd = pathlib.Path.cwd()
 module_path = pathlib.Path(__file__).parent.absolute()
 repo_path = module_path.parent
 home_path = pathlib.Path.home() / ".gdsfactory"
 diff_path = repo_path / "gds_diff"
@@ -126,21 +121,100 @@
         except ImportError:
             table.add_row(pdk, "not installed", "")
 
     console = Console()
     console.print(table)
 
 
-default_config = io.StringIO(
+def get_number_of_cores() -> int:
+    """Get number of cores/threads available.
+
+    On (most) linux we can get it through the scheduling affinity. Otherwise,
+    fall back to the multiprocessing cpu count.
     """
-plotter: matplotlib
-sparameters_path: ${oc.env:HOME}/.gdsfactory/sparameters/generic
-show_ports: True
-"""
-)
+    try:
+        threads = len(os.sched_getaffinity(0))
+    except AttributeError:
+        import multiprocessing
+
+        threads = multiprocessing.cpu_count()
+    return threads
+
+
+def tracing_formatter(record: loguru.Record) -> str:
+    """Traceback filtering.
+
+    Filter out frames coming from Loguru internals.
+    """
+    frames = takewhile(
+        lambda f: "/loguru/" not in f.filename, traceback.extract_stack()
+    )
+    stack = " > ".join(f"{f.filename}:{f.name}:{f.lineno}" for f in frames)
+    record["extra"]["stack"] = stack
+
+    if record["extra"].get("with_backtrace", False):
+        return (
+            "<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | <level>{level: <8}</level>"
+            " | <cyan>{extra[stack]}</cyan> - <level>{message}</level>\n{exception}"
+        )
+
+    else:
+        return (
+            "<green>{time:YYYY-MM-DD HH:mm:ss.SSS}</green> | <level>{level: <8}"
+            "</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan>"
+            " - <level>{message}</level>\n{exception}"
+        )
+
+
+class LogFilter(BaseModel):
+    """Filter certain messages by log level or regex.
+
+    Filtered messages are not evaluated and discarded.
+    """
+
+    level: Literal[
+        "TRACE", "DEBUG", "INFO", "SUCCESS", "WARNING", "ERROR", "CRITICAL"
+    ] = "INFO"
+    regex: str | None = None
+
+    def __call__(self, record: loguru.Record) -> bool:
+        """Loguru needs the filter to be callable."""
+        levelno = logger.level(self.level).no
+        if self.regex is None:
+            return record["level"].no >= levelno
+        else:
+            return record["level"].no >= levelno and not bool(
+                re.search(self.regex, record["message"])
+            )
+
+
+class Settings(BaseSettings):
+    """GDSFACTORY settings object."""
+
+    n_threads: int = get_number_of_cores()
+    logger: ClassVar[Logger] = logger
+    logfilter: LogFilter = Field(default_factory=LogFilter)
+    display_type: Literal["widget", "klayout", "docs", "kweb"] = "kweb"
+    last_saved_files: list[PathType] = []
+
+    def __init__(self, **data: Any):
+        """Set log filter and run pydantic."""
+        super().__init__(**data)
+        self.logger.remove()
+        self.logger.add(sys.stdout, format=tracing_formatter, filter=self.logfilter)
+        self.logger.info("LogLevel: {}", self.logfilter.level)
+
+    class Config:
+        """Pydantic settings."""
+
+        validation = True
+        arbitrary_types_allowed = True
+        fields = {"logger": {"exclude": True}}
+        env_prefix = "gdsfactory_"
+        env_nested_delimiter = "_"
 
 
 def set_log_level(level: str, sink=sys.stderr) -> None:
     """Sets log level for gdsfactory.
 
     Args:
         level: ["DEBUG", "INFO", "WARNING", "ERROR"]
@@ -166,38 +240,25 @@
     netlists = module_path / "samples" / "netlists"
     gdsdir = repo_path / "tests" / "gds"
     gdslib = home / ".gdsfactory"
     modes = gdslib / "modes"
     sparameters = gdslib / "sp"
     interconnect = gdslib / "interconnect"
     optimiser = repo_path / "tune"
-    notebooks = repo_path / "docs" / "notebooks"
+    notebooks = module_path / "samples" / "notebooks"
     plugins = module / "plugins"
-    web = plugins / "web"
     test_data = repo / "test-data"
     gds_ref = test_data / "gds"
     gds_run = GDSDIR_TEMP / "gds_run"
     gds_diff = GDSDIR_TEMP / "gds_diff"
     cwd = cwd
+    sparameters_repo = test_data / "sp"
 
 
-def read_config(
-    yamlpaths: Iterable[PathType] = (yamlpath_default, yamlpath_home, yamlpath_cwd),
-) -> omegaconf.DictConfig:
-    config = OmegaConf.load(default_config)
-    for yamlpath in set(yamlpaths):
-        yamlpath = pathlib.Path(yamlpath)
-        if os.access(yamlpath, os.R_OK) and yamlpath.exists():
-            logger.info(f"loading tech config from {yamlpath}")
-            config_new = OmegaConf.load(yamlpath)
-            config = OmegaConf.merge(config, config_new)
-    return config
-
-
-CONF = read_config()
+CONF = Settings()
 PATH = Paths()
 sparameters_path = PATH.sparameters
 
 
 def rich_output() -> None:
     """Enables rich output."""
     try:
@@ -220,15 +281,15 @@
 
 def write_config(config: Any, json_out_path: Path) -> None:
     """Write config to a JSON file."""
     with open(json_out_path, "w") as f:
         json.dump(config, f, indent=2, sort_keys=True, default=complex_encoder)
 
 
-def print_config(key: Optional[str] = None) -> None:
+def print_config(key: str | None = None) -> None:
     """Prints a key for the config or all the keys."""
     if key:
         if CONF.get(key):
             print(CONF[key])
         else:
             print(f"{key!r} key not found in {CONF.keys()}")
     else:
@@ -272,15 +333,13 @@
         show_subports=show_subports,
         label_aliases=label_aliases,
         new_window=new_window,
         blocking=blocking,
         zoom_factor=zoom_factor,
     )
 
-
-if __name__ == "__main__":
     # print(PATH.sparameters)
     # print_config()
-    print_version()
+    # print_version()
     # print_version_raw()
     # print_version_pdks()
     # write_tech("tech.json")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/constants.py` & `gdsfactory-7.0.0/gdsfactory/constants.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/containers.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/containers.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,44 +1,31 @@
+"""Containers are Pcells that contain another Pcell."""
+
 from __future__ import annotations
 
 import sys
 
 from gdsfactory.add_padding import add_padding_container
 from gdsfactory.add_termination import add_termination
-from gdsfactory.components.add_grating_couplers import (
-    add_grating_couplers,
-    add_grating_couplers_with_loopback_fiber_single,
-)
-from gdsfactory.components.array_component import array
-from gdsfactory.components.cavity import cavity
-from gdsfactory.components.extension import extend_ports
-from gdsfactory.components.pack_doe import pack_doe, pack_doe_grid
-from gdsfactory.components.ring_single_dut import ring_single_dut
 from gdsfactory.functions import rotate
 from gdsfactory.get_factories import get_cells
+from gdsfactory.routing import add_pads_bot, add_pads_top
 from gdsfactory.routing.add_electrical_pads_shortest import add_electrical_pads_shortest
 from gdsfactory.routing.add_electrical_pads_top import add_electrical_pads_top
 from gdsfactory.routing.add_fiber_array import add_fiber_array
 from gdsfactory.routing.add_fiber_single import add_fiber_single
 from gdsfactory.routing.fanout2x2 import fanout2x2
 
 __all__ = [
     "add_electrical_pads_shortest",
     "add_electrical_pads_top",
     "add_fiber_array",
     "add_fiber_single",
-    "add_grating_couplers",
-    "add_grating_couplers_with_loopback_fiber_single",
     "add_padding_container",
     "add_termination",
-    "array",
-    "cavity",
-    "extend_ports",
     "fanout2x2",
-    "pack_doe",
-    "pack_doe_grid",
-    "ring_single_dut",
     "rotate",
+    "add_pads_top",
+    "add_pads_bot",
 ]
 
-
 containers = get_cells(sys.modules[__name__])
```

### Comparing `gdsfactory-6.99.0/gdsfactory/cross_section.py` & `gdsfactory-7.0.0/gdsfactory/cross_section.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,36 +1,37 @@
 """You can define a path as list of points.
 
 To create a component you need to extrude the path with a cross-section.
 """
 from __future__ import annotations
 
+import functools
 import hashlib
 import inspect
 import sys
-import functools
-from collections.abc import Iterable
+from collections.abc import Callable, Iterable
 from functools import partial
 from inspect import getmembers
-from typing import Any, Callable, Dict, List, Optional, Tuple, Union, TypeVar
+from typing import Any, Literal, TypeVar
 
 from pydantic import BaseModel, Field, validate_arguments
-from typing_extensions import Literal
+
 from gdsfactory.add_pins import add_pins_inside1nm, add_pins_siepic_optical
+from gdsfactory.serialization import clean_dict
 
 nm = 1e-3
 
-Layer = Tuple[int, int]
-Layers = Tuple[Layer, ...]
+Layer = tuple[int, int]
+Layers = tuple[Layer, ...]
 WidthTypes = Literal["sine", "linear", "parabolic"]
 
-LayerSpec = Union[Layer, int, str]
-LayerSpecs = Union[List[LayerSpec], Tuple[LayerSpec, ...]]
+LayerSpec = Layer | int | str
+LayerSpecs = list[LayerSpec] | tuple[LayerSpec, ...]
 
-Floats = Tuple[float, ...]
+Floats = tuple[float, ...]
 port_names_electrical = ("e1", "e2")
 port_types_electrical = ("electrical", "electrical")
 
 cladding_layers_optical = None
 cladding_offsets_optical = None
 cladding_simplify_optical = None
 
@@ -65,23 +66,23 @@
           |             |     |
           |             |layer|
           |             |_____|
           |              <---->
                          width
     """
 
-    width: Union[float, Callable]
-    offset: Union[float, Callable] = 0
-    insets: Optional[tuple] = None
-    layer: Optional[LayerSpec] = None
-    port_names: Tuple[Optional[str], Optional[str]] = (None, None)
-    port_types: Tuple[str, str] = ("optical", "optical")
-    name: Optional[str] = None
+    width: float | Callable
+    offset: float | Callable = 0
+    insets: tuple | None = None
+    layer: LayerSpec | LayerSpecs | None = None
+    port_names: tuple[str | None, str | None] = (None, None)
+    port_types: tuple[str, str] = ("optical", "optical")
+    name: str | None = None
     hidden: bool = False
-    simplify: Optional[float] = None
+    simplify: float | None = None
 
     class Config:
         """pydantic basemodel config."""
 
         extra = "forbid"
 
 
@@ -127,41 +128,41 @@
         name: cross_section name.
         mirror: if True, reflects the offsets.
 
     Properties:
         aliases: dict of cross_section aliases.
     """
 
-    layer: Optional[LayerSpec] = None
-    width: Union[float, Callable]
-    offset: Union[float, Callable] = 0
-    radius: Optional[float] = None
-    width_wide: Optional[float] = None
-    simplify: Optional[float] = None
+    layer: LayerSpec | None = None
+    width: float | Callable
+    offset: float | Callable = 0
+    radius: float | None = None
+    width_wide: float | None = None
+    simplify: float | None = None
     auto_widen: bool = False
     auto_widen_minimum_length: float = 200.0
     taper_length: float = 10.0
-    bbox_layers: List[LayerSpec] = Field(default_factory=list)
-    bbox_offsets: List[float] = Field(default_factory=list)
-    cladding_layers: Optional[LayerSpecs] = None
-    cladding_offsets: Optional[Floats] = None
-    cladding_simplify: Optional[Floats] = cladding_simplify_optical
-    sections: List[Section] = Field(default_factory=list)
-    port_names: Tuple[Optional[str], Optional[str]] = ("o1", "o2")
-    port_types: Tuple[Optional[str], Optional[str]] = ("optical", "optical")
+    bbox_layers: list[LayerSpec] = Field(default_factory=list)
+    bbox_offsets: list[float] = Field(default_factory=list)
+    cladding_layers: LayerSpecs | None = None
+    cladding_offsets: Floats | None = None
+    cladding_simplify: Floats | None = cladding_simplify_optical
+    sections: list[Section] = Field(default_factory=list)
+    port_names: tuple[str | None, str | None] = ("o1", "o2")
+    port_types: tuple[str | None, str | None] = ("optical", "optical")
     gap: float = 3.0
     min_length: float = 10e-3
     start_straight_length: float = 10e-3
     end_straight_length: float = 10e-3
-    snap_to_grid: Optional[float] = None
-    decorator: Optional[Callable] = None
-    add_pins: Optional[Callable] = Field(default=None, exclude=True)
-    add_bbox: Optional[Callable] = Field(default=None, exclude=True)
-    info: Dict[str, Any] = Field(default_factory=dict)
-    name: Optional[str] = None
+    snap_to_grid: float | None = None
+    decorator: Callable | None = None
+    add_pins: Callable | None = Field(default=None, exclude=True)
+    add_bbox: Callable | None = Field(default=None, exclude=True)
+    info: dict[str, Any] = Field(default_factory=dict)
+    name: str | None = None
     mirror: bool = False
 
     def __init__(__pydantic_self__, **data: Any) -> None:
         """Extend BaseModel init to process mirroring."""
         super().__init__(**data)
 
         if "mirror" in data and data["mirror"]:
@@ -192,15 +193,15 @@
         return xs
 
     def get_name(self) -> str:
         h = hashlib.md5(str(self).encode()).hexdigest()[:8]
         return f"xs_{h}"
 
     @property
-    def aliases(self) -> Dict[str, Section]:
+    def aliases(self) -> dict[str, Section]:
         s = {
             "_default": Section(
                 width=self.width,
                 offset=self.offset,
                 layer=self.layer,
                 simplify=self.simplify,
                 port_names=self.port_names,
@@ -213,18 +214,18 @@
             if section.name:
                 s[section.name] = section
         return s
 
     def add_bbox_layers(
         self,
         component,
-        top: Optional[float] = None,
-        bottom: Optional[float] = None,
-        right: Optional[float] = None,
-        left: Optional[float] = None,
+        top: float | None = None,
+        bottom: float | None = None,
+        right: float | None = None,
+        left: float | None = None,
     ):
         """Add bounding box layers to a component.
 
         Args:
             component: to add layers.
             top: top padding.
             bottom: bottom padding.
@@ -248,16 +249,30 @@
                 )
                 padding.append(points)
 
             for layer, points in zip(x.bbox_layers, padding):
                 c.add_polygon(points, layer=layer)
         return c
 
+    def get_xmin_xmax(self):
+        """Returns the min and max extent of the cross_section across all sections."""
+        main_width = self.width
+        main_offset = self.offset
+        xmin = main_offset - main_width / 2
+        xmax = main_offset + main_width / 2
+        for section in self.sections:
+            width = section.width
+            offset = section.offset
+            xmin = min(xmin, offset - width / 2)
+            xmax = max(xmax, offset + width / 2)
+
+        return xmin, xmax
+
 
-CrossSectionSpec = Union[CrossSection, Callable, Dict[str, Any]]
+CrossSectionSpec = CrossSection | Callable | dict[str, Any]
 
 
 class Transition(CrossSection):
     """Waveguide information to extrude a path between two CrossSection.
 
     cladding_layers follow path shape, while bbox_layers are rectangular.
 
@@ -300,20 +315,20 @@
         name: cross_section name.
         mirror: if True, reflects the offsets.
     """
 
     cross_section1: CrossSectionSpec
     cross_section2: CrossSectionSpec
     width_type: WidthTypes = "sine"
-    sections: List[Section]
-    layer: Optional[LayerSpec] = None
-    width: Optional[Union[float, Callable]] = None
-    snap_to_grid: Optional[float] = None
-    port_names: Tuple[Optional[str], Optional[str]] = (None, None)
-    port_types: Tuple[Optional[str], Optional[str]] = ("optical", "optical")
+    sections: list[Section]
+    layer: LayerSpec | None = None
+    width: float | Callable | None = None
+    snap_to_grid: float | None = None
+    port_names: tuple[str | None, str | None] = (None, None)
+    port_types: tuple[str | None, str | None] = ("optical", "optical")
 
 
 def _xsection_without_validator(func):
     """Decorator for cross_section functions
 
     use xsection instead so it will validate arguments with types.
     """
@@ -333,22 +348,24 @@
             for p in sig.parameters.values()
             if p.default != inspect._empty
         }
 
         # Update with args and kwargs, overriding defaults
         settings.update(args_as_kwargs)
         settings.update(kwargs)
+        settings = clean_dict(settings)
 
         if not isinstance(xs, CrossSection):
             raise ValueError(
                 f"function {func.__name__!r} return type = {type(xs)}",
                 "make sure that functions with @xsection decorator return a CrossSection",
             )
 
-        xs.info.update(settings=settings, function_name=func.__name__)
+        function_name = func.__name__
+        xs.info.update(settings=settings, function_name=function_name)
         return xs
 
     return _xsection
 
 
 _F = TypeVar("_F", bound=Callable)
 
@@ -373,41 +390,41 @@
         c.plot()
     """
     return _xsection_without_validator(validate_arguments(func))
 
 
 @xsection
 def cross_section(
-    width: Union[Callable, float] = 0.5,
-    offset: Union[float, Callable] = 0,
-    layer: Optional[LayerSpec] = "WG",
-    width_wide: Optional[float] = None,
+    width: Callable | float = 0.5,
+    offset: float | Callable = 0,
+    layer: LayerSpec | None = "WG",
+    width_wide: float | None = None,
     auto_widen: bool = False,
     auto_widen_minimum_length: float = 200.0,
     taper_length: float = 10.0,
-    radius: Optional[float] = 10.0,
-    sections: Optional[Tuple[Section, ...]] = None,
-    port_names: Tuple[str, str] = ("o1", "o2"),
-    port_types: Tuple[str, str] = ("optical", "optical"),
+    radius: float | None = 10.0,
+    sections: tuple[Section, ...] | None = None,
+    port_names: tuple[str, str] = ("o1", "o2"),
+    port_types: tuple[str, str] = ("optical", "optical"),
     gap: float = 3.0,
     min_length: float = 10e-3,
     start_straight_length: float = 10e-3,
     end_straight_length: float = 10e-3,
-    snap_to_grid: Optional[float] = None,
-    bbox_layers: Optional[List[LayerSpec]] = None,
-    bbox_offsets: Optional[List[float]] = None,
-    cladding_layers: Optional[LayerSpecs] = None,
-    cladding_offsets: Optional[Floats] = None,
-    cladding_simplify: Optional[Floats] = cladding_simplify_optical,
-    info: Optional[Dict[str, Any]] = None,
-    decorator: Optional[Callable] = None,
-    add_pins: Optional[Callable] = None,
-    add_bbox: Optional[Callable] = None,
+    snap_to_grid: float | None = None,
+    bbox_layers: list[LayerSpec] | None = None,
+    bbox_offsets: list[float] | None = None,
+    cladding_layers: LayerSpecs | None = None,
+    cladding_offsets: Floats | None = None,
+    cladding_simplify: Floats | None = cladding_simplify_optical,
+    info: dict[str, Any] | None = None,
+    decorator: Callable | None = None,
+    add_pins: Callable | None = None,
+    add_bbox: Callable | None = None,
     mirror: bool = False,
-    name: Optional[str] = None,
+    name: str | None = None,
 ) -> CrossSection:
     """Return CrossSection.
 
     Args:
         width: main Section width (um) or function parameterized from 0 to 1.
             the width at t==0 is the width at the beginning of the Path.
             the width at t==1 is the width at the end.
@@ -485,37 +502,51 @@
 
 
 radius_nitride = 20
 radius_rib = 20
 
 
 # strip = cross_section
-strip_pins = partial(cross_section, add_pins=add_pins_inside1nm, name="strip")
+strip_pins = partial(
+    cross_section,
+    add_pins=add_pins_inside1nm,
+    name="strip",
+    add_bbox=None,
+    info={"type": "strip"},
+)
 strip = strip_pins
 strip_auto_widen = partial(strip, width_wide=0.9, auto_widen=True)
 strip_no_pins = partial(
     strip, add_pins=None, add_bbox=None, cladding_layers=None, cladding_offsets=None
 )
 strip_siepic = partial(cross_section, add_pins=add_pins_siepic_optical)
 
 # Rib with rectangular slab
-rib = partial(strip, bbox_layers=["SLAB90"], bbox_offsets=[3], radius=radius_rib)
+rib = partial(
+    strip,
+    bbox_layers=["SLAB90"],
+    bbox_offsets=[3],
+    radius=radius_rib,
+    info={"type": "rib"},
+)
 
 # Rib with with slab that follows the waveguide core
 rib_conformal = partial(
     strip,
     sections=(Section(width=6, layer="SLAB90", name="slab", simplify=50 * nm),),
     radius=radius_rib,
+    info={"type": "rib"},
 )
 rib_conformal2 = partial(
     strip,
     radius=radius_rib,
     cladding_layers=("SLAB90",),
     cladding_offsets=(3,),
     cladding_simplify=(50 * nm,),
+    info={"type": "rib"},
 )
 nitride = partial(strip, layer="WGN", width=1.0, radius=radius_nitride)
 strip_rib_tip = partial(
     strip,
     sections=(Section(width=0.2, layer="SLAB90", name="slab"),),
     radius=radius_nitride,
 )
@@ -599,18 +630,18 @@
 
 
 @xsection
 def rib_with_trenches(
     width: float = 0.5,
     width_trench: float = 2.0,
     width_slab: float = 7.0,
-    simplify_slab: Optional[float] = None,
-    layer: Optional[LayerSpec] = "WG",
+    simplify_slab: float | None = None,
+    layer: LayerSpec | None = "WG",
     layer_trench: LayerSpec = "DEEP_ETCH",
-    wg_marking_layer: Optional[LayerSpec] = None,
+    wg_marking_layer: LayerSpec | None = None,
     **kwargs,
 ) -> CrossSection:
     """Return CrossSection of rib waveguide defined by trenches.
 
     Args:
         width: main Section width (um) or function parameterized from 0 to 1.
             the width at t==0 is the width at the beginning of the Path.
@@ -672,18 +703,18 @@
 
 
 @xsection
 def l_with_trenches(
     width: float = 0.5,
     width_trench: float = 2.0,
     width_slab: float = 7.0,
-    layer: Optional[LayerSpec] = "WG",
+    layer: LayerSpec | None = "WG",
     layer_trench: LayerSpec = "DEEP_ETCH",
     mirror: bool = False,
-    wg_marking_layer: Optional[LayerSpec] = None,
+    wg_marking_layer: LayerSpec | None = None,
     **kwargs,
 ) -> CrossSection:
     """Return CrossSection of l waveguide defined by trenches.
 
     Args:
         width: main Section width (um) or function parameterized from 0 to 1.
             the width at t==0 is the width at the beginning of the Path.
@@ -769,30 +800,41 @@
     layer="HEATER",
 )
 
 metal3_with_bend = partial(metal1, layer="M3", radius=10)
 metal_routing = metal3
 npp = partial(metal1, layer="NPP", width=0.5)
 
+metal_slotted = partial(
+    cross_section,
+    width=10,
+    offset=0,
+    layer="M3",
+    sections=[
+        Section(width=10, layer="M3", offset=11),
+        Section(width=10, layer="M3", offset=-11),
+    ],
+)
+
 
 @xsection
 def pin(
     width: float = 0.5,
     layer: LayerSpec = "WG",
     layer_slab: LayerSpec = "SLAB90",
     layers_via_stack1: LayerSpecs = ("PPP",),
     layers_via_stack2: LayerSpecs = ("NPP",),
-    bbox_offsets_via_stack1: Tuple[float, ...] = (0, -0.2),
-    bbox_offsets_via_stack2: Tuple[float, ...] = (0, -0.2),
+    bbox_offsets_via_stack1: tuple[float, ...] = (0, -0.2),
+    bbox_offsets_via_stack2: tuple[float, ...] = (0, -0.2),
     via_stack_width: float = 9.0,
     via_stack_gap: float = 0.55,
     slab_gap: float = -0.2,
-    layer_via: Optional[LayerSpec] = None,
+    layer_via: LayerSpec | None = None,
     via_width: float = 1,
-    via_offsets: Optional[Tuple[float, ...]] = None,
+    via_offsets: tuple[float, ...] | None = None,
     **kwargs,
 ) -> CrossSection:
     """Rib PIN doped cross_section.
 
     Args:
         width: ridge width.
         layer: ridge layer.
@@ -878,35 +920,35 @@
 
 @xsection
 def pn(
     width: float = 0.5,
     layer: LayerSpec = "WG",
     layer_slab: LayerSpec = "SLAB90",
     gap_low_doping: float = 0.0,
-    gap_medium_doping: Optional[float] = 0.5,
-    gap_high_doping: Optional[float] = 1.0,
-    offset_low_doping: Optional[float] = 0.0,
+    gap_medium_doping: float | None = 0.5,
+    gap_high_doping: float | None = 1.0,
+    offset_low_doping: float | None = 0.0,
     width_doping: float = 8.0,
     width_slab: float = 7.0,
-    layer_p: Optional[LayerSpec] = "P",
-    layer_pp: Optional[LayerSpec] = "PP",
-    layer_ppp: Optional[LayerSpec] = "PPP",
-    layer_n: Optional[LayerSpec] = "N",
-    layer_np: Optional[LayerSpec] = "NP",
-    layer_npp: Optional[LayerSpec] = "NPP",
-    layer_via: Optional[LayerSpec] = None,
+    layer_p: LayerSpec | None = "P",
+    layer_pp: LayerSpec | None = "PP",
+    layer_ppp: LayerSpec | None = "PPP",
+    layer_n: LayerSpec | None = "N",
+    layer_np: LayerSpec | None = "NP",
+    layer_npp: LayerSpec | None = "NPP",
+    layer_via: LayerSpec | None = None,
     width_via: float = 1.0,
-    layer_metal: Optional[LayerSpec] = None,
+    layer_metal: LayerSpec | None = None,
     width_metal: float = 1.0,
-    port_names: Tuple[str, str] = ("o1", "o2"),
-    bbox_layers: Optional[List[Layer]] = None,
-    bbox_offsets: Optional[List[float]] = None,
-    cladding_layers: Optional[Layers] = cladding_layers_optical,
-    cladding_offsets: Optional[Floats] = cladding_offsets_optical,
-    cladding_simplify: Optional[Floats] = cladding_simplify_optical,
+    port_names: tuple[str, str] = ("o1", "o2"),
+    bbox_layers: list[Layer] | None = None,
+    bbox_offsets: list[float] | None = None,
+    cladding_layers: Layers | None = cladding_layers_optical,
+    cladding_offsets: Floats | None = cladding_offsets_optical,
+    cladding_simplify: Floats | None = cladding_simplify_optical,
     mirror: bool = False,
     **kwargs,
 ) -> CrossSection:
     """Rib PN doped cross_section.
 
     Args:
         width: width of the ridge in um.
@@ -1074,41 +1116,41 @@
         **kwargs,
     )
 
 
 @xsection
 def pn_with_trenches(
     width: float = 0.5,
-    layer: Optional[LayerSpec] = None,
+    layer: LayerSpec | None = None,
     layer_trench: LayerSpec = "DEEP_ETCH",
     gap_low_doping: float = 0.0,
-    gap_medium_doping: Optional[float] = 0.5,
-    gap_high_doping: Optional[float] = 1.0,
-    offset_low_doping: Optional[float] = 0.0,
+    gap_medium_doping: float | None = 0.5,
+    gap_high_doping: float | None = 1.0,
+    offset_low_doping: float | None = 0.0,
     width_doping: float = 8.0,
     width_slab: float = 7.0,
     width_trench: float = 2.0,
-    layer_p: Optional[LayerSpec] = "P",
-    layer_pp: Optional[LayerSpec] = "PP",
-    layer_ppp: Optional[LayerSpec] = "PPP",
-    layer_n: Optional[LayerSpec] = "N",
-    layer_np: Optional[LayerSpec] = "NP",
-    layer_npp: Optional[LayerSpec] = "NPP",
-    layer_via: Optional[LayerSpec] = None,
+    layer_p: LayerSpec | None = "P",
+    layer_pp: LayerSpec | None = "PP",
+    layer_ppp: LayerSpec | None = "PPP",
+    layer_n: LayerSpec | None = "N",
+    layer_np: LayerSpec | None = "NP",
+    layer_npp: LayerSpec | None = "NPP",
+    layer_via: LayerSpec | None = None,
     width_via: float = 1.0,
-    layer_metal: Optional[LayerSpec] = None,
+    layer_metal: LayerSpec | None = None,
     width_metal: float = 1.0,
-    port_names: Tuple[str, str] = ("o1", "o2"),
-    bbox_layers: Optional[List[Layer]] = None,
-    bbox_offsets: Optional[List[float]] = None,
-    cladding_layers: Optional[Layers] = cladding_layers_optical,
-    cladding_offsets: Optional[Floats] = cladding_offsets_optical,
-    cladding_simplify: Optional[Floats] = cladding_simplify_optical,
+    port_names: tuple[str, str] = ("o1", "o2"),
+    bbox_layers: list[Layer] | None = None,
+    bbox_offsets: list[float] | None = None,
+    cladding_layers: Layers | None = cladding_layers_optical,
+    cladding_offsets: Floats | None = cladding_offsets_optical,
+    cladding_simplify: Floats | None = cladding_simplify_optical,
     mirror: bool = False,
-    wg_marking_layer: Optional[LayerSpec] = None,
+    wg_marking_layer: LayerSpec | None = None,
     **kwargs,
 ) -> CrossSection:
     """Rib PN doped cross_section.
 
     Args:
         width: width of the ridge in um.
         layer: ridge layer. None adds only ridge.
@@ -1286,39 +1328,39 @@
         **kwargs,
     )
 
 
 @xsection
 def pn_with_trenches_asymmetric(
     width: float = 0.5,
-    layer: Optional[LayerSpec] = None,
+    layer: LayerSpec | None = None,
     layer_trench: LayerSpec = "DEEP_ETCH",
-    gap_low_doping: Union[float, Tuple[float, float]] = (0.0, 0.0),
-    gap_medium_doping: Optional[Union[float, Tuple[float, float]]] = (0.5, 0.2),
-    gap_high_doping: Optional[Union[float, Tuple[float, float]]] = (1.0, 0.8),
+    gap_low_doping: float | tuple[float, float] = (0.0, 0.0),
+    gap_medium_doping: float | tuple[float, float] | None = (0.5, 0.2),
+    gap_high_doping: float | tuple[float, float] | None = (1.0, 0.8),
     width_doping: float = 8.0,
     width_slab: float = 7.0,
     width_trench: float = 2.0,
-    layer_p: Optional[LayerSpec] = "P",
-    layer_pp: Optional[LayerSpec] = "PP",
-    layer_ppp: Optional[LayerSpec] = "PPP",
-    layer_n: Optional[LayerSpec] = "N",
-    layer_np: Optional[LayerSpec] = "NP",
-    layer_npp: Optional[LayerSpec] = "NPP",
-    layer_via: Optional[LayerSpec] = None,
+    layer_p: LayerSpec | None = "P",
+    layer_pp: LayerSpec | None = "PP",
+    layer_ppp: LayerSpec | None = "PPP",
+    layer_n: LayerSpec | None = "N",
+    layer_np: LayerSpec | None = "NP",
+    layer_npp: LayerSpec | None = "NPP",
+    layer_via: LayerSpec | None = None,
     width_via: float = 1.0,
-    layer_metal: Optional[LayerSpec] = None,
+    layer_metal: LayerSpec | None = None,
     width_metal: float = 1.0,
-    port_names: Tuple[str, str] = ("o1", "o2"),
-    bbox_layers: Optional[List[Layer]] = None,
-    bbox_offsets: Optional[List[float]] = None,
-    cladding_layers: Optional[Layers] = cladding_layers_optical,
-    cladding_offsets: Optional[Floats] = cladding_offsets_optical,
+    port_names: tuple[str, str] = ("o1", "o2"),
+    bbox_layers: list[Layer] | None = None,
+    bbox_offsets: list[float] | None = None,
+    cladding_layers: Layers | None = cladding_layers_optical,
+    cladding_offsets: Floats | None = cladding_offsets_optical,
     mirror: bool = False,
-    wg_marking_layer: Optional[LayerSpec] = None,
+    wg_marking_layer: LayerSpec | None = None,
     **kwargs,
 ) -> CrossSection:
     """Rib PN doped cross_section with asymmetric dimensions left and right.
 
     Args:
         width: width of the ridge in um.
         layer: ridge layer. None adds only ridge.
@@ -1398,15 +1440,15 @@
         for offset in [+trench_offset, -trench_offset]
     ]
 
     if wg_marking_layer is not None:
         sections += [Section(width=width, offset=0, layer=wg_marking_layer)]
 
     # Low doping
-    if not isinstance(gap_low_doping, (list, Tuple)):
+    if not isinstance(gap_low_doping, list | tuple):
         gap_low_doping = [gap_low_doping] * 2
 
     if layer_n:
         width_low_doping_n = width_doping - gap_low_doping[1]
         n = Section(
             width=width_low_doping_n,
             offset=width_low_doping_n / 2 + gap_low_doping[1],
@@ -1419,15 +1461,15 @@
             width=width_low_doping_p,
             offset=-(width_low_doping_p / 2 + gap_low_doping[0]),
             layer=layer_p,
         )
         sections.append(p)
 
     if gap_medium_doping is not None:
-        if not isinstance(gap_medium_doping, (list, Tuple)):
+        if not isinstance(gap_medium_doping, list | tuple):
             gap_medium_doping = [gap_medium_doping] * 2
 
         if layer_np:
             width_np = width_doping - gap_medium_doping[1]
             np = Section(
                 width=width_np,
                 offset=width_np / 2 + gap_medium_doping[1],
@@ -1440,15 +1482,15 @@
                 width=width_pp,
                 offset=-(width_pp / 2 + gap_medium_doping[0]),
                 layer=layer_pp,
             )
             sections.append(pp)
 
     if gap_high_doping is not None:
-        if not isinstance(gap_high_doping, (list, Tuple)):
+        if not isinstance(gap_high_doping, list | tuple):
             gap_high_doping = [gap_high_doping] * 2
 
         if layer_npp:
             width_npp = width_doping - gap_high_doping[1]
             npp = Section(
                 width=width_npp,
                 offset=width_npp / 2 + gap_high_doping[1],
@@ -1513,36 +1555,36 @@
         **kwargs,
     )
 
 
 @xsection
 def l_wg_doped_with_trenches(
     width: float = 0.5,
-    layer: Optional[LayerSpec] = None,
+    layer: LayerSpec | None = None,
     layer_trench: LayerSpec = "DEEP_ETCH",
     gap_low_doping: float = 0.0,
-    gap_medium_doping: Optional[float] = 0.5,
-    gap_high_doping: Optional[float] = 1.0,
+    gap_medium_doping: float | None = 0.5,
+    gap_high_doping: float | None = 1.0,
     width_doping: float = 8.0,
     width_slab: float = 7.0,
     width_trench: float = 2.0,
     layer_low: LayerSpec = "P",
     layer_mid: LayerSpec = "PP",
     layer_high: LayerSpec = "PPP",
-    layer_via: Optional[LayerSpec] = None,
+    layer_via: LayerSpec | None = None,
     width_via: float = 1.0,
-    layer_metal: Optional[LayerSpec] = None,
+    layer_metal: LayerSpec | None = None,
     width_metal: float = 1.0,
-    port_names: Tuple[str, str] = ("o1", "o2"),
-    bbox_layers: Optional[List[Layer]] = None,
-    bbox_offsets: Optional[List[float]] = None,
-    cladding_layers: Optional[Layers] = cladding_layers_optical,
-    cladding_offsets: Optional[Floats] = cladding_offsets_optical,
+    port_names: tuple[str, str] = ("o1", "o2"),
+    bbox_layers: list[Layer] | None = None,
+    bbox_offsets: list[float] | None = None,
+    cladding_layers: Layers | None = cladding_layers_optical,
+    cladding_offsets: Floats | None = cladding_offsets_optical,
     mirror: bool = False,
-    wg_marking_layer: Optional[LayerSpec] = None,
+    wg_marking_layer: LayerSpec | None = None,
     **kwargs,
 ) -> CrossSection:
     """L waveguide PN doped cross_section.
 
     Args:
         width: width of the ridge in um.
         layer: ridge layer. None adds only ridge.
@@ -1815,15 +1857,15 @@
 @xsection
 def strip_heater_doped(
     width: float = 0.5,
     layer: LayerSpec = "WG",
     heater_width: float = 2.0,
     heater_gap: float = 0.8,
     layers_heater: LayerSpecs = ("WG", "NPP"),
-    bbox_offsets_heater: Tuple[float, ...] = (0, 0.1),
+    bbox_offsets_heater: tuple[float, ...] = (0, 0.1),
     **kwargs,
 ) -> CrossSection:
     """Returns strip cross_section with N++ doped heaters on both sides.
 
     Args:
         width: in um.
         layer: waveguide spec.
@@ -1970,15 +2012,15 @@
     heater_width: float = 1.0,
     heater_gap: float = 0.8,
     layer_slab: LayerSpec = "SLAB90",
     layer_heater: LayerSpec = "NPP",
     via_stack_width: float = 2.0,
     via_stack_gap: float = 0.8,
     layers_via_stack: LayerSpecs = ("NPP", "VIAC"),
-    bbox_offsets_via_stack: Tuple[float, ...] = (0, -0.2),
+    bbox_offsets_via_stack: tuple[float, ...] = (0, -0.2),
     slab_gap: float = 0.2,
     slab_offset: float = 0,
     with_top_heater: bool = True,
     with_bot_heater: bool = True,
     **kwargs,
 ) -> CrossSection:
     """Returns rib cross_section with N++ doped heaters on both sides.
@@ -2091,31 +2133,31 @@
 @xsection
 def pn_ge_detector_si_contacts(
     width_si: float = 6.0,
     layer_si: LayerSpec = "WG",
     width_ge: float = 3.0,
     layer_ge: LayerSpec = "GE",
     gap_low_doping: float = 0.6,
-    gap_medium_doping: Optional[float] = 0.9,
-    gap_high_doping: Optional[float] = 1.1,
+    gap_medium_doping: float | None = 0.9,
+    gap_high_doping: float | None = 1.1,
     width_doping: float = 8.0,
     layer_p: LayerSpec = "P",
     layer_pp: LayerSpec = "PP",
     layer_ppp: LayerSpec = "PPP",
     layer_n: LayerSpec = "N",
     layer_np: LayerSpec = "NP",
     layer_npp: LayerSpec = "NPP",
-    layer_via: Optional[LayerSpec] = None,
+    layer_via: LayerSpec | None = None,
     width_via: float = 1.0,
-    layer_metal: Optional[LayerSpec] = None,
-    port_names: Tuple[str, str] = ("o1", "o2"),
-    bbox_layers: Optional[List[Layer]] = None,
-    bbox_offsets: Optional[List[float]] = None,
-    cladding_layers: Optional[Layers] = cladding_layers_optical,
-    cladding_offsets: Optional[Floats] = cladding_offsets_optical,
+    layer_metal: LayerSpec | None = None,
+    port_names: tuple[str, str] = ("o1", "o2"),
+    bbox_layers: list[Layer] | None = None,
+    bbox_offsets: list[float] | None = None,
+    cladding_layers: Layers | None = cladding_layers_optical,
+    cladding_offsets: Floats | None = cladding_offsets_optical,
 ) -> CrossSection:
     """Linear Ge detector cross section based on a lateral p(i)n junction.
 
     It has silicon contacts (no contact on the Ge). The contacts need to be
     created in the component generating function (they can't be created here).
 
     See Chen et al., "High-Responsivity Low-Voltage 28-Gb/s Ge p-i-n Photodetector
@@ -2265,15 +2307,15 @@
 
 
 CrossSectionFactory = Callable[..., CrossSection]
 
 
 def get_cross_section_factories(
     modules, verbose: bool = False
-) -> Dict[str, CrossSectionFactory]:
+) -> dict[str, CrossSectionFactory]:
     """Returns cross_section factories from a module or list of modules.
 
     Args:
         modules: module or iterable of modules.
         verbose: prints in case any errors occur.
     """
     modules = modules if isinstance(modules, Iterable) else [modules]
@@ -2313,33 +2355,29 @@
     #     # gap_low_doping=0.05,
     #     # width_doping=2.0,
     #     # offset_low_doping=0,
     #     mirror=False,
     # )
     # xs = pn_with_trenches(width=0.3)
     # xs = slot(width=0.3)
-
     # xs = rib_with_trenches()
     # p = gf.path.straight()
     # c = p.extrude(xs)
-
     # xs = l_with_trenches(
     #     width=0.5,
     #     width_trench=2.0,
     #     width_slab=7.0,
     # )
     # p = gf.path.straight()
     # c = p.extrude(xs)
-
     # xs = l_wg_doped_with_trenches(
     #     layer="WG", width=0.5, width_trench=2.0, width_slab=7.0, gap_low_doping=0.1
     # )
     # p = gf.path.straight()
     # c = p.extrude(cross_section=xs)
-
     # xs = rib_with_trenches() # FIXME
     # c = gf.components.straight(cross_section=xs)
     c = gf.components.straight(cross_section="strip")
 
     # xs = l_wg()
     # p = gf.path.straight()
     # c = p.extrude(xs)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/decorators.py` & `gdsfactory-7.0.0/gdsfactory/decorators.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.snap import is_on_grid
-from gdsfactory.typings import Component, ComponentReference, Optional
+from gdsfactory.typings import Component, ComponentReference
 
 
 def is_valid_transformation(
-    ref: ComponentReference, grid_size: Optional[float] = None
+    ref: ComponentReference, grid_size: float | None = None
 ) -> bool:
     """Returns True if the component has valid transformations.
 
     Args:
         component: the component reference to check.
         grid_size: the GDS grid size, in um, defaults to active PDK.get_grid_size()
             any translations with higher resolution than this are considered invalid.
@@ -26,15 +26,15 @@
 
 def has_valid_transformations(component: Component) -> bool:
     """Returns True if the component has valid transformations."""
     refs = component.references
     return all(is_valid_transformation(ref) for ref in refs)
 
 
-def flatten_invalid_refs(component: Component, grid_size: Optional[float] = None):
+def flatten_invalid_refs(component: Component, grid_size: float | None = None):
     """Flattens component references which have invalid transformations.
 
     (i.e. non-90 deg rotations or sub-grid translations).
 
     This is an in-place operation, so you should use it as a decorator.
     flattens only individual references with invalid transformations.
 
@@ -48,15 +48,15 @@
     refs = component.references.copy()
     for ref in refs:
         if is_invalid_ref(ref, grid_size):
             component.flatten_reference(ref)
     return component
 
 
-def is_invalid_ref(ref, grid_size: Optional[float] = None) -> bool:
+def is_invalid_ref(ref, grid_size: float | None = None) -> bool:
     from gdsfactory.pdk import get_grid_size
 
     grid_size = grid_size or get_grid_size()
     nm = int(grid_size * 1e3)
     origin_is_on_grid = all(is_on_grid(x, nm) for x in ref.origin)
     rotation_is_regular = ref.rotation is None or ref.rotation % 90 == 0
     return not origin_is_on_grid or not rotation_is_regular
```

### Comparing `gdsfactory-6.99.0/gdsfactory/difftest.py` & `gdsfactory-7.0.0/gdsfactory/difftest.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,67 +1,42 @@
 """GDS regression test. Inspired by lytest."""
 import filecmp
 import pathlib
 import shutil
-from typing import Optional
 
 import gdsfactory as gf
-from gdsfactory.config import PATH, logger, GDSDIR_TEMP
-
-from kfactory import KCell, KCLayout, kdb
+from gdsfactory.config import GDSDIR_TEMP, PATH, logger
 
 
 class GeometryDifference(Exception):
     pass
 
 
-def difftest(
-    component: gf.Component,
-    test_name: Optional[gf.Component] = None,
-    dirpath: pathlib.Path = PATH.gds_ref,
-    xor: bool = True,
-) -> None:
-    """Avoids GDS regressions tests on the GeometryDifference.
+PathType = pathlib.Path | str
 
-    If files are the same it returns None. If files are different runs XOR
-    between new component and the GDS reference stored in dirpath and
-    raises GeometryDifference if there are differences and show differences in KLayout.
 
-    If it runs for the fist time it just stores the GDS reference.
+def diff(
+    ref_file: PathType, run_file: PathType, xor: bool = True, test_name: str = ""
+) -> bool:
+    """Returns True if files are different, prints differences and shows them in klayout.
 
     Args:
-        component: to test if it has changed.
-        test_name: used to store the GDS file.
-        dirpath: default directory for storing reference files.
+        ref_file: reference (old) file.
+        run_file: run (new) file.
+        xor: runs xor on every layer between ref and run files.
+        test_name: prefix for the new cell.
     """
-    test_name = test_name or (
-        f"{component.function_name}_{component.name}"
-        if hasattr(component, "function_name")
-        and component.name != component.function_name
-        else f"{component.name}"
-    )
-    filename = f"{test_name}.gds"
-    dirpath_ref = dirpath
-    dirpath_run = GDSDIR_TEMP
-
-    ref_file = dirpath_ref / f"{test_name}.gds"
-    run_file = dirpath_run / filename
-
-    component = gf.get_component(component)
-    run_file = component.write_gds(gdspath=run_file)
-
-    if not ref_file.exists():
-        shutil.copy(run_file, ref_file)
-        raise AssertionError(
-            f"Reference GDS file for {test_name!r} not found. Writing to {ref_file!r}"
+    try:
+        from kfactory import KCell, kdb
+    except ImportError as e:
+        print(
+            "You can install `pip install gdsfactory[kfactory]` for using maskprep. "
+            "And make sure you use python >= 3.10"
         )
-
-    if filecmp.cmp(ref_file, run_file, shallow=False):
-        return
-
+        raise e
     ref = read_top_cell(ref_file)
     run = read_top_cell(run_file)
     ld = kdb.LayoutDiff()
 
     a_regions: dict[int, kdb.Region] = {}
     a_texts: dict[int, kdb.Texts] = {}
     b_regions: dict[int, kdb.Region] = {}
@@ -127,35 +102,92 @@
                     layer_run = run.layer(layer)
 
                     region_run = kdb.Region(run.begin_shapes_rec(layer_run))
                     region_ref = kdb.Region(ref.begin_shapes_rec(layer_ref))
                     region_diff = region_run - region_ref
 
                     if not region_diff.is_empty():
+                        layer_id = c.layer(layer)
                         region_xor = region_ref ^ region_run
-                        diff.shapes(layer_ref).insert(region_xor)
+                        diff.shapes(layer_id).insert(region_xor)
+                        is_sliver = region_xor.sized(-1).is_empty()
+                        message = f"{test_name}: XOR difference on layer {layer}"
+                        if is_sliver:
+                            message += " (sliver or label)"
+                        print(message)
                 elif layer in run.kcl.layer_infos():
-                    layer = run.layer(layer)
-                    region = kdb.Region(run.begin_shapes_rec(layer))
-                    diff.shapes(layer).insert(region)
-                else:
-                    layer = ref.layer(layer)
-                    region = kdb.Region(ref.begin_shapes_rec(layer))
-                    diff.shapes(layer).insert(region)
+                    layer_id = run.layer(layer)
+                    region = kdb.Region(run.begin_shapes_rec(layer_id))
+                    diff.shapes(layer_id).insert(region)
+                    print(f"{test_name}: layer {layer} only exists in updated cell")
+                elif layer in ref.kcl.layer_infos():
+                    layer_id = ref.layer(layer)
+                    region = kdb.Region(ref.begin_shapes_rec(layer_id))
+                    diff.shapes(layer_id).insert(region)
+                    print(f"{test_name}: layer {layer} missing from updated cell")
 
             c << diff
 
         c.show()
+        return True
+    return False
+
+
+def difftest(
+    component: gf.Component,
+    test_name: gf.Component | None = None,
+    dirpath: pathlib.Path = PATH.gds_ref,
+    xor: bool = True,
+) -> None:
+    """Avoids GDS regressions tests on the GeometryDifference.
 
+    If files are the same it returns None. If files are different runs XOR
+    between new component and the GDS reference stored in dirpath and
+    raises GeometryDifference if there are differences and show differences in KLayout.
+
+    If it runs for the fist time it just stores the GDS reference.
+
+    Args:
+        component: to test if it has changed.
+        test_name: used to store the GDS file.
+        dirpath: default directory for storing reference files.
+        xor: runs XOR.
+    """
+    test_name = test_name or (
+        f"{component.function_name}_{component.name}"
+        if hasattr(component, "function_name")
+        and component.name != component.function_name
+        else f"{component.name}"
+    )
+    filename = f"{test_name}.gds"
+    dirpath_ref = dirpath
+    dirpath_ref.mkdir(exist_ok=True, parents=True)
+    dirpath_run = GDSDIR_TEMP
+
+    ref_file = dirpath_ref / f"{test_name}.gds"
+    run_file = dirpath_run / filename
+
+    component = gf.get_component(component)
+    run_file = component.write_gds(gdspath=run_file)
+
+    if not ref_file.exists():
+        shutil.copy(run_file, ref_file)
+        raise AssertionError(
+            f"Reference GDS file for {test_name!r} not found. Writing to {ref_file!r}"
+        )
+
+    if filecmp.cmp(ref_file, run_file, shallow=False):
+        return
+
+    if diff(ref_file=ref_file, run_file=run_file, xor=xor, test_name=test_name):
         print(
             f"\ngds_run {filename!r} changed from gds_ref {str(ref_file)!r}\n"
             "You can check the differences in Klayout GUI or run XOR with\n"
             f"gf gds diff --xor {ref_file} {run_file}\n"
         )
-
         try:
             overwrite(ref_file, run_file)
         except OSError as exc:
             raise GeometryDifference(
                 "\n"
                 f"{filename!r} changed from reference {str(ref_file)!r}. "
                 "Run `pytest -s` to step and check differences in klayout GUI."
@@ -170,37 +202,38 @@
     logger.info(f"deleting file {str(ref_file)!r}")
     ref_file.unlink()
     shutil.copy(run_file, ref_file)
     raise GeometryDifference
 
 
 def read_top_cell(arg0):
+    from kfactory import KCLayout
+
     kcl = KCLayout()
     kcl.read(arg0)
     return kcl[kcl.top_cell().name]
 
 
 if __name__ == "__main__":
     # print([i.name for i in c.get_dependencies()])
     # c.show()
     # c.name = "mzi"
-    c = gf.components.straight(layer=(2, 0))
+    c = gf.components.straight(length=20, layer=(1, 0))
     c.show()
     difftest(c, "straight", dirpath=PATH.cwd)
 
     # component = gf.components.mzi()
     # test_name = "mzi"
     # filename = f"{test_name}.gds"
     # dirpath = PATH.cwd
     # dirpath_ref = dirpath / "gds_ref"
     # dirpath_run = GDSDIR_TEMP
 
     # ref_file = dirpath_ref / f"{test_name}.gds"
     # run_file = dirpath_run / filename
-
     # run = gf.get_component(component)
     # run_file = run.write_gds(gdspath=run_file)
 
     # if not ref_file.exists():
     #     component.write_gds(gdspath=ref_file)
     #     raise AssertionError(
     #         f"Reference GDS file for {test_name!r} not found. Writing to {ref_file!r}"
```

### Comparing `gdsfactory-6.99.0/gdsfactory/events.py` & `gdsfactory-7.0.0/gdsfactory/events.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Callable
+from collections.abc import Callable
 
 
 class Event:
     def __init__(self) -> None:
         """Initialize the object."""
         self._handlers = []
```

### Comparing `gdsfactory-6.99.0/gdsfactory/export/to_3d.py` & `gdsfactory-7.0.0/gdsfactory/export/to_3d.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import shapely
 
 from gdsfactory.component import Component
 from gdsfactory.technology import LayerStack, LayerViews
 from gdsfactory.typings import Layer
 
 
 def to_3d(
     component: Component,
-    layer_views: Optional[LayerViews] = None,
-    layer_stack: Optional[LayerStack] = None,
-    exclude_layers: Optional[Tuple[Layer, ...]] = None,
+    layer_views: LayerViews | None = None,
+    layer_stack: LayerStack | None = None,
+    exclude_layers: tuple[Layer, ...] | None = None,
 ):
     """Return Component 3D trimesh Scene.
 
     Args:
         component: to extrude in 3D.
         layer_views: layer colors from Klayout Layer Properties file.
             Defaults to active PDK.layer_views.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/export/to_gerber.py` & `gdsfactory-7.0.0/gdsfactory/export/to_gerber.py`

 * *Files 6% similar despite different names*

```diff
@@ -2,39 +2,38 @@
 Based on Gerber file spec:
 https://www.ucamco.com/files/downloads/file_en/456/gerber-layer-format-specification-revision-2022-02_en.pdf
 
 See Also:
 - https://github.com/opiopan/pcb-tools-extension
 - https://github.com/jamesbowman/cuflow/blob/master/gerber.py
 """
-from typing_extensions import Literal
-from typing import Optional, List, Dict, Tuple
 from pathlib import Path
+from typing import Literal
 
 from pydantic import BaseModel, Field
 
 from gdsfactory import Component
 
 
 class GerberLayer(BaseModel):
     name: str
-    function: List[str]
+    function: list[str]
     polarity: Literal["Positive", "Negative"]
 
 
 class GerberOptions(BaseModel):
-    header: Optional[List[str]] = None
+    header: list[str] | None = None
     mode: Literal["mm", "in"] = "mm"
     resolution: float = 1e-6
     int_size: int = 4
 
 
 # For generating a gerber job json file
 class BoardOptions(BaseModel):
-    size: Optional[tuple] = (None,)
+    size: tuple | None = (None,)
     n_layers: int = (2,)
 
 
 resolutions = {1e-3: 3, 1e-4: 4, 1e-5: 5, 1e-6: 6}
 
 
 def number(n) -> str:
@@ -62,25 +61,25 @@
 def polygon(pp):
     return "G36*\n" + points(pp) + "G37*\n" + "\n"
 
 
 def to_gerber(
     component: Component,
     dirpath: Path,
-    layermap_to_gerber_layer: Dict[Tuple[int, int], GerberLayer],
+    layermap_to_gerber_layer: dict[tuple[int, int], GerberLayer],
     options: GerberOptions = Field(default_factory=dict),
 ) -> None:
     """Writes each layer to a different Gerber file.
 
     Args:
         component: to export.
         dirpath: directory path.
         layermap_to_gerber_layer: map of GDS layer to GerberLayer.
         options: to save.
-            header: Optional[List[str]] = None
+            header: List[str] | None = None
             mode: Literal["mm", "in"] = "mm"
             resolution: float = 1e-6
             int_size: int = 4
     """
     for layer_tup, layer in layermap_to_gerber_layer.items():
         filename = (dirpath / layer.name.replace(" ", "_")).with_suffix(".gbr")
         with open(filename, "w+") as f:
@@ -116,18 +115,17 @@
             # File end
             f.write("M02*\n")
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
     from gdsfactory.config import PATH
+    from gdsfactory.technology import LayerLevel, LayerStack, LayerView, LayerViews
     from gdsfactory.typings import Layer
 
-    from gdsfactory.technology import LayerStack, LayerLevel, LayerView, LayerViews
-
     class LayerMap(BaseModel):
         F_Cu: Layer = (1, 0)
         In1_Cu: Layer = (2, 0)
         In2_Cu: Layer = (3, 0)
         B_Cu: Layer = (4, 0)
         F_Silkscreen: Layer = (11, 0)
         F_Mask: Layer = (21, 0)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/export/to_np.py` & `gdsfactory-7.0.0/gdsfactory/export/to_np.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 from __future__ import annotations
 
-from typing import Optional
-
 import numpy as np
 
 from gdsfactory.component import Component
 from gdsfactory.typings import Floats, Layers
 
 
 def to_np(
     component: Component,
     nm_per_pixel: int = 20,
     layers: Layers = ((1, 0),),
-    values: Optional[Floats] = None,
+    values: Floats | None = None,
     pad_width: int = 1,
 ) -> np.ndarray:
     """Returns a pixelated numpy array from Component polygons.
 
     Args:
         component: Component.
         nm_per_pixel: you can go from 20 (coarse) to 4 (fine).
```

### Comparing `gdsfactory-6.99.0/gdsfactory/export/to_stl.py` & `gdsfactory-7.0.0/gdsfactory/export/to_stl.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,53 +1,55 @@
 from __future__ import annotations
 
 import pathlib
-from typing import Optional, Tuple
 
 from gdsfactory.component import Component
 from gdsfactory.technology import LayerStack
 from gdsfactory.typings import Layer
 
 
 def to_stl(
     component: Component,
     filepath: str,
-    layer_stack: Optional[LayerStack] = None,
-    exclude_layers: Optional[Tuple[Layer, ...]] = None,
+    layer_stack: LayerStack | None = None,
+    exclude_layers: tuple[Layer, ...] | None = None,
     use_layer_name: bool = False,
     hull_invalid_polygons: bool = True,
-    scale: Optional[float] = None,
+    scale: float | None = None,
 ) -> None:
     """Exports a Component into STL.
 
     Args:
         component: to export.
-        filepath: to write STL to.
+        filepath: filepath prefix to write STL to.
+            Each file will have each exported layer as suffix.
         layer_stack: contains thickness and zmin for each layer.
         exclude_layers: layers to exclude.
         use_layer_name: If True, uses LayerLevel names in output filenames rather than gds_layer and gds_datatype.
         hull_invalid_polygons: If True, replaces invalid polygons (determined by shapely.Polygon.is_valid) with its convex hull.
         scale: Optional factor by which to scale meshes before writing.
 
     """
     import shapely
     import trimesh.creation
+
     from gdsfactory.pdk import get_layer_stack
 
     layer_stack = layer_stack or get_layer_stack()
 
     layer_to_thickness = layer_stack.get_layer_to_thickness()
     layer_to_zmin = layer_stack.get_layer_to_zmin()
     filepath = pathlib.Path(filepath)
     exclude_layers = exclude_layers or []
 
     component_with_booleans = layer_stack.get_component_with_derived_layers(component)
     component_layers = component_with_booleans.get_layers()
     layer_names = list(layer_stack.layers.keys())
     layer_tuples = list(layer_stack.layers.values())
+
     for layer, polygons in component_with_booleans.get_polygons(by_spec=True).items():
         if (
             layer in exclude_layers
             or layer not in layer_to_thickness
             or layer not in layer_to_zmin
             or layer not in component_layers
         ):
```

### Comparing `gdsfactory-6.99.0/gdsfactory/fill.py` & `gdsfactory-7.0.0/gdsfactory/fill.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,31 +1,30 @@
 """Dummy fill to keep density constant.
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 from __future__ import annotations
 
 import itertools
-from typing import List, Optional, Union, Tuple
 
 import gdstk
 import numpy as np
 from numpy import sqrt
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.component_layout import _parse_layer
 from gdsfactory.components.rectangle import rectangle
 from gdsfactory.typings import (
+    ComponentOrReference,
+    ComponentSpec,
     Float2,
     Floats,
     LayerSpecs,
-    ComponentSpec,
-    ComponentOrReference,
 )
 
 
 def _loop_over(var):
     """Checks if a variable is in the form of an iterable (list/tuple)\
     and if not, returns it as a list.
 
@@ -152,20 +151,20 @@
 
 
 @cell
 def fill_rectangle(
     component: ComponentOrReference,
     fill_layers: LayerSpecs,
     fill_size=(5.0, 5.0),
-    avoid_layers: Optional[LayerSpecs] = None,
-    include_layers: Optional[LayerSpecs] = None,
+    avoid_layers: LayerSpecs | None = None,
+    include_layers: LayerSpecs | None = None,
     margin: float = 5.0,
-    fill_densities: Union[float, Floats] = (0.5, 0.25, 0.7),
-    fill_inverted: Optional[List[float]] = None,
-    bbox: Optional[object] = None,
+    fill_densities: float | Floats = (0.5, 0.25, 0.7),
+    fill_inverted: list[float] | None = None,
+    bbox: object | None = None,
 ) -> Component:
     """Returns rectangular fill pattern and fills all empty areas.
 
     In the input component and returns a component that contains just the fill
     Dummy fill keeps density constant during fabrication
 
     Args:
@@ -256,18 +255,18 @@
     return F
 
 
 @cell
 def fill_rectangle_custom(
     component: Component,
     fill_cell: ComponentSpec,
-    spacing: Tuple[float, float],
-    avoid_layers: Optional[LayerSpecs] = None,
+    spacing: tuple[float, float],
+    avoid_layers: LayerSpecs | None = None,
     margin: float = 5.0,
-    bbox: Optional[object] = None,
+    bbox: object | None = None,
 ) -> Component:
     """Returns custom fill pattern to fill all empty areas.
 
     In the input component and returns a component that contains just the fill
     Dummy fill keeps density constant during fabrication.
 
     Args:
@@ -314,15 +313,15 @@
                 x, y = _raster_index_to_coords(i, j, bbox, spacing[0], spacing[1])
                 a = F.add_array(fill_cell, columns=len(s), rows=1, spacing=spacing)
                 a.move((x, y))
             j += len(s)
     return F
 
 
-def test_fill():
+def test_fill() -> None:
     import gdsfactory as gf
     from gdsfactory.difftest import difftest
 
     c = gf.Component("test_fill")
     wg = c << gf.components.straight()
     c << gf.add_padding_container(wg.parent, default=15)
     fill = fill_rectangle(
@@ -331,15 +330,14 @@
         fill_densities=(1.0,),
         # fill_densities=0.5,
         avoid_layers=((1, 0),),
         # bbox=(100.0, 100.0),
     )
     c << fill
     difftest(c, test_name="fill")
-    return c
 
 
 if __name__ == "__main__":
     c = test_fill()
 
     mzi = gf.components.mzi()
     c = gf.Component("component_with_fill")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/font.py` & `gdsfactory-7.0.0/gdsfactory/font.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,24 +12,24 @@
 
 from gdsfactory.component import Component
 
 _cached_fonts = {}
 
 try:
     import freetype
-except ImportError as e:
-    raise ImportError(
+except ImportError:
+    print(
         "gdsfactory requires freetype to use real fonts. "
         "Either use the default DEPLOF font or install the freetype package:"
         "\n\n $ pip install freetype-py"
         "\n\n (Note: Windows users may have to find and replace the 'libfreetype.dll' "
         "file in their Python package directory /freetype/ with the correct one"
         "from here: https://github.com/ubawurinna/freetype-windows-binaries"
         " -- be sure to rename 'freetype.dll' to 'libfreetype.dll') "
-    ) from e
+    )
 
 
 def _get_font_by_file(file):
     """Load font file.
 
     Args:
         file [str, BinaryIO]: Load a font face from a given file
@@ -94,15 +94,15 @@
     polylines = []
     for contour in outline.contours:
         start = end + 1
         end = contour
 
         # Build up the letter as a curve
         cpoint = start
-        curve = gdstk.Curve(points[0], tolerance=0.001)
+        curve = gdstk.Curve(points[cpoint], tolerance=0.001)
         while cpoint <= end:
             # Figure out what sort of point we are looking at
             if tags[cpoint] & 1:
                 # We are at an on-curve control point. The next point may be
                 # another on-curve point, in which case we create a straight
                 # line interpolation, or it may be a quadratic or cubic
                 # bezier curve. But first we check if we are at the end of the array
```

### Comparing `gdsfactory-6.99.0/gdsfactory/functions.py` & `gdsfactory-7.0.0/gdsfactory/functions.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 """All functions return a Component so you can easily pipe or compose them.
 
 There are two types of functions:
 
 - decorators: return the original component
-- containers: return a new component
+- containers: return a new component that contains the old one.
 
 """
 from __future__ import annotations
 
 from functools import lru_cache, partial
 
 import numpy as np
@@ -22,16 +22,14 @@
 from gdsfactory.port import auto_rename_ports
 from gdsfactory.typings import (
     Anchor,
     Axis,
     ComponentSpec,
     Float2,
     LayerSpec,
-    List,
-    Optional,
     Strs,
 )
 
 cache = lru_cache(maxsize=None)
 
 
 def add_port(component: Component, **kwargs) -> Component:
@@ -70,19 +68,19 @@
 
     component_new.add_ports(ref.ports)
     component_new.copy_child_info(component)
     return component_new
 
 
 def add_texts(
-    components: List[ComponentSpec],
+    components: list[ComponentSpec],
     prefix: str = "",
     index0: int = 0,
     **kwargs,
-) -> List[Component]:
+) -> list[Component]:
     """Return a list of Component with text labels.
 
     Args:
         components: list of component specs.
         prefix: Optional prefix for the labels.
         index0: defaults to 0 (0, for first component, 1 for second ...).
 
@@ -165,15 +163,15 @@
 
 
 @cell
 def move(
     component: Component,
     origin=(0, 0),
     destination=None,
-    axis: Optional[Axis] = None,
+    axis: Axis | None = None,
 ) -> Component:
     """Return new Component with a moved reference to the original component.
 
     Args:
         component: to move.
         origin: of component.
         destination: Optional x, y.
@@ -226,16 +224,16 @@
     return component
 
 
 @validate_arguments
 def add_settings_label(
     component: ComponentSpec = straight,
     layer_label: LayerSpec = (66, 0),
-    settings: Optional[Strs] = None,
-    ignore: Optional[Strs] = ("decorator",),
+    settings: Strs | None = None,
+    ignore: Strs | None = ("decorator",),
 ) -> Component:
     """Add a settings label to a component. Use it as a decorator.
 
     Args:
         component: spec.
         layer_label: for label.
         settings: list of settings to include. if None, adds all changed settings.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/gdsdiff/gdsdiff.py` & `gdsfactory-7.0.0/gdsfactory/geometry/union.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,101 +1,102 @@
 from __future__ import annotations
 
-import itertools
-import pathlib
-from pathlib import Path
-from typing import Union
-
 import gdstk
 
+import gdsfactory as gf
 from gdsfactory.component import Component
-from gdsfactory.read.import_gds import import_gds
-
-COUNTER = itertools.count()
-
+from gdsfactory.typings import Layer
 
-def xor_polygons(A: Component, B: Component, hash_geometry: bool = True):
-    """Given two devices A and B, performs a layer-by-layer XOR diff between A \
-    and B, and returns polygons representing the differences between A and B.
 
-    Adapted from lytest/kdb_xor.py
+def _union_polygons(polygons, precision: float = 1e-4):
+    """Performs union of polygons within PolygonSet or list of polygons.
 
+    Args:
+        polygons : PolygonSet or list of polygons
+            A set containing the input polygons.
+        precision : float
+            Desired precision for rounding vertex coordinates.
+        max_points : int
+            The maximum number of vertices within the resulting polygon.
+
+    Returns:
+        unioned: polygon The result of the union of all the polygons
+            within the input PolygonSet.
     """
-    # first do a geometry hash to vastly speed up if they are equal
-    if hash_geometry and (A.hash_geometry() == B.hash_geometry()):
-        return Component()
-
-    D = Component()
-    A_polys = A.get_polygons(by_spec=True)
-    B_polys = B.get_polygons(by_spec=True)
-    A_layers = A_polys.keys()
-    B_layers = B_polys.keys()
-    all_layers = set()
-    all_layers.update(A_layers)
-    all_layers.update(B_layers)
-    for layer in all_layers:
-        if (layer in A_layers) and (layer in B_layers):
-            p = gdstk.boolean(
-                A_polys[layer],
-                B_polys[layer],
-                operation="xor",
-                precision=0.001,
-                layer=layer[0],
-                datatype=layer[1],
-            )
-        elif layer in A_layers:
-            p = A_polys[layer]
-        elif layer in B_layers:
-            p = B_polys[layer]
-        if p is not None:
-            for polygon in p:
-                D.add_polygon(polygon, layer=layer)
-    return D
+    return gdstk.boolean(
+        polygons,
+        [],
+        operation="or",
+        precision=precision,
+    )
 
 
-def gdsdiff(
-    component1: Union[Path, Component, str],
-    component2: Union[Path, Component, str],
-    name: str = "TOP",
-    xor: bool = True,
+@gf.cell
+def union(
+    component: Component,
+    by_layer: bool = False,
+    precision: float = 1e-4,
+    join_first: bool = True,
+    layer: Layer = (1, 0),
 ) -> Component:
-    """Returns two Components overlay and diffs (XOR).
+    """Returns new Component with inverted union of Component polygons.
 
-    Args:
-        component1: Component or path to gds file (reference).
-        component2: Component or path to gds file (run).
-        name: name of the top cell.
-        xor: if True includes boolean operation.
+    based on phidl.geometry.union
 
+    Args:
+        component: Component(/Reference), list of Component(/Reference), or Polygon
+            A containing the polygons to perform union and inversion on.
+        by_Layer: performs the union operation layer-wise so each layer can be
+            individually combined.
+        precision: Desired precision for rounding vertex coordinates.
+        join_first: before offsetting to avoid unnecessary joins
+            in adjacent polygons.
+        layer: Specific layer to put polygon geometry on.
+
+    .. plot::
+      :include-source:
+
+      import gdsfactory as gf
+      c = gf.Component()
+      c << gf.components.ellipse(radii=(6, 6))
+      c << gf.components.ellipse(radii=(10, 4))
+      c2 = gf.geometry.union(c, join_first=False)
     """
-    if isinstance(component1, (str, pathlib.Path)):
-        component1 = import_gds(str(component1), flatten=True, name=f"{name}_old")
-    if isinstance(component2, (str, pathlib.Path)):
-        component2 = import_gds(str(component2), flatten=True, name=f"{name}_new")
-
-    component1 = component1.copy()
-    component2 = component2.copy()
-
-    component1.name = f"{name}_old"
-    component2.name = f"{name}_new"
-
-    top = Component(name=f"{name}_diffs")
-    ref1 = top << component1
-    ref2 = top << component2
-
-    if xor:
-        diff = xor_polygons(ref1, ref2, hash_geometry=False)
-        diff.name = f"{name}_xor"
-        top.add_ref(diff)
+    U = Component()
+
+    if by_layer:
+        all_polygons = component.get_polygons(by_spec=True)
+        for layer, polygons in all_polygons.items():
+            unioned_polygons = _union_polygons(
+                polygons,
+                precision=precision,
+            )
+            U.add_polygon(unioned_polygons, layer=layer)
+    else:
+        all_polygons = component.get_polygons(by_spec=False)
+        unioned_polygons = (
+            _union_polygons(
+                all_polygons,
+                precision=precision,
+            )
+            if join_first
+            else all_polygons
+        )
+        U.add_polygon(unioned_polygons, layer=layer)
+    return U
 
-    return top
 
+def test_union() -> None:
+    c = Component()
+    c << gf.components.ellipse(radii=(6, 6))
+    c << gf.components.ellipse(radii=(10, 4))
+    c2 = union(c)
+    assert int(c2.area()) == 153, c2.area()
 
-if __name__ == "__main__":
-    import sys
 
-    if len(sys.argv) != 3:
-        print("Usage: gdsdiff <mask_v1.gds> <mask_v2.gds>")
-        print("Note that you need to have KLayout opened with klive running")
-        sys.exit()
-    c = gdsdiff(sys.argv[1], sys.argv[2])
-    c.show(show_ports=True)
+if __name__ == "__main__":
+    test_union()
+    c = Component()
+    c << gf.components.ellipse(radii=(6, 6))
+    c << gf.components.ellipse(radii=(10, 4))
+    c2 = union(c, join_first=False)
+    c2.show()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/README.md` & `gdsfactory-7.0.0/gdsfactory/generic_tech/README.md`

 * *Files 22% similar despite different names*

```diff
@@ -1,11 +1,8 @@
-# Gdsfactory Generic Technology
-
-This folder is for the Generic KLayout Technology for Gdsfactory
-
+# gdsfactory Generic PDK
 
 ## Usage
 
 To be able to use KLayout Technology, you need to do the following steps:
 
 - Define some environment variables
 
@@ -31,9 +28,8 @@
 You could trace your nets using klayout net tracer after loading your generic tech.
 
 - After opening your layout, from Tools menu, select Trace Net.
 
 As shown, you need to click on Trace Net and select from layout your desired net that you want to trace.
 
 ![image](https://user-images.githubusercontent.com/91015308/236182447-3c9f4fb9-9c0f-4c2e-9016-653cd112464f.png)
-
 ![image](https://user-images.githubusercontent.com/91015308/236182554-c368d277-8fff-4358-8cf5-d3a8d21bbb08.png)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/__init__.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/__init__.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 from __future__ import annotations
 
 import typing
+
+from gdsfactory.config import PATH
 from gdsfactory.generic_tech.layer_map import GenericLayerMap as LayerMap
 from gdsfactory.generic_tech.layer_stack import LAYER_STACK
 from gdsfactory.technology import LayerViews
-from gdsfactory.config import PATH
 
 if typing.TYPE_CHECKING:
     from gdsfactory.pdk import Pdk
 
 LAYER = LayerMap()
 
 PORT_MARKER_LAYER_TO_TYPE = {
@@ -36,29 +37,35 @@
     LAYER.M3: "taper",
     # (LAYER.)
 }
 
 
 def get_generic_pdk() -> Pdk:
     from gdsfactory.components import cells
-    from gdsfactory.config import sparameters_path, PATH
+    from gdsfactory.config import PATH, sparameters_path
     from gdsfactory.cross_section import cross_sections
+    from gdsfactory.generic_tech.containers import containers
+    from gdsfactory.generic_tech.simulation_settings import materials_index
     from gdsfactory.pdk import Pdk, constants
 
     LAYER_VIEWS = LayerViews(filepath=PATH.klayout_yaml)
 
+    cells = cells.copy()
+    cells.update(containers)
+
     return Pdk(
         name="generic",
         cells=cells,
         cross_sections=cross_sections,
         layers=LAYER.dict(),
         layer_stack=LAYER_STACK,
         layer_views=LAYER_VIEWS,
         layer_transitions=LAYER_TRANSITIONS,
         sparameters_path=sparameters_path,
+        materials_index=materials_index,
         constants=constants,
     )
 
 
 if __name__ == "__main__":
     layer_views = LayerViews(filepath=PATH.klayout_yaml)
     layer_views.to_lyp(PATH.klayout_lyp)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/get_klayout_pyxs.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/get_klayout_pyxs.py`

 * *Files 2% similar despite different names*

```diff
@@ -3,22 +3,21 @@
 https://gdsfactory.github.io/klayout_pyxs/DocGrow.html
 
 """
 
 from __future__ import annotations
 
 import pathlib
-from typing import Tuple
 
 from gdsfactory.generic_tech import LAYER
 
 nm = 1e-3
 
 
-def layer_to_string(layer: Tuple[int, int]) -> str:
+def layer_to_string(layer: tuple[int, int]) -> str:
     return f"{layer[0]}/{layer[1]}"
 
 
 def get_klayout_pyxs(
     t_box=1.0,
     t_slab=90 * nm,
     t_si=0.22,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/drc/errors.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/drc/errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/grain.xml`

 * *Files 1% similar despite different names*

#### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/grain.xml`

```diff
@@ -1,13 +1,13 @@
 <?xml version="1.0" encoding="utf-8"?>
 <salt-grain>
   <name>gdsfactory</name>
   <token/>
   <hidden>false</hidden>
-  <version>6.99.0</version>
+  <version>7.0.0</version>
   <api-version/>
   <title>gdsfactory</title>
   <doc>EDA tool to layout integrated circuits</doc>
   <doc-url>https://gdsfactory.github.io/gdsfactory/</doc-url>
   <url>https://github.com/gdsfactory/gdsfactory</url>
   <license>MIT</license>
   <author>Joaquin Matres</author>
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/icon_128x128.png` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/icon_128x128.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/icon_64x64.png` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/icon_64x64.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/README.md` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/generic_tech_malformed.drc`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/drc_malformed/run_drc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/generic_tech.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/custom_classes.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/general_connections.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/heater_extraction.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/rule_decks/layers_definitions.lvs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/run_lvs.py`

 * *Files 2% similar despite different names*

```diff
@@ -15,21 +15,22 @@
     --lvs_sub=<sub_name>                Substrate name used in your design.
     --verbose                           Detailed rule execution log for debugging.
     --no_net_names                      Discard net names in extracted netlist.
     --spice_comments                    Enable netlist comments in extracted netlist.
     --scale                             Enable scale of 1e6 in extracted netlist.
 """
 
-from docopt import docopt
-import os
 import logging
-import klayout.db
+import os
 from datetime import datetime
 from subprocess import check_call
 
+import klayout.db
+from docopt import docopt
+
 
 def check_klayout_version() -> None:
     """
     check_klayout_version checks klayout version and makes sure it would work with the LVS.
     """
     # ======= Checking Klayout version =======
     klayout_v_ = os.popen("klayout -b -v").read()
@@ -336,15 +337,15 @@
         lvs_run_dir = os.path.abspath(arguments["--run_dir"])
 
     os.makedirs(lvs_run_dir, exist_ok=True)
 
     logging.basicConfig(
         level=logging.DEBUG,
         handlers=[
-            logging.FileHandler(os.path.join(lvs_run_dir, "{}.log".format(now_str))),
+            logging.FileHandler(os.path.join(lvs_run_dir, f"{now_str}.log")),
             logging.StreamHandler(),
         ],
         format="%(asctime)s | %(levelname)-7s | %(message)s",
         datefmt="%d-%b-%Y %H:%M:%S",
     )
 
     # Calling main function
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/layout/straight_heater_metal.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,11 @@
-import gdsfactory as gf
 import os
 
+import gdsfactory as gf
+
 straight_heater_metal_mk = (47, 1)
 m3_cross_section = gf.CrossSection(
     layer=(49, 0),
     width=10,
 )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/lvs/testing/testcases/unit/heater_devices/netlist/straight_heater_metal.spice`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

 * *Files 15% similar despite different names*

#### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

```diff
@@ -12,15 +12,15 @@
   <show-in-menu>false</show-in-menu>
   <group-name/>
   <menu-path>gdsfactory.begin</menu-path>
   <interpreter>python</interpreter>
   <dsl-interpreter-name/>
   <text>import pya
 
-__version__ = &quot;6.99.0&quot;
+__version__ = &quot;7.0.0&quot;
 
 
 def set_menu():
     menu = pya.Application.instance().main_window().menu()
 
     s0 = &quot;gdsfactory&quot;
     if not (menu.is_menu(s0)):
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py`

 * *Files 0% similar despite different names*

```diff
@@ -67,15 +67,15 @@
     # turn the hash back into a config string
     config = "".join(f"{key}:{val};" for key, val in sorted(mapping.items()))[:-1]
     pya.Application.instance().set_config("key-bindings", config)
     pya.Application.instance().set_config("edit-connect-angle-mode", "ortho")
     pya.Application.instance().set_config("edit-inst-angle", "0")
     # pya.Application.instance().set_config("edit-move-angle-mode", "diagonal")
     pya.Application.instance().set_config("edit-snap-to-objects", "true")
-    pya.Application.instance().set_config("grid-micron", "0.01")
+    pya.Application.instance().set_config("grid-micron", "0.001")
     pya.Application.instance().set_config("edit-top-level-selection", "true")
     pya.Application.instance().set_config("inst-color", "#ffcdcd")
     pya.Application.instance().set_config("text-font", "3")
     pya.Application.instance().set_config("guiding-shape-line-width", "0")
     pya.Application.instance().set_config("rdb-marker-color", "#ff0000")
     pya.Application.instance().set_config("rdb-marker-line-width", "8")
     #    pya.Application.instance().set_config('default-layer-properties', os.path.join(os.path.realpath(__file__), os.pardir, os.pardir, os.pardir, 'libraries', 'klayout_Layers_EBeam.lyp'))
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/d25/generic.lyd25`

 * *Files 4% similar despite different names*

```diff
@@ -1,9 +1,7 @@
-# 'generic_tech' 2.5D script generated by GDSFactory
-
 substrate = input(99999, 0)
 box = input(99999, 0)
 core = input(1, 0)
 shallow_etch = input(2, 6)
 deep_etch = input(3, 6)
 clad = input(99999, 0)
 slab150 = input(2, 0)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/layers.lyp` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/layers.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/tech.lyt` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/tech.lyt`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs` & `gdsfactory-7.0.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/layer_map.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/layer_map.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,10 @@
-from typing import Tuple
-
 from pydantic import BaseModel
 
-Layer = Tuple[int, int]
+Layer = tuple[int, int]
 
 
 class GenericLayerMap(BaseModel):
     """Generic layermap based on book.
 
     Lukas Chrostowski, Michael Hochberg, "Silicon Photonics Design",
     Cambridge University Press 2015, page 353
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/layer_stack.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/layer_stack.py`

 * *Files 0% similar despite different names*

```diff
@@ -55,22 +55,22 @@
 
     class GenericLayerStack(LayerStack):
         substrate = LayerLevel(
             layer=LAYER.WAFER,
             thickness=substrate_thickness,
             zmin=-substrate_thickness - box_thickness,
             material="si",
-            mesh_order=99,
+            mesh_order=101,
         )
         box = LayerLevel(
             layer=LAYER.WAFER,
             thickness=box_thickness,
             zmin=-box_thickness,
             material="sio2",
-            mesh_order=99,
+            mesh_order=9,
         )
         core = LayerLevel(
             layer=LAYER.WG,
             thickness=thickness_wg,
             zmin=0.0,
             material="si",
             mesh_order=2,
@@ -161,22 +161,22 @@
             mesh_order=2,
         )
         heater = LayerLevel(
             layer=LAYER.HEATER,
             thickness=750e-3,
             zmin=zmin_heater,
             material="TiN",
-            mesh_order=1,
+            mesh_order=2,
         )
         via1 = LayerLevel(
             layer=LAYER.VIA1,
             thickness=zmin_metal2 - (zmin_metal1 + thickness_metal1),
             zmin=zmin_metal1 + thickness_metal1,
             material="Aluminum",
-            mesh_order=2,
+            mesh_order=1,
         )
         metal2 = LayerLevel(
             layer=LAYER.M2,
             thickness=thickness_metal2,
             zmin=zmin_metal2,
             material="Aluminum",
             mesh_order=2,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/generic_tech/layer_views.yaml` & `gdsfactory-7.0.0/gdsfactory/generic_tech/layer_views.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/__init__.py` & `gdsfactory-7.0.0/gdsfactory/geometry/__init__.py`

 * *Ordering differences only*

 * *Files 1% similar despite different names*

```diff
@@ -1,29 +1,29 @@
 """Geometric operations: Booleans, DRC checks."""
 
 from __future__ import annotations
 
 from gdsfactory.geometry import functions
 from gdsfactory.geometry.boolean import boolean
-from gdsfactory.geometry.boolean_polygons import boolean_polygons
 from gdsfactory.geometry.boolean_klayout import boolean_klayout
+from gdsfactory.geometry.boolean_polygons import boolean_polygons
 from gdsfactory.geometry.check_duplicated_cells import check_duplicated_cells
 from gdsfactory.geometry.check_exclusion import check_exclusion
 from gdsfactory.geometry.check_inclusion import check_inclusion
 from gdsfactory.geometry.check_space import check_space
 from gdsfactory.geometry.check_width import check_width
 from gdsfactory.geometry.fillet import fillet
 from gdsfactory.geometry.invert import invert
 from gdsfactory.geometry.layer_priority import layer_priority
+from gdsfactory.geometry.manhattanize import manhattanize_polygon
 from gdsfactory.geometry.offset import offset
 from gdsfactory.geometry.outline import outline
 from gdsfactory.geometry.trim import trim
 from gdsfactory.geometry.union import union
 from gdsfactory.geometry.xor_diff import xor_diff
-from gdsfactory.geometry.manhattanize import manhattanize_polygon
 
 __all__ = (
     "boolean",
     "boolean_klayout",
     "boolean_polygons",
     "check_duplicated_cells",
     "check_exclusion",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/boolean.py` & `gdsfactory-7.0.0/gdsfactory/geometry/boolean.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 """Based on phidl.geometry."""
 from __future__ import annotations
 
-from typing import Tuple, Union
-
 import gdstk
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.component_layout import Polygon
 from gdsfactory.component_reference import ComponentReference
 from gdsfactory.typings import ComponentOrReference, LayerSpec
 
 
 @gf.cell
 def boolean(
-    A: Union[ComponentOrReference, Tuple[ComponentOrReference, ...]],
-    B: Union[ComponentOrReference, Tuple[ComponentOrReference, ...]],
+    A: ComponentOrReference | tuple[ComponentOrReference, ...],
+    B: ComponentOrReference | tuple[ComponentOrReference, ...],
     operation: str,
     precision: float = 1e-4,
     layer: LayerSpec = (1, 0),
 ) -> Component:
     """Performs boolean operations between 2 Component/Reference/list objects.
 
     ``operation`` should be one of {'not', 'and', 'or', 'xor', 'A-B', 'B-A', 'A+B'}.
@@ -56,20 +54,20 @@
       c = gf.geometry.boolean(c1, c2, operation="xor")
       c.plot_matplotlib()
 
     """
     D = Component()
     A_polys = []
     B_polys = []
-    A = list(A) if isinstance(A, (list, tuple)) else [A]
-    B = list(B) if isinstance(B, (list, tuple)) else [B]
+    A = list(A) if isinstance(A, list | tuple) else [A]
+    B = list(B) if isinstance(B, list | tuple) else [B]
 
     for X, polys in ((A, A_polys), (B, B_polys)):
         for e in X:
-            if isinstance(e, (Component, ComponentReference)):
+            if isinstance(e, Component | ComponentReference):
                 polys.extend(e.get_polygons())
             elif isinstance(e, Polygon):
                 polys.extend(e.polygons)
 
     gds_layer, gds_datatype = gf.pdk.get_layer(layer)
 
     operation = operation.lower().replace(" ", "")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/boolean_klayout.py` & `gdsfactory-7.0.0/gdsfactory/geometry/boolean_klayout.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,27 @@
 from __future__ import annotations
 
 import pathlib
 import tempfile
 import uuid
-from typing import Tuple
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import ComponentOrPath
 
 valid_operations = ("xor", "not", "and", "or")
 
 
 @gf.cell
 def boolean_klayout(
     gdspath1: ComponentOrPath,
     gdspath2: ComponentOrPath,
-    layer1: Tuple[int, int] = (1, 0),
-    layer2: Tuple[int, int] = (1, 0),
-    layer3: Tuple[int, int] = (2, 0),
+    layer1: tuple[int, int] = (1, 0),
+    layer2: tuple[int, int] = (1, 0),
+    layer3: tuple[int, int] = (2, 0),
     operation: str = "xor",
 ) -> Component:
     """Returns a boolean operation between two components Uses KLayout python API.
 
     Args:
         gdspath1: path to GDS or Component.
         gdspath2: path to GDS or Component.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/boolean_polygons.py` & `gdsfactory-7.0.0/gdsfactory/geometry/boolean_polygons.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,24 +1,22 @@
 from __future__ import annotations
 
-from typing import Union, List
-
 import gdstk
 
 import gdsfactory as gf
 from gdsfactory.typings import Component, ComponentReference, LayerSpec
 
 
 def boolean_polygons(
-    operand1: Union[ComponentReference, Component, gdstk.Polygon],
-    operand2: Union[ComponentReference, Component, gdstk.Polygon],
+    operand1: ComponentReference | Component | gdstk.Polygon,
+    operand2: ComponentReference | Component | gdstk.Polygon,
     operation: str,
     output_layer: LayerSpec = (0, 0),
     precision: float = 1e-3,
-) -> List[gdstk.Polygon]:
+) -> list[gdstk.Polygon]:
     """Perform a boolean operation and return the list of resulting Polygons.
     See [gdstk docs](https://heitzmann.github.io/gdstk/geometry/gdstk.boolean.html#gdstk.boolean) for details.
 
     Args:
         operand1: polygon set A.
         operand2: polygon set B.
         operation: the name of the operation to perform, i.e. "or", "and", "not", or "xor".
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/check_duplicated_cells.py` & `gdsfactory-7.0.0/gdsfactory/geometry/check_duplicated_cells.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 from __future__ import annotations
 
 from pathlib import Path
-from typing import Union
 
 
-def check_duplicated_cells(gdspath: Union[Path, str]):
+def check_duplicated_cells(gdspath: Path | str):
     """Reads cell and checks for duplicated cells.
 
     klayout will fail to load the layout if it finds any duplicated cells.
 
     Args:
         gdspath: path to GDS or Component
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/check_exclusion.py` & `gdsfactory-7.0.0/gdsfactory/geometry/check_exclusion.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 from gdsfactory.typings import ComponentOrPath
 
 
 def check_exclusion(
     gdspath: ComponentOrPath,
-    layer1: Tuple[int, int] = (1, 0),
-    layer2: Tuple[int, int] = (2, 0),
+    layer1: tuple[int, int] = (1, 0),
+    layer2: tuple[int, int] = (2, 0),
     min_space: float = 0.150,
     dbu: float = 1e3,
     ignore_angle_deg: int = 80,
     whole_edges: bool = False,
     metrics: str = "Square",
     min_projection: None = None,
     max_projection: None = None,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/check_inclusion.py` & `gdsfactory-7.0.0/gdsfactory/geometry/check_inclusion.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 from gdsfactory.typings import ComponentOrPath
 
 
 def check_inclusion(
     gdspath: ComponentOrPath,
-    layer_in: Tuple[int, int] = (1, 0),
-    layer_out: Tuple[int, int] = (2, 0),
+    layer_in: tuple[int, int] = (1, 0),
+    layer_out: tuple[int, int] = (2, 0),
     min_inclusion: float = 0.150,
     dbu: float = 1e3,
     ignore_angle_deg: int = 80,
     whole_edges: bool = False,
     metrics: str = "Square",
     min_projection: None = None,
     max_projection: None = None,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/check_space.py` & `gdsfactory-7.0.0/gdsfactory/geometry/check_space.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 from gdsfactory.component import Component
 from gdsfactory.typings import ComponentOrPath
 
 
 def check_space(
     gdspath: ComponentOrPath,
-    layer: Tuple[int, int] = (1, 0),
+    layer: tuple[int, int] = (1, 0),
     min_space: float = 0.150,
     dbu: float = 1e3,
     ignore_angle_deg: int = 80,
     whole_edges: bool = False,
     metrics: str = "Square",
     min_projection: None = None,
     max_projection: None = None,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/check_width.py` & `gdsfactory-7.0.0/gdsfactory/geometry/check_width.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,18 +1,17 @@
 from __future__ import annotations
 
 from pathlib import Path
-from typing import Tuple, Union
 
 from gdsfactory.component import Component
 
 
 def check_width(
-    gdspath: Union[Path, Component, str],
-    layer: Tuple[int, int] = (1, 0),
+    gdspath: Path | Component | str,
+    layer: tuple[int, int] = (1, 0),
     min_width: float = 0.150,
     dbu: float = 1e3,
 ) -> int:
     """Reads layer from top cell and returns a number of edges violating min width.
 
     Args:
         gdspath: path to GDS or Component.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/fill_klayout.py` & `gdsfactory-7.0.0/gdsfactory/geometry/fill_klayout.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,30 +1,28 @@
 """Dummy fill to keep density constant using klayout."""
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import gdsfactory as gf
-from gdsfactory.typings import PathType, LayerSpecs, LayerSpec
+from gdsfactory.typings import LayerSpec, LayerSpecs, PathType
 
 
 def fill(
     gdspath,
     layer_to_fill: LayerSpec,
     layer_to_fill_margin: float = 0,
-    layers_to_avoid: Optional[Tuple[LayerSpec, float], ...] = None,
-    cell_name: Optional[str] = None,
+    layers_to_avoid: tuple[LayerSpec, float] | None = None,
+    cell_name: str | None = None,
     fill_cell_name: str = "fill_cell",
     create_new_fill_cell: bool = False,
     include_original: bool = False,
-    fill_layers: Optional[LayerSpecs] = None,
-    fill_size: Tuple[float, float] = (10, 10),
-    fill_spacing: Tuple[float, float] = (20, 20),
-    fill_name: Optional[str] = None,
-    gdspath_out: Optional[PathType] = None,
+    fill_layers: LayerSpecs | None = None,
+    fill_size: tuple[float, float] = (10, 10),
+    fill_spacing: tuple[float, float] = (20, 20),
+    fill_name: str | None = None,
+    gdspath_out: PathType | None = None,
 ) -> None:
     """Write gds file with fill.
 
     Args:
         gdspath: GDS input.
         layer_to_fill: Layer that defines the region to fill.
         layer_to_fill_margin: in um.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/fill_tiled.py` & `gdsfactory-7.0.0/gdsfactory/geometry/fill_tiled.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,32 +1,32 @@
-from typing import Iterable, Optional
+from collections.abc import Iterable
 
 try:
     import kfactory as kf
-    from kfactory import KCell, KCLayout, LayerEnum, kdb
+    from kfactory import KCell, LayerEnum, kcl, kdb
     from kfactory.conf import logger
 except ImportError as e:
     print(
         "You can install `pip install gdsfactory[kfactory]` for using maskprep. "
         "And make sure you use python >= 3.10"
     )
     raise e
 
 
 class FillOperator(kdb.TileOutputReceiver):
     def __init__(
         self,
-        kcl: KCLayout,
+        kcl: kcl,
         top_cell: KCell,
         fill_cell_index: int,
         fc_bbox: kdb.Box,
         row_step: kdb.Vector,
         column_step: kdb.Vector,
         fill_margin: kdb.Vector = kdb.Vector(0, 0),
-        remaining_polygons: Optional[kdb.Region] = None,
+        remaining_polygons: kdb.Region | None = None,
     ) -> None:
         self.kcl = kcl
         self.top_cell = top_cell
         self.fill_cell_index = fill_cell_index
         self.fc_bbox = fc_bbox
         self.row_step = row_step
         self.column_step = column_step
@@ -62,15 +62,15 @@
     c: KCell,
     fill_cell: KCell,
     fill_layers: Iterable[tuple[LayerEnum | int, int]] = [],
     fill_regions: Iterable[tuple[kdb.Region, int]] = [],
     exclude_layers: Iterable[tuple[LayerEnum | int, int]] = [],
     exclude_regions: Iterable[tuple[kdb.Region, int]] = [],
     n_threads: int = 4,
-    tile_size: Optional[tuple[float, float]] = None,
+    tile_size: tuple[float, float] | None = None,
     x_space: float = 0,
     y_space: float = 0,
 ) -> None:
     tp = kdb.TilingProcessor()
     tp.frame = c.bbox().to_dtype(c.kcl.dbu)  # type: ignore
     tp.dbu = c.kcl.dbu
     tp.threads = n_threads
@@ -184,16 +184,16 @@
             tp.execute(f"Fill {c.name}")
             logger.info("done with filling {}", c.name)
         finally:
             c.kcl.end_changes()
 
 
 if __name__ == "__main__":
-    import gdsfactory.geometry.fill_tiled as fill
     import gdsfactory as gf
+    import gdsfactory.geometry.fill_tiled as fill
 
     c = kf.KCell("ToFill")
     c.shapes(kf.kcl.layer(1, 0)).insert(
         kf.kdb.DPolygon.ellipse(kf.kdb.DBox(5000, 3000), 512)
     )
     c.shapes(kf.kcl.layer(10, 0)).insert(
         kf.kdb.DPolygon(
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/fillet.py` & `gdsfactory-7.0.0/gdsfactory/geometry/fillet.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,21 +1,19 @@
 from __future__ import annotations
 
-from typing import Union, List
-
 import gdstk
 
 from gdsfactory.typings import Component, ComponentReference
 
 
 def fillet(
-    operand: Union[ComponentReference, Component, gdstk.Polygon, List[gdstk.Polygon]],
-    radius: Union[float, List[float]],
+    operand: ComponentReference | Component | gdstk.Polygon | list[gdstk.Polygon],
+    radius: float | list[float],
     tolerance: float = 0.01,
-) -> List[gdstk.Polygon]:
+) -> list[gdstk.Polygon]:
     """Perform a fillet operation and return the list of resulting Polygons.
 
     Args:
         operand: polygon, list of Polygons, Component, or ComponentReference.
         radius: Fillet radius. You can also define a value for each vertex.
         tolerance: for calculating the polygonal approximation of the filleted corners.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/functions.py` & `gdsfactory-7.0.0/gdsfactory/geometry/functions.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional, Union
-
 import numpy as np
 from numpy import cos, float64, ndarray, sin
 
 RAD2DEG = 180.0 / np.pi
 DEG2RAD = 1 / RAD2DEG
 
 
@@ -160,18 +158,18 @@
     return angles_rad(pts) * RAD2DEG
 
 
 def extrude_path(
     points: ndarray,
     width: float,
     with_manhattan_facing_angles: bool = True,
-    spike_length: Union[float64, int, float] = 0,
-    start_angle: Optional[int] = None,
-    end_angle: Optional[int] = None,
-    grid: Optional[float] = None,
+    spike_length: float64 | int | float = 0,
+    start_angle: int | None = None,
+    end_angle: int | None = None,
+    grid: float | None = None,
 ) -> ndarray:
     """Deprecated. Use gdsfactory.path.Path.extrude() instead.
 
     Extrude a path of `width` along a curve defined by `points`.
 
     Args:
         points: numpy 2D array of shape (N, 2).
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/invert.py` & `gdsfactory-7.0.0/gdsfactory/geometry/invert.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/layer_priority.py` & `gdsfactory-7.0.0/gdsfactory/geometry/layer_priority.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 import numpy as np
+
 import gdsfactory as gf
-from gdsfactory.typings import LayerSpec, ComponentSpec
+from gdsfactory.typings import ComponentSpec, LayerSpec
 
 
 @gf.cell
 def layer_priority(
     component: ComponentSpec,
     layer_high_order: LayerSpec,
     layer_low_order: LayerSpec,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/manhattanize.py` & `gdsfactory-7.0.0/gdsfactory/geometry/manhattanize.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,11 +1,12 @@
-import gdsfactory as gf
-from gdstk import Polygon
-import numpy as np
 import gdstk
+import numpy as np
+from gdstk import Polygon
+
+import gdsfactory as gf
 
 
 def manhattanize_polygon(
     p: Polygon,
     target_step: float = 0.05,
 ):
     """Return a Manhattanized version of the input polygon (where non-x and non-y parallel segments are decomposed into a staircase of small x and y-parallel segments)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/maskprep.py` & `gdsfactory-7.0.0/gdsfactory/geometry/maskprep.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,32 +1,33 @@
 from functools import partial
 
 import gdstk
+
 import gdsfactory as gf
 from gdsfactory.typings import (
-    LayerSpecs,
-    Floats,
-    List,
     Component,
     ComponentOrReference,
     ComponentSpec,
+    Floats,
+    LayerSpecs,
 )
 
 
 def get_polygons_over_under(
     component: ComponentOrReference,
     layers: LayerSpecs,
     distances: Floats,
     use_union: bool = True,
     precision: float = 1e-4,
     join: str = "miter",
     tolerance: int = 2,
-) -> List[gdstk.Polygon]:
+) -> list[gdstk.Polygon]:
     """Returns list polygons dilated and eroded by an offset.
     Cleans min width gap and acute angle DRC errors equal to distances.
+
     Args:
         component: Component containing polygons to offset.
         layers: list of layers to remove min gap errors.
         distances: Distance to offset polygons.
             By expanding and shrinking it merges polygons.
             If you want to fix min gaps of 0.5 use 0.5.
         precision: Desired precision for rounding vertex coordinates.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/maskprep_flat.py` & `gdsfactory-7.0.0/gdsfactory/geometry/maskprep_flat.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,19 +1,19 @@
 try:
     import kfactory as kf
     from kfactory import kdb
 except ImportError as e:
     print(
-        "You can install `pip install gdsfactory[full]` for using maskprep. "
+        "You can install `pip install gdsfactory[kfactory]` for using maskprep. "
         "And make sure you use python >= 3.10"
     )
     raise e
 
-from gdsfactory.typings import Dict, Layer, PathType, Tuple, LayerSpecs
-from typing import Optional
+
+from gdsfactory.typings import Dict, Layer, LayerSpecs, PathType, Tuple
 
 
 def size(region: kdb.Region, offset: float):
     return region.dup().size(int(offset * 1e3))
 
 
 def boolean_or(region1: kdb.Region, region2: kdb.Region):
@@ -34,24 +34,24 @@
         return size(self, offset)
 
     def __isub__(self, offset):
         """Adds an offset to the layer."""
         return size(self, offset)
 
     def __add__(self, element):
-        if isinstance(element, (float, int)):
+        if isinstance(element, float | int):
             return size(self, element)
 
         elif isinstance(element, kdb.Region):
             return boolean_or(self, element)
         else:
             raise ValueError(f"Cannot add type {type(element)} to region")
 
     def __sub__(self, element):
-        if isinstance(element, (float, int)):
+        if isinstance(element, float | int):
             return size(self, -element)
 
         elif isinstance(element, kdb.Region):
             return boolean_not(self, element)
 
     def copy(self):
         return self.dup()
@@ -61,17 +61,15 @@
     """RegionCollection of region per layer.
 
     Args:
         layermap: dict of layernames to layer numbers {'WG': (1, 0)}
         filepath: to read GDS from.
     """
 
-    def __init__(
-        self, layermap: Dict[str, Layer], filepath: Optional[PathType] = None
-    ) -> None:
+    def __init__(self, layermap: Dict[str, Layer], filepath: PathType) -> None:
         lib = kf.kcell.KCLayout()
         lib.read(filename=str(filepath))
         c = lib[0]
 
         for layername, layer in layermap.items():
             region = Region()
             layer = lib.layer(layer[0], layer[1])
@@ -139,19 +137,20 @@
         fill = kf.KCell(fill_name)
         return fill.fill_region(
             region, fc_index, fc_box, None, region, fill_margin, None
         )
 
 
 if __name__ == "__main__":
-    from gdsfactory.generic_tech.layer_map import LAYER as l
-    import gdsfactory.geometry.maskprep_flat as dp
-    import gdsfactory as gf
     import kfactory as kf
 
+    import gdsfactory as gf
+    import gdsfactory.geometry.maskprep_flat as dp
+    from gdsfactory.generic_tech.layer_map import LAYER as l
+
     c = gf.Component()
     ring = c << gf.components.coupler_ring()
     floorplan = c << gf.components.bbox(ring.bbox, layer=l.FLOORPLAN)
     c.write_gds("src.gds")
 
     d = dp.RegionCollection(filepath="src.gds", layermap=dict(l))
     fill_cell = d.get_fill(
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/offset.py` & `gdsfactory-7.0.0/gdsfactory/geometry/offset.py`

 * *Files 8% similar despite different names*

```diff
@@ -55,17 +55,17 @@
       c.plot_matplotlib()
 
     """
     if not isinstance(elements, list):
         elements = [elements]
     polygons_to_offset = []
     for e in elements:
-        if isinstance(e, (Component, ComponentReference)):
+        if isinstance(e, Component | ComponentReference):
             polygons_to_offset += e.get_polygons(by_spec=False)
-        elif isinstance(e, (Polygon, gdstk.Polygon)):
+        elif isinstance(e, Polygon | gdstk.Polygon):
             polygons_to_offset.append(e)
     if len(polygons_to_offset) == 0:
         return gf.Component("offset")
 
     gds_layer, gds_datatype = gf.get_layer(layer)
     p = gdstk.offset(
         polygons_to_offset,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/outline.py` & `gdsfactory-7.0.0/gdsfactory/geometry/outline.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import Union
-
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.compass import compass
 from gdsfactory.geometry.boolean import boolean
 from gdsfactory.geometry.offset import offset
 
 
@@ -13,15 +11,15 @@
 def outline(
     elements,
     distance=1,
     precision: float = 1e-3,
     join: str = "miter",
     tolerance: int = 2,
     join_first: bool = True,
-    open_ports: Union[bool, float] = False,
+    open_ports: bool | float = False,
     layer=0,
 ) -> Component:
     """Returns Component containing the outlined polygon(s).
 
     Creates an outline around all the polygons passed in the `elements`
     argument. `elements` may be a Component, Polygon, or list of Components.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/trim.py` & `gdsfactory-7.0.0/gdsfactory/geometry/trim.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,29 +1,27 @@
 """Trim component.
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 
 from __future__ import annotations
 
-from typing import List, Optional, Tuple
-
 import gdstk
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.component_layout import _parse_layer
 
 
 @gf.cell
 def trim(
     component: Component,
-    domain: List[Tuple[float, float]],
+    domain: list[tuple[float, float]],
     precision: float = 1e-4,
-    return_ports: Optional[bool] = False,
+    return_ports: bool | None = False,
 ) -> Component:
     """Trim a component by another geometry, preserving the component's layers and ports.
 
     Useful to get a smaller component from a larger one for simulation.
 
     Args:
         component: Component(/Reference).
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/write_connectivity.py` & `gdsfactory-7.0.0/gdsfactory/geometry/write_connectivity.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,45 +1,45 @@
 """Write Connectivy checks."""
 
 from __future__ import annotations
 
-from typing import List
 from pydantic import BaseModel
 
 import gdsfactory as gf
-from gdsfactory.typings import CrossSectionSpec, Dict, Layer, LayerSpec
 from gdsfactory.geometry.write_drc import write_drc_deck_macro
+from gdsfactory.typings import CrossSectionSpec, Layer, LayerSpec
 
-layer_name_to_min_width: Dict[str, float]
+layer_name_to_min_width: dict[str, float]
 
 nm = 1e-3
 
 
 class ConnectivyCheck(BaseModel):
     cross_section: CrossSectionSpec
     pin_length: float
     pin_layer: Layer
 
 
 def write_connectivity_checks(
-    pin_widths: List[float],
+    pin_widths: list[float],
     pin_layer: Layer,
     pin_length: float = 1 * nm,
     device_layer: LayerSpec = "DEVREC",
-):
+) -> str:
     """Return script for port connectivity check.
     Assumes the port pins are inside the Component.
 
     Args:
         pin_widths: list of pin widths allowed.
         pin_layer: for the pin markers.
         pin_length: in um.
         device_layer: device recognizion layer.
     """
     device_layer = gf.get_layer(device_layer)
+    pin_layer = gf.get_layer(pin_layer)
 
     script = f"""pin = input{pin_layer}
 pin = pin.merged\n
 pin2 = pin.rectangles.without_area({pin_widths[0]} * {2 * pin_length})"""
 
     for w in pin_widths[1:]:
         script += f" - pin.rectangles.with_area({w} * {2 * pin_length})"
@@ -52,15 +52,15 @@
 DEVREC.overlapping(DEVREC).output("Component overlap")\n
     """
 
     return script
 
 
 def write_connectivity_checks_per_section(
-    connectivity_checks: List[ConnectivyCheck],
+    connectivity_checks: list[ConnectivyCheck],
     device_layer: LayerSpec = None,
 ) -> str:
     """Return script for port connectivity check.
     Assumes the port pins are inside the Component and each cross_section has pins on a different layer.
     This is not the recommended way as it only supports two widths per cross_section (cross_section.width and cross_section.width_wide)
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/write_drc.py` & `gdsfactory-7.0.0/gdsfactory/geometry/write_drc.py`

 * *Files 2% similar despite different names*

```diff
@@ -10,21 +10,20 @@
 - https://github.com/google/globalfoundries-pdk-libs-gf180mcu_fd_pr/tree/main/rules/klayout
 """
 
 from __future__ import annotations
 
 import pathlib
 from dataclasses import asdict, is_dataclass
-from typing import List, Optional, Union
 
 import gdsfactory as gf
 from gdsfactory.install import get_klayout_path
-from gdsfactory.typings import CrossSectionSpec, Dict, Layer, PathType
+from gdsfactory.typings import CrossSectionSpec, Layer, PathType
 
-layer_name_to_min_width: Dict[str, float]
+layer_name_to_min_width: dict[str, float]
 
 
 def get_drc_script_start(name, shortcut) -> str:
     return f"""<?xml version="1.0" encoding="utf-8"?>
 <klayout-macro>
  <description>{name} DRC</description>
  <version/>
@@ -104,15 +103,15 @@
 
 def rule_area(layer: str, min_area_um2: float = 2.0) -> str:
     """Return script for min area checking."""
     return f"""
 
 min_{layer}_a = {min_area_um2}.um2
 r_{layer}_a = {layer}.with_area(0, min_{layer}_a)
-r_{layer}_a.output("{layer.upper()}_A: {layer} area &lt; min_{layer}_a µm²")
+r_{layer}_a.output("{layer.upper()}_A: {layer} area &lt; min_{layer}_a um2")
 """
 
 
 def rule_density(
     layer: str = "metal1",
     layer_floorplan: str = "FLOORPLAN",
     min_density=0.2,
@@ -151,16 +150,16 @@
 
 end
 
 """
 
 
 def connectivity_checks(
-    WG_cross_sections: List[CrossSectionSpec], pin_widths: Union[List[float], float]
-):
+    WG_cross_sections: list[CrossSectionSpec], pin_widths: list[float] | float
+) -> str:
     """Return script for photonic port connectivity check. Assumes the photonic port pins are inside the Component.
 
     Args:
         WG_cross_sections: list of waveguide layers to run check for.
         pin_widths: list of port pin widths or a single port pin width/
     """
     connectivity_check = ""
@@ -174,27 +173,27 @@
 {layer_name}_PIN2 = {layer_name}_PIN.sized(0.0).merged\n
 {layer_name}_PIN2.non_rectangles.output(\"port width check\")\n\n"""
         )
 
     return connectivity_check
 
 
-def write_layer_definition(layers: Dict[str, Layer]) -> List[str]:
+def write_layer_definition(layers: dict[str, Layer]) -> list[str]:
     """Returns layers definition script for KLayout.
 
     Args:
         layers: layer definitions can be dict, dataclass or pydantic BaseModel.
 
     """
     layers = asdict(layers) if is_dataclass(layers) else layers
     layers = dict(layers)
     return [f"{key} = input({value[0]}, {value[1]})" for key, value in layers.items()]
 
 
-def write_drc_deck(rules: List[str], layers: Optional[Dict[str, Layer]] = None) -> str:
+def write_drc_deck(rules: list[str], layers: dict[str, Layer] | None = None) -> str:
     """Returns drc_rule_deck for KLayout.
 
     based on https://github.com/klayoutmatthias/si4all
 
     Args:
         rules: list of rules.
         layers: layer definitions can be dict, dataclass or pydantic BaseModel.
@@ -208,24 +207,23 @@
     return "\n".join(script)
 
 
 modes = ["tiled", "default", "deep"]
 
 
 def write_drc_deck_macro(
-    rules: List[str],
-    layers: Optional[Dict[str, Layer]] = None,
+    rules: list[str],
+    layers: dict[str, Layer] | None = None,
     name: str = "generic",
-    filepath: Optional[PathType] = None,
+    filepath: PathType | None = None,
     shortcut: str = "Ctrl+Shift+D",
     mode: str = "tiled",
     threads: int = 4,
     tile_size: int = 500,
-    tile_borders: Optional[int] = None,
-    **kwargs,
+    tile_borders: int | None = None,
 ) -> str:
     """Write KLayout DRC macro.
 
     You can customize the shortcut to run the DRC macro from the Klayout GUI.
 
     Args:
         rules: list of rules.
@@ -315,15 +313,15 @@
 
     script += drc_script_end
     filepath = filepath or get_klayout_path() / "drc" / f"{name}.lydrc"
     filepath = pathlib.Path(filepath)
     dirpath = filepath.parent
     dirpath.mkdir(parents=True, exist_ok=True)
     filepath = pathlib.Path(filepath)
-    filepath.write_text(script)
+    filepath.write_text(script, encoding="UTF-8")
     print(f"Wrote DRC deck to {str(filepath)!r} with shortcut {shortcut!r}")
     return script
 
 
 if __name__ == "__main__":
     rules = [
         rule_width(layer="WG", value=0.2),
```

#### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

### Comparing `gdsfactory-6.99.0/gdsfactory/geometry/xor_diff.py` & `gdsfactory-7.0.0/gdsfactory/geometry/xor_diff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/get_factories.py` & `gdsfactory-7.0.0/gdsfactory/get_factories.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 from __future__ import annotations
 
 from collections.abc import Iterable
 from inspect import getmembers, signature
 
-from gdsfactory.typings import Component, ComponentFactory, Dict
+from gdsfactory.typings import Component, ComponentFactory
 
 
-def get_cells(modules, verbose: bool = False) -> Dict[str, ComponentFactory]:
+def get_cells(modules, verbose: bool = False) -> dict[str, ComponentFactory]:
     """Returns PCells (component functions) from a module or list of modules.
 
     Args:
         modules: module or iterable of modules.
         verbose: prints in case any errors occur.
 
     """
```

### Comparing `gdsfactory-6.99.0/gdsfactory/get_netlist.py` & `gdsfactory-7.0.0/gdsfactory/get_netlist.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,15 +15,16 @@
         - coupler,W0
 
 """
 
 from __future__ import annotations
 
 from collections import defaultdict
-from typing import Any, Callable, Dict, List, Optional, Tuple, Union
+from collections.abc import Callable
+from typing import Any
 
 import numpy as np
 import omegaconf
 
 from gdsfactory import Port
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.name import clean_name
@@ -87,15 +88,15 @@
     return text
 
 
 def get_netlist_yaml(
     component: Component,
     full_settings: bool = False,
     tolerance: int = 5,
-    exclude_port_types: Optional[List] = None,
+    exclude_port_types: list | None = None,
     **kwargs,
 ) -> str:
     """Returns instances, connections and placements yaml string content."""
     return omegaconf.OmegaConf.to_yaml(
         get_netlist(
             component=component,
             full_settings=full_settings,
@@ -106,30 +107,30 @@
     )
 
 
 def get_netlist(
     component: Component,
     full_settings: bool = False,
     tolerance: int = 5,
-    exclude_port_types: Optional[Union[List[str], Tuple[str]]] = ("placement",),
+    exclude_port_types: list[str] | tuple[str] | None = ("placement",),
     get_instance_name: Callable[..., str] = get_instance_name_from_alias,
     allow_multiple: bool = False,
-) -> Dict[str, Any]:
+) -> dict[str, Any]:
     """From Component returns instances, connections and placements dict.
 
     Does two sweeps over the connections:
 
     1. first tries to connect everything assuming perfect connections at each port.
     2. Then gathers ports which did not perfectly connect to anything and tries \
             to find imperfect connections, by grouping ports on a coarse grid.
 
     warnings collected during netlisting are reported back into the netlist.
     These include warnings about mismatched port widths, orientations, shear angles, excessive offsets, etc.
     You can also configure warning types which should throw an error when encountered
-        by modifying DEFAULT_CRITICAL_CONNECTION_ERROR_TYPES.
+    by modifying DEFAULT_CRITICAL_CONNECTION_ERROR_TYPES.
     Validators, which will produce warnings for each port type,
     can be overridden with DEFAULT_CONNECTION_VALIDATORS
     A key difference in this algorithm is that we group each port type independently.
     This allows us to use different logic to determine i.e.
     if an electrical port is properly connected vs an optical port.
     In this function, the core logic is the same, but we employ extra validation for optical ports.
     snap_to_grid() allows a value of 0, which will return the original value,
@@ -289,19 +290,19 @@
     }
     if warnings:
         netlist["warnings"] = warnings
     return netlist
 
 
 def extract_connections(
-    port_names: List[str],
-    ports: Dict[str, Port],
+    port_names: list[str],
+    ports: dict[str, Port],
     port_type: str,
     tolerance: int = 5,
-    validators: Optional[Dict[str, Callable]] = None,
+    validators: dict[str, Callable] | None = None,
     allow_multiple: bool = False,
 ):
     if validators is None:
         validators = DEFAULT_CONNECTION_VALIDATORS
 
     validator = validators.get(port_type, _null_validator)
     return _extract_connections_two_sweep(
@@ -311,20 +312,20 @@
         tolerance=tolerance,
         connection_validator=validator,
         allow_multiple=allow_multiple,
     )
 
 
 def _extract_connections_two_sweep(
-    port_names: List[str],
-    ports: Dict[str, Port],
+    port_names: list[str],
+    ports: dict[str, Port],
     port_type: str,
     connection_validator: Callable,
     tolerance: int,
-    raise_error_for_warnings: Optional[List[str]] = None,
+    raise_error_for_warnings: list[str] | None = None,
     allow_multiple: bool = False,
 ):
     warnings = defaultdict(list)
     if raise_error_for_warnings is None:
         raise_error_for_warnings = DEFAULT_CRITICAL_CONNECTION_ERROR_TYPES.get(
             port_type, []
         )
@@ -363,14 +364,15 @@
                 connections.append(ports_at_xy)
 
             elif not allow_multiple:
                 warnings["multiple_connections"].append(ports_at_xy)
                 raise ValueError(f"Found multiple connections at {xy}:{ports_at_xy}")
 
             else:
+                # Iterates over the list of multiple ports to create related two-port connectivity
                 num_ports = len(ports_at_xy)
                 for portindex1, portindex2 in zip(
                     range(-1, num_ports - 1), range(num_ports)
                 ):
                     port1 = ports[ports_at_xy[portindex1]]
                     port2 = ports[ports_at_xy[portindex2]]
                     connection_validator(port1, port2, ports_at_xy, warnings)
@@ -401,15 +403,15 @@
     if critical_warnings:
         raise ValueError(
             f"Found critical warnings while extracting netlist: {critical_warnings}"
         )
     return connections, dict(warnings)
 
 
-def _make_warning(ports: List[str], values: Any, message: str) -> Dict[str, Any]:
+def _make_warning(ports: list[str], values: Any, message: str) -> dict[str, Any]:
     w = {
         "ports": ports,
         "values": values,
         "message": message,
     }
     return clean_dict(w)
 
@@ -516,15 +518,15 @@
     while diff < 180:
         diff += 360
     while diff > 180:
         diff -= 360
     return diff
 
 
-def _get_references_to_netlist(component: Component) -> List[ComponentReference]:
+def _get_references_to_netlist(component: Component) -> list[ComponentReference]:
     from gdsfactory.cell import CACHE
 
     references = component.references
     if not references and "transformed_cell" in component.info:
         # expand transformed, flattened cells
         ref = component.settings.full["ref"]
         original_cell = CACHE[component.info["transformed_cell"]]
@@ -541,15 +543,15 @@
 
 def get_netlist_recursive(
     component: Component,
     component_suffix: str = "",
     get_netlist_func: Callable = get_netlist,
     get_instance_name: Callable[..., str] = get_instance_name_from_alias,
     **kwargs,
-) -> Dict[str, Any]:
+) -> dict[str, Any]:
     """Returns recursive netlist for a component and subcomponents.
 
     Args:
         component: to extract netlist.
         component_suffix: suffix to append to each component name.
             useful if to save and reload a back-annotated netlist.
         get_netlist_func: function to extract individual netlists.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/get_netlist_flat.py` & `gdsfactory-7.0.0/gdsfactory/get_netlist_flat.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,19 +1,21 @@
 from __future__ import annotations
+
 from collections.abc import Iterable
-from typing import Optional, Any, Dict, List
-from gdsfactory.component import Component
+from typing import Any
+
 import gdsfactory as gf
+from gdsfactory.component import Component
 from gdsfactory.get_netlist import get_netlist_recursive
 
 
 def get_netlist_flat(
     component: Component,
     **kwargs,
-) -> Dict[str, Any]:
+) -> dict[str, Any]:
     """Parses a recursive netlist for a component as if it was a single netlist \
             with its lowest-level instances.
 
     Procedure:
         - Recursively parse the recursive dict to generate a unique list of all instances **even if they are reused**
           Each entry is formatted as [(netlist, instance),...], and defines a unique flat_name = {top}{hierarchy_delimiter}{instance}{hierarchy_delimiter}{instance}{hierarchy_delimiter}...
         - Populate the flat netlist dict with similar entries as regular gdsfactory netlists:
@@ -123,15 +125,15 @@
         found_lower_level = False
         flat_name = f"{flat_name}{hierarchy_delimiter}{instance_port}"
     return found_lower_level, flat_name
 
 
 def _lateral_map(
     local_leaf_port: str,
-    all_netlists: Dict[str, Any],
+    all_netlists: dict[str, Any],
     higher_component: str,
     level: int,
     hierarchy,
     hierarchy_delimiter: str = "~",
 ):
     """Returns connected ports at this hierarchical level."""
     lateral_equivalencies = []
@@ -156,15 +158,16 @@
 ):
     """Returns all nodes of interest across the flat recursive netlist."""
     connections = {}
     ports = {}
 
     # Starting point is ports of the leaf instance
     leaf_instance = hierarchy[-1][1]
-    leaf_instance_ports = list(gf.get_component(hierarchy[-1][0]).ports.keys())
+    leaf_instance_name = hierarchy[-1][0].split(".")[-1]
+    leaf_instance_ports = list(gf.get_component(leaf_instance_name).ports.keys())
 
     for leaf_portname in leaf_instance_ports:
         current_connections = []
         current_ports = []
         local_leaf_port = f"{leaf_instance},{leaf_portname}"
         for level, (higher_component, higher_instance) in enumerate(
             hierarchy[:-1][::-1]
@@ -214,23 +217,23 @@
 
     return {_flat_name(hierarchy): placements}
 
 
 def _flatten_str_list(xs):
     """Flatten nested list of strings to list of strings."""
     for x in xs:
-        if isinstance(x, Iterable) and not isinstance(x, (str, bytes)):
+        if isinstance(x, Iterable) and not isinstance(x, str | bytes):
             yield from _flatten_str_list(x)
         else:
             yield x
 
 
 def _flatten_hierarchy(
     netlist_name: str,
-    all_netlists: List[Dict[str, any]],
+    all_netlists: list[dict[str, Any]],
     hierarchy_delimiter: str = "~",
     component_instance_delimiter: str = ";",
 ):
     """Converts _flatten_netlist output str's to list of hierarchical (component, instance) tuples."""
 
     instance_dict = _flatten_hierarchy_recurse(
         netlist_name=netlist_name,
@@ -249,19 +252,19 @@
         hierarchies_lists.append(hierarchy_list)
 
     return hierarchies_lists
 
 
 def _flatten_hierarchy_recurse(
     netlist_name: str,
-    all_netlists: List[Dict[str, any]],
-    hierarchy: Optional[str] = None,
+    all_netlists: list[dict[str, Any]],
+    hierarchy: str | None = None,
     hierarchy_delimiter: str = "~",
     component_instance_delimiter: str = ";",
-) -> Dict[str, Any]:
+) -> dict[str, Any]:
     """Flattens the provided recursive netlist by recursively updating a list.
 
     Args:
         netlist_name: netlist entry to flatten
         all_netlists: list of all possible netlists (output of get_netlist_recursive)
         hierarchy: str to append to netlist_name
         hierarchy_delimiter: str to separate hierarchy levels in flattened keys
```

### Comparing `gdsfactory-6.99.0/gdsfactory/grid.py` & `gdsfactory-7.0.0/gdsfactory/grid.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,31 +1,29 @@
 """pack a list of components into a grid.
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import numpy as np
 
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.component_layout import Group
 from gdsfactory.components.text_rectangular import text_rectangular
 from gdsfactory.components.triangles import triangle
 from gdsfactory.typings import Anchor, ComponentSpec, Float2
 
 
 @cell
 def grid(
-    components: Optional[Tuple[ComponentSpec, ...]] = None,
-    spacing: Tuple[float, float] = (5.0, 5.0),
+    components: tuple[ComponentSpec, ...] | None = None,
+    spacing: tuple[float, float] = (5.0, 5.0),
     separation: bool = True,
-    shape: Optional[Tuple[int, int]] = None,
+    shape: tuple[int, int] | None = None,
     align_x: str = "x",
     align_y: str = "y",
     edge_x: str = "x",
     edge_y: str = "ymax",
     rotation: int = 0,
     h_mirror: bool = False,
     v_mirror: bool = False,
@@ -156,22 +154,22 @@
             D.add_ports(ref.ports)
 
     return D
 
 
 @cell
 def grid_with_text(
-    components: Optional[Tuple[ComponentSpec, ...]] = None,
+    components: tuple[ComponentSpec, ...] | None = None,
     text_prefix: str = "",
-    text_offsets: Tuple[Float2, ...] = ((0, 0),),
-    text_anchors: Tuple[Anchor, ...] = ("cc",),
+    text_offsets: tuple[Float2, ...] = ((0, 0),),
+    text_anchors: tuple[Anchor, ...] = ("cc",),
     text_mirror: bool = False,
     text_rotation: int = 0,
-    text: Optional[ComponentSpec] = text_rectangular,
-    labels: Optional[Tuple[str, ...]] = None,
+    text: ComponentSpec | None = text_rectangular,
+    labels: tuple[str, ...] | None = None,
     **kwargs,
 ) -> Component:
     """Returns Component with 1D or 2D grid of components with text labels.
 
     Args:
         components: Iterable to be placed onto a grid. (can be 1D or 2D).
         text_prefix: for labels. For example. 'A' will produce 'A1', 'A2', ...
@@ -236,28 +234,28 @@
                     t.mirror()
                 if text_rotation:
                     t.rotate(text_rotation)
                 t.move(np.array(text_offset) + getattr(ref.size_info, text_anchor))
     return c
 
 
-def test_grid() -> Component:
+def test_grid() -> None:
     import gdsfactory as gf
 
     c = [gf.components.straight(length=i) for i in [1, 1, 2]]
     c = grid(
         c,
         shape=(2, 2),
         rotation=0,
         h_mirror=False,
         v_mirror=False,
         spacing=(10, 10),
     )
     # assert np.isclose(c.ports["1_1_o1"].center[0], 13.0), c.ports["1_1_o1"].center[0]
-    return c
+    assert c
 
 
 if __name__ == "__main__":
     c = test_grid()
     # import gdsfactory as gf
 
     # components = [gf.components.rectangle(size=(i, i)) for i in range(40, 66, 5)]
```

### Comparing `gdsfactory-6.99.0/gdsfactory/install.py` & `gdsfactory-7.0.0/gdsfactory/install.py`

 * *Files 13% similar despite different names*

```diff
@@ -2,20 +2,25 @@
 from __future__ import annotations
 
 import configparser
 import os
 import pathlib
 import shutil
 import sys
-from typing import Optional
+
+from gdsfactory.config import PATH
+
+home = pathlib.Path.home()
 
 
 def remove_path_or_dir(dest: pathlib.Path) -> None:
-    if dest.is_dir():
+    if dest.is_symlink():
         os.unlink(dest)
+    elif dest.is_dir():
+        shutil.rmtree(dest)
     else:
         os.remove(dest)
 
 
 def make_link(src, dest, overwrite: bool = True) -> None:
     dest = pathlib.Path(dest)
     if dest.exists() and not overwrite:
@@ -34,60 +39,61 @@
             shutil.copy(src, dest)
     print("Symlink made:")
     print(f"From: {src}")
     print(f"To:   {dest}")
 
 
 def install_gdsdiff() -> None:
-    """Install gdsdiff tool."""
-    home = pathlib.Path.home()
-    git_config_path = home / ".gitconfig"
-    git_attributes_path = home / ".gitattributes"
-
-    if git_config_path.exists():
-        git_config_str = open(git_config_path).read()
-    else:
-        git_config_str = "empty"
-
-    git_attributes_str = (
-        open(git_attributes_path).read() if git_attributes_path.exists() else "empty"
-    )
-
-    if "gds_diff" not in git_config_str:
-        write_git_config(git_config_path)
-    if "gds_diff" not in git_attributes_str:
-        print("Appending the gdsdiff command to your ~/.gitattributes")
-
-        with open(git_attributes_path, "a") as f:
-            f.write("*.gds diff=gds_diff\n")
-
-
-def write_git_config(git_config_path) -> None:
-    """Write GIT config."""
-    print("gdsdiff shows boolean differences in Klayout")
+    """Install gdsdiff tool for GIT."""
+    print("gdsdiff shows boolean differences in Klayout so you can run:")
     print("git diff FILE.GDS")
-    print("Appending the gdsdiff command to your ~/.gitconfig")
+    print("Adding gdsdiff command to ~/.gitconfig and ~/.config/git/attributes")
+    _write_git_config()
+    _write_git_attributes()
+
 
+def _write_git_config() -> None:
+    """Write GIT config in ~/.gitconfig."""
+    git_config_path = home / ".gitconfig"
     config = configparser.RawConfigParser()
     config.read(git_config_path)
-    key = 'diff "gds_diff"'
+    key = 'diff "gdsdiff"'
 
     if key not in config.sections():
         config.add_section(key)
-        config.set(key, "command", "python -m gdsfactory.gdsdiff.gds_diff_git")
+        config.set(key, "command", "python -m gdsfactory.difftest_git")
         config.set(key, "binary", "True")
 
         with open(git_config_path, "w+") as f:
             config.write(f, space_around_delimiters=True)
 
 
+def _write_git_attributes() -> None:
+    """Write git attributes in ~/.config/git/attributes."""
+    git_config = home / ".config" / "git"
+    git_config.mkdir(exist_ok=True, parents=True)
+    line_to_add = "*.gds diff=gdsdiff\n"
+
+    # Specify the path to the .config/git/attributes file
+    dirpath = home / ".config" / "git"
+    dirpath.mkdir(exist_ok=True, parents=True)
+    file_path = dirpath / "attributes"
+
+    # Read the file to check if the line already exists
+    file_content = file_path.read_text() if file_path.exists() else ""
+
+    # Add the line only if it doesn't exist
+    if line_to_add not in file_content:
+        with open(file_path, "a") as file:
+            file.write(line_to_add)
+
+
 def get_klayout_path() -> pathlib.Path:
     """Returns KLayout path."""
     klayout_folder = "KLayout" if sys.platform == "win32" else ".klayout"
-    home = pathlib.Path.home()
     return home / klayout_folder
 
 
 def copy(src: pathlib.Path, dest: pathlib.Path) -> None:
     """Copy overwriting file or directory."""
     dest_folder = dest.parent
     dest_folder.mkdir(exist_ok=True, parents=True)
@@ -108,45 +114,61 @@
 ) -> None:
     """Install into KLayout technology.
 
     Equivalent to using KLayout package manager.
 
     """
     klayout_folder = "KLayout" if sys.platform == "win32" else ".klayout"
-    subdir = pathlib.Path.home() / klayout_folder / klayout_subdir_name
+    subdir = home / klayout_folder / klayout_subdir_name
     dest = subdir / package_name
     subdir.mkdir(exist_ok=True, parents=True)
     make_link(src, dest)
 
 
 def install_klayout_package() -> None:
     """Install gdsfactory KLayout package.
 
     Equivalent to using KLayout package manager.
-
     """
     cwd = pathlib.Path(__file__).resolve().parent
     _install_to_klayout(
         src=cwd / "generic_tech" / "klayout",
         klayout_subdir_name="salt",
         package_name="gdsfactory",
     )
 
 
 def install_klayout_technology(
-    tech_dir: pathlib.Path, tech_name: Optional[str] = None
+    tech_dir: pathlib.Path, tech_name: str | None = None
 ) -> None:
     """Install technology to KLayout."""
     _install_to_klayout(
         src=tech_dir,
         klayout_subdir_name="tech",
         package_name=tech_name or tech_dir.name,
     )
 
 
-if __name__ == "__main__":
-    cwd = pathlib.Path(__file__).resolve().parent
-    home = pathlib.Path.home()
-    src = cwd / "generic_tech" / "klayout" / "tech"
+py_files = PATH.notebooks.glob("**/*.py")
+
 
-    install_gdsdiff()
-    install_klayout_package()
+def convert_py_to_ipynb(files=py_files, output_folder=PATH.cwd / "notebooks") -> None:
+    """Convert notebooks from markdown to ipynb."""
+    import jupytext
+
+    output_folder.mkdir(exist_ok=True, parents=True)
+
+    for file in files:
+        notebook_file = f"{output_folder}/{file.stem}.ipynb"
+        nb = jupytext.read(file)
+        jupytext.write(nb, notebook_file)
+
+
+if __name__ == "__main__":
+    # cwd = pathlib.Path(__file__).resolve().parent
+    # home = pathlib.Path.home()
+    # src = cwd / "generic_tech" / "klayout" / "tech"
+
+    # write_git_attributes()
+    # install_gdsdiff()
+    # install_klayout_package()
+    convert_py_to_ipynb()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/labels/__init__.py` & `gdsfactory-7.0.0/gdsfactory/labels/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/labels/add_label_yaml.py` & `gdsfactory-7.0.0/gdsfactory/labels/add_label_yaml.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,10 @@
 """Add label YAML."""
 from __future__ import annotations
 
-from typing import List, Optional
-
 import flatdict
 import pydantic
 
 import gdsfactory as gf
 from gdsfactory.name import clean_name
 from gdsfactory.typings import LayerSpec
 
@@ -23,19 +21,19 @@
     "elec_",
 ]
 
 
 @pydantic.validate_arguments
 def add_label_yaml(
     component: gf.Component,
-    port_prefixes: List[str] = ("opt_", "_elec"),
+    port_prefixes: list[str] = ("opt_", "_elec"),
     layer: LayerSpec = "LABEL",
-    metadata_ignore: Optional[List[str]] = ignore,
-    metadata_include_parent: Optional[List[str]] = None,
-    metadata_include_child: Optional[List[str]] = None,
+    metadata_ignore: list[str] | None = ignore,
+    metadata_include_parent: list[str] | None = None,
+    metadata_include_child: list[str] | None = None,
 ) -> gf.Component:
     """Returns Component with measurement label.
 
     Args:
         component: to add labels to.
         port_types: list of port types to label.
         layer: text label layer.
@@ -62,15 +60,15 @@
 
     # metadata = component.metadata_child.changed
     metadata = component.metadata_child.get("changed")
     if metadata:
         info += [
             f"  {k}: {v}"
             for k, v in metadata.items()
-            if k not in metadata_ignore and isinstance(v, (int, float, str))
+            if k not in metadata_ignore and isinstance(v, int | float | str)
         ]
 
     metadata = (
         flatdict.FlatDict(component.metadata.get("full"))
         if component.metadata.get("full")
         else {}
     )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/labels/ehva.py` & `gdsfactory-7.0.0/gdsfactory/labels/ehva.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 from __future__ import annotations
 
-from typing import Dict, List, Optional, Tuple
+from functools import partial
 
 import flatdict
 import pydantic
 
 import gdsfactory as gf
 from gdsfactory.name import clean_name
 from gdsfactory.snap import snap_to_grid as snap
 from gdsfactory.typings import Layer
 
 
 class Dft(pydantic.BaseModel):
-    pad_size: Tuple[int, int] = (100, 100)
+    pad_size: tuple[int, int] = (100, 100)
     pad_pitch: int = 125
     pad_width: int = 100
     pad_gc_spacing_opposed: int = 500
     pad_gc_spacing_adjacent: int = 1000
 
 
 DFT = Dft()
@@ -39,19 +39,19 @@
 }
 
 
 @pydantic.validate_arguments
 def add_label_ehva(
     component: gf.Component,
     die: str = "demo",
-    prefix_to_type: Dict[str, str] = prefix_to_type_default,
+    prefix_to_type: dict[str, str] = prefix_to_type_default,
     layer: Layer = (66, 0),
-    metadata_ignore: Optional[List[str]] = None,
-    metadata_include_parent: Optional[List[str]] = None,
-    metadata_include_child: Optional[List[str]] = None,
+    metadata_ignore: list[str] | None = None,
+    metadata_include_parent: list[str] | None = None,
+    metadata_include_child: list[str] | None = None,
 ) -> gf.Component:
     """Returns Component with measurement labels.
 
     Args:
         component: to add labels to.
         die: string.
         port_types: list of port types to label.
@@ -72,15 +72,15 @@
     info = []
 
     metadata = component.metadata_child["changed"]
     if metadata:
         info += [
             f"CIRCUITINFO NAME: {k}, VALUE: {v}"
             for k, v in metadata.items()
-            if k not in metadata_ignore and isinstance(v, (int, float, str))
+            if k not in metadata_ignore and isinstance(v, int | float | str)
         ]
 
     metadata = flatdict.FlatDict(component.metadata["full"])
     info += [
         f"CIRCUITINFO NAME: {clean_name(k)}, VALUE: {metadata.get(k)}"
         for k in metadata_include_parent
         if metadata.get(k)
@@ -115,15 +115,15 @@
         texttype=layer[1],
     )
     component.add(label)
     return component
 
 
 if __name__ == "__main__":
-    add_label_ehva_demo = gf.partial(
+    add_label_ehva_demo = partial(
         add_label_ehva,
         die="demo_die",
         metadata_include_parent=["grating_coupler:settings:polarization"],
     )
 
     c = gf.c.straight(length=11)
     c = gf.c.mmi2x2(length_mmi=2.2)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/labels/merge_test_metadata.py` & `gdsfactory-7.0.0/gdsfactory/labels/merge_test_metadata.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,22 +1,23 @@
 """Merge mask metadata with test labels to return test_metadata."""
 from __future__ import annotations
 
+from collections.abc import Callable
 from pathlib import Path
-from typing import Any, Dict, List, Optional
+from typing import Any
 
 from omegaconf import DictConfig, OmegaConf
 
 from gdsfactory.config import logger
 from gdsfactory.typings import PathType
 
 
 def parse_csv_data(
     csv_labels_path: Path, ignore_prefix: str = "METR_"
-) -> List[List[str]]:
+) -> list[list[str]]:
     """Returns CSV labels as a list of strings."""
     with open(csv_labels_path) as f:
         # Get all lines
         lines = [line.replace("\n", "") for line in f.readlines()]
 
         # Ignore labels for metrology structures
         lines = [line for line in lines if not line.startswith(ignore_prefix)]
@@ -39,42 +40,44 @@
         raise ValueError(f"{label!r} needs (cell name) between parenthesis") from error
 
     if cell_name.startswith("loopback"):
         cell_name = "_".join(cell_name.split("_")[1:])
     return cell_name
 
 
-def get_cell_from_label(label: str) -> str:
-    """Returns label, assuming opt-GratingName-ComponentName-PortName"""
+def component_name_from_string_with_dashes(label: str) -> str:
+    """Returns cell_name assuming opt-GratingName-ComponentName-PortName"""
 
     if label.startswith("elec"):
         if not label.split("-"):
-            raise ValueError(f"{label!r} needs to follow elec-ComponentName-PortName")
+            raise ValueError(
+                f"{label!r} needs to follow GratingName-ComponentName-PortName"
+            )
         return label.split("-")[1]
 
     if len(label.split("-")) < 2:
         raise ValueError(
-            f"{label!r} needs to follow opt-GratingName-ComponentName-PortName"
+            f"{label!r} needs to follow GratingName-ComponentName-PortName"
         )
-    return label.split("-")[2]
+    return label.split("-")[1]
 
 
 def merge_test_metadata(
     labels_path: PathType,
-    mask_metadata: Dict[str, Any],
-    get_cell_from_string=get_cell_from_label,
-    filepath: Optional[PathType] = None,
+    mask_metadata: dict[str, Any],
+    component_name_from_string: Callable = component_name_from_string_with_dashes,
+    filepath: PathType | None = None,
 ) -> DictConfig:
     """Returns a test metadata dict config of labeled cells by merging GDS \
     labels in CSV and YAML mask metadata.
 
     Args:
         labels_path: for test labels in CSV.
         mask_metadata: dict with test metadata.
-        get_cell_from_string: returns label string.
+        component_name_from_string: returns label string.
         filepath: Optional path to write test metadata.
 
     .. code::
 
         CSV labels  -------
                           |--> merge_test_metadata dict
                           |
@@ -83,40 +86,37 @@
     """
     labels_path = Path(labels_path)
 
     if not labels_path.exists():
         raise FileNotFoundError(f"missing CSV labels {labels_path!r}")
 
     labels_list = parse_csv_data(labels_path)
-    cells_metadata = mask_metadata.get("cells", {})
+    metadata = mask_metadata.get("cells", {})
 
     test_metadata = DictConfig({})
 
     for label, x, y, angle in labels_list[1:]:
-        cell = get_cell_from_string(label)
+        name = component_name_from_string(label)
 
-        if cell in cells_metadata:
-            test_metadata[cell] = cells_metadata[cell]
-            test_metadata[cell].label = dict(
+        if name in metadata:
+            test_metadata[name] = metadata[name]
+            test_metadata[name].label = dict(
                 x=float(x), y=float(y), text=label, angle=angle
             )
         else:
-            logger.warning(f"missing cell metadata for {cell!r}")
+            logger.warning(f"missing component metadata for {name!r}")
 
     if filepath:
         filepath = Path(filepath)
         filepath.write_text(OmegaConf.to_yaml(test_metadata))
 
     return test_metadata
 
 
 if __name__ == "__main__":
-    # from gdsfactory import PATH
+    from gdsfactory.config import PATH
 
-    # labels_path = (
-    #    PATH.samples_path / "mask_pack" / "build" / "mask" / "sample_mask.csv"
-    # )
-    # mask_metadata_path = labels_path.with_suffix(".yml")
-    # mask_metadata = OmegaConf.load(mask_metadata_path)
-    # d = merge_test_metadata(labels_path=labels_path, mask_metadata=mask_metadata)
-    # print(d)
-    print(get_cell_from_label("opt_te1550_demo"))
+    labels_path = PATH.notebooks / "mask.csv"
+    mask_metadata_path = labels_path.with_suffix(".yml")
+    mask_metadata = OmegaConf.load(mask_metadata_path)
+    d = merge_test_metadata(labels_path=labels_path, mask_metadata=mask_metadata)
+    print(d)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/labels/siepic.py` & `gdsfactory-7.0.0/gdsfactory/labels/siepic.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 """SiEPIC labels one grating coupler from the fiber array using a GDS label."""
 
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Tuple
+from collections.abc import Callable
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.component_layout import Label
 from gdsfactory.components import grating_coupler_te
 from gdsfactory.components.straight import straight
@@ -18,16 +18,16 @@
     LayerSpec,
 )
 
 
 def get_input_label_text(
     port: Port,
     gc: ComponentReference,
-    gc_index: Optional[int] = None,
-    component_name: Optional[str] = None,
+    gc_index: int | None = None,
+    component_name: str | None = None,
     username: str = "YourUserName",
 ) -> str:
     """Return label for port and a grating coupler.
 
     Args:
         port: component port.
         gc: grating coupler reference.
@@ -39,30 +39,30 @@
     wavelength = gc.info.get("wavelength")
 
     assert polarization.upper() in [
         "TE",
         "TM",
     ], f"Not valid polarization {polarization.upper()!r} in [TE, TM]"
     assert (
-        isinstance(wavelength, (int, float)) and 1.0 < wavelength < 2.0
+        isinstance(wavelength, int | float) and 1.0 < wavelength < 2.0
     ), f"{wavelength} is Not valid 1000 < wavelength < 2000"
 
     name = component_name or port.parent.metadata_child.get("name")
     return f"opt_in_{polarization.upper()}_{int(wavelength * 1000.0)}_device_{username}_({name})-{gc_index}-{port.name}"
 
 
 def get_input_labels(
-    io_gratings: List[ComponentReference],
-    ordered_ports: List[Port],
+    io_gratings: list[ComponentReference],
+    ordered_ports: list[Port],
     component_name: str,
-    layer_label: Tuple[int, int] = (10, 0),
+    layer_label: tuple[int, int] = (10, 0),
     gc_port_name: str = "o1",
     port_index: int = 1,
     get_input_label_text_function: Callable = get_input_label_text,
-) -> List[Label]:
+) -> list[Label]:
     """Return list of labels for all component ports.
 
     Args:
         io_gratings: list of grating_coupler references.
         ordered_ports: list of ports.
         component_name: name.
         layer_label: for the label.
@@ -87,15 +87,15 @@
     )
     return [label]
 
 
 @cell
 def add_fiber_array_siepic(
     component: ComponentSpec = straight,
-    component_name: Optional[str] = None,
+    component_name: str | None = None,
     gc_port_name: str = "o1",
     get_input_labels_function: Callable = get_input_labels,
     with_loopback: bool = False,
     optical_routing_type: int = 0,
     fanout_length: float = 0.0,
     grating_coupler: ComponentSpec = grating_coupler_te,
     cross_section: CrossSectionSpec = "strip",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/labels/write_labels.py` & `gdsfactory-7.0.0/gdsfactory/labels/write_labels.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 """Find GDS labels and write them to a CSV file."""
 
 from __future__ import annotations
 
 import csv
 import pathlib
+from collections.abc import Iterator
 from pathlib import Path
-from typing import Iterator, Tuple, List
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.config import logger
 from gdsfactory.pdk import get_layer
 from gdsfactory.routing.add_fiber_single import add_fiber_single
-from gdsfactory.typings import LayerSpec, Optional, PathType
+from gdsfactory.typings import LayerSpec, PathType
 
 
 def find_labels(
     gdspath: PathType, layer_label: LayerSpec = "LABEL", prefix: str = "opt_"
-) -> Iterator[Tuple[str, float, float]]:
+) -> Iterator[tuple[str, float, float]]:
     """Return text label and locations iterator from a GDS file.
 
     Klayout does not support label rotations.
 
     Args:
         gdspath: for the gds.
         layer_label: for the labels.
@@ -62,15 +62,15 @@
                 transformed = text.transformed(trans)
                 yield text.string, transformed.x * dbu, transformed.y * dbu, trans.angle
 
 
 def write_labels_klayout(
     gdspath: PathType,
     layer_label: LayerSpec = "LABEL",
-    filepath: Optional[PathType] = None,
+    filepath: PathType | None = None,
     prefix: str = "opt_",
 ) -> Path:
     """Load GDS and extracts labels in KLayout text and coordinates.
 
     Returns CSV filepath with each row:
     - Text
     - x
@@ -94,17 +94,17 @@
         writer.writerows(labels)
     logger.info(f"Wrote {len(labels)} labels to CSV {filepath.absolute()}")
     return filepath
 
 
 def write_labels_gdstk(
     gdspath: Path,
-    prefixes: List[str] = ("opt", "elec"),
+    prefixes: list[str] = ("opt", "elec"),
     layer_label: LayerSpec = "LABEL",
-    filepath: Optional[PathType] = None,
+    filepath: PathType | None = None,
     debug: bool = False,
 ) -> Path:
     """Load GDS and extracts label text and coordinates.
 
     Returns CSV filepath with each row:
     - Text
     - x
@@ -130,15 +130,15 @@
         for prefix in prefixes:
             if (
                 layer_label
                 and label.layer == layer_label[0]
                 and label.texttype == layer_label[1]
                 and label.text.startswith(prefix)
             ):
-                x, y = label.origin
+                x, y = np.round(label.origin, 3)
                 rot = np.rad2deg(label.rotation)
                 labels += [(label.text, x, y, rot)]
                 if debug:
                     print(label.text)
 
     with open(filepath, "w", newline="") as f:
         writer = csv.writer(f)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/name.py` & `gdsfactory-7.0.0/gdsfactory/name.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/pack.py` & `gdsfactory-7.0.0/gdsfactory/pack.py`

 * *Files 3% similar despite different names*

```diff
@@ -2,32 +2,33 @@
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 
 from __future__ import annotations
 
 import warnings
-from typing import Any, Dict, List, Optional, Tuple
+from functools import partial
+from typing import Any
 
 import numpy as np
 from pydantic import validate_arguments
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.name import get_name_short
 from gdsfactory.typings import Anchor, ComponentSpec, Float2, Number
 
 
 def _pack_single_bin(
-    rect_dict: Dict[int, Tuple[Number, Number]],
-    aspect_ratio: Tuple[Number, Number],
-    max_size: Tuple[float, float],
+    rect_dict: dict[int, tuple[Number, Number]],
+    aspect_ratio: tuple[Number, Number],
+    max_size: tuple[float, float],
     sort_by_area: bool,
     density: float,
-) -> Tuple[Dict[int, Tuple[Number, Number, Number, Number]], Dict[Any, Any]]:
+) -> tuple[dict[int, tuple[Number, Number, Number, Number]], dict[Any, Any]]:
     """Packs a dict of rectangles {id:(w,h)} and tries to.
 
     Pack it into a bin as small as possible with aspect ratio `aspect_ratio`
     Will iteratively grow the bin size until everything fits or the bin size
     reaches `max_size`.
 
     Args:
@@ -87,34 +88,34 @@
     }
 
     return packed_rect_dict, unpacked_rect_dict
 
 
 @validate_arguments
 def pack(
-    component_list: List[ComponentSpec],
+    component_list: list[ComponentSpec],
     spacing: float = 10.0,
     aspect_ratio: Float2 = (1.0, 1.0),
-    max_size: Tuple[Optional[float], Optional[float]] = (None, None),
+    max_size: tuple[float | None, float | None] = (None, None),
     sort_by_area: bool = True,
     density: float = 1.1,
     precision: float = 1e-2,
-    text: Optional[ComponentSpec] = None,
+    text: ComponentSpec | None = None,
     text_prefix: str = "",
     text_mirror: bool = False,
     text_rotation: int = 0,
-    text_offsets: Tuple[Float2, ...] = ((0, 0),),
-    text_anchors: Tuple[Anchor, ...] = ("cc",),
-    name_prefix: Optional[str] = None,
+    text_offsets: tuple[Float2, ...] = ((0, 0),),
+    text_anchors: tuple[Anchor, ...] = ("cc",),
+    name_prefix: str | None = None,
     rotation: int = 0,
     h_mirror: bool = False,
     v_mirror: bool = False,
     add_ports_prefix: bool = True,
     add_ports_suffix: bool = False,
-) -> List[Component]:
+) -> list[Component]:
     """Pack a list of components into as few Components as possible.
 
     Args:
         component_list: list or tuple.
         spacing: Minimum distance between adjacent shapes.
         aspect_ratio: (width, height) ratio of the rectangular bin.
         max_size: Limits the size into which the shapes will be packed.
@@ -135,21 +136,22 @@
         add_ports_prefix: adds port names with prefix.
         add_ports_suffix: adds port names with suffix.
 
     .. plot::
         :include-source:
 
         import gdsfactory as gf
+        from functools import partial
 
         components = [gf.components.triangle(x=i) for i in range(1, 10)]
         c = gf.pack(
             components,
             spacing=20.0,
             max_size=(100, 100),
-            text=gf.partial(gf.components.text, justify="center"),
+            text=partial(gf.components.text, justify="center"),
             text_prefix="R",
             name_prefix="demo",
             text_anchors=["nc"],
             text_offsets=[(-10, 0)],
             v_mirror=True,
         )
         c[0].plot()
@@ -237,15 +239,15 @@
     if len(components_packed_list) > 1:
         groups = len(components_packed_list)
         warnings.warn(f"unable to pack in one component, creating {groups} components")
 
     return components_packed_list
 
 
-def test_pack() -> Component:
+def test_pack() -> None:
     """Test packing function."""
     component_list = [
         gf.components.ellipse(radii=tuple(np.random.rand(2) * n + 2)) for n in range(2)
     ]
     component_list += [
         gf.components.rectangle(size=tuple(np.random.rand(2) * n + 2)) for n in range(2)
     ]
@@ -256,18 +258,18 @@
         aspect_ratio=(2, 1),  # (width, height) ratio of the rectangular bin
         max_size=(None, None),  # Limits the size into which the shapes will be packed
         density=1.05,  # Values closer to 1 pack tighter but require more computation
         sort_by_area=True,  # Pre-sorts the shapes by area
     )
     c = components_packed_list[0]  # Only one bin was created, so we plot that
     assert len(c.get_dependencies()) == 4
-    return c
+    assert c
 
 
-def test_pack_with_settings() -> Component:
+def test_pack_with_settings() -> None:
     """Test packing function with custom settings."""
     component_list = [
         gf.components.rectangle(size=(i, i), port_type=None) for i in range(1, 10)
     ]
     component_list += [
         gf.components.rectangle(size=(i, i), port_type=None) for i in range(1, 10)
     ]
@@ -278,31 +280,31 @@
         aspect_ratio=(2, 1),  # (width, height) ratio of the rectangular bin
         # max_size=(None, None),  # Limits the size into which the shapes will be packed
         max_size=(20, 20),  # Limits the size into which the shapes will be packed
         density=1.05,  # Values closer to 1 pack tighter but require more computation
         sort_by_area=True,  # Pre-sorts the shapes by area
         precision=1e-3,
     )
-    return components_packed_list[0]
+    assert components_packed_list[0]
 
 
 if __name__ == "__main__":
     # test_pack()
 
     # c = test_pack_with_settings()
     # c = test_pack()
     # c.show(show_ports=True)
     # c.pprint()
-    # c.write_gds_with_metadata("mask.gds")
+    # c.("mask.gds")
 
     p = pack(
         [gf.components.straight(length=i) for i in [1, 1]],
         spacing=20.0,
         max_size=(100, 100),
-        text=gf.partial(gf.components.text, justify="center"),
+        text=partial(gf.components.text, justify="center"),
         text_prefix="R",
         name_prefix="demo",
         text_anchors=["nc"],
         text_offsets=[(-10, 0)],
         text_mirror=True,
         v_mirror=True,
     )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/path.py` & `gdsfactory-7.0.0/gdsfactory/path.py`

 * *Files 3% similar despite different names*

```diff
@@ -5,17 +5,17 @@
 
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 
 from __future__ import annotations
 
 import hashlib
+import math
 import warnings
-from collections.abc import Iterable
-from typing import Callable, Optional, Union
+from collections.abc import Callable, Iterable
 
 import numpy as np
 from numpy import mod, pi
 
 from gdsfactory import snap
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
@@ -81,18 +81,35 @@
                 self.append(path)
             else:
                 raise ValueError(
                     "Path() the `path` argument must be either blank, a path Object, "
                     "an array-like[N][2] list of points, or a list of these"
                 )
 
+    def __repr__(self) -> str:
+        """Returns path points."""
+        return (
+            f"Path(start_angle={self.start_angle}, "
+            f"end_angle={self.end_angle}, "
+            f"points={self.points})"
+        )
+
     def __len__(self) -> int:
         """Returns path points."""
         return len(self.points)
 
+    def __iadd__(self, path_or_points) -> Path:
+        """Adds points to current path."""
+        return self.append(path_or_points)
+
+    def __add__(self, path) -> Path:
+        """Returns new path concatenating current and new path."""
+        new = self.copy()
+        return new.append(path)
+
     @property
     def bbox(self):
         """Returns the bounding box of the Path."""
         bbox = [
             (np.min(self.points[:, 0]), np.min(self.points[:, 1])),
             (np.max(self.points[:, 0]), np.max(self.points[:, 1])),
         ]
@@ -121,15 +138,15 @@
         ):
             points = np.asfarray(path)
             nx1, ny1 = points[1] - points[0]
             start_angle = np.arctan2(ny1, nx1) / np.pi * 180
             nx2, ny2 = points[-1] - points[-2]
             end_angle = np.arctan2(ny2, nx2) / np.pi * 180
         # If list of Paths or arrays
-        elif isinstance(path, (list, tuple)):
+        elif isinstance(path, list | tuple):
             for p in path:
                 self.append(p)
             return self
         else:
             raise ValueError(
                 "Path.append() the `path` argument must be either "
                 "a Path object, an array-like[N][2] list of points, or a list of these"
@@ -143,15 +160,15 @@
         self.end_angle = mod(end_angle + self.end_angle - start_angle, 360)
 
         # Concatenate old points + new points
         self.points = np.vstack([self.points, points[1:]])
 
         return self
 
-    def offset(self, offset: Union[float, Callable[..., float]] = 0):
+    def offset(self, offset: float | Callable[..., float] = 0):
         """Offsets Path so that it follows the Path centerline plus an offset.
 
         The offset can either be a fixed value, or a function
         of the form my_offset(t) where t goes from 0->1
 
         Args:
             offset: int or float, callable. Magnitude of the offset
@@ -209,15 +226,15 @@
 
         """
         dx, dy = _parse_move(origin, destination, axis)
         self.points += np.array([dx, dy])
 
         return self
 
-    def rotate(self, angle: float = 45, center: Optional[Float2] = (0, 0)):
+    def rotate(self, angle: float = 45, center: Float2 | None = (0, 0)):
         """Rotates all Polygons in the Component around the specified center point.
 
         If no center point specified will rotate around (0,0).
 
         Args:
             angle: Angle to rotate the Component in degrees.
             center: array-like[2] or None. component of the Component.
@@ -357,20 +374,33 @@
         # A random offset which fixes common rounding errors intrinsic
         # to floating point math. Example: with a precision of 0.1, the
         # floating points 7.049999 and 7.050001 round to different values
         # (7.0 and 7.1), but offset values (7.220485 and 7.220487) don't
         magic_offset = 0.17048614
 
         final_hash = hashlib.sha1()
-        p = np.ascontiguousarray(
-            (self.points / precision) + magic_offset, dtype=np.int64
+        points = (
+            np.ascontiguousarray(
+                (self.points / precision) + magic_offset, dtype=np.float64
+            )
+            .round()
+            .astype(np.int64)
+        )
+        final_hash.update(points)
+        angles = (
+            (
+                np.ascontiguousarray(
+                    (self.start_angle, self.end_angle), dtype=np.float64
+                )
+                / precision
+            )
+            .round()
+            .astype(np.int64)
         )
-        final_hash.update(p)
-        p = np.ascontiguousarray((self.start_angle, self.end_angle), dtype=np.float64)
-        final_hash.update(p)
+        final_hash.update(angles)
         return final_hash.hexdigest()
 
     @classmethod
     def __get_validators__(cls):
         """For pydantic."""
         yield cls._validate
 
@@ -396,21 +426,21 @@
         """
         from gdsfactory.quickplotter import quickplot
 
         return quickplot(self)
 
     def extrude(
         self,
-        cross_section: Optional[CrossSectionSpec] = None,
-        layer: Optional[LayerSpec] = None,
-        width: Optional[float] = None,
-        widths: Optional[Float2] = None,
-        simplify: Optional[float] = None,
-        shear_angle_start: Optional[float] = None,
-        shear_angle_end: Optional[float] = None,
+        cross_section: CrossSectionSpec | None = None,
+        layer: LayerSpec | None = None,
+        width: float | None = None,
+        widths: Float2 | None = None,
+        simplify: float | None = None,
+        shear_angle_start: float | None = None,
+        shear_angle_end: float | None = None,
     ) -> Component:
         """Returns Component by extruding a Path with a CrossSection.
 
         A path can be extruded using any CrossSection returning a Component
         The CrossSection defines the layer numbers, widths and offsets.
 
         Args:
@@ -703,21 +733,21 @@
         **kwargs,
     )
 
 
 @cell
 def extrude(
     p: Path,
-    cross_section: Optional[CrossSectionSpec] = None,
-    layer: Optional[LayerSpec] = None,
-    width: Optional[float] = None,
-    widths: Optional[Float2] = None,
-    simplify: Optional[float] = None,
-    shear_angle_start: Optional[float] = None,
-    shear_angle_end: Optional[float] = None,
+    cross_section: CrossSectionSpec | None = None,
+    layer: LayerSpec | None = None,
+    width: float | None = None,
+    widths: Float2 | None = None,
+    simplify: float | None = None,
+    shear_angle_start: float | None = None,
+    shear_angle_end: float | None = None,
 ) -> Component:
     """Returns Component extruding a Path with a cross_section.
 
     A path can be extruded using any CrossSection returning a Component
     The CrossSection defines the layer numbers, widths and offsets
 
     Args:
@@ -797,15 +827,15 @@
         width = section.width
         offset = section.offset
         layer = get_layer(section.layer)
         port_names = section.port_names
         port_types = section.port_types
         hidden = section.hidden
 
-        if isinstance(width, (int, float)) and isinstance(offset, (int, float)):
+        if isinstance(width, int | float) and isinstance(offset, int | float):
             xsection_points.append([width, offset])
         if isinstance(layer, int):
             layer = (layer, 0)
         if (
             isinstance(layer, Iterable)
             and len(layer) == 2
             and isinstance(layer[0], int)
@@ -834,23 +864,18 @@
 
             p_sec = Path(
                 [new_start_point, *p_pts[new_start_idx:new_stop_idx], new_stop_point]
             )
 
         if callable(offset):
             p_sec.offset(offset)
-            points = p_sec.points
-            start_angle = p_sec.start_angle
-            end_angle = p_sec.end_angle
             offset = 0
-        else:
-            points = p_sec.points
-            start_angle = p_sec.start_angle
-            end_angle = p_sec.end_angle
-
+        end_angle = p_sec.end_angle
+        start_angle = p_sec.start_angle
+        points = p_sec.points
         if callable(width):
             # Compute lengths
             dx = np.diff(p_sec.points[:, 0])
             dy = np.diff(p_sec.points[:, 1])
             lengths = np.cumsum(np.sqrt(dx**2 + dy**2))
             lengths = np.concatenate([[0], lengths])
             width = width(lengths / lengths[-1])
@@ -1006,17 +1031,17 @@
     rot_mat = np.array([[ca, -sa], [sa, ca]])
     delta = point - center
     return np.dot(delta, rot_mat)
 
 
 def _cut_path_with_ray(
     start_point: np.ndarray,
-    start_angle: Optional[float],
+    start_angle: float | None,
     end_point: np.ndarray,
-    end_angle: Optional[float],
+    end_angle: float | None,
     path: np.ndarray,
 ) -> np.ndarray:
     """Cuts or extends a path given a point and angle to project."""
     import shapely.geometry as sg
     import shapely.ops
 
     # a distance to approximate infinity to find ray-segment intersections
@@ -1066,16 +1091,16 @@
     points.append(np.array(intersections[1].coords[0]))
     return np.array(points)
 
 
 def arc(
     radius: float = 10.0,
     angle: float = 90,
-    npoints: Optional[int] = None,
-    start_angle: Optional[float] = -90,
+    npoints: int | None = None,
+    start_angle: float | None = -90,
 ) -> Path:
     """Returns a radial arc.
 
     Args:
         radius: minimum radius of curvature.
         angle: total angle of the curve.
         npoints: Number of points used per 360 degrees. Defaults to pdk.bend_points_distance.
@@ -1121,26 +1146,26 @@
 def _fresnel(R0, s, num_pts, n_iter=8):
     """Fresnel integral using a series expansion."""
     t = np.linspace(0, s / (np.sqrt(2) * R0), num_pts)
     x = np.zeros(num_pts)
     y = np.zeros(num_pts)
 
     for n in range(n_iter):
-        x += (-1) ** n * t ** (4 * n + 1) / (np.math.factorial(2 * n) * (4 * n + 1))
-        y += (-1) ** n * t ** (4 * n + 3) / (np.math.factorial(2 * n + 1) * (4 * n + 3))
+        x += (-1) ** n * t ** (4 * n + 1) / (math.factorial(2 * n) * (4 * n + 1))
+        y += (-1) ** n * t ** (4 * n + 3) / (math.factorial(2 * n + 1) * (4 * n + 3))
 
     return np.array([np.sqrt(2) * R0 * x, np.sqrt(2) * R0 * y])
 
 
 def euler(
     radius: float = 10,
     angle: float = 90,
     p: float = 0.5,
     use_eff: bool = False,
-    npoints: Optional[int] = None,
+    npoints: int | None = None,
 ) -> Path:
     """Returns an euler bend that adiabatically transitions from straight to curved.
 
     `radius` is the minimum radius of curvature of the bend.
     However, if `use_eff` is set to True, `radius` corresponds to the effective
     radius of curvature (making the curve a drop-in replacement for an arc).
     If p < 1.0, will create a "partial euler" curve as described in Vogelbacher et. al.
@@ -1478,21 +1503,20 @@
     # Extrude the Path to create the Component
     c = extrude(P, cross_section=X)
     c.show(show_ports=True)
 
 
 if __name__ == "__main__":
     import numpy as np
+
     import gdsfactory as gf
 
     # nm = 1e-3
-
     # points = np.array([(20, 10), (40, 10), (20, 40), (50, 40), (50, 20), (70, 20)])
     # p = smooth(points=points)
-
     # p = arc(start_angle=0)
     # c = p.extrude(layer=(1, 0), width=0.1, simplify=50 * nm)
     p = straight()
     # p.plot()
 
     # c = p.extrude(layer=(1, 0), width=0.1)
     s1 = gf.Section(width=2.2, offset=0, layer=(3, 0), name="etch")
@@ -1515,17 +1539,15 @@
         layer=(2, 0),
         name="wg",
         port_names=("in1", "out1"),
         sections=[s1, s2],
     )
 
     Xtrans = gf.path.transition(cross_section1=X1, cross_section2=X2, width_type="sine")
-
     c = p.extrude(cross_section=Xtrans)
-    print(c.name)
     # c = gf.components.splitter_tree(
     #     noutputs=2**2,
     #     spacing=(120.0, 50.0),
     #     # bend_length=30,
     #     # bend_s=None,
     #     cross_section="rib_conformal2",
     # )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/pdk.py` & `gdsfactory-7.0.0/gdsfactory/pdk.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,65 +1,122 @@
 """PDK stores layers, cross_sections, cell functions ..."""
 
 from __future__ import annotations
+
 import pathlib
 import warnings
+from collections.abc import Callable
 from functools import partial
-from typing import Any, Callable, Optional, Union, Tuple
-from typing_extensions import Literal
-from gdsfactory.name import MAX_NAME_LENGTH
+from typing import Any, Literal
 
 import numpy as np
+import omegaconf
 from omegaconf import DictConfig
 from pydantic import BaseModel, Field, validator
 
 from gdsfactory.config import PATH, logger
-from gdsfactory.containers import containers as containers_default
 from gdsfactory.events import Event
-from gdsfactory.materials import MaterialSpec
-from gdsfactory.materials import materials_index as materials_index_default
+from gdsfactory.name import MAX_NAME_LENGTH
 from gdsfactory.read import cell_from_yaml
 from gdsfactory.show import show
 from gdsfactory.symbols import floorplan_with_block_letters
 from gdsfactory.technology import LayerStack, LayerViews
 from gdsfactory.typings import (
     CellSpec,
     Component,
     ComponentFactory,
     ComponentSpec,
     CrossSection,
-    Transition,
-    CrossSectionFactory,
+    CrossSectionOrFactory,
     CrossSectionSpec,
-    Dict,
     Layer,
     LayerSpec,
+    MaterialSpec,
     PathType,
+    Transition,
 )
 
 component_settings = ["function", "component", "settings"]
 cross_section_settings = ["function", "cross_section", "settings"]
-layers_required = []
 
 constants = {
     "fiber_array_spacing": 127.0,
     "fiber_spacing": 50.0,
     "fiber_input_to_output_spacing": 200.0,
     "metal_spacing": 10.0,
     "pad_spacing": 100.0,
     "pad_size": (80, 80),
 }
 
 nm = 1e-3
 
 
+def evanescent_coupler_sample() -> None:
+    """Evanescent coupler example.
+
+    Args:
+      coupler_length: length of coupling (min: 0.0, max: 200.0, um).
+    """
+    pass
+
+
+def extract_args_from_docstring(docstring: str) -> dict[str, Any] | None:
+    """
+    This function extracts settings from a function's docstring for uPDK format.
+
+    Args:
+        docstring: The function from which to extract YAML in the docstring.
+
+    Returns:
+        settings (dict): The extracted YAML data as a dictionary.
+    """
+    args_dict = {}
+
+    docstring_lines = docstring.split("\n")
+    for line in docstring_lines:
+        line = line.strip()
+        if not line:
+            continue
+        if line.startswith("Args:"):
+            continue
+        if len(line.split(":")) != 2:
+            continue
+        name, description = line.split(":")
+        name = name.strip()
+        description_parts = description.split("(")
+        doc = description_parts[0].strip()
+        try:
+            min_max_unit = description_parts[1].strip(")").split(",")
+            min_val = float(min_max_unit[0].split(":")[1].strip())
+            max_val = float(min_max_unit[1].split(":")[1].strip())
+            unit = min_max_unit[2].strip()
+        except IndexError:
+            min_val = max_val = 0
+            unit = None
+
+        args_dict[name] = {
+            "doc": doc,
+            "min": min_val,
+            "max": max_val,
+            "type": "float",
+            "unit": unit,
+            "value": (min_val + max_val) / 2,  # setting default value as the midpoint
+        }
+
+    return args_dict
+
+
 class GdsWriteSettings(BaseModel):
     """Settings to use when writing to GDS."""
 
     on_uncached_component: Literal["warn", "error", "ignore"] = "ignore"
+    lib_name: str = Field(
+        default="library",
+        description="Name of the GDS library to write to. Default is 'library'.",
+    )
     unit: float = Field(
         default=1e-6,
         description="The units of coordinates in the database. The default is 1e-6 (1 micron).",
     )
     precision: float = Field(
         default=1e-9,
         description="The maximum precision of points in the database. For example, a value of 1e-9 would mean that you have a 1nm grid",
@@ -92,15 +149,15 @@
     detect_trapezoids: bool = Field(
         default=True, description="If true, stores trapezoids in a compressed format."
     )
     circle_tolerance: bool = Field(
         default=0,
         description="Tolerance for detecting circles. If less or equal to 0, no detection is performed. Circles are stored in compressed format.",
     )
-    validation: Optional[str] = Field(
+    validation: str | None = Field(
         default=None,
         description="Type of validation to include in the saved file ('crc32', 'checksum32', or None).",
     )
     standard_properties: bool = Field(
         default=False,
         description="If true, stores standard OASIS properties in the file.",
     )
@@ -113,52 +170,55 @@
         default=False,
         description="If true, will append a hash of the cell to the cell name.",
     )
     autoname: bool = Field(
         default=True,
         description="If true, will automatically name the cell based on its parameters.",
     )
-    name: Optional[str] = Field(
+    name: str | None = Field(
         default=None,
         description="If set, will override the cell name with this value.",
     )
     cache: bool = Field(
         default=True,
         description="If true, will cache the cell in the gdsfactory.cell.CACHE",
     )
     flatten: bool = Field(
         default=False,
         description="If true, will flatten the cell before returning it.",
     )
-    info: Dict[str, Any] = Field(
+    info: dict[str, Any] = Field(
         default={},
         description="Additional information to store in the cell.",
     )
-    prefix: Optional[str] = Field(
+    prefix: str | None = Field(
         default=None,
         description="If set, will prepend this string to the cell name.",
     )
     max_name_length: int = Field(
         default=MAX_NAME_LENGTH,
         description="Maximum length of the cell name.",
     )
+    include_module: bool = Field(
+        default=False,
+        description="If true, will include the module in the autogenerated component name.",
+    )
 
 
 class Pdk(BaseModel):
     """Store layers, cross_sections, cell functions, simulation_settings ...
 
     only one Pdk can be active at a given time.
 
     Parameters:
         name: PDK name.
         cross_sections: dict of cross_sections factories.
         cells: dict of parametric cells that return Components.
         symbols: dict of symbols names to functions.
         default_symbol_factory:
-        containers: dict of pcells that contain other cells.
         base_pdk: a pdk to copy from and extend.
         default_decorator: decorate all cells, if not otherwise defined on the cell.
         layers: maps name to gdslayer/datatype.
             For example dict(si=(1, 0), sin=(34, 0)).
         layer_stack: maps name to layer numbers, thickness, zmin, sidewall_angle.
             if can also contain material properties
             (refractive index, nonlinear coefficient, sheet resistance ...).
@@ -180,34 +240,33 @@
         oasis_settings: to write OASIS files.
         cell_decorator_settings: settings for cell_without_validator decorator function in gdsfactory.cell.
         bend_points_distance: default points distance for bends in um.
 
     """
 
     name: str
-    cross_sections: Dict[str, CrossSectionFactory] = Field(default_factory=dict)
-    cells: Dict[str, ComponentFactory] = Field(default_factory=dict)
-    symbols: Dict[str, ComponentFactory] = Field(default_factory=dict)
+    cross_sections: dict[str, CrossSectionOrFactory] = Field(default_factory=dict)
+    cells: dict[str, ComponentFactory] = Field(default_factory=dict)
+    symbols: dict[str, ComponentFactory] = Field(default_factory=dict)
     default_symbol_factory: Callable = floorplan_with_block_letters
-    containers: Dict[str, ComponentFactory] = containers_default
-    base_pdk: Optional[Pdk] = None
-    default_decorator: Optional[Callable[[Component], None]] = None
-    layers: Dict[str, Layer] = Field(default_factory=dict)
-    layer_stack: Optional[LayerStack] = None
-    layer_views: Optional[LayerViews] = None
-    layer_transitions: Dict[Union[Layer, Tuple[Layer, Layer]], ComponentSpec] = Field(
+    base_pdk: Pdk | None = None
+    default_decorator: Callable[[Component], None] | None = None
+    layers: dict[str, Layer] = Field(default_factory=dict)
+    layer_stack: LayerStack | None = None
+    layer_views: LayerViews | None = None
+    layer_transitions: dict[Layer | tuple[Layer, Layer], ComponentSpec] = Field(
         default_factory=dict
     )
-    sparameters_path: Optional[PathType] = None
-    modes_path: Optional[PathType] = PATH.modes
-    interconnect_cml_path: Optional[PathType] = None
+    sparameters_path: PathType | None = None
+    modes_path: PathType | None = PATH.modes
+    interconnect_cml_path: PathType | None = None
     warn_off_grid_ports: bool = False
-    constants: Dict[str, Any] = constants
-    materials_index: Dict[str, MaterialSpec] = materials_index_default
-    routing_strategies: Optional[Dict[str, Callable]] = None
+    constants: dict[str, Any] = constants
+    materials_index: dict[str, MaterialSpec] = Field(default_factory=dict)
+    routing_strategies: dict[str, Callable] | None = None
     circuit_yaml_parser: Callable = cell_from_yaml
     gds_write_settings: GdsWriteSettings = GdsWriteSettings()
     oasis_settings: OasisWriteSettings = OasisWriteSettings()
     cell_decorator_settings: CellDecoratorSettings = CellDecoratorSettings()
     bend_points_distance: float = 20 * nm
 
     @property
@@ -222,34 +281,40 @@
     class Config:
         """Configuration."""
 
         extra = "forbid"
         fields = {
             "cross_sections": {"exclude": True},
             "cells": {"exclude": True},
-            "containers": {"exclude": True},
             "default_symbol_factory": {"exclude": True},
             "default_decorator": {"exclude": True},
             "materials_index": {"exclude": True},
             "circuit_yaml_parser": {"exclude": True},
         }
 
     @validator("sparameters_path")
     def is_pathlib_path(cls, path):
         return pathlib.Path(path)
 
-    def validate_layers(self):
+    def validate_layers(self, layers_required: list[Layer] | None = None):
+        """Raises ValueError if layers_required are not in Pdk."""
+        if layers_required is None:
+            layers_required = []
         for layer in layers_required:
             if layer not in self.layers:
                 raise ValueError(
                     f"{layer!r} not in Pdk.layers {list(self.layers.keys())}"
                 )
 
     def activate(self) -> None:
-        """Set current pdk to as the active pdk."""
+        """Set current pdk to the active pdk (if not already active)."""
+        global _ACTIVE_PDK
+        if self is _ACTIVE_PDK:
+            return None
+
         from gdsfactory.cell import clear_cache
 
         logger.info(f"{self.name!r} PDK is now active")
 
         clear_cache()
 
         if self.base_pdk:
@@ -257,25 +322,22 @@
             cross_sections.update(self.cross_sections)
             self.cross_sections = cross_sections
 
             cells = self.base_pdk.cells
             cells.update(self.cells)
             self.cells.update(cells)
 
-            containers = self.base_pdk.containers
-            containers.update(self.containers)
-            self.containers.update(containers)
-
             layers = self.base_pdk.layers
             layers.update(self.layers)
             self.layers.update(layers)
 
             if not self.default_decorator:
                 self.default_decorator = self.base_pdk.default_decorator
-        self.validate_layers()
+        layers_required = []
+        self.validate_layers(layers_required)
         _set_active_pdk(self)
 
     def register_cells(self, **kwargs) -> None:
         """Register cell factories."""
         for name, cell in kwargs.items():
             if not callable(cell):
                 raise ValueError(
@@ -284,28 +346,14 @@
                 )
             if name in self.cells:
                 warnings.warn(f"Overwriting cell {name!r}")
 
             self.cells[name] = cell
             on_cell_registered.fire(name=name, cell=cell, pdk=self)
 
-    def register_containers(self, **kwargs) -> None:
-        """Register container factories."""
-        for name, cell in kwargs.items():
-            if not callable(cell):
-                raise ValueError(
-                    f"{cell} is not callable, make sure you register "
-                    "cells functions that return a Component"
-                )
-            if name in self.containers:
-                warnings.warn(f"Overwriting container {name!r}")
-
-            self.containers[name] = cell
-            on_container_registered.fire(name=name, cell=cell, pdk=self)
-
     def register_cross_sections(self, **kwargs) -> None:
         """Register cross_sections factories."""
         for name, cross_section in kwargs.items():
             if not callable(cross_section):
                 raise ValueError(
                     f"{cross_section} is not callable, make sure you register "
                     "cross_section functions that return a CrossSection"
@@ -315,15 +363,15 @@
             self.cross_sections[name] = cross_section
             on_cross_section_registered.fire(
                 name=name, cross_section=cross_section, pdk=self
             )
 
     def register_cells_yaml(
         self,
-        dirpath: Optional[PathType] = None,
+        dirpath: PathType | None = None,
         update: bool = False,
         **kwargs,
     ) -> None:
         """Load *.pic.yml YAML files and register them as cells.
 
         Args:
             dirpath: directory to recursive search for YAML cells.
@@ -364,153 +412,133 @@
         if name not in self.cells:
             raise ValueError(f"{name!r} not in {list(self.cells.keys())}")
         self.cells.pop(name)
         logger.info(f"Removed cell {name!r}")
 
     def get_cell(self, cell: CellSpec, **kwargs) -> ComponentFactory:
         """Returns ComponentFactory from a cell spec."""
-        cells_and_containers = set(self.cells.keys()).union(set(self.containers.keys()))
+        cells = set(self.cells.keys())
 
         if callable(cell):
             return cell
         elif isinstance(cell, str):
-            if cell not in cells_and_containers:
+            if cell not in cells:
                 cells = list(self.cells.keys())
-                containers = "\n".join(list(self.containers.keys()))
                 raise ValueError(
                     f"{cell!r} from PDK {self.name!r} not in cells: {cells} "
-                    f"or containers: {containers}"
                 )
-            cell = self.cells[cell] if cell in self.cells else self.containers[cell]
-            return cell
-        elif isinstance(cell, (dict, DictConfig)):
+            return self.cells[cell]
+        elif isinstance(cell, dict | DictConfig):
             for key in cell.keys():
                 if key not in component_settings:
                     raise ValueError(
                         f"Invalid setting {key!r} not in {component_settings}"
                     )
             settings = dict(cell.get("settings", {}))
             settings.update(**kwargs)
 
             cell_name = cell.get("function")
-            if not isinstance(cell_name, str) or cell_name not in cells_and_containers:
+            if not isinstance(cell_name, str) or cell_name not in cells:
                 cells = list(self.cells.keys())
-                containers = list(self.containers.keys())
                 raise ValueError(
                     f"{cell_name!r} from PDK {self.name!r} not in cells: {cells} "
-                    f"or containers: {containers}"
                 )
-            cell = (
-                self.cells[cell_name]
-                if cell_name in self.cells
-                else self.containers[cell_name]
-            )
+            cell = self.cells[cell_name]
             return partial(cell, **settings)
         else:
             raise ValueError(
                 "get_cell expects a CellSpec (ComponentFactory, string or dict),"
                 f"got {type(cell)}"
             )
 
     def get_component(self, component: ComponentSpec, **kwargs) -> Component:
         """Returns component from a component spec."""
-        return self._get_component(
-            component=component, cells=self.cells, containers=self.containers, **kwargs
-        )
+        return self._get_component(component=component, cells=self.cells, **kwargs)
 
     def get_symbol(self, component: ComponentSpec, **kwargs) -> Component:
         """Returns a component's symbol from a component spec."""
         # this is a pretty rough first implementation
         try:
-            self._get_component(
-                component=component, cells=self.symbols, containers={}, **kwargs
-            )
+            self._get_component(component=component, cells=self.symbols, **kwargs)
         except ValueError:
             component = self.get_component(component, **kwargs)
             return self.default_symbol_factory(component)
 
     def _get_component(
         self,
         component: ComponentSpec,
-        cells: Dict[str, Callable],
-        containers: Dict[str, Callable],
+        cells: dict[str, Callable],
         **kwargs,
     ) -> Component:
         """Returns component from a component spec."""
-        cells_and_containers = set(cells.keys()).union(set(containers.keys()))
+        cells = set(cells.keys())
 
         if isinstance(component, Component):
             if kwargs:
                 raise ValueError(f"Cannot apply kwargs {kwargs} to {component.name!r}")
             return component
         elif callable(component):
             return component(**kwargs)
         elif isinstance(component, str):
-            if component not in cells_and_containers:
-                cells = list(cells.keys())
-                containers = list(containers.keys())
+            if component not in cells:
                 raise ValueError(
                     f"{component!r} not in PDK {self.name!r} cells: {cells} "
-                    f"or containers: {containers}"
                 )
-            cell = cells[component] if component in cells else containers[component]
-            return cell(**kwargs)
-        elif isinstance(component, (dict, DictConfig)):
+            return self.cells[component](**kwargs)
+        elif isinstance(component, dict | DictConfig):
             for key in component.keys():
                 if key not in component_settings:
                     raise ValueError(
                         f"Invalid setting {key!r} not in {component_settings}"
                     )
             settings = dict(component.get("settings", {}))
             settings.update(**kwargs)
 
             cell_name = component.get("component", None)
             cell_name = cell_name or component.get("function")
-            if not isinstance(cell_name, str) or cell_name not in cells_and_containers:
-                cells = list(cells.keys())
-                containers = list(containers.keys())
+            cell_name = cell_name.split(".")[-1]
+
+            if not isinstance(cell_name, str) or cell_name not in cells:
                 raise ValueError(
                     f"{cell_name!r} from PDK {self.name!r} not in cells: {cells} "
-                    f"or containers: {containers}"
                 )
-            cell = cells[cell_name] if cell_name in cells else containers[cell_name]
-            component = cell(**settings)
-            return component
+            return self.cells[cell_name](**settings)
         else:
             raise ValueError(
                 "get_component expects a ComponentSpec (Component, ComponentFactory, "
                 f"string or dict), got {type(component)}"
             )
 
     def get_cross_section(
         self, cross_section: CrossSectionSpec, **kwargs
-    ) -> Union[CrossSection, Transition]:
+    ) -> CrossSection | Transition:
         """Returns cross_section from a cross_section spec."""
         if isinstance(cross_section, CrossSection):
             return cross_section.copy(**kwargs)
         elif isinstance(cross_section, Transition):
             return cross_section.copy(**kwargs)
         elif callable(cross_section):
             return cross_section(**kwargs)
         elif isinstance(cross_section, str):
             if cross_section not in self.cross_sections:
                 cross_sections = list(self.cross_sections.keys())
                 raise ValueError(f"{cross_section!r} not in {cross_sections}")
-            cross_section_factory = self.cross_sections[cross_section]
-            return cross_section_factory(**kwargs)
-        elif isinstance(cross_section, (dict, DictConfig)):
+            xs = self.cross_sections[cross_section]
+            return xs(**kwargs) if callable(xs) else xs
+        elif isinstance(cross_section, dict | DictConfig):
             for key in cross_section.keys():
                 if key not in cross_section_settings:
                     raise ValueError(
                         f"Invalid setting {key!r} not in {cross_section_settings}"
                     )
             cross_section_factory_name = cross_section.get("cross_section", None)
             cross_section_factory_name = (
                 cross_section_factory_name or cross_section.get("function")
             )
+            cross_section_factory_name = cross_section_factory_name.split(".")[-1]
             if (
                 not isinstance(cross_section_factory_name, str)
                 or cross_section_factory_name not in self.cross_sections
             ):
                 cross_sections = list(self.cross_sections.keys())
                 raise ValueError(
                     f"{cross_section_factory_name!r} not in {cross_sections}"
@@ -524,15 +552,15 @@
             raise ValueError(
                 "get_cross_section expects a CrossSectionSpec (CrossSection, "
                 f"CrossSectionFactory, Transition, string or dict), got {type(cross_section)}"
             )
 
     def get_layer(self, layer: LayerSpec) -> Layer:
         """Returns layer from a layer spec."""
-        if isinstance(layer, (tuple, list)):
+        if isinstance(layer, tuple | list):
             if len(layer) != 2:
                 raise ValueError(f"{layer!r} needs two integer numbers.")
             return layer
         elif isinstance(layer, int):
             return (layer, 0)
         elif isinstance(layer, str):
             if layer not in self.layers:
@@ -568,14 +596,80 @@
     def get_material_index(self, key: str, *args, **kwargs) -> float:
         if key not in self.materials_index:
             material_names = list(self.materials_index.keys())
             raise ValueError(f"{key!r} not in {material_names}")
         material = self.materials_index[key]
         return material(*args, **kwargs) if callable(material) else material
 
+    def to_updk(self) -> str:
+        """Export to uPDK YAML definition."""
+        from gdsfactory.components.bbox import bbox_to_points
+
+        d = {}
+        blocks = {cell_name: cell() for cell_name, cell in self.cells.items()}
+        blocks = {
+            name: dict(
+                bbox=bbox_to_points(c.bbox),
+                doc=c.__doc__.split("\n")[0],
+                settings=extract_args_from_docstring(c.__doc__),
+                parameters={
+                    sname: {
+                        "value": svalue,
+                        "type": str(svalue.__class__.__name__),
+                        "doc": extract_args_from_docstring(c.__doc__)
+                        .get(sname, {})
+                        .get("doc", None),
+                        "min": extract_args_from_docstring(c.__doc__)
+                        .get(sname, {})
+                        .get("min", 0),
+                        "max": extract_args_from_docstring(c.__doc__)
+                        .get(sname, {})
+                        .get("max", 0),
+                        "unit": extract_args_from_docstring(c.__doc__)
+                        .get(sname, {})
+                        .get("unit", None),
+                    }
+                    for sname, svalue in c.settings.full.items()
+                    if isinstance(svalue, str | float | int)
+                },
+                pins={
+                    port_name: {
+                        "width": port.width,
+                        "xsection": port.cross_section.name
+                        if port.cross_section
+                        else None,
+                        "xya": [
+                            float(port.center[0]),
+                            float(port.center[1]),
+                            float(port.orientation),
+                        ],
+                        "alias": port.info.get("alias"),
+                        "doc": port.info.get("doc"),
+                    }
+                    for port_name, port in c.ports.items()
+                },
+            )
+            for name, c in blocks.items()
+        }
+        xsections = {
+            xs_name: self.get_cross_section(xs_name)
+            for xs_name in self.cross_sections.keys()
+        }
+        xsections = {
+            xs_name: dict(width=xsection.width)
+            for xs_name, xsection in xsections.items()
+        }
+
+        header = dict(description=self.name)
+
+        d["blocks"] = blocks
+        d["xsections"] = xsections
+        d["header"] = header
+        return omegaconf.OmegaConf.to_yaml(d)
+
     # _on_cell_registered = Event()
     # _on_container_registered: Event = Event()
     # _on_yaml_cell_registered: Event = Event()
     # _on_cross_section_registered: Event = Event()
     #
     # @property
     # def on_cell_registered(self) -> Event:
@@ -653,15 +747,15 @@
 def get_sparameters_path() -> pathlib.Path:
     PDK = get_active_pdk()
     if PDK.sparameters_path is None:
         raise ValueError(f"{_ACTIVE_PDK.name!r} has no sparameters_path")
     return PDK.sparameters_path
 
 
-def get_modes_path() -> Optional[pathlib.Path]:
+def get_modes_path() -> pathlib.Path | None:
     PDK = get_active_pdk()
     return PDK.modes_path
 
 
 def get_interconnect_cml_path() -> pathlib.Path:
     PDK = get_active_pdk()
     if PDK.interconnect_cml_path is None:
@@ -672,15 +766,15 @@
 def _set_active_pdk(pdk: Pdk) -> None:
     global _ACTIVE_PDK
     old_pdk = _ACTIVE_PDK
     _ACTIVE_PDK = pdk
     on_pdk_activated.fire(old_pdk=old_pdk, new_pdk=pdk)
 
 
-def get_routing_strategies() -> Dict[str, Callable]:
+def get_routing_strategies() -> dict[str, Callable]:
     """Gets a dictionary of named routing functions available to the PDK, if defined, or gdsfactory defaults otherwise."""
     from gdsfactory.routing.factories import (
         routing_strategy as default_routing_strategies,
     )
 
     routing_strategies = get_active_pdk().routing_strategies
     if routing_strategies is None:
@@ -697,18 +791,27 @@
 
 on_container_registered.add_handler(on_cell_registered.fire)
 on_yaml_cell_registered.add_handler(on_cell_registered.fire)
 on_yaml_cell_modified.add_handler(show)
 
 
 if __name__ == "__main__":
-    from gdsfactory.components import cells
-    from gdsfactory.cross_section import cross_sections
+    from gdsfactory.read.from_updk import from_updk
+    from gdsfactory.samples.pdk.fab_c import pdk
 
-    c = Pdk(
-        name="demo",
-        cells=cells,
-        cross_sections=cross_sections,
-        # layers=dict(DEVREC=(3, 0), PORTE=(3, 5)),
-        sparameters_path="/home",
-    )
-    print(c.json())
+    yaml_pdk_decription = pdk.to_updk()
+    gdsfactory_script = from_updk(yaml_pdk_decription)
+    print(gdsfactory_script)
+    # print(yaml_pdk_decription)
+
+    # from gdsfactory.components import cells
+    # from gdsfactory.cross_section import cross_sections
+
+    # pdk = Pdk(
+    #     name="demo",
+    #     cells=cells,
+    #     cross_sections=cross_sections,
+    # layers=dict(DEVREC=(3, 0), PORTE=(3, 5)),
+    # sparameters_path="/home",
+    # )
+    # print(pdk.json())
+    print(pdk.to_updk())
```

### Comparing `gdsfactory-6.99.0/gdsfactory/picmodel.py` & `gdsfactory-7.0.0/gdsfactory/picmodel.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,27 +1,27 @@
 from __future__ import annotations
 
 from enum import Enum
-from typing import Any, Dict, List, Optional, Union
+from typing import Any
 
 import yaml
 from pydantic import AnyUrl, BaseModel, Extra, Field
 
 import gdsfactory as gf
 
 
 class CrossSection(BaseModel):
     __root__: str = Field(
         ..., description="A cross section to use for waveguides or traces."
     )
 
 
 class RouteSettings(BaseModel):
-    cross_section: Optional[CrossSection] = None
-    separation: Optional[float] = Field(
+    cross_section: CrossSection | None = None
+    separation: float | None = Field(
         5.0, description="The minimum separation between routes in the bundle [um]."
     )
 
     class Config:
         """Extra config."""
 
         extra = Extra.allow
@@ -55,76 +55,76 @@
 
 class Placement(BaseModel):
     class Config:
         """Extra config."""
 
         extra = Extra.forbid
 
-    x: Optional[Union[str, float]] = Field(
+    x: str | float | None = Field(
         None,
         description="The x location at which to place the component.\nThis can either be a number or an other_inst,port definition, meaning it will be placed relative to the port specified on the other instance. \nIf port keyword is defined, this will be relative to the specified port. Otherwise, it will be relative to the cell origin.",
     )
-    y: Optional[Union[str, float]] = Field(
+    y: str | float | None = Field(
         None,
         description="The y location at which to place the component.\nThis can either be a number or an other_inst,port definition, meaning it will be placed relative to the port specified on the other instance. \nIf port keyword is defined, this will be relative to the specified port. Otherwise, it will be relative to the cell origin.",
     )
-    port: Optional[Union[str, PortEnum]] = Field(
+    port: str | PortEnum | None = Field(
         None,
         description="The port or keyword used to anchor the component. Either specify any port on the instance or one of these special keywords:\nne, nc, nw, se, sc, sw, ce, cw, cc for the northeast, north-center, northwest, etc. coordinates of the cell",
     )
-    rotation: Optional[float] = Field(
+    rotation: float | None = Field(
         0,
         description="The rotation of the cell about the origin, or port if defined.",
     )
-    dx: Optional[float] = Field(
+    dx: float | None = Field(
         None,
         description="An additional displacement in the x direction. Useful if x is defined using other_inst,port syntax",
     )
-    dy: Optional[float] = Field(
+    dy: float | None = Field(
         None,
         description="An additional displacement in the y direction. Useful if y is defined using other_inst,port syntax",
     )
-    mirror: Optional[bool] = Field(
+    mirror: bool | None = Field(
         None,
         description="true/false value indicating whether we should flip horizontally.",
     )
 
 
 class Instance(BaseModel):
     class Config:
         """Extra config."""
 
         extra = Extra.forbid
 
     component: str
-    settings: Optional[Dict[str, Any]] = Field(
+    settings: dict[str, Any] | None = Field(
         None, description="Settings for the component"
     )
 
 
 class Route(BaseModel):
     class Config:
         """Extra config."""
 
         extra = Extra.forbid
 
-    routing_strategy: Optional[RoutingStrategy] = None
-    settings: Optional[RouteSettings] = None
-    links: Dict[str, str]
+    routing_strategy: RoutingStrategy | None = None
+    settings: RouteSettings | None = None
+    links: dict[str, str]
 
 
 class PicYamlConfiguration(BaseModel):
-    _schema: Optional[AnyUrl] = Field(None, alias="$schema")
-    instances: Optional[Dict[str, Instance]] = None
-    placements: Optional[Dict[str, Placement]] = None
-    routes: Optional[Dict[str, Route]] = None
-    ports: Optional[Dict[str, str]] = None
+    _schema: AnyUrl | None = Field(None, alias="$schema")
+    instances: dict[str, Instance] | None = None
+    placements: dict[str, Placement] | None = None
+    routes: dict[str, Route] | None = None
+    ports: dict[str, str] | None = None
 
     def add_instance(
-        self, name: str, component: gf.Component, placement: Optional[Placement] = None
+        self, name: str, component: gf.Component, placement: Placement | None = None
     ) -> None:
         component_name = component.settings.function_name
         component_settings = component.settings.changed
         self.instances[name] = Instance(
             component=component_name, settings=component_settings
         )
         if not placement:
@@ -146,30 +146,30 @@
     def to_yaml(self, filename) -> None:
         netlist = self.dict()
         with open(filename, mode="w") as f:
             yaml.dump(netlist, f, default_flow_style=None, sort_keys=False)
 
 
 class SchematicConfiguration(BaseModel):
-    _schema: Optional[AnyUrl] = Field(None, alias="$schema")
-    instances: Optional[Dict[str, Instance]] = None
-    schematic_placements: Optional[Dict[str, Placement]] = None
-    nets: Optional[List[List[str]]] = None
-    ports: Optional[Dict[str, str]] = None
+    _schema: AnyUrl | None = Field(None, alias="$schema")
+    instances: dict[str, Instance] | None = None
+    schematic_placements: dict[str, Placement] | None = None
+    nets: list[list[str]] | None = None
+    ports: dict[str, str] | None = None
 
     @property
     def placements(self):
         return self.schematic_placements
 
     def add_instance(
         self,
         name: str,
-        component: Union[str, gf.Component],
-        placement: Optional[Placement] = None,
-        settings: Optional[Dict[str, Any]] = None,
+        component: str | gf.Component,
+        placement: Placement | None = None,
+        settings: dict[str, Any] | None = None,
     ) -> None:
         if isinstance(component, gf.Component):
             component_name = component.settings.function_name
             component_settings = component.settings.changed
             if settings:
                 component_settings = component_settings | settings
             self.instances[name] = Instance(
```

### Comparing `gdsfactory-6.99.0/gdsfactory/pixelate.py` & `gdsfactory-7.0.0/gdsfactory/pixelate.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
 import itertools as it
-from typing import Optional
 
 import numpy as np
 from shapely import geometry
 from shapely.geometry.polygon import Polygon
 
 from gdsfactory.geometry.functions import polygon_grow
 from gdsfactory.typings import Coordinates
@@ -79,18 +78,18 @@
     return np.round(a / snap_res, 0) * snap_res
 
 
 def _pixelate(
     pts: Coordinates,
     N: int = 100,
     margin: float = 0.4,
-    margin_x: Optional[float] = None,
-    margin_y: Optional[float] = None,
-    nb_pixels_x: Optional[int] = None,
-    nb_pixels_y: Optional[int] = None,
+    margin_x: float | None = None,
+    margin_y: float | None = None,
+    nb_pixels_x: int | None = None,
+    nb_pixels_y: int | None = None,
     min_pixel_size: float = 0.4,
     snap_res: float = 0.05,
 ) -> Coordinates:
     """Pixelates a shape (as 2d array) onto an NxN grid.
 
     Arguments:
         pts: The 2D array to be pixelated.
@@ -174,14 +173,15 @@
 
 def gen_op_blocking(pts, snap_res=0.05, margin=0.3):
     return polygon_grow(pts, margin)
 
 
 if __name__ == "__main__":
     import numpy as np
+
     import gdsfactory as gf
 
     pts = [(x, x**2) for x in np.linspace(0, 1, 5)]
     pts2 = pixelate(pts, min_pixel_size=1e-3, margin=0)
     c = gf.Component()
     c.add_polygon(pts2, layer=(1, 0))
     c.add_polygon(pts, layer=(2, 0))
```

### Comparing `gdsfactory-6.99.0/gdsfactory/port.py` & `gdsfactory-7.0.0/gdsfactory/port.py`

 * *Files 3% similar despite different names*

```diff
@@ -27,34 +27,37 @@
 Adapted from PHIDL https://github.com/amccaugh/phidl/ by Adam McCaughan
 """
 from __future__ import annotations
 
 import csv
 import functools
 import typing
+import warnings
+from collections.abc import Callable
 from functools import partial
-from typing import Any, Callable, Dict, List, Optional, Tuple, Union
+from typing import Any, overload
 
 import numpy as np
 from numpy import ndarray
 from omegaconf import OmegaConf
 
 from gdsfactory.component_layout import _rotate_points
+from gdsfactory.config import logger
 from gdsfactory.cross_section import CrossSection
 from gdsfactory.serialization import clean_value_json
 from gdsfactory.snap import snap_to_grid
 
 if typing.TYPE_CHECKING:
     from gdsfactory.component import Component
 
-Layer = Tuple[int, int]
-Layers = Tuple[Layer, ...]
-LayerSpec = Union[Layer, int, str, None]
-LayerSpecs = Tuple[LayerSpec, ...]
-Float2 = Tuple[float, float]
+Layer = tuple[int, int]
+Layers = tuple[Layer, ...]
+LayerSpec = Layer | int | str | None
+LayerSpecs = tuple[LayerSpec, ...]
+Float2 = tuple[float, float]
 
 
 class PortNotOnGridError(ValueError):
     pass
 
 
 class PortTypeError(ValueError):
@@ -80,29 +83,29 @@
         cross_section: cross_section spec.
         shear_angle: an optional angle to shear port face in degrees.
     """
 
     def __init__(
         self,
         name: str,
-        orientation: Optional[float],
-        center: Tuple[float, float],
-        width: Optional[float] = None,
-        layer: Optional[Tuple[int, int]] = None,
+        orientation: float | None,
+        center: tuple[float, float],
+        width: float | None = None,
+        layer: tuple[int, int] | None = None,
         port_type: str = "optical",
-        parent: Optional[Component] = None,
-        cross_section: Optional[CrossSection] = None,
-        shear_angle: Optional[float] = None,
+        parent: Component | None = None,
+        cross_section: CrossSection | None = None,
+        shear_angle: float | None = None,
     ) -> None:
         """Initializes Port object."""
         self.name = name
         self.center = np.array(center, dtype="float64")
         self.orientation = np.mod(orientation, 360) if orientation else orientation
         self.parent = parent
-        self.info: Dict[str, Any] = {}
+        self.info: dict[str, Any] = {}
         self.port_type = port_type
         self.cross_section = cross_section
         self.shear_angle = shear_angle
 
         if cross_section is None and layer is None:
             raise ValueError("You need Port to define cross_section or layer")
 
@@ -118,56 +121,49 @@
             raise ValueError(
                 f"cross_section = {cross_section} is not a valid CrossSection."
             )
 
         if layer is None:
             layer = cross_section.layer
 
+        if isinstance(layer, list):
+            layer = tuple(layer)
+
         if width is None:
             width = cross_section.width
 
         self.layer = layer
         self.width = width
 
         if self.width < 0:
             raise ValueError(f"Port width must be >=0. Got {self.width}")
 
-    def to_dict(self) -> Dict[str, Any]:
+    def to_dict(self) -> dict[str, Any]:
+        x, y = np.round(self.center, 3)
         d = {
             "name": self.name,
             "width": self.width,
-            "center": tuple(np.round(self.center, 3)),
-            "orientation": int(self.orientation)
-            if self.orientation
-            else self.orientation,
+            "center": [float(x), float(y)],
+            "orientation": self.orientation,
             "layer": self.layer,
             "port_type": self.port_type,
             "shear_angle": self.shear_angle,
         }
         return clean_value_json(d)
 
     def to_yaml(self) -> str:
-        d = {
-            "name": self.name,
-            "width": float(self.width),
-            "center": [float(self.center[0]), float(self.center[1])],
-            "orientation": float(self.orientation)
-            if self.orientation
-            else float(self.orientation),
-            "layer": self.layer,
-            "port_type": self.port_type,
-        }
-        d = OmegaConf.create(d)
+        d = OmegaConf.create(self.to_dict())
         return OmegaConf.to_yaml(d)
 
     def __repr__(self) -> str:
         """Return a string representation of the object."""
-        s = f"Port (name {self.name}, center {self.center}, width {self.width}, orientation {self.orientation}, layer {self.layer}, port_type {self.port_type})"
-        s += f" shear_angle {self.shear_angle}" if self.shear_angle else ""
-        return s
+        filtered_dict = {
+            key: value for key, value in self.to_dict().items() if value is not None
+        }
+        return str(filtered_dict)
 
     @classmethod
     def __get_validators__(cls):
         """Get validators."""
         yield cls.validate
 
     @classmethod
@@ -176,18 +172,15 @@
         assert isinstance(v, Port), f"TypeError, Got {type(v)}, expecting Port"
         assert v.name, f"Port has no name, got {v.name!r}"
         # assert v.assert_on_grid(), f"port.center = {v.center} has off-grid points"
         return v
 
     @property
     def settings(self):
-        """TODO!
-
-        delete this. Use to_dict instead
-        """
+        warnings.warn("Port.settings is deprecated. Use port.to_dict instead!")
         return {
             "name": self.name,
             "center": self.center,
             "width": self.width,
             "orientation": self.orientation,
             "layer": self.layer,
             "port_type": self.port_type,
@@ -200,14 +193,31 @@
         """Returns a copy of the port with a distance (d) in um and angle (deg)."""
         port = self.copy()
         DEG2RAD = np.pi / 180
         dp = np.array((d * np.cos(DEG2RAD * angle), d * np.sin(DEG2RAD * angle)))
         port.move(dp)
         return port
 
+    @overload
+    def move_copy(self, x: np.ndarray | list[int | float, int | float]) -> Port:
+        ...
+
+    @overload
+    def move_copy(self, x: int | float, y: int | float) -> Port:
+        ...
+
+    def move_copy(self, x, y=None) -> Port:
+        """Returns a copy of the port moved by a vector or given x and y."""
+        port = self.copy()
+        if y is None:  # x is a vector
+            port.move(x)
+        else:
+            port.move([x, y])
+        return port
+
     def flip(self, **kwargs) -> Port:
         """Flips port."""
         port = self.copy(**kwargs)
         if port.orientation is None:
             raise ValueError(f"port {self.name!r} has None orientation")
         port.orientation = (port.orientation + 180) % 360
         return port
@@ -263,30 +273,30 @@
     def x(self, value) -> None:
         self.center = (value, self.center[1])
 
     @y.setter
     def y(self, value) -> None:
         self.center = (self.center[0], value)
 
-    def rotate(self, angle: float = 45, center: Optional[Float2] = None) -> Port:
+    def rotate(self, angle: float = 45, center: Float2 | None = None) -> Port:
         """Rotates a Port around the specified center point, if no centerpoint \
         specified will rotate around (0,0).
 
         Args:
             angle: Angle to rotate the Port in degrees.
             center: array-like[2] or None center of the Port.
 
         """
         self.orientation = np.mod(self.orientation + angle, 360)
         if center is None:
             center = self.center
         self.center = _rotate_points(self.center, angle=angle, center=center)
         return self
 
-    def copy(self, name: Optional[str] = None) -> Port:
+    def copy(self, name: str | None = None) -> Port:
         """Returns a copy of the port.
 
         Args:
             name: optional new name.
 
         """
         new_port = Port(
@@ -352,25 +362,25 @@
         else:
             raise PortOrientationError(
                 f"{component_name!r} port {self.name!r} has invalid orientation"
                 f" {self.orientation}"
             )
 
 
-PortsMap = Dict[str, List[Port]]
+PortsMap = dict[str, list[Port]]
 
 
 def port_array(
-    center: Tuple[float, float] = (0.0, 0.0),
+    center: tuple[float, float] = (0.0, 0.0),
     width: float = 0.5,
     orientation: float = 0,
-    pitch: Tuple[float, float] = (10.0, 0.0),
+    pitch: tuple[float, float] = (10.0, 0.0),
     n: int = 2,
     **kwargs,
-) -> List[Port]:
+) -> list[Port]:
     """Returns a list of ports placed in an array.
 
     Args:
         center: center point of the port.
         width: port width.
         orientation: angle in degrees.
         pitch: period of the port array.
@@ -400,26 +410,26 @@
     """
     from gdsfactory.pdk import get_layer
 
     layers = [get_layer(layer) for layer in layers]
     return component.extract(layers=layers)
 
 
-def csv2port(csvpath) -> Dict[str, Port]:
+def csv2port(csvpath) -> dict[str, Port]:
     """Reads ports from a CSV file and returns a Dict."""
     ports = {}
     with open(csvpath) as csvfile:
         rows = csv.reader(csvfile, delimiter=",", quotechar="|")
         for row in rows:
             ports[row[0]] = row[1:]
 
     return ports
 
 
-def sort_ports_clockwise(ports: Dict[str, Port]) -> Dict[str, Port]:
+def sort_ports_clockwise(ports: dict[str, Port]) -> dict[str, Port]:
     """Sort and return ports in the clockwise direction.
 
     .. code::
 
             3   4
             |___|_
         2 -|      |- 5
@@ -455,15 +465,15 @@
     south_ports = direction_ports["S"]
     south_ports.sort(key=lambda p: -p.x)  # sort east to west
 
     ports = west_ports + north_ports + east_ports + south_ports
     return {port.name: port for port in ports}
 
 
-def sort_ports_counter_clockwise(ports: Dict[str, Port]) -> Dict[str, Port]:
+def sort_ports_counter_clockwise(ports: dict[str, Port]) -> dict[str, Port]:
     """Sort and return ports in the counter-clockwise direction.
 
     .. code::
 
             4   3
             |___|_
         5 -|      |- 2
@@ -500,25 +510,25 @@
     south_ports.sort(key=lambda p: +p.x)  # sort west to east
 
     ports = east_ports + north_ports + west_ports + south_ports
     return {port.name: port for port in ports}
 
 
 def select_ports(
-    ports: Dict[str, Port],
-    layer: Optional[Tuple[int, int]] = None,
-    prefix: Optional[str] = None,
-    suffix: Optional[str] = None,
-    orientation: Optional[int] = None,
-    width: Optional[float] = None,
-    layers_excluded: Optional[Tuple[Tuple[int, int], ...]] = None,
-    port_type: Optional[str] = None,
-    names: Optional[List[str]] = None,
+    ports: dict[str, Port],
+    layer: tuple[int, int] | None = None,
+    prefix: str | None = None,
+    suffix: str | None = None,
+    orientation: int | None = None,
+    width: float | None = None,
+    layers_excluded: tuple[tuple[int, int], ...] | None = None,
+    port_type: str | None = None,
+    names: list[str] | None = None,
     clockwise: bool = True,
-) -> Dict[str, Port]:
+) -> dict[str, Port]:
     """Returns a dict of ports from a dict of ports.
 
     Args:
         ports: Dict[str, Port] a port dict {port name: port}.
         layer: select ports with port GDS layer.
         prefix: select ports with port name prefix.
         suffix: select ports with port name suffix.
@@ -531,15 +541,15 @@
     Returns:
         Dict containing the selected ports {port name: port}.
 
     """
     from gdsfactory.component import Component, ComponentReference
 
     # Make it accept Component or ComponentReference
-    if isinstance(ports, (Component, ComponentReference)):
+    if isinstance(ports, Component | ComponentReference):
         ports = ports.ports
 
     if layer:
         ports = {p_name: p for p_name, p in ports.items() if p.layer == layer}
     if prefix:
         ports = {
             p_name: p for p_name, p in ports.items() if str(p_name).startswith(prefix)
@@ -569,48 +579,53 @@
     else:
         ports = sort_ports_counter_clockwise(ports)
     return ports
 
 
 select_ports_optical = partial(select_ports, port_type="optical")
 select_ports_electrical = partial(select_ports, port_type="electrical")
+select_ports_placement = partial(select_ports, port_type="placement")
 
 
-def select_ports_list(**kwargs) -> List[Port]:
+def select_ports_list(**kwargs) -> list[Port]:
     return list(select_ports(**kwargs).values())
 
 
 def flipped(port: Port) -> Port:
     if port.orientation is None:
         raise ValueError(f"port {port.name!r} has None orientation")
     _port = port.copy()
     _port.orientation = (_port.orientation + 180) % 360
     return _port
 
 
 def move_copy(port, x=0, y=0) -> Port:
+    logger.warning(
+        "Port.move_copy(...) should be used instead of move_copy(Port, ...).",
+        DeprecationWarning,
+    )
     _port = port.copy()
     _port.center += (x, y)
     return _port
 
 
-def get_ports_facing(ports: List[Port], direction: str = "W") -> List[Port]:
+def get_ports_facing(ports: list[Port], direction: str = "W") -> list[Port]:
     from gdsfactory.component import Component, ComponentReference
 
     valid_directions = ["E", "N", "W", "S"]
 
     if direction not in valid_directions:
         raise PortOrientationError(f"{direction} must be in {valid_directions} ")
 
     if isinstance(ports, dict):
         ports = list(ports.values())
-    elif isinstance(ports, (Component, ComponentReference)):
+    elif isinstance(ports, Component | ComponentReference):
         ports = list(ports.ports.values())
 
-    direction_ports: Dict[str, List[Port]] = {x: [] for x in ["E", "N", "W", "S"]}
+    direction_ports: dict[str, list[Port]] = {x: [] for x in ["E", "N", "W", "S"]}
 
     for p in ports:
         angle = p.orientation % 360 if p.orientation is not None else 0
         if angle <= 45 or angle >= 315:
             direction_ports["E"].append(p)
         elif angle <= 135 and angle >= 45:
             direction_ports["N"].append(p)
@@ -629,15 +644,15 @@
         auto_rename_ports(component)
         return component
 
     return auto_named_component_factory
 
 
 def _rename_ports_facing_side(
-    direction_ports: Dict[str, List[Port]], prefix: str = ""
+    direction_ports: dict[str, list[Port]], prefix: str = ""
 ) -> None:
     """Renames ports clockwise."""
     for direction, list_ports in list(direction_ports.items()):
         if direction in ["E", "W"]:
             # first sort along x then y
             list_ports.sort(key=lambda p: p.x)
             list_ports.sort(key=lambda p: p.y)
@@ -648,15 +663,15 @@
             list_ports.sort(key=lambda p: p.x)
 
         for i, p in enumerate(list_ports):
             p.name = prefix + direction + str(i)
 
 
 def _rename_ports_facing_side_ccw(
-    direction_ports: Dict[str, List[Port]], prefix: str = ""
+    direction_ports: dict[str, list[Port]], prefix: str = ""
 ) -> None:
     """Renames ports counter-clockwise."""
     for direction, list_ports in list(direction_ports.items()):
         if direction in ["E", "W"]:
             # first sort along x then y
             list_ports.sort(key=lambda p: -p.x)
             list_ports.sort(key=lambda p: -p.y)
@@ -732,15 +747,15 @@
 
     for i, p in enumerate(ports):
         p.name = f"{prefix}{i+1}" if prefix else i + 1
 
 
 def rename_ports_by_orientation(
     component: Component,
-    layers_excluded: Optional[LayerSpec] = None,
+    layers_excluded: LayerSpec | None = None,
     select_ports: Callable = select_ports,
     function=_rename_ports_facing_side,
     prefix: str = "o",
     **kwargs,
 ) -> Component:
     """Returns Component with port names based on port orientation (E, N, W, S).
 
@@ -792,31 +807,35 @@
     component.ports = {p.name: p for p in component.ports.values()}
     return component
 
 
 def auto_rename_ports(
     component: Component,
     function=_rename_ports_clockwise,
-    select_ports_optical: Optional[Callable] = select_ports_optical,
-    select_ports_electrical: Optional[Callable] = select_ports_electrical,
+    select_ports_optical: Callable | None = select_ports_optical,
+    select_ports_electrical: Callable | None = select_ports_electrical,
+    select_ports_placement: Callable | None = select_ports_placement,
     prefix: str = "",
     prefix_optical: str = "o",
     prefix_electrical: str = "e",
-    port_type: Optional[str] = None,
+    prefix_placement: str = "p",
+    port_type: str | None = None,
     **kwargs,
 ) -> Component:
     """Adds prefix for optical and electrical.
 
     Args:
         component: to auto_rename_ports.
         function: to rename ports.
         select_ports_optical: to select optical ports.
         select_ports_electrical: to select electrical ports.
+        select_ports_placement: to select placement ports.
         prefix_optical: prefix of optical ports.
         prefix_electrical: prefix of electrical ports.
+        prefix_placement: prefix of electrical ports.
         port_type: select ports with port type (optical, electrical, vertical_te).
 
     Keyword Args:
         prefix: select ports with port name prefix.
         suffix: select ports with port name suffix.
         orientation: select ports with orientation in degrees.
         width: select ports with port width.
@@ -837,14 +856,22 @@
             rename_ports_by_orientation(
                 component=component,
                 select_ports=select_ports_electrical,
                 prefix=prefix_electrical,
                 function=function,
                 **kwargs,
             )
+        if select_ports_placement:
+            rename_ports_by_orientation(
+                component=component,
+                select_ports=select_ports_placement,
+                prefix=prefix_placement,
+                function=function,
+                **kwargs,
+            )
     else:
         rename_ports_by_orientation(
             component=component,
             select_ports=select_ports,
             prefix=prefix,
             function=function,
             port_type=port_type,
@@ -860,16 +887,16 @@
     auto_rename_ports, function=_rename_ports_facing_side
 )
 
 auto_rename_ports_electrical = partial(auto_rename_ports, select_ports_optical=None)
 
 
 def map_ports_layer_to_orientation(
-    ports: Dict[str, Port], function=_rename_ports_facing_side
-) -> Dict[str, str]:
+    ports: dict[str, Port], function=_rename_ports_facing_side
+) -> dict[str, str]:
     """Returns component or reference port mapping.
 
     .. code::
 
              N0  N1
              |___|_
         W1 -|      |- E1
@@ -900,16 +927,16 @@
                     direction_ports["S"].append(p)
         function(direction_ports, prefix=f"{layer[0]}_{layer[1]}_")
         m.update({p.name: p.name_original for p in ports_on_layer})
     return m
 
 
 def map_ports_to_orientation_cw(
-    ports: Dict[str, Port], function=_rename_ports_facing_side, **kwargs
-) -> Dict[str, str]:
+    ports: dict[str, Port], function=_rename_ports_facing_side, **kwargs
+) -> dict[str, str]:
     """Returns component or reference port mapping clockwise.
 
     Args:
         ports: dict of ports.
         function: to rename ports.
         kwargs: for the function to rename ports.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/quickplotter.py` & `gdsfactory-7.0.0/gdsfactory/quickplotter.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,15 +2,14 @@
 
 based on phidl.quickplotter.
 """
 
 from __future__ import annotations
 
 import sys
-from typing import Optional
 
 import numpy as np
 
 from gdsfactory.component import Component
 from gdsfactory.component_layout import Polygon, _rotate_points
 from gdsfactory.component_reference import ComponentReference
 
@@ -124,22 +123,22 @@
         spancoords="pixels",
         interactive=False,
     )
     return rs
 
 
 def set_quickplot_options(
-    show_ports: Optional[bool] = None,
-    show_subports: Optional[bool] = None,
-    label_aliases: Optional[bool] = None,
-    new_window: Optional[bool] = None,
-    blocking: Optional[bool] = None,
-    zoom_factor: Optional[float] = None,
-    interactive_zoom: Optional[bool] = None,
-    fontsize: Optional[int] = None,
+    show_ports: bool | None = None,
+    show_subports: bool | None = None,
+    label_aliases: bool | None = None,
+    new_window: bool | None = None,
+    blocking: bool | None = None,
+    zoom_factor: float | None = None,
+    interactive_zoom: bool | None = None,
+    fontsize: int | None = None,
 ) -> None:
     """Sets plotting options for quickplot().
 
     Args:
         show_ports: Sets whether ports are drawn.
         show_subports: Sets whether subports (ports that belong to references) are drawn.
         label_aliases: Sets whether aliases are labeled with a text name.
@@ -237,15 +236,15 @@
 
     # Iterate through each Component/ComponentReference/Polygon
     if not isinstance(items, list):
         items = [items]
     LAYER_VIEWS = get_layer_views()
     all_lv_tuples = LAYER_VIEWS.get_layer_tuples()
     for item in items:
-        if isinstance(item, (Component, ComponentReference)):
+        if isinstance(item, Component | ComponentReference):
             polygons_spec = item.get_polygons(by_spec=True, depth=None)
             for key in sorted(polygons_spec):
                 polygons = polygons_spec[key]
                 layer_view = (
                     LAYER_VIEWS.get_from_tuple(key)
                     if key in all_lv_tuples
                     else LayerView(layer=key)
@@ -256,15 +255,15 @@
                     ax,
                     facecolor=colors["fill_color"],
                     edgecolor=colors["frame_color"],
                     alpha=layer_view.get_alpha(),
                 )
                 bbox = _update_bbox(bbox, new_bbox)
             # If item is a Component or ComponentReference, draw ports
-            if isinstance(item, (Component, ComponentReference)) and show_ports is True:
+            if isinstance(item, Component | ComponentReference) and show_ports is True:
                 for port in item.ports.values():
                     if (
                         (port.width is None)
                         or (port.width == 0)
                         or port.orientation is None
                     ):
                         new_bbox = _draw_port_as_point(ax, port)
@@ -738,17 +737,15 @@
 
     def update_gridsize_label(self) -> None:
         self.gridsize_label.setText(f"grid size = {str(self.grid_size_snapped)}")
         self.gridsize_label.move(QPoint(5, self.height() - 25))
 
     def update_mouse_position_label(self) -> None:
         self.position_label.setText(
-            "X = {:0.4f} / Y = {:0.4f}".format(
-                self.mouse_position[0], self.mouse_position[1]
-            )
+            f"X = {self.mouse_position[0]:0.4f} / Y = {self.mouse_position[1]:0.4f}"
         )
         self.position_label.move(QPoint(self.width() - 250, self.height() - 25))
 
     def update_help_label(self) -> None:
         self.help_label.setText('Press "?" key for help')
         self.help_label.move(QPoint(self.width() - 175, 0))
 
@@ -951,24 +948,21 @@
     if QCoreApplication.instance() is None:
         app = QApplication(sys.argv)
     if "viewer_window" not in globals():
         global viewer_window
         viewer_window = ViewerWindow()
     viewer = viewer_window.viewer
     viewer.initialize()
-    if not isinstance(item_list, (list, tuple)):
+    if not isinstance(item_list, list | tuple):
         item_list = [item_list]
     LAYER_VIEWS = get_layer_views()
     for element in item_list:
         if isinstance(
             element,
-            (
-                Component,
-                ComponentReference,
-            ),
+            Component | ComponentReference,
         ):
             # Draw polygons in the element
             polygons_spec = element.get_polygons(by_spec=True, depth=None)
             for key in sorted(polygons_spec):
                 polygons = polygons_spec[key]
                 layer_view = (
                     LAYER_VIEWS.get_from_tuple(key)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/__init__.py` & `gdsfactory-7.0.0/gdsfactory/read/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 from __future__ import annotations
 
 from gdsfactory.read.from_dphox import from_dphox
 from gdsfactory.read.from_gdspaths import from_gdsdir, from_gdspaths
 from gdsfactory.read.from_np import from_np
 from gdsfactory.read.from_phidl import from_gdstk, from_phidl
-from gdsfactory.read.from_yaml import from_yaml, cell_from_yaml
+from gdsfactory.read.from_yaml import cell_from_yaml, from_yaml
 from gdsfactory.read.from_yaml_template import cell_from_yaml_template
 from gdsfactory.read.import_gds import import_gds, import_gds_raw
 
 __all__ = [
     "from_dphox",
     "from_gdsdir",
     "from_gdspaths",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/from_dphox.py` & `gdsfactory-7.0.0/gdsfactory/read/from_dphox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/read/from_gdspaths.py` & `gdsfactory-7.0.0/gdsfactory/read/from_gdspaths.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,29 +1,28 @@
 from __future__ import annotations
 
 import pathlib
-from typing import Tuple
 
 from gdsfactory.component import Component
 from gdsfactory.config import logger
 from gdsfactory.read.import_gds import import_gds
 from gdsfactory.typings import ComponentOrPath, PathType
 
 
-def from_gdspaths(cells: Tuple[ComponentOrPath, ...]) -> Component:
+def from_gdspaths(cells: tuple[ComponentOrPath, ...]) -> Component:
     """Combine all GDS files or gf.components into a gf.component.
 
     Args:
         cells: List of gdspaths or Components.
 
     """
     component = Component("merged")
 
     for c in cells:
-        if isinstance(c, (str, pathlib.Path)):
+        if isinstance(c, str | pathlib.Path):
             logger.info(f"Loading {c!r}")
             c = import_gds(c)
 
         assert isinstance(c, Component)
         component << c
 
     return component
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/from_np.py` & `gdsfactory-7.0.0/gdsfactory/read/from_np.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,12 +1,10 @@
 """Read component from a numpy.ndarray."""
 from __future__ import annotations
 
-from typing import Tuple
-
 import numpy as np
 
 from gdsfactory.component import Component
 from gdsfactory.geometry.boolean import boolean
 
 
 def compute_area_signed(pr) -> float:
@@ -21,15 +19,15 @@
     ys.append(ys[1])
     return sum(xs[i] * (ys[i + 1] - ys[i - 1]) for i in range(1, len(pr))) / 2.0
 
 
 def from_np(
     ndarray: np.ndarray,
     nm_per_pixel: int = 20,
-    layer: Tuple[int, int] = (1, 0),
+    layer: tuple[int, int] = (1, 0),
     threshold: float = 0.99,
 ) -> Component:
     """Returns Component from a np.ndarray.
 
     Extracts contours skimage.measure.find_contours using `threshold`.
 
     Args:
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/from_phidl.py` & `gdsfactory-7.0.0/gdsfactory/read/from_phidl.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,21 +1,21 @@
 from __future__ import annotations
 
 import pathlib
 import tempfile
-from functools import lru_cache
+from functools import cache
 
 import gdstk
 
 from gdsfactory.component import Component, Port
 from gdsfactory.read.import_gds import import_gds
 from gdsfactory.typings import Layer
 
 
-@lru_cache(maxsize=None)
+@cache
 def from_gdstk(cell: gdstk.Cell, **kwargs) -> Component:
     """Returns gdsfactory Component from a gdstk cell.
 
     Args:
         cell: gdstk cell.
 
     Keyword Args:
@@ -30,15 +30,15 @@
         gdsdir = pathlib.Path(gdsdir)
         gdsdir.mkdir(exist_ok=True)
         gdspath = gdsdir / f"{cell.name}.gds"
         filepath = cell.write_gds(gdspath)
         return import_gds(filepath, **kwargs)
 
 
-@lru_cache(maxsize=None)
+@cache
 def from_phidl(component, port_layer: Layer = (1, 0), **kwargs) -> Component:
     """Returns gdsfactory Component from a phidl Device or function.
 
     Args:
         component: phidl component.
         port_layer: to add to component ports.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/from_yaml.py` & `gdsfactory-7.0.0/gdsfactory/read/from_yaml.py`

 * *Files 3% similar despite different names*

```diff
@@ -48,20 +48,20 @@
 """
 from __future__ import annotations
 
 import importlib
 import io
 import pathlib
 import warnings
+from collections.abc import Callable
 from functools import partial
-from typing import IO, Any, Callable, Dict, List, Optional, Union
+from typing import IO, Any, Literal
 
 import numpy as np
 from omegaconf import DictConfig, OmegaConf
-from typing_extensions import Literal
 
 from gdsfactory.add_pins import add_instance_label
 from gdsfactory.cell import cell
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.typings import Route
 
 valid_placement_keys = [
@@ -123,41 +123,41 @@
     "routing_strategy",
 ]
 # Recognized keys within a YAML route definition
 
 
 def _get_anchor_point_from_name(
     ref: ComponentReference, anchor_name: str
-) -> Optional[np.ndarray]:
+) -> np.ndarray | None:
     if anchor_name in valid_anchor_point_keywords:
         return getattr(ref.size_info, anchor_name)
     elif anchor_name in ref.ports:
         return ref.ports[anchor_name].center
     else:
         return None
 
 
 def _get_anchor_value_from_name(
     ref: ComponentReference, anchor_name: str, return_value: str
-) -> Optional[float]:
+) -> float | None:
     if anchor_name in valid_anchor_value_keywords:
         return getattr(ref.size_info, anchor_name)
     anchor_point = _get_anchor_point_from_name(ref, anchor_name)
     if anchor_point is None:
         return None
     if return_value == "x":
         return anchor_point[0]
     elif return_value == "y":
         return anchor_point[1]
     else:
         raise ValueError("Expected x or y as return_value.")
 
 
 def _move_ref(
-    x: Union[str, float],
+    x: str | float,
     x_or_y: Literal["x", "y"],
     placements_conf,
     connections_by_transformed_inst,
     instances,
     encountered_insts,
     all_remaining_insts,
 ) -> float:
@@ -193,20 +193,20 @@
             f"or `{x_or_y}: instanceName,portName`, got `{x_or_y}: {x!r}`"
         )
 
     return _get_anchor_value_from_name(instances[instance_name_ref], port_name, x_or_y)
 
 
 def place(
-    placements_conf: Dict[str, Dict[str, Union[int, float, str]]],
-    connections_by_transformed_inst: Dict[str, Dict[str, str]],
-    instances: Dict[str, ComponentReference],
-    encountered_insts: List[str],
-    instance_name: Optional[str] = None,
-    all_remaining_insts: Optional[List[str]] = None,
+    placements_conf: dict[str, dict[str, int | float | str]],
+    connections_by_transformed_inst: dict[str, dict[str, str]],
+    instances: dict[str, ComponentReference],
+    encountered_insts: list[str],
+    instance_name: str | None = None,
+    all_remaining_insts: list[str] | None = None,
 ) -> None:
     """Place instance_name based on placements_conf config.
 
     Args:
         placements_conf: Dict of instance_name to placement (x, y, rotation ...).
         connections_by_transformed_inst: Dict of connection attributes.
             keyed by the name of the instance which should be transformed.
@@ -267,15 +267,15 @@
                     ref.mirror_x(x0=x)
                 else:
                     ref.mirror_x()
             elif mirror is False:
                 pass
             elif isinstance(mirror, str):
                 ref.mirror_x(port_name=mirror)
-            elif isinstance(mirror, (int, float)):
+            elif isinstance(mirror, int | float):
                 ref.mirror_x(x0=mirror)
             else:
                 raise ValueError(
                     f"{mirror!r} can only be a port name {ref.ports.keys()}, "
                     "x value or True/False"
                 )
 
@@ -390,15 +390,15 @@
                 all_remaining_insts,
             )
 
         make_connection(instances=instances, **conn_info)
         # placements_conf.pop(instance_name)
 
 
-def transform_connections_dict(connections_conf: Dict[str, str]) -> Dict[str, Dict]:
+def transform_connections_dict(connections_conf: dict[str, str]) -> dict[str, dict]:
     """Returns Dict with source_instance_name key and connection properties."""
     if not connections_conf:
         return {}
     attrs_by_src_inst = {}
     for port_src_string, port_dst_string in connections_conf.items():
         instance_src_name, port_src_name = port_src_string.split(",")
         instance_dst_name, port_dst_name = port_dst_string.split(",")
@@ -412,15 +412,15 @@
 
 
 def make_connection(
     instance_src_name: str,
     port_src_name: str,
     instance_dst_name: str,
     port_dst_name: str,
-    instances: Dict[str, ComponentReference],
+    instances: dict[str, ComponentReference],
 ) -> None:
     """Connect instance_src_name,port to instance_dst_name,port.
 
     Args:
         instance_src_name: source instance name.
         port_src_name: from instance_src_name.
         instance_dst_name: destination instance name.
@@ -489,19 +489,19 @@
     o1: mmi_short,o1
     o2: mmi_long,o2
     o3: mmi_long,o3
 """
 
 
 def cell_from_yaml(
-    yaml_str: Union[str, pathlib.Path, IO[Any], Dict[str, Any], DictConfig],
-    routing_strategy: Optional[Dict[str, Callable]] = None,
+    yaml_str: str | pathlib.Path | IO[Any] | dict[str, Any] | DictConfig,
+    routing_strategy: dict[str, Callable] | None = None,
     label_instance_function: Callable = add_instance_label,
-    name: Optional[str] = None,
-    prefix: Optional[str] = None,
+    name: str | None = None,
+    prefix: str | None = None,
     **kwargs,
 ) -> Callable:
     """Returns Component factory from YAML string or file.
 
     YAML includes instances, placements, routes, ports and connections.
 
     Args:
@@ -526,19 +526,19 @@
         instances:
             name:
                 component: (ComponentSpec)
                 settings (Optional)
                     length: 10
                     ...
         placements:
-            x: Optional[float, str]  str can be instanceName,portName
-            y: Optional[float, str]
-            rotation: Optional[float]
-            mirror: Optional[bool, float] float is x mirror axis
-            port: Optional[str] port anchor
+            x: float, str | None  str can be instanceName,portName
+            y: float, str | None
+            rotation: float | None
+            mirror: bool, float | None float is x mirror axis
+            port: str | None port anchor
         connections (Optional): between instances
         ports (Optional): ports to expose
         routes (Optional): bundles of routes
             routeName:
             library: optical
             links:
                 instance1,port1: instance2,port2
@@ -587,19 +587,19 @@
         name=name,
         prefix=prefix,
         **kwargs,
     )
 
 
 def from_yaml(
-    yaml_str: Union[str, pathlib.Path, IO[Any], Dict[str, Any], DictConfig],
-    routing_strategy: Optional[Dict[str, Callable]] = None,
+    yaml_str: str | pathlib.Path | IO[Any] | dict[str, Any] | DictConfig,
+    routing_strategy: dict[str, Callable] | None = None,
     label_instance_function: Callable = add_instance_label,
-    name: Optional[str] = None,
-    prefix: Optional[str] = None,
+    name: str | None = None,
+    prefix: str | None = None,
     **kwargs,
 ) -> Component:
     """Returns Component from YAML string or file.
 
     YAML includes instances, placements, routes, ports and connections.
 
     Args:
@@ -624,19 +624,19 @@
         instances:
             name:
                 component: (ComponentSpec)
                 settings (Optional)
                     length: 10
                     ...
         placements:
-            x: Optional[float, str]  str can be instanceName,portName
-            y: Optional[float, str]
-            rotation: Optional[float]
-            mirror: Optional[bool, float] float is x mirror axis
-            port: Optional[str] port anchor
+            x: float, str | None  str can be instanceName,portName
+            y: float, str | None
+            rotation: float | None
+            mirror: bool, float | None float is x mirror axis
+            port: str | None port anchor
         connections (Optional): between instances
         ports (Optional): ports to expose
         routes (Optional): bundles of routes
             routeName:
             library: optical
             links:
                 instance1,port1: instance2,port2
@@ -677,15 +677,15 @@
                     mmi_top,o3: mmi_bot,o1
 
     """
     from gdsfactory.pdk import get_routing_strategies
 
     if routing_strategy is None:
         routing_strategy = get_routing_strategies()
-    if isinstance(yaml_str, (str, pathlib.Path, IO)):
+    if isinstance(yaml_str, str | pathlib.Path | IO):
         yaml_str = (
             io.StringIO(yaml_str)
             if isinstance(yaml_str, str) and "\n" in yaml_str
             else yaml_str
         )
 
         conf = OmegaConf.load(
@@ -717,15 +717,15 @@
         mode=mode,
     )
 
 
 @cell
 def _from_yaml(
     conf,
-    routing_strategy: Dict[str, Callable],
+    routing_strategy: dict[str, Callable],
     label_instance_function: Callable = add_instance_label,
     mode: str = "layout",
 ) -> Component:
     """Returns component from YAML decorated with cell for caching and autonaming.
 
     Args:
         conf: dict.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/from_yaml_template.py` & `gdsfactory-7.0.0/gdsfactory/read/from_yaml_template.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,27 +1,30 @@
 import pathlib
+from collections.abc import Callable, Iterable
 from inspect import Parameter, Signature, signature
 from io import IOBase
-from typing import Optional, Dict, Callable, Union, IO, Any, Iterable, Tuple
+from typing import IO, Any
 
 import jinja2
 import yaml
 
+from gdsfactory.component import Component
+
 __all__ = ["cell_from_yaml_template"]
 
 
-def split_default_settings_from_yaml(yaml_lines: Iterable[str]) -> Tuple[str, str]:
+def split_default_settings_from_yaml(yaml_lines: Iterable[str]) -> tuple[str, str]:
     """Separates out the 'default_settings' block from the rest of the file body.
     Note: 'default settings' MUST be at the TOP of the file.
 
     Args:
-        yaml_lines: the lines of text in the yaml file
+        yaml_lines: the lines of text in the yaml file.
 
     Returns:
-        a tuple of (main file contents), (setting block), both as multi-line strings
+        a tuple of (main file contents), (setting block), both as multi-line strings.
     """
     settings_lines = []
     other_lines = []
     # start reading all lines
     while yaml_lines:
         # pop lines until we find the default_settings block
         line = yaml_lines.pop(0)
@@ -55,26 +58,27 @@
         default_settings = yaml.safe_load(default_settings_string)["default_settings"]
     else:
         default_settings = {}
     return main_file, default_settings
 
 
 def cell_from_yaml_template(
-    filename: Union[str, IO[Any], pathlib.Path],
+    filename: str | IO[Any] | pathlib.Path,
     name: str,
-    routing_strategy: Optional[Dict[str, Callable]] = None,
+    routing_strategy: dict[str, Callable] | None = None,
 ) -> Callable:
     """Gets a PIC factory function from a yaml definition, which can optionally be a jinja template.
 
     Args:
-        filename: the filepath of the pic yaml template
-        name: the name of the component to create
-        routing_strategy: a dictionary of routing functions
+        filename: the filepath of the pic yaml template.
+        name: the name of the component to create.
+        routing_strategy: a dictionary of routing functions.
+
     Returns:
-         a factory function for the component
+         a factory function for the component.
     """
     from gdsfactory.pdk import get_routing_strategies
 
     if routing_strategy is None:
         routing_strategy = get_routing_strategies()
     return yaml_cell(
         yaml_definition=filename, name=name, routing_strategy=routing_strategy
@@ -93,23 +97,24 @@
         except KeyError as ke:
             raise KeyError(
                 f'Required key "value" not supplied for default setting "{k}"'
             ) from ke
     return settings
 
 
-def yaml_cell(yaml_definition, name, routing_strategy):
+def yaml_cell(yaml_definition, name: str, routing_strategy) -> Callable[..., Component]:
     """The "cell" decorator equivalent for yaml files. Generates a proper cell function for yaml-defined circuits.
 
     Args:
-        yaml_definition: the filename to the pic yaml definition
-        name: the name of the pic to create
-        routing_strategy: a dictionary of routing strategies to use for pic generation
+        yaml_definition: the filename to the pic yaml definition.
+        name: the name of the pic to create.
+        routing_strategy: a dictionary of routing strategies to use for pic generation.
+
     Returns:
-        a dynamically-generated function for the yaml file
+        a dynamically-generated function for the yaml file.
     """
     from gdsfactory.cell import cell_without_validator
 
     yaml_body, default_settings_def = _split_yaml_definition(yaml_definition)
     default_settings = get_default_settings_dict(default_settings_def)
 
     def _yaml_func(**kwargs):
@@ -147,21 +152,24 @@
 def _evaluate_yaml_template(main_file, default_settings, settings):
     template = jinja2.Template(main_file)
     complete_settings = dict(default_settings)
     complete_settings.update(settings)
     return template.render(**complete_settings)
 
 
-def _pic_from_templated_yaml(evaluated_text, name, routing_strategy):
-    """Creates a component from a  *.pic.yml file. This is a lower-level function. See from_yaml_template() for more common usage.
+def _pic_from_templated_yaml(evaluated_text, name, routing_strategy) -> Component:
+    """Creates a component from a  *.pic.yml file.
+
+    This is a lower-level function. See from_yaml_template() for more common usage.
 
     Args:
-        name: the pic name
-        routing_strategy: a dictionary of route factories
-    Returns: the component
+        name: the pic name.
+        routing_strategy: a dictionary of route factories.
+
+    Returns: the component.
     """
     from gdsfactory.read.from_yaml import from_yaml
 
     c = from_yaml(
         evaluated_text,
         routing_strategy=routing_strategy,
     ).copy()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/import_gds.py` & `gdsfactory-7.0.0/gdsfactory/read/import_gds.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,27 +1,26 @@
 from __future__ import annotations
 
 from pathlib import Path
-from typing import Optional, Union
 
 import gdstk
 from omegaconf import OmegaConf
 
 from gdsfactory.cell import Settings, cell
 from gdsfactory.component import Component
 from gdsfactory.component_reference import ComponentReference
 from gdsfactory.config import logger
 from gdsfactory.name import get_name_short
 
 
 @cell
 def import_gds(
-    gdspath: Union[str, Path],
-    cellname: Optional[str] = None,
-    gdsdir: Optional[Union[str, Path]] = None,
+    gdspath: str | Path,
+    cellname: str | None = None,
+    gdsdir: str | Path | None = None,
     read_metadata: bool = False,
     hashed_name: bool = True,
     **kwargs,
 ) -> Component:
     """Returns a Component from a GDS file.
 
     appends $ with a number to the name if the cell name is on CACHE
@@ -128,15 +127,15 @@
                     )
 
     component.info.update(**kwargs)
     component.imported_gds = True
     return component
 
 
-def import_gds_raw(gdspath, top_cellname: Optional[str] = None):
+def import_gds_raw(gdspath, top_cellname: str | None = None):
     if not top_cellname:
         if gdspath.suffix.lower() == ".gds":
             gdsii_lib = gdstk.read_gds(str(gdspath))
         elif gdspath.suffix.lower() == ".oas":
             gdsii_lib = gdstk.read_oas(str(gdspath))
         top_level_cells = gdsii_lib.top_level()
         top_cellnames = [c.name for c in top_level_cells]
```

### Comparing `gdsfactory-6.99.0/gdsfactory/read/labels.py` & `gdsfactory-7.0.0/gdsfactory/read/labels.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,24 +1,22 @@
 from __future__ import annotations
 
-from typing import Dict, Optional
-
 import numpy as np
 import pandas as pd
 from omegaconf import DictConfig, OmegaConf
 
 import gdsfactory as gf
 from gdsfactory.component_layout import _rotate_points
 from gdsfactory.name import clean_name
 from gdsfactory.typings import LayerSpec, PathType
 
 
 def read_labels_yaml(
-    csvpath: PathType, prefix: Optional[str] = None
-) -> Dict[str, DictConfig]:
+    csvpath: PathType, prefix: str | None = None
+) -> dict[str, DictConfig]:
     """Read labels from csvfile in YAML format."""
     labels = pd.read_csv(csvpath)
     cells = OmegaConf.create()
 
     for label in labels.iterrows():
         label = label[1]
         if prefix and not label[0].startswith(prefix):
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/__init__.py` & `gdsfactory-7.0.0/gdsfactory/routing/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,16 +4,16 @@
 
 from gdsfactory.routing import sort_ports, utils
 from gdsfactory.routing.add_electrical_pads_shortest import add_electrical_pads_shortest
 from gdsfactory.routing.add_electrical_pads_top import add_electrical_pads_top
 from gdsfactory.routing.add_electrical_pads_top_dc import add_electrical_pads_top_dc
 from gdsfactory.routing.add_fiber_array import add_fiber_array
 from gdsfactory.routing.add_fiber_single import add_fiber_single
-from gdsfactory.routing.add_pads import add_pads_top, add_pads_bot
-
+from gdsfactory.routing.add_pads import add_pads_bot, add_pads_top
+from gdsfactory.routing.all_angle import get_bundle_all_angle
 from gdsfactory.routing.fanout import fanout_component, fanout_ports
 from gdsfactory.routing.fanout2x2 import fanout2x2
 from gdsfactory.routing.get_bundle import (
     get_bundle,
     get_bundle_electrical,
     get_bundle_electrical_multilayer,
 )
@@ -49,16 +49,14 @@
 from gdsfactory.routing.get_routes_bend180 import get_routes_bend180
 from gdsfactory.routing.get_routes_straight import get_routes_straight
 from gdsfactory.routing.route_ports_to_side import route_ports_to_side
 from gdsfactory.routing.route_quad import route_quad
 from gdsfactory.routing.route_sharp import route_sharp
 from gdsfactory.routing.route_south import route_south
 
-from gdsfactory.routing.all_angle import get_bundle_all_angle
-
 __all__ = [
     "add_electrical_pads_shortest",
     "add_electrical_pads_top",
     "add_electrical_pads_top_dc",
     "add_pads_top",
     "add_pads_bot",
     "add_fiber_array",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/add_electrical_pads_shortest.py` & `gdsfactory-7.0.0/gdsfactory/routing/add_electrical_pads_shortest.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.straight import straight
 from gdsfactory.port import select_ports_electrical
 from gdsfactory.routing.route_quad import route_quad
-from gdsfactory.typings import ComponentSpec, Optional, Strs, Callable
+from gdsfactory.typings import Callable, ComponentSpec, Strs
 
 
 @gf.cell
 def add_electrical_pads_shortest(
     component: ComponentSpec = straight,
     pad: ComponentSpec = "pad",
     pad_port_spacing: float = 50.0,
     select_ports: Callable = select_ports_electrical,
-    port_names: Optional[Strs] = None,
+    port_names: Strs | None = None,
     port_orientation: float = 90,
     layer: gf.typings.LayerSpec = "M3",
 ) -> Component:
     """Returns new Component with a pad by each electrical port.
 
     Args:
         component: to route.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/add_electrical_pads_top.py` & `gdsfactory-7.0.0/gdsfactory/routing/add_electrical_pads_top.py`

 * *Files 4% similar despite different names*

```diff
@@ -2,25 +2,25 @@
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.pad import pad_array as pad_array_function
 from gdsfactory.components.straight import straight
 from gdsfactory.port import select_ports_electrical
 from gdsfactory.routing.route_quad import route_quad
-from gdsfactory.typings import ComponentSpec, Float2, Optional, Strs, Callable
+from gdsfactory.typings import Callable, ComponentSpec, Float2, Strs
 
 
 @gf.cell
 def add_electrical_pads_top(
     component: ComponentSpec = straight,
     direction: str = "top",
     spacing: Float2 = (0.0, 100.0),
     pad_array: ComponentSpec = pad_array_function,
     select_ports: Callable = select_ports_electrical,
-    port_names: Optional[Strs] = None,
+    port_names: Strs | None = None,
     layer: gf.typings.LayerSpec = "MTOP",
 ) -> Component:
     """Returns new component with electrical ports connected to top pad array.
 
     Args:
         component: to route.
         direction: 'top' or 'right', sets direction of the array.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/add_electrical_pads_top_dc.py` & `gdsfactory-7.0.0/gdsfactory/routing/add_electrical_pads_top_dc.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,29 +1,29 @@
 from __future__ import annotations
 
-from typing import Callable
+from collections.abc import Callable
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.straight_heater_metal import straight_heater_metal
 from gdsfactory.port import select_ports_electrical
 from gdsfactory.routing.get_bundle import get_bundle_electrical
 from gdsfactory.routing.sort_ports import sort_ports_x
-from gdsfactory.typings import ComponentSpec, Float2, Optional, Strs
+from gdsfactory.typings import ComponentSpec, Float2, Strs
 
 
 @cell
 def add_electrical_pads_top_dc(
     component: ComponentSpec = straight_heater_metal,
     spacing: Float2 = (0.0, 100.0),
     pad_array: ComponentSpec = "pad_array",
     select_ports: Callable = select_ports_electrical,
     get_bundle_function: Callable = get_bundle_electrical,
-    port_names: Optional[Strs] = None,
+    port_names: Strs | None = None,
     **kwargs,
 ) -> Component:
     """Returns new component with electrical ports connected to top pad array.
 
     Args:
         component: component spec to connect to.
         spacing: component to pad spacing.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/add_fiber_array.py` & `gdsfactory-7.0.0/gdsfactory/routing/add_fiber_array.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,38 +1,39 @@
 from __future__ import annotations
 
-from typing import Callable, Optional, Tuple
+from collections.abc import Callable
+from functools import partial
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.grating_coupler_elliptical_trenches import grating_coupler_te
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.port import select_ports_optical
+from gdsfactory.routing.get_input_labels import get_input_labels_dash
 from gdsfactory.routing.route_fiber_array import route_fiber_array
 from gdsfactory.routing.sort_ports import sort_ports_x
 from gdsfactory.typings import (
     ComponentSpec,
     ComponentSpecOrList,
     CrossSectionSpec,
     LayerSpec,
 )
-from gdsfactory.routing.get_input_labels import get_input_labels_dash
 
 
 @gf.cell
 def add_fiber_array(
     component: ComponentSpec = straight_function,
     grating_coupler: ComponentSpecOrList = grating_coupler_te,
     gc_port_name: str = "o1",
-    gc_port_labels: Optional[Tuple[str, ...]] = None,
-    component_name: Optional[str] = None,
+    gc_port_labels: tuple[str, ...] | None = None,
+    component_name: str | None = None,
     select_ports: Callable = select_ports_optical,
     cross_section: CrossSectionSpec = "strip",
-    get_input_labels_function: Optional[Callable] = get_input_labels_dash,
-    layer_label: LayerSpec = "TEXT",
+    get_input_labels_function: Callable | None = get_input_labels_dash,
+    layer_label: LayerSpec = "LABEL",
     **kwargs,
 ) -> Component:
     """Returns component with south routes and grating_couplers.
 
     You can also use pads or other terminations instead of grating couplers.
 
     Args:
@@ -203,15 +204,15 @@
 
 if __name__ == "__main__":
     from gdsfactory.routing.get_input_labels import get_input_labels_dash
 
     # test_type0()
     gcte = gf.components.grating_coupler_te
     gctm = gf.components.grating_coupler_tm
-    strip = gf.partial(
+    strip = partial(
         gf.cross_section.cross_section,
         width=1,
         layer=(2, 0),
         # bbox_layers=((61, 0), (62, 0)),
         # bbox_offsets=(3, 3)
         # cladding_layers=((61, 0), (62, 0)),
         # cladding_offsets=(3, 3)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/add_fiber_single.py` & `gdsfactory-7.0.0/gdsfactory/routing/add_fiber_single.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 from __future__ import annotations
 
-from typing import Callable, Optional
+from collections.abc import Callable
 
 import gdsfactory as gf
-from gdsfactory.add_labels import get_input_label_text_loopback
+from gdsfactory.add_labels import (
+    get_input_label_text_dash,
+    get_input_label_text_dash_loopback,
+    get_input_label_text_loopback,
+)
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.grating_coupler_elliptical_trenches import grating_coupler_te
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.functions import move_port_to_zero
 from gdsfactory.port import select_ports_optical
 from gdsfactory.routing.get_input_labels import get_input_labels
 from gdsfactory.routing.get_route import get_route_from_waypoints
 from gdsfactory.routing.route_fiber_single import route_fiber_single
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, LayerSpec
-from gdsfactory.add_labels import (
-    get_input_label_text_dash,
-    get_input_label_text_dash_loopback,
-)
 
 
 @cell
 def add_fiber_single(
     component: ComponentSpec = straight_function,
     grating_coupler=grating_coupler_te,
     layer_label: LayerSpec = "LABEL",
@@ -30,21 +30,20 @@
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
     route_filter: Callable = get_route_from_waypoints,
     min_input_to_output_spacing: float = 200.0,
     optical_routing_type: int = 2,
     with_loopback: bool = True,
     loopback_xspacing: float = 50.0,
-    component_name: Optional[str] = None,
+    component_name: str | None = None,
     gc_port_name: str = "o1",
-    zero_port: Optional[str] = "o1",
-    get_input_label_text_loopback_function: Optional[
-        Callable
-    ] = get_input_label_text_dash_loopback,
-    get_input_label_text_function: Optional[Callable] = get_input_label_text_dash,
+    zero_port: str | None = "o1",
+    get_input_label_text_loopback_function: None
+    | (Callable) = get_input_label_text_dash_loopback,
+    get_input_label_text_function: Callable | None = get_input_label_text_dash,
     select_ports: Callable = select_ports_optical,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     r"""Returns component with grating couplers and labels on each port.
 
     It returns grating couplers in north-south orientation.
@@ -138,15 +137,15 @@
 
     component_name = component_name or component.metadata_child.get(
         "name", component.name
     )
 
     gc = (
         grating_coupler[0]
-        if isinstance(grating_coupler, (list, tuple))
+        if isinstance(grating_coupler, list | tuple)
         else grating_coupler
     )
     gc = gf.get_component(gc)
 
     if gc_port_name not in gc.ports:
         raise ValueError(f"{gc_port_name!r} not in {list(gc.ports.keys())}")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/add_pads.py` & `gdsfactory-7.0.0/gdsfactory/routing/add_pads.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,46 +1,43 @@
 from __future__ import annotations
 
-from typing import Callable
+from collections.abc import Callable
 
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
+from gdsfactory.components.pad import pad_rectangular
+from gdsfactory.components.straight_heater_metal import straight_heater_metal
 from gdsfactory.port import select_ports_electrical
 from gdsfactory.routing.route_fiber_array import route_fiber_array
 from gdsfactory.routing.sort_ports import sort_ports_x
 from gdsfactory.typings import (
     ComponentSpec,
-    Optional,
-    Strs,
     CrossSectionSpec,
     LayerSpec,
-    Tuple,
-    Union,
+    Strs,
 )
 
-from gdsfactory.components.straight_heater_metal import straight_heater_metal
-from gdsfactory.components.pad import pad_rectangular
-
 
 @cell
 def add_pads_bot(
     component: ComponentSpec = straight_heater_metal,
     select_ports: Callable = select_ports_electrical,
-    port_names: Optional[Strs] = None,
-    component_name: Optional[str] = None,
+    port_names: Strs | None = None,
+    component_name: str | None = None,
     cross_section: CrossSectionSpec = "metal_routing",
-    get_input_labels_function: Optional[Callable] = None,
+    get_input_labels_function: Callable | None = None,
     layer_label: LayerSpec = "TEXT",
     pad_port_name: str = "e1",
-    pad_port_labels: Optional[Tuple[str, ...]] = None,
+    pad_port_labels: tuple[str, ...] | None = None,
     pad: ComponentSpec = pad_rectangular,
     bend: ComponentSpec = "wire_corner",
-    straight_separation: Optional[None] = None,
-    pad_spacing: Union[float, str] = "pad_spacing",
+    straight_separation: float | None = None,
+    pad_spacing: float | str = "pad_spacing",
+    optical_routing_type: int | None = 1,
     **kwargs,
 ) -> Component:
     """Returns new component with ports connected bottom pads.
 
     Args:
         component: component spec to connect to.
         select_ports: function to select_ports.
@@ -51,14 +48,15 @@
         layer_label: optional layer for grating coupler label.
         pad_port_name: pad input port name.
         pad_port_labels: pad list of labels.
         pad: spec for route terminations.
         bend: bend spec.
         straight_separation: from wire edge to edge. Defaults to xs.width+xs.gap
         pad_spacing: in um. Defaults to pad_spacing constant from the PDK.
+        optical_routing_type: None: auto, 0: no extension, 1: standard, 2: check.
 
     Keyword Args:
         straight: straight spec.
         taper: taper spec.
         get_input_label_text_loopback_function: function to get input label test.
         get_input_label_text_function: for labels.
         fanout_length: if None, automatic calculation of fanout length.
@@ -68,15 +66,14 @@
         connected_port_list_ids: names of ports only for type 0 optical routing.
         nb_optical_ports_lines: number of grating coupler lines.
         force_manhattan: False
         excluded_ports: list of port names to exclude when adding gratings.
         grating_indices: list of grating coupler indices.
         routing_straight: function to route.
         routing_method: get_route.
-        optical_routing_type: None: auto, 0: no extension, 1: standard, 2: check.
         gc_rotation: fiber coupler rotation in degrees. Defaults to -90.
         input_port_indexes: to connect.
 
     .. plot::
         :include-source:
 
         import gdsfactory as gf
@@ -132,14 +129,15 @@
         layer_label=layer_label,
         with_loopback=False,
         bend=bend,
         radius=xs.width,
         straight_separation=straight_separation,
         port_names=port_names,
         fiber_spacing=pad_spacing,
+        optical_routing_type=optical_routing_type,
         **kwargs,
     )
     if len(elements) == 0:
         return component
 
     for e in elements:
         component_new.add(e)
@@ -237,13 +235,23 @@
     c.add_ports(ref.ports)
     c.copy_child_info(_c)
     return c
 
 
 if __name__ == "__main__":
     # c = gf.components.pad()
-    c = gf.components.straight_heater_metal(length=100.0)
+    # c = gf.components.straight_heater_metal(length=100.0)
     # c = gf.components.straight(length=100.0)
 
     # cc = add_pads_top(component=c, port_names=("e1",))
-    cc = add_pads_top(component=c, port_names=("e1", "e2"), fanout_length=50)
+    # cc = add_pads_top(component=c, port_names=("e1", "e2"), fanout_length=50)
+    c = gf.c.nxn(
+        xsize=600,
+        ysize=200,
+        north=2,
+        south=3,
+        wg_width=10,
+        layer="M3",
+        port_type="electrical",
+    )
+    cc = add_pads_top(component=c)
     cc.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/all_angle.py` & `gdsfactory-7.0.0/gdsfactory/routing/all_angle.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,38 +1,38 @@
 import warnings
-from typing import List, Optional, Callable
+from collections.abc import Callable
 
 import numpy as np
 import shapely.geometry as sg
-from gdsfactory.component import Port, ComponentReference, Component
-from gdsfactory.path import Path
+
+from gdsfactory.component import Component, ComponentReference, Port
+from gdsfactory.components.straight import straight
 from gdsfactory.generic_tech.layer_map import LAYER
 from gdsfactory.get_netlist import difference_between_angles
-from gdsfactory.typings import CrossSectionSpec, Route, ComponentSpec, StepAllAngle
-from gdsfactory.typings import STEP_DIRECTIVES_ALL_ANGLE as STEP_DIRECTIVES
+from gdsfactory.path import Path, extrude
 from gdsfactory.routing.auto_taper import (
-    taper_to_cross_section,
     _get_taper_io_port_names,
+    taper_to_cross_section,
 )
-from gdsfactory.path import extrude
-
+from gdsfactory.typings import STEP_DIRECTIVES_ALL_ANGLE as STEP_DIRECTIVES
+from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Route, StepAllAngle
 
 BEND_PATH_FUNCS = {
     # 'euler_bend': euler_path,
 }
 
-Connector = Callable[..., List[ComponentReference]]
+Connector = Callable[..., list[ComponentReference]]
 
 
 def get_connector(name: str) -> Connector:
     """
     Gets a connector function by name.
 
     Args:
-        name: the name of the connector function to retrieve
+        name: the name of the connector function to retrieve.
 
     Returns:
         The specified connector function.
     """
     try:
         connector = CONNECTORS[name]
     except KeyError as e:
@@ -40,15 +40,15 @@
             f"{name} is not a valid connector type! Valid types are {list(CONNECTORS.keys())}"
         ) from e
     return connector
 
 
 def vector_intersection(
     p0, a0, p1, a1, max_distance=100000, raise_error=True
-) -> Optional[np.ndarray]:
+) -> np.ndarray | None:
     """
     Gets the intersection point between two vectors, specified by (point, angle) pairs, (p0, a0) and (p1, a1).
 
     Args:
         p0: x,y location of vector 0
         a0: angle of vector 0 [degrees]
         p1: x,y location of vector 1
@@ -112,17 +112,17 @@
     "strip",
 ]
 
 
 def low_loss_connector(
     port1: Port,
     port2: Port,
-    prioritized_cross_sections: Optional[List[CrossSectionSpec]] = None,
+    prioritized_cross_sections: list[CrossSectionSpec] | None = None,
     **kwargs,
-) -> List[ComponentReference]:
+) -> list[ComponentReference]:
     """
     Routes between two ports, using the lowest-loss cross-section which will fit.
 
     Args:
         port1: the starting port
         port2: the ending port
         prioritized_cross_sections: a list of cross-sections, sorted by preference (starting with most preferred). If None, uses the global variable LOW_LOSS_CROSS_SECTIONS
@@ -199,59 +199,61 @@
     error_component = extrude(path, layer=LAYER.ERROR_PATH, width=1)
     error_ref = ComponentReference(error_component)
     return [error_ref]
 
 
 def straight_connector(
     port1: Port, port2: Port, cross_section: CrossSectionSpec = "strip"
-) -> List[ComponentReference]:
+) -> list[ComponentReference]:
     """
     Connects between the two ports with a straight of the given cross-section.
 
     Args:
-        port1: the starting port
-        port2: the ending port
-        cross_section: the cross-section to use
+        port1: the starting port.
+        port2: the ending port.
+        cross_section: the cross-section to use.
+
     Returns:
-        A list of component references comprising the connection
+        A list of component references comprising the connection.
     """
     if np.array_equal(port1.center, port2.center):
         return []
     path = Path([port1.center, port2.center])
     # in usual cases, these angles should be the same, unless they are on opposite sides, in which they are 180 degrees separated
     if abs(difference_between_angles(path.start_angle, port1.orientation)) > 1:
         return _make_error_trace(
             port1,
             port2,
             message=f"Not enough room to route between ports: {port1} and {port2}",
         )
 
-    straight_component = extrude(path, cross_section=cross_section)
-    # straight_component = get_component(straight, length=distance, cross_section=cross_section)
+    length = np.linalg.norm(port1.center - port2.center)
+    straight_component = straight(length=length, cross_section=cross_section)
     straight_ref = ComponentReference(straight_component)
-    # straight_ref.connect('in0', port1)
+    straight_ref.connect(list(straight_component.ports.keys())[0], port1)
     return [straight_ref]
 
 
 def auto_taper_connector(
     port1: Port,
     port2: Port,
     cross_section: CrossSectionSpec = "strip",
     inner_connector: Connector = straight_connector,
-) -> List[ComponentReference]:
+) -> list[ComponentReference]:
     """
     Connects the two ports with a straight in the specified cross_section, adding tapers at either end if necessary.
 
     Args:
-        port1: the first port
-        port2: the final port
-        cross_section: the primary cross section to use for the route
-        inner_connector: the connector to use after attaching tapers
+        port1: the first port.
+        port2: the final port.
+        cross_section: the primary cross section to use for the route.
+        inner_connector: the connector to use after attaching tapers.
+
     Returns:
-        A list of references comprising the connection
+        A list of references comprising the connection.
     """
     taper1 = taper_to_cross_section(port1, cross_section)
     taper2 = taper_to_cross_section(port2, cross_section)
     route_refs = []
     if taper1:
         route_refs.append(taper1)
         output_port_name = _get_taper_io_port_names(taper1)[1]
@@ -316,20 +318,18 @@
     port1: Port,
     port2: Port,
     bend_angle: float,
     intersect: np.ndarray,
     bend: ComponentSpec = "euler_bend",
     cross_section: CrossSectionSpec = "strip",
     connector1: Connector = straight_connector,
-    cross_section1: Optional[CrossSectionSpec] = None,
+    cross_section1: CrossSectionSpec | None = None,
     connector2: Connector = straight_connector,
-    cross_section2: Optional[CrossSectionSpec] = None,
-    report_segment_separation: Optional[
-        Callable[[List[ComponentReference]], None]
-    ] = None,
+    cross_section2: CrossSectionSpec | None = None,
+    report_segment_separation: Callable[[list[ComponentReference]], None] | None = None,
 ):
     if cross_section1 is None:
         cross_section1 = cross_section
     if cross_section2 is None:
         cross_section2 = cross_section
     if report_segment_separation is None:
         report_segment_separation = _null_handler
@@ -410,14 +410,15 @@
         component, angle=round(angle, angle_precision), cross_section=cross_section
     )
 
 
 def _get_bend_angles(p0, p1, a0, a1, bend):
     """get the direct line between the two points."""
     import scipy.optimize
+
     from gdsfactory.pdk import get_component
 
     a_connect = np.arctan2(p1[1] - p0[1], p1[0] - p0[0])
     a_connect_deg = np.rad2deg(a_connect)
     # these are the angles which should be swept by the bends, if the bends were to take up no space
     bend_angle_ideal_0 = difference_between_angles(a_connect_deg, a0)
     bend_angle_ideal_1 = difference_between_angles(a_connect_deg + 180, a1)
@@ -451,15 +452,15 @@
     result = scipy.optimize.minimize_scalar(optimization_func, bounds=(-45, 45))
     d_angle = result.x
     bend_angle_0 = bend_angle_ideal_0 + d_angle
     bend_angle_1 = bend_angle_ideal_1 + d_angle
     return bend_angle_0, bend_angle_1
 
 
-def _get_minimum_separation(refs: List[ComponentReference], *ports) -> float:
+def _get_minimum_separation(refs: list[ComponentReference], *ports) -> float:
     all_ports = [p for ref in refs for p in ref.ports.values()]
     all_ports.extend(ports)
     max_specified_separation = 0
     for port in all_ports:
         if port.cross_section:
             xs = port.cross_section
             separation = xs.gap + xs.width
@@ -480,27 +481,27 @@
 
 
 def _angles_approx_opposing(angle1: float, angle2: float, tolerance: float = 1e-4):
     return abs(difference_between_angles(angle1 + 180, angle2)) < tolerance
 
 
 def get_bundle_all_angle(
-    ports1: List[Port],
-    ports2: List[Port],
-    steps: Optional[List[StepAllAngle]] = None,
+    ports1: list[Port],
+    ports2: list[Port],
+    steps: list[StepAllAngle] | None = None,
     cross_section: CrossSectionSpec = "strip",
     bend: ComponentSpec = "bend_euler",
     connector: str = "low_loss",
-    start_angle: Optional[float] = None,
-    end_angle: Optional[float] = None,
-    end_connector: Optional[str] = None,
-    end_cross_section: Optional[CrossSectionSpec] = None,
-    separation: Optional[float] = None,
+    start_angle: float | None = None,
+    end_angle: float | None = None,
+    end_connector: str | None = None,
+    end_cross_section: CrossSectionSpec | None = None,
+    separation: float | None = None,
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     """Connects a bundle of ports, allowing steps which create waypoints at \
             arbitrary, non-manhattan angles.
 
     Args:
         ports1: ports at the start of the bundle.
         ports2: ports at the end of the bundle.
         steps: a list of steps, which contain directives on how to proceed with the route.
@@ -911,15 +912,19 @@
                 cross_section2=final_cross_section,
                 report_segment_separation=report_segment_separation,
             )
             route_refs += final_connection
             this_separation = _get_minimum_separation(final_connection, port1)
             segment_separations.append(this_separation)
         route_length = sum(r.info["length"] for r in route_refs)
-        route = Route(references=route_refs, ports=(port1, port2), length=route_length)
+        route = Route(
+            references=route_refs,
+            ports=(port1, port2),
+            length=np.round(route_length, 3),
+        )
         routes.append(route)
         is_primary_route = False
     return routes
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/auto_taper.py` & `gdsfactory-7.0.0/gdsfactory/routing/auto_taper.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,17 +1,16 @@
 import warnings
-from typing import Optional, List
 
-from gdsfactory.component import Port, ComponentReference, Component
+from gdsfactory.component import Component, ComponentReference, Port
 from gdsfactory.typings import CrossSectionSpec
 
 
 def taper_to_cross_section(
     port: Port, cross_section: CrossSectionSpec
-) -> Optional[ComponentReference]:
+) -> ComponentReference | None:
     """Returns taper ComponentReference from a port to a given cross-section \
             placed so that it connects to the input port.
 
     Assumes that the taper component has `width1` and `width2` which map to the input and output port widths.
 
     Args:
         port: a port to connect to, usually from a ComponentReference
@@ -33,18 +32,18 @@
         taper = taper_to_cross_section(wg.ports['o1'], strip(width=2.0))
 
         # add the taper reference to the parent component
         c.add(taper)
         c.plot()
     """
     from gdsfactory.pdk import (
-        get_cross_section,
         get_active_pdk,
-        get_layer,
         get_component,
+        get_cross_section,
+        get_layer,
     )
 
     port_layer = get_layer(port.layer)
     port_width = port.width
     cross_section = get_cross_section(cross_section)
     cs_layer = get_layer(cross_section.layer)
     cs_width = cross_section.width
@@ -68,15 +67,15 @@
     else:
         return None
     taper = get_component(taper_name, width1=port_width, width2=cs_width)
     input_port_name = _get_taper_io_port_names(component=taper)[0]
     return ComponentReference(taper).connect(input_port_name, port)
 
 
-def _get_taper_io_port_names(component: Component) -> List[str]:
+def _get_taper_io_port_names(component: Component) -> list[str]:
     # this is kind of a hack, but o1 < o2, in0 < out0... hopefully nobody has any other wacky conventions!
     return sorted(component.ports.keys())
 
 
 def _auto_taper(
     routing_func,
     ports1,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/factories.py` & `gdsfactory-7.0.0/gdsfactory/routing/factories.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,23 +1,22 @@
 from __future__ import annotations
 
+from gdsfactory.routing.all_angle import get_bundle_all_angle
 from gdsfactory.routing.get_bundle import (
     get_bundle,
     get_bundle_electrical,
     get_bundle_same_axis_no_grouping,
 )
 from gdsfactory.routing.get_bundle_from_steps import (
     get_bundle_from_steps,
     get_bundle_from_steps_electrical,
 )
 from gdsfactory.routing.get_bundle_from_waypoints import get_bundle_from_waypoints
 from gdsfactory.routing.get_bundle_path_length_match import get_bundle_path_length_match
 
-from gdsfactory.routing.all_angle import get_bundle_all_angle
-
 routing_strategy = dict(
     get_bundle=get_bundle,
     get_bundle_electrical=get_bundle_electrical,
     get_bundle_path_length_match=get_bundle_path_length_match,
     get_bundle_same_axis_no_grouping=get_bundle_same_axis_no_grouping,
     get_bundle_from_waypoints=get_bundle_from_waypoints,
     get_bundle_from_steps=get_bundle_from_steps,
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/fanout.py` & `gdsfactory-7.0.0/gdsfactory/routing/fanout.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,26 +1,24 @@
 from __future__ import annotations
 
-from typing import List, Tuple
-
 import gdsfactory as gf
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
 from gdsfactory.port import port_array
 from gdsfactory.routing.get_route_sbend import get_route_sbend
 from gdsfactory.routing.sort_ports import sort_ports as sort_ports_function
 from gdsfactory.routing.utils import direction_ports_from_list_ports, flip
 from gdsfactory.typings import ComponentSpec
 
 
 @cell
 def fanout_component(
     component: ComponentSpec,
-    port_names: Tuple[str, ...],
-    pitch: Tuple[float, float] = (0.0, 20.0),
+    port_names: tuple[str, ...],
+    pitch: tuple[float, float] = (0.0, 20.0),
     dx: float = 20.0,
     sort_ports: bool = True,
     auto_rename_ports: bool = True,
     **kwargs,
 ) -> Component:
     """Returns component with Sbend fanout routes.
 
@@ -53,15 +51,15 @@
     for port_name in port_names:
         if port_name not in ref.ports:
             raise ValueError(f"{port_name} not in {list(ref.ports.keys())}")
 
     ports1 = [p for p in ref.ports.values() if p.name in port_names]
     port = ports1[0]
     port_extended_x = port.get_extended_center(dx)[0]
-    port_settings = port.settings.copy()
+    port_settings = port.to_dict().copy()
 
     port_settings.pop("name")
     port_settings.update(center=(port_extended_x, 0))
     port_settings.update(orientation=(port.orientation + 180) % 360)
 
     ports2 = port_array(n=len(ports1), pitch=pitch, **port_settings)
 
@@ -79,71 +77,67 @@
 
     if auto_rename_ports:
         c.auto_rename_ports()
     return c
 
 
 def fanout_ports(
-    ports: List[gf.Port],
-    pitch: Tuple[float, float] = (0.0, 20.0),
+    ports: list[gf.Port],
+    pitch: tuple[float, float] = (0.0, 20.0),
     dx: float = 20.0,
     **kwargs,
-) -> List[gf.typings.Route]:
+) -> list[gf.typings.Route]:
     """Returns fanout Sbend routes.
 
     Args:
         ports: list of ports.
         pitch: target port spacing for new component.
         dx: how far the fanout.
         kwargs: for route_basic.
 
     """
     routes = []
     ports1 = ports
     port = ports1[0]
     port_extended_x = port.get_extended_center(dx)[0]
-    port_settings = port.settings.copy()
+    port_settings = port.to_dict().copy()
 
     port_settings.pop("name")
     port_settings.update(center=(port_extended_x, 0))
     port_settings.update(orientation=(port.orientation + 180) % 360)
     ports2 = port_array(n=len(ports1), pitch=pitch, **port_settings)
 
     for p1, p2 in zip(ports1, ports2):
         route = gf.routing.get_route_sbend(p1, p2)
         routes.append(route)
     return routes
 
 
-def test_fanout_ports() -> Component:
+def test_fanout_ports() -> None:
     c = gf.components.mmi2x2()
     ports = c.get_ports_dict(orientation=0)
     port_names = list(ports.keys())
     c2 = fanout_component(component=c, port_names=port_names)
     d = direction_ports_from_list_ports(c2.get_ports_list())
     assert len(d["E"]) == 2, len(d["E"]) == 2
     assert len(d["W"]) == 2, len(d["W"]) == 2
-    return c2
 
 
 if __name__ == "__main__":
-    c = test_fanout_ports()
-    c.show(show_ports=True)
-
+    # test_fanout_ports()
     # c =gf.components.coupler(gap=1.0)
     # c = gf.components.nxn(west=4)
     # c = gf.components.nxn(west=4, layer=gf.LAYER.SLAB90)
     c = gf.components.mmi2x2()
 
-    # cc = fanout_component(
-    #     component=c, port_names=tuple(c.get_ports_dict(orientation=0).keys())
-    # )
-    # print(len(cc.ports))
-    # cc.show(show_ports=True)
+    cc = fanout_component(
+        component=c, port_names=tuple(c.get_ports_dict(orientation=0).keys())
+    )
+    print(len(cc.ports))
+    cc.show(show_ports=True)
 
     # c = gf.components.nxn(west=4, layer=gf.LAYER.SLAB90)
     # routes = fanout_ports(ports=c.get_ports_list(orientation=180))
-
     # for route in routes:
     #     c.add(route.references)
     # c.show(show_ports=True)
     # print(cc.ports.keys())
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/fanout2x2.py` & `gdsfactory-7.0.0/gdsfactory/routing/fanout2x2.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 from __future__ import annotations
 
-from typing import Callable, Optional
+from collections.abc import Callable
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_s import bend_s
 from gdsfactory.components.straight import straight
 from gdsfactory.port import select_ports_optical
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec
 
 
 @gf.cell
 def fanout2x2(
     component: ComponentSpec = straight,
     port_spacing: float = 20.0,
-    bend_length: Optional[float] = None,
+    bend_length: float | None = None,
     npoints: int = 101,
     select_ports: Callable = select_ports_optical,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Component:
     """Returns component with Sbend fanout routes.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_bundle.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_bundle.py`

 * *Files 9% similar despite different names*

```diff
@@ -7,22 +7,21 @@
  - get_bundle_corner: 90Deg / 270Deg between ports with arbitrary pitch
  - get_bundle_udirect: ports with direct U-turns
  - get_bundle_uindirect: ports with indirect U-turns
 
 """
 from __future__ import annotations
 
+from collections.abc import Callable
 from functools import partial
-from typing import Callable, List, Optional, Union
 
 import numpy as np
 from numpy import ndarray
 
 import gdsfactory as gf
-from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.via_corner import via_corner
 from gdsfactory.components.wire import wire_corner
 from gdsfactory.port import Port
 from gdsfactory.routing.get_bundle_corner import get_bundle_corner
 from gdsfactory.routing.get_bundle_from_steps import get_bundle_from_steps
@@ -39,25 +38,30 @@
     CrossSectionSpec,
     MultiCrossSectionAngleSpec,
     Route,
 )
 
 
 def get_bundle(
-    ports1: List[Port],
-    ports2: List[Port],
-    separation: Optional[float] = None,
+    ports1: list[Port],
+    ports2: list[Port],
+    separation: float | None = None,
     extension_length: float = 0.0,
     straight: ComponentSpec = straight_function,
     bend: ComponentSpec = bend_euler,
     with_sbend: bool = False,
     sort_ports: bool = True,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = "strip",
+    start_straight_length: float | None = None,
+    end_straight_length: float | None = None,
+    path_length_match_loops: int | None = None,
+    path_length_match_extra_length: float = 0.0,
+    path_length_match_modify_segment_i: int = -2,
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     """Returns list of routes to connect two groups of ports.
 
     Routes connect a bundle of ports with a river router.
     Chooses the correct routing function depending on port angles.
 
     Args:
         ports1: list of starting ports.
@@ -65,14 +69,22 @@
         separation: bundle separation (center to center).
             Defaults to cross_section.width + cross_section.gap
         extension_length: adds straight extension.
         bend: function for the bend. Defaults to euler.
         with_sbend: use s_bend routing when there is no space for manhattan routing.
         sort_ports: sort port coordinates.
         cross_section: CrossSection or function that returns a cross_section.
+        start_straight_length: straight length at the beginning of the route. If None, uses default value for the routing CrossSection.
+        end_straight_length: end length at the beginning of the route. If None, uses default value for the routing CrossSection.
+        path_length_match_loops: Integer number of loops to add to bundle
+            for path length matching. Path-length matching won't be attempted if this is set to None.
+        path_length_match_extra_length: Extra length to add
+            to path length matching loops (requires path_length_match_loops != None).
+        path_length_match_modify_segment_i: Index of straight segment to add path
+            length matching loops to (requires path_length_match_loops != None).
 
     Keyword Args:
         width: main layer waveguide width (um).
         layer: main layer for waveguide.
         width_wide: wide waveguides width (um) for low loss routing.
         auto_widen: taper to wide waveguides for low loss routing.
         auto_widen_minimum_length: minimum straight length for auto_widen.
@@ -82,25 +94,17 @@
         cladding_layers: list of layers to extrude.
         cladding_offsets: list of offset from main Section edge.
         radius: bend radius (um).
         sections: list of Sections(width, offset, layer, ports).
         port_names: for input and output ('o1', 'o2').
         port_types: for input and output: electrical, optical, vertical_te ...
         min_length: defaults to 1nm = 10e-3um for routing.
-        start_straight_length: straight length at the beginning of the route.
-        end_straight_length: end length at the beginning of the route.
         snap_to_grid: can snap points to grid when extruding the path.
         steps: specify waypoint steps to route using get_bundle_from_steps.
         waypoints: specify waypoints to route using get_bundle_from_steps.
-        path_length_match_loops: Integer number of loops to add to bundle
-            for path length matching (won't try to match if None).
-        path_length_match_extra_length: Extra length to add
-            to path length matching loops (requires path_length_match_loops != None).
-        path_length_match_modify_segment_i: Index of straight segment to add path
-            length matching loops to (requires path_length_match_loops != None).
 
     .. plot::
         :include-source:
 
         import gdsfactory as gf
 
         @gf.cell
@@ -131,15 +135,15 @@
         c = test_north_to_south()
         c.plot()
 
     """
     if separation is None:
         xs = (
             gf.get_cross_section(cross_section[0])
-            if isinstance(cross_section, (list, tuple))
+            if isinstance(cross_section, list | tuple)
             else gf.get_cross_section(cross_section)
         )
         separation = xs.width + xs.gap
 
     # convert single port to list
     if isinstance(ports1, Port):
         ports1 = [ports1]
@@ -170,22 +174,33 @@
     if sort_ports:
         ports1, ports2 = sort_ports_function(ports1, ports2)
 
     start_port_angles = {p.orientation for p in ports1}
     if len(start_port_angles) > 1:
         raise ValueError(f"All start port angles {start_port_angles} must be equal")
 
+    path_length_match_params = {
+        "path_length_match_loops": path_length_match_loops,
+        "path_length_match_extra_length": path_length_match_extra_length,
+        "path_length_match_modify_segment_i": path_length_match_modify_segment_i,
+    }
     params = {
         "ports1": ports1,
         "ports2": ports2,
         "separation": separation,
         "bend": bend,
         "straight": straight,
         "cross_section": cross_section,
     }
+    if path_length_match_loops is not None:
+        params.update(path_length_match_params)
+    if end_straight_length is not None:
+        params["end_straight_length"] = end_straight_length
+    if start_straight_length is not None:
+        params["start_straight_length"] = start_straight_length
     params.update(**kwargs)
 
     start_angle = ports1[0].orientation
     end_angle = ports2[0].orientation
 
     start_axis = "X" if start_angle in [0, 180] else "Y"
     end_axis = "X" if end_angle in [0, 180] else "Y"
@@ -225,50 +240,55 @@
 
     elif start_angle == end_angle:
         # print('get_bundle_udirect')
         return get_bundle_udirect(**params)
 
     elif end_angle == (start_angle + 180) % 360:
         # print("get_bundle_uindirect")
-        return get_bundle_uindirect(extension_length=extension_length, **params)
+        params_without_pathlength = {
+            k: v for k, v in params.items() if k not in path_length_match_params
+        }
+        return get_bundle_uindirect(
+            extension_length=extension_length, **params_without_pathlength
+        )
     else:
         raise NotImplementedError("This should never happen")
 
 
-def get_port_width(port: Port) -> Union[float, int]:
+def get_port_width(port: Port) -> float | int:
     return port.width
 
 
 def are_decoupled(
     x1: float,
     x1p: float,
     x2: float,
     x2p: float,
-    sep: Union[str, float] = "metal_spacing",
+    sep: str | float = "metal_spacing",
 ) -> bool:
     sep = gf.get_constant(sep)
     if x2p + sep > x1:
         return False
     return False if x2 < x1p + sep else x2 >= x1p - sep
 
 
 def get_bundle_same_axis(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     separation: float = 5.0,
     end_straight_length: float = 0.0,
     start_straight_length: float = 0.0,
     bend: ComponentSpec = bend_euler,
     sort_ports: bool = True,
-    path_length_match_loops: Optional[int] = None,
+    path_length_match_loops: int | None = None,
     path_length_match_extra_length: float = 0.0,
     path_length_match_modify_segment_i: int = -2,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = "strip",
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     r"""Semi auto-routing for two lists of ports.
 
     Args:
         ports1: first list of ports.
         ports2: second list of ports.
         separation: minimum separation between two straights.
         end_straight_length: offset to add at the end of each straight.
@@ -359,23 +379,23 @@
             **kwargs,
         )
         for route in routes
     ]
 
 
 def _get_bundle_waypoints(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     separation: float = 30,
     end_straight_length: float = 0.0,
     tol: float = 0.00001,
     start_straight_length: float = 0.0,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
-) -> List[ndarray]:
+) -> list[ndarray]:
     """Returns route coordinates List.
 
     Args:
         ports1: list of starting ports.
         ports2: list of end ports.
         separation: route spacing.
         end_straight_length: adds a straight.
@@ -482,15 +502,15 @@
             cross_section=cross_section,
             **kwargs,
         )
         for i in range(N)
     ]
 
 
-def compute_ports_max_displacement(ports1: List[Port], ports2: List[Port]) -> float:
+def compute_ports_max_displacement(ports1: list[Port], ports2: list[Port]) -> float:
     if ports1[0].orientation in [0, 180]:
         a1 = [p.y for p in ports1]
         a2 = [p.y for p in ports2]
     else:
         a1 = [p.x for p in ports1]
         a2 = [p.x for p in ports2]
 
@@ -498,16 +518,16 @@
 
 
 def sign(x: float) -> int:
     return 1 if x > 0 else -1
 
 
 def get_min_spacing(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     sep: float = 5.0,
     radius: float = 5.0,
     sort_ports: bool = True,
 ) -> float:
     """Returns the minimum amount of spacing in um required to create a \
     fanout."""
     axis = "X" if ports1[0].orientation in [0, 180] else "Y"
@@ -539,24 +559,24 @@
             max_j = j
     j = 0
 
     return (max_j - min_j) * sep + 2 * radius + 1.0
 
 
 def get_bundle_same_axis_no_grouping(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     sep: float = 5.0,
     route_filter: Callable = get_route,
-    start_straight_length: Optional[float] = None,
-    end_straight_length: Optional[float] = None,
+    start_straight_length: float | None = None,
+    end_straight_length: float | None = None,
     sort_ports: bool = True,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     r"""Returns a list of route elements.
 
     Compared to get_bundle_same_axis, this function does not do any grouping.
     It is not as smart for the routing, but it can fall back on arclinarc
     connection if needed. We can also specify longer start_straight and end_straight
 
     Semi auto routing for optical ports
@@ -675,52 +695,42 @@
     return elems
 
 
 get_bundle_electrical = partial(
     get_bundle, bend=wire_corner, cross_section="metal_routing"
 )
 
-get_bundle_electrical_multilayer = gf.partial(
+get_bundle_electrical_multilayer = partial(
     get_bundle,
     bend=via_corner,
     cross_section=[
         (gf.cross_section.metal2, (90, 270)),
         ("metal_routing", (0, 180)),
     ],
 )
 
 
-@gf.cell
-def test_get_bundle_small() -> Component:
+def test_get_bundle_small() -> None:
     c = gf.Component()
     c1 = c << gf.components.mmi2x2()
     c2 = c << gf.components.mmi2x2()
     c2.move((100, 40))
     routes = get_bundle(
         [c1.ports["o3"], c1.ports["o4"]],
         [c2.ports["o1"], c2.ports["o2"]],
         separation=5.0,
         cross_section=gf.cross_section.strip(radius=5, layer=(2, 0))
         # cross_section=gf.cross_section.strip,
     )
     for route in routes:
         c.add(route.references)
         assert np.isclose(route.length, 111.136), route.length
-    return c
 
 
 if __name__ == "__main__":
-    # c = test_connect_corner(None, check=False)
-    # c = test_get_bundle_small()
-    # c = test_get_bundle_small()
-    # c = test_facing_ports()
-    # c = test_get_bundle_u_indirect()
-    # c = test_get_bundle_udirect()
-    # c = test_connect_corner()
-
     import gdsfactory as gf
 
     # c = gf.Component("get_bundle_none_orientation")
     # pt = c << gf.components.pad_array(orientation=None, columns=3)
     # pb = c << gf.components.pad_array(orientation=None, columns=3)
     # pt.move((100, 200))
     # routes = gf.routing.get_bundle_electrical_multilayer(
@@ -738,12 +748,12 @@
     c2 = c << gf.components.mmi2x2()
     c2.move((100, 40))
     routes = get_bundle(
         [c1.ports["o2"], c1.ports["o1"]],
         [c2.ports["o1"], c2.ports["o2"]],
         radius=5,
         # layer=(2, 0),
-        straight=gf.partial(gf.components.straight, layer=(1, 0), width=1),
+        straight=partial(gf.components.straight, layer=(1, 0), width=1),
     )
     for route in routes:
         c.add(route.references)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_bundle_corner.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_bundle_corner.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Optional, Callable, List
+from collections.abc import Callable
 
 import numpy as np
 
 from gdsfactory.component_layout import _rotate_points
 from gdsfactory.port import Port
 from gdsfactory.routing.get_route import get_route_from_waypoints
 from gdsfactory.routing.manhattan import generate_manhattan_waypoints
@@ -53,23 +53,23 @@
         new_port.new_orientation = new_orientation
         ports_transformed.append(new_port)
 
     return ports_transformed
 
 
 def get_bundle_corner(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     route_filter: Callable[..., Route] = get_route_from_waypoints,
     separation: float = 5.0,
-    path_length_match_loops: Optional[int] = None,
+    path_length_match_loops: int | None = None,
     path_length_match_extra_length: float = 0.0,
     path_length_match_modify_segment_i: int = -2,
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     r"""Connect banks of ports with either 90Deg or 270Deg angle between them.
 
     Args:
         ports1: list of start ports.
         ports2: list of end ports.
         route_filter: filter to apply to the manhattan waypoints
             e.g `get_route_from_waypoints` for deep etch strip straight.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_bundle_from_steps.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_bundle_from_steps.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,48 +1,48 @@
 from __future__ import annotations
 
-from typing import List, Optional, Union
+from functools import partial
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.components.via_corner import via_corner
 from gdsfactory.components.wire import wire_corner
 from gdsfactory.port import Port
 from gdsfactory.routing.get_bundle_from_waypoints import get_bundle_from_waypoints
 from gdsfactory.routing.manhattan import _is_horizontal, _is_vertical
 from gdsfactory.routing.sort_ports import sort_ports as sort_ports_function
 from gdsfactory.typings import (
+    STEP_DIRECTIVES,
     ComponentSpec,
     CrossSectionSpec,
     MultiCrossSectionAngleSpec,
     Route,
-    STEP_DIRECTIVES,
     Step,
 )
 
 
 def get_bundle_from_steps(
-    ports1: List[Port],
-    ports2: List[Port],
-    steps: Optional[List[Step]] = None,
+    ports1: list[Port],
+    ports2: list[Port],
+    steps: list[Step] | None = None,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
-    taper: Optional[ComponentSpec] = taper_function,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
+    taper: ComponentSpec | None = taper_function,
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = "strip",
     sort_ports: bool = True,
-    separation: Optional[float] = None,
-    path_length_match_loops: Optional[int] = None,
+    separation: float | None = None,
+    path_length_match_loops: int | None = None,
     path_length_match_extra_length: float = 0.0,
     path_length_match_modify_segment_i: int = -2,
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     """Returns a list of routes formed by the given waypoints steps.
 
     Can add bends instead of corners and optionally tapers in straight sections.
     Tapering to wider straights reduces the optical loss and phase errors.
     `get_bundle_from_steps` is a manual version of `get_bundle`
     and a more convenient version of `get_bundle_from_waypoints`.
 
@@ -57,19 +57,20 @@
         sort_ports: if True sort ports.
         separation: center to center, defaults to ports1 separation.
         kwargs: cross_section settings.
 
     .. plot::
         :include-source:
 
+        from functools import partial
         import gdsfactory as gf
 
         c = gf.Component("get_route_from_steps_sample")
         w = gf.components.array(
-            gf.partial(gf.components.straight, layer=(2, 0)),
+            partial(gf.components.straight, layer=(2, 0)),
             rows=3,
             columns=1,
             spacing=(0, 50),
         )
 
         left = c << w
         right = c << w
@@ -168,33 +169,33 @@
         path_length_match_extra_length=path_length_match_extra_length,
         path_length_match_modify_segment_i=path_length_match_modify_segment_i,
         path_length_match_loops=path_length_match_loops,
         **kwargs,
     )
 
 
-get_bundle_from_steps_electrical = gf.partial(
+get_bundle_from_steps_electrical = partial(
     get_bundle_from_steps, bend=wire_corner, cross_section="metal_routing"
 )
 
-get_bundle_from_steps_electrical_multilayer = gf.partial(
+get_bundle_from_steps_electrical_multilayer = partial(
     get_bundle_from_steps,
     bend=via_corner,
     cross_section=[
         (gf.cross_section.metal2, (90, 270)),
         ("metal_routing", (0, 180)),
     ],
 )
 
 
 def _demo() -> None:
     c = gf.Component("get_route_from_steps_sample")
 
     w = gf.components.array(
-        gf.partial(gf.components.straight, layer=(2, 0)),
+        partial(gf.components.straight, layer=(2, 0)),
         rows=3,
         columns=1,
         spacing=(0, 50),
     )
 
     left = c << w
     right = c << w
@@ -215,15 +216,15 @@
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
     c = gf.Component("pads_bundle_steps")
     pt = c << gf.components.pad_array(
-        gf.partial(gf.components.pad, size=(30, 30)),
+        partial(gf.components.pad, size=(30, 30)),
         orientation=270,
         columns=3,
         spacing=(50, 0),
     )
     pb = c << gf.components.pad_array(orientation=90, columns=3)
     pt.move((300, 500))
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_bundle_from_waypoints.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_bundle_from_waypoints.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Tuple, Union
+from collections.abc import Callable
+from functools import partial
 
 import numpy as np
 from numpy import float64, ndarray
 
 import gdsfactory as gf
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as straight_function
@@ -48,16 +49,16 @@
         return np.sign(p1[1] - p0[1])
 
     if _is_horizontal(s):
         return np.sign(p1[0] - p0[0])
 
 
 def get_ports_x_or_y_distances(
-    list_ports: List[Port], ref_point: Coordinate
-) -> List[Number]:
+    list_ports: list[Port], ref_point: Coordinate
+) -> list[Number]:
     if not list_ports:
         return []
 
     angle = get_list_ports_angle(list_ports)
     x0 = ref_point[0]
     y0 = ref_point[1]
     return (
@@ -73,29 +74,29 @@
     dx = x1 - x2
     dy = y1 - y2
 
     return np.sqrt(dx**2 + dy**2)
 
 
 def get_bundle_from_waypoints(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     waypoints: Coordinates,
     straight: ComponentSpec = straight_function,
     taper: ComponentSpec = taper_function,
     bend: ComponentSpec = bend_euler,
     sort_ports: bool = True,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = strip,
-    separation: Optional[float] = None,
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = strip,
+    separation: float | None = None,
     on_route_error: Callable = get_route_error,
-    path_length_match_loops: Optional[int] = None,
+    path_length_match_loops: int | None = None,
     path_length_match_extra_length: float = 0.0,
     path_length_match_modify_segment_i: int = -2,
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     """Returns list of routes that connect bundle of ports with bundle of routes.
 
     Routes follow a list of waypoints.
     Take a look at get_bundle_from_steps for easier definition.
 
     Args:
         ports1: list of ports.
@@ -235,19 +236,19 @@
             cross_section=cross_section,
             **kwargs,
         )
         for pts in routes
     ]
 
 
-get_bundle_from_waypoints_electrical = gf.partial(
+get_bundle_from_waypoints_electrical = partial(
     get_bundle_from_waypoints, bend=wire_corner, cross_section="metal_routing"
 )
 
-get_bundle_from_waypoints_electrical_multilayer = gf.partial(
+get_bundle_from_waypoints_electrical_multilayer = partial(
     get_bundle_from_waypoints_electrical,
     bend=via_corner,
     cross_section=[
         (gf.cross_section.metal2, (90, 270)),
         ("metal_routing", (0, 180)),
     ],
 )
@@ -255,25 +256,25 @@
 
 def snap_route_to_end_point_x(route, x):
     y1, y2 = (p[1] for p in route[-2:])
     return route[:-2] + [(x, y1), (x, y2)]
 
 
 def snap_route_to_end_point_y(
-    route: List[Union[ndarray, Tuple[float64, float64]]], y: float64
-) -> List[Union[ndarray, Tuple[float64, float64]]]:
+    route: list[ndarray | tuple[float64, float64]], y: float64
+) -> list[ndarray | tuple[float64, float64]]:
     x1, x2 = (p[0] for p in route[-2:])
     return route[:-2] + [(x1, y), (x2, y)]
 
 
 def _generate_manhattan_bundle_waypoints(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     waypoints: Coordinates,
-    separation: Optional[float] = None,
+    separation: float | None = None,
     **kwargs,
 ) -> Coordinates:
     """Returns waypoints for bundle.
 
     Args:
         ports1: list of ports must face the same direction.
         ports2: list of ports must face the same direction.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_bundle_path_length_match.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_bundle_path_length_match.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 """Routes bundles of ports (river routing)."""
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Union
+from collections.abc import Callable
 
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as _straight
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.cross_section import strip
 from gdsfactory.port import Port
 from gdsfactory.routing.get_bundle import (
@@ -20,30 +20,30 @@
     CrossSectionSpec,
     MultiCrossSectionAngleSpec,
     Route,
 )
 
 
 def get_bundle_path_length_match(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     separation: float = 30.0,
-    end_straight_length: Optional[float] = None,
+    end_straight_length: float | None = None,
     extra_length: float = 0.0,
     nb_loops: int = 1,
     modify_segment_i: int = -2,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = _straight,
-    taper: Optional[ComponentSpec] = taper_function,
+    taper: ComponentSpec | None = taper_function,
     start_straight_length: float = 0.0,
     route_filter: Callable = get_route_from_waypoints,
     sort_ports: bool = True,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = strip,
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = strip,
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     """Returns list of routes that are path length matched.
 
     Args:
         ports1: list of ports.
         ports2: list of ports.
         separation: between the loops.
         end_straight_length: if None tries to determine it.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_bundle_sbend.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_bundle_sbend.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,20 +1,18 @@
 from __future__ import annotations
 
-from typing import List
-
 from gdsfactory.components.bend_s import bend_s
 from gdsfactory.port import Port
 from gdsfactory.routing.sort_ports import sort_ports as sort_ports_function
 from gdsfactory.typings import Route
 
 
 def get_bundle_sbend(
     ports1: Port, ports2: Port, sort_ports: bool = True, **kwargs
-) -> List[Route]:
+) -> list[Route]:
     """Returns a list of routes from ports1 to ports2.
 
     Args:
         ports1: start ports.
         ports2: end ports.
         sort_ports: sort ports.
         kwargs: cross_section settings.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_bundle_u.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_bundle_u.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 from __future__ import annotations
 
-from typing import Any, Callable, List, Optional, Tuple, Union
+from collections.abc import Callable
+from typing import Any
 
 import numpy as np
 from numpy import float64, ndarray
 
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.geometry.functions import remove_identicals
@@ -16,38 +17,38 @@
 )
 from gdsfactory.routing.path_length_matching import path_length_matched_points
 from gdsfactory.routing.route_ports_to_side import route_ports_to_side
 from gdsfactory.typings import ComponentSpec, Route
 
 
 def _groups(
-    ports: List[Port], cut: float64, axis: str = "X"
-) -> Union[Tuple[List[Port], List[Any]], Tuple[List[Port], List[Port]]]:
+    ports: list[Port], cut: float64, axis: str = "X"
+) -> tuple[list[Port], list[Any]] | tuple[list[Port], list[Port]]:
     if axis == "Y":
         group1 = [p for p in ports if p.x <= cut]
         group2 = [p for p in ports if p.x > cut]
     else:
         group1 = [p for p in ports if p.y <= cut]
         group2 = [p for p in ports if p.y > cut]
     return group1, group2
 
 
 def get_bundle_udirect(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     route_filter: Callable = get_route_from_waypoints,
     separation: float = 5.0,
     start_straight_length: float = 0.01,
     end_straight_length: float = 0.01,
     bend: ComponentSpec = bend_euler,
-    path_length_match_loops: Optional[int] = None,
+    path_length_match_loops: int | None = None,
     path_length_match_extra_length: float = 0.0,
     path_length_match_modify_segment_i: int = -2,
     **kwargs,
-) -> List[Route]:
+) -> list[Route]:
     r"""Returns list of routes.
 
     Args:
         ports1: list of start ports.
         ports2: list of end ports.
         route_filter: filter to apply to the manhattan waypoints
             e.g `get_route_from_waypoints` for deep etch strip straight.
@@ -123,25 +124,25 @@
 
     return [
         route_filter(route, bend=bend, straight=straight, **kwargs) for route in routes
     ]
 
 
 def _get_bundle_udirect_waypoints(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     routing_func: Callable = generate_manhattan_waypoints,
     separation: float = 5.0,
     start_straight_length: float = 0.01,
     end_straight_length: float = 0.01,
     end_straight_offset: float = 0.0,
     start_straight_offset: float = 0.0,
     bend: ComponentSpec = bend_euler,
     **routing_func_params,
-) -> List[ndarray]:
+) -> list[ndarray]:
     nb_ports = len(ports1)
     for p in ports1:
         p.orientation = (
             p.orientation % 360 if p.orientation is not None else p.orientation
         )
 
     for p in ports2:
@@ -251,23 +252,23 @@
         straight_len_end += separation
         straight_len_start += separation
 
     return connections
 
 
 def get_bundle_uindirect(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     route_filter: Callable = get_route_from_waypoints,
     separation: float = 5.0,
     extension_length: float = 0.0,
     start_straight_length: float = 0.01,
     end_straight_length: float = 0.01,
     **routing_params,
-) -> List[Route]:
+) -> list[Route]:
     r"""Returns list of routes.
 
     Args:
         ports1: list of start ports.
         ports2: list of end ports.
         route_filter: filter to apply to the manhattan waypoints
             e.g `get_route_from_waypoints` for deep etch strip straight
@@ -333,23 +334,23 @@
         **routing_params,
     )
 
     return [route_filter(route, **routing_params) for route in routes]
 
 
 def _get_bundle_uindirect_waypoints(
-    ports1: List[Port],
-    ports2: List[Port],
+    ports1: list[Port],
+    ports2: list[Port],
     routing_func: Callable = generate_manhattan_waypoints,
     separation: float = 5.0,
     extension_length: float = 0.0,
     start_straight_length: float = 0.01,
     end_straight_length: float = 0.01,
     **routing_func_params,
-) -> List[ndarray]:
+) -> list[ndarray]:
     nb_ports = len(ports1)
 
     for p in ports1:
         p.orientation = (
             p.orientation % 360 if p.orientation is not None else p.orientation
         )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_input_labels.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_input_labels.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,30 +1,29 @@
 from __future__ import annotations
 
-from typing import List
-
 from functools import partial
+
 from gdsfactory.add_labels import (
     get_input_label,
     get_input_label_text,
     get_input_label_text_dash,
 )
 from gdsfactory.component import ComponentReference
 from gdsfactory.port import Port
 from gdsfactory.typings import Label, LayerSpec
 
 
 def get_input_labels(
-    io_gratings: List[ComponentReference],
-    ordered_ports: List[Port],
+    io_gratings: list[ComponentReference],
+    ordered_ports: list[Port],
     component_name: str,
     layer_label: LayerSpec,
     gc_port_name: str,
     get_input_label_text_function=get_input_label_text,
-) -> List[Label]:
+) -> list[Label]:
     """Returns list of labels for a list of grating coupler references.
 
     Args:
         io_gratings: grating coupler references.
         ordered_ports: list of ordered_ports.
         component_name: component name.
         layer_label: layer spec for the label.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_route.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_route.py`

 * *Files 6% similar despite different names*

```diff
@@ -30,19 +30,19 @@
 - references: list of references for tapers, bends and straight waveguides
 - ports: a dict of port name to Port, usually two ports "input" and "output"
 - length: a float with the length of the route
 
 """
 from __future__ import annotations
 
+from collections.abc import Callable
 from functools import partial
-from typing import Callable, Optional, Union
-from pydantic import validate_arguments
 
 import numpy as np
+from pydantic import validate_arguments
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.components.via_corner import via_corner
@@ -62,19 +62,19 @@
 @validate_arguments
 def get_route(
     input_port: Port,
     output_port: Port,
     bend: ComponentSpec = bend_euler,
     with_sbend: bool = False,
     straight: ComponentSpec = straight_function,
-    taper: Optional[ComponentSpec] = None,
-    start_straight_length: Optional[float] = None,
-    end_straight_length: Optional[float] = None,
-    min_straight_length: Optional[float] = None,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
+    taper: ComponentSpec | None = None,
+    start_straight_length: float | None = None,
+    end_straight_length: float | None = None,
+    min_straight_length: float | None = None,
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = "strip",
     **kwargs,
 ) -> Route:
     """Returns a Manhattan Route between 2 ports.
 
     The references are straights, bends and tapers.
     `get_route` is an automatic version of `get_route_from_steps`.
 
@@ -108,15 +108,15 @@
     """
     bend90 = (
         bend
         if isinstance(bend, Component)
         else gf.get_component(bend, cross_section=cross_section, **kwargs)
     )
     if taper:
-        if isinstance(cross_section, (tuple, list)):
+        if isinstance(cross_section, tuple | list):
             raise ValueError(
                 "Tapers not implemented for routes made from multiple cross_sections."
             )
         x = gf.get_cross_section(cross_section, **kwargs)
         taper_length = x.taper_length
         width1 = input_port.width
         auto_widen = x.auto_widen
@@ -167,32 +167,32 @@
 )
 
 
 def get_route_from_waypoints(
     waypoints: Coordinates,
     bend: Callable = bend_euler,
     straight: Callable = straight_function,
-    taper: Optional[Callable] = taper_function,
+    taper: Callable | None = taper_function,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Route:
     """Returns a route formed by the given waypoints with bends instead of \
     corners and optionally tapers in straight sections. Tapering to wider \
     straights reduces the optical loss. `get_route_from_waypoints` is a manual \
     version of `get_route` `get_route_from_steps` is a  more concise and \
     convenient version of `get_route_from_waypoints` also available in \
     gf.routing.
 
     Args:
-        waypoints: Coordinates that define the route
-        bend: function that returns bends
-        straight: function that returns straight waveguides
-        taper: function that returns tapers
-        cross_section:
-        kwargs: cross_section settings
+        waypoints: Coordinates that define the route.
+        bend: function that returns bends.
+        straight: function that returns straight waveguides.
+        taper: function that returns tapers.
+        cross_section: spec.
+        kwargs: cross_section settings.
 
     .. plot::
         :include-source:
 
         import gdsfactory as gf
 
         c = gf.Component("waypoints_sample")
@@ -260,23 +260,23 @@
         straight=straight,
         taper=taper,
         cross_section=cross_section,
         **kwargs,
     )
 
 
-get_route_from_waypoints_electrical = gf.partial(
+get_route_from_waypoints_electrical = partial(
     get_route_from_waypoints, bend=wire_corner, cross_section="metal_routing"
 )
 
-get_route_from_waypoints_electrical_m2 = gf.partial(
+get_route_from_waypoints_electrical_m2 = partial(
     get_route_from_waypoints, bend=wire_corner, cross_section=metal2
 )
 
-get_route_from_waypoints_electrical_multilayer = gf.partial(
+get_route_from_waypoints_electrical_multilayer = partial(
     get_route_from_waypoints,
     bend=via_corner,
     cross_section=[(metal2, (0, 180)), (metal3, (90, 270))],
 )
 
 
 if __name__ == "__main__":
@@ -297,16 +297,14 @@
     #     ptop.ports["e11"],
     #     pbot.ports["e11"],
     #     end_straight_length=100,
     # )
     # c.add(route.references)
     # c.show()
 
-    import gdsfactory as gf
-
     c = gf.Component("sample_connect")
     mmi1 = c << gf.components.mmi1x2()
     mmi2 = c << gf.components.mmi1x2()
     mmi2.move((200, 50))
 
     route = gf.routing.get_route(
         mmi1.ports["o3"],
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_route_astar.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_route_astar.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,9 @@
 from __future__ import annotations
 
-from typing import Optional, List
 from warnings import warn
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory import Port
 from gdsfactory.component import Component
@@ -26,15 +25,15 @@
 
 
 def get_route_astar(
     component: Component,
     port1: Port,
     port2: Port,
     resolution: float = 1,
-    avoid_layers: Optional[List[LayerSpec]] = None,
+    avoid_layers: list[LayerSpec] | None = None,
     distance: float = 1,
     cross_section: CrossSectionSpec = "strip",
     **kwargs,
 ) -> Route:
     """A* routing function. Finds a route between two ports avoiding obstacles.
 
     Args:
@@ -174,23 +173,23 @@
             # Add the neighbour to open_list
             open_list.append(neighbour)
 
     warn("A* algorithm failed, resorting to Manhattan routing. Watch for overlaps.")
     return route_manhattan(port1, port2, cross_section=cross_section)
 
 
-def _extract_all_bbox(c: Component, avoid_layers: Optional[List[LayerSpec]] = None):
+def _extract_all_bbox(c: Component, avoid_layers: list[LayerSpec] | None = None):
     """Extract all polygons whose layer is in `avoid_layers`."""
     return [c.get_polygons(layer) for layer in avoid_layers]
 
 
 def _generate_grid(
     c: Component,
     resolution: float = 0.5,
-    avoid_layers: Optional[List[LayerSpec]] = None,
+    avoid_layers: list[LayerSpec] | None = None,
     distance: float = 1,
 ) -> np.ndarray:
     """Generate discretization grid that the algorithm will step through."""
     bbox = c.bbox
     x, y = np.meshgrid(
         np.linspace(
             bbox[0][0],
@@ -235,15 +234,15 @@
 
 def _generate_neighbours(
     current_node: Node,
     grid,
     x: np.ndarray,
     y: np.ndarray,
     resolution: float,
-) -> List[Node]:
+) -> list[Node]:
     """Generate neighbours of a node."""
     neighbours = []
 
     for new_position in [
         (0, -resolution),
         (0, resolution),
         (-resolution, 0),
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_route_from_steps.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_route_from_steps.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,34 +1,34 @@
 from __future__ import annotations
 
-from typing import List, Optional, Union
+from functools import partial
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.components.via_corner import via_corner
 from gdsfactory.port import Port
 from gdsfactory.routing.manhattan import round_corners
 from gdsfactory.typings import (
+    STEP_DIRECTIVES,
     ComponentSpec,
     CrossSectionSpec,
     MultiCrossSectionAngleSpec,
     Route,
-    STEP_DIRECTIVES,
     Step,
 )
 
 
 def get_route_from_steps(
     port1: Port,
     port2: Port,
-    steps: Optional[List[Step]] = None,
+    steps: list[Step] | None = None,
     bend: ComponentSpec = "bend_euler",
-    taper: Optional[ComponentSpec] = "taper",
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
+    taper: ComponentSpec | None = "taper",
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = "strip",
     **kwargs,
 ) -> Route:
     """Returns a route formed by the given waypoints steps.
 
     Uses smooth euler bends instead of corners and optionally tapers in straight sections.
     Tapering to wider straights reduces the optical loss when auto_widen=True.
     `get_route_from_steps` is a manual version of `get_route`
@@ -124,19 +124,19 @@
         taper=taper,
         cross_section=cross_section,
         with_sbend=False,
         **kwargs,
     )
 
 
-get_route_from_steps_electrical = gf.partial(
+get_route_from_steps_electrical = partial(
     get_route_from_steps, bend="wire_corner", taper=None, cross_section="metal3"
 )
 
-get_route_from_steps_electrical_multilayer = gf.partial(
+get_route_from_steps_electrical_multilayer = partial(
     get_route_from_steps,
     bend=via_corner,
     taper=None,
     cross_section=[
         (gf.cross_section.metal2, (90, 270)),
         ("metal_routing", (0, 180)),
     ],
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_route_sbend.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_route_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_routes_bend180.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_routes_bend180.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,25 +1,23 @@
 from __future__ import annotations
 
-from typing import Dict, List, Optional, Union
-
 import gdsfactory as gf
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.cross_section import strip
 from gdsfactory.difftest import difftest
 from gdsfactory.port import Port
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Routes
 
 
 def get_routes_bend180(
-    ports: Union[List[Port], Dict[str, Port]],
+    ports: list[Port] | dict[str, Port],
     bend: ComponentSpec = bend_euler,
     cross_section: CrossSectionSpec = strip,
-    bend_port1: Optional[str] = None,
-    bend_port2: Optional[str] = None,
+    bend_port1: str | None = None,
+    bend_port2: str | None = None,
     **kwargs,
 ) -> Routes:
     """Returns routes made by 180 degree bends.
 
     Args:
         ports: List or dict of ports.
         bend: function for bend.
@@ -65,15 +63,15 @@
     references = [bend.ref() for _ in ports]
     references = [ref.connect(bend_port1, port) for port, ref in zip(ports, references)]
     ports = [ref.ports[bend_port2] for ref in references]
     lengths = [bend.info["length"]] * len(ports)
     return Routes(references=references, ports=ports, lengths=lengths)
 
 
-def test_get_routes_bend180():
+def test_get_routes_bend180() -> None:
     c = gf.Component("get_routes_bend180")
     pad_array = gf.components.pad_array(orientation=270)
     c1 = c << pad_array
     c2 = c << pad_array
     c2.rotate(90)
     c2.movex(1000)
     c2.ymax = -200
@@ -87,15 +85,14 @@
     routes = gf.routing.get_bundle(
         ports1=c1.get_ports_list(),
         ports2=routes_bend180.ports,
     )
     for route in routes:
         c.add(route.references)
     difftest(c)
-    return c
 
 
 if __name__ == "__main__":
     c = gf.Component("get_routes_bend180")
     pad_array = gf.components.pad_array(orientation=270)
     c1 = c << pad_array
     c2 = c << pad_array
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/get_routes_straight.py` & `gdsfactory-7.0.0/gdsfactory/routing/get_routes_straight.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,20 +1,18 @@
 from __future__ import annotations
 
-from typing import Dict, List, Union
-
 import gdsfactory as gf
 from gdsfactory.components.straight import straight
 from gdsfactory.difftest import difftest
 from gdsfactory.port import Port
 from gdsfactory.typings import ComponentSpec, Routes
 
 
 def get_routes_straight(
-    ports: Union[List[Port], Dict[str, Port]],
+    ports: list[Port] | dict[str, Port],
     straight: ComponentSpec = straight,
     **kwargs,
 ) -> Routes:
     """Returns routes made by 180 degree straights.
 
     Args:
         ports: List or dict of ports.
@@ -42,24 +40,22 @@
     references = [straight.ref() for _ in ports]
     references = [ref.connect("o1", port) for port, ref in zip(ports, references)]
     ports = [ref.ports["o2"] for ref in references]
     lengths = [straight.info["length"]] * len(ports)
     return Routes(references=references, ports=ports, lengths=lengths)
 
 
-def test_get_routes_straight(check: bool = True):
+def test_get_routes_straight(check: bool = True) -> None:
     c = gf.Component("get_routes_straight")
     pad_array = gf.components.pad_array()
     c1 = c << pad_array
     c2 = c << pad_array
     c2.ymax = -200
 
     routes = get_routes_straight(ports=c1.get_ports_list(), length=200)
     c.add(routes.references)
     if check:
         difftest(c)
-    return c
 
 
 if __name__ == "__main__":
-    c = test_get_routes_straight(False)
-    c.show(show_ports=True)
+    test_get_routes_straight(False)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/manhattan.py` & `gdsfactory-7.0.0/gdsfactory/routing/manhattan.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,40 +1,41 @@
 from __future__ import annotations
 
 import uuid
 import warnings
-from typing import Callable, Dict, List, Optional, Tuple, Union
+from collections.abc import Callable
+from functools import partial
 
 import gdstk
 import numpy as np
 from numpy import bool_, ndarray
 
 import gdsfactory as gf
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.cross_section import strip
 from gdsfactory.geometry.functions import angles_deg
 from gdsfactory.port import Port, select_ports_list
 from gdsfactory.routing.get_route_sbend import get_route_sbend
-from gdsfactory.snap import snap_to_grid
 from gdsfactory.typings import (
     ComponentSpec,
     Coordinate,
     Coordinates,
     CrossSection,
     CrossSectionSpec,
     LayerSpec,
     LayerSpecs,
     MultiCrossSectionAngleSpec,
     Route,
 )
 
-TOLERANCE = 0.001
+nm = 1e-3
+TOLERANCE = 1 * nm
 DEG2RAD = np.pi / 180
 RAD2DEG = 1 / DEG2RAD
 
 O2D = {0: "East", 180: "West", 90: "North", 270: "South"}
 
 
 class RouteWarning(UserWarning):
@@ -46,18 +47,18 @@
 
 
 def sign(x: float) -> int:
     return -1 if x < 0 else 1
 
 
 def _get_unique_port_facing(
-    ports: Dict[str, Port],
+    ports: dict[str, Port],
     orientation: float = 0,
-    layer: Union[LayerSpec, LayerSpecs] = (1, 0),
-) -> List[Port]:
+    layer: LayerSpec | LayerSpecs = (1, 0),
+) -> list[Port]:
     """Ensures there is only one port."""
     ports_selected = []
     if isinstance(layer, list):
         for _layer in layer:
             ports_selected = select_ports_list(
                 ports=ports, orientation=orientation, layer=gf.get_layer(_layer)
             )
@@ -81,16 +82,16 @@
 
     return ports_selected
 
 
 def _get_bend_ports(
     bend: Component,
     orientation: float = 0,
-    layer: Union[LayerSpec, LayerSpecs] = (1, 0),
-) -> List[Port]:
+    layer: LayerSpec | LayerSpecs = (1, 0),
+) -> list[Port]:
     """Returns West and North facing ports for bend.
 
     Any standard bend/corner has two ports: one facing west and one
     facing north Returns these two ports in this order.
 
     """
     ports = bend.ports
@@ -99,16 +100,16 @@
     p_n = _get_unique_port_facing(ports=ports, orientation=90, layer=layer)
 
     return p_w + p_n
 
 
 def _get_straight_ports(
     straight: Component,
-    layer: Tuple[int, int] = (1, 0),
-) -> List[Port]:
+    layer: tuple[int, int] = (1, 0),
+) -> list[Port]:
     """Return West and east facing ports for straight waveguide.
 
     Any standard straight wire/straight has two ports: one facing west
     and one facing east
 
     """
     ports = straight.ports
@@ -161,15 +162,15 @@
 
 
 def get_straight_distance(p0: ndarray, p1: ndarray) -> float:
     if _is_vertical(p0, p1):
         return np.abs(p0[1] - p1[1])
     if _is_horizontal(p0, p1):
         return np.abs(p0[0] - p1[0])
-
+    print(f"Waveguide points {p0} {p1} are not manhattan")
     raise RouteError(f"Waveguide points {p0} {p1} are not manhattan")
 
 
 def transform(
     points: ndarray,
     translation: ndarray,
     angle_deg: int = 0,
@@ -256,15 +257,15 @@
         end_straight_length: in um.
         min_straight_length: in um.
 
     """
     threshold = TOLERANCE
 
     # transform I/O to the case where output is at (0, 0) pointing east (180)
-    p_input = input_port.center
+    p_input = np.array(input_port.center)
     p_output = np.array(output_port.center)
     pts_io = np.stack([p_input, p_output], axis=0)
     angle = output_port.orientation
 
     if output_port.orientation is None and input_port.orientation is None:
         x0, y0 = p_input
         x2, y2 = p_output
@@ -419,16 +420,16 @@
 
 
 def _get_bend_reference_parameters(
     p0: ndarray,
     p1: ndarray,
     p2: ndarray,
     bend_cell: Component,
-    port_layer: Union[LayerSpec, List[LayerSpec]],
-) -> Tuple[ndarray, int, bool]:
+    port_layer: LayerSpec | list[LayerSpec],
+) -> tuple[ndarray, int, bool]:
     """Returns bend reference settings.
 
     Args:
         p0: starting port waypoints.
         p1: middle port waypoints.
         p2: end port points.
         bend_cell: bend component.
@@ -526,19 +527,19 @@
         points = points[da != 0]
 
     return points
 
 
 def get_route_error(
     points,
-    cross_section: Optional[CrossSection] = None,
+    cross_section: CrossSection | None = None,
     layer_path: LayerSpec = (208, 0),
     layer_label: LayerSpec = (66, 0),
     layer_marker: LayerSpec = (207, 0),
-    references: Optional[List[ComponentReference]] = None,
+    references: list[ComponentReference] | None = None,
     with_sbend: bool = False,
 ) -> Route:
     """Returns route with error markers.
 
     Args:
         points: route waypoints.
         cross_section: Optional cross_section.
@@ -592,19 +593,19 @@
     return Route(references=references, ports=[port1, port2], length=-1, labels=labels)
 
 
 def round_corners(
     points: Coordinates,
     straight: ComponentSpec = straight_function,
     bend: ComponentSpec = bend_euler,
-    taper: Optional[ComponentSpec] = None,
-    straight_fall_back_no_taper: Optional[ComponentSpec] = None,
+    taper: ComponentSpec | None = None,
+    straight_fall_back_no_taper: ComponentSpec | None = None,
     mirror_straight: bool = False,
-    straight_ports: Optional[List[str]] = None,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = strip,
+    straight_ports: list[str] | None = None,
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = strip,
     on_route_error: Callable = get_route_error,
     with_point_markers: bool = False,
     with_sbend: bool = False,
     **kwargs,
 ) -> Route:
     """Returns Route.
 
@@ -800,19 +801,20 @@
             cross_section=None if multi_cross_section else x,
             references=references,
             with_sbend=with_sbend,
         )
 
     # ensure bend connectivity
     for i, point in enumerate(points[:-1]):
-        sx = np.sign(points[i + 1][0] - point[0])
-        sy = np.sign(points[i + 1][1] - point[1])
-        bsx = np.sign(bend_points[2 * i + 1][0] - bend_points[2 * i][0])
-        bsy = np.sign(bend_points[2 * i + 1][1] - bend_points[2 * i][1])
+        sx = np.sign(np.round(points[i + 1][0] - point[0], 3))
+        sy = np.sign(np.round(points[i + 1][1] - point[1], 3))
+        bsx = np.sign(np.round(bend_points[2 * i + 1][0] - bend_points[2 * i][0], 3))
+        bsy = np.sign(np.round(bend_points[2 * i + 1][1] - bend_points[2 * i][1], 3))
         if bsx * sx == -1 or bsy * sy == -1:
+            print(f"No enough space for a route between {point} and {points[i+1]}")
             return on_route_error(
                 points=points,
                 cross_section=None if multi_cross_section else x,
                 references=references,
                 with_sbend=with_sbend,
             )
 
@@ -825,15 +827,14 @@
                     break
         else:
             xsection = cross_section
         x = gf.get_cross_section(xsection, **kwargs)
 
         with_taper = False
         # wg_width = list(bend90.ports.values())[0].width
-        length = snap_to_grid(length)
         total_length += length
 
         if (
             isinstance(cross_section, list)
             or not auto_widen
             or length <= auto_widen_minimum_length
             or not width_wide
@@ -864,15 +865,15 @@
             straight_origin = taper_ref.ports[pname_east].center
 
             # Straight waveguide
             kwargs_wide = kwargs.copy()
             kwargs_wide.update(width=width_wide)
 
             if callable(cross_section):
-                cross_section_wide = gf.partial(cross_section, **kwargs_wide)
+                cross_section_wide = partial(cross_section, **kwargs_wide)
             else:
                 cross_section_wide = x.copy(width=width_wide)
             wg = gf.get_component(
                 straight, length=length, cross_section=cross_section_wide
             )
         if straight_ports is None:
             straight_ports = [p.name for p in _get_straight_ports(wg, layer=layer)]
@@ -919,31 +920,31 @@
         )
 
         references += route.references
         labels += route.labels
 
     port_input = list(wg_refs[0].ports.values())[0]
     port_output = list(wg_refs[-1].ports.values())[port_index_out]
-    length = snap_to_grid(float(total_length))
+    length = float(np.round(total_length, 3))
     return Route(
         references=references,
         ports=(port_input, port_output),
         length=length,
         labels=labels,
     )
 
 
 def generate_manhattan_waypoints(
     input_port: Port,
     output_port: Port,
-    start_straight_length: Optional[float] = None,
-    end_straight_length: Optional[float] = None,
-    min_straight_length: Optional[float] = None,
+    start_straight_length: float | None = None,
+    end_straight_length: float | None = None,
+    min_straight_length: float | None = None,
     bend: ComponentSpec = bend_euler,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = strip,
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = strip,
     **kwargs,
 ) -> ndarray:
     """Return waypoints for a Manhattan route between two ports.
 
     Args:
         input_port: source port.
         output_port: destination port.
@@ -960,15 +961,15 @@
 
     bend90 = (
         bend
         if isinstance(bend, Component)
         else gf.get_component(bend, cross_section=cross_section, **kwargs)
     )
 
-    if isinstance(cross_section, (tuple, list)):
+    if isinstance(cross_section, tuple | list):
         x = [gf.get_cross_section(xsection[0], **kwargs) for xsection in cross_section]
         start_straight_length = start_straight_length or min(_x.min_length for _x in x)
         end_straight_length = end_straight_length or min(_x.min_length for _x in x)
         min_straight_length = min_straight_length or min(_x.min_length for _x in x)
     else:
         x = gf.get_cross_section(cross_section, **kwargs)
         start_straight_length = start_straight_length or x.min_length
@@ -994,21 +995,21 @@
     return max(bsx, bsy)
 
 
 def route_manhattan(
     input_port: Port,
     output_port: Port,
     straight: ComponentSpec = straight_function,
-    taper: Optional[ComponentSpec] = None,
-    start_straight_length: Optional[float] = None,
-    end_straight_length: Optional[float] = None,
-    min_straight_length: Optional[float] = None,
+    taper: ComponentSpec | None = None,
+    start_straight_length: float | None = None,
+    end_straight_length: float | None = None,
+    min_straight_length: float | None = None,
     bend: ComponentSpec = bend_euler,
     with_sbend: bool = True,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = strip,
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = strip,
     with_point_markers: bool = False,
     on_route_error: Callable = get_route_error,
     **kwargs,
 ) -> Route:
     """Generates the Manhattan waypoints for a route.
 
     Then creates the straight, taper and bend references that define the
@@ -1025,15 +1026,15 @@
         bend: bend spec.
         with_sbend: add sbend in case there are routing errors.
         cross_section: spec.
         with_point_markers: add point markers in the route.
         kwargs: cross_section settings.
 
     """
-    if isinstance(cross_section, (tuple, list)):
+    if isinstance(cross_section, tuple | list):
         x = [gf.get_cross_section(xsection[0], **kwargs) for xsection in cross_section]
         start_straight_length = start_straight_length or min(_x.min_length for _x in x)
         end_straight_length = end_straight_length or min(_x.min_length for _x in x)
         min_straight_length = min_straight_length or min(_x.min_length for _x in x)
         x = cross_section
     else:
         x = gf.get_cross_section(cross_section, **kwargs)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/path_length_matching.py` & `gdsfactory-7.0.0/gdsfactory/routing/path_length_matching.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 from __future__ import annotations
 
-from typing import List, Union
-
 import numpy as np
 from numpy import ndarray
 
 import gdsfactory as gf
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.geometry.functions import path_length
 from gdsfactory.routing.manhattan import (
@@ -17,23 +15,23 @@
     ComponentSpec,
     CrossSectionSpec,
     MultiCrossSectionAngleSpec,
 )
 
 
 def path_length_matched_points(
-    list_of_waypoints: List[ndarray],
+    list_of_waypoints: list[ndarray],
     margin: float = 0.0,
     modify_segment_i: int = -2,
     extra_length: float = 0.0,
     nb_loops: int = 1,
     bend: ComponentSpec = bend_euler,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = "strip",
     **kwargs,
-) -> List[ndarray]:
+) -> list[ndarray]:
     """Several types of paths won't match correctly. We do not try to handle all the corner cases here. You will need to modify the input list of waypoints in some cases.
 
     Args:
         list_of_waypoints:  [[p1, p2, p3,...], [q1, q2, q3,...], ...]
             the number of turns have to be identical
             (usually means same number of points.
             exception is if there are some flat angles)
@@ -142,23 +140,23 @@
         waypoints[modify_segment_i] = p_s1 + dp
 
         list_new_waypoints += [waypoints]
     return list_new_waypoints
 
 
 def path_length_matched_points_add_waypoints(
-    list_of_waypoints: List[ndarray],
+    list_of_waypoints: list[ndarray],
     modify_segment_i: int = -2,
     bend: ComponentSpec = bend_euler,
     margin: float = 0.0,
     extra_length: float = 0.0,
     nb_loops: int = 1,
-    cross_section: Union[CrossSectionSpec, MultiCrossSectionAngleSpec] = "strip",
+    cross_section: CrossSectionSpec | MultiCrossSectionAngleSpec = "strip",
     **kwargs,
-) -> List[ndarray]:
+) -> list[ndarray]:
     """Args are the following.
 
         list_of_waypoints: a list of list_of_points:
             [[p1, p2, p3,...], [q1, q2, q3,...], ...]
             - the number of turns have to be identical
                 (usually means same number of points. exception is if there are
                 some flat angles)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/route_fiber_array.py` & `gdsfactory-7.0.0/gdsfactory/routing/route_fiber_array.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,77 +1,78 @@
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Tuple, Union
+from collections.abc import Callable
 
 import gdsfactory as gf
+from gdsfactory.add_labels import (
+    get_input_label_text_dash,
+    get_input_label_text_dash_loopback,
+)
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.grating_coupler_elliptical_trenches import grating_coupler_te
 from gdsfactory.components.straight import straight as straight_function
 from gdsfactory.components.taper import taper as taper_function
 from gdsfactory.cross_section import strip
 from gdsfactory.port import Port, select_ports_optical
 from gdsfactory.routing.get_bundle import get_bundle, get_min_spacing
+from gdsfactory.routing.get_input_labels import get_input_labels_dash
 from gdsfactory.routing.get_route import get_route_from_waypoints
 from gdsfactory.routing.manhattan import generate_manhattan_waypoints, round_corners
 from gdsfactory.routing.route_south import route_south
 from gdsfactory.routing.utils import direction_ports_from_list_ports
+from gdsfactory.snap import snap_to_grid
 from gdsfactory.typings import (
     ComponentSpec,
     ComponentSpecOrList,
     CrossSectionSpec,
     Label,
     LayerSpec,
     Strs,
 )
-from gdsfactory.add_labels import (
-    get_input_label_text_dash,
-    get_input_label_text_dash_loopback,
-)
-from gdsfactory.routing.get_input_labels import get_input_labels_dash
 
 
 def route_fiber_array(
     component: Component,
-    fiber_spacing: Union[str, float] = "fiber_array_spacing",
+    fiber_spacing: str | float = "fiber_array_spacing",
     grating_coupler: ComponentSpecOrList = grating_coupler_te,
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
     taper: ComponentSpec = taper_function,
-    fanout_length: Optional[float] = None,
+    fanout_length: float | None = None,
     max_y0_optical: None = None,
     with_loopback: bool = True,
     nlabels_loopback: int = 2,
     straight_separation: float = 6.0,
     straight_to_grating_spacing: float = 5.0,
-    optical_routing_type: Optional[int] = None,
+    optical_routing_type: int | None = None,
     connected_port_names: None = None,
     nb_optical_ports_lines: int = 1,
     force_manhattan: bool = False,
-    excluded_ports: Optional[List[str]] = None,
-    grating_indices: Optional[List[int]] = None,
+    excluded_ports: list[str] | None = None,
+    grating_indices: list[int] | None = None,
     route_filter: Callable = get_route_from_waypoints,
     gc_port_name: str = "o1",
     gc_rotation: int = -90,
     layer_label: LayerSpec = "TEXT",
     layer_label_loopback: LayerSpec = "TEXT",
-    component_name: Optional[str] = None,
+    component_name: str | None = None,
     x_grating_offset: int = 0,
-    port_names: Optional[Strs] = None,
+    port_names: Strs | None = None,
     get_input_label_text_loopback_function: Callable = get_input_label_text_dash_loopback,
-    get_input_label_text_function: Optional[Callable] = get_input_label_text_dash,
-    get_input_labels_function: Optional[Callable] = get_input_labels_dash,
+    get_input_label_text_function: Callable | None = get_input_label_text_dash,
+    get_input_labels_function: Callable | None = get_input_labels_dash,
     select_ports: Callable = select_ports_optical,
     cross_section: CrossSectionSpec = strip,
     **kwargs,
-) -> Tuple[
-    List[Union[ComponentReference, Label]],
-    List[List[ComponentReference]],
-    List[Port],
-    List[Port],
+) -> tuple[
+    list[ComponentReference | Label],
+    list[list[ComponentReference]],
+    list[Port],
+    list[Port],
 ]:
     """Returns component I/O elements for adding grating couplers with a fiber array Many components are fine with the defaults.
 
     Args:
         component: component spec to connect to.
         fiber_spacing: spacing between the optical fibers.
         grating_coupler: grating coupler instance, function or list of functions.
@@ -128,19 +129,14 @@
         ports_grating_input_waveguide: grating coupler input waveguide ports.
         ports_loopback: list of grating coupler input waveguide ports.
         ports_component: list of optical ports.
 
     """
     fiber_spacing = gf.get_constant(fiber_spacing)
     cross_section = x = gf.get_cross_section(cross_section, **kwargs)
-    radius = x.radius
-
-    assert isinstance(
-        radius, (int, float)
-    ), f"radius = {radius} {type (radius)} needs to be int or float"
 
     component_name = component_name or component.name
     excluded_ports = excluded_ports or []
     if port_names is None:
         optical_ports = list(select_ports(component.ports).values())
     else:
         optical_ports = [component.ports[lbl] for lbl in port_names]
@@ -270,14 +266,18 @@
 
     nb_ports_per_line = N // nb_optical_ports_lines
     grating_coupler_si = grating_coupler.size_info
     y_gr_gap = (K / nb_optical_ports_lines + 1) * sep
     gr_coupler_y_sep = grating_coupler_si.height + y_gr_gap + dy
 
     offset = (nb_ports_per_line - 1) * fiber_spacing / 2 - x_grating_offset
+    offset = snap_to_grid(offset)
+    x_c = snap_to_grid(x_c)
+    y0_optical = snap_to_grid(y0_optical)
+    gr_coupler_y_sep = snap_to_grid(gr_coupler_y_sep)
     io_gratings_lines = []  # [[gr11, gr12, gr13...], [gr21, gr22, gr23...] ...]
 
     if grating_indices is None:
         grating_indices = list(range(nb_ports_per_line))
     else:
         assert len(grating_indices) == nb_ports_per_line
 
@@ -456,14 +456,17 @@
 
         route = round_corners(
             points=points,
             straight=straight,
             bend=bend90,
             cross_section=cross_section,
         )
+        # gca1.connect(gc_port_name, route.ports[0])
+        # gca2.connect(gc_port_name, route.ports[1])
+
         elements.extend(route.references)
         if nlabels_loopback == 1:
             io_gratings_loopback = [gca1]
             ordered_ports_loopback = [port0]
         if nlabels_loopback == 2:
             io_gratings_loopback = [gca1, gca2]
             ordered_ports_loopback = [port0, port1]
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/route_fiber_single.py` & `gdsfactory-7.0.0/gdsfactory/routing/route_fiber_single.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Tuple, Union
+from collections.abc import Callable
 
 import gdstk
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.component_layout import _rotate_points
@@ -17,21 +17,21 @@
 
 def route_fiber_single(
     component: Component,
     fiber_spacing: float = 50.0,
     grating_coupler: ComponentSpec = grating_coupler_te,
     min_input_to_output_spacing: float = 200.0,
     optical_routing_type: int = 1,
-    port_names: Optional[Tuple[str, ...]] = None,
-    excluded_ports: Optional[Tuple[str, ...]] = None,
-    component_name: Optional[str] = None,
+    port_names: tuple[str, ...] | None = None,
+    excluded_ports: tuple[str, ...] | None = None,
+    component_name: str | None = None,
     select_ports: Callable = select_ports_optical,
     cross_section: CrossSectionSpec = strip,
     **kwargs,
-) -> Tuple[List[Union[ComponentReference, Label]], List[ComponentReference]]:
+) -> tuple[list[ComponentReference | Label], list[ComponentReference]]:
     """Returns route Tuple(references, grating couplers) for single fiber input/output.
 
     Args:
         component: to add grating couplers.
         fiber_spacing: between grating couplers.
         grating_coupler: grating coupler Spec
         min_input_to_output_spacing: so opposite fibers do not touch
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/route_ports_to_side.py` & `gdsfactory-7.0.0/gdsfactory/routing/route_ports_to_side.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 from __future__ import annotations
 
-from typing import Any, Callable, Dict, List, Optional, Tuple, Union
+from collections.abc import Callable
+from typing import Any
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.port import Port, flipped
 from gdsfactory.routing.get_route import get_route
@@ -24,21 +25,21 @@
 
 
 def sort_key_north_to_south(port: Port) -> float:
     return -port.y
 
 
 def route_ports_to_side(
-    ports: Union[Dict[str, Port], List[Port], Component, ComponentReference],
+    ports: dict[str, Port] | list[Port] | Component | ComponentReference,
     side: str = "north",
-    x: Optional[float] = None,
-    y: Optional[float] = None,
+    x: float | None = None,
+    y: float | None = None,
     routing_func: Callable = get_route,
     **kwargs,
-) -> Tuple[List[Route], List[Port]]:
+) -> tuple[list[Route], list[Port]]:
     """Routes ports to a given side.
 
     Args:
         ports: list/dict/Component/ComponentReference to route to a side.
         side: 'north', 'south', 'east' or 'west'.
         x: position to route ports for east/west. None, uses most east/west value.
         y: position to route ports for south/north. None, uses most north/south value.
@@ -80,15 +81,15 @@
     if not ports:
         return [], []
 
     # Accept list of ports, Component or dict of ports
     if isinstance(ports, dict):
         ports = list(ports.values())
 
-    elif isinstance(ports, (Component, ComponentReference)):
+    elif isinstance(ports, Component | ComponentReference):
         ports = list(ports.ports.values())
 
     # Choose which
     if side in {"north", "south"}:
         func_route = route_ports_to_y
         xy = y if y is not None else side
     elif side in {"west", "east"}:
@@ -113,30 +114,30 @@
 
 
 def route_ports_to_east(list_ports, **kwargs):
     return route_ports_to_side(list_ports, side="east", **kwargs)
 
 
 def route_ports_to_x(
-    list_ports: List[Port],
-    x: Union[float, str] = "east",
+    list_ports: list[Port],
+    x: float | str = "east",
     separation: float = 10.0,
     radius: float = 10.0,
     extend_bottom: float = 0.0,
     extend_top: float = 0.0,
     extension_length: float = 0.0,
-    y0_bottom: Optional[float] = None,
-    y0_top: Optional[float] = None,
+    y0_bottom: float | None = None,
+    y0_top: float | None = None,
     routing_func: RouteFactory = get_route,
     backward_port_side_split_index: int = 0,
     start_straight_length: float = 0.01,
-    dx_start: Optional[float] = None,
-    dy_start: Optional[float] = None,
+    dx_start: float | None = None,
+    dy_start: float | None = None,
     **routing_func_args,
-) -> Tuple[List[Route], List[Port]]:
+) -> tuple[list[Route], list[Port]]:
     """Returns route to x.
 
     Args:
         list_ports: reasonably well behaved list of ports.
            ports facing north ports are norther than any other ports
            ports facing south ports are souther ...
            ports facing west ports are the wester ...
@@ -194,15 +195,15 @@
     if x == "west" and extension_length > 0:
         extension_length = -extension_length
 
     if x == "east":
         x = max(p.x for p in list_ports) + bx
     elif x == "west":
         x = min(p.x for p in list_ports) - bx
-    elif isinstance(x, (float, int)):
+    elif isinstance(x, float | int):
         pass
     else:
         raise ValueError(f"x={x!r} should be a float or east or west")
 
     if x < min(xs):
         sort_key_north = sort_key_west_to_east
         sort_key_south = sort_key_west_to_east
@@ -306,30 +307,30 @@
         y_optical_bot -= separation
         start_straight_length += separation
 
     return routes, ports
 
 
 def route_ports_to_y(
-    list_ports: List[Port],
-    y: Union[float, str] = "north",
+    list_ports: list[Port],
+    y: float | str = "north",
     separation: float = 10.0,
     radius: float = 10.0,
-    x0_left: Optional[float] = None,
-    x0_right: Optional[float] = None,
+    x0_left: float | None = None,
+    x0_right: float | None = None,
     extension_length: float = 0.0,
     extend_left: float = 0.0,
     extend_right: float = 0.0,
     routing_func: RouteFactory = get_route,
     backward_port_side_split_index: int = 0,
     start_straight_length: float = 0.01,
-    dx_start: Optional[float] = None,
-    dy_start: Optional[float] = None,
-    **routing_func_args: Dict[Any, Any],
-) -> Tuple[List[Route], List[Port]]:
+    dx_start: float | None = None,
+    dy_start: float | None = None,
+    **routing_func_args: dict[Any, Any],
+) -> tuple[list[Route], list[Port]]:
     """Args are the following.
 
         list_ports: reasonably well behaved list of ports.
            ports facing north ports are norther than any other ports
            ports facing south ports are souther ...
            ports facing west ports are the wester ...
            ports facing east ports are the easter ...
@@ -402,15 +403,15 @@
         y = (
             min(
                 p.y - a * np.abs(np.cos(p.orientation * np.pi / 180))
                 for p in list_ports
             )
             - by
         )
-    elif isinstance(y, (float, int)):
+    elif isinstance(y, float | int):
         pass
     if y <= min(ys):
         sort_key_east = sort_key_south_to_north
         sort_key_west = sort_key_south_to_north
         forward_ports = south_ports
         backward_ports = north_ports
         angle = 90.0
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/route_quad.py` & `gdsfactory-7.0.0/gdsfactory/routing/route_quad.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,36 +1,34 @@
 """Route for electrical based on phidl.routing.route_quad."""
 from __future__ import annotations
 
-from typing import Optional
-
+import gdstk
 import numpy as np
 
 import gdsfactory as gf
-from gdsfactory.port import Port
 from gdsfactory.geometry.manhattanize import manhattanize_polygon
-import gdstk
+from gdsfactory.port import Port
 
 
 def _get_rotated_basis(theta):
     """Returns basis vectors rotated CCW by theta (in degrees)."""
     theta = np.radians(theta)
     e1 = np.array([np.cos(theta), np.sin(theta)])
     e2 = np.array([-1 * np.sin(theta), np.cos(theta)])
     return e1, e2
 
 
 @gf.cell
 def route_quad(
     port1: Port,
     port2: Port,
-    width1: Optional[float] = None,
-    width2: Optional[float] = None,
+    width1: float | None = None,
+    width2: float | None = None,
     layer: gf.typings.LayerSpec = "M1",
-    manhattan_target_step: Optional[float] = None,
+    manhattan_target_step: float | None = None,
 ) -> gf.Component:
     """Routes a basic quadrilateral polygon directly between two ports.
 
     Args:
         port1: Port to start route.
         port2 : Port objects to end route.
         width1: Width of quadrilateral at ports. If None, uses port widths.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/route_sharp.py` & `gdsfactory-7.0.0/gdsfactory/routing/route_sharp.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,10 @@
 """based on phidl.routing."""
 from __future__ import annotations
 
-from typing import Optional, Tuple
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.cross_section import CrossSection
 from gdsfactory.path import Path, transition
 from gdsfactory.port import Port
@@ -265,20 +263,20 @@
     return Path(np.array([pt1, pt2, pt3]))
 
 
 @gf.cell
 def route_sharp(
     port1: Port,
     port2: Port,
-    width: Optional[float] = None,
+    width: float | None = None,
     path_type: str = "manhattan",
     manual_path=None,
-    layer: Optional[LayerSpec] = None,
-    cross_section: Optional[CrossSectionSpec] = None,
-    port_names: Tuple[str, str] = ("o1", "o2"),
+    layer: LayerSpec | None = None,
+    cross_section: CrossSectionSpec | None = None,
+    port_names: tuple[str, str] = ("o1", "o2"),
     **kwargs,
 ) -> Component:
     """Returns Component route between ports.
 
     Args:
         port1: start port.
         port2: end port.
@@ -289,24 +287,25 @@
                 whose width varies linearly from width[0] to width[1]
             If set to a CrossSection: uses the CrossSection parameters for the route.
         path_type : {'manhattan', 'L', 'U', 'J', 'C', 'V', 'Z', 'straight', 'manual'}.
         manual_path: array-like[N][2] or Path Waypoint for  manual route.
         layer: Layer to put route on.
         kwargs: Keyword arguments passed to the waypoint path function.
 
-        Method of waypoint path creation. Should be one of
-        - manhattan: automatic manhattan routing (see path_manhattan() ).
-        - L: L-shaped path for orthogonal ports that can be directly connected.
-        - U: U-shaped path for parallel or facing ports.
-        - J: J-shaped path for orthogonal ports that cannot be directly connected.
-        - C: C-shaped path for ports that face away from each other.
-        - Z: Z-shaped path with three segments for ports at any angles.
-        - V: V-shaped path with two segments for ports at any angles.
-        - straight: straight path for ports that face each other.
-        - manual: use an explicit waypoint path provided in manual_path.
+    Method of waypoint path creation. Should be one of:
+
+     - manhattan: automatic manhattan routing (see path_manhattan() ).
+     - L: L-shaped path for orthogonal ports that can be directly connected.
+     - U: U-shaped path for parallel or facing ports.
+     - J: J-shaped path for orthogonal ports that cannot be directly connected.
+     - C: C-shaped path for ports that face away from each other.
+     - Z: Z-shaped path with three segments for ports at any angles.
+     - V: V-shaped path with two segments for ports at any angles.
+     - straight: straight path for ports that face each other.
+     - manual: use an explicit waypoint path provided in manual_path.
 
     .. plot::
         :include-source:
 
         import gdsfactory as gf
 
         c = gf.Component("pads")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/route_south.py` & `gdsfactory-7.0.0/gdsfactory/routing/route_south.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 from __future__ import annotations
 
-from typing import Callable, List, Optional, Tuple
+from collections.abc import Callable
 
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.components.bend_euler import bend_euler
 from gdsfactory.components.straight import straight as straight_function
@@ -15,23 +15,23 @@
 from gdsfactory.routing.utils import direction_ports_from_list_ports, flip
 from gdsfactory.typings import ComponentSpec, CrossSectionSpec, Number, Routes, Strs
 
 
 def route_south(
     component: Component,
     optical_routing_type: int = 1,
-    excluded_ports: Optional[Tuple[str, ...]] = None,
+    excluded_ports: tuple[str, ...] | None = None,
     straight_separation: Number = 4.0,
-    io_gratings_lines: Optional[List[List[ComponentReference]]] = None,
+    io_gratings_lines: list[list[ComponentReference]] | None = None,
     gc_port_name: str = "o1",
     bend: ComponentSpec = bend_euler,
     straight: ComponentSpec = straight_function,
-    taper: Optional[ComponentSpec] = taper_function,
+    taper: ComponentSpec | None = taper_function,
     select_ports: Callable = select_ports_optical,
-    port_names: Optional[Strs] = None,
+    port_names: Strs | None = None,
     cross_section: CrossSectionSpec = strip,
     **kwargs,
 ) -> Routes:
     """Returns Routes to route a component ports to the south.
 
     Args:
         component: component to route.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/sort_ports.py` & `gdsfactory-7.0.0/gdsfactory/routing/sort_ports.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,35 +1,33 @@
 from __future__ import annotations
 
-from typing import List, Tuple
-
 from gdsfactory.port import Port
 
 
 def get_port_x(port: Port) -> float:
     return port.center[0]
 
 
 def get_port_y(port: Port) -> float:
     return port.center[1]
 
 
-def sort_ports_x(ports: List[Port]) -> List[Port]:
+def sort_ports_x(ports: list[Port]) -> list[Port]:
     f_key = get_port_x
     ports.sort(key=f_key)
     return ports
 
 
-def sort_ports_y(ports: List[Port]) -> List[Port]:
+def sort_ports_y(ports: list[Port]) -> list[Port]:
     f_key = get_port_y
     ports.sort(key=f_key)
     return ports
 
 
-def sort_ports(ports1: List[Port], ports2: List[Port]) -> Tuple[List[Port], List[Port]]:
+def sort_ports(ports1: list[Port], ports2: list[Port]) -> tuple[list[Port], list[Port]]:
     """Returns two lists of sorted ports.
 
     Args:
         ports1:
         ports2:
 
     """
```

### Comparing `gdsfactory-6.99.0/gdsfactory/routing/utils.py` & `gdsfactory-7.0.0/gdsfactory/routing/utils.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,22 +1,20 @@
 from __future__ import annotations
 
-from typing import Dict, List, Union
-
 from numpy import float64
 
 from gdsfactory.port import Port
 
 
 def flip(port: Port) -> Port:
     """Returns port copy with Flip Port orientation."""
     return port.flip()
 
 
-def direction_ports_from_list_ports(optical_ports: List[Port]) -> Dict[str, List[Port]]:
+def direction_ports_from_list_ports(optical_ports: list[Port]) -> dict[str, list[Port]]:
     """Returns a dict of WENS ports."""
     direction_ports = {x: [] for x in ["E", "N", "W", "S"]}
     for p in optical_ports:
         p.orientation = (p.orientation + 360.0) % 360
         if p.orientation <= 45.0 or p.orientation >= 315:
             direction_ports["E"].append(p)
         elif p.orientation <= 135.0 and p.orientation >= 45.0:
@@ -32,15 +30,15 @@
 
         if direction in ["S", "N"]:
             list_ports.sort(key=lambda p: p.x)
 
     return direction_ports
 
 
-def check_ports_have_equal_spacing(list_ports: List[Port]) -> float64:
+def check_ports_have_equal_spacing(list_ports: list[Port]) -> float64:
     """Returns port separation.
 
     Raises error if not constant.
 
     """
     if not isinstance(list_ports, list):
         raise ValueError(f"list_ports should be a list of ports, got {list_ports}")
@@ -57,15 +55,15 @@
     different_seps = set(seps)
     if len(different_seps) > 1:
         raise ValueError("Ports should have the same separation. Got {different_seps}")
 
     return different_seps.pop()
 
 
-def get_list_ports_angle(list_ports: List[Port]) -> Union[float64, int]:
+def get_list_ports_angle(list_ports: list[Port]) -> float64 | int:
     """Returns the orientation/angle (in degrees) of a list of ports."""
     if not list_ports:
         return None
     if len({p.orientation for p in list_ports}) > 1:
         raise ValueError(f"All port angles should be the same. Got {list_ports}")
     return list_ports[0].orientation
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell.py` & `gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell.py`

 * *Files 2% similar despite different names*

```diff
@@ -33,19 +33,14 @@
     )
     wg.add_port(
         name="o2", center=(length, width / 2), width=width, orientation=0, layer=layer
     )
     return wg
 
 
-def test_straight_wide(data_regression) -> None:
-    component = straight_wide()
-    data_regression.check(component.to_dict())
-
-
 # ==============================================================================
 # Create a blank component
 # ==============================================================================
 # Let's create a new Component ``c`` which will act as a blank canvas (c can be
 # thought of as a blank GDS cell with some special features). Note that when we
 # make a Component
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml` & `gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell_with_pins.py` & `gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell_with_pins.py`

 * *Files 8% similar despite different names*

```diff
@@ -12,30 +12,24 @@
 ) -> gf.Component:
     """Returns straight Component.
 
     Args:
         length: of the straight.
         width: in um.
         layer: layer spec
-
     """
     wg = gf.Component("straight_sample")
     wg.add_polygon([(0, 0), (length, 0), (length, width), (0, width)], layer=layer)
     wg.add_port(
         name="o1", center=(0, width / 2), width=width, orientation=180, layer=layer
     )
     wg.add_port(
         name="o2", center=(length, width / 2), width=width, orientation=0, layer=layer
     )
     return wg
 
 
-def test_straight_narrow(data_regression) -> None:
-    component = straight_narrow()
-    data_regression.check(component.to_dict())
-
-
 if __name__ == "__main__":
     wg = straight_narrow(decorator=gf.add_pins.add_pins)
 
     # By default show adds pins, so you don't need it to show_ports
     wg.show(show_ports=False)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml` & `gdsfactory-7.0.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/03_move.py` & `gdsfactory-7.0.0/gdsfactory/samples/03_move.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/04_connect.py` & `gdsfactory-7.0.0/gdsfactory/samples/04_connect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/05_remove_layers.py` & `gdsfactory-7.0.0/gdsfactory/samples/05_remove_layers.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,16 @@
 """You can remove a list of layers from a component."""
-
-
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 
 
 @gf.cell
-def test_remove_layers() -> Component:
+def remove_layers() -> Component:
     c = gf.Component("test_remove_layers")
 
     c.add_ref(gf.components.rectangle(size=(10, 1), layer=gf.LAYER.WG))
     c.add_ref(gf.components.rectangle(size=(10, 2), layer=gf.LAYER.SLAB90))
     c.add_ref(gf.components.rectangle(size=(10, 3), layer=gf.LAYER.SLAB150))
 
     assert len(c.layers) == 3
@@ -20,9 +18,9 @@
     c = c.remove_layers(layers=[gf.LAYER.SLAB90, gf.LAYER.SLAB150])
 
     assert len(c.layers) == 1
     return c
 
 
 if __name__ == "__main__":
-    c = test_remove_layers()
+    c = remove_layers()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/06_remapping_layers.py` & `gdsfactory-7.0.0/gdsfactory/samples/06_remapping_layers.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,17 +1,20 @@
 """You can remap layers."""
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 from gdsfactory.component import Component
 
 
-def test_remap_layers() -> Component:
-    c = gf.Component("test_remap_layers_sample_device")
-    straight = gf.partial(
+@gf.cell
+def remap_layers() -> Component:
+    c = gf.Component()
+    straight = partial(
         gf.components.straight,
         with_bbox=True,
         cladding_layers=None,
         add_pins=None,
         add_bbox=None,
     )
 
@@ -26,9 +29,9 @@
     assert len(c.layers) == nlayers
     c.remap_layers({(1, 0): (2, 0)})
     assert len(c.layers) == nlayers - 1
     return c
 
 
 if __name__ == "__main__":
-    c = test_remap_layers()
+    c = remap_layers()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/07_flattening_device.py` & `gdsfactory-7.0.0/gdsfactory/samples/07_flattening_device.py`

 * *Files 12% similar despite different names*

```diff
@@ -13,24 +13,25 @@
 """
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 
 
-def test_flatten_device() -> Component:
+@gf.cell
+def flatten_device() -> Component:
     c = gf.Component("test_remap_layers")
 
     c.add_ref(gf.components.rectangle(size=(10, 1), layer=gf.LAYER.WG))
     c.add_ref(gf.components.rectangle(size=(10, 2), layer=gf.LAYER.SLAB90))
     c.add_ref(gf.components.rectangle(size=(10, 3), layer=gf.LAYER.SLAB150))
 
     assert len(c.references) == 3
     c2 = c.flatten()
     # c2 = c.flatten(single_layer=(34, 0))
     assert len(c2.references) == 0
     return c2
 
 
 if __name__ == "__main__":
-    c = test_flatten_device()
+    c = flatten_device()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/11_component_layout.py` & `gdsfactory-7.0.0/gdsfactory/samples/11_component_layout.py`

 * *Files 3% similar despite different names*

```diff
@@ -14,15 +14,15 @@
 
 import gdsfactory as gf
 from gdsfactory import LAYER
 from gdsfactory.component import Component
 
 
 @gf.cell
-def test_crossing_arm(
+def crossing_arm(
     wg_width: float = 0.5,
     r1: float = 3.0,
     r2: float = 1.1,
     taper_width: float = 1.2,
     taper_length: float = 3.4,
 ) -> Component:
     """Returns a crossing arm.
@@ -60,9 +60,9 @@
     c.add_port(
         name="o2", center=(xmax, 0), orientation=0, width=wg_width, layer=LAYER.WG
     )
     return c
 
 
 if __name__ == "__main__":
-    c = test_crossing_arm()
+    c = crossing_arm()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/12_component_refs.py` & `gdsfactory-7.0.0/gdsfactory/samples/12_component_refs.py`

 * *Files 3% similar despite different names*

```diff
@@ -10,15 +10,15 @@
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import Layer
 
 
 @gf.cell
-def test_crossing_arm(
+def crossing_arm(
     wg_width: float = 0.5,
     r1: float = 3.0,
     r2: float = 1.1,
     taper_width: float = 1.2,
     taper_length: float = 3.4,
     layer_wg: Layer = (1, 0),
     layer_slab: Layer = (2, 0),
@@ -49,17 +49,17 @@
     c.add_port(
         name="o2", center=(xmax, 0), orientation=0, width=wg_width, layer=layer_wg
     )
     return c
 
 
 @gf.cell  # This decorator will generate a good name for the component
-def test_crossing() -> Component:
+def crossing() -> Component:
     c = gf.Component()
-    arm = test_crossing_arm()
+    arm = crossing_arm()
 
     # Create two arm references. One has a 90Deg rotation
     arm_h = arm.ref(position=(0, 0))
     arm_v = arm.ref(position=(0, 0), rotation=90)
 
     # Add each arm to the component
     # Also add the ports
@@ -73,9 +73,9 @@
             port_id += 1
 
     c.auto_rename_ports()
     return c
 
 
 if __name__ == "__main__":
-    c = test_crossing()
+    c = crossing()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/13_component_netlist.py` & `gdsfactory-7.0.0/gdsfactory/samples/13_component_netlist.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 
 
 @gf.cell
-def test_netlist_yaml() -> Component:
+def netlist_yaml() -> Component:
     """Test netlist yaml.
 
     .. code::
 
         arm_top
          _____
         |     |
@@ -47,10 +47,14 @@
         o2: mmi_short,o1
         o1: mmi_long,o1
     """
 
     return gf.read.from_yaml(yaml)
 
 
+def test_netlist_yaml_sample() -> None:
+    assert netlist_yaml()
+
+
 if __name__ == "__main__":
-    c = test_netlist_yaml()
+    c = netlist_yaml()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/15_component_sequence1.py` & `gdsfactory-7.0.0/gdsfactory/samples/15_component_sequence1.py`

 * *Files 10% similar despite different names*

```diff
@@ -15,15 +15,15 @@
 from gdsfactory.components import bend_circular
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.straight import straight
 from gdsfactory.components.straight_pin import straight_pn
 
 
 @gf.cell
-def test_cutback_pn() -> Component:
+def cutback_pn() -> Component:
     # Define subcomponents
     bend_radius = 10.0
     bend180 = bend_circular(radius=bend_radius, angle=180)
     wg = straight(length=5.0)
     wg_heater = straight_pn(length=50.0)
 
     # Define a map between symbols and (component, input port, output port)
@@ -40,10 +40,14 @@
 
     sequence = "AB-H-H-H-H-BA"
     return component_sequence(
         sequence=sequence, symbol_to_component=symbol_to_component
     )
 
 
+def test_cutback_pn() -> None:
+    assert cutback_pn()
+
+
 if __name__ == "__main__":
-    c = test_cutback_pn()
+    c = cutback_pn()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/16_component_sequence2.py` & `gdsfactory-7.0.0/gdsfactory/samples/16_component_sequence2.py`

 * *Files 8% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 from gdsfactory.component import Component
 from gdsfactory.components.component_sequence import component_sequence
 from gdsfactory.components.straight import straight
 from gdsfactory.components.taper import taper_strip_to_ridge
 
 
 @gf.cell
-def test_cutback_phase(
+def cutback_phase(
     straight_length: float = 100.0, bend_radius: float = 12.0, n: int = 2
 ) -> Component:
     """Modulator sections connected by bends."""
     # Define sub components
     bend180 = gf.components.bend_circular180(radius=bend_radius)
     pm_wg = gf.components.straight_pin(length=straight_length, taper=None)
     wg_short = straight(length=1.0)
@@ -40,10 +40,14 @@
     heater_seq = "-H-H-H-H-"
     sequence = repeated_sequence * n + "SIPO" + heater_seq
     return component_sequence(
         sequence=sequence, symbol_to_component=symbol_to_component
     )
 
 
+def test_cutback_phase() -> None:
+    assert cutback_phase()
+
+
 if __name__ == "__main__":
-    c = test_cutback_phase(n=1)
+    c = cutback_phase(n=1)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/17_ports.py` & `gdsfactory-7.0.0/gdsfactory/samples/17_ports.py`

 * *Files 6% similar despite different names*

```diff
@@ -12,15 +12,15 @@
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpec
 
 
 @gf.cell
-def test_component_with_port(
+def component_with_port(
     length: float = 5.0, width: float = 0.5, layer: LayerSpec = "WG"
 ) -> Component:
     """Returns a component with one port on the west side.
 
     Args:
         length: in um.
         width: waveguide width in um.
@@ -33,10 +33,14 @@
     c = gf.Component()
     c.add_polygon([(0, 0), (x, 0), (x, y), (0, y)], layer=layer)
     c.add_port(name="o1", center=(0, y / 2), width=y, orientation=180, layer=layer)
     assert len(c.ports) == 1
     return c
 
 
+def test_component_with_port() -> None:
+    assert component_with_port()
+
+
 if __name__ == "__main__":
-    c = test_component_with_port()
+    c = component_with_port()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/20_components.py` & `gdsfactory-7.0.0/gdsfactory/samples/20_components.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,19 +1,21 @@
 """# Components. You can adapt some component functions from the `gdsfactory.components` module. Each function there returns a Component object. Here are two equivalent functions."""
 
 
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 
 
 def straight_wide1(width=10, **kwargs) -> gf.Component:
     return gf.components.straight(width=width, **kwargs)
 
 
-straight_wide2 = gf.partial(gf.components.straight, width=10)
+straight_wide2 = partial(gf.components.straight, width=10)
 
 
 if __name__ == "__main__":
     # c = straight_wide1()
     c = straight_wide2()
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/23_reticle.py` & `gdsfactory-7.0.0/gdsfactory/samples/23_reticle.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 """Sample of a reticle top level Component."""
 
 from __future__ import annotations
 
 import gdsfactory as gf
 
-
 if __name__ == "__main__":
     option = 3
 
     gc = gf.c.grating_coupler_elliptical_tm()
     c = gf.c.mzi_phase_shifter_top_heater_metal(delta_length=40)
     c = gf.routing.add_fiber_single(
         c, get_input_label_text_function=None, grating_coupler=gc
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/24_doe_2.py` & `gdsfactory-7.0.0/gdsfactory/samples/24_doe_2.py`

 * *Files 13% similar despite different names*

```diff
@@ -3,21 +3,23 @@
 In this case add_fiber_array does not add labels.
 
 You can use gf.add_labels.add_labels_to_ports.
 
 """
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 
 if __name__ == "__main__":
     c = gf.components.pack_doe(
         gf.components.straight,
         settings={"length": [5, 5]},
-        function=gf.partial(gf.routing.add_fiber_array, get_input_labels_function=None),
+        function=partial(gf.routing.add_fiber_array, get_input_labels_function=None),
     )
     c = gf.add_labels.add_labels_to_ports(
         component=c, prefix="opt_te1550_", port_type="vertical_te"
     )
     print(len(c.labels))
     c.show(show_ports=False)
     # c.write_gds_with_metadata(f"{__file__[:-3]}/test.gds")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/24_doe_3.py` & `gdsfactory-7.0.0/gdsfactory/samples/24_doe_3.py`

 * *Files 12% similar despite different names*

```diff
@@ -3,21 +3,23 @@
 In this case add_fiber_array does not add labels.
 
 You can use gf.add_labels.add_labels_to_ports.
 
 """
 from __future__ import annotations
 
+from functools import partial
+
 import gdsfactory as gf
 
 if __name__ == "__main__":
     c = gf.components.pack_doe_grid(
         gf.components.straight,
         settings={"length": [5, 5]},
-        function=gf.partial(gf.routing.add_fiber_array, get_input_labels_function=None),
+        function=partial(gf.routing.add_fiber_array, get_input_labels_function=None),
     )
     c = gf.add_labels.add_labels_to_ports(
         component=c, prefix="opt_te1550_", port_type="vertical_te"
     )
     print(len(c.labels))
     c.show(show_ports=False)
     # c.write_gds_with_metadata(f"{__file__[:-3]}/test.gds")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/30_lidar.py` & `gdsfactory-7.0.0/gdsfactory/samples/30_lidar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/30_lidar_pcell.py` & `gdsfactory-7.0.0/gdsfactory/samples/30_lidar_pcell.py`

 * *Files 6% similar despite different names*

```diff
@@ -8,15 +8,17 @@
 
 from __future__ import annotations
 
 import gdsfactory as gf
 
 
 @gf.cell
-def lidar(noutputs=2**2, antenna_pitch=2.0, splitter_tree_spacing=(50.0, 70.0)):
+def lidar(
+    noutputs=2**2, antenna_pitch=2.0, splitter_tree_spacing=(50.0, 70.0)
+) -> gf.Component:
     c = gf.Component("lidar")
 
     # power Splitter
     splitter_tree = c << gf.components.splitter_tree(
         noutputs=noutputs, spacing=splitter_tree_spacing
     )
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/30_lidar_with_pads.py` & `gdsfactory-7.0.0/gdsfactory/samples/30_lidar_with_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing.py` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 from __future__ import annotations
 
+import pathlib
+
 from gdsfactory.cell import cell
 from gdsfactory.component import Component
-from gdsfactory.read import from_yaml, cell_from_yaml_template
+from gdsfactory.read import cell_from_yaml_template, from_yaml
 from gdsfactory.routing.factories import routing_strategy
-import pathlib
 
 SAMPLE_DIR = pathlib.Path(__file__).parent / "all_angle_routing"
 
 
 @cell
 def demo_all_angle_routing() -> Component:
     """Demonstrate all-angle routing."""
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/big_device.py` & `gdsfactory-7.0.0/gdsfactory/samples/big_device.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,34 +1,35 @@
 from __future__ import annotations
 
-from typing import Tuple
-
 import numpy as np
 
 import gdsfactory as gf
 from gdsfactory import LAYER, Port
 from gdsfactory.component import Component
+from gdsfactory.typings import CrossSectionSpec
 
 
 @gf.cell
 def big_device(
-    size: Tuple[float, float] = (400.0, 400.0),
+    size: tuple[float, float] = (400.0, 400.0),
     nports: int = 16,
     spacing: float = 15.0,
-    layer: Tuple[int, int] = LAYER.WG,
+    layer: tuple[int, int] = LAYER.WG,
     wg_width: float = 0.5,
+    cross_section: CrossSectionSpec = "strip",
 ) -> Component:
     """Big component with N ports on each side.
 
     Args:
         size: x, y.
         nports: number of ports.
         spacing: in um.
         layer: spec.
         wg_width: waveguide width in um.
+        cross_section: spec.
 
     """
     component = gf.Component()
     p0 = np.array((0, 0))
 
     w, h = size
     dx = w / 2
@@ -73,15 +74,25 @@
             name=f"S{i}",
             center=p0 + ((i - N / 2) * spacing, -dy),
             orientation=-90,
             layer=layer,
             width=wg_width,
         )
         component.add_port(port)
+
+    component = gf.add_pins.add_pins_inside1nm(component)
     component.auto_rename_ports()
+    xs = gf.get_cross_section(cross_section)
+    if xs.add_pins:
+        xs.add_pins(component)
     return component
 
 
 if __name__ == "__main__":
+    import gdsfactory as gf
+
+    pdk = gf.pdk.get_active_pdk()
+    pdk.gds_write_settings.flatten_invalid_refs = False
     c = big_device()
     c = gf.routing.add_fiber_array(c)
-    c.show(show_ports=True)
+    # c.write_gds("./test.gds")
+    c.show(show_ports=False)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/benchmark/fill_demo.py` & `gdsfactory-7.0.0/gdsfactory/samples/demo/benchmark/fill_demo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/mask.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/mask.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml` & `gdsfactory-7.0.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/drc_errors.py` & `gdsfactory-7.0.0/gdsfactory/samples/demo/drc_errors.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+"""Write GDS with sample errors."""
 from __future__ import annotations
 
 import gdsfactory as gf
 from gdsfactory.component import Component
 from gdsfactory.typings import Float2, Layer
 
 layer = gf.LAYER.WG
@@ -67,22 +68,22 @@
     return c
 
 
 @gf.cell
 def errors() -> Component:
     components = [width_min(), gap_min(), separation(), enclosing()]
     c = gf.pack(components, spacing=1.5)
-    return c[0]
+    c = gf.add_padding_container(c[0], layers=(gf.LAYER.FLOORPLAN,), default=5)
+    return c
 
 
 if __name__ == "__main__":
     # c = width_min()
     # c.write_gds("wmin.gds")
     # c = gap_min()
     # c.write_gds("gmin.gds")
     # c = snapping_error()
     # c.write_gds("snap.gds")
 
     c = errors()
-    c = gf.add_padding_container(c, layers=(gf.LAYER.FLOORPLAN,), default=5)
     c.write_gds("errors.gds")
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/drc_write.py` & `gdsfactory-7.0.0/gdsfactory/samples/demo/drc_write.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,25 +1,22 @@
+"""Sample DRC deck for the generic PDK."""
 from __future__ import annotations
 
-import pathlib
-
 import gdsfactory as gf
 from gdsfactory.geometry.write_drc import (
     rule_area,
     rule_density,
     rule_enclosing,
     rule_separation,
     rule_space,
     rule_width,
     write_drc_deck_macro,
 )
 
 if __name__ == "__main__":
-    filepath = pathlib.Path(__file__).parent.absolute() / "generic.lydrc"
-
     rules = [
         rule_width(layer="WG", value=0.2),
         rule_space(layer="WG", value=0.2),
         rule_width(layer="M1", value=1),
         rule_width(layer="M2", value=2),
         rule_space(layer="M2", value=2),
         rule_separation(layer1="HEATER", layer2="M1", value=1.0),
@@ -27,9 +24,12 @@
         rule_area(layer="WG", min_area_um2=0.05),
         rule_density(
             layer="WG", layer_floorplan="FLOORPLAN", min_density=0.5, max_density=0.6
         ),
     ]
 
     drc_rule_deck = write_drc_deck_macro(
-        rules=rules, layers=gf.LAYER, shortcut="Ctrl+Shift+D", filepath=filepath
+        rules=rules,
+        layers=gf.LAYER,
+        shortcut="Ctrl+Shift+D",
     )
+    print(drc_rule_deck)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/layers.py` & `gdsfactory-7.0.0/gdsfactory/samples/demo/layers.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,20 +1,19 @@
 """Technology settings."""
 from __future__ import annotations
 
 import pathlib
-from typing import Tuple, Union
 
 from pydantic import BaseModel
 
 from gdsfactory.technology import LayerLevel, LayerStack
 
 module_path = pathlib.Path(__file__).parent.absolute()
-Layer = Tuple[int, int]
-LayerSpec = Union[int, Layer, str, None]
+Layer = tuple[int, int]
+LayerSpec = int | Layer | str | None
 nm = 1e-3
 
 
 class LayerMap(BaseModel):
     """Generic layermap based on book.
 
     Lukas Chrostowski, Michael Hochberg, "Silicon Photonics Design",
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/lvs.py` & `gdsfactory-7.0.0/gdsfactory/samples/demo/lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/demo/pcell.py` & `gdsfactory-7.0.0/gdsfactory/samples/demo/pcell.py`

 * *Files 19% similar despite different names*

```diff
@@ -14,10 +14,10 @@
     bend.connect("o1", mzi.ports["o2"])
     c.add_port("o1", port=mzi.ports["o1"])
     c.add_port("o2", port=bend.ports["o2"])
     return c
 
 
 if __name__ == "__main__":
-    c = mzi_with_bend(radius=25)
+    c = mzi_with_bend(radius=50)
     # c = gf.routing.add_fiber_single(c)
     c.show(show_ports=True)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/netlists/mzi.yml` & `gdsfactory-7.0.0/gdsfactory/samples/netlists/mzi.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/netlists/mzi_full.yml` & `gdsfactory-7.0.0/gdsfactory/samples/netlists/mzi_full.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/fab_c.py` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/fab_c.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 """FabC example."""
 
 from __future__ import annotations
 
 import pathlib
-from typing import Callable
+from collections.abc import Callable
+from functools import partial
 
 from pydantic import BaseModel
 
 import gdsfactory as gf
 from gdsfactory.add_pins import add_pin_rectangle_inside
 from gdsfactory.component import Component
 from gdsfactory.cross_section import strip
@@ -24,15 +25,15 @@
     PIN: Layer = (1, 10)
 
 
 LAYER = LayerMap()
 WIDTH_NITRIDE_OBAND = 0.9
 WIDTH_NITRIDE_CBAND = 1.0
 
-select_ports_optical = gf.partial(select_ports, layers_excluded=((100, 0),))
+select_ports_optical = partial(select_ports, layers_excluded=((100, 0),))
 
 
 def get_layer_stack_fab_c(thickness: float = 350.0) -> LayerStack:
     """Returns generic LayerStack."""
     return LayerStack(
         layers=dict(
             wg=LayerLevel(
@@ -76,69 +77,69 @@
             **kwargs,
         )
     return component
 
 
 # cross_sections
 
-xs_nc = gf.partial(
+xs_nc = partial(
     strip,
     width=WIDTH_NITRIDE_CBAND,
     layer=LAYER.WGN,
     bbox_layers=[LAYER.WGN_CLAD],
     bbox_offsets=[3],
     add_pins=add_pins,
 )
-xs_no = gf.partial(
+xs_no = partial(
     strip,
     width=WIDTH_NITRIDE_OBAND,
     layer=LAYER.WGN,
     bbox_layers=[LAYER.WGN_CLAD],
     bbox_offsets=[3],
     add_pins=add_pins,
 )
 
+cross_sections = dict(xs_nc=xs_nc, xs_no=xs_no)
+
 
 # LEAF COMPONENTS have pins
-bend_euler_nc = gf.partial(
-    gf.components.bend_euler, cross_section=xs_nc, with_bbox=True
-)
-straight_nc = gf.partial(gf.components.straight, cross_section=xs_nc, with_bbox=True)
-bend_euler_o = gf.partial(gf.components.bend_euler, cross_section=xs_no, with_bbox=True)
-straight_o = gf.partial(gf.components.straight, cross_section=xs_no, with_bbox=True)
+bend_euler_nc = partial(gf.components.bend_euler, cross_section=xs_nc, with_bbox=True)
+straight_nc = partial(gf.components.straight, cross_section=xs_nc, with_bbox=True)
+bend_euler_o = partial(gf.components.bend_euler, cross_section=xs_no, with_bbox=True)
+straight_o = partial(gf.components.straight, cross_section=xs_no, with_bbox=True)
 
-mmi1x2_nc = gf.partial(
+mmi1x2_nc = partial(
     gf.components.mmi1x2,
     width=WIDTH_NITRIDE_CBAND,
     width_mmi=3,
     cross_section=xs_nc,
 )
-mmi1x2_no = gf.partial(
+mmi1x2_no = partial(
     gf.components.mmi1x2,
     width=WIDTH_NITRIDE_OBAND,
     cross_section=xs_no,
 )
 
-gc_nc = gf.partial(
+gc_nc = partial(
     gf.components.grating_coupler_elliptical,
     grating_line_width=0.6,
     layer_slab=None,
     cross_section=xs_nc,
 )
 
 # HIERARCHICAL COMPONENTS made of leaf components
 
-mzi_nc = gf.partial(
+mzi_nc = partial(
     gf.components.mzi,
     cross_section=xs_nc,
     splitter=mmi1x2_nc,
     straight=straight_nc,
     bend=bend_euler_nc,
 )
-mzi_no = gf.partial(
+mzi_no = partial(
     gf.components.mzi,
     cross_section=xs_no,
     splitter=mmi1x2_no,
     straight=straight_o,
     bend=bend_euler_o,
 )
 
@@ -154,14 +155,16 @@
     gc_nc=gc_nc,
 )
 
 
 LAYER_STACK = get_layer_stack_fab_c()
 SPARAMETERS_PATH = pathlib.Path.home() / "fabc"
 
+pdk = gf.Pdk(name="fab_c_demopdk", cells=cells, cross_sections=cross_sections)
+
 
 if __name__ == "__main__":
     c1 = mmi1x2_nc()
     print(c1.name)
     # c1 = mmi1x2_nc()
     # d1 = c1.to_dict()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,9 +1,11 @@
 from __future__ import annotations
 
+from functools import partial
+
 import pydantic
 
 import gdsfactory as gf
 from gdsfactory.typings import Layer
 
 
 @pydantic.dataclasses.dataclass
@@ -14,61 +16,61 @@
     NPP: Layer = (5, 0)
     HEATER: Layer = (6, 0)
 
 
 LAYER = LayerMap()
 
 
-xs_strip = gf.partial(gf.cross_section.strip, layer=LAYER.WG, width=1)
+xs_strip = partial(gf.cross_section.strip, layer=LAYER.WG, width=1)
 
 
-xs_strip_heater_metal = gf.partial(
+xs_strip_heater_metal = partial(
     gf.cross_section.strip_heater_metal, layer=LAYER.WG, width=1
 )
-xs_rib_heater_doped = gf.partial(
+xs_rib_heater_doped = partial(
     gf.cross_section.rib_heater_doped, layer=LAYER.WG, width=1, layer_slab=LAYER.SLAB
 )
-xs_strip_heater_doped = gf.partial(
+xs_strip_heater_doped = partial(
     gf.cross_section.strip_heater_doped,
     layer=LAYER.WG,
     width=1,
     layers_heater=(LAYER.WG, LAYER.HEATER),
     bbox_offsets_heater=(0, 0.1),
 )
-xs_rib_pin = gf.partial(
+xs_rib_pin = partial(
     gf.cross_section.pin, layer=LAYER.WG, width=1, layer_slab=LAYER.SLAB
 )
 
 
-ps_heater_metal = gf.partial(
+ps_heater_metal = partial(
     gf.components.straight_heater_metal,
     cross_section_heater=xs_strip_heater_metal,
 )
-ps_heater_doped = gf.partial(
+ps_heater_doped = partial(
     gf.components.straight_heater_doped_strip,
     cross_section=xs_strip,
     cross_section_heater=xs_strip_heater_doped,
     info=dict(docstring="doping density = X", polarization="te", wavelength=1.55),
 )
-ps_pin = gf.partial(
+ps_pin = partial(
     gf.components.straight_pin,
     cross_section=xs_rib_pin,
 )
 
 
 component_factory = dict(
     ps_heater_metal=ps_heater_metal,
     ps_heater_doped=ps_heater_doped,
 )
 
 
 def write_library(component_factory, dirpath) -> None:
     for function in component_factory.values():
         component = function()
-        component.write_gds_with_metadata(gdsdir=dirpath)
+        component.write_gds(gdsdir=dirpath, with_metadata=True)
 
 
 if __name__ == "__main__":
     # import pathlib
     # write_library(component_factory=component_factory, dirpath=pathlib.Path.cwd())
 
     c = ps_heater_doped()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c.py` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c.py`

 * *Files 9% similar despite different names*

```diff
@@ -3,14 +3,15 @@
 In gdsfactory we use gdslib as a place to store the GDS files.
 
 For your PDK i recommend that you store the store the reference GDS files on
 the same repo as you store the code. See code below
 
 ```
 from __future__ import annotations
+from functools import partial
 import pathlib
 
 dirpath = pathlib.Path(__file__).absolute().with_suffix(".gds")
 
 def test_gds(component_name: str) -> None:
     component = cells[component_name]()
     test_name = f"fabc_{component_name}"
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml`

 * *Files 6% similar despite different names*

```diff
@@ -1,45 +1,48 @@
-name: bend_euler_af89db80
+name: bend_euler_e6ca1d65
 ports:
   o1:
     center:
     - 0.0
     - 0.0
     layer:
     - 34
     - 0
     name: o1
-    orientation: 180
+    orientation: 180.0
     port_type: optical
     shear_angle: null
     width: 1.0
   o2:
     center:
     - 10.0
     - 10.0
     layer:
     - 34
     - 0
     name: o2
-    orientation: 90
+    orientation: 90.0
     port_type: optical
     shear_angle: null
     width: 1.0
 settings:
   changed:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
   child: null
   default:
@@ -51,21 +54,24 @@
     with_arc_floorplan: true
     with_bbox: true
   full:
     angle: 90.0
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
     direction: ccw
     npoints: null
@@ -75,14 +81,20 @@
   function_name: bend_euler
   info:
     dy: 10.0
     function_name: cross_section
     length: 16.637
     radius: 10.0
     radius_min: 7.061
+    route_info:
+      length: 16.637
+      n_bend_90: 1.0
+      strip_length: 16.637
+      type: strip
+      weight: 16.637
     settings:
       add_bbox: null
       add_pins:
         function: add_pins
       auto_widen: false
       auto_widen_minimum_length: 200.0
       bbox_layers:
@@ -92,15 +104,16 @@
       - 3
       cladding_layers: null
       cladding_offsets: null
       cladding_simplify: null
       decorator: null
       end_straight_length: 0.01
       gap: 3.0
-      info: null
+      info:
+        type: strip
       layer:
       - 34
       - 0
       min_length: 0.01
       mirror: false
       name: strip
       offset: 0
@@ -113,11 +126,12 @@
       radius: 10.0
       sections: null
       snap_to_grid: null
       start_straight_length: 0.01
       taper_length: 10.0
       width: 1.0
       width_wide: null
+    type: strip
     width: 1.0
   info_version: 2
   module: gdsfactory.components.bend_euler
-  name: bend_euler_af89db80
+  name: bend_euler_e6ca1d65
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml`

 * *Files 8% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-name: grating_coupler_ellipti_9a60b03b
+name: grating_coupler_ellipti_23f761ec
 ports:
   o1:
     center:
     - 0.0
     - 0.0
     layer:
     - 34
@@ -25,21 +25,24 @@
     shear_angle: null
     width: 10
 settings:
   changed:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
     grating_line_width: 0.6
     layer_slab: null
@@ -61,21 +64,24 @@
     taper_length: 16.6
     wavelength: 1.554
   full:
     big_last_tooth: false
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
     fiber_angle: 15.0
     grating_line_width: 0.6
@@ -92,8 +98,8 @@
     wavelength: 1.554
   function_name: grating_coupler_elliptical
   info:
     polarization: te
     wavelength: 1.554
   info_version: 2
   module: gdsfactory.components.grating_coupler_elliptical
-  name: grating_coupler_ellipti_9a60b03b
+  name: grating_coupler_ellipti_23f761ec
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml`

 * *Files 7% similar despite different names*

```diff
@@ -1,99 +1,108 @@
-name: mmi1x2_b84370c5
+name: mmi1x2_d48e5220
 ports:
   o1:
     center:
     - -10.0
     - 0.0
     layer:
     - 34
     - 0
     name: o1
-    orientation: 180
+    orientation: 180.0
     port_type: optical
     shear_angle: null
-    width: 1.0
+    width: 0.9
   o2:
     center:
     - 15.5
     - 0.625
     layer:
     - 34
     - 0
     name: o2
     orientation: 0.0
     port_type: optical
     shear_angle: null
-    width: 1.0
+    width: 0.9
   o3:
     center:
     - 15.5
     - -0.625
     layer:
     - 34
     - 0
     name: o3
     orientation: 0.0
     port_type: optical
     shear_angle: null
-    width: 1.0
+    width: 0.9
 settings:
   changed:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
-        width: 1.0
-    width: 1.0
-    width_mmi: 3
+        width: 0.9
+    width: 0.9
   child: null
   default:
     cross_section: strip
     gap_mmi: 0.25
     length_mmi: 5.5
     length_taper: 10.0
+    straight:
+      function: straight
     taper:
       function: taper
     width: null
     width_mmi: 2.5
     width_taper: 1.0
     with_bbox: true
   full:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
-        width: 1.0
+        width: 0.9
     gap_mmi: 0.25
     length_mmi: 5.5
     length_taper: 10.0
+    straight:
+      function: straight
     taper:
       function: taper
-    width: 1.0
-    width_mmi: 3
+    width: 0.9
+    width_mmi: 2.5
     width_taper: 1.0
     with_bbox: true
   function_name: mmi1x2
   info: {}
   info_version: 2
   module: gdsfactory.components.mmi1x2
-  name: mmi1x2_b84370c5
+  name: mmi1x2_d48e5220
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml`

 * *Files 10% similar despite different names*

```diff
@@ -1,98 +1,109 @@
-name: mmi1x2_fc7db243
+name: mmi1x2_d6895fd3
 ports:
   o1:
     center:
     - -10.0
     - 0.0
     layer:
     - 34
     - 0
     name: o1
-    orientation: 180
+    orientation: 180.0
     port_type: optical
     shear_angle: null
-    width: 0.9
+    width: 1.0
   o2:
     center:
     - 15.5
     - 0.625
     layer:
     - 34
     - 0
     name: o2
     orientation: 0.0
     port_type: optical
     shear_angle: null
-    width: 0.9
+    width: 1.0
   o3:
     center:
     - 15.5
     - -0.625
     layer:
     - 34
     - 0
     name: o3
     orientation: 0.0
     port_type: optical
     shear_angle: null
-    width: 0.9
+    width: 1.0
 settings:
   changed:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
-        width: 0.9
-    width: 0.9
+        width: 1.0
+    width: 1.0
+    width_mmi: 3
   child: null
   default:
     cross_section: strip
     gap_mmi: 0.25
     length_mmi: 5.5
     length_taper: 10.0
+    straight:
+      function: straight
     taper:
       function: taper
     width: null
     width_mmi: 2.5
     width_taper: 1.0
     with_bbox: true
   full:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
-        width: 0.9
+        width: 1.0
     gap_mmi: 0.25
     length_mmi: 5.5
     length_taper: 10.0
+    straight:
+      function: straight
     taper:
       function: taper
-    width: 0.9
-    width_mmi: 2.5
+    width: 1.0
+    width_mmi: 3
     width_taper: 1.0
     with_bbox: true
   function_name: mmi1x2
   info: {}
   info_version: 2
   module: gdsfactory.components.mmi1x2
-  name: mmi1x2_fc7db243
+  name: mmi1x2_d6895fd3
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml`

 * *Files 13% similar despite different names*

```diff
@@ -1,18 +1,18 @@
-name: mzi_6cace905
+name: mzi_91c47883
 ports:
   o1:
     center:
     - -10.0
     - 0.0
     layer:
     - 34
     - 0
     name: o1
-    orientation: 180
+    orientation: 180.0
     port_type: optical
     shear_angle: null
     width: 1.0
   o2:
     center:
     - 81.12
     - 0.0
@@ -28,75 +28,87 @@
   changed:
     bend:
       function: bend_euler
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 1.0
         with_bbox: true
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
     splitter:
       function: mmi1x2
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 1.0
         width: 1.0
         width_mmi: 3
     straight:
       function: straight
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 1.0
         with_bbox: true
   child: null
@@ -128,38 +140,44 @@
     add_optical_ports_arms: false
     bend:
       function: bend_euler
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 1.0
         with_bbox: true
     combiner: null
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
     cross_section_x_bot: null
     cross_section_x_top: null
@@ -174,49 +192,55 @@
     port_e1_splitter: o2
     splitter:
       function: mmi1x2
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 1.0
         width: 1.0
         width_mmi: 3
     straight:
       function: straight
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 1.0
         with_bbox: true
     straight_x_bot: null
     straight_x_top: null
     straight_y: null
     with_splitter: true
   function_name: mzi
   info: {}
   info_version: 2
   module: gdsfactory.components.mzi
-  name: mzi_6cace905
+  name: mzi_91c47883
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml`

 * *Files 11% similar despite different names*

```diff
@@ -1,18 +1,18 @@
-name: mzi_435017ce
+name: mzi_bdb841e1
 ports:
   o1:
     center:
     - -10.0
     - 0.0
     layer:
     - 34
     - 0
     name: o1
-    orientation: 180
+    orientation: 180.0
     port_type: optical
     shear_angle: null
     width: 0.9
   o2:
     center:
     - 81.12
     - 0.0
@@ -28,74 +28,86 @@
   changed:
     bend:
       function: bend_euler
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 0.9
         with_bbox: true
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 0.9
     splitter:
       function: mmi1x2
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 0.9
         width: 0.9
     straight:
       function: straight
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 0.9
         with_bbox: true
   child: null
@@ -127,38 +139,44 @@
     add_optical_ports_arms: false
     bend:
       function: bend_euler
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 0.9
         with_bbox: true
     combiner: null
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 0.9
     cross_section_x_bot: null
     cross_section_x_top: null
@@ -173,48 +191,54 @@
     port_e1_splitter: o2
     splitter:
       function: mmi1x2
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 0.9
         width: 0.9
     straight:
       function: straight
       settings:
         cross_section:
           function: cross_section
           settings:
+            add_bbox: null
             add_pins:
               function: add_pins
             bbox_layers:
             - - 36
               - 0
             bbox_offsets:
             - 3
+            info:
+              type: strip
             layer:
             - 34
             - 0
             name: strip
             width: 0.9
         with_bbox: true
     straight_x_bot: null
     straight_x_top: null
     straight_y: null
     with_splitter: true
   function_name: mzi
   info: {}
   info_version: 2
   module: gdsfactory.components.mzi
-  name: mzi_435017ce
+  name: mzi_bdb841e1
```

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.99.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml` & `gdsfactory-7.0.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml`

 * *Files 14% similar despite different names*

```diff
@@ -1,18 +1,18 @@
-name: straight_af89db80
+name: straight_e6ca1d65
 ports:
   o1:
     center:
     - 0.0
     - 0.0
     layer:
     - 34
     - 0
     name: o1
-    orientation: 180
+    orientation: 180.0
     port_type: optical
     shear_angle: null
     width: 1.0
   o2:
     center:
     - 10.0
     - 0.0
@@ -25,21 +25,24 @@
     shear_angle: null
     width: 1.0
 settings:
   changed:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
   child: null
   default:
@@ -47,48 +50,59 @@
     length: 10.0
     npoints: 2
     with_bbox: true
   full:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
     length: 10.0
     npoints: 2
     with_bbox: true
   function_name: straight
   info:
     cross_section:
       function: cross_section
       settings:
+        add_bbox: null
         add_pins:
           function: add_pins
         bbox_layers:
         - - 36
           - 0
         bbox_offsets:
         - 3
+        info:
+          type: strip
         layer:
         - 34
         - 0
         name: strip
         width: 1.0
     function_name: cross_section
     length: 10.0
+    route_info:
+      length: 10.0
+      strip_length: 10.0
+      type: strip
+      weight: 10.0
     settings:
       add_bbox: null
       add_pins:
         function: add_pins
       auto_widen: false
       auto_widen_minimum_length: 200.0
       bbox_layers:
@@ -98,15 +112,16 @@
       - 3
       cladding_layers: null
       cladding_offsets: null
       cladding_simplify: null
       decorator: null
       end_straight_length: 0.01
       gap: 3.0
-      info: null
+      info:
+        type: strip
       layer:
       - 34
       - 0
       min_length: 0.01
       mirror: false
       name: strip
       offset: 0
@@ -119,11 +134,12 @@
       radius: 10.0
       sections: null
       snap_to_grid: null
       start_straight_length: 0.01
       taper_length: 10.0
       width: 1.0
       width_wide: null
+    type: strip
     width: 1.0
   info_version: 2
   module: gdsfactory.components.straight
-  name: straight_af89db80
+  name: straight_e6ca1d65
```

### Comparing `gdsfactory-6.99.0/gdsfactory/serialization.py` & `gdsfactory-7.0.0/gdsfactory/serialization.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,28 +1,29 @@
 """Serialize component settings into YAML or strings."""
 from __future__ import annotations
 
 import functools
 import hashlib
 import inspect
 import pathlib
-from typing import Any, Dict
+from functools import partial
+from typing import Any
 
 import gdstk
 import numpy as np
 import orjson
 import pydantic
 import toolz
 from omegaconf import DictConfig, OmegaConf
 
 DEFAULT_SERIALIZATION_MAX_DIGITS = 3
 """By default, the maximum number of digits retained when serializing float-like arrays"""
 
 
-def clean_dict(d: Dict[str, Any]) -> Dict[str, Any]:
+def clean_dict(d: dict[str, Any]) -> dict[str, Any]:
     """Cleans dictionary recursively."""
     return {
         k: clean_dict(dict(v)) if isinstance(v, dict) else clean_value_json(v)
         for k, v in d.items()
     }
 
 
@@ -36,28 +37,32 @@
         raise e
     return s
 
 
 def clean_value_json(value: Any) -> Any:
     """Return JSON serializable object."""
     from gdsfactory.path import Path
+    from gdsfactory.pdk import get_active_pdk
+
+    active_pdk = get_active_pdk()
+    include_module = active_pdk.cell_decorator_settings.include_module
 
     if isinstance(value, pydantic.BaseModel):
         return clean_dict(value.dict())
 
     elif hasattr(value, "get_component_spec"):
         return value.get_component_spec()
 
     elif isinstance(value, bool):
         return value
 
-    elif isinstance(value, (np.integer, int)):
+    elif isinstance(value, np.integer | int):
         return int(value)
 
-    elif isinstance(value, (float, np.inexact, np.float64)):
+    elif isinstance(value, float | np.inexact | np.float64):
         return float(np.round(value, DEFAULT_SERIALIZATION_MAX_DIGITS))
 
     elif isinstance(value, np.ndarray):
         value = np.round(value, DEFAULT_SERIALIZATION_MAX_DIGITS)
         return orjson.loads(orjson.dumps(value, option=orjson.OPT_SERIALIZE_NUMPY))
     elif callable(value) and isinstance(value, functools.partial):
         sig = inspect.signature(value.func)
@@ -65,35 +70,45 @@
         args_as_kwargs.update(**value.keywords)
         args_as_kwargs = clean_dict(args_as_kwargs)
         # args_as_kwargs.pop("function", None)
 
         func = value.func
         while hasattr(func, "func"):
             func = func.func
-        return {"function": func.__name__, "settings": args_as_kwargs}
+        v = {
+            "function": func.__name__,
+            "settings": args_as_kwargs,
+        }
+        if include_module:
+            v.update(module=func.__module__)
+        return v
 
     elif hasattr(value, "to_dict"):
         # print(type(value))
         return clean_dict(value.to_dict())
     elif callable(value) and isinstance(value, toolz.functoolz.Compose):
         value = [clean_value_json(value.first)] + [
             clean_value_json(func) for func in value.funcs
         ]
     elif callable(value) and hasattr(value, "__name__"):
-        value = {"function": value.__name__}
+        value = (
+            {"function": value.__name__, "module": value.__module__}
+            if include_module
+            else {"function": value.__name__}
+        )
     elif isinstance(value, Path):
         value = value.hash_geometry()
     elif isinstance(value, pathlib.Path):
         value = value.stem
     elif isinstance(value, dict):
         value = clean_dict(value.copy())
     elif isinstance(value, DictConfig):
         value = clean_dict(OmegaConf.to_container(value))
 
-    elif isinstance(value, (list, tuple, set)):
+    elif isinstance(value, list | tuple | set):
         value = [clean_value_json(i) for i in value]
 
     elif isinstance(value, gdstk.Polygon):
         value = np.round(value.points, DEFAULT_SERIALIZATION_MAX_DIGITS)
     else:
         try:
             value_json = orjson.dumps(
@@ -126,21 +141,20 @@
 def get_hash(value: Any) -> str:
     return hashlib.md5((clean_value_name(value)).encode()).hexdigest()[:8]
 
 
 if __name__ == "__main__":
     import gdsfactory as gf
 
-    # f = gf.partial(gf.c.straight, length=3)
+    # f = partial(gf.c.straight, length=3)
     # d = clean_value_json(f)
     # print(f"{d!r}")
-
-    # f = gf.partial(gf.c.straight, length=3)
+    # f = partial(gf.c.straight, length=3)
     # c = f()
     # d = clean_value_json(c)
     # print(d, d)
 
-    f = gf.partial(gf.cross_section.strip, width=3)
+    f = partial(gf.cross_section.strip, width=3)
     c = f()
     d = clean_value_json(c)
     print(get_hash(d))
     print(d, d)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/show.py` & `gdsfactory-7.0.0/gdsfactory/show.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,19 +1,18 @@
 from __future__ import annotations
 
 import pathlib
-from typing import Union, Optional
 
 from gdsfactory import klive
 from gdsfactory.component import Component
 
 
 def show(
-    component: Union[Component, str, pathlib.Path],
-    technology: Optional[str] = None,
+    component: Component | str | pathlib.Path,
+    technology: str | None = None,
     **kwargs,
 ) -> None:
     """Write GDS and show Component in KLayout.
 
     Args:
         component: Component or GDS path.
         technology: Name of KLayout technology to load when displaying component.
```

### Comparing `gdsfactory-6.99.0/gdsfactory/snap.py` & `gdsfactory-7.0.0/gdsfactory/snap.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,12 +1,10 @@
 """snaps values and coordinates to the GDS grid in nm."""
 from __future__ import annotations
 
-from typing import Optional, Tuple, Union
-
 import numpy as np
 
 
 def is_on_grid(x: float, nm: int = 1) -> bool:
     return np.array_equal(snap_to_grid(x, nm=nm), np.round(x, 6))
 
 
@@ -19,16 +17,16 @@
 def assert_on_2nm_grid(x: float) -> None:
     x_grid = snap_to_2nm_grid(x)
     if not np.isclose(x_grid, x):
         raise ValueError(f"{x} needs to be on 2nm grid, try {x_grid}")
 
 
 def snap_to_grid(
-    x: Union[float, Tuple, np.ndarray], nm: Optional[int] = None
-) -> Union[float, Tuple, np.ndarray]:
+    x: float | tuple | np.ndarray, nm: int | None = None
+) -> float | tuple | np.ndarray:
     if nm is None:
         from gdsfactory.pdk import get_grid_size
 
         nm = int(get_grid_size() * 1000)
     elif nm == 0:
         return x
     elif nm < 0:
@@ -36,15 +34,15 @@
 
     if nm == 1:
         y = np.round(np.asarray(x, dtype=float), 3)
     else:
         y = nm * np.round(np.asarray(x, dtype=float) * 1e3 / nm) / 1e3
     if isinstance(x, tuple):
         return tuple(y)
-    elif isinstance(x, (int, float, str, np.float_)):
+    elif isinstance(x, int | float | str | np.float_):
         return float(y)
     return y
 
 
 def snap_to_2nm_grid(x: float) -> float:
     return snap_to_grid(x, nm=2)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/symbols.py` & `gdsfactory-7.0.0/gdsfactory/symbols.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from __future__ import annotations
 
 import functools
-from typing import Callable
+from collections.abc import Callable
 
 import gdstk
 from pydantic import validate_arguments
 
 from gdsfactory.cell import _F, cell_without_validator
 from gdsfactory.component import Component
 from gdsfactory.typings import LayerSpecs
```

### Comparing `gdsfactory-6.99.0/gdsfactory/technology/klayout_tech.py` & `gdsfactory-7.0.0/gdsfactory/technology/klayout_tech.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,24 +1,23 @@
 """Classes and utils for working with KLayout technology files (.lyp, .lyt).
 
 This module enables conversion between gdsfactory settings and KLayout technology.
 """
 
 import pathlib
 import xml.etree.ElementTree as ET
-from typing import List, Optional, Tuple, Dict
 
 from pydantic import BaseModel, Field
 
 from gdsfactory.config import PATH
-from gdsfactory.technology import LayerViews, LayerStack
+from gdsfactory.technology import LayerStack, LayerViews
 from gdsfactory.typings import PathType
 
-Layer = Tuple[int, int]
-ConductorViaConductorName = Tuple[str, str, str]
+Layer = tuple[int, int]
+ConductorViaConductorName = tuple[str, str, str]
 
 prefix_d25 = """<?xml version="1.0" encoding="utf-8"?>
 <klayout-macro>
  <description/>
  <version/>
  <category>d25</category>
  <prolog/>
@@ -56,39 +55,39 @@
     """
 
     # TODO: Add import method
     # TODO: Also interop with xs scripts?
     import klayout.db as db
 
     name: str
-    layer_map: Dict[str, Layer]
-    layer_views: Optional[LayerViews] = None
-    layer_stack: Optional[LayerStack] = None
+    layer_map: dict[str, Layer]
+    layer_views: LayerViews | None = None
+    layer_stack: LayerStack | None = None
     technology: db.Technology = Field(default_factory=db.Technology)
-    connectivity: Optional[List[ConductorViaConductorName]] = None
+    connectivity: list[ConductorViaConductorName] | None = None
 
     def write_tech(
         self,
         tech_dir: PathType,
         lyp_filename: str = "layers.lyp",
         lyt_filename: str = "tech.lyt",
-        d25_filename: Optional[str] = None,
-        mebes_config: Optional[dict] = None,
+        d25_filename: str | None = None,
+        mebes_config: dict | None = None,
     ) -> None:
         """Write technology files into 'tech_dir'.
 
         Args:
             tech_dir: Where to write the technology files to.
             lyp_filename: Name of the layer properties file.
             lyt_filename: Name of the layer technology file.
             d25_filename: Name of the 2.5D stack file (only works on KLayout >= 0.28). Defaults to self.name.
             mebes_config: A dictionary specifying the KLayout mebes reader config.
 
         """
-        from gdsfactory.utils.xml_utils import make_pretty_xml
+        from gdsfactory.technology.xml_utils import make_pretty_xml
 
         d25_filename = d25_filename or f"{self.name}.lyd25"
 
         tech_path = pathlib.Path(tech_dir)
         lyp_path = tech_path / lyp_filename
         lyt_path = tech_path / lyt_filename
         d25_path = tech_path / "d25" / d25_filename
@@ -199,15 +198,15 @@
     lyp_loaded = LayerViews.from_yaml(layer_yaml)
     print("Loaded from .yaml", lyp_loaded)
 
     assert lyp_loaded == lyp
 
 
 if __name__ == "__main__":
-    from gdsfactory.generic_tech import LAYER_STACK, LAYER
+    from gdsfactory.generic_tech import LAYER, LAYER_STACK
 
     lyp = LayerViews(PATH.klayout_yaml)
     # lyp = LayerViews.from_lyp(str(PATH.klayout_yaml))
 
     # str_xml = open(PATH.klayout_tech / "tech.lyt").read()
     # new_tech = db.Technology.technology_from_xml(str_xml)
     # generic_tech = KLayoutTechnology(layer_views=lyp)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/technology/layer_map.py` & `gdsfactory-7.0.0/gdsfactory/technology/layer_map.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,16 +1,13 @@
 import pathlib
-from typing import Union
 
 from gdsfactory.technology.layer_views import LayerViews
 
 
-def lyp_to_dataclass(
-    lyp_filepath: Union[str, pathlib.Path], overwrite: bool = True
-) -> str:
+def lyp_to_dataclass(lyp_filepath: str | pathlib.Path, overwrite: bool = True) -> str:
     """Returns python LayerMap script from a klayout layer properties file lyp."""
     filepathin = pathlib.Path(lyp_filepath)
     filepathout = filepathin.with_suffix(".py")
 
     if filepathout.exists() and not overwrite:
         raise FileExistsError(f"You can delete {filepathout}")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/technology/layer_stack.py` & `gdsfactory-7.0.0/gdsfactory/technology/layer_stack.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,17 +1,15 @@
-from typing import Any, Dict, List, Optional, Tuple, Callable, Union
+import copy
 from collections import defaultdict
+from typing import Any, Literal
 
-from typing_extensions import Literal
 from pydantic import BaseModel, Field
 
 from gdsfactory.technology.layer_views import LayerViews
 
-MaterialSpec = Union[str, float, Tuple[float, float], Callable]
-
 
 class LayerLevel(BaseModel):
     """Level for 3D LayerStack.
 
     Parameters:
         layer: (GDSII Layer number, GDSII datatype).
         thickness: layer thickness in um.
@@ -38,54 +36,54 @@
         doping_concentration: for implants.
         resistivity: for metals.
         bias: in um for the etch. Can be a single number or 2 numbers (bias_x, bias_y)
         derived_layer: Optional derived layer, used for layer_type='etch' to define the slab.
         info: simulation_info and other types of metadata.
     """
 
-    layer: Optional[Tuple[int, int]]
+    layer: tuple[int, int] | None
     thickness: float
-    thickness_tolerance: Optional[float] = None
+    thickness_tolerance: float | None = None
     zmin: float
-    zmin_tolerance: Optional[float] = None
-    material: Optional[str] = None
+    zmin_tolerance: float | None = None
+    material: str | None = None
     sidewall_angle: float = 0.0
-    sidewall_angle_tolerance: Optional[float] = None
+    sidewall_angle_tolerance: float | None = None
     width_to_z: float = 0.0
-    z_to_bias: Optional[Tuple[List[float], List[float]]] = None
+    z_to_bias: tuple[list[float], list[float]] | None = None
     mesh_order: int = 3
     layer_type: Literal["grow", "etch", "implant", "background"] = "grow"
-    mode: Optional[Literal["octagon", "taper", "round"]] = None
-    into: Optional[List[str]] = None
-    doping_concentration: Optional[float] = None
-    resistivity: Optional[float] = None
-    bias: Optional[Union[Tuple[float, float], float]] = None
-    derived_layer: Optional[Tuple[int, int]] = None
-    info: Dict[str, Any] = {}
+    mode: Literal["octagon", "taper", "round"] | None = None
+    into: list[str] | None = None
+    doping_concentration: float | None = None
+    resistivity: float | None = None
+    bias: tuple[float, float] | float | None = None
+    derived_layer: tuple[int, int] | None = None
+    info: dict[str, Any] = {}
 
 
 class LayerStack(BaseModel):
     """For simulation and 3D rendering.
 
     Parameters:
         layers: dict of layer_levels.
     """
 
-    layers: Optional[Dict[str, LayerLevel]] = Field(default_factory=dict)
+    layers: dict[str, LayerLevel] | None = Field(default_factory=dict)
 
     def __init__(self, **data: Any) -> None:
         """Add LayerLevels automatically for subclassed LayerStacks."""
         super().__init__(**data)
 
         for field in self.dict():
             val = getattr(self, field)
             if isinstance(val, LayerLevel):
                 self.layers[field] = val
 
-    def get_layer_to_thickness(self) -> Dict[Tuple[int, int], float]:
+    def get_layer_to_thickness(self) -> dict[tuple[int, int], float]:
         """Returns layer tuple to thickness (um)."""
         layer_to_thickness = {}
 
         for level in self.layers.values():
             layer = level.layer
 
             if layer and level.thickness:
@@ -171,55 +169,103 @@
             )
             component_derived.add(unetched_polys)
 
         component_derived.add_ports(component.ports)
         component_derived.name = f"{component.name}_derived_layers"
         return component_derived
 
-    def get_layer_to_zmin(self) -> Dict[Tuple[int, int], float]:
+    def get_component_with_net_layers(
+        self,
+        component,
+        portnames: list[str],
+        delimiter: str = "#",
+        new_layers_init: tuple[int, int] = (10010, 0),
+    ):
+        """Returns component with new layers that combine port names and original layers, and modifies the layerstack accordingly.
+
+        Uses port's "layer" attribute to decide which polygons need to be renamed. New layers are named "layername{delimiter}portname".
+
+        Arguments
+            component: to process
+            portnames: list of portnames to process into new layers.
+            delimiter: the new layer created is called "layername{delimiter}portname"
+            new_layers_init: nitial layer number for the temporary new layers.
+        """
+        import gdstk
+
+        # Initialize returned component
+        net_component = component.copy()
+
+        # For each port to consider, convert relevant polygons
+        for i, portname in enumerate(portnames):
+            port = component.ports[portname]
+            # Get original port layer polygons, and modify a new component without that layer
+            polygons = net_component.extract(layers=[port.layer]).get_polygons()
+            net_component = net_component.remove_layers(layers=[port.layer])
+            for polygon in polygons:
+                # If polygon belongs to port, create a unique new layer, and add the polygon to it
+                if gdstk.inside([port.center], gdstk.Polygon(polygon))[0]:
+                    old_layername = self.get_layer_to_layername()[port.layer]
+                    new_layer = copy.deepcopy(self.layers[old_layername])
+                    new_layer.layer = (new_layers_init[0] + i, new_layers_init[1])
+                    self.layers[f"{old_layername}{delimiter}{portname}"] = new_layer
+                    net_component.add_polygon(polygon, layer=new_layer.layer)
+                # Otherwise put the polygon back on the same layer
+                else:
+                    net_component.add_polygon(polygon, layer=port.layer)
+
+        net_component.name = f"{component.name}_net_layers"
+
+        return net_component
+
+    def get_layer_to_zmin(self) -> dict[tuple[int, int], float]:
         """Returns layer tuple to z min position (um)."""
         return {
             level.layer: level.zmin for level in self.layers.values() if level.thickness
         }
 
-    def get_layer_to_material(self) -> Dict[Tuple[int, int], str]:
+    def get_layer_to_material(self) -> dict[tuple[int, int], str]:
         """Returns layer tuple to material name."""
         return {
             level.layer: level.material
             for level in self.layers.values()
             if level.thickness
         }
 
-    def get_layer_to_sidewall_angle(self) -> Dict[Tuple[int, int], str]:
+    def get_layer_to_sidewall_angle(self) -> dict[tuple[int, int], str]:
         """Returns layer tuple to material name."""
         return {
             level.layer: level.sidewall_angle
             for level in self.layers.values()
             if level.thickness
         }
 
-    def get_layer_to_info(self) -> Dict[Tuple[int, int], Dict]:
+    def get_layer_to_info(self) -> dict[tuple[int, int], dict]:
         """Returns layer tuple to info dict."""
         return {level.layer: level.info for level in self.layers.values()}
 
-    def to_dict(self) -> Dict[str, Dict[str, Any]]:
+    def get_layer_to_layername(self) -> dict[tuple[int, int], str]:
+        """Returns layer tuple to layername."""
+        return {level.layer: level_name for level_name, level in self.layers.items()}
+
+    def to_dict(self) -> dict[str, dict[str, Any]]:
         return {level_name: dict(level) for level_name, level in self.layers.items()}
 
     def __getitem__(self, key) -> LayerLevel:
         """Access layer stack elements."""
         if key not in self.layers:
             layers = list(self.layers.keys())
             raise ValueError(f"{key!r} not in {layers}")
 
         return self.layers[key]
 
     def get_klayout_3d_script(
         self,
-        layer_views: Optional[LayerViews] = None,
-        dbu: Optional[float] = 0.001,
+        layer_views: LayerViews | None = None,
+        dbu: float | None = 0.001,
     ) -> str:
         """Returns script for 2.5D view in KLayout.
 
         You can include this information in your tech.lyt
 
         Args:
             layer_views: optional layer_views.
@@ -377,52 +423,73 @@
             out += f"{txt}\n"
 
         return out
 
     def filtered(self, layers):
         return type(self)(layers={k: self.layers[k] for k in layers})
 
+    def filtered_from_layerspec(self, layerspecs):
+        """Filtered layerstack, given LayerSpec input."""
+        layers_to_layername = self.get_layer_to_layername()
+        layers = [
+            layers_to_layername[layer]
+            for layer in layerspecs
+            if layer in layers_to_layername
+        ]
+        return self.filtered(layers)
+
 
 if __name__ == "__main__":
-    from gdsfactory.technology.klayout_tech import KLayoutTechnology
-    from gdsfactory.config import PATH
+    import gdsfactory as gf
+    from gdsfactory.generic_tech import get_generic_pdk
+
+    PDK = get_generic_pdk()
+    PDK.activate()
+
+    from gdsfactory.generic_tech import LAYER_STACK
+
+    layer_stack = LAYER_STACK
+
+    # c = gf.components.straight_heater_metal()
+
+    c = layer_stack.get_component_with_net_layers(
+        gf.components.straight_heater_metal(), portnames=["r_e2", "l_e4"]
+    )
+    print(layer_stack.layers.keys())
+
+    c.show()
 
     # import gdsfactory as gf
     # from gdsfactory.generic_tech import LAYER_STACK
-
     # component = c = gf.components.grating_coupler_elliptical_trenches()
     # component = c = gf.components.taper_strip_to_ridge_trenches()
-
     # script = LAYER_STACK.get_klayout_3d_script()
     # print(script)
-
     # ls = layer_stack = LAYER_STACK
     # layer_to_thickness = layer_stack.get_layer_to_thickness()
-
     # c = layer_stack.get_component_with_derived_layers(component)
     # c.show(show_ports=True)
-
     # import pathlib
     # filepath = pathlib.Path(
     #     "/home/jmatres/gdslib/sp/temp/write_sparameters_meep_mpi.json"
     # )
     # ls_json = filepath.read_bytes()
     # ls2 = LayerStack.parse_raw(ls_json)
+    # from gdsfactory.generic_tech import LAYER_STACK
+    # from gdsfactory.technology.klayout_tech import KLayoutTechnology
 
-    from gdsfactory.generic_tech import LAYER_STACK
-
-    lyp = LayerViews.from_lyp(str(PATH.klayout_lyp))
+    # lyp = LayerViews.from_lyp(str(PATH.klayout_lyp))
 
-    # str_xml = open(PATH.klayout_tech / "tech.lyt").read()
-    # new_tech = db.Technology.technology_from_xml(str_xml)
-    # generic_tech = KLayoutTechnology(layer_views=lyp)
-    connectivity = [("M1", "VIA1", "M2"), ("M2", "VIA2", "M3")]
+    # # str_xml = open(PATH.klayout_tech / "tech.lyt").read()
+    # # new_tech = db.Technology.technology_from_xml(str_xml)
+    # # generic_tech = KLayoutTechnology(layer_views=lyp)
+    # connectivity = [("M1", "VIA1", "M2"), ("M2", "VIA2", "M3")]
 
-    c = generic_tech = KLayoutTechnology(
-        name="generic_tech", layer_views=lyp, connectivity=connectivity
-    )
-    tech_dir = PATH.klayout_tech
-    # tech_dir = pathlib.Path("/home/jmatres/.klayout/salt/gdsfactory/tech/")
-    tech_dir.mkdir(exist_ok=True, parents=True)
-    generic_tech.write_tech(tech_dir=tech_dir, layer_stack=LAYER_STACK)
+    # c = generic_tech = KLayoutTechnology(
+    #     name="generic_tech", layer_views=lyp, connectivity=connectivity
+    # )
+    # tech_dir = PATH.klayout_tech
+    # # tech_dir = pathlib.Path("/home/jmatres/.klayout/salt/gdsfactory/tech/")
+    # tech_dir.mkdir(exist_ok=True, parents=True)
+    # generic_tech.write_tech(tech_dir=tech_dir, layer_stack=LAYER_STACK)
 
     # yaml_test()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/technology/layer_views.py` & `gdsfactory-7.0.0/gdsfactory/technology/layer_views.py`

 * *Files 5% similar despite different names*

```diff
@@ -6,28 +6,27 @@
 from __future__ import annotations
 
 import os
 import pathlib
 import re
 import typing
 import xml.etree.ElementTree as ET
-from typing import Dict, Optional, Set, Tuple, Union
 
 import numpy as np
 from pydantic import BaseModel, Field, validator
 from pydantic.color import Color, ColorType
 
 from gdsfactory.config import logger
 
 if typing.TYPE_CHECKING:
     from pydantic.typing import AbstractSetIntStr, DictStrAny, MappingIntStrAny
 
-PathLike = Union[pathlib.Path, str]
+PathLike = pathlib.Path | str
 
-Layer = Tuple[int, int]
+Layer = tuple[int, int]
 
 _klayout_line_styles = {
     "solid": "",
     "dotted": "*.",
     "dashed": "**..**",
     "dash-dotted": "***..**..***",
     "short dashed": "*..*",
@@ -274,24 +273,24 @@
     Attributes:
         name: Name of the pattern.
         order: Order of pattern.
         custom_pattern: Pattern defining custom shape.
     """
 
     name: str
-    order: Optional[int] = None
-    custom_pattern: Optional[str] = None
+    order: int | None = None
+    custom_pattern: str | None = None
 
     class Config:
         """YAML output uses name as the key."""
 
         fields = {"name": {"exclude": True}}
 
     @validator("custom_pattern")
-    def check_pattern_klayout(cls, pattern: Optional[str], **kwargs) -> Optional[str]:
+    def check_pattern_klayout(cls, pattern: str | None, **kwargs) -> str | None:
         if pattern is None:
             return None
         lines = pattern.splitlines()
         if any(len(list(line)) > 32 for line in lines):
             raise ValueError(
                 f"Custom pattern {kwargs['values']['name']} has more than 32 characters."
             )
@@ -324,24 +323,24 @@
     Attributes:
         name: Name of the line style.
         order: Order of line style.
         custom_style: Line style to use.
     """
 
     name: str
-    order: Optional[int] = None
-    custom_style: Optional[str] = None
+    order: int | None = None
+    custom_style: str | None = None
 
     class Config:
         """YAML output uses name as the key."""
 
         fields = {"name": {"exclude": True}}
 
     @validator("custom_style")
-    def check_pattern(cls, pattern: Optional[str], **kwargs) -> Optional[str]:
+    def check_pattern(cls, pattern: str | None, **kwargs) -> str | None:
         if pattern is None:
             return None
 
         pattern_list = list(pattern)
         valid_chars = all(char in ["*", "."] for char in pattern_list)
         valid_length = len(pattern_list) <= 32
         if (not valid_chars) or (not valid_length):
@@ -395,44 +394,44 @@
         transparent: Whether the entry is transparent.
         visible: Whether the entry is visible.
         valid: Whether the entry is valid. Invalid layers are drawn but you can't select shapes on those layers.
             (Only applies to KLayout layer properties)
         group_members: Add a list of group members to the LayerView.
     """
 
-    name: Optional[str] = None
-    info: Optional[str] = None
-    layer: Optional[Layer] = None
+    name: str | None = None
+    info: str | None = None
+    layer: Layer | None = None
     layer_in_name: bool = False
-    frame_color: Optional[Color] = None
-    fill_color: Optional[Color] = None
+    frame_color: Color | None = None
+    fill_color: Color | None = None
     frame_brightness: int = 0
     fill_brightness: int = 0
-    hatch_pattern: Optional[Union[str, HatchPattern]] = None
-    line_style: Optional[Union[str, LineStyle]] = None
+    hatch_pattern: str | HatchPattern | None = None
+    line_style: str | LineStyle | None = None
     valid: bool = True
     visible: bool = True
     transparent: bool = False
-    width: Optional[int] = None
+    width: int | None = None
     marked: bool = False
     xfill: bool = False
     animation: int = 0
-    group_members: Optional[Dict[str, LayerView]] = Field(default_factory=dict)
+    group_members: dict[str, LayerView] | None = Field(default_factory=dict)
 
     class Config:
         """YAML output uses name as the key."""
 
         fields = {"name": {"exclude": True}}
 
     def __init__(
         self,
-        gds_layer: Optional[int] = None,
-        gds_datatype: Optional[int] = None,
-        color: Optional[ColorType] = None,
-        brightness: Optional[int] = None,
+        gds_layer: int | None = None,
+        gds_datatype: int | None = None,
+        color: ColorType | None = None,
+        brightness: int | None = None,
         **data,
     ) -> None:
         """Initialize LayerView object."""
         if (gds_layer is not None) and (gds_datatype is not None):
             if "layer" in data and data["layer"] is not None:
                 raise KeyError(
                     "Specify either 'layer' or both 'gds_layer' and 'gds_datatype'."
@@ -459,18 +458,18 @@
             default = field.get_default()
             if isinstance(default, LayerView):
                 self.group_members[name] = default
 
     def dict(
         self,
         *,
-        include: Optional[Union[AbstractSetIntStr, MappingIntStrAny]] = None,
-        exclude: Optional[Union[AbstractSetIntStr, MappingIntStrAny]] = None,
+        include: AbstractSetIntStr | MappingIntStrAny | None = None,
+        exclude: AbstractSetIntStr | MappingIntStrAny | None = None,
         by_alias: bool = False,
-        skip_defaults: Optional[bool] = None,
+        skip_defaults: bool | None = None,
         exclude_unset: bool = False,
         exclude_defaults: bool = False,
         exclude_none: bool = False,
         simplify: bool = True,
     ) -> DictStrAny:
         """Generate a dictionary representation of the model, optionally specifying which fields to include or exclude.
 
@@ -519,16 +518,16 @@
             elif dither_name in ["I1", "hollow"]:
                 return 0.1
             else:
                 return 0.4
         else:
             return 0.3
 
-    def get_color_dict(self) -> Dict[str, str]:
-        from gdsfactory.utils.color_utils import ensure_six_digit_hex_color
+    def get_color_dict(self) -> dict[str, str]:
+        from gdsfactory.technology.color_utils import ensure_six_digit_hex_color
 
         if self.fill_color is not None or self.frame_color is not None:
             return {
                 "fill_color": ensure_six_digit_hex_color(self.fill_color.as_hex()),
                 "frame_color": ensure_six_digit_hex_color(self.frame_color.as_hex()),
             }
         # Colors generated from here: http://phrogz.net/css/distinct-colors.html
@@ -549,15 +548,15 @@
         color = layer_colors[np.mod(self.layer[0], len(layer_colors))]
         return {"fill_color": color, "frame_color": color}
 
     def _build_klayout_xml_element(
         self, tag: str, name: str, custom_hatch_patterns: dict, custom_line_styles: dict
     ) -> ET.Element:
         """Get XML Element from attributes."""
-        from gdsfactory.utils.color_utils import ensure_six_digit_hex_color
+        from gdsfactory.technology.color_utils import ensure_six_digit_hex_color
 
         # If hatch pattern name matches a named (built-in) KLayout pattern, use 'I<idx>' notation
         hatch_name = getattr(self.hatch_pattern, "name", self.hatch_pattern)
         if hatch_name is None:
             dither_pattern = None
         elif hatch_name in _klayout_dither_patterns:
             dither_pattern = f"I{list(_klayout_dither_patterns).index(hatch_name)}"
@@ -646,16 +645,16 @@
                     custom_line_styles=custom_line_styles,
                 )
             )
         return props
 
     @staticmethod
     def _process_name(
-        name: str, layer_pattern: Union[str, re.Pattern]
-    ) -> Tuple[Optional[str], Optional[bool]]:
+        name: str, layer_pattern: str | re.Pattern
+    ) -> tuple[str | None, bool | None]:
         """Strip layer info from name if it exists.
 
         Args:
             name: XML-formatted name entry.
             layer_pattern: Regex pattern to match layers with.
         """
         from gdsfactory.name import clean_name
@@ -667,33 +666,31 @@
         match = re.search(layer_pattern, name)
         if match:
             name = name[: match.start()].strip()
             layer_in_name = True
         return clean_name(name, remove_dots=True), layer_in_name
 
     @staticmethod
-    def _process_layer(
-        layer: str, layer_pattern: Union[str, re.Pattern]
-    ) -> Optional[Layer]:
+    def _process_layer(layer: str, layer_pattern: str | re.Pattern) -> Layer | None:
         """Convert .lyp XML layer entry to a Layer.
 
         Args:
             layer: XML-formatted layer entry.
             layer_pattern: Regex pattern to match layers with.
         """
         match = re.search(layer_pattern, layer)
         if not match:
             raise OSError(f"Could not read layer {layer}!")
         v = match.group().split("/")
         return None if "*" in v else (int(v[0]), int(v[1]))
 
     @classmethod
     def from_xml_element(
-        cls, element: ET.Element, layer_pattern: Union[str, re.Pattern]
-    ) -> Optional[LayerView]:
+        cls, element: ET.Element, layer_pattern: str | re.Pattern
+    ) -> LayerView | None:
         """Read properties from .lyp XML and generate LayerViews from them.
 
         Args:
             element: XML Element to iterate over.
             layer_pattern: Regex pattern to match layers with.
         """
         name, layer_in_name = cls._process_name(
@@ -752,23 +749,23 @@
     Attributes:
         layer_views: Dictionary of LayerViews describing how to display gds layers.
         custom_dither_patterns: Custom dither patterns.
         custom_line_styles: Custom line styles.
         layer_map: Specify a layer_map to get the layer tuple based on the name of the LayerView, rather than the 'layer' argument.
     """
 
-    layer_views: Dict[str, LayerView] = Field(default_factory=dict)
-    custom_dither_patterns: Dict[str, HatchPattern] = Field(default_factory=dict)
-    custom_line_styles: Dict[str, LineStyle] = Field(default_factory=dict)
-    layer_map: Union[Dict[str, Layer], BaseModel] = Field(default_factory=dict)
+    layer_views: dict[str, LayerView] = Field(default_factory=dict)
+    custom_dither_patterns: dict[str, HatchPattern] = Field(default_factory=dict)
+    custom_line_styles: dict[str, LineStyle] = Field(default_factory=dict)
+    layer_map: dict[str, Layer] | BaseModel = Field(default_factory=dict)
 
     def __init__(
         self,
-        filepath: Optional[PathLike] = None,
-        layer_map: Optional[Union[Dict[str, Layer], BaseModel]] = None,
+        filepath: PathLike | None = None,
+        layer_map: dict[str, Layer] | BaseModel | None = None,
         **data,
     ) -> None:
         """Initialize LayerViews object.
 
         Args:
             filepath: can be YAML or LYP.
             layer_map: Optional layermap.
@@ -804,15 +801,15 @@
                 #
                 if (self.layer_map is not None) and (name in self.layer_map.keys()):
                     lv_dict = lv.dict(exclude={"layer", "name"})
                     lv = LayerView(layer=self.layer_map[name], name=name, **lv_dict)
                 self.add_layer_view(name=name, layer_view=lv)
 
     def add_layer_view(
-        self, name: str, layer_view: Optional[LayerView] = None, **kwargs
+        self, name: str, layer_view: LayerView | None = None, **kwargs
     ) -> None:
         """Adds a layer to LayerViews.
 
         Args:
             name: Name of the LayerView.
             layer_view: LayerView to add.
         """
@@ -848,30 +845,30 @@
         ):
             self.custom_line_styles[line_style.name] = line_style
         elif (
             isinstance(line_style, str) and line_style in self.custom_line_styles.keys()
         ):
             layer_view.line_style = self.custom_line_styles[line_style]
 
-    def get_layer_views(self, exclude_groups: bool = False) -> Dict[str, LayerView]:
+    def get_layer_views(self, exclude_groups: bool = False) -> dict[str, LayerView]:
         """Return all LayerViews.
 
         Args:
             exclude_groups: Whether to exclude LayerViews that contain other LayerViews.
         """
         layers = {}
         for name, view in self.layer_views.items():
             if view.group_members and not exclude_groups:
                 for member_name, member in view.group_members.items():
                     layers[member_name] = member
                 continue
             layers[name] = view
         return layers
 
-    def get_layer_view_groups(self) -> Dict[str, LayerView]:
+    def get_layer_view_groups(self) -> dict[str, LayerView]:
         """Return the LayerViews that contain other LayerViews."""
         return {name: lv for name, lv in self.layer_views.items() if lv.group_members}
 
     def __str__(self) -> str:
         """Prints the number of LayerView objects in the LayerViews object."""
         lvs = self.get_layer_views()
         groups = self.get_layer_view_groups()
@@ -923,15 +920,15 @@
             raise ValueError(
                 f"LayerView {layer_tuple} not in {list(tuple_to_name.keys())}"
             )
 
         name = tuple_to_name[layer_tuple]
         return self.get_layer_views()[name]
 
-    def get_layer_tuples(self) -> Set[Layer]:
+    def get_layer_tuples(self) -> set[Layer]:
         """Returns a tuple for each layer."""
         return {layer.layer for layer in self.get_layer_views().values()}
 
     def clear(self) -> None:
         """Deletes all layers in the LayerViews."""
         self.layer_views = {}
 
@@ -972,24 +969,24 @@
             )
             D.add_ref(T).movex((100 + spacing) * xloc * scale).movey(
                 -(100 + spacing) * yloc * scale
             )
         return D
 
     def to_lyp(
-        self, filepath: Union[str, pathlib.Path], overwrite: bool = True
+        self, filepath: str | pathlib.Path, overwrite: bool = True
     ) -> pathlib.Path:
         """Write all layer properties to a KLayout .lyp file.
 
         Args:
             filepath: to write the .lyp file to (appends .lyp extension if not present).
             overwrite: Whether to overwrite an existing file located at the filepath.
 
         """
-        from gdsfactory.utils.xml_utils import make_pretty_xml
+        from gdsfactory.technology.xml_utils import make_pretty_xml
 
         filepath = pathlib.Path(filepath)
         dirpath = filepath.parent
         dirpath.mkdir(exist_ok=True, parents=True)
 
         if filepath.exists() and not overwrite:
             raise OSError(f"File {str(filepath)!r} exists, cannot write.")
@@ -1011,16 +1008,16 @@
             root.append(ls.to_klayout_xml())
 
         filepath.write_bytes(make_pretty_xml(root))
         return filepath
 
     @staticmethod
     def from_lyp(
-        filepath: Union[str, pathlib.Path],
-        layer_pattern: Optional[Union[str, re.Pattern]] = None,
+        filepath: str | pathlib.Path,
+        layer_pattern: str | re.Pattern | None = None,
     ) -> LayerViews:
         r"""Write all layer properties to a KLayout .lyp file.
 
         Args:
             filepath: to write the .lyp file to (appends .lyp extension if not present).
             layer_pattern: Regex pattern to match layers with. Defaults to r'(\d+|\*)/(\d+|\*)'.
         """
@@ -1089,25 +1086,25 @@
         return LayerViews(
             layer_views=layer_views,
             custom_dither_patterns=dither_patterns,
             custom_line_styles=line_styles,
         )
 
     def to_yaml(
-        self, layer_file: Union[str, pathlib.Path], prefer_named_color: bool = True
+        self, layer_file: str | pathlib.Path, prefer_named_color: bool = True
     ) -> None:
         """Export layer properties to a YAML file.
 
         Args:
             layer_file: Name of the file to write LayerViews to.
             prefer_named_color: Write the name of a color instead of its hex representation when possible.
         """
         import yaml
 
-        from gdsfactory.utils.yaml_utils import (
+        from gdsfactory.technology.yaml_utils import (
             add_color_yaml_presenter,
             add_multiline_str_yaml_presenter,
             add_tuple_yaml_presenter,
         )
 
         lf_path = pathlib.Path(layer_file)
         dirpath = lf_path.parent
@@ -1145,15 +1142,15 @@
                 sort_keys=False,
                 default_flow_style=False,
                 encoding="utf-8",
             )
         )
 
     @staticmethod
-    def from_yaml(layer_file: Union[str, pathlib.Path]) -> LayerViews:
+    def from_yaml(layer_file: str | pathlib.Path) -> LayerViews:
         """Import layer properties from two yaml files.
 
         Args:
             layer_file: Name of the file to read LayerViews, CustomDitherPatterns, and CustomLineStyles from.
         """
         from omegaconf import OmegaConf
```

### Comparing `gdsfactory-6.99.0/gdsfactory/technology/simulation_settings.py` & `gdsfactory-7.0.0/gdsfactory/generic_tech/simulation_settings.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,15 +1,22 @@
-from typing import Dict
+from __future__ import annotations
 
+from typing import TYPE_CHECKING
+
+import numpy as np
 from pydantic import BaseModel
 
-from gdsfactory.materials import MaterialSpec
-from gdsfactory.materials import (
-    material_name_to_lumerical as material_name_to_lumerical_default,
-)
+if TYPE_CHECKING:
+    from gdsfactory.typings import MaterialSpec
+
+material_name_to_lumerical_default = {
+    "si": "Si (Silicon) - Palik",
+    "sio2": "SiO2 (Glass) - Palik",
+    "sin": "Si3N4 (Silicon Nitride) - Phillip",
+}
 
 
 class SimulationSettingsLumericalFdtd(BaseModel):
     """Lumerical FDTD simulation_settings.
 
     Parameters:
         background_material: for the background.
@@ -38,23 +45,43 @@
     wavelength_stop: float = 1.6
     wavelength_points: int = 500
     simulation_time: float = 10e-12
     simulation_temperature: float = 300
     frequency_dependent_profile: bool = True
     field_profile_samples: int = 15
     distance_monitors_to_pml: float = 0.5
-    material_name_to_lumerical: Dict[
+    material_name_to_lumerical: dict[
         str, MaterialSpec
     ] = material_name_to_lumerical_default
 
     class Config:
         """pydantic basemodel config."""
 
         arbitrary_types_allowed = True
 
 
 SIMULATION_SETTINGS_LUMERICAL_FDTD = SimulationSettingsLumericalFdtd()
 
-if __name__ == "__main__":
-    from gdsfactory.serialization import clean_value_json
 
-    d = clean_value_json(SIMULATION_SETTINGS_LUMERICAL_FDTD)
+# default materials
+def si(wav: np.ndarray) -> np.ndarray:
+    """Silicon crystalline."""
+    from gplugins.gtidy3d.materials import si
+
+    return si(wav)
+
+
+def sio2(wav: np.ndarray) -> np.ndarray:
+    """Silicon oxide."""
+    from gplugins.gtidy3d.materials import sio2
+
+    return sio2(wav)
+
+
+def sin(wav: np.ndarray) -> np.ndarray:
+    """Silicon Nitride."""
+    from gplugins.gtidy3d.materials import sin
+
+    return sin(wav)
+
+
+materials_index = {"si": si, "sio2": sio2, "sin": sin}
```

### Comparing `gdsfactory-6.99.0/gdsfactory/typings.py` & `gdsfactory-7.0.0/gdsfactory/typings.py`

 * *Files 22% similar despite different names*

```diff
@@ -25,31 +25,76 @@
 - ComponentSpec: Component, function, string or dict
     (component=mzi, settings=dict(delta_length=20)).
 - LayerSpec: (3, 0), 3 (assumes 0 as datatype) or string.
 
 """
 from __future__ import annotations
 
+import dataclasses
 import json
 import pathlib
-import dataclasses
-from typing import Any, Callable, Dict, List, Optional, Tuple, Union
+from collections.abc import Callable
+from typing import Any, Dict, List, Literal, Optional, Tuple, Union
 
 import gdstk
 import numpy as np
 from omegaconf import OmegaConf
 from pydantic import BaseModel, Extra
-from typing_extensions import Literal
 
 from gdsfactory.component import Component, ComponentReference
 from gdsfactory.component_layout import Label
-from gdsfactory.cross_section import CrossSection, Section, Transition
+from gdsfactory.cross_section import CrossSection, Section, Transition, WidthTypes
 from gdsfactory.port import Port
 from gdsfactory.technology import LayerLevel, LayerStack
 
+# TODO: remove this
+# def __getattr__(name):
+#     if name == "Optional":
+#         from typing import Optional
+
+#         warnings.warn(
+#             "gdsfactory.typings.Optional will be removed soon. "
+#             "Use from typing import Optional instead.",
+#             stacklevel=2,
+#         )
+#         return Optional
+#     elif name == "Union":
+#         from typing import Union
+
+#         warnings.warn(
+#             "gdsfactory.typings.Union will be removed soon. "
+#             "Use from typing import Union instead.",
+#             stacklevel=2,
+#         )
+#         return Union
+#     elif name == "Tuple":
+
+#         warnings.warn(
+#             "gdsfactory.typings.Tuple will be removed soon. "
+#             "Use from typing import Tuple instead.",
+#             stacklevel=2,
+#         )
+#         return tuple
+#     elif name == "List":
+
+#         warnings.warn(
+#             "gdsfactory.typings.List will be removed soon. "
+#             "Use from typing import List instead.",
+#             stacklevel=2,
+#         )
+#         return list
+#     elif name == "Dict":
+
+#         warnings.warn(
+#             "gdsfactory.typings.Dict will be removed soon. "
+#             "Use from typing import Dict instead.",
+#             stacklevel=2,
+#         )
+#         return dict
+
 
 STEP_DIRECTIVES = {
     "x",
     "y",
     "dx",
     "dy",
 }
@@ -75,31 +120,31 @@
         x: absolute.
         y: absolute.
         dx: x-displacement.
         dy: y-displacement.
 
     """
 
-    x: Optional[float] = None
-    y: Optional[float] = None
-    dx: Optional[float] = None
-    dy: Optional[float] = None
+    x: float | None = None
+    y: float | None = None
+    dx: float | None = None
+    dy: float | None = None
 
 
 @dataclasses.dataclass
 class StepAllAngle:
-    x: Optional[float] = None
-    y: Optional[float] = None
-    dx: Optional[float] = None
-    dy: Optional[float] = None
-    ds: Optional[float] = None
-    exit_angle: Optional[float] = None
-    cross_section: Optional[CrossSectionSpec] = None
-    connector: Optional[ComponentSpec] = None
-    separation: Optional[float] = None
+    x: float | None = None
+    y: float | None = None
+    dx: float | None = None
+    dy: float | None = None
+    ds: float | None = None
+    exit_angle: float | None = None
+    cross_section: CrossSectionSpec | None = None
+    connector: ComponentSpec | None = None
+    separation: float | None = None
 
     """All angle Ste.
 
     Parameters:
         x: absolute.
         y: absolute.
         dx: x-displacement.
@@ -127,136 +172,135 @@
     "se",
     "sw",
     "center",
     "cc",
 ]
 Axis = Literal["x", "y"]
 NSEW = Literal["N", "S", "E", "W"]
-WidthTypes = Literal["sine", "linear", "parabolic"]
-
 
-Float2 = Tuple[float, float]
-Float3 = Tuple[float, float, float]
-Floats = Tuple[float, ...]
-Strs = Tuple[str, ...]
-Int2 = Tuple[int, int]
-Int3 = Tuple[int, int, int]
-Ints = Tuple[int, ...]
 
-Layer = Tuple[int, int]  # Tuple of integer (layer, datatype)
-Layers = Tuple[Layer, ...]
+Float2 = tuple[float, float]
+Float3 = tuple[float, float, float]
+Floats = tuple[float, ...]
+Strs = tuple[str, ...]
+Int2 = tuple[int, int]
+Int3 = tuple[int, int, int]
+Ints = tuple[int, ...]
+
+Layer = tuple[int, int]  # Tuple of integer (layer, datatype)
+Layers = tuple[Layer, ...]
+
+LayerSpec = (
+    Layer | int | str | None
+)  # tuple of integers (layer, datatype), a integer (layer, 0) or a string (layer_name)
 
-LayerSpec = Union[
-    Layer, int, str, None
-]  # tuple of integers (layer, datatype), a integer (layer, 0) or a string (layer_name)
-
-LayerSpecs = Optional[Tuple[LayerSpec, ...]]
+LayerSpecs = tuple[LayerSpec, ...] | None
 ComponentFactory = Callable[..., Component]
-ComponentFactoryDict = Dict[str, ComponentFactory]
-PathType = Union[str, pathlib.Path]
-PathTypes = Tuple[PathType, ...]
+ComponentFactoryDict = dict[str, ComponentFactory]
+PathType = str | pathlib.Path
+PathTypes = tuple[PathType, ...]
 
 
-MaterialSpec = Union[str, float, Tuple[float, float], Callable]
-
-ComponentOrPath = Union[PathType, Component]
-ComponentOrReference = Union[Component, ComponentReference]
-NameToFunctionDict = Dict[str, ComponentFactory]
-Number = Union[float, int]
-Coordinate = Tuple[float, float]
-Coordinates = Tuple[Coordinate, ...]
-ComponentOrPath = Union[Component, PathType]
+MaterialSpec = str | float | tuple[float, float] | Callable
+
+ComponentOrPath = PathType | Component
+ComponentOrReference = Component | ComponentReference
+NameToFunctionDict = dict[str, ComponentFactory]
+Number = float | int
+Coordinate = tuple[float, float]
+Coordinates = tuple[Coordinate, ...]
+ComponentOrPath = Component | PathType
 CrossSectionFactory = Callable[..., CrossSection]
 TransitionFactory = Callable[..., Transition]
-CrossSectionOrFactory = Union[CrossSection, Callable[..., CrossSection]]
-PortSymmetries = Dict[str, List[str]]
-PortsDict = Dict[str, Port]
-PortsList = Dict[str, Port]
-
-Sparameters = Dict[str, np.ndarray]
-
-ComponentSpec = Union[
-    str, ComponentFactory, Component, Dict[str, Any]
-]  # PCell function, function name, dict or Component
-
-ComponentSpecOrList = Union[ComponentSpec, List[ComponentSpec]]
-CellSpec = Union[
-    str, ComponentFactory, Dict[str, Any]
-]  # PCell function, function name or dict
-
-ComponentSpecDict = Dict[str, ComponentSpec]
-CrossSectionSpec = Union[
-    str,
-    CrossSectionFactory,
-    CrossSection,
-    Transition,
-    TransitionFactory,
-    Dict[str, Any],
-]  # cross_section function, function name or dict
-CrossSectionSpecs = Tuple[CrossSectionSpec, ...]
+CrossSectionOrFactory = CrossSection | Callable[..., CrossSection]
+PortSymmetries = dict[str, list[str]]
+PortsDict = dict[str, Port]
+PortsList = dict[str, Port]
+
+Sparameters = dict[str, np.ndarray]
+
+ComponentSpec = (
+    str | ComponentFactory | Component | dict[str, Any]
+)  # PCell function, function name, dict or Component
+
+ComponentSpecOrList = ComponentSpec | list[ComponentSpec]
+CellSpec = (
+    str | ComponentFactory | dict[str, Any]
+)  # PCell function, function name or dict
+
+ComponentSpecDict = dict[str, ComponentSpec]
+CrossSectionSpec = (
+    str
+    | CrossSectionFactory
+    | CrossSection
+    | Transition
+    | TransitionFactory
+    | dict[str, Any]
+)  # cross_section function, function name or dict
+CrossSectionSpecs = tuple[CrossSectionSpec, ...]
 
-MultiCrossSectionAngleSpec = List[Tuple[CrossSectionSpec, Tuple[int, ...]]]
+MultiCrossSectionAngleSpec = list[tuple[CrossSectionSpec, tuple[int, ...]]]
 
-LabelListFactory = Callable[..., List[Label]]
+LabelListFactory = Callable[..., list[Label]]
 
 
 class Route(BaseModel):
-    references: List[ComponentReference]
-    labels: Optional[List[gdstk.Label]] = None
-    ports: Tuple[Port, Port]
+    references: list[ComponentReference]
+    labels: list[gdstk.Label] | None = None
+    ports: tuple[Port, Port]
     length: float
 
     class Config:
         """Config for Route."""
 
         extra = Extra.forbid
         arbitrary_types_allowed = True
 
 
 class Routes(BaseModel):
-    references: List[ComponentReference]
-    lengths: List[float]
-    ports: Optional[List[Port]] = None
-    bend_radius: Optional[List[float]] = None
+    references: list[ComponentReference]
+    lengths: list[float]
+    ports: list[Port] | None = None
+    bend_radius: list[float] | None = None
 
     class Config:
         """Config for Routes."""
 
         extra = Extra.forbid
 
 
 class ComponentModel(BaseModel):
-    component: Union[str, Dict[str, Any]]
-    settings: Optional[Dict[str, Any]]
+    component: str | dict[str, Any]
+    settings: dict[str, Any] | None
 
     class Config:
         extra = Extra.forbid
 
 
 class PlacementModel(BaseModel):
-    x: Union[str, float] = 0
-    y: Union[str, float] = 0
-    xmin: Optional[Union[str, float]] = None
-    ymin: Optional[Union[str, float]] = None
-    xmax: Optional[Union[str, float]] = None
-    ymax: Optional[Union[str, float]] = None
+    x: str | float = 0
+    y: str | float = 0
+    xmin: str | float | None = None
+    ymin: str | float | None = None
+    xmax: str | float | None = None
+    ymax: str | float | None = None
     dx: float = 0
     dy: float = 0
-    port: Optional[Union[str, Anchor]] = None
+    port: str | Anchor | None = None
     rotation: int = 0
     mirror: bool = False
 
     class Config:
         extra = Extra.forbid
 
 
 class RouteModel(BaseModel):
-    links: Dict[str, str]
-    settings: Optional[Dict[str, Any]] = None
-    routing_strategy: Optional[str] = None
+    links: dict[str, str]
+    settings: dict[str, Any] | None = None
+    routing_strategy: str | None = None
 
     class Config:
         extra = Extra.forbid
 
 
 class NetlistModel(BaseModel):
     """Netlist defined component.
@@ -269,22 +313,22 @@
         name: component name.
         info: information (polarization, wavelength ...).
         settings: input variables.
         ports: exposed component ports.
 
     """
 
-    instances: Optional[Dict[str, ComponentModel]] = None
-    placements: Optional[Dict[str, PlacementModel]] = None
-    connections: Optional[Dict[str, str]] = None
-    routes: Optional[Dict[str, RouteModel]] = None
-    name: Optional[str] = None
-    info: Optional[Dict[str, Any]] = None
-    settings: Optional[Dict[str, Any]] = None
-    ports: Optional[Dict[str, str]] = None
+    instances: dict[str, ComponentModel] | None = None
+    placements: dict[str, PlacementModel] | None = None
+    connections: dict[str, str] | None = None
+    routes: dict[str, RouteModel] | None = None
+    name: str | None = None
+    info: dict[str, Any] | None = None
+    settings: dict[str, Any] | None = None
+    ports: dict[str, str] | None = None
 
     class Config:
         extra = Extra.forbid
 
 
 RouteFactory = Callable[..., Route]
 
@@ -307,56 +351,57 @@
 
 
 class Array(np.ndarray, metaclass=ArrayMeta):
     pass
 
 
 __all__ = (
+    "Any",
     "Callable",
     "Component",
     "ComponentFactory",
     "ComponentFactoryDict",
-    "ComponentSpec",
     "ComponentOrPath",
     "ComponentOrReference",
+    "ComponentSpec",
     "Coordinate",
     "Coordinates",
     "CrossSection",
     "CrossSectionFactory",
     "CrossSectionOrFactory",
     "CrossSectionSpec",
-    "MultiCrossSectionAngleSpec",
     "Float2",
     "Float3",
     "Floats",
     "Int2",
     "Int3",
     "Ints",
-    "Layer",
     "Label",
-    "Layers",
+    "Layer",
     "LayerLevel",
-    "LayerStack",
     "LayerSpec",
     "LayerSpecs",
+    "LayerStack",
+    "Layers",
+    "MultiCrossSectionAngleSpec",
     "NameToFunctionDict",
     "Number",
+    "Optional",
     "PathType",
     "PathTypes",
     "Route",
     "RouteFactory",
     "Routes",
-    "Strs",
     "Section",
-    "Any",
-    "Dict",
-    "List",
-    "Optional",
+    "Strs",
+    "WidthTypes",
     "Union",
+    "List",
     "Tuple",
+    "Dict",
 )
 
 
 def write_schema(model: BaseModel = NetlistModel) -> None:
     from gdsfactory.config import PATH
 
     s = model.schema_json()
```

### Comparing `gdsfactory-6.99.0/gdsfactory/utils/xml_utils.py` & `gdsfactory-7.0.0/gdsfactory/technology/xml_utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,27 +1,25 @@
+import xml.dom.minidom
 import xml.etree.ElementTree as ET
+from xml.dom.minidom import Node
 
 
 def _strip_xml(node) -> None:
     """Strip XML of excess whitespace.
 
     Source: https://stackoverflow.com/a/16919069
     """
-    from xml.dom.minidom import Node
-
     for x in node.childNodes:
         if x.nodeType == Node.TEXT_NODE:
             if x.nodeValue:
                 x.nodeValue = x.nodeValue.strip()
         elif x.nodeType == Node.ELEMENT_NODE:
             _strip_xml(x)
 
 
 def make_pretty_xml(root: ET.Element) -> bytes:
-    import xml.dom.minidom
-
     xml_doc = xml.dom.minidom.parseString(ET.tostring(root))
 
     _strip_xml(xml_doc)
     xml_doc.normalize()
 
     return xml_doc.toprettyxml(indent=" ", newl="\n", encoding="utf-8")
```

### Comparing `gdsfactory-6.99.0/gdsfactory/utils/yaml_utils.py` & `gdsfactory-7.0.0/gdsfactory/technology/yaml_utils.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,36 +1,33 @@
-def add_color_yaml_presenter(prefer_named_color: bool = True) -> None:
-    import yaml
-    from pydantic.color import Color
+import yaml
+from pydantic.color import Color
+
+from gdsfactory.technology.color_utils import ensure_six_digit_hex_color
 
-    from gdsfactory.utils.color_utils import ensure_six_digit_hex_color
 
+def add_color_yaml_presenter(prefer_named_color: bool = True) -> None:
     def _color_presenter(dumper: yaml.Dumper, data: Color) -> yaml.ScalarNode:
         data = data.as_named(fallback=True) if prefer_named_color else data.as_hex()
         return dumper.represent_scalar(
             "tag:yaml.org,2002:str", ensure_six_digit_hex_color(data), style='"'
         )
 
     yaml.add_representer(Color, _color_presenter)
     yaml.representer.SafeRepresenter.add_representer(Color, _color_presenter)
 
 
 def add_tuple_yaml_presenter() -> None:
-    import yaml
-
     def _tuple_presenter(dumper: yaml.Dumper, data: tuple) -> yaml.SequenceNode:
         return dumper.represent_sequence("tag:yaml.org,2002:seq", data, flow_style=True)
 
     yaml.add_representer(tuple, _tuple_presenter)
     yaml.representer.SafeRepresenter.add_representer(tuple, _tuple_presenter)
 
 
 def add_multiline_str_yaml_presenter() -> None:
-    import yaml
-
     def _str_presenter(dumper: yaml.Dumper, data: str) -> yaml.ScalarNode:
         if "\n" in data:  # check for multiline string
             return dumper.represent_scalar("tag:yaml.org,2002:str", data, style="|")
         return dumper.represent_scalar("tag:yaml.org,2002:str", data)
 
     yaml.add_representer(str, _str_presenter)
     yaml.representer.SafeRepresenter.add_representer(str, _str_presenter)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/watch.py` & `gdsfactory-7.0.0/gdsfactory/watch.py`

 * *Files 6% similar despite different names*

```diff
@@ -2,36 +2,58 @@
 
 from __future__ import annotations
 
 import importlib
 import logging
 import pathlib
 import sys
+import threading
 import time
 import traceback
-from typing import Callable, Optional
+from collections.abc import Callable
 
 from watchdog.events import FileSystemEventHandler
 from watchdog.observers import Observer
 
 from gdsfactory.config import cwd
 from gdsfactory.pdk import get_active_pdk
 
 
-class YamlEventHandler(FileSystemEventHandler):
-    """Captures pic.yml file change events."""
+class FileWatcher(FileSystemEventHandler):
+    """Captures *.py or *.pic.yml file change events."""
 
-    def __init__(self, logger=None, path: Optional[str] = None) -> None:
+    def __init__(self, logger=None, path: str | None = None) -> None:
         """Initialize the YAML event handler."""
         super().__init__()
 
         self.logger = logger or logging.root
         pdk = get_active_pdk()
         pdk.register_cells_yaml(dirpath=path, update=True)
 
+        self.observer = Observer()
+        self.path = path
+        self.stopping = threading.Event()
+
+    def start(self) -> None:
+        self.observer.schedule(self, self.path, recursive=True)
+        self.thread = threading.Thread(target=self.run, daemon=True)
+        self.thread.start()
+
+    def run(self) -> None:
+        while not self.stopping.is_set():
+            if not self.observer.is_alive():
+                self.observer.start()
+            time.sleep(1)
+        self.observer.stop()
+        self.observer.join()
+
+    def stop(self) -> None:
+        self.stopping.set()
+        self.thread.join()
+
     def update_cell(self, src_path, update: bool = False) -> Callable:
         """Parses a YAML file to a cell function and registers into active pdk.
 
         Args:
             src_path: the path to the file
             update: if True, will update an existing cell function of the same name without raising an error
         Returns:
@@ -63,17 +85,20 @@
             self.update_cell(event.dest_path)
             self.get_component(event.src_path)
 
     def on_created(self, event) -> None:
         super().on_created(event)
 
         what = "directory" if event.is_directory else "file"
-        if what == "file" and event.src_path.endswith(".pic.yml"):
+        if (
+            what == "file"
+            and event.src_path.endswith(".pic.yml")
+            or event.src_path.endswith(".py")
+        ):
             self.logger.info("Created %s: %s", what, event.src_path)
-            self.update_cell(event.src_path)
             self.get_component(event.src_path)
 
     def on_deleted(self, event) -> None:
         super().on_deleted(event)
 
         what = "directory" if event.is_directory else "file"
 
@@ -92,15 +117,19 @@
             what == "file"
             and event.src_path.endswith(".pic.yml")
             or event.src_path.endswith(".py")
         ):
             self.logger.info("Modified %s: %s", what, event.src_path)
             self.get_component(event.src_path)
 
+    def update(self):
+        pass
+
     def get_component(self, filepath):
+        self.update()
         try:
             filepath = pathlib.Path(filepath)
             if filepath.exists():
                 if str(filepath).endswith(".pic.yml"):
                     cell_func = self.update_cell(filepath, update=True)
                     c = cell_func()
                     c.show(show_ports=True)
@@ -124,23 +153,21 @@
         level=logging.INFO,
         format="%(asctime)s - %(message)s",
         datefmt="%Y-%m-%d %H:%M:%S",
     )
     if pdk:
         pdk_module = importlib.import_module(pdk)
         pdk_module.PDK.activate()
-    event_handler = YamlEventHandler(path=path)
-    observer = Observer()
-    observer.schedule(event_handler, path, recursive=True)
-    observer.start()
+    watcher = FileWatcher(path=path)
+    watcher.start()
     logging.info(f"Observing {path!r}")
+
     try:
         while True:
             time.sleep(1)
-    finally:
-        observer.stop()
-        observer.join()
+    except KeyboardInterrupt:
+        watcher.stop()
 
 
 if __name__ == "__main__":
     path = sys.argv[1] if len(sys.argv) > 1 else "."
     watch(path)
```

### Comparing `gdsfactory-6.99.0/gdsfactory/write_cells.py` & `gdsfactory-7.0.0/gdsfactory/write_cells.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,41 +1,40 @@
 """Generate the code from a GDS file based PDK."""
 
 from __future__ import annotations
 
 import datetime
 import pathlib
 from pathlib import Path
-from typing import Dict, Optional
 
 import gdstk
 
 from gdsfactory.component import _timestamp2019
 from gdsfactory.config import PATH, logger
 from gdsfactory.name import clean_name
 from gdsfactory.read.import_gds import import_gds
 from gdsfactory.typings import PathType
 
 script_prefix = """
 from pathlib import PosixPath
 from functools import partial
 import gdsfactory as gf
 
-add_ports_optical = gf.partial(
+add_ports_optical = partial(
     gf.add_ports.add_ports_from_markers_inside, pin_layer=(1, 0), port_layer=(2, 0)
 )
-add_ports_electrical = gf.partial(
+add_ports_electrical = partial(
     gf.add_ports.add_ports_from_markers_inside, pin_layer=(41, 0), port_layer=(1, 0)
 )
 add_ports = gf.compose(add_ports_optical, add_ports_electrical)
 
 """
 
 
-def get_script(gdspath: PathType, module: Optional[str] = None) -> str:
+def get_script(gdspath: PathType, module: str | None = None) -> str:
     """Returns script for importing a fixed cell.
 
     Args:
         gdspath: fixed cell gdspath.
         module: if any includes plot directive.
 
     """
@@ -69,15 +68,15 @@
 def {cell}()->gf.Component:
     '''Returns {cell} fixed cell.'''
     return import_gds({str(gdspath)!r})
 
 """
 
 
-def get_import_gds_script(dirpath: PathType, module: Optional[str] = None) -> str:
+def get_import_gds_script(dirpath: PathType, module: str | None = None) -> str:
     """Returns import_gds script from a directory with all the GDS files.
 
     Args:
         dirpath: fixed cell directory path.
         module: Optional plot directive to plot imported component.
 
     """
@@ -103,17 +102,17 @@
     return "\n".join(script)
 
 
 def write_cells_recursively(
     cell: gdstk.Cell,
     unit: float = 1e-6,
     precision: float = 1e-9,
-    timestamp: Optional[datetime.datetime] = _timestamp2019,
-    dirpath: Optional[pathlib.Path] = None,
-) -> Dict[str, Path]:
+    timestamp: datetime.datetime | None = _timestamp2019,
+    dirpath: pathlib.Path | None = None,
+) -> dict[str, Path]:
     """Write gdstk cells recursively.
 
     Args:
         cell: gdstk cell.
         unit: unit size for objects in library. 1um by default.
         precision: for library dimensions (m). 1nm by default.
         timestamp: Defaults to 2019-10-25. If None uses current time.
@@ -137,22 +136,22 @@
 
         gdspaths[c.name] = gdspath
 
     return gdspaths
 
 
 def write_cells(
-    gdspath: Optional[PathType] = None,
-    dirpath: Optional[PathType] = None,
+    gdspath: PathType | None = None,
+    dirpath: PathType | None = None,
     unit: float = 1e-6,
     precision: float = 1e-9,
-    timestamp: Optional[datetime.datetime] = _timestamp2019,
+    timestamp: datetime.datetime | None = _timestamp2019,
     recursively: bool = False,
     flatten: bool = False,
-) -> Dict[str, Path]:
+) -> dict[str, Path]:
     """Writes cells into separate GDS files.
 
     Args:
         gdspath: GDS file to write cells.
         dirpath: directory path to write GDS files to.
             Defaults to current working directory.
         unit: unit size for objects in library. 1um by default.
```

### Comparing `gdsfactory-6.99.0/pyproject.toml` & `gdsfactory-7.0.0/pyproject.toml`

 * *Files 12% similar despite different names*

```diff
@@ -1,153 +1,97 @@
 # https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html
+
 [build-system]
-requires = ["flit_core >=3.2,<4"]
 build-backend = "flit_core.buildapi"
+requires = ["flit_core >=3.2,<4"]
 
 [project]
-name = "gdsfactory"
-description = "python library to generate GDS layouts"
+authors = [{name = "gdsfactory community", email = "contact@gdsfactory.com"}]
 classifiers = [
-  "Programming Language :: Python :: 3.7",
-  "Programming Language :: Python :: 3.8",
-  "Programming Language :: Python :: 3.9",
   "Programming Language :: Python :: 3.10",
   "Programming Language :: Python :: 3.11",
-  "Operating System :: OS Independent",
-]
-version = "6.99.0"
-authors = [
-{name = "gdsfactory community", email = "contact@gdsfactory.com"},
+  "Operating System :: OS Independent"
 ]
-keywords = ["eda", "photonics", "python"]
-license = {file = "LICENSE"}
 dependencies = [
   "click",
   "flatdict",
-  "gdstk",
+  "gdstk<1",
+  "gplugins<1",  # TODO: remove after we removing deprecated gdsfactory/simulation and gdsfactory/plugins
   "jinja2",
-  "loguru",
+  "loguru<1",
   "matplotlib",
   "numpy",
-  "omegaconf",
+  "omegaconf<3",
   "orjson",
   "pandas",
-  "pydantic",
+  "pydantic<2",
   "pyyaml",
   "qrcode",
   "rectpack",
+  "rich",
   "scipy",
-  "shapely",
+  "shapely<3",
   "toolz",
   "tqdm",
   "types-PyYAML",
-  "typing_extensions",
   "watchdog",
-  "rich",
-  ]
-  readme = "README.md"
-  requires-python = ">=3.7"
-
-
-[project.optional-dependencies]
-full = [
-"autograd",
-"bokeh",
-"freetype-py",
-"holoviews",
-"ipympl",
-"ipywidgets==7.7.3",
-"ipyevents",
-"mapbox_earcut",
-"natsort",
-"networkx",
-"pyglet<2",
-"pygmsh",
-"scikit-fem",
-"scikit-image",
-"scikit-learn",
-"trimesh",
-"jupytext",
-"klayout",
-"ipytree",
-"rich-click",
-"ipycytoscape",
-"kweb>=0.0.11,<0.1",
-"jinja2",
-"python-multipart",
-"fastapi",
-"uvicorn[standard]",
-]
-kfactory = ["kfactory[git]==0.7.2"]
-femwell = ["femwell==0.0.18"]
-database = [
-"sqlalchemy",
-"sqlalchemy-utils",
-"dagster",
-"dagit",
-"sqlmodel",
-"boto3",
-"pymysql",
-]
-gmsh = [
-  "gmsh",
-  "h5py",
+  "freetype-py",
+  "ipycytoscape",
+  "ipyevents",
+  "ipykernel",
+  "ipympl",
+  "ipytree",
+  "ipywidgets",
+  "jupytext",
+  "kfactory[git,ipy]==0.7.5",
+  "kweb==0.1.1",
   "mapbox_earcut",
-  "meshio",
-  "pygmsh",
-  "pyvista",
-  "trimesh",
-  "shapely",
+  "networkx",
+  "pyglet<2",
+  "rich-click",
+  "scikit-image",
+  "trimesh"
 ]
-tidy3d = ["tidy3d==2.2.2"]
-devsim = [
-  "devsim",
-  "mkl",
-  "pyvista",
-  "tidy3d",
-]
-meow = ["meow-sim"]
-sax = ["sax>=0.8.6", "jaxlib", "jax"]
+description = "python library to generate GDS layouts"
+keywords = ["eda", "photonics", "python"]
+license = {file = "LICENSE"}
+name = "gdsfactory"
+readme = "README.md"
+requires-python = ">=3.10"
+version = "7.0.0"
+
+[project.optional-dependencies]
 dev = [
   "autotyping",
   "black>=21",
   "doc8",
   "ipykernel",
   "jsondiff",
   "mypy",
   "pre-commit",
   "pylsp-mypy",
   "pytest",
   "pytest-cov",
   "pytest_regressions",
   "types-PyYAML",
   "types-cachetools",
-  "xdoctest",
+  "xdoctest"
 ]
 docs = [
   "autodoc_pydantic",
   "jupytext",
   "jupyter-book==0.15.1",
   "pydata_sphinx_theme==0.13.1",
-]
-ray = [
-  "ray[tune,air]",
-  "hyperopt"
+  "plotly"
 ]
 
-[tool.setuptools.packages]
-find = {}
-
 [project.scripts]
 gf = "gdsfactory.cli:cli"
 
 [tool.black]
-line-length = 88
-target-version = ['py310']
-include = '\.pyi?$'
 exclude = '''  # Specify the files/dirs that should be ignored by the black formatter
 /(
     \.eggs
     | \.git
     | \.hg
     | \.mypy_cache
     | \.tox
@@ -155,40 +99,27 @@
     | env
     | _build
     | buck-out
     | build
     | dist
  )/
 '''
+include = '\.pyi?$'
+line-length = 88
+target-version = ['py310']
 
-[tool.pytest.ini_options]
-testpaths = ["gdsfactory/", "tests"]
-# addopts = --tb=no
-addopts = '--tb=short --ignore=gdsfactory/schematic_editor.py --ignore=gdsfactory/klayout_tech.py --ignore=gdsfactory/geometry/maskprep_flat.py --ignore=gdsfactory/fill_klayout.py'
-python_files = ["gdsfactory/*.py","tests/*.py"]
-norecursedirs = [
-  "gdsfactory/plugins",
-  "gdsfactory/simulation",
-  "gdsfactory/geometry",
-  "extra/*.py",
-  "gdsfactory/watch.py",
-  "gdsfactory/schematic_editor.py",
-  "gdsfactory/database",
-  "gdsfactory/generic_tech/klayout",
-  "gdsfactory/simulation/simphony",
-  "gdsfactory/tests/test_klayout",
-]
+[tool.codespell]
+ignore-words-list = "te, te/tm, te, ba, fpr, fpr_spacing, ro, nd, donot, schem"
 
-[tool.flake8]
-max-line-length = 88
-max-complexity = 57
-select = ["B","C","E","F","W","T4","B9"]
-ignore = [ "E501", "E503", "E722", "W503", "W503", "E203", "B950", "B305", "B018", "B902", "B020", "B905"]
-extend-ignore = "RST303"
+[tool.commitizen]
+name = "cz_conventional_commits"
+version = "0.1.0"
+version_files = ["pyproject.toml:version"]
 
+[tool.flake8]
 exclude = [
   ".git",
   "__pycache__",
   "lib",
   "docs/source/conf.py",
   "build",
   "dist",
@@ -197,63 +128,96 @@
   "extra",
   "deprecated",
   "gdslib",
   ".mypy_cache",
   "venv",
   "devsim"
 ]
-
-[tool.commitizen]
-name = "cz_conventional_commits"
-version = "0.1.0"
-version_files = [
-  "pyproject.toml:version",
-]
-
-[tool.ruff]
-select = [
-  "E",  # pycodestyle errors
-  "W",  # pycodestyle warnings
-  "F",  # pyflakes
-# "I",  # isort
-  "C",  # flake8-comprehensions
-  "B",  # flake8-bugbear
-]
+extend-ignore = "RST303"
 ignore = [
-  "E501",  # line too long, handled by black
-  "B008",  # do not perform function calls in argument defaults
-  "C901",  # too complex
-  "B905",  # `zip()` without an explicit `strict=` parameter
-  "C408",  # C408 Unnecessary `dict` call (rewrite as a literal)
-  "B904",
-  "B028",  # stacklevel
+  "E501",
+  "E503",
+  "E722",
+  "W503",
+  "W503",
+  "E203",
+  "B950",
+  "B305",
+  "B018",
+  "B902",
+  "B020",
+  "B905"
 ]
-extend-exclude = ["docs/notebooks"]
+max-complexity = 57
+max-line-length = 88
+select = ["B", "C", "E", "F", "W", "T4", "B9"]
+
+[tool.jupytext]
+cell_metadata_filter = "-all"
+notebook_metadata_filter = "-all"
 
 [tool.mypy]
 python_version = "3.10"
 strict = true
 
 [tool.pylsp-mypy]
 enabled = true
 live_mode = true
 strict = true
 
-[tool.jupytext]
-formats = "docs"
-notebook_metadata_filter = "-all"
-cell_metadata_filter = "-all"
+[tool.pytest.ini_options]
+# addopts = --tb=no
+addopts = '--tb=short --ignore=gdsfactory/schematic_editor.py --ignore=gdsfactory/klayout_tech.py --ignore=gdsfactory/geometry/maskprep_flat.py --ignore=gdsfactory/fill_klayout.py'
+datadir = "test-data-regression"
+norecursedirs = [
+  "gdsfactory/samples/notebooks",
+  "gdsfactory/geometry",
+  "gdsfactory/plugins",
+  "gdsfactory/simulation",
+  "extra",
+  "gdsfactory/watch.py",
+  "gdsfactory/schematic_editor.py",
+  "gdsfactory/generic_tech/klayout"
+]
+python_files = ["gdsfactory/*.py", "tests/*.py"]
+testpaths = ["gdsfactory/", "tests"]
+
+[tool.ruff]
+extend-exclude = ['gdsfactory/samples/notebooks/']
+fix = true
+ignore = [
+  "E501",  # line too long, handled by black
+  "B008",  # do not perform function calls in argument defaults
+  "C901",  # too complex
+  "B905",  # `zip()` without an explicit `strict=` parameter
+  "C408",  # C408 Unnecessary `dict` call (rewrite as a literal)
+  "B904",
+  "B028"  # stacklevel
+]
+select = [
+  "E",  # pycodestyle errors
+  "W",  # pycodestyle warnings
+  "F",  # pyflakes
+  "I",  # isort
+  "C",  # flake8-comprehensions
+  "B",  # flake8-bugbear
+  "UP"
+]
 
-[tool.isort]
-multi_line_output = 3
-line_length = 88
-include_trailing_comma = true
-skip = "gdsfactory/__init__.py"
+[tool.ruff.per-file-ignores]
+"gdsfactory/samples/notebooks/*.py" = ["F821", 'E402', 'F405', 'F403']
+"gdsfactory/typings.py" = ["UP035"]
 
 [tool.setuptools.package-data]
-mypkg = ["*.gds", "*.lym", "*.lyp", "*.lyt", "*.csv", "*.yaml", "*.md", "LICENSE"]
+mypkg = [
+  "*.gds",
+  "*.lym",
+  "*.lyp",
+  "*.lyt",
+  "*.csv",
+  "*.yaml",
+  "*.md",
+  "LICENSE"
+]
 
-[tool.pydocstyle]
-inherit = false
-match = "(?!test).*\\.py"
-add-ignore = ["D100","D101","D102","D103","D104","D203","D405","D417"]
-convention = "google"
+[tool.setuptools.packages]
+find = {}
```

