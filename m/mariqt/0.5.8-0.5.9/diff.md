# Comparing `tmp/mariqt-0.5.8-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.5.9-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 214833 bytes, number of entries: 31
--rw-r--r--  2.0 unx     5876 b- defN 23-Jul-25 14:34 mariqt/converters.py
--rw-r--r--  2.0 unx    14710 b- defN 23-Jul-25 14:34 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-Jul-25 14:34 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-Jul-25 14:34 mariqt/equipment.py
--rw-r--r--  2.0 unx    16621 b- defN 23-Jul-25 14:34 mariqt/files.py
--rw-r--r--  2.0 unx    28565 b- defN 23-Jul-25 14:34 mariqt/geo.py
--rw-r--r--  2.0 unx    23207 b- defN 23-Jul-25 14:34 mariqt/image.py
--rw-r--r--  2.0 unx     3090 b- defN 23-Jul-25 14:34 mariqt/misc.py
--rw-r--r--  2.0 unx    40980 b- defN 23-Jul-25 14:34 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-Jul-25 14:34 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-Jul-25 14:34 mariqt/reports.py
--rw-r--r--  2.0 unx     4376 b- defN 23-Jul-25 14:34 mariqt/settings.py
--rw-r--r--  2.0 unx     8323 b- defN 23-Jul-25 14:34 mariqt/tests.py
--rw-r--r--  2.0 unx     9613 b- defN 23-Jul-25 14:34 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-Jul-25 14:34 mariqt/version.py
--rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-25 14:34 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
--rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-25 14:34 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
--rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-25 14:34 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
--rw-r--r--  2.0 unx    12135 b- defN 23-Jul-25 14:34 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4684 b- defN 23-Jul-25 14:34 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-Jul-25 14:34 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   118284 b- defN 23-Jul-25 14:34 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-Jul-25 14:34 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-Jul-25 14:34 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jul-25 14:34 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/AUTHORS.md
--rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/LICENSE
--rw-r--r--  2.0 unx     1133 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/RECORD
-31 files, 1081631 bytes uncompressed, 210807 bytes compressed:  80.5%
+Zip file size: 214854 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     5876 b- defN 23-Jul-26 13:10 mariqt/converters.py
+-rw-r--r--  2.0 unx    14751 b- defN 23-Jul-26 13:10 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-Jul-26 13:10 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jul-26 13:10 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 23-Jul-26 13:10 mariqt/files.py
+-rw-r--r--  2.0 unx    28565 b- defN 23-Jul-26 13:10 mariqt/geo.py
+-rw-r--r--  2.0 unx    23207 b- defN 23-Jul-26 13:10 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 23-Jul-26 13:10 mariqt/misc.py
+-rw-r--r--  2.0 unx    40980 b- defN 23-Jul-26 13:10 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-Jul-26 13:10 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-Jul-26 13:10 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 23-Jul-26 13:10 mariqt/settings.py
+-rw-r--r--  2.0 unx     8323 b- defN 23-Jul-26 13:10 mariqt/tests.py
+-rw-r--r--  2.0 unx     9613 b- defN 23-Jul-26 13:10 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-Jul-26 13:10 mariqt/version.py
+-rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-26 13:10 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-26 13:10 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+-rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-26 13:10 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 23-Jul-26 13:10 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jul-26 13:10 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-Jul-26 13:10 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   118335 b- defN 23-Jul-26 13:10 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-Jul-26 13:10 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-Jul-26 13:10 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-26 13:10 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-26 13:12 mariqt-0.5.9.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-26 13:12 mariqt-0.5.9.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-Jul-26 13:12 mariqt-0.5.9.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jul-26 13:12 mariqt-0.5.9.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Jul-26 13:12 mariqt-0.5.9.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-26 13:12 mariqt-0.5.9.dist-info/RECORD
+31 files, 1081723 bytes uncompressed, 210828 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.5.8.dist-info/AUTHORS.md
+Filename: mariqt-0.5.9.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.5.8.dist-info/LICENSE
+Filename: mariqt-0.5.9.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.5.8.dist-info/METADATA
+Filename: mariqt-0.5.9.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.5.8.dist-info/WHEEL
+Filename: mariqt-0.5.9.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.5.8.dist-info/top_level.txt
+Filename: mariqt-0.5.9.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.5.8.dist-info/RECORD
+Filename: mariqt-0.5.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/core.py

```diff
@@ -126,14 +126,18 @@
 
 def recursivelyUpdateDicts(oldDict:dict, newDict:dict, mutuallyExclusives:list=[]):
 	""" Recursively updates oldDict with newDict.
 		Merges item entries with identical image-datetime.
 	 	Item entries without image-datetime will get image default (start) datetime.
 		Item lists will be sorted by image-datetime. """
 	log = []
+	
+	if oldDict == newDict:
+		return log
+	
 	for newItem in newDict:
 		# special case for updating video items which may contain of a list of dicts, each with a different timestamp which have to be checked and then get updated
 		try:
 			# both items are not lists
 			if not identical_mariqt_datetime(newDict[newItem]['image-datetime'], oldDict[newItem]['image-datetime']):
 				oldDict[newItem] = [oldDict[newItem]] # will be handled in bellow
 		except:
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.5.8'
+__version__ = '0.5.9'
```

## mariqt/sources/ifdo.py

```diff
@@ -3707,3687 +3707,3690 @@
 0000e7a0: 6572 5f66 6965 6c64 7328 6865 6164 6572  er_fields(header
 0000e7b0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
 0000e7c0: 6974 656d 730a 2020 2020 2020 2020 2020  items.          
 0000e7d0: 2020 2320 7570 6461 7465 2063 6f70 7920    # update copy 
 0000e7e0: 6f66 2063 7572 7265 6e74 2069 7465 6d73  of current items
 0000e7f0: 2077 6974 6820 6e65 7720 6974 656d 7320   with new items 
 0000e800: 6669 656c 6473 0a20 2020 2020 2020 2020  fields.         
-0000e810: 2020 2069 7465 6d73 4469 6374 203d 206d     itemsDict = m
-0000e820: 6971 7469 2e63 7265 6174 6549 6d61 6765  iqti.createImage
-0000e830: 4974 656d 7344 6963 7446 726f 6d49 6d61  ItemsDictFromIma
-0000e840: 6765 4974 656d 734c 6973 7428 6974 656d  geItemsList(item
-0000e850: 7329 0a20 2020 2020 2020 2020 2020 2075  s).            u
-0000e860: 7064 6174 6564 4974 656d 735f 636f 7079  pdatedItems_copy
-0000e870: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-0000e880: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-0000e890: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000e8a0: 734b 6579 5d29 0a20 2020 2020 2020 2020  sKey]).         
-0000e8b0: 2020 206c 6f67 203d 206d 6971 7463 2e72     log = miqtc.r
-0000e8c0: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
-0000e8d0: 4469 6374 7328 7570 6461 7465 6449 7465  Dicts(updatedIte
-0000e8e0: 6d73 5f63 6f70 792c 2069 7465 6d73 4469  ms_copy, itemsDi
-0000e8f0: 6374 290a 2020 2020 2020 2020 2020 2020  ct).            
-0000e900: 7365 6c66 2e70 726f 762e 6c6f 6728 6c6f  self.prov.log(lo
-0000e910: 672c 646f 6e74 5368 6f77 3d54 7275 6529  g,dontShow=True)
-0000e920: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-0000e930: 6d73 203d 206d 6971 7469 2e63 7265 6174  ms = miqti.creat
-0000e940: 6549 6d61 6765 4974 656d 734c 6973 7446  eImageItemsListF
-0000e950: 726f 6d49 6d61 6765 4974 656d 7344 6963  romImageItemsDic
-0000e960: 7428 7570 6461 7465 6449 7465 6d73 5f63  t(updatedItems_c
-0000e970: 6f70 7929 0a0a 2020 2020 2020 2020 656c  opy)..        el
-0000e980: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000e990: 2320 6f76 6572 7772 6974 6520 6865 6164  # overwrite head
-0000e9a0: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
-0000e9b0: 656c 662e 7365 7469 4644 4f48 6561 6465  elf.setiFDOHeade
-0000e9c0: 7246 6965 6c64 7328 6865 6164 6572 290a  rFields(header).
-0000e9d0: 2020 2020 2020 2020 2020 2020 2320 636c              # cl
-0000e9e0: 6561 7220 6974 656d 7320 7365 6374 696f  ear items sectio
-0000e9f0: 6e0a 2020 2020 2020 2020 2020 2020 7365  n.            se
-0000ea00: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000ea10: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-0000ea20: 795d 203d 207b 7d0a 0a20 2020 2020 2020  y] = {}..       
-0000ea30: 2023 2050 6172 7365 2069 6d61 6765 2d61   # Parse image-a
-0000ea40: 6273 7472 6163 7420 616e 6420 6669 6c6c  bstract and fill
-0000ea50: 2069 7473 2070 6c61 6365 686f 6c64 6572   its placeholder
-0000ea60: 7320 7769 7468 2069 6e66 6f72 6d61 7469  s with informati
-0000ea70: 6f6e 0a20 2020 2020 2020 2074 7279 3a0a  on.        try:.
-0000ea80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ea90: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000eaa0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000eab0: 5d5b 2769 6d61 6765 2d61 6273 7472 6163  ]['image-abstrac
-0000eac0: 7427 5d20 3d20 6d69 7174 732e 7061 7273  t'] = miqts.pars
-0000ead0: 6552 6570 6c61 6365 5661 6c28 7365 6c66  eReplaceVal(self
-0000eae0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000eaf0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000eb00: 5d2c 2027 696d 6167 652d 6162 7374 7261  ], 'image-abstra
-0000eb10: 6374 2729 0a20 2020 2020 2020 2065 7863  ct').        exc
-0000eb20: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-0000eb30: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
-0000eb40: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000eb50: 436f 756c 6420 6e6f 7420 7265 706c 6163  Could not replac
-0000eb60: 6520 6b65 7973 2069 6e20 5c27 696d 6167  e keys in \'imag
-0000eb70: 652d 6162 7374 7261 6374 5c27 3a20 2220  e-abstract\': " 
-0000eb80: 2b20 7374 7228 6578 2929 0a0a 0a20 2020  + str(ex))...   
-0000eb90: 2020 2020 2023 2073 6574 2076 6572 7369       # set versi
-0000eba0: 6f6e 2028 736f 2069 7420 6361 6e6e 6f74  on (so it cannot
-0000ebb0: 2062 6520 6368 616e 6765 6420 6279 2075   be changed by u
-0000ebc0: 7365 7229 0a20 2020 2020 2020 2073 656c  ser).        sel
-0000ebd0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000ebe0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000ebf0: 795d 5b27 696d 6167 652d 7365 742d 6966  y]['image-set-if
-0000ec00: 646f 2d76 6572 7369 6f6e 275d 203d 206d  do-version'] = m
-0000ec10: 6971 7476 2e69 4644 4f5f 7665 7273 696f  iqtv.iFDO_versio
-0000ec20: 6e0a 0a20 2020 2020 2020 2023 2056 616c  n..        # Val
-0000ec30: 6964 6174 6520 6974 656d 2069 6e66 6f72  idate item infor
-0000ec40: 6d61 7469 6f6e 0a20 2020 2020 2020 2069  mation.        i
-0000ec50: 6d61 6765 5f73 6574 5f69 7465 6d73 203d  mage_set_items =
-0000ec60: 207b 7d0a 2020 2020 2020 2020 6966 2068   {}.        if h
-0000ec70: 6561 6465 724f 6e6c 793a 0a20 2020 2020  eaderOnly:.     
-0000ec80: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000ec90: 2e6c 6f67 2822 4361 7574 696f 6e21 2069  .log("Caution! i
-0000eca0: 4644 4f20 6372 6561 7465 6420 696e 2068  FDO created in h
-0000ecb0: 6561 6465 725f 6f6e 6c79 2f69 676e 6f72  eader_only/ignor
-0000ecc0: 655f 696d 6167 655f 6669 6c65 206d 6f64  e_image_file mod
-0000ecd0: 652e 2049 6d61 6765 2069 7465 6d73 2061  e. Image items a
-0000ece0: 7265 206e 6569 7468 6572 2075 7064 6174  re neither updat
-0000ecf0: 6564 206e 6f72 2063 6865 636b 6564 2e22  ed nor checked."
-0000ed00: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000ed10: 2020 2020 2020 2020 2020 2020 696e 7661              inva
-0000ed20: 6c69 645f 6974 656d 7320 3d20 300a 0a20  lid_items = 0.. 
-0000ed30: 2020 2020 2020 2020 2020 2070 726f 6720             prog 
-0000ed40: 3d20 6d69 7174 632e 5072 696e 744b 6e6f  = miqtc.PrintKno
-0000ed50: 776e 5072 6f67 7265 7373 4d73 6728 2243  wnProgressMsg("C
-0000ed60: 6865 636b 696e 6720 6974 656d 7322 2c20  hecking items", 
-0000ed70: 6c65 6e28 6974 656d 7329 2c6d 6f64 756c  len(items),modul
-0000ed80: 6f3d 3529 0a20 2020 2020 2020 2020 2020  o=5).           
-0000ed90: 2066 6f72 2069 7465 6d20 696e 2069 7465   for item in ite
-0000eda0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-0000edb0: 2020 2020 7072 6f67 2e70 726f 6772 6573      prog.progres
-0000edc0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0000edd0: 2020 2020 2320 6368 6563 6b20 6966 2061      # check if a
-0000ede0: 6c6c 2063 6f72 6520 6669 656c 6473 2061  ll core fields a
-0000edf0: 7265 2066 696c 6c65 6420 616e 6420 6172  re filled and ar
-0000ee00: 6520 6669 6c6c 6564 2076 616c 6964 6c79  e filled validly
-0000ee10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ee20: 2074 7279 3a0a 0a20 2020 2020 2020 2020   try:..         
-0000ee30: 2020 2020 2020 2020 2020 2023 2063 6865             # che
-0000ee40: 636b 2069 7465 6d20 696d 6167 6520 6578  ck item image ex
-0000ee50: 6973 7473 0a20 2020 2020 2020 2020 2020  ists.           
-0000ee60: 2020 2020 2020 2020 2023 2069 6620 6974           # if it
-0000ee70: 656d 2069 7320 6120 6c69 7374 2028 7669  em is a list (vi
-0000ee80: 6465 6f29 2c20 6f6e 6520 776f 756c 6420  deo), one would 
-0000ee90: 6861 7665 2074 6f20 6368 6563 6b20 6966  have to check if
-0000eea0: 2065 6163 6820 656e 7472 7920 6973 2076   each entry is v
-0000eeb0: 616c 6964 2067 6976 656e 2074 6865 2064  alid given the d
-0000eec0: 6566 6175 6c74 2076 616c 7565 7320 696e  efault values in
-0000eed0: 2066 6972 7374 2065 6e74 7279 2070 6c75   first entry plu
-0000eee0: 7320 6769 7665 6e20 6465 6661 756c 7420  s given default 
-0000eef0: 7661 6c75 6573 2069 6e20 6865 6164 6572  values in header
-0000ef00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef10: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-0000ef20: 7374 616e 6365 2869 7465 6d2c 6c69 7374  stance(item,list
-0000ef30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000ef40: 2020 2020 2020 2020 2020 2069 7465 6d20             item 
-0000ef50: 3d20 5b69 7465 6d5d 0a20 2020 2020 2020  = [item].       
-0000ef60: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-0000ef70: 4974 656d 4465 6661 756c 7420 3d20 6974  ItemDefault = it
-0000ef80: 656d 5b30 5d20 0a20 2020 2020 2020 2020  em[0] .         
-0000ef90: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0000efa0: 7562 4974 656d 2069 6e20 6974 656d 3a0a  ubItem in item:.
-0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efc0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-0000efd0: 6520 3d20 7375 6249 7465 6d5b 2769 6d61  e = subItem['ima
-0000efe0: 6765 2d66 696c 656e 616d 6527 5d0a 2020  ge-filename'].  
-0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f000: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000f010: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
-0000f020: 696c 6573 2061 6e64 2066 696c 655f 6e61  iles and file_na
-0000f030: 6d65 206e 6f74 2069 6e20 7365 6c66 2e5f  me not in self._
-0000f040: 696d 6167 654e 616d 6573 496d 6167 6573  imageNamesImages
-0000f050: 4469 723a 0a20 2020 2020 2020 2020 2020  Dir:.           
-0000f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f070: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000f080: 2822 4974 656d 2027 2220 2b20 6669 6c65  ("Item '" + file
-0000f090: 5f6e 616d 6520 2b20 2227 206e 6f74 2066  _name + "' not f
-0000f0a0: 6f75 6e64 2069 6e20 2f72 6177 2064 6972  ound in /raw dir
-0000f0b0: 6563 746f 7279 2e22 290a 0a20 2020 2020  ectory.")..     
-0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0d0: 2020 2069 6620 7661 6c69 6461 7465 5f73     if validate_s
-0000f0e0: 696e 676c 655f 6974 656d 733a 0a20 2020  ingle_items:.   
+0000e810: 2020 2069 6620 6e6f 7420 6865 6164 6572     if not header
+0000e820: 4f6e 6c79 3a0a 2020 2020 2020 2020 2020  Only:.          
+0000e830: 2020 2020 2020 6974 656d 7344 6963 7420        itemsDict 
+0000e840: 3d20 6d69 7174 692e 6372 6561 7465 496d  = miqti.createIm
+0000e850: 6167 6549 7465 6d73 4469 6374 4672 6f6d  ageItemsDictFrom
+0000e860: 496d 6167 6549 7465 6d73 4c69 7374 2869  ImageItemsList(i
+0000e870: 7465 6d73 290a 2020 2020 2020 2020 2020  tems).          
+0000e880: 2020 2020 2020 7570 6461 7465 6449 7465        updatedIte
+0000e890: 6d73 5f63 6f70 7920 3d20 636f 7079 2e64  ms_copy = copy.d
+0000e8a0: 6565 7063 6f70 7928 7365 6c66 2e69 6664  eepcopy(self.ifd
+0000e8b0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000e8c0: 5365 7449 7465 6d73 4b65 795d 290a 2020  SetItemsKey]).  
+0000e8d0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0000e8e0: 6720 3d20 6d69 7174 632e 7265 6375 7273  g = miqtc.recurs
+0000e8f0: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
+0000e900: 2875 7064 6174 6564 4974 656d 735f 636f  (updatedItems_co
+0000e910: 7079 2c20 6974 656d 7344 6963 7429 0a20  py, itemsDict). 
+0000e920: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000e930: 656c 662e 7072 6f76 2e6c 6f67 286c 6f67  elf.prov.log(log
+0000e940: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+0000e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e960: 6974 656d 7320 3d20 6d69 7174 692e 6372  items = miqti.cr
+0000e970: 6561 7465 496d 6167 6549 7465 6d73 4c69  eateImageItemsLi
+0000e980: 7374 4672 6f6d 496d 6167 6549 7465 6d73  stFromImageItems
+0000e990: 4469 6374 2875 7064 6174 6564 4974 656d  Dict(updatedItem
+0000e9a0: 735f 636f 7079 290a 0a20 2020 2020 2020  s_copy)..       
+0000e9b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000e9c0: 2020 2023 206f 7665 7277 7269 7465 2068     # overwrite h
+0000e9d0: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
+0000e9e0: 2020 7365 6c66 2e73 6574 6946 444f 4865    self.setiFDOHe
+0000e9f0: 6164 6572 4669 656c 6473 2868 6561 6465  aderFields(heade
+0000ea00: 7229 0a20 2020 2020 2020 2020 2020 2023  r).            #
+0000ea10: 2063 6c65 6172 2069 7465 6d73 2073 6563   clear items sec
+0000ea20: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+0000ea30: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000ea40: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+0000ea50: 734b 6579 5d20 3d20 7b7d 0a0a 2020 2020  sKey] = {}..    
+0000ea60: 2020 2020 2320 5061 7273 6520 696d 6167      # Parse imag
+0000ea70: 652d 6162 7374 7261 6374 2061 6e64 2066  e-abstract and f
+0000ea80: 696c 6c20 6974 7320 706c 6163 6568 6f6c  ill its placehol
+0000ea90: 6465 7273 2077 6974 6820 696e 666f 726d  ders with inform
+0000eaa0: 6174 696f 6e0a 2020 2020 2020 2020 7472  ation.        tr
+0000eab0: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
+0000eac0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000ead0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000eae0: 4b65 795d 5b27 696d 6167 652d 6162 7374  Key]['image-abst
+0000eaf0: 7261 6374 275d 203d 206d 6971 7473 2e70  ract'] = miqts.p
+0000eb00: 6172 7365 5265 706c 6163 6556 616c 2873  arseReplaceVal(s
+0000eb10: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000eb20: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000eb30: 4b65 795d 2c20 2769 6d61 6765 2d61 6273  Key], 'image-abs
+0000eb40: 7472 6163 7427 290a 2020 2020 2020 2020  tract').        
+0000eb50: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0000eb60: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
+0000eb70: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000eb80: 6728 2243 6f75 6c64 206e 6f74 2072 6570  g("Could not rep
+0000eb90: 6c61 6365 206b 6579 7320 696e 205c 2769  lace keys in \'i
+0000eba0: 6d61 6765 2d61 6273 7472 6163 745c 273a  mage-abstract\':
+0000ebb0: 2022 202b 2073 7472 2865 7829 290a 0a0a   " + str(ex))...
+0000ebc0: 2020 2020 2020 2020 2320 7365 7420 7665          # set ve
+0000ebd0: 7273 696f 6e20 2873 6f20 6974 2063 616e  rsion (so it can
+0000ebe0: 6e6f 7420 6265 2063 6861 6e67 6564 2062  not be changed b
+0000ebf0: 7920 7573 6572 290a 2020 2020 2020 2020  y user).        
+0000ec00: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000ec10: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000ec20: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
+0000ec30: 2d69 6664 6f2d 7665 7273 696f 6e27 5d20  -ifdo-version'] 
+0000ec40: 3d20 6d69 7174 762e 6946 444f 5f76 6572  = miqtv.iFDO_ver
+0000ec50: 7369 6f6e 0a0a 2020 2020 2020 2020 2320  sion..        # 
+0000ec60: 5661 6c69 6461 7465 2069 7465 6d20 696e  Validate item in
+0000ec70: 666f 726d 6174 696f 6e0a 2020 2020 2020  formation.      
+0000ec80: 2020 696d 6167 655f 7365 745f 6974 656d    image_set_item
+0000ec90: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
+0000eca0: 6620 6865 6164 6572 4f6e 6c79 3a0a 2020  f headerOnly:.  
+0000ecb0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000ecc0: 726f 762e 6c6f 6728 2243 6175 7469 6f6e  rov.log("Caution
+0000ecd0: 2120 6946 444f 2063 7265 6174 6564 2069  ! iFDO created i
+0000ece0: 6e20 6865 6164 6572 5f6f 6e6c 792f 6967  n header_only/ig
+0000ecf0: 6e6f 7265 5f69 6d61 6765 5f66 696c 6520  nore_image_file 
+0000ed00: 6d6f 6465 2e20 496d 6167 6520 6974 656d  mode. Image item
+0000ed10: 7320 6172 6520 6e65 6974 6865 7220 7570  s are neither up
+0000ed20: 6461 7465 6420 6e6f 7220 6368 6563 6b65  dated nor checke
+0000ed30: 642e 2229 0a20 2020 2020 2020 2065 6c73  d.").        els
+0000ed40: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0000ed50: 6e76 616c 6964 5f69 7465 6d73 203d 2030  nvalid_items = 0
+0000ed60: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+0000ed70: 6f67 203d 206d 6971 7463 2e50 7269 6e74  og = miqtc.Print
+0000ed80: 4b6e 6f77 6e50 726f 6772 6573 734d 7367  KnownProgressMsg
+0000ed90: 2822 4368 6563 6b69 6e67 2069 7465 6d73  ("Checking items
+0000eda0: 222c 206c 656e 2869 7465 6d73 292c 6d6f  ", len(items),mo
+0000edb0: 6475 6c6f 3d35 290a 2020 2020 2020 2020  dulo=5).        
+0000edc0: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+0000edd0: 6974 656d 733a 0a20 2020 2020 2020 2020  items:.         
+0000ede0: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
+0000edf0: 7265 7373 2829 0a20 2020 2020 2020 2020  ress().         
+0000ee00: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
+0000ee10: 6620 616c 6c20 636f 7265 2066 6965 6c64  f all core field
+0000ee20: 7320 6172 6520 6669 6c6c 6564 2061 6e64  s are filled and
+0000ee30: 2061 7265 2066 696c 6c65 6420 7661 6c69   are filled vali
+0000ee40: 646c 790a 2020 2020 2020 2020 2020 2020  dly.            
+0000ee50: 2020 2020 7472 793a 0a0a 2020 2020 2020      try:..      
+0000ee60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000ee70: 6368 6563 6b20 6974 656d 2069 6d61 6765  check item image
+0000ee80: 2065 7869 7374 730a 2020 2020 2020 2020   exists.        
+0000ee90: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+0000eea0: 2069 7465 6d20 6973 2061 206c 6973 7420   item is a list 
+0000eeb0: 2876 6964 656f 292c 206f 6e65 2077 6f75  (video), one wou
+0000eec0: 6c64 2068 6176 6520 746f 2063 6865 636b  ld have to check
+0000eed0: 2069 6620 6561 6368 2065 6e74 7279 2069   if each entry i
+0000eee0: 7320 7661 6c69 6420 6769 7665 6e20 7468  s valid given th
+0000eef0: 6520 6465 6661 756c 7420 7661 6c75 6573  e default values
+0000ef00: 2069 6e20 6669 7273 7420 656e 7472 7920   in first entry 
+0000ef10: 706c 7573 2067 6976 656e 2064 6566 6175  plus given defau
+0000ef20: 6c74 2076 616c 7565 7320 696e 2068 6561  lt values in hea
+0000ef30: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+0000ef40: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0000ef50: 7369 6e73 7461 6e63 6528 6974 656d 2c6c  sinstance(item,l
+0000ef60: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
+0000ef70: 2020 2020 2020 2020 2020 2020 2020 6974                it
+0000ef80: 656d 203d 205b 6974 656d 5d0a 2020 2020  em = [item].    
+0000ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efa0: 7375 6249 7465 6d44 6566 6175 6c74 203d  subItemDefault =
+0000efb0: 2069 7465 6d5b 305d 200a 2020 2020 2020   item[0] .      
+0000efc0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000efd0: 7220 7375 6249 7465 6d20 696e 2069 7465  r subItem in ite
+0000efe0: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+0000eff0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+0000f000: 6e61 6d65 203d 2073 7562 4974 656d 5b27  name = subItem['
+0000f010: 696d 6167 652d 6669 6c65 6e61 6d65 275d  image-filename']
+0000f020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f030: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000f040: 7365 6c66 2e69 676e 6f72 655f 696d 6167  self.ignore_imag
+0000f050: 655f 6669 6c65 7320 616e 6420 6669 6c65  e_files and file
+0000f060: 5f6e 616d 6520 6e6f 7420 696e 2073 656c  _name not in sel
+0000f070: 662e 5f69 6d61 6765 4e61 6d65 7349 6d61  f._imageNamesIma
+0000f080: 6765 7344 6972 3a0a 2020 2020 2020 2020  gesDir:.        
+0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0a0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0000f0b0: 696f 6e28 2249 7465 6d20 2722 202b 2066  ion("Item '" + f
+0000f0c0: 696c 655f 6e61 6d65 202b 2022 2720 6e6f  ile_name + "' no
+0000f0d0: 7420 666f 756e 6420 696e 202f 7261 7720  t found in /raw 
+0000f0e0: 6469 7265 6374 6f72 792e 2229 0a0a 2020  directory.")..  
 0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f100: 2020 2020 2020 2020 206d 6971 7474 2e61           miqtt.a
-0000f110: 7265 5f76 616c 6964 5f69 6664 6f5f 6669  re_valid_ifdo_fi
-0000f120: 656c 6473 2873 7562 4974 656d 290a 2020  elds(subItem).  
-0000f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f140: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f160: 2020 2020 2020 2020 666f 7220 6669 656c          for fiel
-0000f170: 645f 6e61 6d65 2c66 6965 6c64 5f76 616c  d_name,field_val
-0000f180: 2069 6e20 7375 6249 7465 6d2e 6974 656d   in subItem.item
-0000f190: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1b0: 2020 2020 206d 6971 7474 2e69 6664 6f5f       miqtt.ifdo_
-0000f1c0: 6669 656c 645f 6164 6469 7469 6f6e 616c  field_additional
-0000f1d0: 5f63 6865 636b 7328 6669 656c 645f 6e61  _checks(field_na
-0000f1e0: 6d65 2c66 6965 6c64 5f76 616c 2920 2020  me,field_val)   
-0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f200: 2020 2020 200a 0a20 2020 2020 2020 2020       ..         
-0000f210: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0000f220: 5f73 6574 5f69 7465 6d73 5b73 7562 4974  _set_items[subIt
-0000f230: 656d 4465 6661 756c 745b 2769 6d61 6765  emDefault['image
-0000f240: 2d66 696c 656e 616d 6527 5d5d 203d 205b  -filename']] = [
-0000f250: 5d20 2320 636f 756c 6420 6d61 6b65 2061  ] # could make a
-0000f260: 6e20 6578 7472 6120 6361 7365 2066 6f72  n extra case for
-0000f270: 2069 6d61 6765 7320 6f6d 6974 7469 6e67   images omitting
-0000f280: 2074 6865 206c 6973 740a 2020 2020 2020   the list.      
-0000f290: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000f2a0: 7220 7375 6249 7465 6d20 696e 2069 7465  r subItem in ite
-0000f2b0: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
-0000f2c0: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
-0000f2d0: 656d 4469 6374 203d 207b 7d0a 2020 2020  emDict = {}.    
-0000f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2f0: 2020 2020 666f 7220 6974 2069 6e20 7375      for it in su
-0000f300: 6249 7465 6d3a 0a20 2020 2020 2020 2020  bItem:.         
+0000f100: 2020 2020 2020 6966 2076 616c 6964 6174        if validat
+0000f110: 655f 7369 6e67 6c65 5f69 7465 6d73 3a0a  e_single_items:.
+0000f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f130: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+0000f140: 742e 6172 655f 7661 6c69 645f 6966 646f  t.are_valid_ifdo
+0000f150: 5f66 6965 6c64 7328 7375 6249 7465 6d29  _fields(subItem)
+0000f160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f170: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f190: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+0000f1a0: 6965 6c64 5f6e 616d 652c 6669 656c 645f  ield_name,field_
+0000f1b0: 7661 6c20 696e 2073 7562 4974 656d 2e69  val in subItem.i
+0000f1c0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1e0: 2020 2020 2020 2020 6d69 7174 742e 6966          miqtt.if
+0000f1f0: 646f 5f66 6965 6c64 5f61 6464 6974 696f  do_field_additio
+0000f200: 6e61 6c5f 6368 6563 6b73 2866 6965 6c64  nal_checks(field
+0000f210: 5f6e 616d 652c 6669 656c 645f 7661 6c29  _name,field_val)
+0000f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f230: 2020 2020 2020 2020 0a0a 2020 2020 2020          ..      
+0000f240: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0000f250: 6167 655f 7365 745f 6974 656d 735b 7375  age_set_items[su
+0000f260: 6249 7465 6d44 6566 6175 6c74 5b27 696d  bItemDefault['im
+0000f270: 6167 652d 6669 6c65 6e61 6d65 275d 5d20  age-filename']] 
+0000f280: 3d20 5b5d 2023 2063 6f75 6c64 206d 616b  = [] # could mak
+0000f290: 6520 616e 2065 7874 7261 2063 6173 6520  e an extra case 
+0000f2a0: 666f 7220 696d 6167 6573 206f 6d69 7474  for images omitt
+0000f2b0: 696e 6720 7468 6520 6c69 7374 0a20 2020  ing the list.   
+0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2d0: 2066 6f72 2073 7562 4974 656d 2069 6e20   for subItem in 
+0000f2e0: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
+0000f2f0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0000f300: 6249 7465 6d44 6963 7420 3d20 7b7d 0a20  bItemDict = {}. 
 0000f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f320: 2020 2069 6620 6974 2021 3d20 2769 6d61     if it != 'ima
-0000f330: 6765 2d66 696c 656e 616d 6527 3a0a 2020  ge-filename':.  
+0000f320: 2020 2020 2020 2066 6f72 2069 7420 696e         for it in
+0000f330: 2073 7562 4974 656d 3a0a 2020 2020 2020   subItem:.      
 0000f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f350: 2020 2020 2020 2020 2020 2020 2020 7375                su
-0000f360: 6249 7465 6d44 6963 745b 6974 5d20 3d20  bItemDict[it] = 
-0000f370: 7375 6249 7465 6d5b 6974 5d0a 2020 2020  subItem[it].    
+0000f350: 2020 2020 2020 6966 2069 7420 213d 2027        if it != '
+0000f360: 696d 6167 652d 6669 6c65 6e61 6d65 273a  image-filename':
+0000f370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f390: 2020 2020 696d 6167 655f 7365 745f 6974      image_set_it
-0000f3a0: 656d 735b 7375 6249 7465 6d44 6566 6175  ems[subItemDefau
-0000f3b0: 6c74 5b27 696d 6167 652d 6669 6c65 6e61  lt['image-filena
-0000f3c0: 6d65 275d 5d2e 6170 7065 6e64 2873 7562  me']].append(sub
-0000f3d0: 4974 656d 4469 6374 290a 2020 2020 2020  ItemDict).      
-0000f3e0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0000f3f0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000f400: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
-0000f410: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f430: 696e 7661 6c69 645f 6974 656d 7320 2b3d  invalid_items +=
-0000f440: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-0000f450: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000f460: 2e6c 6f67 2822 496e 7661 6c69 6420 696d  .log("Invalid im
-0000f470: 6167 6520 6974 656d 3a20 222b 2073 7472  age item: "+ str
-0000f480: 2869 7465 6d29 2c64 6f6e 7453 686f 773d  (item),dontShow=
-0000f490: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0000f4a0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000f4b0: 726f 762e 6c6f 6728 2245 7863 6570 7469  rov.log("Excepti
-0000f4c0: 6f6e 3a5c 6e22 2b20 7374 7228 652e 6172  on:\n"+ str(e.ar
-0000f4d0: 6773 292c 646f 6e74 5368 6f77 3d54 7275  gs),dontShow=Tru
-0000f4e0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0000f4f0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-0000f500: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0000f510: 2822 496e 7661 6c69 6420 696d 6167 6520  ("Invalid image 
-0000f520: 6974 656d 2022 2b20 6669 6c65 5f6e 616d  item "+ file_nam
-0000f530: 6520 2b20 223a 5c6e 4578 6365 7074 696f  e + ":\nExceptio
-0000f540: 6e3a 5c6e 222b 2073 7472 2865 2e61 7267  n:\n"+ str(e.arg
-0000f550: 7329 2920 2320 6f74 6865 7277 6973 652c  s)) # otherwise,
-0000f560: 2069 6e20 6361 7365 206f 6620 6d61 6e79   in case of many
-0000f570: 2069 6d61 6765 732c 2069 7420 6d61 7920   images, it may 
-0000f580: 6b65 6570 2072 756e 6e69 6e67 2061 6e64  keep running and
-0000f590: 2074 6872 6f77 696e 6720 6572 726f 7273   throwing errors
-0000f5a0: 2066 6f72 2071 7569 7420 736f 6d65 2074   for quit some t
-0000f5b0: 696d 650a 2020 2020 2020 2020 2020 2020  ime.            
-0000f5c0: 7072 6f67 2e63 6c65 6172 2829 0a0a 2020  prog.clear()..  
-0000f5d0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0000f5e0: 2869 7465 6d73 2920 213d 2030 2061 6e64  (items) != 0 and
-0000f5f0: 2069 6e76 616c 6964 5f69 7465 6d73 203d   invalid_items =
-0000f600: 3d20 6c65 6e28 6974 656d 7329 3a0a 2020  = len(items):.  
-0000f610: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000f620: 6973 6520 4578 6365 7074 696f 6e28 2241  ise Exception("A
-0000f630: 6c6c 2069 7465 6d73 2061 7265 2069 6e76  ll items are inv
-0000f640: 616c 6964 2229 0a20 2020 2020 2020 2020  alid").         
-0000f650: 2020 2065 6c69 6620 696e 7661 6c69 645f     elif invalid_
-0000f660: 6974 656d 7320 3e20 303a 0a20 2020 2020  items > 0:.     
-0000f670: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000f680: 7072 6f76 2e6c 6f67 2822 4174 206c 6561  prov.log("At lea
-0000f690: 7374 2022 202b 2073 7472 2869 6e76 616c  st " + str(inval
-0000f6a0: 6964 5f69 7465 6d73 2920 2b20 2220 6974  id_items) + " it
-0000f6b0: 656d 7320 7765 7265 2069 6e76 616c 6964  ems were invalid
-0000f6c0: 2028 6f66 2220 2b20 7374 7228 6c65 6e28   (of" + str(len(
-0000f6d0: 6974 656d 7329 292b 2022 2922 290a 0a20  items))+ ")").. 
-0000f6e0: 2020 2020 2020 2023 2056 616c 6964 6174         # Validat
-0000f6f0: 6520 6865 6164 6572 2069 6e66 6f72 6d61  e header informa
-0000f700: 7469 6f6e 0a20 2020 2020 2020 2074 7279  tion.        try
-0000f710: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
-0000f720: 7174 742e 6172 655f 7661 6c69 645f 6966  qtt.are_valid_if
-0000f730: 646f 5f66 6965 6c64 7328 7365 6c66 2e69  do_fields(self.i
-0000f740: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000f750: 6765 5365 7448 6561 6465 724b 6579 5d29  geSetHeaderKey])
-0000f760: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000f770: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-0000f780: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
-0000f790: 2020 2020 2020 206d 7367 203d 2022 496e         msg = "In
-0000f7a0: 7661 6c69 6420 6865 6164 6572 2066 6965  valid header fie
-0000f7b0: 6c64 3a20 2220 2b20 7374 7228 6578 290a  ld: " + str(ex).
-0000f7c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f7d0: 2e70 726f 762e 6c6f 6728 2245 7863 6570  .prov.log("Excep
-0000f7e0: 7469 6f6e 3a20 2220 2b20 6d73 672c 2064  tion: " + msg, d
-0000f7f0: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
-0000f800: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000f810: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-0000f820: 696f 6e28 6d73 6729 0a0a 2020 2020 2020  ion(msg)..      
-0000f830: 2020 2320 7075 7420 6974 656d 2069 6e66    # put item inf
-0000f840: 6f20 696e 746f 2073 656c 662e 6966 646f  o into self.ifdo
-0000f850: 5f74 6d70 0a20 2020 2020 2020 2073 203d  _tmp.        s =
-0000f860: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
-0000f870: 696e 674d 7367 2822 5570 6461 7469 6e67  ingMsg("Updating
-0000f880: 2229 0a20 2020 2020 2020 206c 6f67 203d  ").        log =
-0000f890: 206d 6971 7463 2e72 6563 7572 7369 7665   miqtc.recursive
-0000f8a0: 6c79 5570 6461 7465 4469 6374 7328 7365  lyUpdateDicts(se
-0000f8b0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000f8c0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-0000f8d0: 795d 2c20 696d 6167 655f 7365 745f 6974  y], image_set_it
-0000f8e0: 656d 7329 0a20 2020 2020 2020 2073 2e73  ems).        s.s
-0000f8f0: 746f 7028 290a 2020 2020 2020 2020 7365  top().        se
-0000f900: 6c66 2e70 726f 762e 6c6f 6728 6c6f 6729  lf.prov.log(log)
-0000f910: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
-0000f920: 6c61 7420 6c6f 6e20 626f 756e 6469 6e67  lat lon bounding
-0000f930: 2062 6f78 0a20 2020 2020 2020 2073 656c   box.        sel
-0000f940: 662e 5f73 6574 5f6c 6174 5f6c 6f6e 5f62  f._set_lat_lon_b
-0000f950: 6f75 6e64 696e 675f 626f 7828 7365 6c66  ounding_box(self
-0000f960: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
-0000f970: 2020 2020 2320 7365 7420 7265 7072 6573      # set repres
-0000f980: 656e 7461 7469 7665 2068 6561 6465 7220  entative header 
-0000f990: 6669 656c 6473 2064 6174 6574 696d 652c  fields datetime,
-0000f9a0: 206c 6174 2c20 6c6f 6e2c 2061 6c74 0a20   lat, lon, alt. 
-0000f9b0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-0000f9c0: 5f72 6570 5f68 6561 6465 725f 6669 656c  _rep_header_fiel
-0000f9d0: 6473 5f64 745f 6c61 745f 6c6f 6e5f 616c  ds_dt_lat_lon_al
-0000f9e0: 7428 7365 6c66 2e69 6664 6f5f 746d 7029  t(self.ifdo_tmp)
-0000f9f0: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0000fa00: 7365 745f 696d 6167 655f 6974 656d 5f69  set_image_item_i
-0000fa10: 6465 6e74 6966 6963 6174 696f 6e5f 7363  dentification_sc
-0000fa20: 6865 6d65 2873 656c 662e 6966 646f 5f74  heme(self.ifdo_t
-0000fa30: 6d70 290a 0a20 2020 2020 2020 2023 2072  mp)..        # r
-0000fa40: 656d 6f76 6520 656d 7470 7920 6669 656c  emove emtpy fiel
-0000fa50: 6473 0a20 2020 2020 2020 2073 203d 206d  ds.        s = m
-0000fa60: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
-0000fa70: 674d 7367 2822 5265 6d6f 7669 6e67 2065  gMsg("Removing e
-0000fa80: 6d70 7479 2066 6965 6c64 7322 290a 2020  mpty fields").  
-0000fa90: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-0000faa0: 746d 7020 3d20 6d69 7174 632e 7265 6375  tmp = miqtc.recu
-0000fab0: 7273 6976 656c 7952 656d 6f76 6545 6d70  rsivelyRemoveEmp
-0000fac0: 7479 4669 656c 6473 2873 656c 662e 6966  tyFields(self.if
-0000fad0: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
-0000fae0: 6966 206e 6f74 2073 656c 662e 696d 6167  if not self.imag
-0000faf0: 6553 6574 4974 656d 734b 6579 2069 6e20  eSetItemsKey in 
-0000fb00: 7365 6c66 2e69 6664 6f5f 746d 703a 0a20  self.ifdo_tmp:. 
-0000fb10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000fb20: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000fb30: 6167 6553 6574 4974 656d 734b 6579 5d20  ageSetItemsKey] 
-0000fb40: 3d20 5b5d 0a20 2020 2020 2020 2023 2072  = [].        # r
-0000fb50: 656d 6f76 6520 6669 656c 6473 2074 6861  emove fields tha
-0000fb60: 7420 636f 6e74 6169 6e20 2769 6d61 6765  t contain 'image
-0000fb70: 2d64 6174 6574 696d 6527 206f 6e6c 790a  -datetime' only.
-0000fb80: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
-0000fb90: 6f76 6549 7465 6d46 6965 6c64 7357 6974  oveItemFieldsWit
-0000fba0: 684f 6e6c 7944 6174 6554 696d 6528 290a  hOnlyDateTime().
-0000fbb0: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
-0000fbc0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0000fbd0: 2073 656c 662e 6967 6e6f 7265 5f69 6d61   self.ignore_ima
-0000fbe0: 6765 5f66 696c 6573 3a0a 2020 2020 2020  ge_files:.      
-0000fbf0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-0000fc00: 416c 6c49 7465 6d48 6173 6865 7328 290a  AllItemHashes().
-0000fc10: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-0000fc20: 2061 6761 696e 7374 2073 6368 656d 610a   against schema.
-0000fc30: 2020 2020 2020 2020 7661 6c69 642c 206d          valid, m
-0000fc40: 7367 203d 206d 6971 7474 2e76 616c 6964  sg = miqtt.valid
-0000fc50: 6174 655f 6966 646f 2873 656c 662e 6966  ate_ifdo(self.if
-0000fc60: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
-0000fc70: 6966 206e 6f74 2076 616c 6964 2061 6e64  if not valid and
-0000fc80: 206e 6f74 2061 6c6c 6f77 5f6d 6973 7369   not allow_missi
-0000fc90: 6e67 5f72 6571 7569 7265 643a 0a20 2020  ng_required:.   
-0000fca0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000fcb0: 6f76 2e6c 6f67 2822 5761 726e 696e 6721  ov.log("Warning!
-0000fcc0: 2069 4644 4f20 6e6f 2076 616c 6964 2079   iFDO no valid y
-0000fcd0: 6574 3a20 2220 2b20 6d73 6729 0a20 2020  et: " + msg).   
-0000fce0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0000fcf0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000fd00: 6f6e 286d 7367 290a 0a20 2020 2020 2020  on(msg)..       
-0000fd10: 2023 2073 6574 2066 696e 616c 206f 6e65   # set final one
-0000fd20: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
-0000fd30: 646f 5f63 6865 636b 6564 203d 2063 6f70  do_checked = cop
-0000fd40: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-0000fd50: 6966 646f 5f74 6d70 290a 2020 2020 2020  ifdo_tmp).      
-0000fd60: 2020 7265 7475 726e 2073 656c 662e 6966    return self.if
-0000fd70: 646f 5f63 6865 636b 6564 0a0a 0a20 2020  do_checked...   
-0000fd80: 2064 6566 205f 7365 745f 696d 6167 655f   def _set_image_
-0000fd90: 6974 656d 5f69 6465 6e74 6966 6963 6174  item_identificat
-0000fda0: 696f 6e5f 7363 6865 6d65 2873 656c 662c  ion_scheme(self,
-0000fdb0: 6966 646f 3a64 6963 7429 3a0a 2020 2020  ifdo:dict):.    
-0000fdc0: 2020 2020 2222 2220 5365 7420 696d 6167      """ Set imag
-0000fdd0: 652d 6974 656d 2d69 6465 6e74 6966 6963  e-item-identific
-0000fde0: 6174 696f 6e2d 7363 6865 6d65 2074 6f20  ation-scheme to 
-0000fdf0: 6069 6d61 6765 2d70 726f 6a65 6374 5f69  `image-project_i
-0000fe00: 6d61 6765 2d65 7665 6e74 5f69 6d61 6765  mage-event_image
-0000fe10: 2d73 656e 736f 725f 696d 6167 652d 6461  -sensor_image-da
-0000fe20: 7465 7469 6d65 2e65 7874 6020 6966 2065  tetime.ext` if e
-0000fe30: 6d70 7479 2e20 2222 220a 2020 2020 2020  mpty. """.      
-0000fe40: 2020 6966 2066 696e 6446 6965 6c64 2869    if findField(i
-0000fe50: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-0000fe60: 7448 6561 6465 724b 6579 5d2c 2769 6d61  tHeaderKey],'ima
-0000fe70: 6765 2d69 7465 6d2d 6964 656e 7469 6669  ge-item-identifi
-0000fe80: 6361 7469 6f6e 2d73 6368 656d 6527 2920  cation-scheme') 
-0000fe90: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-0000fea0: 2020 2069 6664 6f5b 7365 6c66 2e69 6d61     ifdo[self.ima
-0000feb0: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
-0000fec0: 2769 6d61 6765 2d69 7465 6d2d 6964 656e  'image-item-iden
-0000fed0: 7469 6669 6361 7469 6f6e 2d73 6368 656d  tification-schem
-0000fee0: 6527 5d20 3d20 2027 696d 6167 652d 7072  e'] =  'image-pr
-0000fef0: 6f6a 6563 745f 696d 6167 652d 6576 656e  oject_image-even
-0000ff00: 745f 696d 6167 652d 7365 6e73 6f72 5f69  t_image-sensor_i
-0000ff10: 6d61 6765 2d64 6174 6574 696d 652e 6578  mage-datetime.ex
-0000ff20: 7427 0a0a 0a20 2020 2064 6566 205f 7365  t'...    def _se
-0000ff30: 745f 7265 705f 6865 6164 6572 5f66 6965  t_rep_header_fie
-0000ff40: 6c64 735f 6474 5f6c 6174 5f6c 6f6e 5f61  lds_dt_lat_lon_a
-0000ff50: 6c74 2873 656c 662c 6966 646f 3a64 6963  lt(self,ifdo:dic
-0000ff60: 7429 3a0a 2020 2020 2020 2020 2222 2220  t):.        """ 
-0000ff70: 4669 6c6c 2068 6561 6465 7220 6669 656c  Fill header fiel
-0000ff80: 6473 2069 6d61 6765 2d64 6174 6574 696d  ds image-datetim
-0000ff90: 6520 616e 6420 2d6c 6174 6974 7564 652c  e and -latitude,
-0000ffa0: 202d 6c6f 6e67 6974 7565 6465 2c20 2d61   -longituede, -a
-0000ffb0: 6c74 6974 7564 652d 6d65 7465 7273 2c20  ltitude-meters, 
-0000ffc0: 2d63 6f6f 7264 696e 6174 652d 756e 6365  -coordinate-unce
-0000ffd0: 7274 6169 6e74 792d 6d65 7465 7273 2c20  rtainty-meters, 
-0000ffe0: 6966 2065 6d70 7479 2c0a 2020 2020 2020  if empty,.      
-0000fff0: 2020 7265 7072 6573 656e 7461 7469 7665    representative
-00010000: 6c79 2077 6974 6820 6669 7273 7420 6974  ly with first it
-00010010: 656d 7320 656e 7472 7920 616e 6420 6d65  ems entry and me
-00010020: 6469 616e 206f 6620 616c 6c20 6974 656d  dian of all item
-00010030: 7320 7661 6c75 6573 2c20 7265 7370 6563  s values, respec
-00010040: 7469 7665 6c79 2e20 2222 220a 0a20 2020  tively. """..   
-00010050: 2020 2020 2023 2027 696d 6167 652d 6461       # 'image-da
-00010060: 7465 7469 6d65 270a 2020 2020 2020 2020  tetime'.        
-00010070: 6669 7273 745f 696d 6167 6520 3d20 736f  first_image = so
-00010080: 7274 6564 2869 6664 6f5b 7365 6c66 2e69  rted(ifdo[self.i
-00010090: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-000100a0: 2e6b 6579 7328 2929 5b30 5d0a 2020 2020  .keys())[0].    
-000100b0: 2020 2020 6669 656c 6420 3d20 2769 6d61      field = 'ima
-000100c0: 6765 2d64 6174 6574 696d 6527 0a20 2020  ge-datetime'.   
-000100d0: 2020 2020 2069 6620 6669 6e64 4669 656c       if findFiel
-000100e0: 6428 6966 646f 5b73 656c 662e 696d 6167  d(ifdo[self.imag
-000100f0: 6553 6574 4865 6164 6572 4b65 795d 2c66  eSetHeaderKey],f
-00010100: 6965 6c64 2920 3d3d 2022 223a 0a20 2020  ield) == "":.   
-00010110: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00010120: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010130: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00010140: 4865 6164 6572 4b65 795d 5b66 6965 6c64  HeaderKey][field
-00010150: 5d20 3d20 7365 6c66 2e5f 5f67 6574 4669  ] = self.__getFi
-00010160: 656c 6456 616c 7565 2869 6664 6f2c 5b66  eldValue(ifdo,[f
-00010170: 6972 7374 5f69 6d61 6765 2c66 6965 6c64  irst_image,field
-00010180: 5d2c 6465 6661 756c 745f 6f6e 6c79 3d54  ],default_only=T
-00010190: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000101a0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-000101b0: 6f67 2822 5365 7420 7265 7072 6573 656e  og("Set represen
-000101c0: 7461 7469 7665 2068 6561 6465 7220 6669  tative header fi
-000101d0: 656c 6420 2722 202b 2066 6965 6c64 202b  eld '" + field +
-000101e0: 2022 2720 746f 2022 202b 2073 7472 2869   "' to " + str(i
-000101f0: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-00010200: 7448 6561 6465 724b 6579 5d5b 6669 656c  tHeaderKey][fiel
-00010210: 645d 2920 2b20 2220 6672 6f6d 2066 6972  d]) + " from fir
-00010220: 7374 2069 6d61 6765 2e22 290a 2020 2020  st image.").    
-00010230: 2020 2020 2020 2020 6578 6365 7074 206d          except m
-00010240: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00010250: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
-00010260: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00010270: 726f 762e 6c6f 6728 2243 6f75 6c64 206e  rov.log("Could n
-00010280: 6f74 2073 6574 2072 6570 7265 7365 6e74  ot set represent
-00010290: 6174 6976 6520 6865 6164 6572 2066 6965  ative header fie
-000102a0: 6c64 3a20 2220 2b20 7374 7228 6578 2929  ld: " + str(ex))
-000102b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000102c0: 2070 6173 730a 0a20 2020 2020 2020 2023   pass..        #
-000102d0: 2072 6573 740a 2020 2020 2020 2020 7265   rest.        re
-000102e0: 705f 6865 6164 6572 5f66 6965 6c64 735f  p_header_fields_
-000102f0: 6d65 6469 616e 203d 205b 2769 6d61 6765  median = ['image
-00010300: 2d6c 6174 6974 7564 6527 2c27 696d 6167  -latitude','imag
-00010310: 652d 6c6f 6e67 6974 7564 6527 2c27 696d  e-longitude','im
-00010320: 6167 652d 616c 7469 7475 6465 2d6d 6574  age-altitude-met
-00010330: 6572 7327 2c27 696d 6167 652d 636f 6f72  ers','image-coor
-00010340: 6469 6e61 7465 2d75 6e63 6572 7461 696e  dinate-uncertain
-00010350: 7479 2d6d 6574 6572 7327 5d0a 2020 2020  ty-meters'].    
-00010360: 2020 2020 666f 7220 6669 656c 6420 696e      for field in
-00010370: 2072 6570 5f68 6561 6465 725f 6669 656c   rep_header_fiel
-00010380: 6473 5f6d 6564 6961 6e3a 0a20 2020 2020  ds_median:.     
-00010390: 2020 2020 2020 2069 6620 6669 6e64 4669         if findFi
-000103a0: 656c 6428 6966 646f 5b73 656c 662e 696d  eld(ifdo[self.im
-000103b0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-000103c0: 2c66 6965 6c64 2920 3d3d 2022 223a 0a20  ,field) == "":. 
-000103d0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000103e0: 616c 7565 7320 3d20 5b5d 0a20 2020 2020  alues = [].     
-000103f0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00010400: 6d61 6765 5f6e 616d 6520 696e 2069 6664  mage_name in ifd
-00010410: 6f5b 7365 6c66 2e69 6d61 6765 5365 7449  o[self.imageSetI
-00010420: 7465 6d73 4b65 795d 2e6b 6579 7328 293a  temsKey].keys():
-00010430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010440: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00010450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010460: 2020 6974 656d 5f76 616c 203d 2073 656c    item_val = sel
-00010470: 662e 5f5f 6765 7446 6965 6c64 5661 6c75  f.__getFieldValu
-00010480: 6528 6966 646f 2c5b 696d 6167 655f 6e61  e(ifdo,[image_na
-00010490: 6d65 2c66 6965 6c64 5d29 0a20 2020 2020  me,field]).     
-000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104b0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-000104c0: 2869 7465 6d5f 7661 6c2c 6469 6374 293a  (item_val,dict):
-000104d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000104e0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-000104f0: 7565 7320 2b3d 206c 6973 7428 6974 656d  ues += list(item
-00010500: 5f76 616c 2e76 616c 7565 7328 2929 0a20  _val.values()). 
+0000f390: 2073 7562 4974 656d 4469 6374 5b69 745d   subItemDict[it]
+0000f3a0: 203d 2073 7562 4974 656d 5b69 745d 0a20   = subItem[it]. 
+0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3c0: 2020 2020 2020 2069 6d61 6765 5f73 6574         image_set
+0000f3d0: 5f69 7465 6d73 5b73 7562 4974 656d 4465  _items[subItemDe
+0000f3e0: 6661 756c 745b 2769 6d61 6765 2d66 696c  fault['image-fil
+0000f3f0: 656e 616d 6527 5d5d 2e61 7070 656e 6428  ename']].append(
+0000f400: 7375 6249 7465 6d44 6963 7429 0a20 2020  subItemDict).   
+0000f410: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0000f420: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0000f430: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
+0000f440: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+0000f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f460: 2020 2069 6e76 616c 6964 5f69 7465 6d73     invalid_items
+0000f470: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0000f480: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000f490: 726f 762e 6c6f 6728 2249 6e76 616c 6964  rov.log("Invalid
+0000f4a0: 2069 6d61 6765 2069 7465 6d3a 2022 2b20   image item: "+ 
+0000f4b0: 7374 7228 6974 656d 292c 646f 6e74 5368  str(item),dontSh
+0000f4c0: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+0000f4d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000f4e0: 662e 7072 6f76 2e6c 6f67 2822 4578 6365  f.prov.log("Exce
+0000f4f0: 7074 696f 6e3a 5c6e 222b 2073 7472 2865  ption:\n"+ str(e
+0000f500: 2e61 7267 7329 2c64 6f6e 7453 686f 773d  .args),dontShow=
+0000f510: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0000f520: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000f530: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+0000f540: 696f 6e28 2249 6e76 616c 6964 2069 6d61  ion("Invalid ima
+0000f550: 6765 2069 7465 6d20 222b 2066 696c 655f  ge item "+ file_
+0000f560: 6e61 6d65 202b 2022 3a5c 6e45 7863 6570  name + ":\nExcep
+0000f570: 7469 6f6e 3a5c 6e22 2b20 7374 7228 652e  tion:\n"+ str(e.
+0000f580: 6172 6773 2929 2023 206f 7468 6572 7769  args)) # otherwi
+0000f590: 7365 2c20 696e 2063 6173 6520 6f66 206d  se, in case of m
+0000f5a0: 616e 7920 696d 6167 6573 2c20 6974 206d  any images, it m
+0000f5b0: 6179 206b 6565 7020 7275 6e6e 696e 6720  ay keep running 
+0000f5c0: 616e 6420 7468 726f 7769 6e67 2065 7272  and throwing err
+0000f5d0: 6f72 7320 666f 7220 7175 6974 2073 6f6d  ors for quit som
+0000f5e0: 6520 7469 6d65 0a20 2020 2020 2020 2020  e time.         
+0000f5f0: 2020 2070 726f 672e 636c 6561 7228 290a     prog.clear().
+0000f600: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000f610: 6c65 6e28 6974 656d 7329 2021 3d20 3020  len(items) != 0 
+0000f620: 616e 6420 696e 7661 6c69 645f 6974 656d  and invalid_item
+0000f630: 7320 3d3d 206c 656e 2869 7465 6d73 293a  s == len(items):
+0000f640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f650: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0000f660: 2822 416c 6c20 6974 656d 7320 6172 6520  ("All items are 
+0000f670: 696e 7661 6c69 6422 290a 2020 2020 2020  invalid").      
+0000f680: 2020 2020 2020 656c 6966 2069 6e76 616c        elif inval
+0000f690: 6964 5f69 7465 6d73 203e 2030 3a0a 2020  id_items > 0:.  
+0000f6a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000f6b0: 6c66 2e70 726f 762e 6c6f 6728 2241 7420  lf.prov.log("At 
+0000f6c0: 6c65 6173 7420 2220 2b20 7374 7228 696e  least " + str(in
+0000f6d0: 7661 6c69 645f 6974 656d 7329 202b 2022  valid_items) + "
+0000f6e0: 2069 7465 6d73 2077 6572 6520 696e 7661   items were inva
+0000f6f0: 6c69 6420 286f 6622 202b 2073 7472 286c  lid (of" + str(l
+0000f700: 656e 2869 7465 6d73 2929 2b20 2229 2229  en(items))+ ")")
+0000f710: 0a0a 2020 2020 2020 2020 2320 5661 6c69  ..        # Vali
+0000f720: 6461 7465 2068 6561 6465 7220 696e 666f  date header info
+0000f730: 726d 6174 696f 6e0a 2020 2020 2020 2020  rmation.        
+0000f740: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000f750: 206d 6971 7474 2e61 7265 5f76 616c 6964   miqtt.are_valid
+0000f760: 5f69 6664 6f5f 6669 656c 6473 2873 656c  _ifdo_fields(sel
+0000f770: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000f780: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000f790: 795d 290a 2020 2020 2020 2020 6578 6365  y]).        exce
+0000f7a0: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
+0000f7b0: 6570 7469 6f6e 2061 7320 6578 3a0a 2020  eption as ex:.  
+0000f7c0: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+0000f7d0: 2249 6e76 616c 6964 2068 6561 6465 7220  "Invalid header 
+0000f7e0: 6669 656c 643a 2022 202b 2073 7472 2865  field: " + str(e
+0000f7f0: 7829 0a20 2020 2020 2020 2020 2020 2073  x).            s
+0000f800: 656c 662e 7072 6f76 2e6c 6f67 2822 4578  elf.prov.log("Ex
+0000f810: 6365 7074 696f 6e3a 2022 202b 206d 7367  ception: " + msg
+0000f820: 2c20 646f 6e74 5368 6f77 3d54 7275 6529  , dontShow=True)
+0000f830: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000f840: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+0000f850: 6570 7469 6f6e 286d 7367 290a 0a20 2020  eption(msg)..   
+0000f860: 2020 2020 2023 2070 7574 2069 7465 6d20       # put item 
+0000f870: 696e 666f 2069 6e74 6f20 7365 6c66 2e69  info into self.i
+0000f880: 6664 6f5f 746d 700a 2020 2020 2020 2020  fdo_tmp.        
+0000f890: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
+0000f8a0: 6f61 6469 6e67 4d73 6728 2255 7064 6174  oadingMsg("Updat
+0000f8b0: 696e 6722 290a 2020 2020 2020 2020 6c6f  ing").        lo
+0000f8c0: 6720 3d20 6d69 7174 632e 7265 6375 7273  g = miqtc.recurs
+0000f8d0: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
+0000f8e0: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
+0000f8f0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+0000f900: 734b 6579 5d2c 2069 6d61 6765 5f73 6574  sKey], image_set
+0000f910: 5f69 7465 6d73 290a 2020 2020 2020 2020  _items).        
+0000f920: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+0000f930: 2073 656c 662e 7072 6f76 2e6c 6f67 286c   self.prov.log(l
+0000f940: 6f67 290a 0a20 2020 2020 2020 2023 2073  og)..        # s
+0000f950: 6574 206c 6174 206c 6f6e 2062 6f75 6e64  et lat lon bound
+0000f960: 696e 6720 626f 780a 2020 2020 2020 2020  ing box.        
+0000f970: 7365 6c66 2e5f 7365 745f 6c61 745f 6c6f  self._set_lat_lo
+0000f980: 6e5f 626f 756e 6469 6e67 5f62 6f78 2873  n_bounding_box(s
+0000f990: 656c 662e 6966 646f 5f74 6d70 290a 0a20  elf.ifdo_tmp).. 
+0000f9a0: 2020 2020 2020 2023 2073 6574 2072 6570         # set rep
+0000f9b0: 7265 7365 6e74 6174 6976 6520 6865 6164  resentative head
+0000f9c0: 6572 2066 6965 6c64 7320 6461 7465 7469  er fields dateti
+0000f9d0: 6d65 2c20 6c61 742c 206c 6f6e 2c20 616c  me, lat, lon, al
+0000f9e0: 740a 2020 2020 2020 2020 7365 6c66 2e5f  t.        self._
+0000f9f0: 7365 745f 7265 705f 6865 6164 6572 5f66  set_rep_header_f
+0000fa00: 6965 6c64 735f 6474 5f6c 6174 5f6c 6f6e  ields_dt_lat_lon
+0000fa10: 5f61 6c74 2873 656c 662e 6966 646f 5f74  _alt(self.ifdo_t
+0000fa20: 6d70 290a 0a20 2020 2020 2020 2073 656c  mp)..        sel
+0000fa30: 662e 5f73 6574 5f69 6d61 6765 5f69 7465  f._set_image_ite
+0000fa40: 6d5f 6964 656e 7469 6669 6361 7469 6f6e  m_identification
+0000fa50: 5f73 6368 656d 6528 7365 6c66 2e69 6664  _scheme(self.ifd
+0000fa60: 6f5f 746d 7029 0a0a 2020 2020 2020 2020  o_tmp)..        
+0000fa70: 2320 7265 6d6f 7665 2065 6d74 7079 2066  # remove emtpy f
+0000fa80: 6965 6c64 730a 2020 2020 2020 2020 7320  ields.        s 
+0000fa90: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
+0000faa0: 6469 6e67 4d73 6728 2252 656d 6f76 696e  dingMsg("Removin
+0000fab0: 6720 656d 7074 7920 6669 656c 6473 2229  g empty fields")
+0000fac0: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
+0000fad0: 646f 5f74 6d70 203d 206d 6971 7463 2e72  do_tmp = miqtc.r
+0000fae0: 6563 7572 7369 7665 6c79 5265 6d6f 7665  ecursivelyRemove
+0000faf0: 456d 7074 7946 6965 6c64 7328 7365 6c66  EmptyFields(self
+0000fb00: 2e69 6664 6f5f 746d 7029 0a20 2020 2020  .ifdo_tmp).     
+0000fb10: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
+0000fb20: 6d61 6765 5365 7449 7465 6d73 4b65 7920  mageSetItemsKey 
+0000fb30: 696e 2073 656c 662e 6966 646f 5f74 6d70  in self.ifdo_tmp
+0000fb40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000fb50: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000fb60: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+0000fb70: 795d 203d 205b 5d0a 2020 2020 2020 2020  y] = [].        
+0000fb80: 2320 7265 6d6f 7665 2066 6965 6c64 7320  # remove fields 
+0000fb90: 7468 6174 2063 6f6e 7461 696e 2027 696d  that contain 'im
+0000fba0: 6167 652d 6461 7465 7469 6d65 2720 6f6e  age-datetime' on
+0000fbb0: 6c79 0a20 2020 2020 2020 2073 656c 662e  ly.        self.
+0000fbc0: 7265 6d6f 7665 4974 656d 4669 656c 6473  removeItemFields
+0000fbd0: 5769 7468 4f6e 6c79 4461 7465 5469 6d65  WithOnlyDateTime
+0000fbe0: 2829 0a20 2020 2020 2020 2073 2e73 746f  ().        s.sto
+0000fbf0: 7028 290a 0a20 2020 2020 2020 2069 6620  p()..        if 
+0000fc00: 6e6f 7420 7365 6c66 2e69 676e 6f72 655f  not self.ignore_
+0000fc10: 696d 6167 655f 6669 6c65 733a 0a20 2020  image_files:.   
+0000fc20: 2020 2020 2020 2020 2073 656c 662e 6368           self.ch
+0000fc30: 6563 6b41 6c6c 4974 656d 4861 7368 6573  eckAllItemHashes
+0000fc40: 2829 0a0a 2020 2020 2020 2020 2320 6368  ()..        # ch
+0000fc50: 6563 6b20 6167 6169 6e73 7420 7363 6865  eck against sche
+0000fc60: 6d61 0a20 2020 2020 2020 2076 616c 6964  ma.        valid
+0000fc70: 2c20 6d73 6720 3d20 6d69 7174 742e 7661  , msg = miqtt.va
+0000fc80: 6c69 6461 7465 5f69 6664 6f28 7365 6c66  lidate_ifdo(self
+0000fc90: 2e69 6664 6f5f 746d 7029 0a20 2020 2020  .ifdo_tmp).     
+0000fca0: 2020 2069 6620 6e6f 7420 7661 6c69 6420     if not valid 
+0000fcb0: 616e 6420 6e6f 7420 616c 6c6f 775f 6d69  and not allow_mi
+0000fcc0: 7373 696e 675f 7265 7175 6972 6564 3a0a  ssing_required:.
+0000fcd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fce0: 2e70 726f 762e 6c6f 6728 2257 6172 6e69  .prov.log("Warni
+0000fcf0: 6e67 2120 6946 444f 206e 6f20 7661 6c69  ng! iFDO no vali
+0000fd00: 6420 7965 743a 2022 202b 206d 7367 290a  d yet: " + msg).
+0000fd10: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000fd20: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+0000fd30: 7074 696f 6e28 6d73 6729 0a0a 2020 2020  ption(msg)..    
+0000fd40: 2020 2020 2320 7365 7420 6669 6e61 6c20      # set final 
+0000fd50: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+0000fd60: 2e69 6664 6f5f 6368 6563 6b65 6420 3d20  .ifdo_checked = 
+0000fd70: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+0000fd80: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
+0000fd90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000fda0: 2e69 6664 6f5f 6368 6563 6b65 640a 0a0a  .ifdo_checked...
+0000fdb0: 2020 2020 6465 6620 5f73 6574 5f69 6d61      def _set_ima
+0000fdc0: 6765 5f69 7465 6d5f 6964 656e 7469 6669  ge_item_identifi
+0000fdd0: 6361 7469 6f6e 5f73 6368 656d 6528 7365  cation_scheme(se
+0000fde0: 6c66 2c69 6664 6f3a 6469 6374 293a 0a20  lf,ifdo:dict):. 
+0000fdf0: 2020 2020 2020 2022 2222 2053 6574 2069         """ Set i
+0000fe00: 6d61 6765 2d69 7465 6d2d 6964 656e 7469  mage-item-identi
+0000fe10: 6669 6361 7469 6f6e 2d73 6368 656d 6520  fication-scheme 
+0000fe20: 746f 2060 696d 6167 652d 7072 6f6a 6563  to `image-projec
+0000fe30: 745f 696d 6167 652d 6576 656e 745f 696d  t_image-event_im
+0000fe40: 6167 652d 7365 6e73 6f72 5f69 6d61 6765  age-sensor_image
+0000fe50: 2d64 6174 6574 696d 652e 6578 7460 2069  -datetime.ext` i
+0000fe60: 6620 656d 7074 792e 2022 2222 0a20 2020  f empty. """.   
+0000fe70: 2020 2020 2069 6620 6669 6e64 4669 656c       if findFiel
+0000fe80: 6428 6966 646f 5b73 656c 662e 696d 6167  d(ifdo[self.imag
+0000fe90: 6553 6574 4865 6164 6572 4b65 795d 2c27  eSetHeaderKey],'
+0000fea0: 696d 6167 652d 6974 656d 2d69 6465 6e74  image-item-ident
+0000feb0: 6966 6963 6174 696f 6e2d 7363 6865 6d65  ification-scheme
+0000fec0: 2729 203d 3d20 2222 3a0a 2020 2020 2020  ') == "":.      
+0000fed0: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
+0000fee0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000fef0: 795d 5b27 696d 6167 652d 6974 656d 2d69  y]['image-item-i
+0000ff00: 6465 6e74 6966 6963 6174 696f 6e2d 7363  dentification-sc
+0000ff10: 6865 6d65 275d 203d 2020 2769 6d61 6765  heme'] =  'image
+0000ff20: 2d70 726f 6a65 6374 5f69 6d61 6765 2d65  -project_image-e
+0000ff30: 7665 6e74 5f69 6d61 6765 2d73 656e 736f  vent_image-senso
+0000ff40: 725f 696d 6167 652d 6461 7465 7469 6d65  r_image-datetime
+0000ff50: 2e65 7874 270a 0a0a 2020 2020 6465 6620  .ext'...    def 
+0000ff60: 5f73 6574 5f72 6570 5f68 6561 6465 725f  _set_rep_header_
+0000ff70: 6669 656c 6473 5f64 745f 6c61 745f 6c6f  fields_dt_lat_lo
+0000ff80: 6e5f 616c 7428 7365 6c66 2c69 6664 6f3a  n_alt(self,ifdo:
+0000ff90: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
+0000ffa0: 2222 2046 696c 6c20 6865 6164 6572 2066  "" Fill header f
+0000ffb0: 6965 6c64 7320 696d 6167 652d 6461 7465  ields image-date
+0000ffc0: 7469 6d65 2061 6e64 202d 6c61 7469 7475  time and -latitu
+0000ffd0: 6465 2c20 2d6c 6f6e 6769 7475 6564 652c  de, -longituede,
+0000ffe0: 202d 616c 7469 7475 6465 2d6d 6574 6572   -altitude-meter
+0000fff0: 732c 202d 636f 6f72 6469 6e61 7465 2d75  s, -coordinate-u
+00010000: 6e63 6572 7461 696e 7479 2d6d 6574 6572  ncertainty-meter
+00010010: 732c 2069 6620 656d 7074 792c 0a20 2020  s, if empty,.   
+00010020: 2020 2020 2072 6570 7265 7365 6e74 6174       representat
+00010030: 6976 656c 7920 7769 7468 2066 6972 7374  ively with first
+00010040: 2069 7465 6d73 2065 6e74 7279 2061 6e64   items entry and
+00010050: 206d 6564 6961 6e20 6f66 2061 6c6c 2069   median of all i
+00010060: 7465 6d73 2076 616c 7565 732c 2072 6573  tems values, res
+00010070: 7065 6374 6976 656c 792e 2022 2222 0a0a  pectively. """..
+00010080: 2020 2020 2020 2020 2320 2769 6d61 6765          # 'image
+00010090: 2d64 6174 6574 696d 6527 0a20 2020 2020  -datetime'.     
+000100a0: 2020 2066 6972 7374 5f69 6d61 6765 203d     first_image =
+000100b0: 2073 6f72 7465 6428 6966 646f 5b73 656c   sorted(ifdo[sel
+000100c0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+000100d0: 6579 5d2e 6b65 7973 2829 295b 305d 0a20  ey].keys())[0]. 
+000100e0: 2020 2020 2020 2066 6965 6c64 203d 2027         field = '
+000100f0: 696d 6167 652d 6461 7465 7469 6d65 270a  image-datetime'.
+00010100: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
+00010110: 6965 6c64 2869 6664 6f5b 7365 6c66 2e69  ield(ifdo[self.i
+00010120: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+00010130: 5d2c 6669 656c 6429 203d 3d20 2222 3a0a  ],field) == "":.
+00010140: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00010150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010160: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
+00010170: 5365 7448 6561 6465 724b 6579 5d5b 6669  SetHeaderKey][fi
+00010180: 656c 645d 203d 2073 656c 662e 5f5f 6765  eld] = self.__ge
+00010190: 7446 6965 6c64 5661 6c75 6528 6966 646f  tFieldValue(ifdo
+000101a0: 2c5b 6669 7273 745f 696d 6167 652c 6669  ,[first_image,fi
+000101b0: 656c 645d 2c64 6566 6175 6c74 5f6f 6e6c  eld],default_onl
+000101c0: 793d 5472 7565 290a 2020 2020 2020 2020  y=True).        
+000101d0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+000101e0: 762e 6c6f 6728 2253 6574 2072 6570 7265  v.log("Set repre
+000101f0: 7365 6e74 6174 6976 6520 6865 6164 6572  sentative header
+00010200: 2066 6965 6c64 2027 2220 2b20 6669 656c   field '" + fiel
+00010210: 6420 2b20 2227 2074 6f20 2220 2b20 7374  d + "' to " + st
+00010220: 7228 6966 646f 5b73 656c 662e 696d 6167  r(ifdo[self.imag
+00010230: 6553 6574 4865 6164 6572 4b65 795d 5b66  eSetHeaderKey][f
+00010240: 6965 6c64 5d29 202b 2022 2066 726f 6d20  ield]) + " from 
+00010250: 6669 7273 7420 696d 6167 652e 2229 0a20  first image."). 
+00010260: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00010270: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
+00010280: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00010290: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000102a0: 662e 7072 6f76 2e6c 6f67 2822 436f 756c  f.prov.log("Coul
+000102b0: 6420 6e6f 7420 7365 7420 7265 7072 6573  d not set repres
+000102c0: 656e 7461 7469 7665 2068 6561 6465 7220  entative header 
+000102d0: 6669 656c 643a 2022 202b 2073 7472 2865  field: " + str(e
+000102e0: 7829 290a 2020 2020 2020 2020 2020 2020  x)).            
+000102f0: 2020 2020 7061 7373 0a0a 2020 2020 2020      pass..      
+00010300: 2020 2320 7265 7374 0a20 2020 2020 2020    # rest.       
+00010310: 2072 6570 5f68 6561 6465 725f 6669 656c   rep_header_fiel
+00010320: 6473 5f6d 6564 6961 6e20 3d20 5b27 696d  ds_median = ['im
+00010330: 6167 652d 6c61 7469 7475 6465 272c 2769  age-latitude','i
+00010340: 6d61 6765 2d6c 6f6e 6769 7475 6465 272c  mage-longitude',
+00010350: 2769 6d61 6765 2d61 6c74 6974 7564 652d  'image-altitude-
+00010360: 6d65 7465 7273 272c 2769 6d61 6765 2d63  meters','image-c
+00010370: 6f6f 7264 696e 6174 652d 756e 6365 7274  oordinate-uncert
+00010380: 6169 6e74 792d 6d65 7465 7273 275d 0a20  ainty-meters']. 
+00010390: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
+000103a0: 2069 6e20 7265 705f 6865 6164 6572 5f66   in rep_header_f
+000103b0: 6965 6c64 735f 6d65 6469 616e 3a0a 2020  ields_median:.  
+000103c0: 2020 2020 2020 2020 2020 6966 2066 696e            if fin
+000103d0: 6446 6965 6c64 2869 6664 6f5b 7365 6c66  dField(ifdo[self
+000103e0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+000103f0: 6579 5d2c 6669 656c 6429 203d 3d20 2222  ey],field) == ""
+00010400: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010410: 2020 7661 6c75 6573 203d 205b 5d0a 2020    values = [].  
+00010420: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00010430: 7220 696d 6167 655f 6e61 6d65 2069 6e20  r image_name in 
+00010440: 6966 646f 5b73 656c 662e 696d 6167 6553  ifdo[self.imageS
+00010450: 6574 4974 656d 734b 6579 5d2e 6b65 7973  etItemsKey].keys
+00010460: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00010470: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00010480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010490: 2020 2020 2069 7465 6d5f 7661 6c20 3d20       item_val = 
+000104a0: 7365 6c66 2e5f 5f67 6574 4669 656c 6456  self.__getFieldV
+000104b0: 616c 7565 2869 6664 6f2c 5b69 6d61 6765  alue(ifdo,[image
+000104c0: 5f6e 616d 652c 6669 656c 645d 290a 2020  _name,field]).  
+000104d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104e0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000104f0: 6e63 6528 6974 656d 5f76 616c 2c64 6963  nce(item_val,dic
+00010500: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
 00010510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010520: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00010530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010540: 2020 2020 2020 2020 2076 616c 7565 732e           values.
-00010550: 6170 7065 6e64 2869 7465 6d5f 7661 6c29  append(item_val)
-00010560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010570: 2020 2020 2065 7863 6570 7420 6d69 7174       except miqt
-00010580: 632e 4966 646f 4578 6365 7074 696f 6e20  c.IfdoException 
-00010590: 6173 2065 783a 0a20 2020 2020 2020 2020  as ex:.         
-000105a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000105b0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-000105c0: 2020 2020 7661 6c75 6573 203d 205b 6920      values = [i 
-000105d0: 666f 7220 6920 696e 2076 616c 7565 7320  for i in values 
-000105e0: 6966 2069 2021 3d20 2727 5d0a 2020 2020  if i != ''].    
-000105f0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00010600: 656e 2876 616c 7565 7329 203d 3d20 303a  en(values) == 0:
-00010610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010620: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00010630: 6f67 2822 436f 756c 6420 6e6f 7420 7365  og("Could not se
-00010640: 7420 7265 7072 6573 656e 7461 7469 7665  t representative
-00010650: 2068 6561 6465 7220 6669 656c 642c 206e   header field, n
-00010660: 6f20 7661 6c75 6573 2066 6f75 6e64 3a20  o values found: 
-00010670: 2220 2b20 6669 656c 6429 0a20 2020 2020  " + field).     
-00010680: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00010690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000106a0: 2020 2020 2023 2069 676e 6f72 6520 756e       # ignore un
-000106b0: 6b6e 6f6e 772c 2069 2e65 2e20 302e 302c  knonw, i.e. 0.0,
-000106c0: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
-000106d0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-000106e0: 6573 203d 205b 6920 666f 7220 6920 696e  es = [i for i in
-000106f0: 2076 616c 7565 7320 6966 2069 2021 3d20   values if i != 
-00010700: 302e 305d 0a20 2020 2020 2020 2020 2020  0.0].           
-00010710: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00010720: 7661 6c75 6573 2920 3d3d 2030 3a0a 2020  values) == 0:.  
-00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010740: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
-00010750: 656e 6428 302e 3029 200a 2020 2020 2020  end(0.0) .      
-00010760: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010770: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00010780: 4865 6164 6572 4b65 795d 5b66 6965 6c64  HeaderKey][field
-00010790: 5d20 3d20 7374 6174 6973 7469 6373 2e6d  ] = statistics.m
-000107a0: 6564 6961 6e28 7661 6c75 6573 290a 2020  edian(values).  
-000107b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107c0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-000107d0: 2253 6574 2072 6570 7265 7365 6e74 6174  "Set representat
-000107e0: 6976 6520 6865 6164 6572 2066 6965 6c64  ive header field
-000107f0: 2027 2220 2b20 6669 656c 6420 2b20 2227   '" + field + "'
-00010800: 2074 6f20 6d65 6469 616e 3a20 2220 2b20   to median: " + 
-00010810: 7374 7228 6966 646f 5b73 656c 662e 696d  str(ifdo[self.im
-00010820: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-00010830: 5b66 6965 6c64 5d29 202b 2022 2e22 290a  [field]) + ".").
-00010840: 0a0a 2020 2020 6465 6620 5f73 6574 5f6c  ..    def _set_l
-00010850: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
-00010860: 626f 7828 7365 6c66 2c69 6664 6f3a 6469  box(self,ifdo:di
-00010870: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
-00010880: 2053 6574 2069 6d61 6765 2d73 6574 2d5b   Set image-set-[
-00010890: 6d69 6e2c 6d61 785d 2d5b 6c61 7469 7475  min,max]-[latitu
-000108a0: 6465 2c6c 6f6e 6769 7475 6465 5d2d 6465  de,longitude]-de
-000108b0: 6772 6565 7320 2222 220a 2020 2020 2020  grees """.      
-000108c0: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
-000108d0: 6178 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e  ax, lon_min, lon
-000108e0: 5f6d 6178 203d 2073 656c 662e 5f67 6574  _max = self._get
-000108f0: 5f6c 6174 5f6c 6f6e 5f62 6f75 6e64 696e  _lat_lon_boundin
-00010900: 675f 626f 7828 6966 646f 5b73 656c 662e  g_box(ifdo[self.
-00010910: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-00010920: 5d29 0a20 2020 2020 2020 2069 6620 6e6f  ]).        if no
-00010930: 7420 4e6f 6e65 2069 6e20 5b6c 6174 5f6d  t None in [lat_m
-00010940: 696e 2c20 6c61 745f 6d61 782c 206c 6f6e  in, lat_max, lon
-00010950: 5f6d 696e 2c20 6c6f 6e5f 6d61 785d 3a0a  _min, lon_max]:.
-00010960: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
-00010970: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-00010980: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-00010990: 7365 742d 6d69 6e2d 6c61 7469 7475 6465  set-min-latitude
-000109a0: 2d64 6567 7265 6573 275d 203d 206c 6174  -degrees'] = lat
-000109b0: 5f6d 696e 0a20 2020 2020 2020 2020 2020  _min.           
-000109c0: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
-000109d0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-000109e0: 6d61 6765 2d73 6574 2d6d 6178 2d6c 6174  mage-set-max-lat
-000109f0: 6974 7564 652d 6465 6772 6565 7327 5d20  itude-degrees'] 
-00010a00: 3d20 6c61 745f 6d61 780a 2020 2020 2020  = lat_max.      
-00010a10: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
-00010a20: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-00010a30: 795d 5b27 696d 6167 652d 7365 742d 6d69  y]['image-set-mi
-00010a40: 6e2d 6c6f 6e67 6974 7564 652d 6465 6772  n-longitude-degr
-00010a50: 6565 7327 5d20 3d20 6c6f 6e5f 6d69 6e0a  ees'] = lon_min.
-00010a60: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
-00010a70: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-00010a80: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-00010a90: 7365 742d 6d61 782d 6c6f 6e67 6974 7564  set-max-longitud
-00010aa0: 652d 6465 6772 6565 7327 5d20 3d20 6c6f  e-degrees'] = lo
-00010ab0: 6e5f 6d61 780a 0a0a 2020 2020 4073 7461  n_max...    @sta
-00010ac0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-00010ad0: 6620 5f67 6574 5f6c 6174 5f6c 6f6e 5f62  f _get_lat_lon_b
-00010ae0: 6f75 6e64 696e 675f 626f 7828 6974 656d  ounding_box(item
-00010af0: 733a 6469 6374 293a 0a20 2020 2020 2020  s:dict):.       
-00010b00: 2022 2222 2052 6574 7572 6e73 206c 6174   """ Returns lat
-00010b10: 5f6d 696e 2c20 6c61 745f 6d61 782c 206c  _min, lat_max, l
-00010b20: 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61 7820  on_min, lon_max 
-00010b30: 2222 220a 2020 2020 2020 2020 6c61 745f  """.        lat_
-00010b40: 6d69 6e2c 206c 6174 5f6d 6178 2c20 6c6f  min, lat_max, lo
-00010b50: 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178 203d  n_min, lon_max =
-00010b60: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
-00010b70: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
-00010b80: 6920 3d20 300a 2020 2020 2020 2020 666f  i = 0.        fo
-00010b90: 7220 696d 6167 652c 2064 6174 6120 696e  r image, data in
-00010ba0: 2069 7465 6d73 2e69 7465 6d73 2829 3a0a   items.items():.
-00010bb0: 2020 2020 2020 2020 2020 2020 2320 6d61              # ma
-00010bc0: 6b65 2069 6d61 6765 2065 6e74 7279 206c  ke image entry l
-00010bd0: 6973 7420 2861 6c73 6f20 6966 2069 7473  ist (also if its
-00010be0: 2061 2070 6963 7475 7265 290a 2020 2020   a picture).    
-00010bf0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00010c00: 7369 6e73 7461 6e63 6528 6461 7461 2c20  sinstance(data, 
-00010c10: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-00010c20: 2020 2020 2020 2064 6174 6120 3d20 5b64         data = [d
-00010c30: 6174 615d 0a20 2020 2020 2020 2020 2020  ata].           
-00010c40: 200a 2020 2020 2020 2020 2020 2020 666f   .            fo
-00010c50: 7220 7469 6d65 706f 696e 745f 6461 7461  r timepoint_data
-00010c60: 2069 6e20 6461 7461 3a0a 2020 2020 2020   in data:.      
-00010c70: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c90: 2020 206c 6174 203d 2074 696d 6570 6f69     lat = timepoi
-00010ca0: 6e74 5f64 6174 615b 2769 6d61 6765 2d6c  nt_data['image-l
-00010cb0: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
-00010cc0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00010cd0: 6e20 3d20 7469 6d65 706f 696e 745f 6461  n = timepoint_da
-00010ce0: 7461 5b27 696d 6167 652d 6c6f 6e67 6974  ta['image-longit
-00010cf0: 7564 6527 5d0a 2020 2020 2020 2020 2020  ude'].          
-00010d00: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-00010d10: 4572 726f 7220 6173 2065 783a 0a20 2020  Error as ex:.   
-00010d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d30: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
-00010d40: 2020 2020 2020 2020 2020 2069 6620 6920             if i 
-00010d50: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00010d60: 2020 2020 2020 2020 2020 6c61 745f 6d69            lat_mi
-00010d70: 6e2c 206c 6174 5f6d 6178 203d 206c 6174  n, lat_max = lat
-00010d80: 2c20 6c61 740a 2020 2020 2020 2020 2020  , lat.          
-00010d90: 2020 2020 2020 2020 2020 6c6f 6e5f 6d69            lon_mi
-00010da0: 6e2c 206c 6f6e 5f6d 6178 203d 206c 6f6e  n, lon_max = lon
-00010db0: 2c20 6c6f 6e0a 2020 2020 2020 2020 2020  , lon.          
-00010dc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010de0: 6966 206c 6174 203c 206c 6174 5f6d 696e  if lat < lat_min
-00010df0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010e00: 2020 2020 2020 2020 2020 6c61 745f 6d69            lat_mi
-00010e10: 6e20 3d20 6c61 740a 2020 2020 2020 2020  n = lat.        
-00010e20: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00010e30: 6174 203e 206c 6174 5f6d 6178 3a0a 2020  at > lat_max:.  
-00010e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e50: 2020 2020 2020 6c61 745f 6d61 7820 3d20        lat_max = 
-00010e60: 6c61 740a 2020 2020 2020 2020 2020 2020  lat.            
-00010e70: 2020 2020 2020 2020 6966 206c 6f6e 203c          if lon <
-00010e80: 206c 6f6e 5f6d 696e 3a0a 2020 2020 2020   lon_min:.      
-00010e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ea0: 2020 6c6f 6e5f 6d69 6e20 3d20 6c6f 6e0a    lon_min = lon.
-00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ec0: 2020 2020 6966 206c 6f6e 203e 206c 6f6e      if lon > lon
-00010ed0: 5f6d 6178 3a0a 2020 2020 2020 2020 2020  _max:.          
-00010ee0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00010ef0: 6e5f 6d61 7820 3d20 6c6f 6e0a 2020 2020  n_max = lon.    
-00010f00: 2020 2020 2020 2020 2020 2020 6920 2b3d              i +=
-00010f10: 2031 0a20 2020 2020 2020 2072 6574 7572   1.        retur
-00010f20: 6e20 6c61 745f 6d69 6e2c 206c 6174 5f6d  n lat_min, lat_m
-00010f30: 6178 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e  ax, lon_min, lon
-00010f40: 5f6d 6178 0a0a 0a20 2020 2064 6566 2072  _max...    def r
-00010f50: 656d 6f76 6549 7465 6d46 6965 6c64 7357  emoveItemFieldsW
-00010f60: 6974 684f 6e6c 7944 6174 6554 696d 6528  ithOnlyDateTime(
-00010f70: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00010f80: 2222 2069 7420 6361 6e20 6861 7070 656e  "" it can happen
-00010f90: 2074 6861 7420 616e 2069 6d61 6765 2074   that an image t
-00010fa0: 696d 6573 7461 6d70 2064 6f65 7320 6e6f  imestamp does no
-00010fb0: 7420 636f 6e74 6169 6e20 616e 7920 6669  t contain any fi
-00010fc0: 656c 6473 2062 7574 2074 6865 2074 696d  elds but the tim
-00010fd0: 6573 7461 6d70 2061 6e79 206d 6f72 652e  estamp any more.
-00010fe0: 2054 686f 7365 2061 7265 2072 656d 6f76   Those are remov
-00010ff0: 6564 2068 6572 652e 2022 2222 200a 2020  ed here. """ .  
-00011000: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
-00011010: 6e20 7365 6c66 2e69 6664 6f5f 746d 705b  n self.ifdo_tmp[
-00011020: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-00011030: 6d73 4b65 795d 3a0a 2020 2020 2020 2020  msKey]:.        
-00011040: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00011050: 7461 6e63 6528 7365 6c66 2e69 6664 6f5f  tance(self.ifdo_
-00011060: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-00011070: 7449 7465 6d73 4b65 795d 5b69 7465 6d5d  tItemsKey][item]
-00011080: 2c6c 6973 7429 3a0a 2020 2020 2020 2020  ,list):.        
-00011090: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-000110a0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-000110b0: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-000110c0: 6d5d 203d 205b 7365 6c66 2e69 6664 6f5f  m] = [self.ifdo_
-000110d0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-000110e0: 7449 7465 6d73 4b65 795d 5b69 7465 6d5d  tItemsKey][item]
-000110f0: 5d0a 2020 2020 2020 2020 2020 2020 746f  ].            to
-00011100: 4265 5265 6d6f 7665 6420 3d20 5b5d 0a20  BeRemoved = []. 
-00011110: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-00011120: 6e74 7279 2069 6e20 7365 6c66 2e69 6664  ntry in self.ifd
-00011130: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00011140: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-00011150: 6d5d 3a0a 2020 2020 2020 2020 2020 2020  m]:.            
-00011160: 2020 2020 2370 7269 6e74 2865 6e74 7279      #print(entry
-00011170: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011180: 2020 6966 206c 656e 2865 6e74 7279 2920    if len(entry) 
-00011190: 3d3d 2031 2061 6e64 2027 696d 6167 652d  == 1 and 'image-
-000111a0: 6461 7465 7469 6d65 2720 696e 2065 6e74  datetime' in ent
-000111b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-000111c0: 2020 2020 2020 2020 746f 4265 5265 6d6f          toBeRemo
-000111d0: 7665 642e 6170 7065 6e64 2865 6e74 7279  ved.append(entry
-000111e0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-000111f0: 7220 656e 7472 7920 696e 2074 6f42 6552  r entry in toBeR
-00011200: 656d 6f76 6564 3a0a 2020 2020 2020 2020  emoved:.        
-00011210: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-00011220: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00011230: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-00011240: 6d5d 2e72 656d 6f76 6528 656e 7472 7929  m].remove(entry)
-00011250: 200a 0a0a 2020 2020 6465 6620 6368 6563   ...    def chec
-00011260: 6b41 6c6c 4974 656d 4861 7368 6573 2873  kAllItemHashes(s
-00011270: 656c 662c 2068 6172 643d 4661 6c73 652c  elf, hard=False,
-00011280: 2072 6169 7365 4578 6365 7074 696f 6e20   raiseException 
-00011290: 3d20 5472 7565 293a 0a20 2020 2020 2020  = True):.       
-000112a0: 2022 2222 200a 2020 2020 2020 2020 4368   """ .        Ch
-000112b0: 6563 6b73 2069 6620 6861 7368 6573 2069  ecks if hashes i
-000112c0: 6e20 6946 444f 206d 6174 6368 2068 6173  n iFDO match has
-000112d0: 6865 7320 696e 2069 6e74 6572 6d65 6964  hes in intermeid
-000112e0: 6174 6520 6861 7368 2066 696c 6520 6966  ate hash file if
-000112f0: 2074 6865 206c 6174 7465 7220 7761 7320   the latter was 
-00011300: 6368 616e 6765 6420 6c61 7374 2061 6674  changed last aft
-00011310: 6572 2074 6865 2069 6d61 6765 7320 6861  er the images ha
-00011320: 7320 6368 616e 6765 642e 0a20 2020 2020  s changed..     
-00011330: 2020 204f 7468 6572 7769 7365 206f 7220     Otherwise or 
-00011340: 6966 2068 6172 643d 3d54 7275 6520 6974  if hard==True it
-00011350: 2072 6564 6574 6572 6d69 6e65 7320 7468   redetermines th
-00011360: 6520 6163 7475 616c 6c20 6669 6c65 2773  e actuall file's
-00011370: 2068 6173 6820 616e 6420 636f 6d70 6172   hash and compar
-00011380: 6573 2074 6865 2069 4644 4f20 6974 656d  es the iFDO item
-00011390: 2773 2068 6173 6820 7769 7468 2074 6861  's hash with tha
-000113a0: 742e 0a20 2020 2020 2020 2049 6620 6861  t..        If ha
-000113b0: 7368 6573 2064 6f20 6e6f 7420 6d61 7463  shes do not matc
-000113c0: 6820 6120 6d61 7269 7174 2e63 6f72 652e  h a mariqt.core.
-000113d0: 4966 646f 4578 6365 7074 696f 6e20 6973  IfdoException is
-000113e0: 2072 6973 656e 2075 6e73 6c65 7373 2072   risen unsless r
-000113f0: 6169 7365 4578 6365 7074 696f 6e20 3d3d  aiseException ==
-00011400: 2046 616c 7365 2c20 7468 656e 2061 206c   False, then a l
-00011410: 6973 7420 6f66 206c 6973 7473 205b 3c66  ist of lists [<f
-00011420: 696c 653e 2c3c 6578 6365 7074 696f 6e3e  ile>,<exception>
-00011430: 5d20 6973 2072 6574 7572 6e65 642e 0a20  ] is returned.. 
-00011440: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011450: 2020 2068 6173 6865 7320 3d20 7b7d 0a20     hashes = {}. 
-00011460: 2020 2020 2020 2068 6173 6846 696c 654d         hashFileM
-00011470: 6f64 5469 6d65 203d 2031 3065 2b31 3030  odTime = 10e+100
-00011480: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-00011490: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
-000114a0: 6765 745f 696e 745f 6861 7368 5f66 696c  get_int_hash_fil
-000114b0: 6528 2929 3a0a 2020 2020 2020 2020 2020  e()):.          
-000114c0: 2020 6861 7368 6573 203d 206d 6971 7466    hashes = miqtf
-000114d0: 2e74 6162 4669 6c65 4461 7461 2873 656c  .tabFileData(sel
-000114e0: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
-000114f0: 696c 6528 292c 205b 6d69 7174 762e 636f  ile(), [miqtv.co
-00011500: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00011510: 275d 5b27 696d 6727 5d2c 206d 6971 7476  ']['img'], miqtv
-00011520: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00011530: 6971 7427 5d5b 2768 6173 6827 5d5d 2c20  iqt']['hash']], 
-00011540: 6b65 795f 636f 6c3d 6d69 7174 762e 636f  key_col=miqtv.co
-00011550: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00011560: 275d 5b27 696d 6727 5d29 0a20 2020 2020  ']['img']).     
-00011570: 2020 2020 2020 2068 6173 6846 696c 654d         hashFileM
-00011580: 6f64 5469 6d65 203d 206f 732e 7061 7468  odTime = os.path
-00011590: 2e67 6574 6d74 696d 6528 7365 6c66 2e67  .getmtime(self.g
-000115a0: 6574 5f69 6e74 5f68 6173 685f 6669 6c65  et_int_hash_file
-000115b0: 2829 290a 0a20 2020 2020 2020 2065 7863  ())..        exc
-000115c0: 6570 7469 6f6e 4c69 7374 203d 205b 5d0a  eptionList = [].
-000115d0: 0a20 2020 2020 2020 2068 6173 6855 6e63  .        hashUnc
-000115e0: 6865 636b 496d 6167 6573 496e 5261 7720  heckImagesInRaw 
-000115f0: 3d20 7365 6c66 2e69 6d61 6765 7349 6e49  = self.imagesInI
-00011600: 6d61 6765 7344 6972 2829 0a20 2020 2020  magesDir().     
-00011610: 2020 2070 726f 6720 3d20 6d69 7174 632e     prog = miqtc.
-00011620: 5072 696e 744b 6e6f 776e 5072 6f67 7265  PrintKnownProgre
-00011630: 7373 4d73 6728 2243 6865 636b 696e 6720  ssMsg("Checking 
-00011640: 6974 656d 2068 6173 6865 7322 2c20 6c65  item hashes", le
-00011650: 6e28 7365 6c66 2e69 6664 6f5f 746d 705b  n(self.ifdo_tmp[
-00011660: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-00011670: 6d73 4b65 795d 2929 0a20 2020 2020 2020  msKey])).       
-00011680: 2066 6f72 2069 7465 6d20 696e 2073 656c   for item in sel
-00011690: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-000116a0: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-000116b0: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
-000116c0: 726f 672e 7072 6f67 7265 7373 2829 0a0a  rog.progress()..
-000116d0: 2020 2020 2020 2020 2020 2020 666f 756e              foun
-000116e0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-000116f0: 2020 2020 2020 666f 7220 696d 6167 6520        for image 
-00011700: 696e 2068 6173 6855 6e63 6865 636b 496d  in hashUncheckIm
-00011710: 6167 6573 496e 5261 773a 0a20 2020 2020  agesInRaw:.     
-00011720: 2020 2020 2020 2020 2020 2066 696c 654e             fileN
-00011730: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
-00011740: 7365 6e61 6d65 2869 6d61 6765 290a 2020  sename(image).  
-00011750: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011760: 2066 696c 654e 616d 6520 3d3d 2069 7465   fileName == ite
-00011770: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
-00011780: 2020 2020 2020 2066 6f75 6e64 203d 2054         found = T
-00011790: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-000117a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000117b0: 7461 6e63 6528 7365 6c66 2e69 6664 6f5f  tance(self.ifdo_
-000117c0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-000117d0: 7449 7465 6d73 4b65 795d 5b69 7465 6d5d  tItemsKey][item]
-000117e0: 2c6c 6973 7429 3a20 2320 696e 2063 6173  ,list): # in cas
-000117f0: 6520 6f66 2076 6964 656f 2077 6974 6820  e of video with 
-00011800: 6974 656d 2061 7320 6c69 7374 2074 6865  item as list the
-00011810: 2066 6972 7374 2065 6e74 7279 2068 6f6c   first entry hol
-00011820: 6473 2074 6865 2064 6566 6175 6c74 2061  ds the default a
-00011830: 6e64 2074 6865 2068 6173 6820 6361 6e6e  nd the hash cann
-00011840: 6f74 2076 6172 7920 666f 7220 7468 6520  ot vary for the 
-00011850: 7361 6d65 2069 6d61 6765 0a20 2020 2020  same image.     
-00011860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011870: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
-00011880: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-00011890: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-000118a0: 6579 5d5b 6974 656d 5d5b 305d 200a 2020  ey][item][0] .  
-000118b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000118d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118e0: 6974 656d 456e 7472 7920 3d20 7365 6c66  itemEntry = self
-000118f0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00011900: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-00011910: 5b69 7465 6d5d 0a0a 2020 2020 2020 2020  [item]..        
-00011920: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00011930: 654d 6f64 5469 6d65 203d 206f 732e 7061  eModTime = os.pa
-00011940: 7468 2e67 6574 6d74 696d 6528 696d 6167  th.getmtime(imag
-00011950: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00011960: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
-00011970: 7264 2061 6e64 2069 6d61 6765 4d6f 6454  rd and imageModT
-00011980: 696d 6520 3c20 6861 7368 4669 6c65 4d6f  ime < hashFileMo
-00011990: 6454 696d 653a 0a20 2020 2020 2020 2020  dTime:.         
-000119a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000119b0: 6620 6e6f 7420 6f73 2e70 6174 682e 6261  f not os.path.ba
-000119c0: 7365 6e61 6d65 2869 6d61 6765 2920 696e  sename(image) in
-000119d0: 2068 6173 6865 733a 0a20 2020 2020 2020   hashes:.       
-000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119f0: 2020 2020 2069 6620 7261 6973 6545 7863       if raiseExc
-00011a00: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00010520: 7661 6c75 6573 202b 3d20 6c69 7374 2869  values += list(i
+00010530: 7465 6d5f 7661 6c2e 7661 6c75 6573 2829  tem_val.values()
+00010540: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010550: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00010560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010570: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00010580: 6573 2e61 7070 656e 6428 6974 656d 5f76  es.append(item_v
+00010590: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+000105a0: 2020 2020 2020 2020 6578 6365 7074 206d          except m
+000105b0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+000105c0: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
+000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105e0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+000105f0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
+00010600: 5b69 2066 6f72 2069 2069 6e20 7661 6c75  [i for i in valu
+00010610: 6573 2069 6620 6920 213d 2027 275d 0a20  es if i != '']. 
+00010620: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010630: 6620 6c65 6e28 7661 6c75 6573 2920 3d3d  f len(values) ==
+00010640: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00010650: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00010660: 762e 6c6f 6728 2243 6f75 6c64 206e 6f74  v.log("Could not
+00010670: 2073 6574 2072 6570 7265 7365 6e74 6174   set representat
+00010680: 6976 6520 6865 6164 6572 2066 6965 6c64  ive header field
+00010690: 2c20 6e6f 2076 616c 7565 7320 666f 756e  , no values foun
+000106a0: 643a 2022 202b 2066 6965 6c64 290a 2020  d: " + field).  
+000106b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000106c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000106d0: 2020 2020 2020 2020 2320 6967 6e6f 7265          # ignore
+000106e0: 2075 6e6b 6e6f 6e77 2c20 692e 652e 2030   unknonw, i.e. 0
+000106f0: 2e30 2c20 7661 6c75 6573 0a20 2020 2020  .0, values.     
+00010700: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00010710: 616c 7565 7320 3d20 5b69 2066 6f72 2069  alues = [i for i
+00010720: 2069 6e20 7661 6c75 6573 2069 6620 6920   in values if i 
+00010730: 213d 2030 2e30 5d0a 2020 2020 2020 2020  != 0.0].        
+00010740: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00010750: 656e 2876 616c 7565 7329 203d 3d20 303a  en(values) == 0:
+00010760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010770: 2020 2020 2020 2020 2076 616c 7565 732e           values.
+00010780: 6170 7065 6e64 2830 2e30 2920 0a20 2020  append(0.0) .   
+00010790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107a0: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
+000107b0: 5365 7448 6561 6465 724b 6579 5d5b 6669  SetHeaderKey][fi
+000107c0: 656c 645d 203d 2073 7461 7469 7374 6963  eld] = statistic
+000107d0: 732e 6d65 6469 616e 2876 616c 7565 7329  s.median(values)
+000107e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000107f0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00010800: 6f67 2822 5365 7420 7265 7072 6573 656e  og("Set represen
+00010810: 7461 7469 7665 2068 6561 6465 7220 6669  tative header fi
+00010820: 656c 6420 2722 202b 2066 6965 6c64 202b  eld '" + field +
+00010830: 2022 2720 746f 206d 6564 6961 6e3a 2022   "' to median: "
+00010840: 202b 2073 7472 2869 6664 6f5b 7365 6c66   + str(ifdo[self
+00010850: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00010860: 6579 5d5b 6669 656c 645d 2920 2b20 222e  ey][field]) + ".
+00010870: 2229 0a0a 0a20 2020 2064 6566 205f 7365  ")...    def _se
+00010880: 745f 6c61 745f 6c6f 6e5f 626f 756e 6469  t_lat_lon_boundi
+00010890: 6e67 5f62 6f78 2873 656c 662c 6966 646f  ng_box(self,ifdo
+000108a0: 3a64 6963 7429 3a0a 2020 2020 2020 2020  :dict):.        
+000108b0: 2222 2220 5365 7420 696d 6167 652d 7365  """ Set image-se
+000108c0: 742d 5b6d 696e 2c6d 6178 5d2d 5b6c 6174  t-[min,max]-[lat
+000108d0: 6974 7564 652c 6c6f 6e67 6974 7564 655d  itude,longitude]
+000108e0: 2d64 6567 7265 6573 2022 2222 0a20 2020  -degrees """.   
+000108f0: 2020 2020 206c 6174 5f6d 696e 2c20 6c61       lat_min, la
+00010900: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
+00010910: 6c6f 6e5f 6d61 7820 3d20 7365 6c66 2e5f  lon_max = self._
+00010920: 6765 745f 6c61 745f 6c6f 6e5f 626f 756e  get_lat_lon_boun
+00010930: 6469 6e67 5f62 6f78 2869 6664 6f5b 7365  ding_box(ifdo[se
+00010940: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00010950: 4b65 795d 290a 2020 2020 2020 2020 6966  Key]).        if
+00010960: 206e 6f74 204e 6f6e 6520 696e 205b 6c61   not None in [la
+00010970: 745f 6d69 6e2c 206c 6174 5f6d 6178 2c20  t_min, lat_max, 
+00010980: 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178  lon_min, lon_max
+00010990: 5d3a 0a20 2020 2020 2020 2020 2020 2069  ]:.            i
+000109a0: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+000109b0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+000109c0: 6765 2d73 6574 2d6d 696e 2d6c 6174 6974  ge-set-min-latit
+000109d0: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
+000109e0: 6c61 745f 6d69 6e0a 2020 2020 2020 2020  lat_min.        
+000109f0: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+00010a00: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+00010a10: 5b27 696d 6167 652d 7365 742d 6d61 782d  ['image-set-max-
+00010a20: 6c61 7469 7475 6465 2d64 6567 7265 6573  latitude-degrees
+00010a30: 275d 203d 206c 6174 5f6d 6178 0a20 2020  '] = lat_max.   
+00010a40: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
+00010a50: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+00010a60: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
+00010a70: 2d6d 696e 2d6c 6f6e 6769 7475 6465 2d64  -min-longitude-d
+00010a80: 6567 7265 6573 275d 203d 206c 6f6e 5f6d  egrees'] = lon_m
+00010a90: 696e 0a20 2020 2020 2020 2020 2020 2069  in.            i
+00010aa0: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+00010ab0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+00010ac0: 6765 2d73 6574 2d6d 6178 2d6c 6f6e 6769  ge-set-max-longi
+00010ad0: 7475 6465 2d64 6567 7265 6573 275d 203d  tude-degrees'] =
+00010ae0: 206c 6f6e 5f6d 6178 0a0a 0a20 2020 2040   lon_max...    @
+00010af0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00010b00: 2064 6566 205f 6765 745f 6c61 745f 6c6f   def _get_lat_lo
+00010b10: 6e5f 626f 756e 6469 6e67 5f62 6f78 2869  n_bounding_box(i
+00010b20: 7465 6d73 3a64 6963 7429 3a0a 2020 2020  tems:dict):.    
+00010b30: 2020 2020 2222 2220 5265 7475 726e 7320      """ Returns 
+00010b40: 6c61 745f 6d69 6e2c 206c 6174 5f6d 6178  lat_min, lat_max
+00010b50: 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d  , lon_min, lon_m
+00010b60: 6178 2022 2222 0a20 2020 2020 2020 206c  ax """.        l
+00010b70: 6174 5f6d 696e 2c20 6c61 745f 6d61 782c  at_min, lat_max,
+00010b80: 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61   lon_min, lon_ma
+00010b90: 7820 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20  x = None, None, 
+00010ba0: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+00010bb0: 2020 2069 203d 2030 0a20 2020 2020 2020     i = 0.       
+00010bc0: 2066 6f72 2069 6d61 6765 2c20 6461 7461   for image, data
+00010bd0: 2069 6e20 6974 656d 732e 6974 656d 7328   in items.items(
+00010be0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+00010bf0: 206d 616b 6520 696d 6167 6520 656e 7472   make image entr
+00010c00: 7920 6c69 7374 2028 616c 736f 2069 6620  y list (also if 
+00010c10: 6974 7320 6120 7069 6374 7572 6529 0a20  its a picture). 
+00010c20: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00010c30: 7420 6973 696e 7374 616e 6365 2864 6174  t isinstance(dat
+00010c40: 612c 206c 6973 7429 3a0a 2020 2020 2020  a, list):.      
+00010c50: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+00010c60: 205b 6461 7461 5d0a 2020 2020 2020 2020   [data].        
+00010c70: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00010c80: 2066 6f72 2074 696d 6570 6f69 6e74 5f64   for timepoint_d
+00010c90: 6174 6120 696e 2064 6174 613a 0a20 2020  ata in data:.   
+00010ca0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00010cb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010cc0: 2020 2020 2020 6c61 7420 3d20 7469 6d65        lat = time
+00010cd0: 706f 696e 745f 6461 7461 5b27 696d 6167  point_data['imag
+00010ce0: 652d 6c61 7469 7475 6465 275d 0a20 2020  e-latitude'].   
+00010cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d00: 206c 6f6e 203d 2074 696d 6570 6f69 6e74   lon = timepoint
+00010d10: 5f64 6174 615b 2769 6d61 6765 2d6c 6f6e  _data['image-lon
+00010d20: 6769 7475 6465 275d 0a20 2020 2020 2020  gitude'].       
+00010d30: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00010d40: 4b65 7945 7272 6f72 2061 7320 6578 3a0a  KeyError as ex:.
+00010d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d60: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+00010d70: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010d80: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
+00010d90: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+00010da0: 5f6d 696e 2c20 6c61 745f 6d61 7820 3d20  _min, lat_max = 
+00010db0: 6c61 742c 206c 6174 0a20 2020 2020 2020  lat, lat.       
+00010dc0: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
+00010dd0: 5f6d 696e 2c20 6c6f 6e5f 6d61 7820 3d20  _min, lon_max = 
+00010de0: 6c6f 6e2c 206c 6f6e 0a20 2020 2020 2020  lon, lon.       
+00010df0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e10: 2020 2069 6620 6c61 7420 3c20 6c61 745f     if lat < lat_
+00010e20: 6d69 6e3a 0a20 2020 2020 2020 2020 2020  min:.           
+00010e30: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+00010e40: 5f6d 696e 203d 206c 6174 0a20 2020 2020  _min = lat.     
+00010e50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010e60: 6620 6c61 7420 3e20 6c61 745f 6d61 783a  f lat > lat_max:
+00010e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010e80: 2020 2020 2020 2020 206c 6174 5f6d 6178           lat_max
+00010e90: 203d 206c 6174 0a20 2020 2020 2020 2020   = lat.         
+00010ea0: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
+00010eb0: 6e20 3c20 6c6f 6e5f 6d69 6e3a 0a20 2020  n < lon_min:.   
+00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ed0: 2020 2020 206c 6f6e 5f6d 696e 203d 206c       lon_min = l
+00010ee0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00010ef0: 2020 2020 2020 2069 6620 6c6f 6e20 3e20         if lon > 
+00010f00: 6c6f 6e5f 6d61 783a 0a20 2020 2020 2020  lon_max:.       
+00010f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f20: 206c 6f6e 5f6d 6178 203d 206c 6f6e 0a20   lon_max = lon. 
+00010f30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010f40: 202b 3d20 310a 2020 2020 2020 2020 7265   += 1.        re
+00010f50: 7475 726e 206c 6174 5f6d 696e 2c20 6c61  turn lat_min, la
+00010f60: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
+00010f70: 6c6f 6e5f 6d61 780a 0a0a 2020 2020 6465  lon_max...    de
+00010f80: 6620 7265 6d6f 7665 4974 656d 4669 656c  f removeItemFiel
+00010f90: 6473 5769 7468 4f6e 6c79 4461 7465 5469  dsWithOnlyDateTi
+00010fa0: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
+00010fb0: 2020 2222 2220 6974 2063 616e 2068 6170    """ it can hap
+00010fc0: 7065 6e20 7468 6174 2061 6e20 696d 6167  pen that an imag
+00010fd0: 6520 7469 6d65 7374 616d 7020 646f 6573  e timestamp does
+00010fe0: 206e 6f74 2063 6f6e 7461 696e 2061 6e79   not contain any
+00010ff0: 2066 6965 6c64 7320 6275 7420 7468 6520   fields but the 
+00011000: 7469 6d65 7374 616d 7020 616e 7920 6d6f  timestamp any mo
+00011010: 7265 2e20 5468 6f73 6520 6172 6520 7265  re. Those are re
+00011020: 6d6f 7665 6420 6865 7265 2e20 2222 2220  moved here. """ 
+00011030: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
+00011040: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
+00011050: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+00011060: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
+00011070: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00011080: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
+00011090: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+000110a0: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+000110b0: 656d 5d2c 6c69 7374 293a 0a20 2020 2020  em],list):.     
+000110c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000110d0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+000110e0: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+000110f0: 6974 656d 5d20 3d20 5b73 656c 662e 6966  item] = [self.if
+00011100: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00011110: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+00011120: 656d 5d5d 0a20 2020 2020 2020 2020 2020  em]].           
+00011130: 2074 6f42 6552 656d 6f76 6564 203d 205b   toBeRemoved = [
+00011140: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+00011150: 7220 656e 7472 7920 696e 2073 656c 662e  r entry in self.
+00011160: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00011170: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+00011180: 6974 656d 5d3a 0a20 2020 2020 2020 2020  item]:.         
+00011190: 2020 2020 2020 2023 7072 696e 7428 656e         #print(en
+000111a0: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
+000111b0: 2020 2020 2069 6620 6c65 6e28 656e 7472       if len(entr
+000111c0: 7929 203d 3d20 3120 616e 6420 2769 6d61  y) == 1 and 'ima
+000111d0: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
+000111e0: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
+000111f0: 2020 2020 2020 2020 2020 2074 6f42 6552             toBeR
+00011200: 656d 6f76 6564 2e61 7070 656e 6428 656e  emoved.append(en
+00011210: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
+00011220: 2066 6f72 2065 6e74 7279 2069 6e20 746f   for entry in to
+00011230: 4265 5265 6d6f 7665 643a 0a20 2020 2020  BeRemoved:.     
+00011240: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011250: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00011260: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
+00011270: 6974 656d 5d2e 7265 6d6f 7665 2865 6e74  item].remove(ent
+00011280: 7279 2920 0a0a 0a20 2020 2064 6566 2063  ry) ...    def c
+00011290: 6865 636b 416c 6c49 7465 6d48 6173 6865  heckAllItemHashe
+000112a0: 7328 7365 6c66 2c20 6861 7264 3d46 616c  s(self, hard=Fal
+000112b0: 7365 2c20 7261 6973 6545 7863 6570 7469  se, raiseExcepti
+000112c0: 6f6e 203d 2054 7275 6529 3a0a 2020 2020  on = True):.    
+000112d0: 2020 2020 2222 2220 0a20 2020 2020 2020      """ .       
+000112e0: 2043 6865 636b 7320 6966 2068 6173 6865   Checks if hashe
+000112f0: 7320 696e 2069 4644 4f20 6d61 7463 6820  s in iFDO match 
+00011300: 6861 7368 6573 2069 6e20 696e 7465 726d  hashes in interm
+00011310: 6569 6461 7465 2068 6173 6820 6669 6c65  eidate hash file
+00011320: 2069 6620 7468 6520 6c61 7474 6572 2077   if the latter w
+00011330: 6173 2063 6861 6e67 6564 206c 6173 7420  as changed last 
+00011340: 6166 7465 7220 7468 6520 696d 6167 6573  after the images
+00011350: 2068 6173 2063 6861 6e67 6564 2e0a 2020   has changed..  
+00011360: 2020 2020 2020 4f74 6865 7277 6973 6520        Otherwise 
+00011370: 6f72 2069 6620 6861 7264 3d3d 5472 7565  or if hard==True
+00011380: 2069 7420 7265 6465 7465 726d 696e 6573   it redetermines
+00011390: 2074 6865 2061 6374 7561 6c6c 2066 696c   the actuall fil
+000113a0: 6527 7320 6861 7368 2061 6e64 2063 6f6d  e's hash and com
+000113b0: 7061 7265 7320 7468 6520 6946 444f 2069  pares the iFDO i
+000113c0: 7465 6d27 7320 6861 7368 2077 6974 6820  tem's hash with 
+000113d0: 7468 6174 2e0a 2020 2020 2020 2020 4966  that..        If
+000113e0: 2068 6173 6865 7320 646f 206e 6f74 206d   hashes do not m
+000113f0: 6174 6368 2061 206d 6172 6971 742e 636f  atch a mariqt.co
+00011400: 7265 2e49 6664 6f45 7863 6570 7469 6f6e  re.IfdoException
+00011410: 2069 7320 7269 7365 6e20 756e 736c 6573   is risen unsles
+00011420: 7320 7261 6973 6545 7863 6570 7469 6f6e  s raiseException
+00011430: 203d 3d20 4661 6c73 652c 2074 6865 6e20   == False, then 
+00011440: 6120 6c69 7374 206f 6620 6c69 7374 7320  a list of lists 
+00011450: 5b3c 6669 6c65 3e2c 3c65 7863 6570 7469  [<file>,<excepti
+00011460: 6f6e 3e5d 2069 7320 7265 7475 726e 6564  on>] is returned
+00011470: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00011480: 2020 2020 2020 6861 7368 6573 203d 207b        hashes = {
+00011490: 7d0a 2020 2020 2020 2020 6861 7368 4669  }.        hashFi
+000114a0: 6c65 4d6f 6454 696d 6520 3d20 3130 652b  leModTime = 10e+
+000114b0: 3130 300a 2020 2020 2020 2020 6966 206f  100.        if o
+000114c0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+000114d0: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
+000114e0: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
+000114f0: 2020 2020 2068 6173 6865 7320 3d20 6d69       hashes = mi
+00011500: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
+00011510: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
+00011520: 685f 6669 6c65 2829 2c20 5b6d 6971 7476  h_file(), [miqtv
+00011530: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00011540: 6971 7427 5d5b 2769 6d67 275d 2c20 6d69  iqt']['img'], mi
+00011550: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00011560: 6d61 7269 7174 275d 5b27 6861 7368 275d  mariqt']['hash']
+00011570: 5d2c 206b 6579 5f63 6f6c 3d6d 6971 7476  ], key_col=miqtv
+00011580: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00011590: 6971 7427 5d5b 2769 6d67 275d 290a 2020  iqt']['img']).  
+000115a0: 2020 2020 2020 2020 2020 6861 7368 4669            hashFi
+000115b0: 6c65 4d6f 6454 696d 6520 3d20 6f73 2e70  leModTime = os.p
+000115c0: 6174 682e 6765 746d 7469 6d65 2873 656c  ath.getmtime(sel
+000115d0: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
+000115e0: 696c 6528 2929 0a0a 2020 2020 2020 2020  ile())..        
+000115f0: 6578 6365 7074 696f 6e4c 6973 7420 3d20  exceptionList = 
+00011600: 5b5d 0a0a 2020 2020 2020 2020 6861 7368  []..        hash
+00011610: 556e 6368 6563 6b49 6d61 6765 7349 6e52  UncheckImagesInR
+00011620: 6177 203d 2073 656c 662e 696d 6167 6573  aw = self.images
+00011630: 496e 496d 6167 6573 4469 7228 290a 2020  InImagesDir().  
+00011640: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+00011650: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+00011660: 6772 6573 734d 7367 2822 4368 6563 6b69  gressMsg("Checki
+00011670: 6e67 2069 7465 6d20 6861 7368 6573 222c  ng item hashes",
+00011680: 206c 656e 2873 656c 662e 6966 646f 5f74   len(self.ifdo_t
+00011690: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+000116a0: 4974 656d 734b 6579 5d29 290a 2020 2020  ItemsKey])).    
+000116b0: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+000116c0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+000116d0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+000116e0: 4b65 795d 3a0a 2020 2020 2020 2020 2020  Key]:.          
+000116f0: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
+00011700: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00011710: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+00011720: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
+00011730: 6765 2069 6e20 6861 7368 556e 6368 6563  ge in hashUnchec
+00011740: 6b49 6d61 6765 7349 6e52 6177 3a0a 2020  kImagesInRaw:.  
+00011750: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00011760: 6c65 4e61 6d65 203d 206f 732e 7061 7468  leName = os.path
+00011770: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+00011780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011790: 2069 6620 6669 6c65 4e61 6d65 203d 3d20   if fileName == 
+000117a0: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
+000117b0: 2020 2020 2020 2020 2020 666f 756e 6420            found 
+000117c0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+000117d0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+000117e0: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
+000117f0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00011800: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
+00011810: 656d 5d2c 6c69 7374 293a 2023 2069 6e20  em],list): # in 
+00011820: 6361 7365 206f 6620 7669 6465 6f20 7769  case of video wi
+00011830: 7468 2069 7465 6d20 6173 206c 6973 7420  th item as list 
+00011840: 7468 6520 6669 7273 7420 656e 7472 7920  the first entry 
+00011850: 686f 6c64 7320 7468 6520 6465 6661 756c  holds the defaul
+00011860: 7420 616e 6420 7468 6520 6861 7368 2063  t and the hash c
+00011870: 616e 6e6f 7420 7661 7279 2066 6f72 2074  annot vary for t
+00011880: 6865 2073 616d 6520 696d 6167 650a 2020  he same image.  
+00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118a0: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
+000118b0: 3d20 7365 6c66 2e69 6664 6f5f 746d 705b  = self.ifdo_tmp[
+000118c0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+000118d0: 6d73 4b65 795d 5b69 7465 6d5d 5b30 5d20  msKey][item][0] 
+000118e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000118f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00011900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011910: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
+00011920: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00011930: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+00011940: 6579 5d5b 6974 656d 5d0a 0a20 2020 2020  ey][item]..     
+00011950: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011960: 6d61 6765 4d6f 6454 696d 6520 3d20 6f73  mageModTime = os
+00011970: 2e70 6174 682e 6765 746d 7469 6d65 2869  .path.getmtime(i
+00011980: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
+00011990: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000119a0: 2068 6172 6420 616e 6420 696d 6167 654d   hard and imageM
+000119b0: 6f64 5469 6d65 203c 2068 6173 6846 696c  odTime < hashFil
+000119c0: 654d 6f64 5469 6d65 3a0a 2020 2020 2020  eModTime:.      
+000119d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119e0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+000119f0: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+00011a00: 2069 6e20 6861 7368 6573 3a0a 2020 2020   in hashes:.    
 00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a20: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-00011a30: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-00011a40: 6e28 6974 656d 2c20 226e 6f74 2066 6f75  n(item, "not fou
-00011a50: 6e64 2069 6e20 696e 7465 726d 6569 6461  nd in intermeida
-00011a60: 7465 2068 6173 6820 6669 6c65 222c 7365  te hash file",se
-00011a70: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
-00011a80: 6669 6c65 2829 2c22 2072 756e 2063 7265  file()," run cre
-00011a90: 6174 655f 696d 6167 655f 7368 6132 3536  ate_image_sha256
-00011aa0: 5f66 696c 6528 2920 6669 7273 7422 2920  _file() first") 
-00011ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ac0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00011ad0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00011ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011af0: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
-00011b00: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
-00011b10: 652c 226e 6f74 2066 6f75 6e64 2069 6e20  e,"not found in 
-00011b20: 696e 7465 726d 6569 6461 7465 2068 6173  intermeidate has
-00011b30: 6820 6669 6c65 2022 202b 2073 7472 2873  h file " + str(s
-00011b40: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
-00011b50: 5f66 696c 6528 2929 5d29 0a20 2020 2020  _file())]).     
-00011b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b70: 2020 2069 6620 6e6f 7420 6974 656d 456e     if not itemEn
-00011b80: 7472 795b 2769 6d61 6765 2d68 6173 682d  try['image-hash-
-00011b90: 7368 6132 3536 275d 203d 3d20 6861 7368  sha256'] == hash
-00011ba0: 6573 5b6f 732e 7061 7468 2e62 6173 656e  es[os.path.basen
-00011bb0: 616d 6528 696d 6167 6529 5d5b 2769 6d61  ame(image)]['ima
-00011bc0: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-00011bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011be0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011bf0: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
-00011c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011a20: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
+00011a30: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00011a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00011a60: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+00011a70: 7469 6f6e 2869 7465 6d2c 2022 6e6f 7420  tion(item, "not 
+00011a80: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
+00011a90: 6964 6174 6520 6861 7368 2066 696c 6522  idate hash file"
+00011aa0: 2c73 656c 662e 6765 745f 696e 745f 6861  ,self.get_int_ha
+00011ab0: 7368 5f66 696c 6528 292c 2220 7275 6e20  sh_file()," run 
+00011ac0: 6372 6561 7465 5f69 6d61 6765 5f73 6861  create_image_sha
+00011ad0: 3235 365f 6669 6c65 2829 2066 6972 7374  256_file() first
+00011ae0: 2229 200a 2020 2020 2020 2020 2020 2020  ") .            
+00011af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00011b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b20: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
+00011b30: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
+00011b40: 4e61 6d65 2c22 6e6f 7420 666f 756e 6420  Name,"not found 
+00011b50: 696e 2069 6e74 6572 6d65 6964 6174 6520  in intermeidate 
+00011b60: 6861 7368 2066 696c 6520 2220 2b20 7374  hash file " + st
+00011b70: 7228 7365 6c66 2e67 6574 5f69 6e74 5f68  r(self.get_int_h
+00011b80: 6173 685f 6669 6c65 2829 295d 290a 2020  ash_file())]).  
+00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ba0: 2020 2020 2020 6966 206e 6f74 2069 7465        if not ite
+00011bb0: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
+00011bc0: 7368 2d73 6861 3235 3627 5d20 3d3d 2068  sh-sha256'] == h
+00011bd0: 6173 6865 735b 6f73 2e70 6174 682e 6261  ashes[os.path.ba
+00011be0: 7365 6e61 6d65 2869 6d61 6765 295d 5b27  sename(image)]['
+00011bf0: 696d 6167 652d 6861 7368 2d73 6861 3235  image-hash-sha25
+00011c00: 3627 5d3a 0a20 2020 2020 2020 2020 2020  6']:.           
 00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c20: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-00011c30: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
-00011c40: 2022 696e 636f 7272 6563 7420 7368 6132   "incorrect sha2
-00011c50: 3536 2068 6173 6822 2c20 6974 656d 456e  56 hash", itemEn
-00011c60: 7472 795b 2769 6d61 6765 2d68 6173 682d  try['image-hash-
-00011c70: 7368 6132 3536 275d 2c22 666f 7220 6669  sha256'],"for fi
-00011c80: 6c65 222c 6669 6c65 4e61 6d65 2c22 2072  le",fileName," r
-00011c90: 756e 2063 7265 6174 655f 696d 6167 655f  un create_image_
-00011ca0: 7368 6132 3536 5f66 696c 6528 2920 6669  sha256_file() fi
-00011cb0: 7273 7422 290a 2020 2020 2020 2020 2020  rst").          
-00011cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cd0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00011ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cf0: 2020 2020 2020 2020 6578 6365 7074 696f          exceptio
-00011d00: 6e4c 6973 742e 6170 7065 6e64 285b 6669  nList.append([fi
-00011d10: 6c65 4e61 6d65 2c22 696e 636f 7272 6563  leName,"incorrec
-00011d20: 7420 7368 6132 3536 2068 6173 6822 5d29  t sha256 hash"])
-00011d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011d40: 2020 2020 2065 6c69 6620 6e6f 7420 6974       elif not it
-00011d50: 656d 456e 7472 795b 2769 6d61 6765 2d68  emEntry['image-h
-00011d60: 6173 682d 7368 6132 3536 275d 203d 3d20  ash-sha256'] == 
-00011d70: 6d69 7174 632e 7368 6132 3536 4861 7368  miqtc.sha256Hash
-00011d80: 4669 6c65 2869 6d61 6765 293a 0a20 2020  File(image):.   
-00011d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011da0: 2020 2020 2069 6620 7261 6973 6545 7863       if raiseExc
-00011db0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00011c20: 2069 6620 7261 6973 6545 7863 6570 7469   if raiseExcepti
+00011c30: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00011c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c50: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
+00011c60: 4966 646f 4578 6365 7074 696f 6e28 6974  IfdoException(it
+00011c70: 656d 2c20 2269 6e63 6f72 7265 6374 2073  em, "incorrect s
+00011c80: 6861 3235 3620 6861 7368 222c 2069 7465  ha256 hash", ite
+00011c90: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
+00011ca0: 7368 2d73 6861 3235 3627 5d2c 2266 6f72  sh-sha256'],"for
+00011cb0: 2066 696c 6522 2c66 696c 654e 616d 652c   file",fileName,
+00011cc0: 2220 7275 6e20 6372 6561 7465 5f69 6d61  " run create_ima
+00011cd0: 6765 5f73 6861 3235 365f 6669 6c65 2829  ge_sha256_file()
+00011ce0: 2066 6972 7374 2229 0a20 2020 2020 2020   first").       
+00011cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d20: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00011d30: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+00011d40: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
+00011d50: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
+00011d60: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+00011d70: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+00011d80: 2069 7465 6d45 6e74 7279 5b27 696d 6167   itemEntry['imag
+00011d90: 652d 6861 7368 2d73 6861 3235 3627 5d20  e-hash-sha256'] 
+00011da0: 3d3d 206d 6971 7463 2e73 6861 3235 3648  == miqtc.sha256H
+00011db0: 6173 6846 696c 6528 696d 6167 6529 3a0a  ashFile(image):.
 00011dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011dd0: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
-00011de0: 4966 646f 4578 6365 7074 696f 6e28 6974  IfdoException(it
-00011df0: 656d 2c20 2269 6e63 6f72 7265 6374 2073  em, "incorrect s
-00011e00: 6861 3235 3620 6861 7368 222c 2069 7465  ha256 hash", ite
-00011e10: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
-00011e20: 7368 2d73 6861 3235 3627 5d2c 2266 6f72  sh-sha256'],"for
-00011e30: 2066 696c 6522 2c66 696c 654e 616d 652c   file",fileName,
-00011e40: 2220 7275 6e20 6372 6561 7465 5f69 6d61  " run create_ima
-00011e50: 6765 5f73 6861 3235 365f 6669 6c65 2829  ge_sha256_file()
-00011e60: 2066 6972 7374 2229 0a20 2020 2020 2020   first").       
-00011e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00011e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ea0: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
-00011eb0: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
-00011ec0: 652c 2269 6e63 6f72 7265 6374 2073 6861  e,"incorrect sha
-00011ed0: 3235 3620 6861 7368 225d 290a 2020 2020  256 hash"]).    
-00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ef0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00011f00: 2020 6966 2066 6f75 6e64 3a0a 2020 2020    if found:.    
-00011f10: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00011f20: 6861 7368 556e 6368 6563 6b49 6d61 6765  hashUncheckImage
-00011f30: 7349 6e52 6177 5b69 6d61 6765 5d0a 2020  sInRaw[image].  
-00011f40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00011f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f60: 6966 2072 6169 7365 4578 6365 7074 696f  if raiseExceptio
-00011f70: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00011f80: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00011f90: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00011fa0: 2820 2269 6d61 6765 222c 2069 7465 6d2c  ( "image", item,
-00011fb0: 2022 6e6f 7420 666f 756e 6420 696e 2064   "not found in d
-00011fc0: 6972 6563 746f 7279 2773 2072 6177 2066  irectory's raw f
-00011fd0: 6f6c 6465 7221 2229 0a20 2020 2020 2020  older!").       
-00011fe0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012000: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
-00012010: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
-00012020: 652c 2266 696c 6520 6e6f 7420 666f 756e  e,"file not foun
-00012030: 6422 5d29 0a20 2020 2020 2020 2070 726f  d"]).        pro
-00012040: 672e 636c 6561 7228 290a 2020 2020 2020  g.clear().      
-00012050: 2020 6966 206e 6f74 2072 6169 7365 4578    if not raiseEx
-00012060: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00012070: 2020 2020 2072 6574 7572 6e20 6578 6365       return exce
-00012080: 7074 696f 6e4c 6973 740a 0a0a 2020 2020  ptionList...    
-00012090: 6465 6620 6372 6561 7465 5f75 7569 645f  def create_uuid_
-000120a0: 6669 6c65 2873 656c 662c 636c 6561 6e3d  file(self,clean=
-000120b0: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
-000120c0: 2222 2043 7265 6174 6573 2069 6e20 2f69  "" Creates in /i
-000120d0: 6e74 6572 6d65 6469 6174 6520 6120 7465  ntermediate a te
-000120e0: 7874 2066 696c 6520 636f 6e74 6169 6e69  xt file containi
-000120f0: 6e67 2070 6572 2069 6d61 6765 2061 2063  ng per image a c
-00012100: 7265 6174 6564 2075 7569 6420 2876 6572  reated uuid (ver
-00012110: 7369 6f6e 2034 292e 0a0a 2020 2020 2020  sion 4)...      
-00012120: 2020 5468 6520 5555 4944 2069 7320 6f6e    The UUID is on
-00012130: 6c79 202a 7461 6b65 6e2a 2066 726f 6d20  ly *taken* from 
-00012140: 7468 6520 6d65 7461 6461 7461 206f 6620  the metadata of 
-00012150: 7468 6520 696d 6167 6573 2e20 4974 2064  the images. It d
-00012160: 6f65 7320 6e6f 7420 7772 6974 6520 5555  oes not write UU
-00012170: 4944 7320 746f 2074 6865 206d 6574 6164  IDs to the metad
-00012180: 6174 6120 696e 2063 6173 6520 736f 6d65  ata in case some
-00012190: 2066 696c 6573 2061 7265 206d 6973 7369   files are missi
-000121a0: 6e67 2069 742e 0a20 2020 2020 2020 2042  ng it..        B
-000121b0: 7574 2c20 6974 2063 7265 6174 6573 2061  ut, it creates a
-000121c0: 2043 5356 2066 696c 6520 696e 2074 6861   CSV file in tha
-000121d0: 7420 6361 7365 2074 6861 7420 796f 7520  t case that you 
-000121e0: 6361 6e20 7573 6520 746f 6765 7468 6572  can use together
-000121f0: 2077 6974 6820 6578 6966 746f 6f6c 2074   with exiftool t
-00012200: 6f20 6164 6420 7468 6520 5555 4944 2074  o add the UUID t
-00012210: 6f20 796f 7572 2064 6174 612e 2042 6577  o your data. Bew
-00012220: 6172 6521 2074 6869 7320 6361 6e20 6465  are! this can de
-00012230: 7374 726f 7920 796f 7572 2069 6d61 6765  stroy your image
-00012240: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-00012250: 2064 6f6e 6520 7072 6f70 6572 6c79 2120   done properly! 
-00012260: 4e6f 2067 7561 7261 6e74 6565 2069 7320  No guarantee is 
-00012270: 6769 7665 6e20 6974 2077 696c 6c20 776f  given it will wo
-00012280: 726b 2e20 4265 2063 6172 6566 756c 210a  rk. Be careful!.
-00012290: 0a20 2020 2020 2020 2055 7365 2063 6c65  .        Use cle
-000122a0: 616e 3d46 616c 7365 2074 6f20 6e6f 7420  an=False to not 
-000122b0: 6368 6563 6b20 7468 6f73 6520 6669 6c65  check those file
-000122c0: 7320 6167 6169 6e20 7768 6963 6820 6172  s again which ar
-000122d0: 6520 616c 7265 6164 7920 666f 756e 6420  e already found 
-000122e0: 696e 2069 6e74 6572 6d65 6469 6174 6520  in intermediate 
-000122f0: 7575 6964 2066 696c 650a 2020 2020 2020  uuid file.      
-00012300: 2020 2222 220a 0a20 2020 2020 2020 2075    """..        u
-00012310: 7569 6473 203d 207b 7d0a 2020 2020 2020  uids = {}.      
-00012320: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
-00012330: 7220 6120 6669 6c65 2077 6974 6820 5555  r a file with UU
-00012340: 4944 7320 6578 6973 7473 2c20 7468 656e  IDs exists, then
-00012350: 2072 6561 6420 6974 0a20 2020 2020 2020   read it.       
-00012360: 2069 6620 6e6f 7420 636c 6561 6e20 616e   if not clean an
-00012370: 6420 6f73 2e70 6174 682e 6578 6973 7473  d os.path.exists
-00012380: 2873 656c 662e 6765 745f 696e 745f 7575  (self.get_int_uu
-00012390: 6964 5f66 696c 6528 2929 3a0a 2020 2020  id_file()):.    
-000123a0: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
-000123b0: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
-000123c0: 6128 7365 6c66 2e67 6574 5f69 6e74 5f75  a(self.get_int_u
-000123d0: 7569 645f 6669 6c65 2829 2c20 5b6d 6971  uid_file(), [miq
-000123e0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000123f0: 6172 6971 7427 5d5b 2769 6d67 275d 2c20  ariqt']['img'], 
-00012400: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00012410: 5b27 6d61 7269 7174 275d 5b27 7575 6964  ['mariqt']['uuid
-00012420: 275d 5d2c 206b 6579 5f63 6f6c 3d6d 6971  ']], key_col=miq
-00012430: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00012440: 6172 6971 7427 5d5b 2769 6d67 275d 290a  ariqt']['img']).
-00012450: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00012460: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00012470: 6578 6973 7473 2873 656c 662e 696d 6167  exists(self.imag
-00012480: 6573 4469 7229 3a0a 0a20 2020 2020 2020  esDir):..       
-00012490: 2020 2020 206d 6973 7369 6e67 5f75 7569       missing_uui
-000124a0: 6473 203d 207b 7d0a 2020 2020 2020 2020  ds = {}.        
-000124b0: 2020 2020 6164 6465 645f 7575 6964 7320      added_uuids 
-000124c0: 3d20 300a 0a20 2020 2020 2020 2020 2020  = 0..           
-000124d0: 2075 6e6b 6e6f 776e 4669 6c65 7320 3d20   unknownFiles = 
-000124e0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
-000124f0: 6f72 2066 696c 6520 696e 2073 656c 662e  or file in self.
-00012500: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-00012510: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
-00012520: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-00012530: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-00012540: 6528 6669 6c65 290a 2020 2020 2020 2020  e(file).        
-00012550: 2020 2020 2020 2020 6966 2066 696c 655f          if file_
-00012560: 6e61 6d65 206e 6f74 2069 6e20 7575 6964  name not in uuid
-00012570: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00012580: 2020 2020 2020 2075 6e6b 6e6f 776e 4669         unknownFi
-00012590: 6c65 732e 6170 7065 6e64 2866 696c 6529  les.append(file)
-000125a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000125b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000125c0: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
-000125d0: 5b66 696c 655f 6e61 6d65 5d20 3d20 7575  [file_name] = uu
-000125e0: 6964 735b 6669 6c65 5f6e 616d 655d 5b6d  ids[file_name][m
-000125f0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00012600: 276d 6172 6971 7427 5d5b 2775 7569 6427  'mariqt']['uuid'
-00012610: 5d5d 0a0a 2020 2020 2020 2020 2020 2020  ]]..            
-00012620: 756e 6b6e 6f77 6e46 696c 6573 5555 4944  unknownFilesUUID
-00012630: 7320 3d20 6d69 7174 692e 696d 6167 6573  s = miqti.images
-00012640: 436f 6e74 6169 6e56 616c 6964 5555 4944  ContainValidUUID
-00012650: 2875 6e6b 6e6f 776e 4669 6c65 7329 0a20  (unknownFiles). 
-00012660: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-00012670: 696c 6520 696e 2075 6e6b 6e6f 776e 4669  ile in unknownFi
-00012680: 6c65 7355 5549 4473 3a0a 2020 2020 2020  lesUUIDs:.      
-00012690: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
-000126a0: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
-000126b0: 7365 6e61 6d65 2866 696c 6529 0a20 2020  sename(file).   
-000126c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000126d0: 6e6f 7420 756e 6b6e 6f77 6e46 696c 6573  not unknownFiles
-000126e0: 5555 4944 735b 6669 6c65 5d5b 2776 616c  UUIDs[file]['val
-000126f0: 6964 275d 3a0a 2020 2020 2020 2020 2020  id']:.          
-00012700: 2020 2020 2020 2020 2020 7575 6964 203d            uuid =
-00012710: 206d 6971 7463 2e75 7569 6434 2829 0a20   miqtc.uuid4(). 
-00012720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012730: 2020 206d 6973 7369 6e67 5f75 7569 6473     missing_uuids
-00012740: 5b66 696c 655d 203d 2075 7569 640a 2020  [file] = uuid.  
-00012750: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00012760: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00012770: 2020 2020 2020 2020 7575 6964 735b 6669          uuids[fi
-00012780: 6c65 5f6e 616d 655d 203d 2075 6e6b 6e6f  le_name] = unkno
-00012790: 776e 4669 6c65 7355 5549 4473 5b66 696c  wnFilesUUIDs[fil
-000127a0: 655d 5b27 7575 6964 275d 0a20 2020 2020  e]['uuid'].     
-000127b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000127c0: 6464 6564 5f75 7569 6473 202b 3d20 310a  dded_uuids += 1.
-000127d0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-000127e0: 6620 7072 6576 696f 7573 6c79 2075 6e6b  f previously unk
-000127f0: 6e6f 776e 2055 5549 4473 2077 6572 6520  nown UUIDs were 
-00012800: 666f 756e 6420 696e 2074 6865 2066 696c  found in the fil
-00012810: 6520 6865 6164 6572 732c 2061 6464 2074  e headers, add t
-00012820: 6865 6d20 746f 2074 6865 2055 5549 4420  hem to the UUID 
-00012830: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00012840: 2069 6620 6164 6465 645f 7575 6964 7320   if added_uuids 
-00012850: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00012860: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
-00012870: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
-00012880: 645f 6669 6c65 2829 2c20 2277 2229 0a20  d_file(), "w"). 
-00012890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000128a0: 6573 2e77 7269 7465 286d 6971 7476 2e63  es.write(miqtv.c
-000128b0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000128c0: 7427 5d5b 2769 6d67 275d 202b 225c 7422  t']['img'] +"\t"
-000128d0: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
-000128e0: 725b 276d 6172 6971 7427 5d5b 2775 7569  r['mariqt']['uui
-000128f0: 6427 5d2b 225c 6e22 290a 2020 2020 2020  d']+"\n").      
-00012900: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-00012910: 6c65 2069 6e20 7575 6964 733a 0a20 2020  le in uuids:.   
-00012920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012930: 2072 6573 2e77 7269 7465 2866 696c 652b   res.write(file+
-00012940: 225c 7422 2b73 7472 2875 7569 6473 5b66  "\t"+str(uuids[f
-00012950: 696c 655d 292b 225c 6e22 290a 2020 2020  ile])+"\n").    
-00012960: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00012970: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
-00012980: 2020 2020 2069 6620 6c65 6e28 6d69 7373       if len(miss
-00012990: 696e 675f 7575 6964 7329 203e 2030 3a0a  ing_uuids) > 0:.
-000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129b0: 6563 7376 5f70 6174 6820 3d20 7365 6c66  ecsv_path = self
-000129c0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
-000129d0: 7072 6566 6978 2829 202b 2022 5f65 7869  prefix() + "_exi
-000129e0: 662d 6164 642d 7575 6964 2e63 7376 220a  f-add-uuid.csv".
-000129f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a00: 6373 7620 3d20 6f70 656e 2865 6373 765f  csv = open(ecsv_
-00012a10: 7061 7468 2c20 2277 2229 0a20 2020 2020  path, "w").     
-00012a20: 2020 2020 2020 2020 2020 2063 7376 2e77             csv.w
-00012a30: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
-00012a40: 6561 6465 725b 2765 7869 6627 5d5b 2769  eader['exif']['i
-00012a50: 6d67 275d 202b 0a20 2020 2020 2020 2020  mg'] +.         
-00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a70: 2022 2c22 2b6d 6971 7476 2e63 6f6c 5f68   ","+miqtv.col_h
-00012a80: 6561 6465 725b 2765 7869 6627 5d5b 2775  eader['exif']['u
-00012a90: 7569 6427 5d2b 225c 6e22 290a 2020 2020  uid']+"\n").    
-00012aa0: 2020 2020 2020 2020 2020 2020 6469 6666              diff
-00012ab0: 6572 656e 745f 7061 7468 7320 3d20 5b5d  erent_paths = []
-00012ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ad0: 2066 6f72 2069 6d67 2069 6e20 6d69 7373   for img in miss
-00012ae0: 696e 675f 7575 6964 733a 0a20 2020 2020  ing_uuids:.     
-00012af0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00012b00: 6620 6f73 2e70 6174 682e 6261 7365 6e61  f os.path.basena
-00012b10: 6d65 2869 6d67 2920 6e6f 7420 696e 2064  me(img) not in d
-00012b20: 6966 6665 7265 6e74 5f70 6174 6873 3a0a  ifferent_paths:.
-00012b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b40: 2020 2020 2020 2020 6469 6666 6572 656e          differen
-00012b50: 745f 7061 7468 732e 6170 7065 6e64 286f  t_paths.append(o
-00012b60: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00012b70: 696d 6729 290a 2020 2020 2020 2020 2020  img)).          
-00012b80: 2020 2020 2020 2020 2020 6373 762e 7772            csv.wr
-00012b90: 6974 6528 696d 672b 222c 222b 7374 7228  ite(img+","+str(
-00012ba0: 6d69 7373 696e 675f 7575 6964 735b 696d  missing_uuids[im
-00012bb0: 675d 292b 225c 6e22 290a 2020 2020 2020  g])+"\n").      
-00012bc0: 2020 2020 2020 2020 2020 2372 6574 7572            #retur
-00012bd0: 6e20 4661 6c73 652c 2022 6578 6966 746f  n False, "exifto
-00012be0: 6f6c 202d 6373 763d 222b 6563 7376 5f70  ol -csv="+ecsv_p
-00012bf0: 6174 682b 2220 222b 2220 222e 6a6f 696e  ath+" "+" ".join
-00012c00: 2864 6966 6665 7265 6e74 5f70 6174 6873  (different_paths
-00012c10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012c20: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00012c30: 224e 6f74 2061 6c6c 2069 6d61 6765 7320  "Not all images 
-00012c40: 6861 7665 2076 616c 6964 2055 5549 4473  have valid UUIDs
-00012c50: 2e20 4d69 7373 696e 6720 666f 7220 666f  . Missing for fo
-00012c60: 6c6c 6f77 696e 6720 6669 6c65 733a 5c6e  llowing files:\n
-00012c70: 222b 225c c586 222e 6a6f 696e 2864 6966  "+"\..".join(dif
-00012c80: 6665 7265 6e74 5f70 6174 6873 290a 2020  ferent_paths).  
-00012c90: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-00012ca0: 2020 2020 2020 2073 656c 662e 5f5f 616c         self.__al
-00012cb0: 6c55 5549 4473 4368 6563 6b65 6420 3d20  lUUIDsChecked = 
-00012cc0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00012cd0: 2072 6574 7572 6e20 5472 7565 2c20 2241   return True, "A
-00012ce0: 6c6c 2069 6d61 6765 7320 6861 7665 2061  ll images have a
-00012cf0: 2055 5549 4422 0a20 2020 2020 2020 2072   UUID".        r
-00012d00: 6574 7572 6e20 4661 6c73 652c 2022 5061  eturn False, "Pa
-00012d10: 7468 2022 2b73 656c 662e 696d 6167 6573  th "+self.images
-00012d20: 4469 7220 2b20 2220 6e6f 7420 666f 756e  Dir + " not foun
-00012d30: 642e 220a 0a20 2020 2064 6566 2063 7265  d."..    def cre
-00012d40: 6174 6555 5549 4446 696c 6528 7365 6c66  ateUUIDFile(self
-00012d50: 2c63 6c65 616e 3d54 7275 6529 3a0a 2020  ,clean=True):.  
-00012d60: 2020 2020 2020 2222 2220 4465 7072 6563        """ Deprec
-00012d70: 6174 6564 202d 2075 7365 2063 7265 6174  ated - use creat
-00012d80: 655f 7575 6964 5f66 696c 6520 2222 220a  e_uuid_file """.
-00012d90: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00012da0: 656c 662e 6372 6561 7465 5f75 7569 645f  elf.create_uuid_
-00012db0: 6669 6c65 2863 6c65 616e 290a 0a0a 2020  file(clean)...  
-00012dc0: 2020 6465 6620 7365 745f 696d 6167 655f    def set_image_
-00012dd0: 7365 745f 6174 7469 7475 6465 2873 656c  set_attitude(sel
-00012de0: 662c 7961 775f 6672 616d 653a 666c 6f61  f,yaw_frame:floa
-00012df0: 742c 7069 7463 685f 6672 616d 653a 666c  t,pitch_frame:fl
-00012e00: 6f61 742c 726f 6c6c 5f66 7261 6d65 3a66  oat,roll_frame:f
-00012e10: 6c6f 6174 2c79 6177 5f63 616d 3266 7261  loat,yaw_cam2fra
-00012e20: 6d65 3a66 6c6f 6174 2c70 6974 6368 5f63  me:float,pitch_c
-00012e30: 616d 3266 7261 6d65 3a66 6c6f 6174 2c72  am2frame:float,r
-00012e40: 6f6c 6c5f 6361 6d32 6672 616d 653a 666c  oll_cam2frame:fl
-00012e50: 6f61 7429 3a0a 2020 2020 2020 2020 2222  oat):.        ""
-00012e60: 2220 6361 6c63 756c 6174 6573 2074 6865  " calculates the
-00012e70: 2074 6865 2063 616d 6572 6173 2061 6273   the cameras abs
-00012e80: 6f6c 7574 6520 6174 7469 7475 6465 2061  olute attitude a
-00012e90: 6e64 2073 6574 7320 6974 2074 6f20 696d  nd sets it to im
-00012ea0: 6167 6520 7365 7420 6865 6164 6572 2e20  age set header. 
-00012eb0: 416c 6c20 616e 676c 6573 2061 7265 2065  All angles are e
-00012ec0: 7870 6563 7465 6420 696e 2064 6567 7265  xpected in degre
-00012ed0: 6573 2e20 0a20 2020 2020 2020 2063 616d  es. .        cam
-00012ee0: 6572 6132 6672 616d 6520 616e 676c 6573  era2frame angles
-00012ef0: 3a20 726f 7461 7469 6f6e 206f 6620 6361  : rotation of ca
-00012f00: 6d65 7261 2063 6f6f 7264 696e 6174 6573  mera coordinates
-00012f10: 2028 782c 792c 7a20 3d20 746f 702c 2072   (x,y,z = top, r
-00012f20: 6967 6874 2c20 6c69 6e65 206f 6620 7369  ight, line of si
-00012f30: 6768 7429 2077 6974 6820 7265 7370 6563  ght) with respec
-00012f40: 7420 746f 2076 6568 6963 6c65 2063 6f6f  t to vehicle coo
-00012f50: 7264 696e 6174 6573 2028 782c 792c 7a20  rdinates (x,y,z 
-00012f60: 3d20 666f 7277 6172 642c 7269 6768 742c  = forward,right,
-00012f70: 646f 776e 2920 0a20 2020 2020 2020 2069  down) .        i
-00012f80: 6e20 6163 636f 7264 616e 6365 2077 6974  n accordance wit
-00012f90: 6820 7468 6520 7961 772c 7069 7463 682c  h the yaw,pitch,
-00012fa0: 726f 6c6c 2072 6f74 6174 696f 6e20 6f72  roll rotation or
-00012fb0: 6465 7220 636f 6e76 656e 7469 6f6e 3a0a  der convention:.
-00012fc0: 0a20 2020 2020 2020 2031 2e20 7961 7720  .        1. yaw 
-00012fd0: 6172 6f75 6e64 207a 2c0a 2020 2020 2020  around z,.      
-00012fe0: 2020 322e 2070 6974 6368 2061 726f 756e    2. pitch aroun
-00012ff0: 6420 726f 7461 7465 6420 792c 0a20 2020  d rotated y,.   
-00013000: 2020 2020 2033 2e20 726f 6c6c 2061 726f       3. roll aro
-00013010: 756e 6420 726f 7461 7465 6420 780a 0a20  und rotated x.. 
-00013020: 2020 2020 2020 2052 6f74 6174 696f 6e20         Rotation 
-00013030: 6469 7265 6374 696f 6e73 2061 6363 6f72  directions accor
-00013040: 6469 6e67 2074 6f20 5c27 7269 6768 742d  ding to \'right-
-00013050: 6861 6e64 2072 756c 655c 272e 0a0a 2020  hand rule\'...  
-00013060: 2020 2020 2020 492e 652e 2063 616d 6572        I.e. camer
-00013070: 6132 4672 616d 6520 616e 676c 6573 203d  a2Frame angles =
-00013080: 2030 2c30 2c30 2063 616d 6572 6120 6973   0,0,0 camera is
-00013090: 2066 6163 696e 6720 646f 776e 7761 7264   facing downward
-000130a0: 2077 6974 6820 746f 7020 7369 6465 2074   with top side t
-000130b0: 6f77 6172 6473 2076 6568 6963 6c65 2773  owards vehicle's
-000130c0: 2066 6f72 7761 7264 2064 6972 6563 7469   forward directi
-000130d0: 6f6e 2720 2222 220a 0a20 2020 2020 2020  on' """..       
-000130e0: 2052 5f66 7261 6d65 326e 6564 203d 206d   R_frame2ned = m
-000130f0: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
-00013100: 6f6c 6c28 7961 775f 6672 616d 652c 7069  oll(yaw_frame,pi
-00013110: 7463 685f 6672 616d 652c 726f 6c6c 5f66  tch_frame,roll_f
-00013120: 7261 6d65 290a 2020 2020 2020 2020 525f  rame).        R_
-00013130: 6361 6d32 6672 616d 6520 3d20 6d69 7174  cam2frame = miqt
-00013140: 672e 525f 5961 7750 6974 6368 526f 6c6c  g.R_YawPitchRoll
-00013150: 2879 6177 5f63 616d 3266 7261 6d65 2c70  (yaw_cam2frame,p
-00013160: 6974 6368 5f63 616d 3266 7261 6d65 2c72  itch_cam2frame,r
-00013170: 6f6c 6c5f 6361 6d32 6672 616d 6529 0a20  oll_cam2frame). 
-00013180: 2020 2020 2020 2052 5f63 616d 326e 6564         R_cam2ned
-00013190: 203d 2052 5f66 7261 6d65 326e 6564 2e64   = R_frame2ned.d
-000131a0: 6f74 2852 5f63 616d 3266 7261 6d65 290a  ot(R_cam2frame).
-000131b0: 2020 2020 2020 2020 7961 772c 7069 7463          yaw,pitc
-000131c0: 682c 726f 6c6c 203d 206d 6971 7467 2e79  h,roll = miqtg.y
-000131d0: 6177 5069 7463 6852 6f6c 6c28 525f 6361  awPitchRoll(R_ca
-000131e0: 6d32 6e65 6429 0a0a 2020 2020 2020 2020  m2ned)..        
-000131f0: 2320 706f 7365 206d 6174 7269 7820 6361  # pose matrix ca
-00013200: 6d32 7574 6d0a 2020 2020 2020 2020 525f  m2utm.        R_
-00013210: 6361 6d53 7464 3275 746d 203d 2073 656c  camStd2utm = sel
-00013220: 662e 6765 745f 525f 6361 6d53 7464 3275  f.get_R_camStd2u
-00013230: 746d 2852 5f63 616d 3266 7261 6d65 2c52  tm(R_cam2frame,R
-00013240: 5f66 7261 6d65 326e 6564 290a 0a20 2020  _frame2ned)..   
-00013250: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00013260: 2078 203d 206e 702e 6172 7261 7928 5b31   x = np.array([1
-00013270: 2c30 2c30 5d29 0a20 2020 2020 2020 2079  ,0,0]).        y
-00013280: 203d 206e 702e 6172 7261 7928 5b30 2c31   = np.array([0,1
-00013290: 2c30 5d29 0a20 2020 2020 2020 207a 203d  ,0]).        z =
-000132a0: 206e 702e 6172 7261 7928 5b30 2c30 2c31   np.array([0,0,1
-000132b0: 5d29 0a20 2020 2020 2020 2070 7269 6e74  ]).        print
-000132c0: 2827 7827 2c52 5f63 616d 5374 6432 7574  ('x',R_camStd2ut
-000132d0: 6d2e 646f 7428 7829 2e72 6f75 6e64 2835  m.dot(x).round(5
-000132e0: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-000132f0: 2827 7927 2c52 5f63 616d 5374 6432 7574  ('y',R_camStd2ut
-00013300: 6d2e 646f 7428 7929 2e72 6f75 6e64 2835  m.dot(y).round(5
-00013310: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-00013320: 2827 7a27 2c52 5f63 616d 5374 6432 7574  ('z',R_camStd2ut
-00013330: 6d2e 646f 7428 7a29 2e72 6f75 6e64 2835  m.dot(z).round(5
-00013340: 2929 0a20 2020 2020 2020 2022 2222 0a0a  )).        """..
-00013350: 2020 2020 2020 2020 6865 6164 6572 5570          headerUp
-00013360: 6461 7465 203d 207b 0a20 2020 2020 2020  date = {.       
-00013370: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
-00013380: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00013390: 2779 6177 275d 3a79 6177 2c0a 2020 2020  'yaw']:yaw,.    
+00011dd0: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
+00011de0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e00: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00011e10: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00011e20: 2869 7465 6d2c 2022 696e 636f 7272 6563  (item, "incorrec
+00011e30: 7420 7368 6132 3536 2068 6173 6822 2c20  t sha256 hash", 
+00011e40: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
+00011e50: 2d68 6173 682d 7368 6132 3536 275d 2c22  -hash-sha256'],"
+00011e60: 666f 7220 6669 6c65 222c 6669 6c65 4e61  for file",fileNa
+00011e70: 6d65 2c22 2072 756e 2063 7265 6174 655f  me," run create_
+00011e80: 696d 6167 655f 7368 6132 3536 5f66 696c  image_sha256_fil
+00011e90: 6528 2920 6669 7273 7422 290a 2020 2020  e() first").    
+00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011eb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00011ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ed0: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
+00011ee0: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
+00011ef0: 4e61 6d65 2c22 696e 636f 7272 6563 7420  Name,"incorrect 
+00011f00: 7368 6132 3536 2068 6173 6822 5d29 0a20  sha256 hash"]). 
+00011f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f20: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00011f30: 2020 2020 2069 6620 666f 756e 643a 0a20       if found:. 
+00011f40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011f50: 656c 2068 6173 6855 6e63 6865 636b 496d  el hashUncheckIm
+00011f60: 6167 6573 496e 5261 775b 696d 6167 655d  agesInRaw[image]
+00011f70: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00011f80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00011f90: 2020 2069 6620 7261 6973 6545 7863 6570     if raiseExcep
+00011fa0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00011fb0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00011fc0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00011fd0: 696f 6e28 2022 696d 6167 6522 2c20 6974  ion( "image", it
+00011fe0: 656d 2c20 226e 6f74 2066 6f75 6e64 2069  em, "not found i
+00011ff0: 6e20 6469 7265 6374 6f72 7927 7320 7261  n directory's ra
+00012000: 7720 666f 6c64 6572 2122 290a 2020 2020  w folder!").    
+00012010: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00012020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012030: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
+00012040: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
+00012050: 4e61 6d65 2c22 6669 6c65 206e 6f74 2066  Name,"file not f
+00012060: 6f75 6e64 225d 290a 2020 2020 2020 2020  ound"]).        
+00012070: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
+00012080: 2020 2020 2069 6620 6e6f 7420 7261 6973       if not rais
+00012090: 6545 7863 6570 7469 6f6e 3a0a 2020 2020  eException:.    
+000120a0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+000120b0: 7863 6570 7469 6f6e 4c69 7374 0a0a 0a20  xceptionList... 
+000120c0: 2020 2064 6566 2063 7265 6174 655f 7575     def create_uu
+000120d0: 6964 5f66 696c 6528 7365 6c66 2c63 6c65  id_file(self,cle
+000120e0: 616e 3d54 7275 6529 3a0a 2020 2020 2020  an=True):.      
+000120f0: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
+00012100: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
+00012110: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
+00012120: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
+00012130: 6120 6372 6561 7465 6420 7575 6964 2028  a created uuid (
+00012140: 7665 7273 696f 6e20 3429 2e0a 0a20 2020  version 4)...   
+00012150: 2020 2020 2054 6865 2055 5549 4420 6973       The UUID is
+00012160: 206f 6e6c 7920 2a74 616b 656e 2a20 6672   only *taken* fr
+00012170: 6f6d 2074 6865 206d 6574 6164 6174 6120  om the metadata 
+00012180: 6f66 2074 6865 2069 6d61 6765 732e 2049  of the images. I
+00012190: 7420 646f 6573 206e 6f74 2077 7269 7465  t does not write
+000121a0: 2055 5549 4473 2074 6f20 7468 6520 6d65   UUIDs to the me
+000121b0: 7461 6461 7461 2069 6e20 6361 7365 2073  tadata in case s
+000121c0: 6f6d 6520 6669 6c65 7320 6172 6520 6d69  ome files are mi
+000121d0: 7373 696e 6720 6974 2e0a 2020 2020 2020  ssing it..      
+000121e0: 2020 4275 742c 2069 7420 6372 6561 7465    But, it create
+000121f0: 7320 6120 4353 5620 6669 6c65 2069 6e20  s a CSV file in 
+00012200: 7468 6174 2063 6173 6520 7468 6174 2079  that case that y
+00012210: 6f75 2063 616e 2075 7365 2074 6f67 6574  ou can use toget
+00012220: 6865 7220 7769 7468 2065 7869 6674 6f6f  her with exiftoo
+00012230: 6c20 746f 2061 6464 2074 6865 2055 5549  l to add the UUI
+00012240: 4420 746f 2079 6f75 7220 6461 7461 2e20  D to your data. 
+00012250: 4265 7761 7265 2120 7468 6973 2063 616e  Beware! this can
+00012260: 2064 6573 7472 6f79 2079 6f75 7220 696d   destroy your im
+00012270: 6167 6573 0a20 2020 2020 2020 2069 6620  ages.        if 
+00012280: 6e6f 7420 646f 6e65 2070 726f 7065 726c  not done properl
+00012290: 7921 204e 6f20 6775 6172 616e 7465 6520  y! No guarantee 
+000122a0: 6973 2067 6976 656e 2069 7420 7769 6c6c  is given it will
+000122b0: 2077 6f72 6b2e 2042 6520 6361 7265 6675   work. Be carefu
+000122c0: 6c21 0a0a 2020 2020 2020 2020 5573 6520  l!..        Use 
+000122d0: 636c 6561 6e3d 4661 6c73 6520 746f 206e  clean=False to n
+000122e0: 6f74 2063 6865 636b 2074 686f 7365 2066  ot check those f
+000122f0: 696c 6573 2061 6761 696e 2077 6869 6368  iles again which
+00012300: 2061 7265 2061 6c72 6561 6479 2066 6f75   are already fou
+00012310: 6e64 2069 6e20 696e 7465 726d 6564 6961  nd in intermedia
+00012320: 7465 2075 7569 6420 6669 6c65 0a20 2020  te uuid file.   
+00012330: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00012340: 2020 7575 6964 7320 3d20 7b7d 0a20 2020    uuids = {}.   
+00012350: 2020 2020 2023 2043 6865 636b 2077 6865       # Check whe
+00012360: 7468 6572 2061 2066 696c 6520 7769 7468  ther a file with
+00012370: 2055 5549 4473 2065 7869 7374 732c 2074   UUIDs exists, t
+00012380: 6865 6e20 7265 6164 2069 740a 2020 2020  hen read it.    
+00012390: 2020 2020 6966 206e 6f74 2063 6c65 616e      if not clean
+000123a0: 2061 6e64 206f 732e 7061 7468 2e65 7869   and os.path.exi
+000123b0: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
+000123c0: 5f75 7569 645f 6669 6c65 2829 293a 0a20  _uuid_file()):. 
+000123d0: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
+000123e0: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
+000123f0: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
+00012400: 745f 7575 6964 5f66 696c 6528 292c 205b  t_uuid_file(), [
+00012410: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00012420: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00012430: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
+00012440: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
+00012450: 7569 6427 5d5d 2c20 6b65 795f 636f 6c3d  uid']], key_col=
+00012460: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00012470: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00012480: 5d29 0a20 2020 2020 2020 2020 2020 200a  ]).            .
+00012490: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+000124a0: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
+000124b0: 6d61 6765 7344 6972 293a 0a0a 2020 2020  magesDir):..    
+000124c0: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
+000124d0: 7575 6964 7320 3d20 7b7d 0a20 2020 2020  uuids = {}.     
+000124e0: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
+000124f0: 6473 203d 2030 0a0a 2020 2020 2020 2020  ds = 0..        
+00012500: 2020 2020 756e 6b6e 6f77 6e46 696c 6573      unknownFiles
+00012510: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00012520: 2020 666f 7220 6669 6c65 2069 6e20 7365    for file in se
+00012530: 6c66 2e69 6d61 6765 7349 6e49 6d61 6765  lf.imagesInImage
+00012540: 7344 6972 2829 3a0a 2020 2020 2020 2020  sDir():.        
+00012550: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00012560: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+00012570: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
+00012580: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00012590: 6c65 5f6e 616d 6520 6e6f 7420 696e 2075  le_name not in u
+000125a0: 7569 6473 3a0a 2020 2020 2020 2020 2020  uids:.          
+000125b0: 2020 2020 2020 2020 2020 756e 6b6e 6f77            unknow
+000125c0: 6e46 696c 6573 2e61 7070 656e 6428 6669  nFiles.append(fi
+000125d0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+000125e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000125f0: 2020 2020 2020 2020 2020 2020 2020 7575                uu
+00012600: 6964 735b 6669 6c65 5f6e 616d 655d 203d  ids[file_name] =
+00012610: 2075 7569 6473 5b66 696c 655f 6e61 6d65   uuids[file_name
+00012620: 5d5b 6d69 7174 762e 636f 6c5f 6865 6164  ][miqtv.col_head
+00012630: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
+00012640: 6964 275d 5d0a 0a20 2020 2020 2020 2020  id']]..         
+00012650: 2020 2075 6e6b 6e6f 776e 4669 6c65 7355     unknownFilesU
+00012660: 5549 4473 203d 206d 6971 7469 2e69 6d61  UIDs = miqti.ima
+00012670: 6765 7343 6f6e 7461 696e 5661 6c69 6455  gesContainValidU
+00012680: 5549 4428 756e 6b6e 6f77 6e46 696c 6573  UID(unknownFiles
+00012690: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+000126a0: 7220 6669 6c65 2069 6e20 756e 6b6e 6f77  r file in unknow
+000126b0: 6e46 696c 6573 5555 4944 733a 0a20 2020  nFilesUUIDs:.   
+000126c0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+000126d0: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+000126e0: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+000126f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012700: 6966 206e 6f74 2075 6e6b 6e6f 776e 4669  if not unknownFi
+00012710: 6c65 7355 5549 4473 5b66 696c 655d 5b27  lesUUIDs[file]['
+00012720: 7661 6c69 6427 5d3a 0a20 2020 2020 2020  valid']:.       
+00012730: 2020 2020 2020 2020 2020 2020 2075 7569               uui
+00012740: 6420 3d20 6d69 7174 632e 7575 6964 3428  d = miqtc.uuid4(
+00012750: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012760: 2020 2020 2020 6d69 7373 696e 675f 7575        missing_uu
+00012770: 6964 735b 6669 6c65 5d20 3d20 7575 6964  ids[file] = uuid
+00012780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012790: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000127a0: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
+000127b0: 5b66 696c 655f 6e61 6d65 5d20 3d20 756e  [file_name] = un
+000127c0: 6b6e 6f77 6e46 696c 6573 5555 4944 735b  knownFilesUUIDs[
+000127d0: 6669 6c65 5d5b 2775 7569 6427 5d0a 2020  file]['uuid'].  
+000127e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127f0: 2020 6164 6465 645f 7575 6964 7320 2b3d    added_uuids +=
+00012800: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
+00012810: 2320 4966 2070 7265 7669 6f75 736c 7920  # If previously 
+00012820: 756e 6b6e 6f77 6e20 5555 4944 7320 7765  unknown UUIDs we
+00012830: 7265 2066 6f75 6e64 2069 6e20 7468 6520  re found in the 
+00012840: 6669 6c65 2068 6561 6465 7273 2c20 6164  file headers, ad
+00012850: 6420 7468 656d 2074 6f20 7468 6520 5555  d them to the UU
+00012860: 4944 2066 696c 650a 2020 2020 2020 2020  ID file.        
+00012870: 2020 2020 6966 2061 6464 6564 5f75 7569      if added_uui
+00012880: 6473 203e 2030 3a0a 2020 2020 2020 2020  ds > 0:.        
+00012890: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+000128a0: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
+000128b0: 7575 6964 5f66 696c 6528 292c 2022 7722  uuid_file(), "w"
+000128c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000128d0: 2020 7265 732e 7772 6974 6528 6d69 7174    res.write(miqt
+000128e0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000128f0: 7269 7174 275d 5b27 696d 6727 5d20 2b22  riqt']['img'] +"
+00012900: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00012910: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00012920: 7575 6964 275d 2b22 5c6e 2229 0a20 2020  uuid']+"\n").   
+00012930: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00012940: 2066 696c 6520 696e 2075 7569 6473 3a0a   file in uuids:.
+00012950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012960: 2020 2020 7265 732e 7772 6974 6528 6669      res.write(fi
+00012970: 6c65 2b22 5c74 222b 7374 7228 7575 6964  le+"\t"+str(uuid
+00012980: 735b 6669 6c65 5d29 2b22 5c6e 2229 0a20  s[file])+"\n"). 
+00012990: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000129a0: 6573 2e63 6c6f 7365 2829 0a0a 2020 2020  es.close()..    
+000129b0: 2020 2020 2020 2020 6966 206c 656e 286d          if len(m
+000129c0: 6973 7369 6e67 5f75 7569 6473 2920 3e20  issing_uuids) > 
+000129d0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000129e0: 2020 2065 6373 765f 7061 7468 203d 2073     ecsv_path = s
+000129f0: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
+00012a00: 6c65 5f70 7265 6669 7828 2920 2b20 225f  le_prefix() + "_
+00012a10: 6578 6966 2d61 6464 2d75 7569 642e 6373  exif-add-uuid.cs
+00012a20: 7622 0a20 2020 2020 2020 2020 2020 2020  v".             
+00012a30: 2020 2063 7376 203d 206f 7065 6e28 6563     csv = open(ec
+00012a40: 7376 5f70 6174 682c 2022 7722 290a 2020  sv_path, "w").  
+00012a50: 2020 2020 2020 2020 2020 2020 2020 6373                cs
+00012a60: 762e 7772 6974 6528 6d69 7174 762e 636f  v.write(miqtv.co
+00012a70: 6c5f 6865 6164 6572 5b27 6578 6966 275d  l_header['exif']
+00012a80: 5b27 696d 6727 5d20 2b0a 2020 2020 2020  ['img'] +.      
+00012a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012aa0: 2020 2020 222c 222b 6d69 7174 762e 636f      ","+miqtv.co
+00012ab0: 6c5f 6865 6164 6572 5b27 6578 6966 275d  l_header['exif']
+00012ac0: 5b27 7575 6964 275d 2b22 5c6e 2229 0a20  ['uuid']+"\n"). 
+00012ad0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00012ae0: 6966 6665 7265 6e74 5f70 6174 6873 203d  ifferent_paths =
+00012af0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00012b00: 2020 2020 666f 7220 696d 6720 696e 206d      for img in m
+00012b10: 6973 7369 6e67 5f75 7569 6473 3a0a 2020  issing_uuids:.  
+00012b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b30: 2020 6966 206f 732e 7061 7468 2e62 6173    if os.path.bas
+00012b40: 656e 616d 6528 696d 6729 206e 6f74 2069  ename(img) not i
+00012b50: 6e20 6469 6666 6572 656e 745f 7061 7468  n different_path
+00012b60: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00012b70: 2020 2020 2020 2020 2020 2064 6966 6665             diffe
+00012b80: 7265 6e74 5f70 6174 6873 2e61 7070 656e  rent_paths.appen
+00012b90: 6428 6f73 2e70 6174 682e 6261 7365 6e61  d(os.path.basena
+00012ba0: 6d65 2869 6d67 2929 0a20 2020 2020 2020  me(img)).       
+00012bb0: 2020 2020 2020 2020 2020 2020 2063 7376               csv
+00012bc0: 2e77 7269 7465 2869 6d67 2b22 2c22 2b73  .write(img+","+s
+00012bd0: 7472 286d 6973 7369 6e67 5f75 7569 6473  tr(missing_uuids
+00012be0: 5b69 6d67 5d29 2b22 5c6e 2229 0a20 2020  [img])+"\n").   
+00012bf0: 2020 2020 2020 2020 2020 2020 2023 7265               #re
+00012c00: 7475 726e 2046 616c 7365 2c20 2265 7869  turn False, "exi
+00012c10: 6674 6f6f 6c20 2d63 7376 3d22 2b65 6373  ftool -csv="+ecs
+00012c20: 765f 7061 7468 2b22 2022 2b22 2022 2e6a  v_path+" "+" ".j
+00012c30: 6f69 6e28 6469 6666 6572 656e 745f 7061  oin(different_pa
+00012c40: 7468 7329 0a20 2020 2020 2020 2020 2020  ths).           
+00012c50: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00012c60: 652c 2022 4e6f 7420 616c 6c20 696d 6167  e, "Not all imag
+00012c70: 6573 2068 6176 6520 7661 6c69 6420 5555  es have valid UU
+00012c80: 4944 732e 204d 6973 7369 6e67 2066 6f72  IDs. Missing for
+00012c90: 2066 6f6c 6c6f 7769 6e67 2066 696c 6573   following files
+00012ca0: 3a5c 6e22 2b22 5cc5 8622 2e6a 6f69 6e28  :\n"+"\..".join(
+00012cb0: 6469 6666 6572 656e 745f 7061 7468 7329  different_paths)
+00012cc0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00012cd0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00012ce0: 5f61 6c6c 5555 4944 7343 6865 636b 6564  _allUUIDsChecked
+00012cf0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00012d00: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
+00012d10: 2022 416c 6c20 696d 6167 6573 2068 6176   "All images hav
+00012d20: 6520 6120 5555 4944 220a 2020 2020 2020  e a UUID".      
+00012d30: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00012d40: 2250 6174 6820 222b 7365 6c66 2e69 6d61  "Path "+self.ima
+00012d50: 6765 7344 6972 202b 2022 206e 6f74 2066  gesDir + " not f
+00012d60: 6f75 6e64 2e22 0a0a 2020 2020 6465 6620  ound."..    def 
+00012d70: 6372 6561 7465 5555 4944 4669 6c65 2873  createUUIDFile(s
+00012d80: 656c 662c 636c 6561 6e3d 5472 7565 293a  elf,clean=True):
+00012d90: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
+00012da0: 7265 6361 7465 6420 2d20 7573 6520 6372  recated - use cr
+00012db0: 6561 7465 5f75 7569 645f 6669 6c65 2022  eate_uuid_file "
+00012dc0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00012dd0: 6e20 7365 6c66 2e63 7265 6174 655f 7575  n self.create_uu
+00012de0: 6964 5f66 696c 6528 636c 6561 6e29 0a0a  id_file(clean)..
+00012df0: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
+00012e00: 6765 5f73 6574 5f61 7474 6974 7564 6528  ge_set_attitude(
+00012e10: 7365 6c66 2c79 6177 5f66 7261 6d65 3a66  self,yaw_frame:f
+00012e20: 6c6f 6174 2c70 6974 6368 5f66 7261 6d65  loat,pitch_frame
+00012e30: 3a66 6c6f 6174 2c72 6f6c 6c5f 6672 616d  :float,roll_fram
+00012e40: 653a 666c 6f61 742c 7961 775f 6361 6d32  e:float,yaw_cam2
+00012e50: 6672 616d 653a 666c 6f61 742c 7069 7463  frame:float,pitc
+00012e60: 685f 6361 6d32 6672 616d 653a 666c 6f61  h_cam2frame:floa
+00012e70: 742c 726f 6c6c 5f63 616d 3266 7261 6d65  t,roll_cam2frame
+00012e80: 3a66 6c6f 6174 293a 0a20 2020 2020 2020  :float):.       
+00012e90: 2022 2222 2063 616c 6375 6c61 7465 7320   """ calculates 
+00012ea0: 7468 6520 7468 6520 6361 6d65 7261 7320  the the cameras 
+00012eb0: 6162 736f 6c75 7465 2061 7474 6974 7564  absolute attitud
+00012ec0: 6520 616e 6420 7365 7473 2069 7420 746f  e and sets it to
+00012ed0: 2069 6d61 6765 2073 6574 2068 6561 6465   image set heade
+00012ee0: 722e 2041 6c6c 2061 6e67 6c65 7320 6172  r. All angles ar
+00012ef0: 6520 6578 7065 6374 6564 2069 6e20 6465  e expected in de
+00012f00: 6772 6565 732e 200a 2020 2020 2020 2020  grees. .        
+00012f10: 6361 6d65 7261 3266 7261 6d65 2061 6e67  camera2frame ang
+00012f20: 6c65 733a 2072 6f74 6174 696f 6e20 6f66  les: rotation of
+00012f30: 2063 616d 6572 6120 636f 6f72 6469 6e61   camera coordina
+00012f40: 7465 7320 2878 2c79 2c7a 203d 2074 6f70  tes (x,y,z = top
+00012f50: 2c20 7269 6768 742c 206c 696e 6520 6f66  , right, line of
+00012f60: 2073 6967 6874 2920 7769 7468 2072 6573   sight) with res
+00012f70: 7065 6374 2074 6f20 7665 6869 636c 6520  pect to vehicle 
+00012f80: 636f 6f72 6469 6e61 7465 7320 2878 2c79  coordinates (x,y
+00012f90: 2c7a 203d 2066 6f72 7761 7264 2c72 6967  ,z = forward,rig
+00012fa0: 6874 2c64 6f77 6e29 200a 2020 2020 2020  ht,down) .      
+00012fb0: 2020 696e 2061 6363 6f72 6461 6e63 6520    in accordance 
+00012fc0: 7769 7468 2074 6865 2079 6177 2c70 6974  with the yaw,pit
+00012fd0: 6368 2c72 6f6c 6c20 726f 7461 7469 6f6e  ch,roll rotation
+00012fe0: 206f 7264 6572 2063 6f6e 7665 6e74 696f   order conventio
+00012ff0: 6e3a 0a0a 2020 2020 2020 2020 312e 2079  n:..        1. y
+00013000: 6177 2061 726f 756e 6420 7a2c 0a20 2020  aw around z,.   
+00013010: 2020 2020 2032 2e20 7069 7463 6820 6172       2. pitch ar
+00013020: 6f75 6e64 2072 6f74 6174 6564 2079 2c0a  ound rotated y,.
+00013030: 2020 2020 2020 2020 332e 2072 6f6c 6c20          3. roll 
+00013040: 6172 6f75 6e64 2072 6f74 6174 6564 2078  around rotated x
+00013050: 0a0a 2020 2020 2020 2020 526f 7461 7469  ..        Rotati
+00013060: 6f6e 2064 6972 6563 7469 6f6e 7320 6163  on directions ac
+00013070: 636f 7264 696e 6720 746f 205c 2772 6967  cording to \'rig
+00013080: 6874 2d68 616e 6420 7275 6c65 5c27 2e0a  ht-hand rule\'..
+00013090: 0a20 2020 2020 2020 2049 2e65 2e20 6361  .        I.e. ca
+000130a0: 6d65 7261 3246 7261 6d65 2061 6e67 6c65  mera2Frame angle
+000130b0: 7320 3d20 302c 302c 3020 6361 6d65 7261  s = 0,0,0 camera
+000130c0: 2069 7320 6661 6369 6e67 2064 6f77 6e77   is facing downw
+000130d0: 6172 6420 7769 7468 2074 6f70 2073 6964  ard with top sid
+000130e0: 6520 746f 7761 7264 7320 7665 6869 636c  e towards vehicl
+000130f0: 6527 7320 666f 7277 6172 6420 6469 7265  e's forward dire
+00013100: 6374 696f 6e27 2022 2222 0a0a 2020 2020  ction' """..    
+00013110: 2020 2020 525f 6672 616d 6532 6e65 6420      R_frame2ned 
+00013120: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
+00013130: 6368 526f 6c6c 2879 6177 5f66 7261 6d65  chRoll(yaw_frame
+00013140: 2c70 6974 6368 5f66 7261 6d65 2c72 6f6c  ,pitch_frame,rol
+00013150: 6c5f 6672 616d 6529 0a20 2020 2020 2020  l_frame).       
+00013160: 2052 5f63 616d 3266 7261 6d65 203d 206d   R_cam2frame = m
+00013170: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
+00013180: 6f6c 6c28 7961 775f 6361 6d32 6672 616d  oll(yaw_cam2fram
+00013190: 652c 7069 7463 685f 6361 6d32 6672 616d  e,pitch_cam2fram
+000131a0: 652c 726f 6c6c 5f63 616d 3266 7261 6d65  e,roll_cam2frame
+000131b0: 290a 2020 2020 2020 2020 525f 6361 6d32  ).        R_cam2
+000131c0: 6e65 6420 3d20 525f 6672 616d 6532 6e65  ned = R_frame2ne
+000131d0: 642e 646f 7428 525f 6361 6d32 6672 616d  d.dot(R_cam2fram
+000131e0: 6529 0a20 2020 2020 2020 2079 6177 2c70  e).        yaw,p
+000131f0: 6974 6368 2c72 6f6c 6c20 3d20 6d69 7174  itch,roll = miqt
+00013200: 672e 7961 7750 6974 6368 526f 6c6c 2852  g.yawPitchRoll(R
+00013210: 5f63 616d 326e 6564 290a 0a20 2020 2020  _cam2ned)..     
+00013220: 2020 2023 2070 6f73 6520 6d61 7472 6978     # pose matrix
+00013230: 2063 616d 3275 746d 0a20 2020 2020 2020   cam2utm.       
+00013240: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
+00013250: 7365 6c66 2e67 6574 5f52 5f63 616d 5374  self.get_R_camSt
+00013260: 6432 7574 6d28 525f 6361 6d32 6672 616d  d2utm(R_cam2fram
+00013270: 652c 525f 6672 616d 6532 6e65 6429 0a0a  e,R_frame2ned)..
+00013280: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013290: 2020 2020 7820 3d20 6e70 2e61 7272 6179      x = np.array
+000132a0: 285b 312c 302c 305d 290a 2020 2020 2020  ([1,0,0]).      
+000132b0: 2020 7920 3d20 6e70 2e61 7272 6179 285b    y = np.array([
+000132c0: 302c 312c 305d 290a 2020 2020 2020 2020  0,1,0]).        
+000132d0: 7a20 3d20 6e70 2e61 7272 6179 285b 302c  z = np.array([0,
+000132e0: 302c 315d 290a 2020 2020 2020 2020 7072  0,1]).        pr
+000132f0: 696e 7428 2778 272c 525f 6361 6d53 7464  int('x',R_camStd
+00013300: 3275 746d 2e64 6f74 2878 292e 726f 756e  2utm.dot(x).roun
+00013310: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
+00013320: 696e 7428 2779 272c 525f 6361 6d53 7464  int('y',R_camStd
+00013330: 3275 746d 2e64 6f74 2879 292e 726f 756e  2utm.dot(y).roun
+00013340: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
+00013350: 696e 7428 277a 272c 525f 6361 6d53 7464  int('z',R_camStd
+00013360: 3275 746d 2e64 6f74 287a 292e 726f 756e  2utm.dot(z).roun
+00013370: 6428 3529 290a 2020 2020 2020 2020 2222  d(5)).        ""
+00013380: 220a 0a20 2020 2020 2020 2068 6561 6465  "..        heade
+00013390: 7255 7064 6174 6520 3d20 7b0a 2020 2020  rUpdate = {.    
 000133a0: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
 000133b0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000133c0: 275d 5b27 7069 7463 6827 5d3a 7069 7463  ']['pitch']:pitc
-000133d0: 682c 0a20 2020 2020 2020 2020 2020 206d  h,.            m
-000133e0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000133f0: 276d 6172 6971 7427 5d5b 2772 6f6c 6c27  'mariqt']['roll'
-00013400: 5d3a 726f 6c6c 2c0a 2020 2020 2020 2020  ]:roll,.        
-00013410: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00013420: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013430: 706f 7365 275d 3a7b 2770 6f73 652d 6162  pose']:{'pose-ab
-00013440: 736f 6c75 7465 2d6f 7269 656e 7461 7469  solute-orientati
-00013450: 6f6e 2d75 746d 2d6d 6174 7269 7827 3a52  on-utm-matrix':R
-00013460: 5f63 616d 5374 6432 7574 6d2e 666c 6174  _camStd2utm.flat
-00013470: 7465 6e28 292e 746f 6c69 7374 2829 7d0a  ten().tolist()}.
-00013480: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00013490: 2020 7365 6c66 2e75 7064 6174 655f 6966    self.update_if
-000134a0: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
-000134b0: 2868 6561 6465 7255 7064 6174 6529 0a0a  (headerUpdate)..
-000134c0: 2020 2020 6465 6620 7365 7449 6d61 6765      def setImage
-000134d0: 5365 7441 7474 6974 7564 6528 7365 6c66  SetAttitude(self
-000134e0: 2c79 6177 5f66 7261 6d65 3a66 6c6f 6174  ,yaw_frame:float
-000134f0: 2c70 6974 6368 5f66 7261 6d65 3a66 6c6f  ,pitch_frame:flo
-00013500: 6174 2c72 6f6c 6c5f 6672 616d 653a 666c  at,roll_frame:fl
-00013510: 6f61 742c 7961 775f 6361 6d32 6672 616d  oat,yaw_cam2fram
-00013520: 653a 666c 6f61 742c 7069 7463 685f 6361  e:float,pitch_ca
-00013530: 6d32 6672 616d 653a 666c 6f61 742c 726f  m2frame:float,ro
-00013540: 6c6c 5f63 616d 3266 7261 6d65 3a66 6c6f  ll_cam2frame:flo
-00013550: 6174 293a 0a20 2020 2020 2020 2022 2222  at):.        """
-00013560: 2044 6570 7265 6361 7465 6420 2d20 7573   Deprecated - us
-00013570: 6520 7365 745f 696d 6167 655f 7365 745f  e set_image_set_
-00013580: 6174 7469 7475 6465 2022 2222 0a20 2020  attitude """.   
-00013590: 2020 2020 2073 656c 662e 7365 745f 696d       self.set_im
-000135a0: 6167 655f 7365 745f 6174 7469 7475 6465  age_set_attitude
-000135b0: 2879 6177 5f66 7261 6d65 2c20 7069 7463  (yaw_frame, pitc
-000135c0: 685f 6672 616d 652c 2072 6f6c 6c5f 6672  h_frame, roll_fr
-000135d0: 616d 652c 2079 6177 5f63 616d 3266 7261  ame, yaw_cam2fra
-000135e0: 6d65 2c20 7069 7463 685f 6361 6d32 6672  me, pitch_cam2fr
-000135f0: 616d 652c 2072 6f6c 6c5f 6361 6d32 6672  ame, roll_cam2fr
-00013600: 616d 6529 0a0a 0a20 2020 2064 6566 2063  ame)...    def c
-00013610: 7265 6174 655f 696d 6167 655f 6174 7469  reate_image_atti
-00013620: 7475 6465 5f66 696c 6528 7365 6c66 2c20  tude_file(self, 
-00013630: 6174 745f 7061 7468 3a73 7472 2c20 6672  att_path:str, fr
-00013640: 616d 655f 6174 745f 6865 6164 6572 3a64  ame_att_header:d
-00013650: 6963 742c 2063 616d 6572 6132 4672 616d  ict, camera2Fram
-00013660: 655f 7961 773a 666c 6f61 742c 6361 6d65  e_yaw:float,came
-00013670: 7261 3246 7261 6d65 5f70 6974 6368 3a66  ra2Frame_pitch:f
-00013680: 6c6f 6174 2c63 616d 6572 6132 4672 616d  loat,camera2Fram
-00013690: 655f 726f 6c6c 3a66 6c6f 6174 2c0a 2020  e_roll:float,.  
-000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136b0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-000136c0: 7465 5f66 6f72 6d61 743d 6d69 7174 762e  te_format=miqtv.
-000136d0: 6461 7465 5f66 6f72 6d61 7473 5b27 7061  date_formats['pa
-000136e0: 6e67 6165 6127 5d2c 2063 6f6e 7374 5f76  ngaea'], const_v
-000136f0: 616c 7565 7320 3d20 7b7d 2c20 6f76 6572  alues = {}, over
-00013700: 7772 6974 653d 4661 6c73 652c 2063 6f6c  write=False, col
-00013710: 5f73 6570 6172 6174 6f72 203d 2022 5c74  _separator = "\t
-00013720: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00013730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013740: 2020 2061 7474 5f70 6174 685f 616e 676c     att_path_angl
-00013750: 6573 5f69 6e5f 7261 6420 3d20 4661 6c73  es_in_rad = Fals
-00013760: 652c 2076 6964 656f 5361 6d70 6c65 5365  e, videoSampleSe
-00013770: 636f 6e64 733d 312c 7265 636f 7264 7332  conds=1,records2
-00013780: 6265 496e 7665 7274 6564 3d5b 5d29 3a0a  beInverted=[]):.
-00013790: 2020 2020 2020 2020 2222 2220 4372 6561          """ Crea
-000137a0: 7465 7320 696e 202f 696e 7465 726d 6564  tes in /intermed
-000137b0: 6961 7465 2061 2074 6578 7420 6669 6c65  iate a text file
-000137c0: 2077 6974 6820 6361 6d65 7261 2061 7474   with camera att
-000137d0: 6974 7564 6520 6461 7461 2066 6f72 2065  itude data for e
-000137e0: 6163 6820 696d 6167 652e 2041 6c6c 2061  ach image. All a
-000137f0: 6e67 6c65 7320 6172 6520 6578 7065 6374  ngles are expect
-00013800: 6564 2069 6e20 6465 6772 6565 732e 2055  ed in degrees. U
-00013810: 7365 2061 7474 5f70 6174 685f 616e 676c  se att_path_angl
-00013820: 6573 5f69 6e5f 7261 6420 6966 206e 6563  es_in_rad if nec
-00013830: 6573 7361 7279 2e20 0a20 2020 2020 2020  essary. .       
-00013840: 2063 616d 6572 6132 4672 616d 6520 616e   camera2Frame an
-00013850: 676c 6573 3a20 726f 7461 7469 6f6e 206f  gles: rotation o
-00013860: 6620 6361 6d65 7261 2063 6f6f 7264 696e  f camera coordin
-00013870: 6174 6573 2028 782c 792c 7a20 3d20 746f  ates (x,y,z = to
-00013880: 702c 2072 6967 6874 2c20 6c69 6e65 206f  p, right, line o
-00013890: 6620 7369 6768 7429 2077 6974 6820 7265  f sight) with re
-000138a0: 7370 6563 7420 746f 2076 6568 6963 6c65  spect to vehicle
-000138b0: 2063 6f6f 7264 696e 6174 6573 2028 782c   coordinates (x,
-000138c0: 792c 7a20 3d20 666f 7277 6172 642c 7269  y,z = forward,ri
-000138d0: 6768 742c 646f 776e 2920 0a20 2020 2020  ght,down) .     
-000138e0: 2020 2069 6e20 6163 636f 7264 616e 6365     in accordance
-000138f0: 2077 6974 6820 7468 6520 7961 772c 7069   with the yaw,pi
-00013900: 7463 682c 726f 6c6c 2072 6f74 6174 696f  tch,roll rotatio
-00013910: 6e20 6f72 6465 7220 636f 6e76 656e 7469  n order conventi
-00013920: 6f6e 3a0a 2020 2020 2020 2020 312e 2079  on:.        1. y
-00013930: 6177 2061 726f 756e 6420 7a2c 0a20 2020  aw around z,.   
-00013940: 2020 2020 2032 2e20 7069 7463 6820 6172       2. pitch ar
-00013950: 6f75 6e64 2072 6f74 6174 6564 2079 2c0a  ound rotated y,.
-00013960: 2020 2020 2020 2020 332e 2072 6f6c 6c20          3. roll 
-00013970: 6172 6f75 6e64 2072 6f74 6174 6564 2078  around rotated x
-00013980: 0a0a 2020 2020 2020 2020 526f 7461 7469  ..        Rotati
-00013990: 6f6e 2064 6972 6563 7469 6f6e 7320 6163  on directions ac
-000139a0: 636f 7264 696e 6720 746f 205c 2772 6967  cording to \'rig
-000139b0: 6874 2d68 616e 6420 7275 6c65 5c27 2e0a  ht-hand rule\'..
-000139c0: 0a20 2020 2020 2020 2049 2e65 2e20 6361  .        I.e. ca
-000139d0: 6d65 7261 3246 7261 6d65 2061 6e67 6c65  mera2Frame angle
-000139e0: 7320 3d20 302c 302c 3020 6361 6d65 7261  s = 0,0,0 camera
-000139f0: 2069 7320 6661 6369 6e67 2064 6f77 6e77   is facing downw
-00013a00: 6172 6420 7769 7468 2074 6f70 2073 6964  ard with top sid
-00013a10: 6520 746f 7761 7264 7320 7665 6869 636c  e towards vehicl
-00013a20: 6527 7320 666f 7277 6172 6420 6469 7265  e's forward dire
-00013a30: 6374 696f 6e27 2022 2222 0a0a 2020 2020  ction' """..    
-00013a40: 2020 2020 696e 745f 6174 7475 7475 6465      int_attutude
-00013a50: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
-00013a60: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-00013a70: 6978 2829 202b 2027 5f69 6d61 6765 2d61  ix() + '_image-a
-00013a80: 7474 6974 7564 652e 7478 7427 0a20 2020  ttitude.txt'.   
-00013a90: 2020 2020 206f 7574 7075 745f 6865 6164       output_head
-00013aa0: 6572 5f61 7474 203d 207b 2020 206d 6971  er_att = {   miq
-00013ab0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013ac0: 6172 6971 7427 5d5b 2769 6d67 275d 3a20  ariqt']['img']: 
-00013ad0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00013ae0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00013af0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b10: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00013b20: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013b30: 7574 6327 5d3a 6d69 7174 762e 636f 6c5f  utc']:miqtv.col_
-00013b40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00013b50: 5b27 7574 6327 5d2c 0a20 2020 2020 2020  ['utc'],.       
-00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b70: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
-00013b80: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00013b90: 7427 5d5b 2779 6177 275d 3a6d 6971 7476  t']['yaw']:miqtv
-00013ba0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00013bb0: 6971 7427 5d5b 2779 6177 275d 2c0a 2020  iqt']['yaw'],.  
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bd0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-00013be0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00013bf0: 6d61 7269 7174 275d 5b27 7069 7463 6827  mariqt']['pitch'
-00013c00: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
-00013c10: 6572 5b27 6d61 7269 7174 275d 5b27 7069  er['mariqt']['pi
-00013c20: 7463 6827 5d2c 0a20 2020 2020 2020 2020  tch'],.         
-00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c40: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-00013c50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013c60: 5d5b 2772 6f6c 6c27 5d3a 6d69 7174 762e  ]['roll']:miqtv.
-00013c70: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00013c80: 7174 275d 5b27 726f 6c6c 275d 2c0a 2020  qt']['roll'],.  
-00013c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ca0: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
-00013cb0: 2020 2020 2069 6e74 5f70 6f73 655f 6669       int_pose_fi
-00013cc0: 6c65 203d 2073 656c 662e 5f5f 6765 745f  le = self.__get_
-00013cd0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-00013ce0: 2920 2b20 275f 696d 6167 652d 6361 6d65  ) + '_image-came
-00013cf0: 7261 2d70 6f73 652e 7478 7427 0a20 2020  ra-pose.txt'.   
-00013d00: 2020 2020 206f 7574 7075 745f 6865 6164       output_head
-00013d10: 6572 5f70 6f73 6520 3d20 7b20 206d 6971  er_pose = {  miq
-00013d20: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013d30: 6172 6971 7427 5d5b 2769 6d67 275d 3a6d  ariqt']['img']:m
-00013d40: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00013d50: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
-00013d60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d80: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00013d90: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
-00013da0: 6327 5d3a 6d69 7174 762e 636f 6c5f 6865  c']:miqtv.col_he
-00013db0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013dc0: 7574 6327 5d2c 0a20 2020 2020 2020 2020  utc'],.         
-00013dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013de0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-00013df0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013e00: 5d5b 2770 6f73 6527 5d3a 6d69 7174 762e  ]['pose']:miqtv.
-00013e10: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00013e20: 7174 275d 5b27 706f 7365 275d 2c0a 2020  qt']['pose'],.  
-00013e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e40: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
-00013e50: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00013e60: 6578 6973 7473 2869 6e74 5f61 7474 7574  exists(int_attut
-00013e70: 7564 655f 6669 6c65 2920 616e 6420 6e6f  ude_file) and no
-00013e80: 7420 6f76 6572 7772 6974 653a 0a20 2020  t overwrite:.   
-00013e90: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
-00013ea0: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
-00013eb0: 6669 6c65 2869 6e74 5f61 7474 7574 7564  file(int_attutud
-00013ec0: 655f 6669 6c65 2c22 5c74 222c 6f75 7470  e_file,"\t",outp
-00013ed0: 7574 5f68 6561 6465 725f 6174 7429 0a20  ut_header_att). 
-00013ee0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-00013ef0: 5f6d 7367 203d 2022 220a 2020 2020 2020  _msg = "".      
-00013f00: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00013f10: 2e65 7869 7374 7328 696e 745f 706f 7365  .exists(int_pose
-00013f20: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
-00013f30: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00013f40: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
-00013f50: 696c 6528 696e 745f 706f 7365 5f66 696c  ile(int_pose_fil
-00013f60: 652c 225c 7422 2c6f 7574 7075 745f 6865  e,"\t",output_he
-00013f70: 6164 6572 5f70 6f73 6529 0a20 2020 2020  ader_pose).     
-00013f80: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-00013f90: 5f6d 7367 203d 2022 2c20 2220 2b20 696e  _msg = ", " + in
-00013fa0: 745f 706f 7365 5f66 696c 650a 2020 2020  t_pose_file.    
-00013fb0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00013fc0: 7275 652c 2022 4f75 7470 7574 2066 696c  rue, "Output fil
-00013fd0: 6520 6578 6973 7473 3a20 222b 696e 745f  e exists: "+int_
-00013fe0: 6174 7475 7475 6465 5f66 696c 6520 2b20  attutude_file + 
-00013ff0: 6578 7472 615f 6d73 670a 0a20 2020 2020  extra_msg..     
-00014000: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-00014010: 682e 6578 6973 7473 2861 7474 5f70 6174  h.exists(att_pat
-00014020: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-00014030: 7265 7475 726e 2046 616c 7365 2c20 2241  return False, "A
-00014040: 7474 6974 7564 6520 6669 6c65 206e 6f74  ttitude file not
-00014050: 2066 6f75 6e64 3a20 222b 6174 745f 7061   found: "+att_pa
-00014060: 7468 0a0a 2020 2020 2020 2020 6966 206e  th..        if n
-00014070: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-00014080: 7328 7365 6c66 2e69 6d61 6765 7344 6972  s(self.imagesDir
-00014090: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000140a0: 6574 7572 6e20 4661 6c73 652c 2022 496d  eturn False, "Im
-000140b0: 6167 6520 666f 6c64 6572 206e 6f74 2066  age folder not f
-000140c0: 6f75 6e64 3a20 222b 2073 656c 662e 696d  ound: "+ self.im
-000140d0: 6167 6573 4469 720a 0a20 2020 2020 2020  agesDir..       
-000140e0: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
-000140f0: 4c6f 6164 696e 674d 7367 2822 4372 6561  LoadingMsg("Crea
-00014100: 7469 6e67 2069 7465 6d73 2720 6174 7469  ting items' atti
-00014110: 7475 6465 2064 6174 6122 290a 0a20 2020  tude data")..   
-00014120: 2020 2020 2023 206c 6f61 6420 6672 616d       # load fram
-00014130: 6520 6174 7469 7475 6465 2064 6174 6120  e attitude data 
-00014140: 6672 6f6d 2066 696c 650a 2020 2020 2020  from file.      
-00014150: 2020 6174 745f 6461 7461 2c20 7061 7273    att_data, pars
-00014160: 654d 7367 203d 206d 6971 746e 2e72 6561  eMsg = miqtn.rea
-00014170: 6441 6c6c 4174 7469 7475 6465 7346 726f  dAllAttitudesFro
-00014180: 6d46 696c 6550 6174 6828 6174 745f 7061  mFilePath(att_pa
-00014190: 7468 2c20 6672 616d 655f 6174 745f 6865  th, frame_att_he
-000141a0: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
-000141b0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
-000141c0: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
-000141d0: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
-000141e0: 5f76 616c 7565 732c 616e 676c 6573 496e  _values,anglesIn
-000141f0: 5261 643d 6174 745f 7061 7468 5f61 6e67  Rad=att_path_ang
-00014200: 6c65 735f 696e 5f72 6164 290a 2020 2020  les_in_rad).    
-00014210: 2020 2020 6966 2070 6172 7365 4d73 6720      if parseMsg 
-00014220: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
-00014230: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00014240: 2870 6172 7365 4d73 672c 646f 6e74 5368  (parseMsg,dontSh
-00014250: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-00014260: 2020 2020 2070 6172 7365 4d73 6720 3d20       parseMsg = 
-00014270: 225c 6e22 202b 2070 6172 7365 4d73 670a  "\n" + parseMsg.
-00014280: 0a20 2020 2020 2020 2023 2066 696e 6420  .        # find 
-00014290: 666f 7220 6561 6368 2069 6d61 6765 2074  for each image t
-000142a0: 6865 2072 6573 7065 6374 6976 6520 6e61  he respective na
-000142b0: 7669 6761 7469 6f6e 2064 6174 610a 2020  vigation data.  
-000142c0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
-000142d0: 2020 2020 2020 2073 7563 6365 7373 2c20         success, 
-000142e0: 696d 6167 655f 6474 732c 206d 7367 203d  image_dts, msg =
-000142f0: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
-00014300: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
-00014310: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
-00014320: 636f 6e64 7329 0a20 2020 2020 2020 2069  conds).        i
-00014330: 6620 6e6f 7420 7375 6363 6573 733a 0a20  f not success:. 
-00014340: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014350: 6e20 4661 6c73 652c 206d 7367 202b 2070  n False, msg + p
-00014360: 6172 7365 4d73 670a 2020 2020 2020 2020  arseMsg.        
-00014370: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
-00014380: 6f61 6469 6e67 4d73 6728 2243 7265 6174  oadingMsg("Creat
-00014390: 696e 6720 6974 656d 7327 2061 7474 6974  ing items' attit
-000143a0: 7564 6520 6461 7461 2229 0a0a 2020 2020  ude data")..    
-000143b0: 2020 2020 2320 696e 7665 7274 2076 616c      # invert val
-000143c0: 7565 7320 2869 6620 6e65 6564 6564 2920  ues (if needed) 
-000143d0: 6265 666f 7265 206c 6576 6572 6172 6d20  before leverarm 
-000143e0: 636f 6d70 656e 7361 7469 6f6e 0a20 2020  compensation.   
-000143f0: 2020 2020 2069 6620 7265 636f 7264 7332       if records2
-00014400: 6265 496e 7665 7274 6564 2021 3d20 5b5d  beInverted != []
-00014410: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00014420: 7220 6669 6c65 2069 6e20 696d 6167 655f  r file in image_
-00014430: 6474 733a 0a20 2020 2020 2020 2020 2020  dts:.           
-00014440: 2020 2020 2061 7474 6974 7564 6573 203d       attitudes =
-00014450: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
-00014460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014470: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00014480: 6c65 6e28 6174 7469 7475 6465 7329 293a  len(attitudes)):
-00014490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000144a0: 2020 2020 2069 6620 2779 6177 2720 696e       if 'yaw' in
-000144b0: 2020 7265 636f 7264 7332 6265 496e 7665    records2beInve
-000144c0: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
-000144d0: 2020 2020 2020 2020 2020 2020 2020 6174                at
-000144e0: 7469 7475 6465 735b 695d 2e79 6177 202a  titudes[i].yaw *
-000144f0: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
-00014500: 2020 2020 2020 2020 2069 6620 2770 6974           if 'pit
-00014510: 6368 2720 696e 2020 7265 636f 7264 7332  ch' in  records2
-00014520: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
-00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014540: 2020 2020 6174 7469 7475 6465 735b 695d      attitudes[i]
-00014550: 2e70 6974 6368 202a 3d20 2d31 0a20 2020  .pitch *= -1.   
+000133c0: 275d 5b27 7961 7727 5d3a 7961 772c 0a20  ']['yaw']:yaw,. 
+000133d0: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
+000133e0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000133f0: 6971 7427 5d5b 2770 6974 6368 275d 3a70  iqt']['pitch']:p
+00013400: 6974 6368 2c0a 2020 2020 2020 2020 2020  itch,.          
+00013410: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00013420: 6572 5b27 6d61 7269 7174 275d 5b27 726f  er['mariqt']['ro
+00013430: 6c6c 275d 3a72 6f6c 6c2c 0a20 2020 2020  ll']:roll,.     
+00013440: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00013450: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013460: 5d5b 2770 6f73 6527 5d3a 7b27 706f 7365  ]['pose']:{'pose
+00013470: 2d61 6273 6f6c 7574 652d 6f72 6965 6e74  -absolute-orient
+00013480: 6174 696f 6e2d 7574 6d2d 6d61 7472 6978  ation-utm-matrix
+00013490: 273a 525f 6361 6d53 7464 3275 746d 2e66  ':R_camStd2utm.f
+000134a0: 6c61 7474 656e 2829 2e74 6f6c 6973 7428  latten().tolist(
+000134b0: 297d 0a20 2020 2020 2020 207d 0a20 2020  )}.        }.   
+000134c0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+000134d0: 5f69 6664 6f5f 6865 6164 6572 5f66 6965  _ifdo_header_fie
+000134e0: 6c64 7328 6865 6164 6572 5570 6461 7465  lds(headerUpdate
+000134f0: 290a 0a20 2020 2064 6566 2073 6574 496d  )..    def setIm
+00013500: 6167 6553 6574 4174 7469 7475 6465 2873  ageSetAttitude(s
+00013510: 656c 662c 7961 775f 6672 616d 653a 666c  elf,yaw_frame:fl
+00013520: 6f61 742c 7069 7463 685f 6672 616d 653a  oat,pitch_frame:
+00013530: 666c 6f61 742c 726f 6c6c 5f66 7261 6d65  float,roll_frame
+00013540: 3a66 6c6f 6174 2c79 6177 5f63 616d 3266  :float,yaw_cam2f
+00013550: 7261 6d65 3a66 6c6f 6174 2c70 6974 6368  rame:float,pitch
+00013560: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
+00013570: 2c72 6f6c 6c5f 6361 6d32 6672 616d 653a  ,roll_cam2frame:
+00013580: 666c 6f61 7429 3a0a 2020 2020 2020 2020  float):.        
+00013590: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
+000135a0: 2075 7365 2073 6574 5f69 6d61 6765 5f73   use set_image_s
+000135b0: 6574 5f61 7474 6974 7564 6520 2222 220a  et_attitude """.
+000135c0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+000135d0: 5f69 6d61 6765 5f73 6574 5f61 7474 6974  _image_set_attit
+000135e0: 7564 6528 7961 775f 6672 616d 652c 2070  ude(yaw_frame, p
+000135f0: 6974 6368 5f66 7261 6d65 2c20 726f 6c6c  itch_frame, roll
+00013600: 5f66 7261 6d65 2c20 7961 775f 6361 6d32  _frame, yaw_cam2
+00013610: 6672 616d 652c 2070 6974 6368 5f63 616d  frame, pitch_cam
+00013620: 3266 7261 6d65 2c20 726f 6c6c 5f63 616d  2frame, roll_cam
+00013630: 3266 7261 6d65 290a 0a0a 2020 2020 6465  2frame)...    de
+00013640: 6620 6372 6561 7465 5f69 6d61 6765 5f61  f create_image_a
+00013650: 7474 6974 7564 655f 6669 6c65 2873 656c  ttitude_file(sel
+00013660: 662c 2061 7474 5f70 6174 683a 7374 722c  f, att_path:str,
+00013670: 2066 7261 6d65 5f61 7474 5f68 6561 6465   frame_att_heade
+00013680: 723a 6469 6374 2c20 6361 6d65 7261 3246  r:dict, camera2F
+00013690: 7261 6d65 5f79 6177 3a66 6c6f 6174 2c63  rame_yaw:float,c
+000136a0: 616d 6572 6132 4672 616d 655f 7069 7463  amera2Frame_pitc
+000136b0: 683a 666c 6f61 742c 6361 6d65 7261 3246  h:float,camera2F
+000136c0: 7261 6d65 5f72 6f6c 6c3a 666c 6f61 742c  rame_roll:float,
+000136d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136f0: 2064 6174 655f 666f 726d 6174 3d6d 6971   date_format=miq
+00013700: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00013710: 2770 616e 6761 6561 275d 2c20 636f 6e73  'pangaea'], cons
+00013720: 745f 7661 6c75 6573 203d 207b 7d2c 206f  t_values = {}, o
+00013730: 7665 7277 7269 7465 3d46 616c 7365 2c20  verwrite=False, 
+00013740: 636f 6c5f 7365 7061 7261 746f 7220 3d20  col_separator = 
+00013750: 225c 7422 2c0a 2020 2020 2020 2020 2020  "\t",.          
+00013760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013770: 2020 2020 2020 6174 745f 7061 7468 5f61        att_path_a
+00013780: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
+00013790: 616c 7365 2c20 7669 6465 6f53 616d 706c  alse, videoSampl
+000137a0: 6553 6563 6f6e 6473 3d31 2c72 6563 6f72  eSeconds=1,recor
+000137b0: 6473 3262 6549 6e76 6572 7465 643d 5b5d  ds2beInverted=[]
+000137c0: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
+000137d0: 7265 6174 6573 2069 6e20 2f69 6e74 6572  reates in /inter
+000137e0: 6d65 6469 6174 6520 6120 7465 7874 2066  mediate a text f
+000137f0: 696c 6520 7769 7468 2063 616d 6572 6120  ile with camera 
+00013800: 6174 7469 7475 6465 2064 6174 6120 666f  attitude data fo
+00013810: 7220 6561 6368 2069 6d61 6765 2e20 416c  r each image. Al
+00013820: 6c20 616e 676c 6573 2061 7265 2065 7870  l angles are exp
+00013830: 6563 7465 6420 696e 2064 6567 7265 6573  ected in degrees
+00013840: 2e20 5573 6520 6174 745f 7061 7468 5f61  . Use att_path_a
+00013850: 6e67 6c65 735f 696e 5f72 6164 2069 6620  ngles_in_rad if 
+00013860: 6e65 6365 7373 6172 792e 200a 2020 2020  necessary. .    
+00013870: 2020 2020 6361 6d65 7261 3246 7261 6d65      camera2Frame
+00013880: 2061 6e67 6c65 733a 2072 6f74 6174 696f   angles: rotatio
+00013890: 6e20 6f66 2063 616d 6572 6120 636f 6f72  n of camera coor
+000138a0: 6469 6e61 7465 7320 2878 2c79 2c7a 203d  dinates (x,y,z =
+000138b0: 2074 6f70 2c20 7269 6768 742c 206c 696e   top, right, lin
+000138c0: 6520 6f66 2073 6967 6874 2920 7769 7468  e of sight) with
+000138d0: 2072 6573 7065 6374 2074 6f20 7665 6869   respect to vehi
+000138e0: 636c 6520 636f 6f72 6469 6e61 7465 7320  cle coordinates 
+000138f0: 2878 2c79 2c7a 203d 2066 6f72 7761 7264  (x,y,z = forward
+00013900: 2c72 6967 6874 2c64 6f77 6e29 200a 2020  ,right,down) .  
+00013910: 2020 2020 2020 696e 2061 6363 6f72 6461        in accorda
+00013920: 6e63 6520 7769 7468 2074 6865 2079 6177  nce with the yaw
+00013930: 2c70 6974 6368 2c72 6f6c 6c20 726f 7461  ,pitch,roll rota
+00013940: 7469 6f6e 206f 7264 6572 2063 6f6e 7665  tion order conve
+00013950: 6e74 696f 6e3a 0a20 2020 2020 2020 2031  ntion:.        1
+00013960: 2e20 7961 7720 6172 6f75 6e64 207a 2c0a  . yaw around z,.
+00013970: 2020 2020 2020 2020 322e 2070 6974 6368          2. pitch
+00013980: 2061 726f 756e 6420 726f 7461 7465 6420   around rotated 
+00013990: 792c 0a20 2020 2020 2020 2033 2e20 726f  y,.        3. ro
+000139a0: 6c6c 2061 726f 756e 6420 726f 7461 7465  ll around rotate
+000139b0: 6420 780a 0a20 2020 2020 2020 2052 6f74  d x..        Rot
+000139c0: 6174 696f 6e20 6469 7265 6374 696f 6e73  ation directions
+000139d0: 2061 6363 6f72 6469 6e67 2074 6f20 5c27   according to \'
+000139e0: 7269 6768 742d 6861 6e64 2072 756c 655c  right-hand rule\
+000139f0: 272e 0a0a 2020 2020 2020 2020 492e 652e  '...        I.e.
+00013a00: 2063 616d 6572 6132 4672 616d 6520 616e   camera2Frame an
+00013a10: 676c 6573 203d 2030 2c30 2c30 2063 616d  gles = 0,0,0 cam
+00013a20: 6572 6120 6973 2066 6163 696e 6720 646f  era is facing do
+00013a30: 776e 7761 7264 2077 6974 6820 746f 7020  wnward with top 
+00013a40: 7369 6465 2074 6f77 6172 6473 2076 6568  side towards veh
+00013a50: 6963 6c65 2773 2066 6f72 7761 7264 2064  icle's forward d
+00013a60: 6972 6563 7469 6f6e 2720 2222 220a 0a20  irection' """.. 
+00013a70: 2020 2020 2020 2069 6e74 5f61 7474 7574         int_attut
+00013a80: 7564 655f 6669 6c65 203d 2073 656c 662e  ude_file = self.
+00013a90: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
+00013aa0: 7265 6669 7828 2920 2b20 275f 696d 6167  refix() + '_imag
+00013ab0: 652d 6174 7469 7475 6465 2e74 7874 270a  e-attitude.txt'.
+00013ac0: 2020 2020 2020 2020 6f75 7470 7574 5f68          output_h
+00013ad0: 6561 6465 725f 6174 7420 3d20 7b20 2020  eader_att = {   
+00013ae0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00013af0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00013b00: 5d3a 2020 6d69 7174 762e 636f 6c5f 6865  ]:  miqtv.col_he
+00013b10: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013b20: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
+00013b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b40: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00013b50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013b60: 5d5b 2775 7463 275d 3a6d 6971 7476 2e63  ]['utc']:miqtv.c
+00013b70: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00013b80: 7427 5d5b 2775 7463 275d 2c0a 2020 2020  t']['utc'],.    
+00013b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ba0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+00013bb0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00013bc0: 7269 7174 275d 5b27 7961 7727 5d3a 6d69  riqt']['yaw']:mi
+00013bd0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00013be0: 6d61 7269 7174 275d 5b27 7961 7727 5d2c  mariqt']['yaw'],
+00013bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c10: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00013c20: 725b 276d 6172 6971 7427 5d5b 2770 6974  r['mariqt']['pit
+00013c30: 6368 275d 3a6d 6971 7476 2e63 6f6c 5f68  ch']:miqtv.col_h
+00013c40: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00013c50: 2770 6974 6368 275d 2c0a 2020 2020 2020  'pitch'],.      
+00013c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c70: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+00013c80: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013c90: 7174 275d 5b27 726f 6c6c 275d 3a6d 6971  qt']['roll']:miq
+00013ca0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013cb0: 6172 6971 7427 5d5b 2772 6f6c 6c27 5d2c  ariqt']['roll'],
+00013cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013cd0: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
+00013ce0: 2020 2020 2020 2020 696e 745f 706f 7365          int_pose
+00013cf0: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
+00013d00: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+00013d10: 6978 2829 202b 2027 5f69 6d61 6765 2d63  ix() + '_image-c
+00013d20: 616d 6572 612d 706f 7365 2e74 7874 270a  amera-pose.txt'.
+00013d30: 2020 2020 2020 2020 6f75 7470 7574 5f68          output_h
+00013d40: 6561 6465 725f 706f 7365 203d 207b 2020  eader_pose = {  
+00013d50: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00013d60: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00013d70: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
+00013d80: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00013d90: 6727 5d2c 0a20 2020 2020 2020 2020 2020  g'],.           
+00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013db0: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
+00013dc0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00013dd0: 2775 7463 275d 3a6d 6971 7476 2e63 6f6c  'utc']:miqtv.col
+00013de0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013df0: 5d5b 2775 7463 275d 2c0a 2020 2020 2020  ]['utc'],.      
+00013e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e10: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+00013e20: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013e30: 7174 275d 5b27 706f 7365 275d 3a6d 6971  qt']['pose']:miq
+00013e40: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013e50: 6172 6971 7427 5d5b 2770 6f73 6527 5d2c  ariqt']['pose'],
+00013e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013e70: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
+00013e80: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00013e90: 7468 2e65 7869 7374 7328 696e 745f 6174  th.exists(int_at
+00013ea0: 7475 7475 6465 5f66 696c 6529 2061 6e64  tutude_file) and
+00013eb0: 206e 6f74 206f 7665 7277 7269 7465 3a0a   not overwrite:.
+00013ec0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013ed0: 2e61 6464 5f69 7465 6d5f 696e 666f 5f74  .add_item_info_t
+00013ee0: 6162 5f66 696c 6528 696e 745f 6174 7475  ab_file(int_attu
+00013ef0: 7475 6465 5f66 696c 652c 225c 7422 2c6f  tude_file,"\t",o
+00013f00: 7574 7075 745f 6865 6164 6572 5f61 7474  utput_header_att
+00013f10: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+00013f20: 7472 615f 6d73 6720 3d20 2222 0a20 2020  tra_msg = "".   
+00013f30: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00013f40: 6174 682e 6578 6973 7473 2869 6e74 5f70  ath.exists(int_p
+00013f50: 6f73 655f 6669 6c65 293a 0a20 2020 2020  ose_file):.     
+00013f60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013f70: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
+00013f80: 625f 6669 6c65 2869 6e74 5f70 6f73 655f  b_file(int_pose_
+00013f90: 6669 6c65 2c22 5c74 222c 6f75 7470 7574  file,"\t",output
+00013fa0: 5f68 6561 6465 725f 706f 7365 290a 2020  _header_pose).  
+00013fb0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00013fc0: 7472 615f 6d73 6720 3d20 222c 2022 202b  tra_msg = ", " +
+00013fd0: 2069 6e74 5f70 6f73 655f 6669 6c65 0a20   int_pose_file. 
+00013fe0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00013ff0: 6e20 5472 7565 2c20 224f 7574 7075 7420  n True, "Output 
+00014000: 6669 6c65 2065 7869 7374 733a 2022 2b69  file exists: "+i
+00014010: 6e74 5f61 7474 7574 7564 655f 6669 6c65  nt_attutude_file
+00014020: 202b 2065 7874 7261 5f6d 7367 0a0a 2020   + extra_msg..  
+00014030: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+00014040: 7061 7468 2e65 7869 7374 7328 6174 745f  path.exists(att_
+00014050: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+00014060: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00014070: 2022 4174 7469 7475 6465 2066 696c 6520   "Attitude file 
+00014080: 6e6f 7420 666f 756e 643a 2022 2b61 7474  not found: "+att
+00014090: 5f70 6174 680a 0a20 2020 2020 2020 2069  _path..        i
+000140a0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+000140b0: 6973 7473 2873 656c 662e 696d 6167 6573  ists(self.images
+000140c0: 4469 7229 3a0a 2020 2020 2020 2020 2020  Dir):.          
+000140d0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+000140e0: 2249 6d61 6765 2066 6f6c 6465 7220 6e6f  "Image folder no
+000140f0: 7420 666f 756e 643a 2022 2b20 7365 6c66  t found: "+ self
+00014100: 2e69 6d61 6765 7344 6972 0a0a 2020 2020  .imagesDir..    
+00014110: 2020 2020 7320 3d20 6d69 7174 632e 5072      s = miqtc.Pr
+00014120: 696e 744c 6f61 6469 6e67 4d73 6728 2243  intLoadingMsg("C
+00014130: 7265 6174 696e 6720 6974 656d 7327 2061  reating items' a
+00014140: 7474 6974 7564 6520 6461 7461 2229 0a0a  ttitude data")..
+00014150: 2020 2020 2020 2020 2320 6c6f 6164 2066          # load f
+00014160: 7261 6d65 2061 7474 6974 7564 6520 6461  rame attitude da
+00014170: 7461 2066 726f 6d20 6669 6c65 0a20 2020  ta from file.   
+00014180: 2020 2020 2061 7474 5f64 6174 612c 2070       att_data, p
+00014190: 6172 7365 4d73 6720 3d20 6d69 7174 6e2e  arseMsg = miqtn.
+000141a0: 7265 6164 416c 6c41 7474 6974 7564 6573  readAllAttitudes
+000141b0: 4672 6f6d 4669 6c65 5061 7468 2861 7474  FromFilePath(att
+000141c0: 5f70 6174 682c 2066 7261 6d65 5f61 7474  _path, frame_att
+000141d0: 5f68 6561 6465 722c 2064 6174 655f 666f  _header, date_fo
+000141e0: 726d 6174 2c63 6f6c 5f73 6570 6172 6174  rmat,col_separat
+000141f0: 6f72 3d63 6f6c 5f73 6570 6172 6174 6f72  or=col_separator
+00014200: 2c63 6f6e 7374 5f76 616c 7565 733d 636f  ,const_values=co
+00014210: 6e73 745f 7661 6c75 6573 2c61 6e67 6c65  nst_values,angle
+00014220: 7349 6e52 6164 3d61 7474 5f70 6174 685f  sInRad=att_path_
+00014230: 616e 676c 6573 5f69 6e5f 7261 6429 0a20  angles_in_rad). 
+00014240: 2020 2020 2020 2069 6620 7061 7273 654d         if parseM
+00014250: 7367 2021 3d20 2222 3a0a 2020 2020 2020  sg != "":.      
+00014260: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00014270: 6c6f 6728 7061 7273 654d 7367 2c64 6f6e  log(parseMsg,don
+00014280: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
+00014290: 2020 2020 2020 2020 7061 7273 654d 7367          parseMsg
+000142a0: 203d 2022 5c6e 2220 2b20 7061 7273 654d   = "\n" + parseM
+000142b0: 7367 0a0a 2020 2020 2020 2020 2320 6669  sg..        # fi
+000142c0: 6e64 2066 6f72 2065 6163 6820 696d 6167  nd for each imag
+000142d0: 6520 7468 6520 7265 7370 6563 7469 7665  e the respective
+000142e0: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
+000142f0: 0a20 2020 2020 2020 2073 2e73 746f 7028  .        s.stop(
+00014300: 290a 2020 2020 2020 2020 7375 6363 6573  ).        succes
+00014310: 732c 2069 6d61 6765 5f64 7473 2c20 6d73  s, image_dts, ms
+00014320: 6720 3d20 7365 6c66 2e66 696e 644e 6176  g = self.findNav
+00014330: 4461 7461 466f 7249 6d61 6765 2861 7474  DataForImage(att
+00014340: 5f64 6174 612c 7669 6465 6f53 616d 706c  _data,videoSampl
+00014350: 6553 6563 6f6e 6473 290a 2020 2020 2020  eSeconds).      
+00014360: 2020 6966 206e 6f74 2073 7563 6365 7373    if not success
+00014370: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00014380: 7475 726e 2046 616c 7365 2c20 6d73 6720  turn False, msg 
+00014390: 2b20 7061 7273 654d 7367 0a20 2020 2020  + parseMsg.     
+000143a0: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
+000143b0: 6e74 4c6f 6164 696e 674d 7367 2822 4372  ntLoadingMsg("Cr
+000143c0: 6561 7469 6e67 2069 7465 6d73 2720 6174  eating items' at
+000143d0: 7469 7475 6465 2064 6174 6122 290a 0a20  titude data").. 
+000143e0: 2020 2020 2020 2023 2069 6e76 6572 7420         # invert 
+000143f0: 7661 6c75 6573 2028 6966 206e 6565 6465  values (if neede
+00014400: 6429 2062 6566 6f72 6520 6c65 7665 7261  d) before levera
+00014410: 726d 2063 6f6d 7065 6e73 6174 696f 6e0a  rm compensation.
+00014420: 2020 2020 2020 2020 6966 2072 6563 6f72          if recor
+00014430: 6473 3262 6549 6e76 6572 7465 6420 213d  ds2beInverted !=
+00014440: 205b 5d3a 0a20 2020 2020 2020 2020 2020   []:.           
+00014450: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+00014460: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
+00014470: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
+00014480: 7320 3d20 696d 6167 655f 6474 735b 6669  s = image_dts[fi
+00014490: 6c65 5d0a 2020 2020 2020 2020 2020 2020  le].            
+000144a0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+000144b0: 6765 286c 656e 2861 7474 6974 7564 6573  ge(len(attitudes
+000144c0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000144d0: 2020 2020 2020 2020 6966 2027 7961 7727          if 'yaw'
+000144e0: 2069 6e20 2072 6563 6f72 6473 3262 6549   in  records2beI
+000144f0: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
+00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014510: 2061 7474 6974 7564 6573 5b69 5d2e 7961   attitudes[i].ya
+00014520: 7720 2a3d 202d 310a 2020 2020 2020 2020  w *= -1.        
+00014530: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00014540: 7069 7463 6827 2069 6e20 2072 6563 6f72  pitch' in  recor
+00014550: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
 00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014570: 2069 6620 2772 6f6c 6c27 2069 6e20 2072   if 'roll' in  r
-00014580: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00014590: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-000145a0: 2020 2020 2020 2020 2020 2061 7474 6974             attit
-000145b0: 7564 6573 5b69 5d2e 726f 6c6c 202a 3d20  udes[i].roll *= 
-000145c0: 2d31 0a0a 0a20 2020 2020 2020 2023 2061  -1...        # a
-000145d0: 6464 2063 616d 6572 6132 4672 616d 6520  dd camera2Frame 
-000145e0: 616e 676c 6573 0a20 2020 2020 2020 2052  angles.        R
-000145f0: 5f63 616d 3266 7261 6d65 203d 206d 6971  _cam2frame = miq
-00014600: 7467 2e52 5f59 6177 5069 7463 6852 6f6c  tg.R_YawPitchRol
-00014610: 6c28 6361 6d65 7261 3246 7261 6d65 5f79  l(camera2Frame_y
-00014620: 6177 2c63 616d 6572 6132 4672 616d 655f  aw,camera2Frame_
-00014630: 7069 7463 682c 6361 6d65 7261 3246 7261  pitch,camera2Fra
-00014640: 6d65 5f72 6f6c 6c29 0a20 2020 2020 2020  me_roll).       
-00014650: 2052 5f63 616d 3275 746d 5f6c 6973 7420   R_cam2utm_list 
-00014660: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-00014670: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
-00014680: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00014690: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
-000146a0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
-000146b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000146c0: 2020 6174 7469 7475 6465 203d 2074 696d    attitude = tim
-000146d0: 6570 6f69 6e74 0a20 2020 2020 2020 2020  epoint.         
-000146e0: 2020 2020 2020 2069 6620 6174 7469 7475         if attitu
-000146f0: 6465 2e79 6177 2069 7320 4e6f 6e65 206f  de.yaw is None o
-00014700: 7220 6174 7469 7475 6465 2e70 6974 6368  r attitude.pitch
-00014710: 2069 7320 4e6f 6e65 206f 7220 6174 7469   is None or atti
-00014720: 7475 6465 2e72 6f6c 6c20 6973 204e 6f6e  tude.roll is Non
-00014730: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00014740: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
-00014750: 5f6c 6973 742e 6170 7065 6e64 2822 2229  _list.append("")
-00014760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014770: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00014780: 2020 2020 2020 2020 2020 2020 2020 525f                R_
-00014790: 6672 616d 6532 6e65 6420 3d20 6d69 7174  frame2ned = miqt
-000147a0: 672e 525f 5961 7750 6974 6368 526f 6c6c  g.R_YawPitchRoll
-000147b0: 2861 7474 6974 7564 652e 7961 772c 6174  (attitude.yaw,at
-000147c0: 7469 7475 6465 2e70 6974 6368 2c61 7474  titude.pitch,att
-000147d0: 6974 7564 652e 726f 6c6c 290a 2020 2020  itude.roll).    
-000147e0: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
-000147f0: 6d32 6e65 6420 3d20 525f 6672 616d 6532  m2ned = R_frame2
-00014800: 6e65 642e 646f 7428 525f 6361 6d32 6672  ned.dot(R_cam2fr
-00014810: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00014820: 2020 2020 2079 6177 2c70 6974 6368 2c72       yaw,pitch,r
-00014830: 6f6c 6c20 3d20 6d69 7174 672e 7961 7750  oll = miqtg.yawP
-00014840: 6974 6368 526f 6c6c 2852 5f63 616d 326e  itchRoll(R_cam2n
-00014850: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
-00014860: 2020 2020 6174 7469 7475 6465 2e79 6177      attitude.yaw
-00014870: 203d 2079 6177 0a20 2020 2020 2020 2020   = yaw.         
-00014880: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
-00014890: 7069 7463 6820 3d20 7069 7463 680a 2020  pitch = pitch.  
-000148a0: 2020 2020 2020 2020 2020 2020 2020 6174                at
-000148b0: 7469 7475 6465 2e72 6f6c 6c20 3d20 726f  titude.roll = ro
-000148c0: 6c6c 0a0a 2020 2020 2020 2020 2020 2020  ll..            
-000148d0: 2020 2020 525f 6361 6d53 7464 3275 746d      R_camStd2utm
-000148e0: 203d 2073 656c 662e 6765 745f 525f 6361   = self.get_R_ca
-000148f0: 6d53 7464 3275 746d 2852 5f63 616d 3266  mStd2utm(R_cam2f
-00014900: 7261 6d65 2c52 5f66 7261 6d65 326e 6564  rame,R_frame2ned
-00014910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014920: 2020 525f 6361 6d32 7574 6d5f 6c69 7374    R_cam2utm_list
-00014930: 2e61 7070 656e 6428 525f 6361 6d53 7464  .append(R_camStd
-00014940: 3275 746d 2e66 6c61 7474 656e 2829 2e74  2utm.flatten().t
-00014950: 6f6c 6973 7428 2929 0a0a 2020 2020 2020  olist())..      
-00014960: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00014970: 2261 7070 6c69 6564 2066 7261 6d65 2074  "applied frame t
-00014980: 6f20 6361 6d65 7261 2072 6f74 6174 696f  o camera rotatio
-00014990: 6e20 7961 772c 7069 7463 682c 726f 6c6c  n yaw,pitch,roll
-000149a0: 203d 2022 202b 2073 7472 2863 616d 6572   = " + str(camer
-000149b0: 6132 4672 616d 655f 7961 7729 202b 2022  a2Frame_yaw) + "
-000149c0: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
-000149d0: 4672 616d 655f 7069 7463 6829 202b 2022  Frame_pitch) + "
-000149e0: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
-000149f0: 4672 616d 655f 726f 6c6c 292c 646f 6e74  Frame_roll),dont
-00014a00: 5368 6f77 3d54 7275 6529 0a0a 2020 2020  Show=True)..    
-00014a10: 2020 2020 6966 206c 656e 2869 6d61 6765      if len(image
-00014a20: 5f64 7473 2920 3e20 303a 0a0a 2020 2020  _dts) > 0:..    
-00014a30: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00014a40: 746f 206e 6176 6967 6174 696f 6e20 7478  to navigation tx
-00014a50: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
-00014a60: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
-00014a70: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
-00014a80: 656e 2869 6e74 5f61 7474 7574 7564 655f  en(int_attutude_
-00014a90: 6669 6c65 2c20 2277 2229 0a20 2020 2020  file, "w").     
-00014aa0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014ab0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
-00014ac0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00014ad0: 275d 2b22 5c74 222b 6d69 7174 762e 636f  ']+"\t"+miqtv.co
-00014ae0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00014af0: 275d 5b27 7574 6327 5d29 0a20 2020 2020  ']['utc']).     
-00014b00: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014b10: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-00014b20: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00014b30: 5b27 7961 7727 5d29 0a20 2020 2020 2020  ['yaw']).       
-00014b40: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00014b50: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00014b60: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00014b70: 7069 7463 6827 5d29 0a20 2020 2020 2020  pitch']).       
-00014b80: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00014b90: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00014ba0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00014bb0: 726f 6c6c 275d 290a 0a20 2020 2020 2020  roll'])..       
-00014bc0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00014bd0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00014be0: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
-00014bf0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-00014c00: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
-00014c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c20: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
-00014c30: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-00014c40: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00014c50: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014c60: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
-00014c70: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
-00014c80: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
-00014c90: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-00014ca0: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
-00014cb0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00014cc0: 203d 2074 696d 6570 6f69 6e74 2e79 6177   = timepoint.yaw
-00014cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ce0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00014cf0: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
-00014d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d10: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
-00014d20: 742e 7069 7463 680a 2020 2020 2020 2020  t.pitch.        
-00014d30: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00014d40: 7772 6974 6528 225c 7422 2b73 7472 2876  write("\t"+str(v
-00014d50: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
-00014d60: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
-00014d70: 696d 6570 6f69 6e74 2e72 6f6c 6c0a 2020  imepoint.roll.  
-00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d90: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-00014da0: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
-00014db0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014dc0: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
-00014dd0: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
-00014de0: 6c6f 7365 2829 0a0a 2020 2020 2020 2020  lose()..        
-00014df0: 2020 2020 7365 6c66 2e70 726f 762e 6164      self.prov.ad
-00014e00: 6441 7267 756d 656e 7428 2269 6e70 7574  dArgument("input
-00014e10: 4174 7469 7475 6465 4669 6c65 222c 6174  AttitudeFile",at
-00014e20: 745f 7061 7468 2c6f 7665 7277 7269 7465  t_path,overwrite
-00014e30: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00014e40: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00014e50: 2822 7061 7273 6564 2066 726f 6d20 696e  ("parsed from in
-00014e60: 7075 7441 7474 6974 7564 6546 696c 653a  putAttitudeFile:
-00014e70: 2022 202b 2073 7472 2866 7261 6d65 5f61   " + str(frame_a
-00014e80: 7474 5f68 6561 6465 7229 2c64 6f6e 7453  tt_header),dontS
-00014e90: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
-00014ea0: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
-00014eb0: 7465 6d5f 696e 666f 5f74 6162 5f66 696c  tem_info_tab_fil
-00014ec0: 6528 696e 745f 6174 7475 7475 6465 5f66  e(int_attutude_f
-00014ed0: 696c 652c 225c 7422 2c6f 7574 7075 745f  ile,"\t",output_
-00014ee0: 6865 6164 6572 5f61 7474 290a 0a20 2020  header_att)..   
-00014ef0: 2020 2020 2020 2020 2023 2057 7269 7465           # Write
-00014f00: 2074 6f20 706f 7365 2074 7874 2066 696c   to pose txt fil
-00014f10: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-00014f20: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-00014f30: 2020 2072 6573 203d 206f 7065 6e28 696e     res = open(in
-00014f40: 745f 706f 7365 5f66 696c 652c 2022 7722  t_pose_file, "w"
-00014f50: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00014f60: 732e 7772 6974 6528 6d69 7174 762e 636f  s.write(miqtv.co
-00014f70: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00014f80: 275d 5b27 696d 6727 5d2b 225c 7422 2b6d  ']['img']+"\t"+m
-00014f90: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00014fa0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
-00014fb0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00014fc0: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-00014fd0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00014fe0: 6172 6971 7427 5d5b 2770 6f73 6527 5d29  ariqt']['pose'])
-00014ff0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00015000: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
-00015010: 2020 2020 2020 2020 2023 2064 6174 6120           # data 
-00015020: 6c69 6e65 730a 2020 2020 2020 2020 2020  lines.          
-00015030: 2020 6920 3d20 300a 2020 2020 2020 2020    i = 0.        
-00015040: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00015050: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
-00015060: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
-00015070: 696d 6570 6f69 6e74 2069 6e20 696d 6167  imepoint in imag
-00015080: 655f 6474 735b 6669 6c65 5d3a 0a20 2020  e_dts[file]:.   
-00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150a0: 2069 6620 525f 6361 6d32 7574 6d5f 6c69   if R_cam2utm_li
-000150b0: 7374 5b69 5d20 3d3d 2022 223a 0a20 2020  st[i] == "":.   
+00014570: 2020 2020 2020 2061 7474 6974 7564 6573         attitudes
+00014580: 5b69 5d2e 7069 7463 6820 2a3d 202d 310a  [i].pitch *= -1.
+00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145a0: 2020 2020 6966 2027 726f 6c6c 2720 696e      if 'roll' in
+000145b0: 2020 7265 636f 7264 7332 6265 496e 7665    records2beInve
+000145c0: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
+000145d0: 2020 2020 2020 2020 2020 2020 2020 6174                at
+000145e0: 7469 7475 6465 735b 695d 2e72 6f6c 6c20  titudes[i].roll 
+000145f0: 2a3d 202d 310a 0a0a 2020 2020 2020 2020  *= -1...        
+00014600: 2320 6164 6420 6361 6d65 7261 3246 7261  # add camera2Fra
+00014610: 6d65 2061 6e67 6c65 730a 2020 2020 2020  me angles.      
+00014620: 2020 525f 6361 6d32 6672 616d 6520 3d20    R_cam2frame = 
+00014630: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
+00014640: 526f 6c6c 2863 616d 6572 6132 4672 616d  Roll(camera2Fram
+00014650: 655f 7961 772c 6361 6d65 7261 3246 7261  e_yaw,camera2Fra
+00014660: 6d65 5f70 6974 6368 2c63 616d 6572 6132  me_pitch,camera2
+00014670: 4672 616d 655f 726f 6c6c 290a 2020 2020  Frame_roll).    
+00014680: 2020 2020 525f 6361 6d32 7574 6d5f 6c69      R_cam2utm_li
+00014690: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+000146a0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
+000146b0: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
+000146c0: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
+000146d0: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
+000146e0: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
+000146f0: 2020 2020 2061 7474 6974 7564 6520 3d20       attitude = 
+00014700: 7469 6d65 706f 696e 740a 2020 2020 2020  timepoint.      
+00014710: 2020 2020 2020 2020 2020 6966 2061 7474            if att
+00014720: 6974 7564 652e 7961 7720 6973 204e 6f6e  itude.yaw is Non
+00014730: 6520 6f72 2061 7474 6974 7564 652e 7069  e or attitude.pi
+00014740: 7463 6820 6973 204e 6f6e 6520 6f72 2061  tch is None or a
+00014750: 7474 6974 7564 652e 726f 6c6c 2069 7320  ttitude.roll is 
+00014760: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00014770: 2020 2020 2020 2020 2020 525f 6361 6d32            R_cam2
+00014780: 7574 6d5f 6c69 7374 2e61 7070 656e 6428  utm_list.append(
+00014790: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
+000147a0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+000147b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000147c0: 2052 5f66 7261 6d65 326e 6564 203d 206d   R_frame2ned = m
+000147d0: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
+000147e0: 6f6c 6c28 6174 7469 7475 6465 2e79 6177  oll(attitude.yaw
+000147f0: 2c61 7474 6974 7564 652e 7069 7463 682c  ,attitude.pitch,
+00014800: 6174 7469 7475 6465 2e72 6f6c 6c29 0a20  attitude.roll). 
+00014810: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00014820: 5f63 616d 326e 6564 203d 2052 5f66 7261  _cam2ned = R_fra
+00014830: 6d65 326e 6564 2e64 6f74 2852 5f63 616d  me2ned.dot(R_cam
+00014840: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
+00014850: 2020 2020 2020 2020 7961 772c 7069 7463          yaw,pitc
+00014860: 682c 726f 6c6c 203d 206d 6971 7467 2e79  h,roll = miqtg.y
+00014870: 6177 5069 7463 6852 6f6c 6c28 525f 6361  awPitchRoll(R_ca
+00014880: 6d32 6e65 6429 0a20 2020 2020 2020 2020  m2ned).         
+00014890: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
+000148a0: 7961 7720 3d20 7961 770a 2020 2020 2020  yaw = yaw.      
+000148b0: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+000148c0: 6465 2e70 6974 6368 203d 2070 6974 6368  de.pitch = pitch
+000148d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000148e0: 2061 7474 6974 7564 652e 726f 6c6c 203d   attitude.roll =
+000148f0: 2072 6f6c 6c0a 0a20 2020 2020 2020 2020   roll..         
+00014900: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
+00014910: 7574 6d20 3d20 7365 6c66 2e67 6574 5f52  utm = self.get_R
+00014920: 5f63 616d 5374 6432 7574 6d28 525f 6361  _camStd2utm(R_ca
+00014930: 6d32 6672 616d 652c 525f 6672 616d 6532  m2frame,R_frame2
+00014940: 6e65 6429 0a20 2020 2020 2020 2020 2020  ned).           
+00014950: 2020 2020 2052 5f63 616d 3275 746d 5f6c       R_cam2utm_l
+00014960: 6973 742e 6170 7065 6e64 2852 5f63 616d  ist.append(R_cam
+00014970: 5374 6432 7574 6d2e 666c 6174 7465 6e28  Std2utm.flatten(
+00014980: 292e 746f 6c69 7374 2829 290a 0a20 2020  ).tolist())..   
+00014990: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+000149a0: 6f67 2822 6170 706c 6965 6420 6672 616d  og("applied fram
+000149b0: 6520 746f 2063 616d 6572 6120 726f 7461  e to camera rota
+000149c0: 7469 6f6e 2079 6177 2c70 6974 6368 2c72  tion yaw,pitch,r
+000149d0: 6f6c 6c20 3d20 2220 2b20 7374 7228 6361  oll = " + str(ca
+000149e0: 6d65 7261 3246 7261 6d65 5f79 6177 2920  mera2Frame_yaw) 
+000149f0: 2b20 222c 2220 2b20 7374 7228 6361 6d65  + "," + str(came
+00014a00: 7261 3246 7261 6d65 5f70 6974 6368 2920  ra2Frame_pitch) 
+00014a10: 2b20 222c 2220 2b20 7374 7228 6361 6d65  + "," + str(came
+00014a20: 7261 3246 7261 6d65 5f72 6f6c 6c29 2c64  ra2Frame_roll),d
+00014a30: 6f6e 7453 686f 773d 5472 7565 290a 0a20  ontShow=True).. 
+00014a40: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
+00014a50: 6167 655f 6474 7329 203e 2030 3a0a 0a20  age_dts) > 0:.. 
+00014a60: 2020 2020 2020 2020 2020 2023 2057 7269             # Wri
+00014a70: 7465 2074 6f20 6e61 7669 6761 7469 6f6e  te to navigation
+00014a80: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
+00014a90: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
+00014aa0: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+00014ab0: 206f 7065 6e28 696e 745f 6174 7475 7475   open(int_attutu
+00014ac0: 6465 5f66 696c 652c 2022 7722 290a 2020  de_file, "w").  
+00014ad0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00014ae0: 6974 6528 6d69 7174 762e 636f 6c5f 6865  ite(miqtv.col_he
+00014af0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00014b00: 696d 6727 5d2b 225c 7422 2b6d 6971 7476  img']+"\t"+miqtv
+00014b10: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00014b20: 6971 7427 5d5b 2775 7463 275d 290a 2020  iqt']['utc']).  
+00014b30: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00014b40: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
+00014b50: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00014b60: 7427 5d5b 2779 6177 275d 290a 2020 2020  t']['yaw']).    
+00014b70: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00014b80: 6528 225c 7422 2b6d 6971 7476 2e63 6f6c  e("\t"+miqtv.col
+00014b90: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00014ba0: 5d5b 2770 6974 6368 275d 290a 2020 2020  ]['pitch']).    
+00014bb0: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00014bc0: 6528 225c 7422 2b6d 6971 7476 2e63 6f6c  e("\t"+miqtv.col
+00014bd0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00014be0: 5d5b 2772 6f6c 6c27 5d29 0a0a 2020 2020  ]['roll'])..    
+00014bf0: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00014c00: 6528 225c 6e22 290a 2020 2020 2020 2020  e("\n").        
+00014c10: 2020 2020 2320 6461 7461 206c 696e 6573      # data lines
+00014c20: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00014c30: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
+00014c40: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00014c50: 2020 2020 666f 7220 7469 6d65 706f 696e      for timepoin
+00014c60: 7420 696e 2069 6d61 6765 5f64 7473 5b66  t in image_dts[f
+00014c70: 696c 655d 3a0a 2020 2020 2020 2020 2020  ile]:.          
+00014c80: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00014c90: 6974 6528 6669 6c65 2b22 5c74 222b 7469  ite(file+"\t"+ti
+00014ca0: 6d65 706f 696e 742e 6461 7465 5469 6d65  mepoint.dateTime
+00014cb0: 2829 2e73 7472 6674 696d 6528 6d69 7174  ().strftime(miqt
+00014cc0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00014cd0: 6d61 7269 7174 275d 2929 200a 2020 2020  mariqt'])) .    
+00014ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cf0: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
+00014d00: 7961 770a 2020 2020 2020 2020 2020 2020  yaw.            
+00014d10: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00014d20: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
+00014d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014d40: 2020 2020 2076 616c 203d 2074 696d 6570       val = timep
+00014d50: 6f69 6e74 2e70 6974 6368 0a20 2020 2020  oint.pitch.     
+00014d60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014d70: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
+00014d80: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
+00014d90: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
+00014da0: 3d20 7469 6d65 706f 696e 742e 726f 6c6c  = timepoint.roll
+00014db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014dc0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00014dd0: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 2020 7265 732e 7772 6974 6528 225c 6e22    res.write("\n"
+00014e00: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00014e10: 732e 636c 6f73 6528 290a 0a20 2020 2020  s.close()..     
+00014e20: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00014e30: 2e61 6464 4172 6775 6d65 6e74 2822 696e  .addArgument("in
+00014e40: 7075 7441 7474 6974 7564 6546 696c 6522  putAttitudeFile"
+00014e50: 2c61 7474 5f70 6174 682c 6f76 6572 7772  ,att_path,overwr
+00014e60: 6974 653d 5472 7565 290a 2020 2020 2020  ite=True).      
+00014e70: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00014e80: 6c6f 6728 2270 6172 7365 6420 6672 6f6d  log("parsed from
+00014e90: 2069 6e70 7574 4174 7469 7475 6465 4669   inputAttitudeFi
+00014ea0: 6c65 3a20 2220 2b20 7374 7228 6672 616d  le: " + str(fram
+00014eb0: 655f 6174 745f 6865 6164 6572 292c 646f  e_att_header),do
+00014ec0: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
+00014ed0: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+00014ee0: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
+00014ef0: 6669 6c65 2869 6e74 5f61 7474 7574 7564  file(int_attutud
+00014f00: 655f 6669 6c65 2c22 5c74 222c 6f75 7470  e_file,"\t",outp
+00014f10: 7574 5f68 6561 6465 725f 6174 7429 0a0a  ut_header_att)..
+00014f20: 2020 2020 2020 2020 2020 2020 2320 5772              # Wr
+00014f30: 6974 6520 746f 2070 6f73 6520 7478 7420  ite to pose txt 
+00014f40: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+00014f50: 2023 2068 6561 6465 720a 2020 2020 2020   # header.      
+00014f60: 2020 2020 2020 7265 7320 3d20 6f70 656e        res = open
+00014f70: 2869 6e74 5f70 6f73 655f 6669 6c65 2c20  (int_pose_file, 
+00014f80: 2277 2229 0a20 2020 2020 2020 2020 2020  "w").           
+00014f90: 2072 6573 2e77 7269 7465 286d 6971 7476   res.write(miqtv
+00014fa0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00014fb0: 6971 7427 5d5b 2769 6d67 275d 2b22 5c74  iqt']['img']+"\t
+00014fc0: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00014fd0: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
+00014fe0: 6327 5d29 0a20 2020 2020 2020 2020 2020  c']).           
+00014ff0: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+00015000: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00015010: 5b27 6d61 7269 7174 275d 5b27 706f 7365  ['mariqt']['pose
+00015020: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00015030: 7265 732e 7772 6974 6528 225c 6e22 290a  res.write("\n").
+00015040: 2020 2020 2020 2020 2020 2020 2320 6461              # da
+00015050: 7461 206c 696e 6573 0a20 2020 2020 2020  ta lines.       
+00015060: 2020 2020 2069 203d 2030 0a20 2020 2020       i = 0.     
+00015070: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
+00015080: 696e 2069 6d61 6765 5f64 7473 3a0a 2020  in image_dts:.  
+00015090: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000150a0: 7220 7469 6d65 706f 696e 7420 696e 2069  r timepoint in i
+000150b0: 6d61 6765 5f64 7473 5b66 696c 655d 3a0a  mage_dts[file]:.
 000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150d0: 2020 2020 2069 202b 3d20 310a 2020 2020       i += 1.    
-000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150f0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015110: 2072 6573 2e77 7269 7465 2866 696c 652b   res.write(file+
-00015120: 225c 7422 2b74 696d 6570 6f69 6e74 2e64  "\t"+timepoint.d
-00015130: 6174 6554 696d 6528 292e 7374 7266 7469  ateTime().strfti
-00015140: 6d65 286d 6971 7476 2e64 6174 655f 666f  me(miqtv.date_fo
-00015150: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
-00015160: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
-00015170: 2020 2020 2020 2065 6e74 7279 203d 2073         entry = s
-00015180: 7472 287b 2770 6f73 652d 6162 736f 6c75  tr({'pose-absolu
-00015190: 7465 2d6f 7269 656e 7461 7469 6f6e 2d75  te-orientation-u
-000151a0: 746d 2d6d 6174 7269 7827 3a52 5f63 616d  tm-matrix':R_cam
-000151b0: 3275 746d 5f6c 6973 745b 695d 7d29 2e72  2utm_list[i]}).r
-000151c0: 6570 6c61 6365 2827 5c6e 272c 2727 290a  eplace('\n','').
-000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151e0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-000151f0: 7422 2b65 6e74 7279 290a 2020 2020 2020  t"+entry).      
-00015200: 2020 2020 2020 2020 2020 2020 2020 6920                i 
-00015210: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00015220: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00015230: 7465 2822 5c6e 2229 0a20 2020 2020 2020  te("\n").       
-00015240: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
-00015250: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00015260: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
-00015270: 7461 625f 6669 6c65 2869 6e74 5f70 6f73  tab_file(int_pos
-00015280: 655f 6669 6c65 2c22 5c74 222c 6f75 7470  e_file,"\t",outp
-00015290: 7574 5f68 6561 6465 725f 706f 7365 290a  ut_header_pose).
-000152a0: 2020 2020 2020 2020 2020 2020 732e 7374              s.st
-000152b0: 6f70 2829 0a20 2020 2020 2020 2020 2020  op().           
-000152c0: 2072 6574 7572 6e20 5472 7565 2c20 2241   return True, "A
-000152d0: 7474 6974 7564 6520 6461 7461 2063 7265  ttitude data cre
-000152e0: 6174 6564 2220 2b20 7061 7273 654d 7367  ated" + parseMsg
-000152f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015300: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
-00015310: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
-00015320: 7265 7475 726e 2046 616c 7365 2c20 224e  return False, "N
-00015330: 6f20 696d 6167 6520 6174 7469 7475 6465  o image attitude
-00015340: 7320 666f 756e 6422 202b 2070 6172 7365  s found" + parse
-00015350: 4d73 670a 2020 2020 2020 2020 0a20 2020  Msg.        .   
-00015360: 2020 2020 200a 2020 2020 6465 6620 6372       .    def cr
-00015370: 6561 7465 496d 6167 6541 7474 6974 7564  eateImageAttitud
-00015380: 6546 696c 6528 7365 6c66 2c20 6174 745f  eFile(self, att_
-00015390: 7061 7468 3a73 7472 2c20 6672 616d 655f  path:str, frame_
-000153a0: 6174 745f 6865 6164 6572 3a64 6963 742c  att_header:dict,
-000153b0: 2063 616d 6572 6132 4672 616d 655f 7961   camera2Frame_ya
-000153c0: 773a 666c 6f61 742c 6361 6d65 7261 3246  w:float,camera2F
-000153d0: 7261 6d65 5f70 6974 6368 3a66 6c6f 6174  rame_pitch:float
-000153e0: 2c63 616d 6572 6132 4672 616d 655f 726f  ,camera2Frame_ro
-000153f0: 6c6c 3a66 6c6f 6174 2c0a 2020 2020 2020  ll:float,.      
-00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015410: 2020 2020 2020 2020 2020 6461 7465 5f66            date_f
-00015420: 6f72 6d61 743d 6d69 7174 762e 6461 7465  ormat=miqtv.date
-00015430: 5f66 6f72 6d61 7473 5b27 7061 6e67 6165  _formats['pangae
-00015440: 6127 5d2c 2063 6f6e 7374 5f76 616c 7565  a'], const_value
-00015450: 7320 3d20 7b7d 2c20 6f76 6572 7772 6974  s = {}, overwrit
-00015460: 653d 4661 6c73 652c 2063 6f6c 5f73 6570  e=False, col_sep
-00015470: 6172 6174 6f72 203d 2022 5c74 222c 0a20  arator = "\t",. 
-00015480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015490: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000154a0: 7474 5f70 6174 685f 616e 676c 6573 5f69  tt_path_angles_i
-000154b0: 6e5f 7261 6420 3d20 4661 6c73 652c 2076  n_rad = False, v
-000154c0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-000154d0: 733d 312c 7265 636f 7264 7332 6265 496e  s=1,records2beIn
-000154e0: 7665 7274 6564 3d5b 5d29 3a0a 2020 2020  verted=[]):.    
-000154f0: 2020 2020 2222 2220 4465 7072 6563 6174      """ Deprecat
-00015500: 6465 202d 2075 7365 2063 7265 6174 655f  de - use create_
-00015510: 696d 6167 655f 6174 7469 7475 6465 5f66  image_attitude_f
-00015520: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
-00015530: 7265 7475 726e 2073 656c 662e 6372 6561  return self.crea
+000150d0: 2020 2020 6966 2052 5f63 616d 3275 746d      if R_cam2utm
+000150e0: 5f6c 6973 745b 695d 203d 3d20 2222 3a0a  _list[i] == "":.
+000150f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015100: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
+00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015120: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00015130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015140: 2020 2020 7265 732e 7772 6974 6528 6669      res.write(fi
+00015150: 6c65 2b22 5c74 222b 7469 6d65 706f 696e  le+"\t"+timepoin
+00015160: 742e 6461 7465 5469 6d65 2829 2e73 7472  t.dateTime().str
+00015170: 6674 696d 6528 6d69 7174 762e 6461 7465  ftime(miqtv.date
+00015180: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
+00015190: 275d 2929 200a 2020 2020 2020 2020 2020  '])) .          
+000151a0: 2020 2020 2020 2020 2020 656e 7472 7920            entry 
+000151b0: 3d20 7374 7228 7b27 706f 7365 2d61 6273  = str({'pose-abs
+000151c0: 6f6c 7574 652d 6f72 6965 6e74 6174 696f  olute-orientatio
+000151d0: 6e2d 7574 6d2d 6d61 7472 6978 273a 525f  n-utm-matrix':R_
+000151e0: 6361 6d32 7574 6d5f 6c69 7374 5b69 5d7d  cam2utm_list[i]}
+000151f0: 292e 7265 706c 6163 6528 275c 6e27 2c27  ).replace('\n','
+00015200: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00015210: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00015220: 2822 5c74 222b 656e 7472 7929 0a20 2020  ("\t"+entry).   
+00015230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015240: 2069 202b 3d20 310a 2020 2020 2020 2020   i += 1.        
+00015250: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00015260: 7772 6974 6528 225c 6e22 290a 2020 2020  write("\n").    
+00015270: 2020 2020 2020 2020 7265 732e 636c 6f73          res.clos
+00015280: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00015290: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
+000152a0: 666f 5f74 6162 5f66 696c 6528 696e 745f  fo_tab_file(int_
+000152b0: 706f 7365 5f66 696c 652c 225c 7422 2c6f  pose_file,"\t",o
+000152c0: 7574 7075 745f 6865 6164 6572 5f70 6f73  utput_header_pos
+000152d0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+000152e0: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
+000152f0: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
+00015300: 2022 4174 7469 7475 6465 2064 6174 6120   "Attitude data 
+00015310: 6372 6561 7465 6422 202b 2070 6172 7365  created" + parse
+00015320: 4d73 670a 2020 2020 2020 2020 656c 7365  Msg.        else
+00015330: 3a0a 2020 2020 2020 2020 2020 2020 732e  :.            s.
+00015340: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
+00015350: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00015360: 2022 4e6f 2069 6d61 6765 2061 7474 6974   "No image attit
+00015370: 7564 6573 2066 6f75 6e64 2220 2b20 7061  udes found" + pa
+00015380: 7273 654d 7367 0a20 2020 2020 2020 200a  rseMsg.        .
+00015390: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
+000153a0: 2063 7265 6174 6549 6d61 6765 4174 7469   createImageAtti
+000153b0: 7475 6465 4669 6c65 2873 656c 662c 2061  tudeFile(self, a
+000153c0: 7474 5f70 6174 683a 7374 722c 2066 7261  tt_path:str, fra
+000153d0: 6d65 5f61 7474 5f68 6561 6465 723a 6469  me_att_header:di
+000153e0: 6374 2c20 6361 6d65 7261 3246 7261 6d65  ct, camera2Frame
+000153f0: 5f79 6177 3a66 6c6f 6174 2c63 616d 6572  _yaw:float,camer
+00015400: 6132 4672 616d 655f 7069 7463 683a 666c  a2Frame_pitch:fl
+00015410: 6f61 742c 6361 6d65 7261 3246 7261 6d65  oat,camera2Frame
+00015420: 5f72 6f6c 6c3a 666c 6f61 742c 0a20 2020  _roll:float,.   
+00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015440: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00015450: 655f 666f 726d 6174 3d6d 6971 7476 2e64  e_format=miqtv.d
+00015460: 6174 655f 666f 726d 6174 735b 2770 616e  ate_formats['pan
+00015470: 6761 6561 275d 2c20 636f 6e73 745f 7661  gaea'], const_va
+00015480: 6c75 6573 203d 207b 7d2c 206f 7665 7277  lues = {}, overw
+00015490: 7269 7465 3d46 616c 7365 2c20 636f 6c5f  rite=False, col_
+000154a0: 7365 7061 7261 746f 7220 3d20 225c 7422  separator = "\t"
+000154b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000154c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154d0: 2020 6174 745f 7061 7468 5f61 6e67 6c65    att_path_angle
+000154e0: 735f 696e 5f72 6164 203d 2046 616c 7365  s_in_rad = False
+000154f0: 2c20 7669 6465 6f53 616d 706c 6553 6563  , videoSampleSec
+00015500: 6f6e 6473 3d31 2c72 6563 6f72 6473 3262  onds=1,records2b
+00015510: 6549 6e76 6572 7465 643d 5b5d 293a 0a20  eInverted=[]):. 
+00015520: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
+00015530: 6361 7464 6520 2d20 7573 6520 6372 6561  catde - use crea
 00015540: 7465 5f69 6d61 6765 5f61 7474 6974 7564  te_image_attitud
-00015550: 655f 6669 6c65 2861 7474 5f70 6174 682c  e_file(att_path,
-00015560: 2066 7261 6d65 5f61 7474 5f68 6561 6465   frame_att_heade
-00015570: 722c 2063 616d 6572 6132 4672 616d 655f  r, camera2Frame_
-00015580: 7961 772c 2063 616d 6572 6132 4672 616d  yaw, camera2Fram
-00015590: 655f 7069 7463 682c 2063 616d 6572 6132  e_pitch, camera2
-000155a0: 4672 616d 655f 726f 6c6c 2c20 0a20 2020  Frame_roll, .   
-000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155d0: 2020 2020 2020 2020 2020 2020 6461 7465              date
-000155e0: 5f66 6f72 6d61 742c 2063 6f6e 7374 5f76  _format, const_v
-000155f0: 616c 7565 732c 206f 7665 7277 7269 7465  alues, overwrite
-00015600: 2c20 636f 6c5f 7365 7061 7261 746f 722c  , col_separator,
-00015610: 2061 7474 5f70 6174 685f 616e 676c 6573   att_path_angles
-00015620: 5f69 6e5f 7261 642c 2076 6964 656f 5361  _in_rad, videoSa
-00015630: 6d70 6c65 5365 636f 6e64 732c 0a20 2020  mpleSeconds,.   
-00015640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015660: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00015670: 7264 7332 6265 496e 7665 7274 6564 290a  rds2beInverted).
-00015680: 2020 2020 2020 2020 0a0a 2020 2020 6465          ..    de
-00015690: 6620 6765 745f 525f 6361 6d53 7464 3275  f get_R_camStd2u
-000156a0: 746d 2873 656c 662c 525f 6361 6d32 6672  tm(self,R_cam2fr
-000156b0: 616d 653a 6e70 2e61 7272 6179 2c52 5f66  ame:np.array,R_f
-000156c0: 7261 6d65 326e 6564 3a6e 702e 6172 7261  rame2ned:np.arra
-000156d0: 7929 3a0a 2020 2020 2020 2020 2222 2220  y):.        """ 
-000156e0: 7265 7472 756e 2072 6f74 6174 696f 6e20  retrun rotation 
-000156f0: 6d61 7472 6978 2052 2074 7261 6e66 6f72  matrix R tranfor
-00015700: 6d69 6e67 2066 726f 6d20 6361 6d53 7464  ming from camStd
-00015710: 3a20 2878 2c79 2c7a 203d 2072 6967 6874  : (x,y,z = right
-00015720: 2c62 7574 746f 6d2c 6c69 6e65 206f 6620  ,buttom,line of 
-00015730: 7369 6768 7429 2074 6f20 7574 6d20 2878  sight) to utm (x
-00015740: 2c79 2c7a 203d 2065 6173 7469 6e67 2c6e  ,y,z = easting,n
-00015750: 6f72 7468 696e 672c 7570 2920 2222 220a  orthing,up) """.
-00015760: 2020 2020 2020 2020 525f 6361 6d69 4644          R_camiFD
-00015770: 4f32 6361 6d53 7464 203d 206d 6971 7467  O2camStd = miqtg
-00015780: 2e52 5f59 6177 5069 7463 6852 6f6c 6c28  .R_YawPitchRoll(
-00015790: 3930 2c30 2c30 2920 2320 696e 2069 4644  90,0,0) # in iFD
-000157a0: 4f20 6361 6d3a 2028 782c 792c 7a20 3d20  O cam: (x,y,z = 
-000157b0: 746f 702c 7269 6768 742c 6c69 6e65 206f  top,right,line o
-000157c0: 6620 7369 6768 7429 2062 7574 2066 6f72  f sight) but for
-000157d0: 2070 6f73 6520 7468 6520 2773 7461 6e64   pose the 'stand
-000157e0: 6172 6427 2063 616d 5374 643a 2028 782c  ard' camStd: (x,
-000157f0: 792c 7a20 3d20 7269 6768 742c 6275 7474  y,z = right,butt
-00015800: 6f6d 2c6c 696e 6520 6f66 2073 6967 6874  om,line of sight
-00015810: 2920 6973 2065 7870 6563 7465 640a 2020  ) is expected.  
-00015820: 2020 2020 2020 525f 6361 6d53 7464 3266        R_camStd2f
-00015830: 7261 6d65 203d 2052 5f63 616d 3266 7261  rame = R_cam2fra
-00015840: 6d65 2e64 6f74 2852 5f63 616d 6946 444f  me.dot(R_camiFDO
-00015850: 3263 616d 5374 6429 0a20 2020 2020 2020  2camStd).       
-00015860: 2052 5f63 616d 5374 6432 6e65 6420 3d20   R_camStd2ned = 
-00015870: 525f 6672 616d 6532 6e65 642e 646f 7428  R_frame2ned.dot(
-00015880: 525f 6361 6d53 7464 3266 7261 6d65 290a  R_camStd2frame).
-00015890: 2020 2020 2020 2020 525f 6e65 6432 7574          R_ned2ut
-000158a0: 6d20 3d20 6d69 7174 672e 525f 5859 5a28  m = miqtg.R_XYZ(
-000158b0: 3138 302c 302c 3930 2920 2320 7769 7468  180,0,90) # with
-000158c0: 2075 746d 2078 2c79 2c7a 203d 2065 6173   utm x,y,z = eas
-000158d0: 7469 6e67 2c6e 6f72 7468 696e 672c 7570  ting,northing,up
-000158e0: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
-000158f0: 6432 7574 6d20 3d20 525f 6e65 6432 7574  d2utm = R_ned2ut
-00015900: 6d2e 646f 7428 525f 6361 6d53 7464 326e  m.dot(R_camStd2n
-00015910: 6564 292e 726f 756e 6428 3529 0a20 2020  ed).round(5).   
-00015920: 2020 2020 2072 6574 7572 6e20 525f 6361       return R_ca
-00015930: 6d53 7464 3275 746d 0a0a 0a20 2020 2064  mStd2utm...    d
-00015940: 6566 2066 696e 644e 6176 4461 7461 466f  ef findNavDataFo
-00015950: 7249 6d61 6765 2873 656c 662c 6461 7461  rImage(self,data
-00015960: 3a6d 6971 7467 2e4e 756d 4461 7461 5469  :miqtg.NumDataTi
-00015970: 6d65 5374 616d 7065 642c 7669 6465 6f53  meStamped,videoS
-00015980: 616d 706c 6553 6563 6f6e 6473 3d31 293a  ampleSeconds=1):
-00015990: 0a20 2020 2020 2020 2022 2222 2063 7265  .        """ cre
-000159a0: 6174 6573 2061 2064 6963 7420 2869 6d61  ates a dict (ima
-000159b0: 6765 5f64 7473 2920 7769 7468 2066 696c  ge_dts) with fil
-000159c0: 6520 6e61 6d65 2061 7320 6b65 7920 616e  e name as key an
-000159d0: 6420 6120 6c69 7374 206f 6620 6461 7461  d a list of data
-000159e0: 2065 6c65 6d65 6e74 7320 6173 2076 616c   elements as val
-000159f0: 7565 2e20 0a20 2020 2020 2020 2020 2020  ue. .           
-00015a00: 2049 6e20 6361 7365 206f 6620 7068 6f74   In case of phot
-00015a10: 6f73 2074 6865 206c 6973 7420 6861 7320  os the list has 
-00015a20: 6f6e 6c79 2061 2073 696e 676c 6520 656e  only a single en
-00015a30: 7472 792c 2066 6f72 2076 6964 656f 7320  try, for videos 
-00015a40: 6974 2068 6173 2076 6964 656f 2064 7572  it has video dur
-00015a50: 6174 696f 6e20 5b73 6563 5d20 2f20 7669  ation [sec] / vi
-00015a60: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00015a70: 2065 6e74 7269 6573 2e0a 2020 2020 2020   entries..      
-00015a80: 2020 2020 2020 5265 7475 726e 7320 7375        Returns su
-00015a90: 6363 6573 732c 2069 6d61 6765 5f64 7473  ccess, image_dts
-00015aa0: 2c20 6d73 6720 2222 220a 0a20 2020 2020  , msg """..     
-00015ab0: 2020 2069 6620 7669 6465 6f53 616d 706c     if videoSampl
-00015ac0: 6553 6563 6f6e 6473 203c 3d20 303a 0a20  eSeconds <= 0:. 
-00015ad0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00015ae0: 2045 7863 6570 7469 6f6e 2822 6669 6e64   Exception("find
-00015af0: 4e61 7644 6174 6146 6f72 496d 6167 653a  NavDataForImage:
-00015b00: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
-00015b10: 6e64 7320 6d75 7374 2062 6520 6772 6561  nds must be grea
-00015b20: 7465 7220 3022 290a 0a20 2020 2020 2020  ter 0")..       
-00015b30: 2023 2063 7265 6174 6520 736f 7274 6564   # create sorted
-00015b40: 2074 696d 6520 706f 696e 7473 0a20 2020   time points.   
-00015b50: 2020 2020 2074 696d 655f 706f 696e 7473       time_points
-00015b60: 203d 206c 6973 7428 6461 7461 2e6b 6579   = list(data.key
-00015b70: 7328 2929 0a20 2020 2020 2020 2074 696d  s()).        tim
-00015b80: 655f 706f 696e 7473 2e73 6f72 7428 290a  e_points.sort().
-00015b90: 2020 2020 2020 2020 756e 6d61 7463 6865          unmatche
-00015ba0: 6454 696d 6550 6f69 6e74 7320 3d20 5b5d  dTimePoints = []
-00015bb0: 0a20 2020 2020 2020 2069 6d61 6765 5f64  .        image_d
-00015bc0: 7473 203d 207b 7d0a 2020 2020 2020 2020  ts = {}.        
-00015bd0: 7374 6172 7453 6561 7263 6849 6e64 6578  startSearchIndex
-00015be0: 203d 2030 0a20 2020 2020 2020 2069 6d61   = 0.        ima
-00015bf0: 6765 7349 6e52 6177 203d 2020 7365 6c66  gesInRaw =  self
-00015c00: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
-00015c10: 6972 2829 0a20 2020 2020 2020 2069 6d61  ir().        ima
-00015c20: 6765 7349 6e52 6177 536f 7274 6564 4c69  gesInRawSortedLi
-00015c30: 7374 203d 2073 656c 662e 696d 6167 6573  st = self.images
-00015c40: 496e 496d 6167 6573 4469 7253 6f72 7465  InImagesDirSorte
-00015c50: 644c 6973 7428 290a 2020 2020 2020 2020  dList().        
-00015c60: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
-00015c70: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
-00015c80: 7367 2822 496e 7465 7270 6f6c 6174 696e  sg("Interpolatin
-00015c90: 6720 6e61 7669 6761 7469 6f6e 2066 6f72  g navigation for
-00015ca0: 2069 6d61 6765 222c 206c 656e 2869 6d61   image", len(ima
-00015cb0: 6765 7349 6e52 6177 292c 6d6f 6475 6c6f  gesInRaw),modulo
-00015cc0: 3d31 290a 2020 2020 2020 2020 666f 7220  =1).        for 
-00015cd0: 6669 6c65 2069 6e20 696d 6167 6573 496e  file in imagesIn
-00015ce0: 5261 7753 6f72 7465 644c 6973 743a 0a20  RawSortedList:. 
-00015cf0: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
-00015d00: 7072 6f67 7265 7373 2829 0a20 2020 2020  progress().     
-00015d10: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00015d20: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-00015d30: 616d 6528 6669 6c65 290a 0a20 2020 2020  ame(file)..     
-00015d40: 2020 2020 2020 2064 745f 696d 6167 6520         dt_image 
-00015d50: 3d20 6d69 7174 632e 7061 7273 6546 696c  = miqtc.parseFil
-00015d60: 6544 6174 6554 696d 6541 7355 5443 2866  eDateTimeAsUTC(f
-00015d70: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
-00015d80: 2020 2020 2020 6474 5f69 6d61 6765 5f74        dt_image_t
-00015d90: 7320 3d20 696e 7428 6474 5f69 6d61 6765  s = int(dt_image
-00015da0: 2e74 696d 6573 7461 6d70 2829 202a 2031  .timestamp() * 1
-00015db0: 3030 3029 0a0a 2020 2020 2020 2020 2020  000)..          
-00015dc0: 2020 7275 6e54 696d 6520 3d20 696d 6167    runTime = imag
-00015dd0: 6573 496e 5261 775b 6669 6c65 5d5b 315d  esInRaw[file][1]
-00015de0: 2023 202d 3120 666f 7220 7068 6f74 6f73   # -1 for photos
-00015df0: 0a20 2020 2020 2020 2020 2020 2023 2076  .            # v
-00015e00: 6964 656f 0a20 2020 2020 2020 2020 2020  ideo.           
-00015e10: 2069 6620 696d 6167 6573 496e 5261 775b   if imagesInRaw[
-00015e20: 6669 6c65 5d5b 325d 2069 6e20 6d69 7174  file][2] in miqt
-00015e30: 762e 7669 6465 6f5f 7479 7065 7320 616e  v.video_types an
-00015e40: 6420 7275 6e54 696d 6520 3c3d 2030 3a20  d runTime <= 0: 
-00015e50: 2320 6578 740a 2020 2020 2020 2020 2020  # ext.          
-00015e60: 2020 2020 2020 7072 696e 7428 2243 6175        print("Cau
-00015e70: 7469 6f6e 2120 436f 756c 6420 6e6f 7420  tion! Could not 
-00015e80: 7265 6164 2076 6964 656f 2072 756e 2074  read video run t
-00015e90: 696d 6520 6672 6f6d 2066 696c 6522 2c66  ime from file",f
-00015ea0: 696c 6529 2023 2054 4f44 4f20 646f 6573  ile) # TODO does
-00015eb0: 2074 6869 7320 6861 7070 656e 3f20 4861   this happen? Ha
-00015ec0: 6e64 6c65 2062 6574 7465 723f 0a0a 2020  ndle better?..  
-00015ed0: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
-00015ee0: 5469 6d65 5365 6373 203d 2030 0a20 2020  TimeSecs = 0.   
-00015ef0: 2020 2020 2020 2020 2070 6f73 5f6c 6973           pos_lis
-00015f00: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
-00015f10: 2020 2067 6f20 3d20 5472 7565 0a20 2020     go = True.   
-00015f20: 2020 2020 2020 2020 2077 6869 6c65 2067           while g
-00015f30: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
-00015f40: 2020 2074 7279 3a20 2020 2020 2020 2020     try:         
-00015f50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f70: 706f 732c 2073 7461 7274 5365 6172 6368  pos, startSearch
-00015f80: 496e 6465 7820 3d20 6461 7461 2e69 6e74  Index = data.int
-00015f90: 6572 706f 6c61 7465 4174 5469 6d65 2864  erpolateAtTime(d
-00015fa0: 745f 696d 6167 655f 7473 202b 2073 616d  t_image_ts + sam
-00015fb0: 706c 6554 696d 6553 6563 7320 2a20 3130  pleTimeSecs * 10
-00015fc0: 3030 2c74 696d 655f 706f 696e 7473 2c73  00,time_points,s
-00015fd0: 7461 7274 5365 6172 6368 496e 6465 7829  tartSearchIndex)
-00015fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ff0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00016000: 2020 2020 2020 2020 2020 2320 696e 7465            # inte
-00016010: 7270 6f6c 6174 6541 7454 696d 6520 7265  rpolateAtTime re
-00016020: 7475 726e 7320 4e6f 6e65 2076 616c 7565  turns None value
-00016030: 7320 6966 2074 696d 6520 6f75 7420 6f66  s if time out of
-00016040: 2072 616e 6765 0a20 2020 2020 2020 2020   range.         
-00016050: 2020 2020 2020 2020 2020 2069 6620 706f             if po
-00016060: 732e 636f 7461 696e 734e 6f6e 6556 616c  s.cotainsNoneVal
-00016070: 7565 7349 6e52 6571 7569 7265 6446 6965  uesInRequiredFie
-00016080: 6c64 7328 293a 0a20 2020 2020 2020 2020  lds():.         
-00016090: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-000160a0: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
-000160b0: 7473 2e61 7070 656e 6428 2864 745f 696d  ts.append((dt_im
-000160c0: 6167 655f 7473 202b 2073 616d 706c 6554  age_ts + sampleT
-000160d0: 696d 6553 6563 7320 2a20 3130 3030 292f  imeSecs * 1000)/
-000160e0: 3130 3030 290a 2020 2020 2020 2020 2020  1000).          
-000160f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016110: 2020 2020 2020 2020 706f 735f 6c69 7374          pos_list
-00016120: 2e61 7070 656e 6428 706f 7329 0a20 2020  .append(pos).   
-00016130: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00016140: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-00016150: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-00016160: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00016170: 616c 7365 2c20 696d 6167 655f 6474 732c  alse, image_dts,
-00016180: 2022 436f 756c 6420 6e6f 7420 6669 6e64   "Could not find
-00016190: 2069 6d61 6765 2074 696d 6520 222b 2064   image time "+ d
-000161a0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-000161b0: 2e75 7463 6672 6f6d 7469 6d65 7374 616d  .utcfromtimestam
-000161c0: 7028 2864 745f 696d 6167 655f 7473 202b  p((dt_image_ts +
-000161d0: 2073 616d 706c 6554 696d 6553 6563 7320   sampleTimeSecs 
-000161e0: 2a20 3130 3030 292f 3130 3030 292e 7374  * 1000)/1000).st
-000161f0: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
-00016200: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-00016210: 7427 5d29 202b 2220 696e 2022 2b73 7472  t']) +" in "+str
-00016220: 2864 6174 612e 6c65 6e28 2929 2b22 2064  (data.len())+" d
-00016230: 6174 6120 706f 7369 7469 6f6e 7322 202b  ata positions" +
-00016240: 2073 7472 2865 2e61 7267 7329 0a20 2020   str(e.args).   
-00016250: 2020 2020 2020 2020 2020 2020 2073 616d               sam
-00016260: 706c 6554 696d 6553 6563 7320 2b3d 2076  pleTimeSecs += v
-00016270: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-00016280: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00016290: 2020 6966 2073 616d 706c 6554 696d 6553    if sampleTimeS
-000162a0: 6563 7320 3e20 7275 6e54 696d 653a 0a20  ecs > runTime:. 
-000162b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162c0: 2020 2067 6f20 3d20 4661 6c73 650a 2020     go = False.  
-000162d0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-000162e0: 2020 2020 2020 2069 6d61 6765 5f64 7473         image_dts
-000162f0: 5b66 696c 655f 6e61 6d65 5d20 3d20 706f  [file_name] = po
-00016300: 735f 6c69 7374 0a20 2020 2020 2020 2070  s_list.        p
-00016310: 726f 672e 636c 6561 7228 290a 2020 2020  rog.clear().    
-00016320: 2020 2020 7265 7475 726e 4d73 6720 3d20      returnMsg = 
-00016330: 2222 0a20 2020 2020 2020 2069 6620 6c65  "".        if le
-00016340: 6e28 756e 6d61 7463 6865 6454 696d 6550  n(unmatchedTimeP
-00016350: 6f69 6e74 7329 2021 3d20 303a 0a20 2020  oints) != 0:.   
-00016360: 2020 2020 2020 2020 2075 6e6d 6174 6368           unmatch
-00016370: 6564 5469 6d65 506f 696e 7473 2e73 6f72  edTimePoints.sor
-00016380: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00016390: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-000163a0: 6e74 7320 3d20 5b64 6174 6574 696d 652e  nts = [datetime.
-000163b0: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
-000163c0: 7469 6d65 7374 616d 7028 7473 292e 7374  timestamp(ts).st
-000163d0: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
-000163e0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-000163f0: 7427 5d29 2066 6f72 2074 7320 696e 2075  t']) for ts in u
-00016400: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
-00016410: 7473 5d0a 2020 2020 2020 2020 2020 2020  ts].            
-00016420: 7265 7475 726e 4d73 6720 3d20 2243 6175  returnMsg = "Cau
-00016430: 7469 6f6e 2120 4e61 7669 6761 7469 6f6e  tion! Navigation
-00016440: 206e 6f74 2066 6f75 6e64 2066 6f72 2074   not found for t
-00016450: 6865 2066 6f6c 6c6f 7769 6e67 2069 6d61  he following ima
-00016460: 6765 2074 696d 6520 706f 696e 7473 2e20  ge time points. 
-00016470: 446f 7562 6c65 2063 6865 636b 206f 7220  Double check or 
-00016480: 7072 6f76 6964 6520 6174 206c 6561 7374  provide at least
-00016490: 2073 7461 7469 6320 6465 6661 756c 7420   static default 
-000164a0: 6e61 7669 6761 7469 6f6e 2069 6e20 6865  navigation in he
-000164b0: 6164 6572 2066 6965 6c64 732e 220a 2020  ader fields.".  
-000164c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000164d0: 4d73 6720 2b3d 2022 5c6e 2220 2b20 225c  Msg += "\n" + "\
-000164e0: 6e22 2e6a 6f69 6e28 756e 6d61 7463 6865  n".join(unmatche
-000164f0: 6454 696d 6550 6f69 6e74 7329 0a20 2020  dTimePoints).   
-00016500: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00016510: 2c20 696d 6167 655f 6474 732c 2072 6574  , image_dts, ret
-00016520: 7572 6e4d 7367 0a0a 0a20 2020 2064 6566  urnMsg...    def
-00016530: 2063 7265 6174 655f 696d 6167 655f 6e61   create_image_na
-00016540: 7669 6761 7469 6f6e 5f66 696c 6528 7365  vigation_file(se
-00016550: 6c66 2c20 6e61 765f 7061 7468 3a20 7374  lf, nav_path: st
-00016560: 722c 206e 6176 5f68 6561 6465 723d 6d69  r, nav_header=mi
-00016570: 7174 762e 706f 735f 6865 6164 6572 5b27  qtv.pos_header['
-00016580: 7061 6e67 6165 6127 5d2c 2064 6174 655f  pangaea'], date_
-00016590: 666f 726d 6174 3d6d 6971 7476 2e64 6174  format=miqtv.dat
-000165a0: 655f 666f 726d 6174 735b 2770 616e 6761  e_formats['panga
-000165b0: 6561 275d 2c20 6f76 6572 7772 6974 653d  ea'], overwrite=
-000165c0: 4661 6c73 652c 2063 6f6c 5f73 6570 6172  False, col_separ
-000165d0: 6174 6f72 203d 2022 5c74 222c 2076 6964  ator = "\t", vid
-000165e0: 656f 5361 6d70 6c65 5365 636f 6e64 733d  eoSampleSeconds=
-000165f0: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-00016600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016610: 2020 2020 2020 206f 6666 7365 745f 783d         offset_x=
-00016620: 302c 206f 6666 7365 745f 793d 302c 206f  0, offset_y=0, o
-00016630: 6666 7365 745f 7a3d 302c 616e 676c 6573  ffset_z=0,angles
-00016640: 5f69 6e5f 7261 6420 3d20 4661 6c73 652c  _in_rad = False,
-00016650: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-00016660: 7465 643d 5b5d 293a 0a20 2020 2020 2020  ted=[]):.       
-00016670: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
-00016680: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
-00016690: 7465 7874 2066 696c 6520 7769 7468 2034  text file with 4
-000166a0: 2e35 4420 6e61 7669 6761 7469 6f6e 2064  .5D navigation d
-000166b0: 6174 6120 666f 7220 6561 6368 2069 6d61  ata for each ima
-000166c0: 6765 2c20 692e 652e 2061 2073 696e 676c  ge, i.e. a singl
-000166d0: 6520 726f 7720 7065 7220 7068 6f74 6f2c  e row per photo,
-000166e0: 2076 6964 656f 2064 7572 6174 696f 6e20   video duration 
-000166f0: 5b73 6563 5d20 2f20 7669 6465 6f53 616d  [sec] / videoSam
-00016700: 706c 6553 6563 6f6e 6473 2072 6f77 7320  pleSeconds rows 
-00016710: 7065 7220 7669 6465 6f2e 0a20 2020 2020  per video..     
-00016720: 2020 2020 2020 206e 6176 5f68 6561 6465         nav_heade
-00016730: 7220 6d75 7374 2062 6520 6469 6374 2063  r must be dict c
-00016740: 6f6e 7461 696e 696e 6720 7468 6520 6b65  ontaining the ke
-00016750: 7973 2027 7574 6327 2c27 6c61 7427 2c27  ys 'utc','lat','
-00016760: 6c6f 6e27 2c27 6465 7027 286f 7220 2761  lon','dep'(or 'a
-00016770: 6c74 2729 2c20 6f70 7469 6f6e 616c 3a20  lt'), optional: 
-00016780: 2768 6774 272c 2775 6e63 6572 7427 2077  'hgt','uncert' w
-00016790: 6974 6820 7468 6520 7265 7370 6563 7469  ith the respecti
-000167a0: 7665 2063 6f6c 756d 6e20 6865 6164 6572  ve column header
-000167b0: 7320 6173 2076 616c 7565 7320 0a20 2020  s as values .   
-000167c0: 2020 2020 2020 2020 2069 6620 6f6e 6520           if one 
-000167d0: 6f66 2074 6865 2076 6568 6963 6c65 2078  of the vehicle x
-000167e0: 2c79 2c7a 206f 6666 7365 7473 205b 6d5d  ,y,z offsets [m]
-000167f0: 2069 7320 6e6f 7420 3020 616e 6420 6e61   is not 0 and na
-00016800: 765f 6865 6164 6572 2061 6c73 6f20 636f  v_header also co
-00016810: 6e74 6169 6e73 2027 7961 7727 2c27 7069  ntains 'yaw','pi
-00016820: 7463 6827 2c27 726f 6c6c 2720 6c65 7665  tch','roll' leve
-00016830: 7261 726d 206f 6666 7365 7473 2061 7265  rarm offsets are
-00016840: 2063 6f6d 7065 6e73 6174 6564 2066 6f72   compensated for
-00016850: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
-00016860: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
-00016870: 7465 4e61 7646 696c 6545 7869 7374 7328  teNavFileExists(
-00016880: 2920 616e 6420 6e6f 7420 6f76 6572 7772  ) and not overwr
-00016890: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
-000168a0: 2072 6574 7572 6e20 5472 7565 2c20 224f   return True, "O
-000168b0: 7574 7075 7420 6669 6c65 2065 7869 7374  utput file exist
-000168c0: 733a 2022 2b73 656c 662e 6765 745f 696e  s: "+self.get_in
-000168d0: 745f 6e61 765f 6669 6c65 2829 0a0a 2020  t_nav_file()..  
-000168e0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-000168f0: 7061 7468 2e65 7869 7374 7328 6e61 765f  path.exists(nav_
-00016900: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
-00016910: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
-00016920: 2022 4e61 7669 6761 7469 6f6e 2066 696c   "Navigation fil
-00016930: 6520 6e6f 7420 666f 756e 643a 2022 2b6e  e not found: "+n
-00016940: 6176 5f70 6174 680a 0a20 2020 2020 2020  av_path..       
-00016950: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00016960: 6578 6973 7473 2873 656c 662e 696d 6167  exists(self.imag
-00016970: 6573 4469 7229 3a0a 2020 2020 2020 2020  esDir):.        
-00016980: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00016990: 2c20 2249 6d61 6765 2066 6f6c 6465 7220  , "Image folder 
-000169a0: 6e6f 7420 666f 756e 643a 2022 2b20 7365  not found: "+ se
-000169b0: 6c66 2e69 6d61 6765 7344 6972 0a0a 2020  lf.imagesDir..  
-000169c0: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
-000169d0: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
-000169e0: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
-000169f0: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
-00016a00: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-00016a10: 6e4d 7367 203d 2022 220a 2020 2020 2020  nMsg = "".      
-00016a20: 2020 636f 6d70 656e 7361 744f 6666 7365    compensatOffse
-00016a30: 7473 203d 2046 616c 7365 0a20 2020 2020  ts = False.     
-00016a40: 2020 2069 6620 286f 6666 7365 745f 7821     if (offset_x!
-00016a50: 3d30 206f 7220 6f66 6673 6574 5f79 213d  =0 or offset_y!=
-00016a60: 3020 6f72 206f 6666 7365 745f 7a21 3d30  0 or offset_z!=0
-00016a70: 2920 616e 6420 2779 6177 2720 696e 206e  ) and 'yaw' in n
-00016a80: 6176 5f68 6561 6465 7220 616e 6420 2770  av_header and 'p
-00016a90: 6974 6368 2720 696e 206e 6176 5f68 6561  itch' in nav_hea
-00016aa0: 6465 7220 616e 6420 2772 6f6c 6c27 2069  der and 'roll' i
-00016ab0: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-00016ac0: 2020 2020 2020 2020 2020 636f 6d70 656e            compen
-00016ad0: 7361 744f 6666 7365 7473 203d 2054 7275  satOffsets = Tru
-00016ae0: 650a 0a20 2020 2020 2020 2023 2063 6865  e..        # che
-00016af0: 636b 2069 6620 666f 7220 6d69 7373 696e  ck if for missin
-00016b00: 6720 6669 656c 6473 2074 6865 7265 2061  g fields there a
-00016b10: 7265 2063 6f6e 7374 2076 616c 7565 7320  re const values 
-00016b20: 696e 2068 6561 6465 720a 2020 2020 2020  in header.      
-00016b30: 2020 636f 6e73 745f 7661 6c75 6573 203d    const_values =
-00016b40: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-00016b50: 6e61 7646 6965 6c64 2069 6e20 6d69 7174  navField in miqt
-00016b60: 762e 706f 735f 6865 6164 6572 5b27 6d61  v.pos_header['ma
-00016b70: 7269 7174 275d 3a0a 2020 2020 2020 2020  riqt']:.        
-00016b80: 2020 2020 7265 7370 6563 7469 7665 4865      respectiveHe
-00016b90: 6164 6572 4669 656c 6420 3d20 6d69 7174  aderField = miqt
-00016ba0: 762e 636f 6c5f 6865 6164 6572 5b22 6d61  v.col_header["ma
-00016bb0: 7269 7174 225d 5b6e 6176 4669 656c 645d  riqt"][navField]
-00016bc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016bd0: 6e61 7646 6965 6c64 206e 6f74 2069 6e20  navField not in 
-00016be0: 6e61 765f 6865 6164 6572 2061 6e64 2028  nav_header and (
-00016bf0: 7265 7370 6563 7469 7665 4865 6164 6572  respectiveHeader
-00016c00: 4669 656c 6420 696e 2073 656c 662e 6966  Field in self.if
-00016c10: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-00016c20: 6553 6574 4865 6164 6572 4b65 795d 2061  eSetHeaderKey] a
-00016c30: 6e64 2073 656c 662e 6669 6e64 546d 7046  nd self.findTmpF
-00016c40: 6965 6c64 3228 7265 7370 6563 7469 7665  ield2(respective
-00016c50: 4865 6164 6572 4669 656c 6429 2021 3d20  HeaderField) != 
-00016c60: 2222 293a 200a 2020 2020 2020 2020 2020  ""): .          
-00016c70: 2020 2020 2020 636f 6e73 745f 7661 6c75        const_valu
-00016c80: 6573 5b6e 6176 4669 656c 645d 203d 2073  es[navField] = s
-00016c90: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-00016ca0: 2872 6573 7065 6374 6976 6548 6561 6465  (respectiveHeade
-00016cb0: 7246 6965 6c64 290a 0a20 2020 2020 2020  rField)..       
-00016cc0: 2020 2320 6861 6e64 6c65 2061 6c74 2076    # handle alt v
-00016cd0: 7320 6465 700a 2020 2020 2020 2020 6966  s dep.        if
-00016ce0: 2027 616c 7427 2069 6e20 6e61 765f 6865   'alt' in nav_he
-00016cf0: 6164 6572 2061 6e64 2027 6465 7027 2069  ader and 'dep' i
-00016d00: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-00016d10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00016d20: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00016d30: 696f 6e28 2227 616c 7427 2061 6e64 2027  ion("'alt' and '
-00016d40: 6465 7027 2070 726f 7669 6465 642e 2052  dep' provided. R
-00016d50: 6564 756e 6461 6e74 2c20 616c 7420 3d20  edundant, alt = 
-00016d60: 2d20 6465 702e 2050 726f 7669 6465 6420  - dep. Provided 
-00016d70: 6f6e 6c79 206f 6e65 206f 6620 626f 7468  only one of both
-00016d80: 2e22 290a 2020 2020 2020 2020 0a20 2020  .").        .   
-00016d90: 2020 2020 2023 204c 6f61 6420 6e61 7669       # Load navi
-00016da0: 6761 7469 6f6e 2064 6174 6120 2869 6620  gation data (if 
-00016db0: 2761 6c74 2720 696e 7374 6561 6420 6f66  'alt' instead of
-00016dc0: 2027 6465 7027 2c20 6974 7320 6175 746f   'dep', its auto
-00016dd0: 6d61 7469 6361 6c6c 7920 696e 7665 7274  matically invert
-00016de0: 6564 290a 2020 2020 2020 2020 6e61 765f  ed).        nav_
-00016df0: 6461 7461 2c20 7061 7273 654d 7367 203d  data, parseMsg =
-00016e00: 206d 6971 746e 2e72 6561 6441 6c6c 506f   miqtn.readAllPo
-00016e10: 7369 7469 6f6e 7346 726f 6d46 696c 6550  sitionsFromFileP
-00016e20: 6174 6828 6e61 765f 7061 7468 2c20 6e61  ath(nav_path, na
-00016e30: 765f 6865 6164 6572 2c20 6461 7465 5f66  v_header, date_f
-00016e40: 6f72 6d61 742c 636f 6c5f 7365 7061 7261  ormat,col_separa
-00016e50: 746f 723d 636f 6c5f 7365 7061 7261 746f  tor=col_separato
-00016e60: 722c 636f 6e73 745f 7661 6c75 6573 3d63  r,const_values=c
-00016e70: 6f6e 7374 5f76 616c 7565 7329 0a20 2020  onst_values).   
-00016e80: 2020 2020 2069 6620 7061 7273 654d 7367       if parseMsg
-00016e90: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
-00016ea0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00016eb0: 6728 7061 7273 654d 7367 2c64 6f6e 7453  g(parseMsg,dontS
-00016ec0: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
-00016ed0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
-00016ee0: 3d20 225c 6e22 202b 2070 6172 7365 4d73  = "\n" + parseMs
-00016ef0: 670a 0a20 2020 2020 2020 2023 2066 696e  g..        # fin
-00016f00: 6420 666f 7220 6561 6368 2069 6d61 6765  d for each image
-00016f10: 2074 6865 2072 6573 7065 6374 6976 6520   the respective 
-00016f20: 6e61 7669 6761 7469 6f6e 2064 6174 610a  navigation data.
-00016f30: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
-00016f40: 0a20 2020 2020 2020 2073 7563 6365 7373  .        success
-00016f50: 2c20 696d 6167 655f 6474 732c 206d 7367  , image_dts, msg
-00016f60: 203d 2073 656c 662e 6669 6e64 4e61 7644   = self.findNavD
-00016f70: 6174 6146 6f72 496d 6167 6528 6e61 765f  ataForImage(nav_
-00016f80: 6461 7461 2c76 6964 656f 5361 6d70 6c65  data,videoSample
-00016f90: 5365 636f 6e64 7329 0a20 2020 2020 2020  Seconds).       
-00016fa0: 2073 656c 662e 7072 6f76 2e6c 6f67 286d   self.prov.log(m
-00016fb0: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
-00016fc0: 290a 2020 2020 2020 2020 6966 206d 7367  ).        if msg
-00016fd0: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
-00016fe0: 2020 2020 7265 7475 726e 4d73 6720 2b3d      returnMsg +=
-00016ff0: 2022 5c6e 2220 2b20 6d73 670a 2020 2020   "\n" + msg.    
-00017000: 2020 2020 6966 206e 6f74 2073 7563 6365      if not succe
-00017010: 7373 3a0a 2020 2020 2020 2020 2020 2020  ss:.            
-00017020: 7265 7475 726e 2046 616c 7365 2c20 7265  return False, re
-00017030: 7475 726e 4d73 670a 2020 2020 2020 2020  turnMsg.        
-00017040: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
-00017050: 6f61 6469 6e67 4d73 6728 2243 7265 6174  oadingMsg("Creat
-00017060: 696e 6720 6974 656d 7327 206e 6176 6967  ing items' navig
-00017070: 6174 696f 6e20 6461 7461 2229 0a0a 2020  ation data")..  
-00017080: 2020 2020 2020 2320 696e 7665 7274 2076        # invert v
-00017090: 616c 7565 7320 2869 6620 6e65 6564 6564  alues (if needed
-000170a0: 2920 6265 666f 7265 206c 6576 6572 6172  ) before leverar
-000170b0: 6d20 636f 6d70 656e 7361 7469 6f6e 0a20  m compensation. 
-000170c0: 2020 2020 2020 2069 6620 7265 636f 7264         if record
-000170d0: 7332 6265 496e 7665 7274 6564 2021 3d20  s2beInverted != 
-000170e0: 5b5d 3a0a 2020 2020 2020 2020 2020 2020  []:.            
-000170f0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
-00017100: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
-00017110: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-00017120: 203d 2069 6d61 6765 5f64 7473 5b66 696c   = image_dts[fil
-00017130: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-00017140: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00017150: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
-00017160: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00017170: 2020 2020 2020 2069 6620 276c 6174 2720         if 'lat' 
-00017180: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
-00017190: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
-000171a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000171b0: 6f73 6974 696f 6e73 5b69 5d2e 6c61 7420  ositions[i].lat 
-000171c0: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
-000171d0: 2020 2020 2020 2020 2020 6966 2027 6c6f            if 'lo
-000171e0: 6e27 2069 6e20 7265 636f 7264 7332 6265  n' in records2be
-000171f0: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017210: 2020 706f 7369 7469 6f6e 735b 695d 2e6c    positions[i].l
-00017220: 6f6e 202a 3d20 2d31 0a20 2020 2020 2020  on *= -1.       
-00017230: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017240: 2827 6465 7027 2069 6e20 7265 636f 7264  ('dep' in record
-00017250: 7332 6265 496e 7665 7274 6564 2061 6e64  s2beInverted and
-00017260: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
-00017270: 6164 6572 2920 6f72 2028 2761 6c74 2720  ader) or ('alt' 
-00017280: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
-00017290: 6572 7465 6420 616e 6420 2761 6c74 2720  erted and 'alt' 
-000172a0: 696e 206e 6176 5f68 6561 6465 7229 3a0a  in nav_header):.
-000172b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172c0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
-000172d0: 735b 695d 2e64 6570 202a 3d20 2d31 0a20  s[i].dep *= -1. 
-000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172f0: 2020 2069 6620 2768 6774 2720 696e 2072     if 'hgt' in r
-00017300: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00017310: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00017320: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
-00017330: 696f 6e73 5b69 5d2e 6867 7420 2a3d 202d  ions[i].hgt *= -
-00017340: 310a 0a0a 2020 2020 2020 2020 2320 636f  1...        # co
-00017350: 6d70 656e 7361 7465 206c 6576 6572 6172  mpensate leverar
-00017360: 6d20 6f66 6673 6574 730a 2020 2020 2020  m offsets.      
-00017370: 2020 6966 2063 6f6d 7065 6e73 6174 4f66    if compensatOf
-00017380: 6673 6574 733a 0a0a 2020 2020 2020 2020  fsets:..        
-00017390: 2020 2020 2320 6c6f 6164 2066 7261 6d65      # load frame
-000173a0: 2061 7474 6974 7564 6520 6461 7461 2066   attitude data f
-000173b0: 726f 6d20 6669 6c65 0a20 2020 2020 2020  rom file.       
-000173c0: 2020 2020 2061 7474 5f64 6174 612c 2070       att_data, p
-000173d0: 6172 7365 4d73 6720 3d20 6d69 7174 6e2e  arseMsg = miqtn.
-000173e0: 7265 6164 416c 6c41 7474 6974 7564 6573  readAllAttitudes
-000173f0: 4672 6f6d 4669 6c65 5061 7468 286e 6176  FromFilePath(nav
-00017400: 5f70 6174 682c 206e 6176 5f68 6561 6465  _path, nav_heade
-00017410: 722c 2064 6174 655f 666f 726d 6174 2c63  r, date_format,c
-00017420: 6f6c 5f73 6570 6172 6174 6f72 3d63 6f6c  ol_separator=col
-00017430: 5f73 6570 6172 6174 6f72 2c63 6f6e 7374  _separator,const
-00017440: 5f76 616c 7565 733d 636f 6e73 745f 7661  _values=const_va
-00017450: 6c75 6573 2c61 6e67 6c65 7349 6e52 6164  lues,anglesInRad
-00017460: 3d61 6e67 6c65 735f 696e 5f72 6164 290a  =angles_in_rad).
-00017470: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00017480: 6172 7365 4d73 6720 213d 2022 223a 0a20  arseMsg != "":. 
-00017490: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000174a0: 656c 662e 7072 6f76 2e6c 6f67 2870 6172  elf.prov.log(par
-000174b0: 7365 4d73 672c 646f 6e74 5368 6f77 3d54  seMsg,dontShow=T
-000174c0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000174d0: 2020 2020 2072 6574 7572 6e4d 7367 202b       returnMsg +
-000174e0: 3d20 225c 6e22 202b 2070 6172 7365 4d73  = "\n" + parseMs
-000174f0: 670a 0a20 2020 2020 2020 2020 2020 2069  g..            i
-00017500: 6620 7265 636f 7264 7332 6265 496e 7665  f records2beInve
-00017510: 7274 6564 2021 3d20 5b5d 3a0a 2020 2020  rted != []:.    
-00017520: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00017530: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
-00017540: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00017550: 2020 2020 2020 2061 7474 6974 7564 6573         attitudes
-00017560: 203d 2069 6d61 6765 5f64 7473 5f61 7474   = image_dts_att
-00017570: 5b66 696c 655d 0a20 2020 2020 2020 2020  [file].         
-00017580: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00017590: 2069 6e20 7261 6e67 6528 6c65 6e28 706f   in range(len(po
-000175a0: 7369 7469 6f6e 7329 293a 0a20 2020 2020  sitions)):.     
-000175b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175c0: 2020 2069 6620 2779 6177 2720 696e 2020     if 'yaw' in  
-000175d0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-000175e0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-000175f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017600: 6174 7469 7475 6465 735b 695d 2e79 6177  attitudes[i].yaw
-00017610: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
-00017620: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017630: 6620 2770 6974 6368 2720 696e 2020 7265  f 'pitch' in  re
-00017640: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
-00017650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017660: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00017670: 7469 7475 6465 735b 695d 2e70 6974 6368  titudes[i].pitch
-00017680: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
-00017690: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000176a0: 6620 2772 6f6c 6c27 2069 6e20 2072 6563  f 'roll' in  rec
-000176b0: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
-000176c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000176d0: 2020 2020 2020 2020 2020 2020 2061 7474               att
-000176e0: 6974 7564 6573 5b69 5d2e 726f 6c6c 202a  itudes[i].roll *
-000176f0: 3d20 2d31 0a0a 2020 2020 2020 2020 2020  = -1..          
-00017700: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
-00017710: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
-00017720: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
-00017730: 6e20 6461 7461 0a20 2020 2020 2020 2020  n data.         
-00017740: 2020 2073 7563 6365 7373 2c20 696d 6167     success, imag
-00017750: 655f 6474 735f 6174 742c 206d 7367 203d  e_dts_att, msg =
-00017760: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
-00017770: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
-00017780: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
-00017790: 636f 6e64 7329 0a20 2020 2020 2020 2020  conds).         
-000177a0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-000177b0: 286d 7367 2c64 6f6e 7453 686f 773d 5472  (msg,dontShow=Tr
-000177c0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-000177d0: 6966 206d 7367 2021 3d20 2222 3a0a 2020  if msg != "":.  
-000177e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000177f0: 7475 726e 4d73 6720 2b3d 2022 5c6e 2220  turnMsg += "\n" 
-00017800: 2b20 6d73 670a 2020 2020 2020 2020 2020  + msg.          
-00017810: 2020 6966 206e 6f74 2073 7563 6365 7373    if not success
-00017820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017830: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00017840: 7265 7475 726e 4d73 670a 0a20 2020 2020  returnMsg..     
-00017850: 2020 2020 2020 2023 2063 6f6d 7065 6e73         # compens
-00017860: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
-00017870: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
-00017880: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
-00017890: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-000178a0: 203d 2069 6d61 6765 5f64 7473 5b66 696c   = image_dts[fil
-000178b0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-000178c0: 2020 2061 7474 6974 7564 6573 203d 2069     attitudes = i
-000178d0: 6d61 6765 5f64 7473 5f61 7474 5b66 696c  mage_dts_att[fil
-000178e0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-000178f0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00017900: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
-00017910: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00017920: 2020 2020 2020 206c 6174 203d 2070 6f73         lat = pos
-00017930: 6974 696f 6e73 5b69 5d2e 6c61 740a 2020  itions[i].lat.  
-00017940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017950: 2020 6c6f 6e20 3d20 706f 7369 7469 6f6e    lon = position
-00017960: 735b 695d 2e6c 6f6e 0a20 2020 2020 2020  s[i].lon.       
-00017970: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-00017980: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
-00017990: 6465 700a 2020 2020 2020 2020 2020 2020  dep.            
-000179a0: 2020 2020 2020 2020 7961 7720 3d20 6174          yaw = at
-000179b0: 7469 7475 6465 735b 695d 2e79 6177 0a20  titudes[i].yaw. 
-000179c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179d0: 2020 2070 6974 6368 203d 2061 7474 6974     pitch = attit
-000179e0: 7564 6573 5b69 5d2e 7069 7463 680a 2020  udes[i].pitch.  
-000179f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a00: 2020 726f 6c6c 203d 2061 7474 6974 7564    roll = attitud
-00017a10: 6573 5b69 5d2e 726f 6c6c 0a20 2020 2020  es[i].roll.     
-00017a20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017a30: 6620 7961 7720 6973 204e 6f6e 6520 6f72  f yaw is None or
-00017a40: 2070 6974 6368 2069 7320 4e6f 6e65 206f   pitch is None o
-00017a50: 7220 726f 6c6c 2069 7320 4e6f 6e65 3a0a  r roll is None:.
-00017a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a70: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00017a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017a90: 2020 2020 206e 6577 5f6c 6174 2c6e 6577       new_lat,new
-00017aa0: 5f6c 6f6e 2c6e 6577 5f64 6570 203d 206d  _lon,new_dep = m
-00017ab0: 6971 7467 2e61 6464 4c65 7665 7261 726d  iqtg.addLeverarm
-00017ac0: 7332 4c61 746c 6f6e 286c 6174 2c6c 6f6e  s2Latlon(lat,lon
-00017ad0: 2c64 6570 2c6f 6666 7365 745f 782c 6f66  ,dep,offset_x,of
-00017ae0: 6673 6574 5f79 2c6f 6666 7365 745f 7a2c  fset_y,offset_z,
-00017af0: 7961 772c 7069 7463 682c 726f 6c6c 290a  yaw,pitch,roll).
-00017b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b10: 2020 2020 706f 7369 7469 6f6e 735b 695d      positions[i]
-00017b20: 2e6c 6174 203d 206e 6577 5f6c 6174 0a20  .lat = new_lat. 
-00017b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b40: 2020 2070 6f73 6974 696f 6e73 5b69 5d2e     positions[i].
-00017b50: 6c6f 6e20 3d20 6e65 775f 6c6f 6e0a 2020  lon = new_lon.  
-00017b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b70: 2020 706f 7369 7469 6f6e 735b 695d 2e64    positions[i].d
-00017b80: 6570 203d 206e 6577 5f64 6570 0a0a 2020  ep = new_dep..  
-00017b90: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00017ba0: 726f 762e 6c6f 6728 2261 7070 6c69 6564  rov.log("applied
-00017bb0: 206c 6576 6572 2061 726d 2063 6f6d 7065   lever arm compe
-00017bc0: 6e73 6174 696f 6e20 782c 792c 7a20 3d20  nsation x,y,z = 
-00017bd0: 2220 2b20 7374 7228 6f66 6673 6574 5f78  " + str(offset_x
-00017be0: 2920 2b20 222c 2220 2b20 7374 7228 6f66  ) + "," + str(of
-00017bf0: 6673 6574 5f79 2920 2b20 222c 2220 2b20  fset_y) + "," + 
-00017c00: 7374 7228 6f66 6673 6574 5f7a 292c 646f  str(offset_z),do
-00017c10: 6e74 5368 6f77 3d54 7275 6529 0a0a 2020  ntShow=True)..  
-00017c20: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
-00017c30: 6765 5f64 7473 2920 3e20 303a 0a20 2020  ge_dts) > 0:.   
-00017c40: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
-00017c50: 2077 6865 7468 6572 2064 6570 7468 2061   whether depth a
-00017c60: 6e64 2068 6569 6768 7420 6172 6520 7365  nd height are se
-00017c70: 740a 2020 2020 2020 2020 2020 2020 6c61  t.            la
-00017c80: 745f 6964 656e 7469 6361 6c2c 206c 6f6e  t_identical, lon
-00017c90: 5f69 6465 6e74 6963 616c 2c20 6465 705f  _identical, dep_
-00017ca0: 6964 656e 7469 6361 6c2c 2068 6774 5f69  identical, hgt_i
-00017cb0: 6465 6e74 6963 616c 2c20 6465 705f 6e6f  dentical, dep_no
-00017cc0: 745f 7a65 726f 2c20 6867 745f 6e6f 745f  t_zero, hgt_not_
-00017cd0: 7a65 726f 2c75 6e63 6572 745f 6e6f 745f  zero,uncert_not_
-00017ce0: 7a65 726f 203d 206e 6176 5f64 6174 612e  zero = nav_data.
-00017cf0: 6368 6563 6b50 6f73 6974 696f 6e73 436f  checkPositionsCo
-00017d00: 6e74 656e 7428 290a 0a20 2020 2020 2020  ntent()..       
-00017d10: 2020 2020 2023 2057 7269 7465 2074 6f20       # Write to 
-00017d20: 6e61 7669 6761 7469 6f6e 2074 7874 2066  navigation txt f
-00017d30: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-00017d40: 2320 6865 6164 6572 0a20 2020 2020 2020  # header.       
-00017d50: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
-00017d60: 7365 6c66 2e67 6574 5f69 6e74 5f6e 6176  self.get_int_nav
-00017d70: 5f66 696c 6528 292c 2022 7722 290a 2020  _file(), "w").  
-00017d80: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00017d90: 6974 6528 6d69 7174 762e 636f 6c5f 6865  ite(miqtv.col_he
-00017da0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00017db0: 696d 6727 5d2b 225c 7422 2b6d 6971 7476  img']+"\t"+miqtv
-00017dc0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00017dd0: 6971 7427 5d5b 2775 7463 275d 290a 0a20  iqt']['utc']).. 
-00017de0: 2020 2020 2020 2020 2020 2068 6173 5f61             has_a
-00017df0: 6c74 203d 2054 7275 6520 6966 2064 6570  lt = True if dep
-00017e00: 5f6e 6f74 5f7a 6572 6f20 616e 6420 2820  _not_zero and ( 
-00017e10: 2764 6570 2720 696e 206e 6176 5f68 6561  'dep' in nav_hea
-00017e20: 6465 7220 6f72 2027 616c 7427 2069 6e20  der or 'alt' in 
-00017e30: 6e61 765f 6865 6164 6572 2029 2065 6c73  nav_header ) els
-00017e40: 6520 4661 6c73 650a 0a20 2020 2020 2020  e False..       
-00017e50: 2020 2020 2069 6620 276c 6174 2720 696e       if 'lat' in
-00017e60: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
-00017e70: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00017e80: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
-00017e90: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00017ea0: 7269 7174 275d 5b27 6c61 7427 5d29 0a20  riqt']['lat']). 
-00017eb0: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
-00017ec0: 6f6e 2720 696e 206e 6176 5f68 6561 6465  on' in nav_heade
-00017ed0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00017ee0: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00017ef0: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00017f00: 6572 5b27 6d61 7269 7174 275d 5b27 6c6f  er['mariqt']['lo
-00017f10: 6e27 5d29 0a20 2020 2020 2020 2020 2020  n']).           
-00017f20: 2069 6620 6861 735f 616c 743a 0a20 2020   if has_alt:.   
-00017f30: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00017f40: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
-00017f50: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00017f60: 7269 7174 275d 5b27 616c 7427 5d29 0a20  riqt']['alt']). 
-00017f70: 2020 2020 2020 2020 2020 2069 6620 6867             if hg
-00017f80: 745f 6e6f 745f 7a65 726f 2061 6e64 2027  t_not_zero and '
-00017f90: 6867 7427 2069 6e20 6e61 765f 6865 6164  hgt' in nav_head
-00017fa0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00017fb0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00017fc0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00017fd0: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
-00017fe0: 6774 275d 290a 2020 2020 2020 2020 2020  gt']).          
-00017ff0: 2020 6966 2075 6e63 6572 745f 6e6f 745f    if uncert_not_
-00018000: 7a65 726f 2061 6e64 2027 756e 6365 7274  zero and 'uncert
-00018010: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
-00018020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018030: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
-00018040: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00018050: 5b27 6d61 7269 7174 275d 5b27 756e 6365  ['mariqt']['unce
-00018060: 7274 275d 290a 2020 2020 2020 2020 2020  rt']).          
-00018070: 2020 7265 732e 7772 6974 6528 225c 6e22    res.write("\n"
-00018080: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00018090: 6461 7461 206c 696e 6573 0a20 2020 2020  data lines.     
-000180a0: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
-000180b0: 696e 2069 6d61 6765 5f64 7473 3a0a 2020  in image_dts:.  
-000180c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000180d0: 7220 7469 6d65 706f 696e 7420 696e 2069  r timepoint in i
-000180e0: 6d61 6765 5f64 7473 5b66 696c 655d 3a0a  mage_dts[file]:.
-000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018100: 2020 2020 7265 732e 7772 6974 6528 6669      res.write(fi
-00018110: 6c65 2b22 5c74 222b 7469 6d65 706f 696e  le+"\t"+timepoin
-00018120: 742e 6461 7465 5469 6d65 2829 2e73 7472  t.dateTime().str
-00018130: 6674 696d 6528 6d69 7174 762e 6461 7465  ftime(miqtv.date
-00018140: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-00018150: 275d 2929 200a 2020 2020 2020 2020 2020  '])) .          
-00018160: 2020 2020 2020 2020 2020 6966 2027 6c61            if 'la
-00018170: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
-00018180: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018190: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-000181a0: 7469 6d65 706f 696e 742e 6c61 740a 2020  timepoint.lat.  
-000181b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181c0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-000181d0: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
-000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181f0: 2020 2069 6620 276c 6f6e 2720 696e 206e     if 'lon' in n
-00018200: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
-00018210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018220: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
-00018230: 6e74 2e6c 6f6e 0a20 2020 2020 2020 2020  nt.lon.         
-00018240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00018250: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
-00018260: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
-00018270: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-00018280: 6173 5f61 6c74 3a0a 2020 2020 2020 2020  as_alt:.        
-00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182a0: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
-000182b0: 6465 700a 2020 2020 2020 2020 2020 2020  dep.            
-000182c0: 2020 2020 2020 2020 2020 2020 2320 6465              # de
-000182d0: 7020 746f 2061 6c74 0a20 2020 2020 2020  p to alt.       
-000182e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182f0: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
-00018300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018310: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00018320: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
+00015550: 655f 6669 6c65 2022 2222 0a20 2020 2020  e_file """.     
+00015560: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
+00015570: 7265 6174 655f 696d 6167 655f 6174 7469  reate_image_atti
+00015580: 7475 6465 5f66 696c 6528 6174 745f 7061  tude_file(att_pa
+00015590: 7468 2c20 6672 616d 655f 6174 745f 6865  th, frame_att_he
+000155a0: 6164 6572 2c20 6361 6d65 7261 3246 7261  ader, camera2Fra
+000155b0: 6d65 5f79 6177 2c20 6361 6d65 7261 3246  me_yaw, camera2F
+000155c0: 7261 6d65 5f70 6974 6368 2c20 6361 6d65  rame_pitch, came
+000155d0: 7261 3246 7261 6d65 5f72 6f6c 6c2c 200a  ra2Frame_roll, .
+000155e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015600: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00015610: 6174 655f 666f 726d 6174 2c20 636f 6e73  ate_format, cons
+00015620: 745f 7661 6c75 6573 2c20 6f76 6572 7772  t_values, overwr
+00015630: 6974 652c 2063 6f6c 5f73 6570 6172 6174  ite, col_separat
+00015640: 6f72 2c20 6174 745f 7061 7468 5f61 6e67  or, att_path_ang
+00015650: 6c65 735f 696e 5f72 6164 2c20 7669 6465  les_in_rad, vide
+00015660: 6f53 616d 706c 6553 6563 6f6e 6473 2c0a  oSampleSeconds,.
+00015670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015690: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000156a0: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+000156b0: 6429 0a20 2020 2020 2020 200a 0a20 2020  d).        ..   
+000156c0: 2064 6566 2067 6574 5f52 5f63 616d 5374   def get_R_camSt
+000156d0: 6432 7574 6d28 7365 6c66 2c52 5f63 616d  d2utm(self,R_cam
+000156e0: 3266 7261 6d65 3a6e 702e 6172 7261 792c  2frame:np.array,
+000156f0: 525f 6672 616d 6532 6e65 643a 6e70 2e61  R_frame2ned:np.a
+00015700: 7272 6179 293a 0a20 2020 2020 2020 2022  rray):.        "
+00015710: 2222 2072 6574 7275 6e20 726f 7461 7469  "" retrun rotati
+00015720: 6f6e 206d 6174 7269 7820 5220 7472 616e  on matrix R tran
+00015730: 666f 726d 696e 6720 6672 6f6d 2063 616d  forming from cam
+00015740: 5374 643a 2028 782c 792c 7a20 3d20 7269  Std: (x,y,z = ri
+00015750: 6768 742c 6275 7474 6f6d 2c6c 696e 6520  ght,buttom,line 
+00015760: 6f66 2073 6967 6874 2920 746f 2075 746d  of sight) to utm
+00015770: 2028 782c 792c 7a20 3d20 6561 7374 696e   (x,y,z = eastin
+00015780: 672c 6e6f 7274 6869 6e67 2c75 7029 2022  g,northing,up) "
+00015790: 2222 0a20 2020 2020 2020 2052 5f63 616d  "".        R_cam
+000157a0: 6946 444f 3263 616d 5374 6420 3d20 6d69  iFDO2camStd = mi
+000157b0: 7174 672e 525f 5961 7750 6974 6368 526f  qtg.R_YawPitchRo
+000157c0: 6c6c 2839 302c 302c 3029 2023 2069 6e20  ll(90,0,0) # in 
+000157d0: 6946 444f 2063 616d 3a20 2878 2c79 2c7a  iFDO cam: (x,y,z
+000157e0: 203d 2074 6f70 2c72 6967 6874 2c6c 696e   = top,right,lin
+000157f0: 6520 6f66 2073 6967 6874 2920 6275 7420  e of sight) but 
+00015800: 666f 7220 706f 7365 2074 6865 2027 7374  for pose the 'st
+00015810: 616e 6461 7264 2720 6361 6d53 7464 3a20  andard' camStd: 
+00015820: 2878 2c79 2c7a 203d 2072 6967 6874 2c62  (x,y,z = right,b
+00015830: 7574 746f 6d2c 6c69 6e65 206f 6620 7369  uttom,line of si
+00015840: 6768 7429 2069 7320 6578 7065 6374 6564  ght) is expected
+00015850: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
+00015860: 6432 6672 616d 6520 3d20 525f 6361 6d32  d2frame = R_cam2
+00015870: 6672 616d 652e 646f 7428 525f 6361 6d69  frame.dot(R_cami
+00015880: 4644 4f32 6361 6d53 7464 290a 2020 2020  FDO2camStd).    
+00015890: 2020 2020 525f 6361 6d53 7464 326e 6564      R_camStd2ned
+000158a0: 203d 2052 5f66 7261 6d65 326e 6564 2e64   = R_frame2ned.d
+000158b0: 6f74 2852 5f63 616d 5374 6432 6672 616d  ot(R_camStd2fram
+000158c0: 6529 0a20 2020 2020 2020 2052 5f6e 6564  e).        R_ned
+000158d0: 3275 746d 203d 206d 6971 7467 2e52 5f58  2utm = miqtg.R_X
+000158e0: 595a 2831 3830 2c30 2c39 3029 2023 2077  YZ(180,0,90) # w
+000158f0: 6974 6820 7574 6d20 782c 792c 7a20 3d20  ith utm x,y,z = 
+00015900: 6561 7374 696e 672c 6e6f 7274 6869 6e67  easting,northing
+00015910: 2c75 700a 2020 2020 2020 2020 525f 6361  ,up.        R_ca
+00015920: 6d53 7464 3275 746d 203d 2052 5f6e 6564  mStd2utm = R_ned
+00015930: 3275 746d 2e64 6f74 2852 5f63 616d 5374  2utm.dot(R_camSt
+00015940: 6432 6e65 6429 2e72 6f75 6e64 2835 290a  d2ned).round(5).
+00015950: 2020 2020 2020 2020 7265 7475 726e 2052          return R
+00015960: 5f63 616d 5374 6432 7574 6d0a 0a0a 2020  _camStd2utm...  
+00015970: 2020 6465 6620 6669 6e64 4e61 7644 6174    def findNavDat
+00015980: 6146 6f72 496d 6167 6528 7365 6c66 2c64  aForImage(self,d
+00015990: 6174 613a 6d69 7174 672e 4e75 6d44 6174  ata:miqtg.NumDat
+000159a0: 6154 696d 6553 7461 6d70 6564 2c76 6964  aTimeStamped,vid
+000159b0: 656f 5361 6d70 6c65 5365 636f 6e64 733d  eoSampleSeconds=
+000159c0: 3129 3a0a 2020 2020 2020 2020 2222 2220  1):.        """ 
+000159d0: 6372 6561 7465 7320 6120 6469 6374 2028  creates a dict (
+000159e0: 696d 6167 655f 6474 7329 2077 6974 6820  image_dts) with 
+000159f0: 6669 6c65 206e 616d 6520 6173 206b 6579  file name as key
+00015a00: 2061 6e64 2061 206c 6973 7420 6f66 2064   and a list of d
+00015a10: 6174 6120 656c 656d 656e 7473 2061 7320  ata elements as 
+00015a20: 7661 6c75 652e 200a 2020 2020 2020 2020  value. .        
+00015a30: 2020 2020 496e 2063 6173 6520 6f66 2070      In case of p
+00015a40: 686f 746f 7320 7468 6520 6c69 7374 2068  hotos the list h
+00015a50: 6173 206f 6e6c 7920 6120 7369 6e67 6c65  as only a single
+00015a60: 2065 6e74 7279 2c20 666f 7220 7669 6465   entry, for vide
+00015a70: 6f73 2069 7420 6861 7320 7669 6465 6f20  os it has video 
+00015a80: 6475 7261 7469 6f6e 205b 7365 635d 202f  duration [sec] /
+00015a90: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
+00015aa0: 6e64 7320 656e 7472 6965 732e 0a20 2020  nds entries..   
+00015ab0: 2020 2020 2020 2020 2052 6574 7572 6e73           Returns
+00015ac0: 2073 7563 6365 7373 2c20 696d 6167 655f   success, image_
+00015ad0: 6474 732c 206d 7367 2022 2222 0a0a 2020  dts, msg """..  
+00015ae0: 2020 2020 2020 6966 2076 6964 656f 5361        if videoSa
+00015af0: 6d70 6c65 5365 636f 6e64 7320 3c3d 2030  mpleSeconds <= 0
+00015b00: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00015b10: 6973 6520 4578 6365 7074 696f 6e28 2266  ise Exception("f
+00015b20: 696e 644e 6176 4461 7461 466f 7249 6d61  indNavDataForIma
+00015b30: 6765 3a20 7669 6465 6f53 616d 706c 6553  ge: videoSampleS
+00015b40: 6563 6f6e 6473 206d 7573 7420 6265 2067  econds must be g
+00015b50: 7265 6174 6572 2030 2229 0a0a 2020 2020  reater 0")..    
+00015b60: 2020 2020 2320 6372 6561 7465 2073 6f72      # create sor
+00015b70: 7465 6420 7469 6d65 2070 6f69 6e74 730a  ted time points.
+00015b80: 2020 2020 2020 2020 7469 6d65 5f70 6f69          time_poi
+00015b90: 6e74 7320 3d20 6c69 7374 2864 6174 612e  nts = list(data.
+00015ba0: 6b65 7973 2829 290a 2020 2020 2020 2020  keys()).        
+00015bb0: 7469 6d65 5f70 6f69 6e74 732e 736f 7274  time_points.sort
+00015bc0: 2829 0a20 2020 2020 2020 2075 6e6d 6174  ().        unmat
+00015bd0: 6368 6564 5469 6d65 506f 696e 7473 203d  chedTimePoints =
+00015be0: 205b 5d0a 2020 2020 2020 2020 696d 6167   [].        imag
+00015bf0: 655f 6474 7320 3d20 7b7d 0a20 2020 2020  e_dts = {}.     
+00015c00: 2020 2073 7461 7274 5365 6172 6368 496e     startSearchIn
+00015c10: 6465 7820 3d20 300a 2020 2020 2020 2020  dex = 0.        
+00015c20: 696d 6167 6573 496e 5261 7720 3d20 2073  imagesInRaw =  s
+00015c30: 656c 662e 696d 6167 6573 496e 496d 6167  elf.imagesInImag
+00015c40: 6573 4469 7228 290a 2020 2020 2020 2020  esDir().        
+00015c50: 696d 6167 6573 496e 5261 7753 6f72 7465  imagesInRawSorte
+00015c60: 644c 6973 7420 3d20 7365 6c66 2e69 6d61  dList = self.ima
+00015c70: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
+00015c80: 7274 6564 4c69 7374 2829 0a20 2020 2020  rtedList().     
+00015c90: 2020 2070 726f 6720 3d20 6d69 7174 632e     prog = miqtc.
+00015ca0: 5072 696e 744b 6e6f 776e 5072 6f67 7265  PrintKnownProgre
+00015cb0: 7373 4d73 6728 2249 6e74 6572 706f 6c61  ssMsg("Interpola
+00015cc0: 7469 6e67 206e 6176 6967 6174 696f 6e20  ting navigation 
+00015cd0: 666f 7220 696d 6167 6522 2c20 6c65 6e28  for image", len(
+00015ce0: 696d 6167 6573 496e 5261 7729 2c6d 6f64  imagesInRaw),mod
+00015cf0: 756c 6f3d 3129 0a20 2020 2020 2020 2066  ulo=1).        f
+00015d00: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
+00015d10: 7349 6e52 6177 536f 7274 6564 4c69 7374  sInRawSortedList
+00015d20: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00015d30: 6f67 2e70 726f 6772 6573 7328 290a 2020  og.progress().  
+00015d40: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
+00015d50: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
+00015d60: 7365 6e61 6d65 2866 696c 6529 0a0a 2020  sename(file)..  
+00015d70: 2020 2020 2020 2020 2020 6474 5f69 6d61            dt_ima
+00015d80: 6765 203d 206d 6971 7463 2e70 6172 7365  ge = miqtc.parse
+00015d90: 4669 6c65 4461 7465 5469 6d65 4173 5554  FileDateTimeAsUT
+00015da0: 4328 6669 6c65 5f6e 616d 6529 0a20 2020  C(file_name).   
+00015db0: 2020 2020 2020 2020 2064 745f 696d 6167           dt_imag
+00015dc0: 655f 7473 203d 2069 6e74 2864 745f 696d  e_ts = int(dt_im
+00015dd0: 6167 652e 7469 6d65 7374 616d 7028 2920  age.timestamp() 
+00015de0: 2a20 3130 3030 290a 0a20 2020 2020 2020  * 1000)..       
+00015df0: 2020 2020 2072 756e 5469 6d65 203d 2069       runTime = i
+00015e00: 6d61 6765 7349 6e52 6177 5b66 696c 655d  magesInRaw[file]
+00015e10: 5b31 5d20 2320 2d31 2066 6f72 2070 686f  [1] # -1 for pho
+00015e20: 746f 730a 2020 2020 2020 2020 2020 2020  tos.            
+00015e30: 2320 7669 6465 6f0a 2020 2020 2020 2020  # video.        
+00015e40: 2020 2020 6966 2069 6d61 6765 7349 6e52      if imagesInR
+00015e50: 6177 5b66 696c 655d 5b32 5d20 696e 206d  aw[file][2] in m
+00015e60: 6971 7476 2e76 6964 656f 5f74 7970 6573  iqtv.video_types
+00015e70: 2061 6e64 2072 756e 5469 6d65 203c 3d20   and runTime <= 
+00015e80: 303a 2023 2065 7874 0a20 2020 2020 2020  0: # ext.       
+00015e90: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00015ea0: 4361 7574 696f 6e21 2043 6f75 6c64 206e  Caution! Could n
+00015eb0: 6f74 2072 6561 6420 7669 6465 6f20 7275  ot read video ru
+00015ec0: 6e20 7469 6d65 2066 726f 6d20 6669 6c65  n time from file
+00015ed0: 222c 6669 6c65 2920 2320 544f 444f 2064  ",file) # TODO d
+00015ee0: 6f65 7320 7468 6973 2068 6170 7065 6e3f  oes this happen?
+00015ef0: 2048 616e 646c 6520 6265 7474 6572 3f0a   Handle better?.
+00015f00: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
+00015f10: 706c 6554 696d 6553 6563 7320 3d20 300a  pleTimeSecs = 0.
+00015f20: 2020 2020 2020 2020 2020 2020 706f 735f              pos_
+00015f30: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
+00015f40: 2020 2020 2020 676f 203d 2054 7275 650a        go = True.
+00015f50: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00015f60: 6520 676f 3a0a 2020 2020 2020 2020 2020  e go:.          
+00015f70: 2020 2020 2020 7472 793a 2020 2020 2020        try:      
+00015f80: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00015f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015fa0: 2020 2070 6f73 2c20 7374 6172 7453 6561     pos, startSea
+00015fb0: 7263 6849 6e64 6578 203d 2064 6174 612e  rchIndex = data.
+00015fc0: 696e 7465 7270 6f6c 6174 6541 7454 696d  interpolateAtTim
+00015fd0: 6528 6474 5f69 6d61 6765 5f74 7320 2b20  e(dt_image_ts + 
+00015fe0: 7361 6d70 6c65 5469 6d65 5365 6373 202a  sampleTimeSecs *
+00015ff0: 2031 3030 302c 7469 6d65 5f70 6f69 6e74   1000,time_point
+00016000: 732c 7374 6172 7453 6561 7263 6849 6e64  s,startSearchInd
+00016010: 6578 290a 2020 2020 2020 2020 2020 2020  ex).            
+00016020: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00016030: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00016040: 6e74 6572 706f 6c61 7465 4174 5469 6d65  nterpolateAtTime
+00016050: 2072 6574 7572 6e73 204e 6f6e 6520 7661   returns None va
+00016060: 6c75 6573 2069 6620 7469 6d65 206f 7574  lues if time out
+00016070: 206f 6620 7261 6e67 650a 2020 2020 2020   of range.      
+00016080: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00016090: 2070 6f73 2e63 6f74 6169 6e73 4e6f 6e65   pos.cotainsNone
+000160a0: 5661 6c75 6573 496e 5265 7175 6972 6564  ValuesInRequired
+000160b0: 4669 656c 6473 2829 3a0a 2020 2020 2020  Fields():.      
+000160c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160d0: 2020 756e 6d61 7463 6865 6454 696d 6550    unmatchedTimeP
+000160e0: 6f69 6e74 732e 6170 7065 6e64 2828 6474  oints.append((dt
+000160f0: 5f69 6d61 6765 5f74 7320 2b20 7361 6d70  _image_ts + samp
+00016100: 6c65 5469 6d65 5365 6373 202a 2031 3030  leTimeSecs * 100
+00016110: 3029 2f31 3030 3029 0a20 2020 2020 2020  0)/1000).       
+00016120: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00016130: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00016140: 2020 2020 2020 2020 2020 2070 6f73 5f6c             pos_l
+00016150: 6973 742e 6170 7065 6e64 2870 6f73 290a  ist.append(pos).
+00016160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016170: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00016180: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00016190: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000161a0: 6e20 4661 6c73 652c 2069 6d61 6765 5f64  n False, image_d
+000161b0: 7473 2c20 2243 6f75 6c64 206e 6f74 2066  ts, "Could not f
+000161c0: 696e 6420 696d 6167 6520 7469 6d65 2022  ind image time "
+000161d0: 2b20 6461 7465 7469 6d65 2e64 6174 6574  + datetime.datet
+000161e0: 696d 652e 7574 6366 726f 6d74 696d 6573  ime.utcfromtimes
+000161f0: 7461 6d70 2828 6474 5f69 6d61 6765 5f74  tamp((dt_image_t
+00016200: 7320 2b20 7361 6d70 6c65 5469 6d65 5365  s + sampleTimeSe
+00016210: 6373 202a 2031 3030 3029 2f31 3030 3029  cs * 1000)/1000)
+00016220: 2e73 7472 6674 696d 6528 6d69 7174 762e  .strftime(miqtv.
+00016230: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+00016240: 7269 7174 275d 2920 2b22 2069 6e20 222b  riqt']) +" in "+
+00016250: 7374 7228 6461 7461 2e6c 656e 2829 292b  str(data.len())+
+00016260: 2220 6461 7461 2070 6f73 6974 696f 6e73  " data positions
+00016270: 2220 2b20 7374 7228 652e 6172 6773 290a  " + str(e.args).
+00016280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016290: 7361 6d70 6c65 5469 6d65 5365 6373 202b  sampleTimeSecs +
+000162a0: 3d20 7669 6465 6f53 616d 706c 6553 6563  = videoSampleSec
+000162b0: 6f6e 6473 0a20 2020 2020 2020 2020 2020  onds.           
+000162c0: 2020 2020 2069 6620 7361 6d70 6c65 5469       if sampleTi
+000162d0: 6d65 5365 6373 203e 2072 756e 5469 6d65  meSecs > runTime
+000162e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000162f0: 2020 2020 2020 676f 203d 2046 616c 7365        go = False
+00016300: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
+00016310: 2020 2020 2020 2020 2020 696d 6167 655f            image_
+00016320: 6474 735b 6669 6c65 5f6e 616d 655d 203d  dts[file_name] =
+00016330: 2070 6f73 5f6c 6973 740a 2020 2020 2020   pos_list.      
+00016340: 2020 7072 6f67 2e63 6c65 6172 2829 0a20    prog.clear(). 
+00016350: 2020 2020 2020 2072 6574 7572 6e4d 7367         returnMsg
+00016360: 203d 2022 220a 2020 2020 2020 2020 6966   = "".        if
+00016370: 206c 656e 2875 6e6d 6174 6368 6564 5469   len(unmatchedTi
+00016380: 6d65 506f 696e 7473 2920 213d 2030 3a0a  mePoints) != 0:.
+00016390: 2020 2020 2020 2020 2020 2020 756e 6d61              unma
+000163a0: 7463 6865 6454 696d 6550 6f69 6e74 732e  tchedTimePoints.
+000163b0: 736f 7274 2829 0a20 2020 2020 2020 2020  sort().         
+000163c0: 2020 2075 6e6d 6174 6368 6564 5469 6d65     unmatchedTime
+000163d0: 506f 696e 7473 203d 205b 6461 7465 7469  Points = [dateti
+000163e0: 6d65 2e64 6174 6574 696d 652e 7574 6366  me.datetime.utcf
+000163f0: 726f 6d74 696d 6573 7461 6d70 2874 7329  romtimestamp(ts)
+00016400: 2e73 7472 6674 696d 6528 6d69 7174 762e  .strftime(miqtv.
+00016410: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+00016420: 7269 7174 275d 2920 666f 7220 7473 2069  riqt']) for ts i
+00016430: 6e20 756e 6d61 7463 6865 6454 696d 6550  n unmatchedTimeP
+00016440: 6f69 6e74 735d 0a20 2020 2020 2020 2020  oints].         
+00016450: 2020 2072 6574 7572 6e4d 7367 203d 2022     returnMsg = "
+00016460: 4361 7574 696f 6e21 204e 6176 6967 6174  Caution! Navigat
+00016470: 696f 6e20 6e6f 7420 666f 756e 6420 666f  ion not found fo
+00016480: 7220 7468 6520 666f 6c6c 6f77 696e 6720  r the following 
+00016490: 696d 6167 6520 7469 6d65 2070 6f69 6e74  image time point
+000164a0: 732e 2044 6f75 626c 6520 6368 6563 6b20  s. Double check 
+000164b0: 6f72 2070 726f 7669 6465 2061 7420 6c65  or provide at le
+000164c0: 6173 7420 7374 6174 6963 2064 6566 6175  ast static defau
+000164d0: 6c74 206e 6176 6967 6174 696f 6e20 696e  lt navigation in
+000164e0: 2068 6561 6465 7220 6669 656c 6473 2e22   header fields."
+000164f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00016500: 7572 6e4d 7367 202b 3d20 225c 6e22 202b  urnMsg += "\n" +
+00016510: 2022 5c6e 222e 6a6f 696e 2875 6e6d 6174   "\n".join(unmat
+00016520: 6368 6564 5469 6d65 506f 696e 7473 290a  chedTimePoints).
+00016530: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00016540: 7275 652c 2069 6d61 6765 5f64 7473 2c20  rue, image_dts, 
+00016550: 7265 7475 726e 4d73 670a 0a0a 2020 2020  returnMsg...    
+00016560: 6465 6620 6372 6561 7465 5f69 6d61 6765  def create_image
+00016570: 5f6e 6176 6967 6174 696f 6e5f 6669 6c65  _navigation_file
+00016580: 2873 656c 662c 206e 6176 5f70 6174 683a  (self, nav_path:
+00016590: 2073 7472 2c20 6e61 765f 6865 6164 6572   str, nav_header
+000165a0: 3d6d 6971 7476 2e70 6f73 5f68 6561 6465  =miqtv.pos_heade
+000165b0: 725b 2770 616e 6761 6561 275d 2c20 6461  r['pangaea'], da
+000165c0: 7465 5f66 6f72 6d61 743d 6d69 7174 762e  te_format=miqtv.
+000165d0: 6461 7465 5f66 6f72 6d61 7473 5b27 7061  date_formats['pa
+000165e0: 6e67 6165 6127 5d2c 206f 7665 7277 7269  ngaea'], overwri
+000165f0: 7465 3d46 616c 7365 2c20 636f 6c5f 7365  te=False, col_se
+00016600: 7061 7261 746f 7220 3d20 225c 7422 2c20  parator = "\t", 
+00016610: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
+00016620: 6473 3d31 2c0a 2020 2020 2020 2020 2020  ds=1,.          
+00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016640: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
+00016650: 5f78 3d30 2c20 6f66 6673 6574 5f79 3d30  _x=0, offset_y=0
+00016660: 2c20 6f66 6673 6574 5f7a 3d30 2c61 6e67  , offset_z=0,ang
+00016670: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
+00016680: 7365 2c20 7265 636f 7264 7332 6265 496e  se, records2beIn
+00016690: 7665 7274 6564 3d5b 5d29 3a0a 2020 2020  verted=[]):.    
+000166a0: 2020 2020 2222 2220 4372 6561 7465 7320      """ Creates 
+000166b0: 696e 202f 696e 7465 726d 6564 6961 7465  in /intermediate
+000166c0: 2061 2074 6578 7420 6669 6c65 2077 6974   a text file wit
+000166d0: 6820 342e 3544 206e 6176 6967 6174 696f  h 4.5D navigatio
+000166e0: 6e20 6461 7461 2066 6f72 2065 6163 6820  n data for each 
+000166f0: 696d 6167 652c 2069 2e65 2e20 6120 7369  image, i.e. a si
+00016700: 6e67 6c65 2072 6f77 2070 6572 2070 686f  ngle row per pho
+00016710: 746f 2c20 7669 6465 6f20 6475 7261 7469  to, video durati
+00016720: 6f6e 205b 7365 635d 202f 2076 6964 656f  on [sec] / video
+00016730: 5361 6d70 6c65 5365 636f 6e64 7320 726f  SampleSeconds ro
+00016740: 7773 2070 6572 2076 6964 656f 2e0a 2020  ws per video..  
+00016750: 2020 2020 2020 2020 2020 6e61 765f 6865            nav_he
+00016760: 6164 6572 206d 7573 7420 6265 2064 6963  ader must be dic
+00016770: 7420 636f 6e74 6169 6e69 6e67 2074 6865  t containing the
+00016780: 206b 6579 7320 2775 7463 272c 276c 6174   keys 'utc','lat
+00016790: 272c 276c 6f6e 272c 2764 6570 2728 6f72  ','lon','dep'(or
+000167a0: 2027 616c 7427 292c 206f 7074 696f 6e61   'alt'), optiona
+000167b0: 6c3a 2027 6867 7427 2c27 756e 6365 7274  l: 'hgt','uncert
+000167c0: 2720 7769 7468 2074 6865 2072 6573 7065  ' with the respe
+000167d0: 6374 6976 6520 636f 6c75 6d6e 2068 6561  ctive column hea
+000167e0: 6465 7273 2061 7320 7661 6c75 6573 200a  ders as values .
+000167f0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00016800: 6e65 206f 6620 7468 6520 7665 6869 636c  ne of the vehicl
+00016810: 6520 782c 792c 7a20 6f66 6673 6574 7320  e x,y,z offsets 
+00016820: 5b6d 5d20 6973 206e 6f74 2030 2061 6e64  [m] is not 0 and
+00016830: 206e 6176 5f68 6561 6465 7220 616c 736f   nav_header also
+00016840: 2063 6f6e 7461 696e 7320 2779 6177 272c   contains 'yaw',
+00016850: 2770 6974 6368 272c 2772 6f6c 6c27 206c  'pitch','roll' l
+00016860: 6576 6572 6172 6d20 6f66 6673 6574 7320  everarm offsets 
+00016870: 6172 6520 636f 6d70 656e 7361 7465 6420  are compensated 
+00016880: 666f 7220 2222 220a 0a20 2020 2020 2020  for """..       
+00016890: 2069 6620 7365 6c66 2e69 6e74 6572 6d65   if self.interme
+000168a0: 6469 6174 654e 6176 4669 6c65 4578 6973  diateNavFileExis
+000168b0: 7473 2829 2061 6e64 206e 6f74 206f 7665  ts() and not ove
+000168c0: 7277 7269 7465 3a0a 2020 2020 2020 2020  rwrite:.        
+000168d0: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
+000168e0: 2022 4f75 7470 7574 2066 696c 6520 6578   "Output file ex
+000168f0: 6973 7473 3a20 222b 7365 6c66 2e67 6574  ists: "+self.get
+00016900: 5f69 6e74 5f6e 6176 5f66 696c 6528 290a  _int_nav_file().
+00016910: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00016920: 6f73 2e70 6174 682e 6578 6973 7473 286e  os.path.exists(n
+00016930: 6176 5f70 6174 6829 3a0a 2020 2020 2020  av_path):.      
+00016940: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00016950: 7365 2c20 224e 6176 6967 6174 696f 6e20  se, "Navigation 
+00016960: 6669 6c65 206e 6f74 2066 6f75 6e64 3a20  file not found: 
+00016970: 222b 6e61 765f 7061 7468 0a0a 2020 2020  "+nav_path..    
+00016980: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+00016990: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
+000169a0: 6d61 6765 7344 6972 293a 0a20 2020 2020  magesDir):.     
+000169b0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000169c0: 6c73 652c 2022 496d 6167 6520 666f 6c64  lse, "Image fold
+000169d0: 6572 206e 6f74 2066 6f75 6e64 3a20 222b  er not found: "+
+000169e0: 2073 656c 662e 696d 6167 6573 4469 720a   self.imagesDir.
+000169f0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
+00016a00: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
+00016a10: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
+00016a20: 6d73 2720 6e61 7669 6761 7469 6f6e 2064  ms' navigation d
+00016a30: 6174 6122 290a 2020 2020 2020 2020 7265  ata").        re
+00016a40: 7475 726e 4d73 6720 3d20 2222 0a20 2020  turnMsg = "".   
+00016a50: 2020 2020 2063 6f6d 7065 6e73 6174 4f66       compensatOf
+00016a60: 6673 6574 7320 3d20 4661 6c73 650a 2020  fsets = False.  
+00016a70: 2020 2020 2020 6966 2028 6f66 6673 6574        if (offset
+00016a80: 5f78 213d 3020 6f72 206f 6666 7365 745f  _x!=0 or offset_
+00016a90: 7921 3d30 206f 7220 6f66 6673 6574 5f7a  y!=0 or offset_z
+00016aa0: 213d 3029 2061 6e64 2027 7961 7727 2069  !=0) and 'yaw' i
+00016ab0: 6e20 6e61 765f 6865 6164 6572 2061 6e64  n nav_header and
+00016ac0: 2027 7069 7463 6827 2069 6e20 6e61 765f   'pitch' in nav_
+00016ad0: 6865 6164 6572 2061 6e64 2027 726f 6c6c  header and 'roll
+00016ae0: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+00016af0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+00016b00: 7065 6e73 6174 4f66 6673 6574 7320 3d20  pensatOffsets = 
+00016b10: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
+00016b20: 6368 6563 6b20 6966 2066 6f72 206d 6973  check if for mis
+00016b30: 7369 6e67 2066 6965 6c64 7320 7468 6572  sing fields ther
+00016b40: 6520 6172 6520 636f 6e73 7420 7661 6c75  e are const valu
+00016b50: 6573 2069 6e20 6865 6164 6572 0a20 2020  es in header.   
+00016b60: 2020 2020 2063 6f6e 7374 5f76 616c 7565       const_value
+00016b70: 7320 3d20 7b7d 0a20 2020 2020 2020 2066  s = {}.        f
+00016b80: 6f72 206e 6176 4669 656c 6420 696e 206d  or navField in m
+00016b90: 6971 7476 2e70 6f73 5f68 6561 6465 725b  iqtv.pos_header[
+00016ba0: 276d 6172 6971 7427 5d3a 0a20 2020 2020  'mariqt']:.     
+00016bb0: 2020 2020 2020 2072 6573 7065 6374 6976         respectiv
+00016bc0: 6548 6561 6465 7246 6965 6c64 203d 206d  eHeaderField = m
+00016bd0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00016be0: 226d 6172 6971 7422 5d5b 6e61 7646 6965  "mariqt"][navFie
+00016bf0: 6c64 5d0a 2020 2020 2020 2020 2020 2020  ld].            
+00016c00: 6966 206e 6176 4669 656c 6420 6e6f 7420  if navField not 
+00016c10: 696e 206e 6176 5f68 6561 6465 7220 616e  in nav_header an
+00016c20: 6420 2872 6573 7065 6374 6976 6548 6561  d (respectiveHea
+00016c30: 6465 7246 6965 6c64 2069 6e20 7365 6c66  derField in self
+00016c40: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00016c50: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+00016c60: 5d20 616e 6420 7365 6c66 2e66 696e 6454  ] and self.findT
+00016c70: 6d70 4669 656c 6432 2872 6573 7065 6374  mpField2(respect
+00016c80: 6976 6548 6561 6465 7246 6965 6c64 2920  iveHeaderField) 
+00016c90: 213d 2022 2229 3a20 0a20 2020 2020 2020  != ""): .       
+00016ca0: 2020 2020 2020 2020 2063 6f6e 7374 5f76           const_v
+00016cb0: 616c 7565 735b 6e61 7646 6965 6c64 5d20  alues[navField] 
+00016cc0: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
+00016cd0: 656c 6428 7265 7370 6563 7469 7665 4865  eld(respectiveHe
+00016ce0: 6164 6572 4669 656c 6429 0a0a 2020 2020  aderField)..    
+00016cf0: 2020 2020 2023 2068 616e 646c 6520 616c       # handle al
+00016d00: 7420 7673 2064 6570 0a20 2020 2020 2020  t vs dep.       
+00016d10: 2069 6620 2761 6c74 2720 696e 206e 6176   if 'alt' in nav
+00016d20: 5f68 6561 6465 7220 616e 6420 2764 6570  _header and 'dep
+00016d30: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+00016d40: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00016d50: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+00016d60: 6570 7469 6f6e 2822 2761 6c74 2720 616e  eption("'alt' an
+00016d70: 6420 2764 6570 2720 7072 6f76 6964 6564  d 'dep' provided
+00016d80: 2e20 5265 6475 6e64 616e 742c 2061 6c74  . Redundant, alt
+00016d90: 203d 202d 2064 6570 2e20 5072 6f76 6964   = - dep. Provid
+00016da0: 6564 206f 6e6c 7920 6f6e 6520 6f66 2062  ed only one of b
+00016db0: 6f74 682e 2229 0a20 2020 2020 2020 200a  oth.").        .
+00016dc0: 2020 2020 2020 2020 2320 4c6f 6164 206e          # Load n
+00016dd0: 6176 6967 6174 696f 6e20 6461 7461 2028  avigation data (
+00016de0: 6966 2027 616c 7427 2069 6e73 7465 6164  if 'alt' instead
+00016df0: 206f 6620 2764 6570 272c 2069 7473 2061   of 'dep', its a
+00016e00: 7574 6f6d 6174 6963 616c 6c79 2069 6e76  utomatically inv
+00016e10: 6572 7465 6429 0a20 2020 2020 2020 206e  erted).        n
+00016e20: 6176 5f64 6174 612c 2070 6172 7365 4d73  av_data, parseMs
+00016e30: 6720 3d20 6d69 7174 6e2e 7265 6164 416c  g = miqtn.readAl
+00016e40: 6c50 6f73 6974 696f 6e73 4672 6f6d 4669  lPositionsFromFi
+00016e50: 6c65 5061 7468 286e 6176 5f70 6174 682c  lePath(nav_path,
+00016e60: 206e 6176 5f68 6561 6465 722c 2064 6174   nav_header, dat
+00016e70: 655f 666f 726d 6174 2c63 6f6c 5f73 6570  e_format,col_sep
+00016e80: 6172 6174 6f72 3d63 6f6c 5f73 6570 6172  arator=col_separ
+00016e90: 6174 6f72 2c63 6f6e 7374 5f76 616c 7565  ator,const_value
+00016ea0: 733d 636f 6e73 745f 7661 6c75 6573 290a  s=const_values).
+00016eb0: 2020 2020 2020 2020 6966 2070 6172 7365          if parse
+00016ec0: 4d73 6720 213d 2022 223a 0a20 2020 2020  Msg != "":.     
+00016ed0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00016ee0: 2e6c 6f67 2870 6172 7365 4d73 672c 646f  .log(parseMsg,do
+00016ef0: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
+00016f00: 2020 2020 2020 2020 2072 6574 7572 6e4d           returnM
+00016f10: 7367 203d 2022 5c6e 2220 2b20 7061 7273  sg = "\n" + pars
+00016f20: 654d 7367 0a0a 2020 2020 2020 2020 2320  eMsg..        # 
+00016f30: 6669 6e64 2066 6f72 2065 6163 6820 696d  find for each im
+00016f40: 6167 6520 7468 6520 7265 7370 6563 7469  age the respecti
+00016f50: 7665 206e 6176 6967 6174 696f 6e20 6461  ve navigation da
+00016f60: 7461 0a20 2020 2020 2020 2073 2e73 746f  ta.        s.sto
+00016f70: 7028 290a 2020 2020 2020 2020 7375 6363  p().        succ
+00016f80: 6573 732c 2069 6d61 6765 5f64 7473 2c20  ess, image_dts, 
+00016f90: 6d73 6720 3d20 7365 6c66 2e66 696e 644e  msg = self.findN
+00016fa0: 6176 4461 7461 466f 7249 6d61 6765 286e  avDataForImage(n
+00016fb0: 6176 5f64 6174 612c 7669 6465 6f53 616d  av_data,videoSam
+00016fc0: 706c 6553 6563 6f6e 6473 290a 2020 2020  pleSeconds).    
+00016fd0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00016fe0: 6728 6d73 672c 646f 6e74 5368 6f77 3d54  g(msg,dontShow=T
+00016ff0: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
+00017000: 6d73 6720 213d 2022 223a 0a20 2020 2020  msg != "":.     
+00017010: 2020 2020 2020 2072 6574 7572 6e4d 7367         returnMsg
+00017020: 202b 3d20 225c 6e22 202b 206d 7367 0a20   += "\n" + msg. 
+00017030: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
+00017040: 6363 6573 733a 0a20 2020 2020 2020 2020  ccess:.         
+00017050: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00017060: 2072 6574 7572 6e4d 7367 0a20 2020 2020   returnMsg.     
+00017070: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
+00017080: 6e74 4c6f 6164 696e 674d 7367 2822 4372  ntLoadingMsg("Cr
+00017090: 6561 7469 6e67 2069 7465 6d73 2720 6e61  eating items' na
+000170a0: 7669 6761 7469 6f6e 2064 6174 6122 290a  vigation data").
+000170b0: 0a20 2020 2020 2020 2023 2069 6e76 6572  .        # inver
+000170c0: 7420 7661 6c75 6573 2028 6966 206e 6565  t values (if nee
+000170d0: 6465 6429 2062 6566 6f72 6520 6c65 7665  ded) before leve
+000170e0: 7261 726d 2063 6f6d 7065 6e73 6174 696f  rarm compensatio
+000170f0: 6e0a 2020 2020 2020 2020 6966 2072 6563  n.        if rec
+00017100: 6f72 6473 3262 6549 6e76 6572 7465 6420  ords2beInverted 
+00017110: 213d 205b 5d3a 0a20 2020 2020 2020 2020  != []:.         
+00017120: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
+00017130: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
+00017140: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00017150: 6f6e 7320 3d20 696d 6167 655f 6474 735b  ons = image_dts[
+00017160: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
+00017170: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00017180: 616e 6765 286c 656e 2870 6f73 6974 696f  ange(len(positio
+00017190: 6e73 2929 3a0a 2020 2020 2020 2020 2020  ns)):.          
+000171a0: 2020 2020 2020 2020 2020 6966 2027 6c61            if 'la
+000171b0: 7427 2069 6e20 7265 636f 7264 7332 6265  t' in records2be
+000171c0: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
+000171d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171e0: 2020 706f 7369 7469 6f6e 735b 695d 2e6c    positions[i].l
+000171f0: 6174 202a 3d20 2d31 0a20 2020 2020 2020  at *= -1.       
+00017200: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00017210: 276c 6f6e 2720 696e 2072 6563 6f72 6473  'lon' in records
+00017220: 3262 6549 6e76 6572 7465 643a 0a20 2020  2beInverted:.   
+00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017240: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
+00017250: 5d2e 6c6f 6e20 2a3d 202d 310a 2020 2020  ].lon *= -1.    
+00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017270: 6966 2028 2764 6570 2720 696e 2072 6563  if ('dep' in rec
+00017280: 6f72 6473 3262 6549 6e76 6572 7465 6420  ords2beInverted 
+00017290: 616e 6420 2764 6570 2720 696e 206e 6176  and 'dep' in nav
+000172a0: 5f68 6561 6465 7229 206f 7220 2827 616c  _header) or ('al
+000172b0: 7427 2069 6e20 7265 636f 7264 7332 6265  t' in records2be
+000172c0: 496e 7665 7274 6564 2061 6e64 2027 616c  Inverted and 'al
+000172d0: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
+000172e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000172f0: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
+00017300: 696f 6e73 5b69 5d2e 6465 7020 2a3d 202d  ions[i].dep *= -
+00017310: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00017320: 2020 2020 2020 6966 2027 6867 7427 2069        if 'hgt' i
+00017330: 6e20 7265 636f 7264 7332 6265 496e 7665  n records2beInve
+00017340: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
+00017350: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00017360: 7369 7469 6f6e 735b 695d 2e68 6774 202a  sitions[i].hgt *
+00017370: 3d20 2d31 0a0a 0a20 2020 2020 2020 2023  = -1...        #
+00017380: 2063 6f6d 7065 6e73 6174 6520 6c65 7665   compensate leve
+00017390: 7261 726d 206f 6666 7365 7473 0a20 2020  rarm offsets.   
+000173a0: 2020 2020 2069 6620 636f 6d70 656e 7361       if compensa
+000173b0: 744f 6666 7365 7473 3a0a 0a20 2020 2020  tOffsets:..     
+000173c0: 2020 2020 2020 2023 206c 6f61 6420 6672         # load fr
+000173d0: 616d 6520 6174 7469 7475 6465 2064 6174  ame attitude dat
+000173e0: 6120 6672 6f6d 2066 696c 650a 2020 2020  a from file.    
+000173f0: 2020 2020 2020 2020 6174 745f 6461 7461          att_data
+00017400: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
+00017410: 746e 2e72 6561 6441 6c6c 4174 7469 7475  tn.readAllAttitu
+00017420: 6465 7346 726f 6d46 696c 6550 6174 6828  desFromFilePath(
+00017430: 6e61 765f 7061 7468 2c20 6e61 765f 6865  nav_path, nav_he
+00017440: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
+00017450: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
+00017460: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
+00017470: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
+00017480: 5f76 616c 7565 732c 616e 676c 6573 496e  _values,anglesIn
+00017490: 5261 643d 616e 676c 6573 5f69 6e5f 7261  Rad=angles_in_ra
+000174a0: 6429 0a20 2020 2020 2020 2020 2020 2069  d).            i
+000174b0: 6620 7061 7273 654d 7367 2021 3d20 2222  f parseMsg != ""
+000174c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000174d0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+000174e0: 7061 7273 654d 7367 2c64 6f6e 7453 686f  parseMsg,dontSho
+000174f0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
+00017500: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
+00017510: 6720 2b3d 2022 5c6e 2220 2b20 7061 7273  g += "\n" + pars
+00017520: 654d 7367 0a0a 2020 2020 2020 2020 2020  eMsg..          
+00017530: 2020 6966 2072 6563 6f72 6473 3262 6549    if records2beI
+00017540: 6e76 6572 7465 6420 213d 205b 5d3a 0a20  nverted != []:. 
+00017550: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00017560: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
+00017570: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
+00017580: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+00017590: 6465 7320 3d20 696d 6167 655f 6474 735f  des = image_dts_
+000175a0: 6174 745b 6669 6c65 5d0a 2020 2020 2020  att[file].      
+000175b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000175c0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+000175d0: 2870 6f73 6974 696f 6e73 2929 3a0a 2020  (positions)):.  
+000175e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175f0: 2020 2020 2020 6966 2027 7961 7727 2069        if 'yaw' i
+00017600: 6e20 2072 6563 6f72 6473 3262 6549 6e76  n  records2beInv
+00017610: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
+00017620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017630: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
+00017640: 7961 7720 2a3d 202d 310a 2020 2020 2020  yaw *= -1.      
+00017650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017660: 2020 6966 2027 7069 7463 6827 2069 6e20    if 'pitch' in 
+00017670: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+00017680: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
+00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176a0: 2061 7474 6974 7564 6573 5b69 5d2e 7069   attitudes[i].pi
+000176b0: 7463 6820 2a3d 202d 310a 2020 2020 2020  tch *= -1.      
+000176c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176d0: 2020 6966 2027 726f 6c6c 2720 696e 2020    if 'roll' in  
+000176e0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+000176f0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00017700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017710: 6174 7469 7475 6465 735b 695d 2e72 6f6c  attitudes[i].rol
+00017720: 6c20 2a3d 202d 310a 0a20 2020 2020 2020  l *= -1..       
+00017730: 2020 2020 2023 2066 696e 6420 666f 7220       # find for 
+00017740: 6561 6368 2069 6d61 6765 2074 6865 2072  each image the r
+00017750: 6573 7065 6374 6976 6520 6e61 7669 6761  espective naviga
+00017760: 7469 6f6e 2064 6174 610a 2020 2020 2020  tion data.      
+00017770: 2020 2020 2020 7375 6363 6573 732c 2069        success, i
+00017780: 6d61 6765 5f64 7473 5f61 7474 2c20 6d73  mage_dts_att, ms
+00017790: 6720 3d20 7365 6c66 2e66 696e 644e 6176  g = self.findNav
+000177a0: 4461 7461 466f 7249 6d61 6765 2861 7474  DataForImage(att
+000177b0: 5f64 6174 612c 7669 6465 6f53 616d 706c  _data,videoSampl
+000177c0: 6553 6563 6f6e 6473 290a 2020 2020 2020  eSeconds).      
+000177d0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+000177e0: 6c6f 6728 6d73 672c 646f 6e74 5368 6f77  log(msg,dontShow
+000177f0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00017800: 2020 2069 6620 6d73 6720 213d 2022 223a     if msg != "":
+00017810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017820: 2072 6574 7572 6e4d 7367 202b 3d20 225c   returnMsg += "\
+00017830: 6e22 202b 206d 7367 0a20 2020 2020 2020  n" + msg.       
+00017840: 2020 2020 2069 6620 6e6f 7420 7375 6363       if not succ
+00017850: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
+00017860: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00017870: 652c 2072 6574 7572 6e4d 7367 0a0a 2020  e, returnMsg..  
+00017880: 2020 2020 2020 2020 2020 2320 636f 6d70            # comp
+00017890: 656e 7361 7465 0a20 2020 2020 2020 2020  ensate.         
+000178a0: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
+000178b0: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
+000178c0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+000178d0: 6f6e 7320 3d20 696d 6167 655f 6474 735b  ons = image_dts[
+000178e0: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
+000178f0: 2020 2020 2020 6174 7469 7475 6465 7320        attitudes 
+00017900: 3d20 696d 6167 655f 6474 735f 6174 745b  = image_dts_att[
+00017910: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
+00017920: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00017930: 616e 6765 286c 656e 2870 6f73 6974 696f  ange(len(positio
+00017940: 6e73 2929 3a0a 2020 2020 2020 2020 2020  ns)):.          
+00017950: 2020 2020 2020 2020 2020 6c61 7420 3d20            lat = 
+00017960: 706f 7369 7469 6f6e 735b 695d 2e6c 6174  positions[i].lat
+00017970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017980: 2020 2020 206c 6f6e 203d 2070 6f73 6974       lon = posit
+00017990: 696f 6e73 5b69 5d2e 6c6f 6e0a 2020 2020  ions[i].lon.    
+000179a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179b0: 6465 7020 3d20 706f 7369 7469 6f6e 735b  dep = positions[
+000179c0: 695d 2e64 6570 0a20 2020 2020 2020 2020  i].dep.         
+000179d0: 2020 2020 2020 2020 2020 2079 6177 203d             yaw =
+000179e0: 2061 7474 6974 7564 6573 5b69 5d2e 7961   attitudes[i].ya
+000179f0: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
+00017a00: 2020 2020 2020 7069 7463 6820 3d20 6174        pitch = at
+00017a10: 7469 7475 6465 735b 695d 2e70 6974 6368  titudes[i].pitch
+00017a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017a30: 2020 2020 2072 6f6c 6c20 3d20 6174 7469       roll = atti
+00017a40: 7475 6465 735b 695d 2e72 6f6c 6c0a 2020  tudes[i].roll.  
+00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a60: 2020 6966 2079 6177 2069 7320 4e6f 6e65    if yaw is None
+00017a70: 206f 7220 7069 7463 6820 6973 204e 6f6e   or pitch is Non
+00017a80: 6520 6f72 2072 6f6c 6c20 6973 204e 6f6e  e or roll is Non
+00017a90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00017aa0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00017ab0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00017ac0: 2020 2020 2020 2020 6e65 775f 6c61 742c          new_lat,
+00017ad0: 6e65 775f 6c6f 6e2c 6e65 775f 6465 7020  new_lon,new_dep 
+00017ae0: 3d20 6d69 7174 672e 6164 644c 6576 6572  = miqtg.addLever
+00017af0: 6172 6d73 324c 6174 6c6f 6e28 6c61 742c  arms2Latlon(lat,
+00017b00: 6c6f 6e2c 6465 702c 6f66 6673 6574 5f78  lon,dep,offset_x
+00017b10: 2c6f 6666 7365 745f 792c 6f66 6673 6574  ,offset_y,offset
+00017b20: 5f7a 2c79 6177 2c70 6974 6368 2c72 6f6c  _z,yaw,pitch,rol
+00017b30: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+00017b40: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+00017b50: 5b69 5d2e 6c61 7420 3d20 6e65 775f 6c61  [i].lat = new_la
+00017b60: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00017b70: 2020 2020 2020 706f 7369 7469 6f6e 735b        positions[
+00017b80: 695d 2e6c 6f6e 203d 206e 6577 5f6c 6f6e  i].lon = new_lon
+00017b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017ba0: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
+00017bb0: 5d2e 6465 7020 3d20 6e65 775f 6465 700a  ].dep = new_dep.
+00017bc0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00017bd0: 662e 7072 6f76 2e6c 6f67 2822 6170 706c  f.prov.log("appl
+00017be0: 6965 6420 6c65 7665 7220 6172 6d20 636f  ied lever arm co
+00017bf0: 6d70 656e 7361 7469 6f6e 2078 2c79 2c7a  mpensation x,y,z
+00017c00: 203d 2022 202b 2073 7472 286f 6666 7365   = " + str(offse
+00017c10: 745f 7829 202b 2022 2c22 202b 2073 7472  t_x) + "," + str
+00017c20: 286f 6666 7365 745f 7929 202b 2022 2c22  (offset_y) + ","
+00017c30: 202b 2073 7472 286f 6666 7365 745f 7a29   + str(offset_z)
+00017c40: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+00017c50: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+00017c60: 696d 6167 655f 6474 7329 203e 2030 3a0a  image_dts) > 0:.
+00017c70: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+00017c80: 6563 6b20 7768 6574 6865 7220 6465 7074  eck whether dept
+00017c90: 6820 616e 6420 6865 6967 6874 2061 7265  h and height are
+00017ca0: 2073 6574 0a20 2020 2020 2020 2020 2020   set.           
+00017cb0: 206c 6174 5f69 6465 6e74 6963 616c 2c20   lat_identical, 
+00017cc0: 6c6f 6e5f 6964 656e 7469 6361 6c2c 2064  lon_identical, d
+00017cd0: 6570 5f69 6465 6e74 6963 616c 2c20 6867  ep_identical, hg
+00017ce0: 745f 6964 656e 7469 6361 6c2c 2064 6570  t_identical, dep
+00017cf0: 5f6e 6f74 5f7a 6572 6f2c 2068 6774 5f6e  _not_zero, hgt_n
+00017d00: 6f74 5f7a 6572 6f2c 756e 6365 7274 5f6e  ot_zero,uncert_n
+00017d10: 6f74 5f7a 6572 6f20 3d20 6e61 765f 6461  ot_zero = nav_da
+00017d20: 7461 2e63 6865 636b 506f 7369 7469 6f6e  ta.checkPosition
+00017d30: 7343 6f6e 7465 6e74 2829 0a0a 2020 2020  sContent()..    
+00017d40: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+00017d50: 746f 206e 6176 6967 6174 696f 6e20 7478  to navigation tx
+00017d60: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
+00017d70: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
+00017d80: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+00017d90: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
+00017da0: 6e61 765f 6669 6c65 2829 2c20 2277 2229  nav_file(), "w")
+00017db0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00017dc0: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
+00017dd0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00017de0: 5d5b 2769 6d67 275d 2b22 5c74 222b 6d69  ]['img']+"\t"+mi
+00017df0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00017e00: 6d61 7269 7174 275d 5b27 7574 6327 5d29  mariqt']['utc'])
+00017e10: 0a0a 2020 2020 2020 2020 2020 2020 6861  ..            ha
+00017e20: 735f 616c 7420 3d20 5472 7565 2069 6620  s_alt = True if 
+00017e30: 6465 705f 6e6f 745f 7a65 726f 2061 6e64  dep_not_zero and
+00017e40: 2028 2027 6465 7027 2069 6e20 6e61 765f   ( 'dep' in nav_
+00017e50: 6865 6164 6572 206f 7220 2761 6c74 2720  header or 'alt' 
+00017e60: 696e 206e 6176 5f68 6561 6465 7220 2920  in nav_header ) 
+00017e70: 656c 7365 2046 616c 7365 0a0a 2020 2020  else False..    
+00017e80: 2020 2020 2020 2020 6966 2027 6c61 7427          if 'lat'
+00017e90: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
+00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017eb0: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
+00017ec0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00017ed0: 276d 6172 6971 7427 5d5b 276c 6174 275d  'mariqt']['lat']
+00017ee0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00017ef0: 2027 6c6f 6e27 2069 6e20 6e61 765f 6865   'lon' in nav_he
+00017f00: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+00017f10: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00017f20: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00017f30: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00017f40: 276c 6f6e 275d 290a 2020 2020 2020 2020  'lon']).        
+00017f50: 2020 2020 6966 2068 6173 5f61 6c74 3a0a      if has_alt:.
+00017f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f70: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
+00017f80: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00017f90: 276d 6172 6971 7427 5d5b 2761 6c74 275d  'mariqt']['alt']
+00017fa0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00017fb0: 2068 6774 5f6e 6f74 5f7a 6572 6f20 616e   hgt_not_zero an
+00017fc0: 6420 2768 6774 2720 696e 206e 6176 5f68  d 'hgt' in nav_h
+00017fd0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
+00017fe0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00017ff0: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
+00018000: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00018010: 5b27 6867 7427 5d29 0a20 2020 2020 2020  ['hgt']).       
+00018020: 2020 2020 2069 6620 756e 6365 7274 5f6e       if uncert_n
+00018030: 6f74 5f7a 6572 6f20 616e 6420 2775 6e63  ot_zero and 'unc
+00018040: 6572 7427 2069 6e20 6e61 765f 6865 6164  ert' in nav_head
+00018050: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00018060: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00018070: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+00018080: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
+00018090: 6e63 6572 7427 5d29 0a20 2020 2020 2020  ncert']).       
+000180a0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+000180b0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+000180c0: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
+000180d0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+000180e0: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
+000180f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018100: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
+00018110: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
+00018120: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00018130: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00018140: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
+00018150: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
+00018160: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+00018170: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+00018180: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
+00018190: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000181a0: 276c 6174 2720 696e 206e 6176 5f68 6561  'lat' in nav_hea
+000181b0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+000181c0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000181d0: 203d 2074 696d 6570 6f69 6e74 2e6c 6174   = timepoint.lat
+000181e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000181f0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00018200: 7465 2822 5c74 222b 7374 7228 7661 6c29  te("\t"+str(val)
+00018210: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018220: 2020 2020 2020 6966 2027 6c6f 6e27 2069        if 'lon' i
+00018230: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
+00018240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018250: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
+00018260: 706f 696e 742e 6c6f 6e0a 2020 2020 2020  point.lon.      
+00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018280: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
+00018290: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
+000182a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000182b0: 6620 6861 735f 616c 743a 0a20 2020 2020  f has_alt:.     
+000182c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182d0: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
+000182e0: 6e74 2e64 6570 0a20 2020 2020 2020 2020  nt.dep.         
+000182f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00018300: 2064 6570 2074 6f20 616c 740a 2020 2020   dep to alt.    
+00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018320: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
 00018330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018340: 6966 2068 6774 5f6e 6f74 5f7a 6572 6f20  if hgt_not_zero 
-00018350: 616e 6420 2768 6774 2720 696e 206e 6176  and 'hgt' in nav
-00018360: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
-00018370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018380: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
-00018390: 2e68 6774 0a20 2020 2020 2020 2020 2020  .hgt.           
-000183a0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-000183b0: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
-000183c0: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
-000183d0: 2020 2020 2020 2020 2020 6966 2075 6e63            if unc
-000183e0: 6572 745f 6e6f 745f 7a65 726f 2061 6e64  ert_not_zero and
-000183f0: 2027 756e 6365 7274 2720 696e 206e 6176   'uncert' in nav
-00018400: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
-00018410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018420: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
-00018430: 2e75 6e63 6572 740a 2020 2020 2020 2020  .uncert.        
+00018340: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00018350: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
+00018360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018370: 2020 2069 6620 6867 745f 6e6f 745f 7a65     if hgt_not_ze
+00018380: 726f 2061 6e64 2027 6867 7427 2069 6e20  ro and 'hgt' in 
+00018390: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
+000183a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183b0: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
+000183c0: 696e 742e 6867 740a 2020 2020 2020 2020  int.hgt.        
+000183d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183e0: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
+000183f0: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
+00018400: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00018410: 756e 6365 7274 5f6e 6f74 5f7a 6572 6f20  uncert_not_zero 
+00018420: 616e 6420 2775 6e63 6572 7427 2069 6e20  and 'uncert' in 
+00018430: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
 00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018450: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
-00018460: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
-00018470: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00018480: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
-00018490: 2020 2020 2020 2020 2072 6573 2e63 6c6f           res.clo
-000184a0: 7365 2829 0a0a 2020 2020 2020 2020 2020  se()..          
-000184b0: 2020 2320 5772 6974 6520 746f 2067 656f    # Write to geo
-000184c0: 6a73 6f6e 2066 696c 650a 2020 2020 2020  json file.      
-000184d0: 2020 2020 2020 6765 6f6a 736f 6e20 3d20        geojson = 
-000184e0: 7b27 7479 7065 273a 2027 4665 6174 7572  {'type': 'Featur
-000184f0: 6543 6f6c 6c65 6374 696f 6e27 2c20 276e  eCollection', 'n
-00018500: 616d 6527 3a20 7365 6c66 2e64 6972 2e65  ame': self.dir.e
-00018510: 7665 6e74 2829 2b22 5f22 2b73 656c 662e  vent()+"_"+self.
-00018520: 6469 722e 7365 6e73 6f72 2829 2b22 5f69  dir.sensor()+"_i
-00018530: 6d61 6765 2d6e 6176 6967 6174 696f 6e22  mage-navigation"
-00018540: 2c20 2766 6561 7475 7265 7327 3a20 5b5d  , 'features': []
-00018550: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
-00018560: 7220 6669 6c65 2069 6e20 696d 6167 655f  r file in image_
-00018570: 6474 733a 0a20 2020 2020 2020 2020 2020  dts:.           
-00018580: 2020 2020 2023 2070 686f 746f 0a20 2020       # photo.   
-00018590: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000185a0: 6c65 6e28 696d 6167 655f 6474 735b 6669  len(image_dts[fi
-000185b0: 6c65 5d29 203d 3d20 313a 0a20 2020 2020  le]) == 1:.     
-000185c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000185d0: 6620 6465 705f 6e6f 745f 7a65 726f 3a0a  f dep_not_zero:.
-000185e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185f0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
-00018600: 203d 2020 7b27 7479 7065 273a 2022 506f   =  {'type': "Po
-00018610: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
-00018620: 6573 273a 200a 2020 2020 2020 2020 2020  es': .          
-00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018640: 2020 2020 2020 2020 2020 2020 2020 5b66                [f
-00018650: 6c6f 6174 2869 6d61 6765 5f64 7473 5b66  loat(image_dts[f
-00018660: 696c 655d 5b30 5d2e 6c6f 6e29 2c20 666c  ile][0].lon), fl
-00018670: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
-00018680: 6c65 5d5b 305d 2e6c 6174 292c 2066 6c6f  le][0].lat), flo
-00018690: 6174 2869 6d61 6765 5f64 7473 5b66 696c  at(image_dts[fil
-000186a0: 655d 5b30 5d2e 6465 7029 5d0a 2020 2020  e][0].dep)].    
-000186b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186d0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000186e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00018450: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
+00018460: 696e 742e 756e 6365 7274 0a20 2020 2020  int.uncert.     
+00018470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018480: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00018490: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
+000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184b0: 7265 732e 7772 6974 6528 225c 6e22 290a  res.write("\n").
+000184c0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+000184d0: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
+000184e0: 2020 2020 2023 2057 7269 7465 2074 6f20       # Write to 
+000184f0: 6765 6f6a 736f 6e20 6669 6c65 0a20 2020  geojson file.   
+00018500: 2020 2020 2020 2020 2067 656f 6a73 6f6e           geojson
+00018510: 203d 207b 2774 7970 6527 3a20 2746 6561   = {'type': 'Fea
+00018520: 7475 7265 436f 6c6c 6563 7469 6f6e 272c  tureCollection',
+00018530: 2027 6e61 6d65 273a 2073 656c 662e 6469   'name': self.di
+00018540: 722e 6576 656e 7428 292b 225f 222b 7365  r.event()+"_"+se
+00018550: 6c66 2e64 6972 2e73 656e 736f 7228 292b  lf.dir.sensor()+
+00018560: 225f 696d 6167 652d 6e61 7669 6761 7469  "_image-navigati
+00018570: 6f6e 222c 2027 6665 6174 7572 6573 273a  on", 'features':
+00018580: 205b 5d7d 0a20 2020 2020 2020 2020 2020   []}.           
+00018590: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+000185a0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
+000185b0: 2020 2020 2020 2020 2320 7068 6f74 6f0a          # photo.
+000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185d0: 6966 206c 656e 2869 6d61 6765 5f64 7473  if len(image_dts
+000185e0: 5b66 696c 655d 2920 3d3d 2031 3a0a 2020  [file]) == 1:.  
+000185f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018600: 2020 6966 2064 6570 5f6e 6f74 5f7a 6572    if dep_not_zer
+00018610: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
+00018620: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
+00018630: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
+00018640: 2250 6f69 6e74 222c 2027 636f 6f72 6469  "Point", 'coordi
+00018650: 6e61 7465 7327 3a20 0a20 2020 2020 2020  nates': .       
+00018660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018680: 205b 666c 6f61 7428 696d 6167 655f 6474   [float(image_dt
+00018690: 735b 6669 6c65 5d5b 305d 2e6c 6f6e 292c  s[file][0].lon),
+000186a0: 2066 6c6f 6174 2869 6d61 6765 5f64 7473   float(image_dts
+000186b0: 5b66 696c 655d 5b30 5d2e 6c61 7429 2c20  [file][0].lat), 
+000186c0: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
+000186d0: 6669 6c65 5d5b 305d 2e64 6570 295d 0a20  file][0].dep)]. 
+000186e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000186f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018700: 2020 2020 6765 6f6d 6574 7279 203d 2020      geometry =  
-00018710: 7b27 7479 7065 273a 2022 506f 696e 7422  {'type': "Point"
-00018720: 2c20 2763 6f6f 7264 696e 6174 6573 273a  , 'coordinates':
-00018730: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00018740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018750: 2020 2020 2020 2020 2020 5b66 6c6f 6174            [float
-00018760: 2869 6d61 6765 5f64 7473 5b66 696c 655d  (image_dts[file]
-00018770: 5b30 5d2e 6c6f 6e29 2c20 666c 6f61 7428  [0].lon), float(
-00018780: 696d 6167 655f 6474 735b 6669 6c65 5d5b  image_dts[file][
-00018790: 305d 2e6c 6174 295d 0a20 2020 2020 2020  0].lat)].       
-000187a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187b0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-000187c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187d0: 2020 2069 6620 5472 7565 2069 6e20 5b6d     if True in [m
-000187e0: 6174 682e 6973 6e61 6e28 7829 2066 6f72  ath.isnan(x) for
-000187f0: 2078 2069 6e20 6765 6f6d 6574 7279 5b27   x in geometry['
-00018800: 636f 6f72 6469 6e61 7465 7327 5d5d 3a0a  coordinates']]:.
-00018810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018820: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00018830: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018840: 2020 2320 7669 6465 6f0a 2020 2020 2020    # video.      
-00018850: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00018860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018870: 2020 2020 6966 2064 6570 5f6e 6f74 5f7a      if dep_not_z
-00018880: 6572 6f3a 0a20 2020 2020 2020 2020 2020  ero:.           
-00018890: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-000188a0: 6d65 7472 7920 3d20 207b 2774 7970 6527  metry =  {'type'
-000188b0: 3a20 224d 756c 7469 506f 696e 7422 2c20  : "MultiPoint", 
-000188c0: 2763 6f6f 7264 696e 6174 6573 273a 0a20  'coordinates':. 
-000188d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188f0: 2020 2020 2020 205b 5b66 6c6f 6174 2864         [[float(d
-00018900: 2e6c 6f6e 292c 2066 6c6f 6174 2864 2e6c  .lon), float(d.l
-00018910: 6174 292c 2066 6c6f 6174 2864 2e64 6570  at), float(d.dep
-00018920: 295d 2066 6f72 2064 2069 6e20 696d 6167  )] for d in imag
-00018930: 655f 6474 735b 6669 6c65 5d5d 0a20 2020  e_dts[file]].   
-00018940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018960: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-00018970: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00018700: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00018710: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018730: 2020 2020 2020 2067 656f 6d65 7472 7920         geometry 
+00018740: 3d20 207b 2774 7970 6527 3a20 2250 6f69  =  {'type': "Poi
+00018750: 6e74 222c 2027 636f 6f72 6469 6e61 7465  nt", 'coordinate
+00018760: 7327 3a20 0a20 2020 2020 2020 2020 2020  s': .           
+00018770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018780: 2020 2020 2020 2020 2020 2020 205b 666c               [fl
+00018790: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
+000187a0: 6c65 5d5b 305d 2e6c 6f6e 292c 2066 6c6f  le][0].lon), flo
+000187b0: 6174 2869 6d61 6765 5f64 7473 5b66 696c  at(image_dts[fil
+000187c0: 655d 5b30 5d2e 6c61 7429 5d0a 2020 2020  e][0].lat)].    
+000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187f0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00018800: 2020 2020 2020 6966 2054 7275 6520 696e        if True in
+00018810: 205b 6d61 7468 2e69 736e 616e 2878 2920   [math.isnan(x) 
+00018820: 666f 7220 7820 696e 2067 656f 6d65 7472  for x in geometr
+00018830: 795b 2763 6f6f 7264 696e 6174 6573 275d  y['coordinates']
+00018840: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00018850: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00018860: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
+00018870: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
+00018880: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00018890: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000188a0: 2020 2020 2020 2069 6620 6465 705f 6e6f         if dep_no
+000188b0: 745f 7a65 726f 3a0a 2020 2020 2020 2020  t_zero:.        
+000188c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188d0: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
+000188e0: 7065 273a 2022 4d75 6c74 6950 6f69 6e74  pe': "MultiPoint
+000188f0: 222c 2027 636f 6f72 6469 6e61 7465 7327  ", 'coordinates'
+00018900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018920: 2020 2020 2020 2020 2020 5b5b 666c 6f61            [[floa
+00018930: 7428 642e 6c6f 6e29 2c20 666c 6f61 7428  t(d.lon), float(
+00018940: 642e 6c61 7429 2c20 666c 6f61 7428 642e  d.lat), float(d.
+00018950: 6465 7029 5d20 666f 7220 6420 696e 2069  dep)] for d in i
+00018960: 6d61 6765 5f64 7473 5b66 696c 655d 5d0a  mage_dts[file]].
+00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018990: 2020 2020 2067 656f 6d65 7472 7920 3d20       geometry = 
-000189a0: 207b 2774 7970 6527 3a20 224d 756c 7469   {'type': "Multi
-000189b0: 506f 696e 7422 2c20 2763 6f6f 7264 696e  Point", 'coordin
-000189c0: 6174 6573 273a 0a20 2020 2020 2020 2020  ates':.         
-000189d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189e0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000189f0: 5b66 6c6f 6174 2864 2e6c 6f6e 292c 2066  [float(d.lon), f
-00018a00: 6c6f 6174 2864 2e6c 6174 295d 2066 6f72  loat(d.lat)] for
-00018a10: 2064 2069 6e20 696d 6167 655f 6474 735b   d in image_dts[
-00018a20: 6669 6c65 5d5d 0a20 2020 2020 2020 2020  file]].         
-00018a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a40: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00018a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a60: 2069 6620 5472 7565 2069 6e20 5b6d 6174   if True in [mat
-00018a70: 682e 6973 6e61 6e28 7829 2066 6f72 2078  h.isnan(x) for x
-00018a80: 2069 6e20 5b69 7465 6d20 666f 7220 7375   in [item for su
-00018a90: 626c 6973 7420 696e 2067 656f 6d65 7472  blist in geometr
-00018aa0: 795b 2763 6f6f 7264 696e 6174 6573 275d  y['coordinates']
-00018ab0: 2066 6f72 2069 7465 6d20 696e 2073 7562   for item in sub
-00018ac0: 6c69 7374 5d5d 3a0a 2020 2020 2020 2020  list]]:.        
-00018ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ae0: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-00018af0: 2020 2020 2020 2020 2020 6765 6f6a 736f            geojso
-00018b00: 6e5b 2766 6561 7475 7265 7327 5d2e 6170  n['features'].ap
-00018b10: 7065 6e64 287b 2774 7970 6527 3a20 2746  pend({'type': 'F
-00018b20: 6561 7475 7265 272c 2027 7072 6f70 6572  eature', 'proper
-00018b30: 7469 6573 273a 207b 2769 6427 3a20 6669  ties': {'id': fi
-00018b40: 6c65 7d2c 2027 6765 6f6d 6574 7279 273a  le}, 'geometry':
-00018b50: 2067 656f 6d65 7472 7920 7d29 0a20 2020   geometry }).   
-00018b60: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00018b70: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-00018b80: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
-00018b90: 6e61 765f 6669 6c65 2829 2e72 6570 6c61  nav_file().repla
-00018ba0: 6365 2822 2e74 7874 222c 2022 2e67 656f  ce(".txt", ".geo
-00018bb0: 6a73 6f6e 2229 2c0a 2020 2020 2020 2020  json"),.        
-00018bc0: 2020 2020 2020 2020 2020 2020 2022 7722               "w"
-00018bd0: 2c20 6572 726f 7273 3d22 6967 6e6f 7265  , errors="ignore
-00018be0: 222c 2065 6e63 6f64 696e 673d 2775 7466  ", encoding='utf
-00018bf0: 2d38 2729 0a20 2020 2020 2020 2020 2020  -8').           
-00018c00: 206a 736f 6e2e 6475 6d70 2867 656f 6a73   json.dump(geojs
-00018c10: 6f6e 2c20 6f2c 2065 6e73 7572 655f 6173  on, o, ensure_as
-00018c20: 6369 693d 4661 6c73 652c 2069 6e64 656e  cii=False, inden
-00018c30: 743d 3429 0a20 2020 2020 2020 2020 2020  t=4).           
-00018c40: 206f 2e63 6c6f 7365 2829 0a0a 2020 2020   o.close()..    
-00018c50: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00018c60: 762e 6164 6441 7267 756d 656e 7428 2269  v.addArgument("i
-00018c70: 6e70 7574 4e61 7669 6761 7469 6f6e 4669  nputNavigationFi
-00018c80: 6c65 222c 6e61 765f 7061 7468 2c6f 7665  le",nav_path,ove
-00018c90: 7277 7269 7465 3d54 7275 6529 0a20 2020  rwrite=True).   
-00018ca0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00018cb0: 6f76 2e6c 6f67 2822 7061 7273 6564 2066  ov.log("parsed f
-00018cc0: 726f 6d20 696e 7075 744e 6176 6967 6174  rom inputNavigat
-00018cd0: 696f 6e46 696c 653a 2022 202b 2073 7472  ionFile: " + str
-00018ce0: 286e 6176 5f68 6561 6465 7229 2c64 6f6e  (nav_header),don
-00018cf0: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
-00018d00: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
-00018d10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00018d20: 7572 6e20 5472 7565 2c20 224e 6176 6967  urn True, "Navig
-00018d30: 6174 696f 6e20 6461 7461 2063 7265 6174  ation data creat
-00018d40: 6564 2220 2b20 7265 7475 726e 4d73 670a  ed" + returnMsg.
-00018d50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00018d60: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
-00018d70: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-00018d80: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
-00018d90: 2069 6d61 6765 2063 6f6f 7264 696e 6174   image coordinat
-00018da0: 6573 2066 6f75 6e64 2220 2b20 7265 7475  es found" + retu
-00018db0: 726e 4d73 670a 0a20 2020 2064 6566 2063  rnMsg..    def c
-00018dc0: 7265 6174 6549 6d61 6765 4e61 7669 6761  reateImageNaviga
-00018dd0: 7469 6f6e 4669 6c65 2873 656c 662c 206e  tionFile(self, n
-00018de0: 6176 5f70 6174 683a 2073 7472 2c20 6e61  av_path: str, na
-00018df0: 765f 6865 6164 6572 3d6d 6971 7476 2e70  v_header=miqtv.p
-00018e00: 6f73 5f68 6561 6465 725b 2770 616e 6761  os_header['panga
-00018e10: 6561 275d 2c20 6461 7465 5f66 6f72 6d61  ea'], date_forma
-00018e20: 743d 6d69 7174 762e 6461 7465 5f66 6f72  t=miqtv.date_for
-00018e30: 6d61 7473 5b27 7061 6e67 6165 6127 5d2c  mats['pangaea'],
-00018e40: 206f 7665 7277 7269 7465 3d46 616c 7365   overwrite=False
-00018e50: 2c20 636f 6c5f 7365 7061 7261 746f 7220  , col_separator 
-00018e60: 3d20 225c 7422 2c20 7669 6465 6f53 616d  = "\t", videoSam
-00018e70: 706c 6553 6563 6f6e 6473 3d31 2c0a 2020  pleSeconds=1,.  
-00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ea0: 2020 6f66 6673 6574 5f78 3d30 2c20 6f66    offset_x=0, of
-00018eb0: 6673 6574 5f79 3d30 2c20 6f66 6673 6574  fset_y=0, offset
-00018ec0: 5f7a 3d30 2c61 6e67 6c65 735f 696e 5f72  _z=0,angles_in_r
-00018ed0: 6164 203d 2046 616c 7365 2c20 7265 636f  ad = False, reco
-00018ee0: 7264 7332 6265 496e 7665 7274 6564 3d5b  rds2beInverted=[
-00018ef0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
-00018f00: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
-00018f10: 2063 7265 6174 655f 696d 6167 655f 6e61   create_image_na
-00018f20: 7669 6761 7469 6f6e 5f66 696c 6520 2222  vigation_file ""
-00018f30: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00018f40: 2073 656c 662e 6372 6561 7465 5f69 6d61   self.create_ima
-00018f50: 6765 5f6e 6176 6967 6174 696f 6e5f 6669  ge_navigation_fi
-00018f60: 6c65 286e 6176 5f70 6174 682c 206e 6176  le(nav_path, nav
-00018f70: 5f68 6561 6465 722c 2064 6174 655f 666f  _header, date_fo
-00018f80: 726d 6174 2c20 6f76 6572 7772 6974 652c  rmat, overwrite,
-00018f90: 2063 6f6c 5f73 6570 6172 6174 6f72 2c20   col_separator, 
-00018fa0: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
-00018fb0: 6473 2c20 6f66 6673 6574 5f78 2c20 6f66  ds, offset_x, of
-00018fc0: 6673 6574 5f79 2c20 6f66 6673 6574 5f7a  fset_y, offset_z
-00018fd0: 2c20 616e 676c 6573 5f69 6e5f 7261 642c  , angles_in_rad,
-00018fe0: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-00018ff0: 7465 6429 0a0a 0a20 2020 2064 6566 2063  ted)...    def c
-00019000: 7265 6174 655f 696d 6167 655f 7368 6132  reate_image_sha2
-00019010: 3536 5f66 696c 6528 7365 6c66 2c72 6552  56_file(self,reR
-00019020: 6561 6441 6c6c 3d54 7275 6529 3a0a 2020  eadAll=True):.  
-00019030: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
-00019040: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
-00019050: 7465 2061 2074 6578 7420 6669 6c65 2063  te a text file c
-00019060: 6f6e 7461 696e 696e 6720 7065 7220 696d  ontaining per im
-00019070: 6167 6520 6974 7320 5348 4132 3536 2068  age its SHA256 h
-00019080: 6173 682e 0a20 2020 2020 2020 2020 2020  ash..           
-00019090: 2049 6620 7265 5265 6164 416c 6c20 6973   If reReadAll is
-000190a0: 2054 7275 6520 616c 6c20 696d 6167 6573   True all images
-000190b0: 2720 6861 7368 6573 2061 7265 2064 6574  ' hashes are det
-000190c0: 6572 6d69 6e65 642e 204f 7468 6572 7769  ermined. Otherwi
-000190d0: 7365 206f 6e6c 7920 666f 7220 7468 6f73  se only for thos
-000190e0: 6520 6669 6c65 730a 2020 2020 2020 2020  e files.        
-000190f0: 2020 2020 7768 6963 6820 6172 6520 6e6f      which are no
-00019100: 7420 7965 7420 696e 2074 6865 2069 6e74  t yet in the int
-00019110: 6572 6d65 6469 6174 6520 6669 6c65 2063  ermediate file c
-00019120: 6f6e 7461 696e 696e 6720 7468 6520 696d  ontaining the im
-00019130: 6167 6520 6861 7368 6573 2020 2222 220a  age hashes  """.
-00019140: 2020 2020 2020 2020 6861 7368 6573 203d          hashes =
-00019150: 207b 7d0a 2020 2020 2020 2020 6966 206f   {}.        if o
-00019160: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-00019170: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
-00019180: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
-00019190: 2020 2020 2068 6173 6865 7320 3d20 6d69       hashes = mi
-000191a0: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
-000191b0: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
-000191c0: 685f 6669 6c65 2829 2c20 5b6d 6971 7476  h_file(), [miqtv
-000191d0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-000191e0: 6971 7427 5d5b 2769 6d67 275d 2c20 6d69  iqt']['img'], mi
-000191f0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00019200: 6d61 7269 7174 275d 5b27 6861 7368 275d  mariqt']['hash']
-00019210: 5d2c 206b 6579 5f63 6f6c 3d6d 6971 7476  ], key_col=miqtv
-00019220: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00019230: 6971 7427 5d5b 2769 6d67 275d 290a 0a20  iqt']['img']).. 
-00019240: 2020 2020 2020 2069 6d61 6765 7349 6e52         imagesInR
-00019250: 6177 203d 2073 656c 662e 696d 6167 6573  aw = self.images
-00019260: 496e 496d 6167 6573 4469 7228 290a 2020  InImagesDir().  
-00019270: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
-00019280: 6765 7349 6e52 6177 2920 3e20 303a 0a0a  gesInRaw) > 0:..
-00019290: 2020 2020 2020 2020 2020 2020 6164 6465              adde
-000192a0: 645f 6861 7368 6573 203d 2030 0a20 2020  d_hashes = 0.   
-000192b0: 2020 2020 2020 2020 2070 726f 6720 3d20           prog = 
-000192c0: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
-000192d0: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
-000192e0: 636b 696e 6720 6861 7368 6573 222c 206c  cking hashes", l
-000192f0: 656e 2869 6d61 6765 7349 6e52 6177 292c  en(imagesInRaw),
-00019300: 6d6f 6475 6c6f 3d35 290a 2020 2020 2020  modulo=5).      
-00019310: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
-00019320: 6e20 696d 6167 6573 496e 5261 773a 0a20  n imagesInRaw:. 
-00019330: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00019340: 726f 672e 7072 6f67 7265 7373 2829 0a0a  rog.progress()..
-00019350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019360: 6966 206e 6f74 2073 656c 662e 5f5f 616c  if not self.__al
-00019370: 6c55 5549 4473 4368 6563 6b65 6420 616e  lUUIDsChecked an
-00019380: 6420 6e6f 7420 6d69 7174 692e 696d 6167  d not miqti.imag
-00019390: 6543 6f6e 7461 696e 7356 616c 6964 5555  eContainsValidUU
-000193a0: 4944 2866 696c 6529 5b30 5d3a 0a20 2020  ID(file)[0]:.   
-000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193c0: 2023 2072 656d 6f76 6520 6672 6f6d 2075   # remove from u
-000193d0: 7569 6420 6669 6c65 0a20 2020 2020 2020  uid file.       
-000193e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000193f0: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-00019400: 656c 662e 6765 745f 696e 745f 7575 6964  elf.get_int_uuid
-00019410: 5f66 696c 6528 2929 3a0a 2020 2020 2020  _file()):.      
-00019420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019430: 2020 7265 7320 3d20 6f70 656e 2873 656c    res = open(sel
-00019440: 662e 6765 745f 696e 745f 7575 6964 5f66  f.get_int_uuid_f
-00019450: 696c 6528 292c 2022 7222 290a 2020 2020  ile(), "r").    
-00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019470: 2020 2020 6c69 6e65 7320 3d20 7265 732e      lines = res.
-00019480: 7265 6164 6c69 6e65 7328 290a 2020 2020  readlines().    
+00018990: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+000189a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000189b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189c0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+000189d0: 203d 2020 7b27 7479 7065 273a 2022 4d75   =  {'type': "Mu
+000189e0: 6c74 6950 6f69 6e74 222c 2027 636f 6f72  ltiPoint", 'coor
+000189f0: 6469 6e61 7465 7327 3a0a 2020 2020 2020  dinates':.      
+00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a20: 2020 5b5b 666c 6f61 7428 642e 6c6f 6e29    [[float(d.lon)
+00018a30: 2c20 666c 6f61 7428 642e 6c61 7429 5d20  , float(d.lat)] 
+00018a40: 666f 7220 6420 696e 2069 6d61 6765 5f64  for d in image_d
+00018a50: 7473 5b66 696c 655d 5d0a 2020 2020 2020  ts[file]].      
+00018a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a70: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+00018a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a90: 2020 2020 6966 2054 7275 6520 696e 205b      if True in [
+00018aa0: 6d61 7468 2e69 736e 616e 2878 2920 666f  math.isnan(x) fo
+00018ab0: 7220 7820 696e 205b 6974 656d 2066 6f72  r x in [item for
+00018ac0: 2073 7562 6c69 7374 2069 6e20 6765 6f6d   sublist in geom
+00018ad0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
+00018ae0: 7327 5d20 666f 7220 6974 656d 2069 6e20  s'] for item in 
+00018af0: 7375 626c 6973 745d 5d3a 0a20 2020 2020  sublist]]:.     
+00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b10: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+00018b20: 2020 2020 2020 2020 2020 2020 2067 656f               geo
+00018b30: 6a73 6f6e 5b27 6665 6174 7572 6573 275d  json['features']
+00018b40: 2e61 7070 656e 6428 7b27 7479 7065 273a  .append({'type':
+00018b50: 2027 4665 6174 7572 6527 2c20 2770 726f   'Feature', 'pro
+00018b60: 7065 7274 6965 7327 3a20 7b27 6964 273a  perties': {'id':
+00018b70: 2066 696c 657d 2c20 2767 656f 6d65 7472   file}, 'geometr
+00018b80: 7927 3a20 6765 6f6d 6574 7279 207d 290a  y': geometry }).
+00018b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ba0: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
+00018bb0: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
+00018bc0: 6e74 5f6e 6176 5f66 696c 6528 292e 7265  nt_nav_file().re
+00018bd0: 706c 6163 6528 222e 7478 7422 2c20 222e  place(".txt", ".
+00018be0: 6765 6f6a 736f 6e22 292c 0a20 2020 2020  geojson"),.     
+00018bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c00: 2277 222c 2065 7272 6f72 733d 2269 676e  "w", errors="ign
+00018c10: 6f72 6522 2c20 656e 636f 6469 6e67 3d27  ore", encoding='
+00018c20: 7574 662d 3827 290a 2020 2020 2020 2020  utf-8').        
+00018c30: 2020 2020 6a73 6f6e 2e64 756d 7028 6765      json.dump(ge
+00018c40: 6f6a 736f 6e2c 206f 2c20 656e 7375 7265  ojson, o, ensure
+00018c50: 5f61 7363 6969 3d46 616c 7365 2c20 696e  _ascii=False, in
+00018c60: 6465 6e74 3d34 290a 2020 2020 2020 2020  dent=4).        
+00018c70: 2020 2020 6f2e 636c 6f73 6528 290a 0a20      o.close().. 
+00018c80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018c90: 7072 6f76 2e61 6464 4172 6775 6d65 6e74  prov.addArgument
+00018ca0: 2822 696e 7075 744e 6176 6967 6174 696f  ("inputNavigatio
+00018cb0: 6e46 696c 6522 2c6e 6176 5f70 6174 682c  nFile",nav_path,
+00018cc0: 6f76 6572 7772 6974 653d 5472 7565 290a  overwrite=True).
+00018cd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00018ce0: 2e70 726f 762e 6c6f 6728 2270 6172 7365  .prov.log("parse
+00018cf0: 6420 6672 6f6d 2069 6e70 7574 4e61 7669  d from inputNavi
+00018d00: 6761 7469 6f6e 4669 6c65 3a20 2220 2b20  gationFile: " + 
+00018d10: 7374 7228 6e61 765f 6865 6164 6572 292c  str(nav_header),
+00018d20: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+00018d30: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
+00018d40: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00018d50: 7265 7475 726e 2054 7275 652c 2022 4e61  return True, "Na
+00018d60: 7669 6761 7469 6f6e 2064 6174 6120 6372  vigation data cr
+00018d70: 6561 7465 6422 202b 2072 6574 7572 6e4d  eated" + returnM
+00018d80: 7367 0a20 2020 2020 2020 2065 6c73 653a  sg.        else:
+00018d90: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
+00018da0: 746f 7028 290a 2020 2020 2020 2020 2020  top().          
+00018db0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00018dc0: 224e 6f20 696d 6167 6520 636f 6f72 6469  "No image coordi
+00018dd0: 6e61 7465 7320 666f 756e 6422 202b 2072  nates found" + r
+00018de0: 6574 7572 6e4d 7367 0a0a 2020 2020 6465  eturnMsg..    de
+00018df0: 6620 6372 6561 7465 496d 6167 654e 6176  f createImageNav
+00018e00: 6967 6174 696f 6e46 696c 6528 7365 6c66  igationFile(self
+00018e10: 2c20 6e61 765f 7061 7468 3a20 7374 722c  , nav_path: str,
+00018e20: 206e 6176 5f68 6561 6465 723d 6d69 7174   nav_header=miqt
+00018e30: 762e 706f 735f 6865 6164 6572 5b27 7061  v.pos_header['pa
+00018e40: 6e67 6165 6127 5d2c 2064 6174 655f 666f  ngaea'], date_fo
+00018e50: 726d 6174 3d6d 6971 7476 2e64 6174 655f  rmat=miqtv.date_
+00018e60: 666f 726d 6174 735b 2770 616e 6761 6561  formats['pangaea
+00018e70: 275d 2c20 6f76 6572 7772 6974 653d 4661  '], overwrite=Fa
+00018e80: 6c73 652c 2063 6f6c 5f73 6570 6172 6174  lse, col_separat
+00018e90: 6f72 203d 2022 5c74 222c 2076 6964 656f  or = "\t", video
+00018ea0: 5361 6d70 6c65 5365 636f 6e64 733d 312c  SampleSeconds=1,
+00018eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ed0: 2020 2020 206f 6666 7365 745f 783d 302c       offset_x=0,
+00018ee0: 206f 6666 7365 745f 793d 302c 206f 6666   offset_y=0, off
+00018ef0: 7365 745f 7a3d 302c 616e 676c 6573 5f69  set_z=0,angles_i
+00018f00: 6e5f 7261 6420 3d20 4661 6c73 652c 2072  n_rad = False, r
+00018f10: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00018f20: 643d 5b5d 293a 0a20 2020 2020 2020 2022  d=[]):.        "
+00018f30: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
+00018f40: 7573 6520 6372 6561 7465 5f69 6d61 6765  use create_image
+00018f50: 5f6e 6176 6967 6174 696f 6e5f 6669 6c65  _navigation_file
+00018f60: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00018f70: 7572 6e20 7365 6c66 2e63 7265 6174 655f  urn self.create_
+00018f80: 696d 6167 655f 6e61 7669 6761 7469 6f6e  image_navigation
+00018f90: 5f66 696c 6528 6e61 765f 7061 7468 2c20  _file(nav_path, 
+00018fa0: 6e61 765f 6865 6164 6572 2c20 6461 7465  nav_header, date
+00018fb0: 5f66 6f72 6d61 742c 206f 7665 7277 7269  _format, overwri
+00018fc0: 7465 2c20 636f 6c5f 7365 7061 7261 746f  te, col_separato
+00018fd0: 722c 2076 6964 656f 5361 6d70 6c65 5365  r, videoSampleSe
+00018fe0: 636f 6e64 732c 206f 6666 7365 745f 782c  conds, offset_x,
+00018ff0: 206f 6666 7365 745f 792c 206f 6666 7365   offset_y, offse
+00019000: 745f 7a2c 2061 6e67 6c65 735f 696e 5f72  t_z, angles_in_r
+00019010: 6164 2c20 7265 636f 7264 7332 6265 496e  ad, records2beIn
+00019020: 7665 7274 6564 290a 0a0a 2020 2020 6465  verted)...    de
+00019030: 6620 6372 6561 7465 5f69 6d61 6765 5f73  f create_image_s
+00019040: 6861 3235 365f 6669 6c65 2873 656c 662c  ha256_file(self,
+00019050: 7265 5265 6164 416c 6c3d 5472 7565 293a  reReadAll=True):
+00019060: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
+00019070: 6174 6573 2069 6e20 2f69 6e74 6572 6d65  ates in /interme
+00019080: 6469 6174 6520 6120 7465 7874 2066 696c  diate a text fil
+00019090: 6520 636f 6e74 6169 6e69 6e67 2070 6572  e containing per
+000190a0: 2069 6d61 6765 2069 7473 2053 4841 3235   image its SHA25
+000190b0: 3620 6861 7368 2e0a 2020 2020 2020 2020  6 hash..        
+000190c0: 2020 2020 4966 2072 6552 6561 6441 6c6c      If reReadAll
+000190d0: 2069 7320 5472 7565 2061 6c6c 2069 6d61   is True all ima
+000190e0: 6765 7327 2068 6173 6865 7320 6172 6520  ges' hashes are 
+000190f0: 6465 7465 726d 696e 6564 2e20 4f74 6865  determined. Othe
+00019100: 7277 6973 6520 6f6e 6c79 2066 6f72 2074  rwise only for t
+00019110: 686f 7365 2066 696c 6573 0a20 2020 2020  hose files.     
+00019120: 2020 2020 2020 2077 6869 6368 2061 7265         which are
+00019130: 206e 6f74 2079 6574 2069 6e20 7468 6520   not yet in the 
+00019140: 696e 7465 726d 6564 6961 7465 2066 696c  intermediate fil
+00019150: 6520 636f 6e74 6169 6e69 6e67 2074 6865  e containing the
+00019160: 2069 6d61 6765 2068 6173 6865 7320 2022   image hashes  "
+00019170: 2222 0a20 2020 2020 2020 2068 6173 6865  "".        hashe
+00019180: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
+00019190: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+000191a0: 2873 656c 662e 6765 745f 696e 745f 6861  (self.get_int_ha
+000191b0: 7368 5f66 696c 6528 2929 3a0a 2020 2020  sh_file()):.    
+000191c0: 2020 2020 2020 2020 6861 7368 6573 203d          hashes =
+000191d0: 206d 6971 7466 2e74 6162 4669 6c65 4461   miqtf.tabFileDa
+000191e0: 7461 2873 656c 662e 6765 745f 696e 745f  ta(self.get_int_
+000191f0: 6861 7368 5f66 696c 6528 292c 205b 6d69  hash_file(), [mi
+00019200: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00019210: 6d61 7269 7174 275d 5b27 696d 6727 5d2c  mariqt']['img'],
+00019220: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00019230: 725b 276d 6172 6971 7427 5d5b 2768 6173  r['mariqt']['has
+00019240: 6827 5d5d 2c20 6b65 795f 636f 6c3d 6d69  h']], key_col=mi
+00019250: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00019260: 6d61 7269 7174 275d 5b27 696d 6727 5d29  mariqt']['img'])
+00019270: 0a0a 2020 2020 2020 2020 696d 6167 6573  ..        images
+00019280: 496e 5261 7720 3d20 7365 6c66 2e69 6d61  InRaw = self.ima
+00019290: 6765 7349 6e49 6d61 6765 7344 6972 2829  gesInImagesDir()
+000192a0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+000192b0: 696d 6167 6573 496e 5261 7729 203e 2030  imagesInRaw) > 0
+000192c0: 3a0a 0a20 2020 2020 2020 2020 2020 2061  :..            a
+000192d0: 6464 6564 5f68 6173 6865 7320 3d20 300a  dded_hashes = 0.
+000192e0: 2020 2020 2020 2020 2020 2020 7072 6f67              prog
+000192f0: 203d 206d 6971 7463 2e50 7269 6e74 4b6e   = miqtc.PrintKn
+00019300: 6f77 6e50 726f 6772 6573 734d 7367 2822  ownProgressMsg("
+00019310: 4368 6563 6b69 6e67 2068 6173 6865 7322  Checking hashes"
+00019320: 2c20 6c65 6e28 696d 6167 6573 496e 5261  , len(imagesInRa
+00019330: 7729 2c6d 6f64 756c 6f3d 3529 0a20 2020  w),modulo=5).   
+00019340: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+00019350: 6520 696e 2069 6d61 6765 7349 6e52 6177  e in imagesInRaw
+00019360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019370: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
+00019380: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00019390: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+000193a0: 5f61 6c6c 5555 4944 7343 6865 636b 6564  _allUUIDsChecked
+000193b0: 2061 6e64 206e 6f74 206d 6971 7469 2e69   and not miqti.i
+000193c0: 6d61 6765 436f 6e74 6169 6e73 5661 6c69  mageContainsVali
+000193d0: 6455 5549 4428 6669 6c65 295b 305d 3a0a  dUUID(file)[0]:.
+000193e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193f0: 2020 2020 2320 7265 6d6f 7665 2066 726f      # remove fro
+00019400: 6d20 7575 6964 2066 696c 650a 2020 2020  m uuid file.    
+00019410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019420: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
+00019430: 7328 7365 6c66 2e67 6574 5f69 6e74 5f75  s(self.get_int_u
+00019440: 7569 645f 6669 6c65 2829 293a 0a20 2020  uid_file()):.   
+00019450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019460: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
+00019470: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
+00019480: 645f 6669 6c65 2829 2c20 2272 2229 0a20  d_file(), "r"). 
 00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194a0: 2020 2020 7265 732e 636c 6f73 6528 290a      res.close().
-000194b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194e0: 2020 6c69 6e65 7320 3d20 5b5d 0a20 2020    lines = [].   
-000194f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019500: 2069 203d 2030 0a20 2020 2020 2020 2020   i = 0.         
-00019510: 2020 2020 2020 2020 2020 206c 696e 654e             lineN
-00019520: 7220 3d20 690a 2020 2020 2020 2020 2020  r = i.          
-00019530: 2020 2020 2020 2020 2020 666f 7220 6c69            for li
-00019540: 6e65 2069 6e20 6c69 6e65 733a 0a20 2020  ne in lines:.   
-00019550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019560: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00019570: 6261 7365 6e61 6d65 2866 696c 6529 2069  basename(file) i
-00019580: 6e20 6c69 6e65 3a0a 2020 2020 2020 2020  n line:.        
-00019590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195a0: 2020 2020 6c69 6e65 4e72 203d 2069 0a20      lineNr = i. 
-000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-000195d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000195e0: 2020 2020 2020 2020 2069 202b 3d20 310a           i += 1.
-000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019600: 2020 2020 6966 206c 696e 654e 7220 213d      if lineNr !=
-00019610: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00019620: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00019630: 6c69 6e65 735b 6c69 6e65 4e72 5d0a 2020  lines[lineNr].  
-00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019650: 2020 2020 2020 7265 7320 3d20 6f70 656e        res = open
-00019660: 2873 656c 662e 6765 745f 696e 745f 7575  (self.get_int_uu
-00019670: 6964 5f66 696c 6528 292c 2022 7722 290a  id_file(), "w").
-00019680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019690: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-000196a0: 656c 696e 6573 286c 696e 6573 290a 2020  elines(lines).  
-000196b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196c0: 2020 2020 2020 7265 732e 636c 6f73 6528        res.close(
-000196d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000196e0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-000196f0: 7074 696f 6e28 2022 4669 6c65 2022 202b  ption( "File " +
-00019700: 2066 696c 6520 2b20 2220 646f 6573 206e   file + " does n
-00019710: 6f74 2063 6f74 6169 6e20 6120 7661 6c69  ot cotain a vali
-00019720: 6420 5555 4944 2e20 5275 6e20 6372 6561  d UUID. Run crea
-00019730: 7465 5f75 7569 645f 6669 6c65 2829 2066  te_uuid_file() f
-00019740: 6972 7374 2122 290a 0a20 2020 2020 2020  irst!")..       
-00019750: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
-00019760: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
-00019770: 656e 616d 6528 6669 6c65 290a 2020 2020  ename(file).    
-00019780: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00019790: 6f74 2072 6552 6561 6441 6c6c 2061 6e64  ot reReadAll and
-000197a0: 2066 696c 655f 6e61 6d65 2069 6e20 6861   file_name in ha
-000197b0: 7368 6573 3a0a 2020 2020 2020 2020 2020  shes:.          
-000197c0: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
-000197d0: 5b66 696c 655f 6e61 6d65 5d20 3d20 6861  [file_name] = ha
-000197e0: 7368 6573 5b66 696c 655f 6e61 6d65 5d5b  shes[file_name][
-000197f0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00019800: 5b27 6d61 7269 7174 275d 5b27 6861 7368  ['mariqt']['hash
-00019810: 275d 5d0a 2020 2020 2020 2020 2020 2020  ']].            
-00019820: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00019830: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00019840: 7368 6573 5b66 696c 655f 6e61 6d65 5d20  shes[file_name] 
-00019850: 3d20 6d69 7174 632e 7368 6132 3536 4861  = miqtc.sha256Ha
-00019860: 7368 4669 6c65 2866 696c 6529 0a20 2020  shFile(file).   
-00019870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019880: 2061 6464 6564 5f68 6173 6865 7320 2b3d   added_hashes +=
-00019890: 2031 0a20 2020 2020 2020 2020 2020 2070   1.            p
-000198a0: 726f 672e 636c 6561 7228 290a 0a20 2020  rog.clear()..   
-000198b0: 2020 2020 2020 2020 2069 6620 7265 5265           if reRe
-000198c0: 6164 416c 6c20 6f72 2061 6464 6564 5f68  adAll or added_h
-000198d0: 6173 6865 7320 3e20 303a 0a20 2020 2020  ashes > 0:.     
-000198e0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-000198f0: 6669 6c65 203d 206f 7065 6e28 7365 6c66  file = open(self
-00019900: 2e67 6574 5f69 6e74 5f68 6173 685f 6669  .get_int_hash_fi
-00019910: 6c65 2829 2c20 2277 2229 0a20 2020 2020  le(), "w").     
-00019920: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00019930: 6669 6c65 2e77 7269 7465 2820 6d69 7174  file.write( miqt
-00019940: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00019950: 7269 7174 275d 5b27 696d 6727 5d2b 225c  riqt']['img']+"\
-00019960: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00019970: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
-00019980: 6173 6827 5d2b 225c 6e22 290a 2020 2020  ash']+"\n").    
-00019990: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000199a0: 6669 6c65 5f6e 616d 6520 696e 2068 6173  file_name in has
-000199b0: 6865 733a 0a20 2020 2020 2020 2020 2020  hes:.           
-000199c0: 2020 2020 2020 2020 2068 6173 685f 6669           hash_fi
-000199d0: 6c65 2e77 7269 7465 2866 696c 655f 6e61  le.write(file_na
-000199e0: 6d65 2b22 5c74 222b 6861 7368 6573 5b66  me+"\t"+hashes[f
-000199f0: 696c 655f 6e61 6d65 5d2b 225c 6e22 290a  ile_name]+"\n").
-00019a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019a10: 2068 6173 685f 6669 6c65 2e63 6c6f 7365   hash_file.close
-00019a20: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00019a30: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00019a40: 2241 6464 6564 2022 2b73 7472 2861 6464  "Added "+str(add
-00019a50: 6564 5f68 6173 6865 7329 2b22 2068 6173  ed_hashes)+" has
-00019a60: 6865 7320 746f 2068 6173 6820 6669 6c65  hes to hash file
-00019a70: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
-00019a80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019a90: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
-00019aa0: 2022 416c 6c20 6861 7368 6573 2065 7869   "All hashes exi
-00019ab0: 7374 220a 0a20 2020 2020 2020 2065 6c73  st"..        els
-00019ac0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00019ad0: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
-00019ae0: 2069 6d61 6765 7320 666f 756e 6420 746f   images found to
-00019af0: 2068 6173 6822 0a20 2020 2020 2020 200a   hash".        .
-00019b00: 2020 2020 6465 6620 6372 6561 7465 496d      def createIm
-00019b10: 6167 6553 4841 3235 3646 696c 6528 7365  ageSHA256File(se
-00019b20: 6c66 2c72 6552 6561 6441 6c6c 3d54 7275  lf,reReadAll=Tru
-00019b30: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
-00019b40: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
-00019b50: 2063 7265 6174 655f 696d 6167 655f 7368   create_image_sh
-00019b60: 6132 3536 5f66 696c 6520 2222 220a 2020  a256_file """.  
-00019b70: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00019b80: 662e 6372 6561 7465 5f69 6d61 6765 5f73  f.create_image_s
-00019b90: 6861 3235 365f 6669 6c65 2872 6552 6561  ha256_file(reRea
-00019ba0: 6441 6c6c 290a 0a0a 2020 2020 6465 6620  dAll)...    def 
-00019bb0: 6372 6561 7465 5f73 7461 7274 5f74 696d  create_start_tim
-00019bc0: 655f 6669 6c65 2873 656c 6629 3a0a 2020  e_file(self):.  
-00019bd0: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
-00019be0: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
-00019bf0: 7465 2061 2074 6578 7420 6669 6c65 2063  te a text file c
-00019c00: 6f6e 7461 696e 696e 6720 7065 7220 696d  ontaining per im
-00019c10: 6167 6520 6974 7320 7374 6172 7420 7469  age its start ti
-00019c20: 6d65 2070 6172 7365 6420 6672 6f6d 2074  me parsed from t
-00019c30: 6865 2066 696c 6520 6e61 6d65 2022 2222  he file name """
-00019c40: 0a0a 2020 2020 2020 2020 7320 3d20 6d69  ..        s = mi
-00019c50: 7174 632e 5072 696e 744c 6f61 6469 6e67  qtc.PrintLoading
-00019c60: 4d73 6728 2243 7265 6174 696e 6720 696e  Msg("Creating in
-00019c70: 7465 726d 6564 6961 7465 2073 7461 7274  termediate start
-00019c80: 7469 6d65 2066 696c 6520 2229 0a20 2020  time file ").   
-00019c90: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-00019ca0: 203d 2073 656c 662e 696d 6167 6573 496e   = self.imagesIn
-00019cb0: 496d 6167 6573 4469 7253 6f72 7465 644c  ImagesDirSortedL
-00019cc0: 6973 7428 290a 2020 2020 2020 2020 6966  ist().        if
-00019cd0: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
-00019ce0: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
-00019cf0: 2020 2020 6f20 3d20 6f70 656e 2873 656c      o = open(sel
-00019d00: 662e 6765 745f 696e 745f 7374 6172 7454  f.get_int_startT
-00019d10: 696d 6573 5f66 696c 6528 292c 2022 7722  imes_file(), "w"
-00019d20: 290a 2020 2020 2020 2020 2020 2020 6f2e  ).            o.
-00019d30: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
-00019d40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00019d50: 5b27 696d 6727 5d20 2b0a 2020 2020 2020  ['img'] +.      
-00019d60: 2020 2020 2020 2020 2020 2020 2020 225c                "\
-00019d70: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00019d80: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-00019d90: 7463 275d 2b22 5c6e 2229 0a0a 2020 2020  tc']+"\n")..    
-00019da0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00019db0: 2069 6e20 696d 6167 6573 496e 5261 773a   in imagesInRaw:
-00019dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019dd0: 2066 696c 655f 6e61 6d65 203d 206f 732e   file_name = os.
-00019de0: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
-00019df0: 6c65 290a 0a20 2020 2020 2020 2020 2020  le)..           
-00019e00: 2020 2020 2064 7420 3d20 6d69 7174 632e       dt = miqtc.
-00019e10: 7061 7273 6546 696c 6544 6174 6554 696d  parseFileDateTim
-00019e20: 6541 7355 5443 2866 696c 655f 6e61 6d65  eAsUTC(file_name
-00019e30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019e40: 2020 6f2e 7772 6974 6528 6669 6c65 5f6e    o.write(file_n
-00019e50: 616d 652b 225c 7422 202b 2064 742e 7374  ame+"\t" + dt.st
-00019e60: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
-00019e70: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-00019e80: 7427 5d29 2b22 5c6e 2229 0a0a 2020 2020  t'])+"\n")..    
-00019e90: 2020 2020 2020 2020 6f2e 636c 6f73 6528          o.close(
-00019ea0: 290a 2020 2020 2020 2020 2020 2020 732e  ).            s.
-00019eb0: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
-00019ec0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00019ed0: 2243 7265 6174 6564 2073 7461 7274 2074  "Created start t
-00019ee0: 696d 6520 6669 6c65 220a 2020 2020 2020  ime file".      
-00019ef0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00019f00: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-00019f10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019f20: 4661 6c73 652c 2022 4e6f 2069 6d61 6765  False, "No image
-00019f30: 7320 666f 756e 6420 746f 2072 6561 6420  s found to read 
-00019f40: 7374 6172 7420 7469 6d65 7322 0a20 2020  start times".   
-00019f50: 2020 2020 200a 2020 2020 6465 6620 6372       .    def cr
-00019f60: 6561 7465 5374 6172 7454 696d 6546 696c  eateStartTimeFil
-00019f70: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-00019f80: 2022 2222 2044 6570 7265 6361 7465 6420   """ Deprecated 
-00019f90: 2d20 7573 6520 6372 6561 7465 5f73 7461  - use create_sta
-00019fa0: 7274 5f74 696d 655f 6669 6c65 2022 2222  rt_time_file """
-00019fb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019fc0: 7365 6c66 2e63 7265 6174 655f 7374 6172  self.create_star
-00019fd0: 745f 7469 6d65 5f66 696c 6528 290a 0a0a  t_time_file()...
-00019fe0: 2020 2020 6465 6620 6372 6561 7465 4163      def createAc
-00019ff0: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
-0001a000: 7345 5849 4646 696c 6528 7365 6c66 2c6f  sEXIFFile(self,o
-0001a010: 7665 7272 6964 653d 4661 6c73 6529 3a0a  verride=False):.
-0001a020: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
-0001a030: 6563 6174 6564 2e20 5573 6520 6372 6561  ecated. Use crea
-0001a040: 7465 5f61 6371 7569 7369 7469 6f6e 5f73  te_acquisition_s
-0001a050: 6574 7469 6e67 735f 6578 6966 5f66 696c  ettings_exif_fil
-0001a060: 6528 2920 696e 7374 6561 642e 2022 2222  e() instead. """
-0001a070: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001a080: 7365 6c66 2e63 7265 6174 655f 6163 7175  self.create_acqu
-0001a090: 6973 6974 696f 6e5f 7365 7474 696e 6773  isition_settings
-0001a0a0: 5f65 7869 665f 6669 6c65 286f 7665 7272  _exif_file(overr
-0001a0b0: 6964 653d 6f76 6572 7269 6465 290a 0a20  ide=override).. 
-0001a0c0: 2020 2064 6566 2063 7265 6174 655f 6163     def create_ac
-0001a0d0: 7175 6973 6974 696f 6e5f 7365 7474 696e  quisition_settin
-0001a0e0: 6773 5f65 7869 665f 6669 6c65 2873 656c  gs_exif_file(sel
-0001a0f0: 662c 6f76 6572 7269 6465 3d46 616c 7365  f,override=False
-0001a100: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
-0001a110: 7265 6174 6573 2069 6e20 2f69 6e74 6572  reates in /inter
-0001a120: 6d65 6469 6174 6520 6120 7465 7874 2066  mediate a text f
-0001a130: 696c 6520 636f 6e74 6169 6e69 6e67 2070  ile containing p
-0001a140: 6572 2069 6d61 6765 2061 2064 6963 7420  er image a dict 
-0001a150: 6f66 2065 7869 6620 7461 6773 2061 6e64  of exif tags and
-0001a160: 2074 6865 6972 2076 616c 7565 7320 7061   their values pa
-0001a170: 7273 6564 2066 726f 6d20 7468 6520 696d  rsed from the im
-0001a180: 6167 6520 2222 220a 0a20 2020 2020 2020  age """..       
-0001a190: 2069 6e74 5f61 6371 7569 7369 7469 6f6e   int_acquisition
-0001a1a0: 5365 7474 696e 675f 6669 6c65 203d 2073  Setting_file = s
-0001a1b0: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
-0001a1c0: 6c65 5f70 7265 6669 7828 2920 2b20 275f  le_prefix() + '_
-0001a1d0: 696d 6167 652d 6163 7175 6973 6974 696f  image-acquisitio
-0001a1e0: 6e2d 7365 7474 696e 6773 2e74 7874 270a  n-settings.txt'.
-0001a1f0: 2020 2020 2020 2020 6865 6164 6572 203d          header =
-0001a200: 207b 2020 6d69 7174 762e 636f 6c5f 6865   {  miqtv.col_he
-0001a210: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-0001a220: 696d 6727 5d3a 2020 6d69 7174 762e 636f  img']:  miqtv.co
-0001a230: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-0001a240: 275d 5b27 696d 6727 5d2c 0a20 2020 2020  ']['img'],.     
-0001a250: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001a260: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0001a270: 276d 6172 6971 7427 5d5b 2761 6371 7569  'mariqt']['acqui
-0001a280: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
-0001a290: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
-0001a2a0: 6371 7569 275d 7d0a 2020 2020 2020 2020  cqui']}.        
-0001a2b0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-0001a2c0: 7328 696e 745f 6163 7175 6973 6974 696f  s(int_acquisitio
-0001a2d0: 6e53 6574 7469 6e67 5f66 696c 6529 2061  nSetting_file) a
-0001a2e0: 6e64 206e 6f74 206f 7665 7272 6964 653a  nd not override:
-0001a2f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001a300: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
-0001a310: 7461 625f 6669 6c65 2869 6e74 5f61 6371  tab_file(int_acq
-0001a320: 7569 7369 7469 6f6e 5365 7474 696e 675f  uisitionSetting_
-0001a330: 6669 6c65 2c22 5c74 222c 6865 6164 6572  file,"\t",header
-0001a340: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001a350: 7475 726e 2054 7275 652c 2022 5265 7375  turn True, "Resu
-0001a360: 6c74 2066 696c 6520 6578 6973 7473 220a  lt file exists".
-0001a370: 0a20 2020 2020 2020 2069 6d61 6765 7349  .        imagesI
-0001a380: 6e52 6177 203d 2073 656c 662e 696d 6167  nRaw = self.imag
-0001a390: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
-0001a3a0: 7465 644c 6973 7428 290a 2020 2020 2020  tedList().      
-0001a3b0: 2020 6966 206c 656e 2869 6d61 6765 7349    if len(imagesI
-0001a3c0: 6e52 6177 2920 3e20 303a 0a0a 2020 2020  nRaw) > 0:..    
-0001a3d0: 2020 2020 2020 2020 6f20 3d20 6f70 656e          o = open
-0001a3e0: 2869 6e74 5f61 6371 7569 7369 7469 6f6e  (int_acquisition
-0001a3f0: 5365 7474 696e 675f 6669 6c65 2c20 2277  Setting_file, "w
-0001a400: 2229 0a20 2020 2020 2020 2020 2020 206f  ").            o
-0001a410: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
-0001a420: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-0001a430: 5d5b 2769 6d67 275d 202b 2022 5c74 222b  ]['img'] + "\t"+
-0001a440: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-0001a450: 5b27 6d61 7269 7174 275d 5b27 6163 7175  ['mariqt']['acqu
-0001a460: 6927 5d2b 225c 6e22 290a 200a 2020 2020  i']+"\n"). .    
-0001a470: 2020 2020 2020 2020 696d 6167 6573 4578          imagesEx
-0001a480: 6966 7320 3d20 6d69 7174 692e 6765 7449  ifs = miqti.getI
-0001a490: 6d61 6765 7341 6c6c 4578 6966 5661 6c75  magesAllExifValu
-0001a4a0: 6573 2869 6d61 6765 7349 6e52 6177 2c73  es(imagesInRaw,s
-0001a4b0: 656c 662e 7072 6f76 290a 2020 2020 2020  elf.prov).      
-0001a4c0: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
-0001a4d0: 6e20 696d 6167 6573 4578 6966 733a 0a20  n imagesExifs:. 
-0001a4e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001a4f0: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
-0001a500: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
-0001a510: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a520: 2020 6f2e 7772 6974 6528 6669 6c65 5f6e    o.write(file_n
-0001a530: 616d 652b 225c 7422 2b73 7472 2869 6d61  ame+"\t"+str(ima
-0001a540: 6765 7345 7869 6673 5b66 696c 655d 292b  gesExifs[file])+
-0001a550: 225c 6e22 290a 0a20 2020 2020 2020 2020  "\n")..         
-0001a560: 2020 206f 2e63 6c6f 7365 2829 0a0a 2020     o.close()..  
-0001a570: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0001a580: 6464 5f69 7465 6d5f 696e 666f 5f74 6162  dd_item_info_tab
-0001a590: 5f66 696c 6528 696e 745f 6163 7175 6973  _file(int_acquis
-0001a5a0: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
-0001a5b0: 652c 225c 7422 2c68 6561 6465 7229 0a20  e,"\t",header). 
-0001a5c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001a5d0: 6e20 5472 7565 2c20 2243 7265 6174 6564  n True, "Created
-0001a5e0: 2061 6371 7569 7369 7469 6f6e 2073 6574   acquisition set
-0001a5f0: 7469 6e67 7320 6669 6c65 220a 2020 2020  tings file".    
-0001a600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a610: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001a620: 7365 2c20 224e 6f20 696d 6167 6573 2066  se, "No images f
-0001a630: 6f75 6e64 220a 0a0a 2020 2020 6465 6620  ound"...    def 
-0001a640: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-0001a650: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-0001a660: 2072 6574 7572 6e20 636f 7079 2e64 6565   return copy.dee
-0001a670: 7063 6f70 7928 7365 6c66 2e5f 696d 6167  pcopy(self._imag
-0001a680: 6573 496e 496d 6167 6573 4469 7229 0a0a  esInImagesDir)..
-0001a690: 2020 2020 6465 6620 696d 6167 6573 496e      def imagesIn
-0001a6a0: 496d 6167 6573 4469 7253 6f72 7465 644c  ImagesDirSortedL
-0001a6b0: 6973 7428 7365 6c66 293a 0a20 2020 2020  ist(self):.     
-0001a6c0: 2020 2072 6574 7572 6e20 636f 7079 2e64     return copy.d
-0001a6d0: 6565 7063 6f70 7928 7365 6c66 2e5f 696d  eepcopy(self._im
-0001a6e0: 6167 6573 496e 496d 6167 6573 4469 7253  agesInImagesDirS
-0001a6f0: 6f72 7465 644c 6973 7429 0a0a 0a20 2020  ortedList)...   
-0001a700: 2064 6566 2070 6172 7365 4974 656d 4461   def parseItemDa
-0001a710: 7461 6672 6f6d 5461 6246 696c 6544 6174  tafromTabFileDat
-0001a720: 6128 7365 6c66 2c20 6974 656d 733a 2064  a(self, items: d
-0001a730: 6963 742c 2066 696c 653a 2073 7472 2c20  ict, file: str, 
-0001a740: 636f 6c73 3a20 6c69 7374 2c20 6f70 7469  cols: list, opti
-0001a750: 6f6e 616c 3a20 6c69 7374 203d 205b 5d2c  onal: list = [],
-0001a760: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-0001a770: 3a73 7472 3d6d 6971 7476 2e64 6174 655f  :str=miqtv.date_
-0001a780: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
-0001a790: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
-0001a7a0: 7061 7273 6573 2064 6174 6120 6672 6f6d  parses data from
-0001a7b0: 2063 6f6c 756d 6e73 2069 6e20 636f 6c73   columns in cols
-0001a7c0: 2061 6e64 2077 7269 7465 7320 696e 666f   and writes info
-0001a7d0: 2074 6f20 6974 656d 732e 2043 6f6c 756d   to items. Colum
-0001a7e0: 6e20 2769 6d61 6765 2d66 696c 656e 616d  n 'image-filenam
-0001a7f0: 6527 206d 7573 7420 6265 2069 6e20 6669  e' must be in fi
-0001a800: 6c65 2061 6e64 2064 6f65 7320 6e6f 7420  le and does not 
-0001a810: 6e65 6564 2074 6f20 6265 2070 6173 7365  need to be passe
-0001a820: 6420 696e 2063 6f6c 732e 200a 2020 2020  d in cols. .    
-0001a830: 2020 2020 2020 2020 4669 6c65 206d 7573          File mus
-0001a840: 7420 6265 2074 6162 2073 6570 6172 6174  t be tab separat
-0001a850: 6564 2061 6e64 2063 6f6c 756d 6e73 206e  ed and columns n
-0001a860: 616d 6573 206d 7573 7420 6571 7561 6c20  ames must equal 
-0001a870: 6974 656d 2066 6965 6c64 206e 616d 6573  item field names
-0001a880: 2222 220a 2020 2020 2020 2020 746d 705f  """.        tmp_
-0001a890: 6461 7461 203d 206d 6971 7466 2e74 6162  data = miqtf.tab
-0001a8a0: 4669 6c65 4461 7461 2866 696c 652c 2063  FileData(file, c
-0001a8b0: 6f6c 732b 5b27 696d 6167 652d 6669 6c65  ols+['image-file
-0001a8c0: 6e61 6d65 275d 2b6f 7074 696f 6e61 6c2c  name']+optional,
-0001a8d0: 206b 6579 5f63 6f6c 3d27 696d 6167 652d   key_col='image-
-0001a8e0: 6669 6c65 6e61 6d65 272c 206f 7074 696f  filename', optio
-0001a8f0: 6e61 6c3d 6f70 7469 6f6e 616c 2c63 6f6e  nal=optional,con
-0001a900: 7665 7274 3d54 7275 6529 0a20 2020 2020  vert=True).     
-0001a910: 2020 2073 656c 662e 7772 6974 6550 6172     self.writePar
-0001a920: 7365 6444 6174 6154 6f49 7465 6d73 2874  sedDataToItems(t
-0001a930: 6d70 5f64 6174 612c 6974 656d 732c 7365  mp_data,items,se
-0001a940: 6c66 2e69 6664 6f5f 746d 705b 6d69 7174  lf.ifdo_tmp[miqt
-0001a950: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
-0001a960: 6572 5f6b 6579 5d2c 2064 6174 6574 696d  er_key], datetim
-0001a970: 655f 666f 726d 6174 3d64 6174 6574 696d  e_format=datetim
-0001a980: 655f 666f 726d 6174 290a 0a0a 2020 2020  e_format)...    
-0001a990: 6465 6620 7072 6173 6549 7465 6d44 6174  def praseItemDat
-0001a9a0: 6146 726f 6d46 696c 6528 7365 6c66 2c69  aFromFile(self,i
-0001a9b0: 7465 6d73 3a64 6963 742c 6669 6c65 3a73  tems:dict,file:s
-0001a9c0: 7472 2c73 6570 6172 6174 6f72 3a73 7472  tr,separator:str
-0001a9d0: 2c68 6561 6465 723a 6469 6374 2c20 6461  ,header:dict, da
-0001a9e0: 7465 7469 6d65 5f66 6f72 6d61 743a 7374  tetime_format:st
-0001a9f0: 723d 6d69 7174 762e 6461 7465 5f66 6f72  r=miqtv.date_for
-0001aa00: 6d61 7473 5b27 6d61 7269 7174 275d 293a  mats['mariqt']):
-0001aa10: 0a20 2020 2020 2020 2022 2222 2070 6172  .        """ par
-0001aa20: 7365 7320 6461 7461 2066 726f 6d20 6672  ses data from fr
-0001aa30: 6f6d 2066 696c 6520 746f 2069 7465 6d73  om file to items
-0001aa40: 2e20 6865 6164 6572 2064 6963 7420 6d75  . header dict mu
-0001aa50: 7374 2062 6520 6f66 2073 7472 7563 7475  st be of structu
-0001aa60: 7265 3a20 7b3c 6974 656d 2d66 6965 6c64  re: {<item-field
-0001aa70: 2d6e 616d 653e 3a3c 636f 6c75 6d6e 2d6e  -name>:<column-n
-0001aa80: 616d 653e 7d0a 2020 2020 2020 2020 2020  ame>}.          
-0001aa90: 2020 616e 6420 6d75 7374 2063 6f6e 7461    and must conta
-0001aaa0: 696e 2065 6e74 7279 2027 696d 6167 652d  in entry 'image-
-0001aab0: 6669 6c65 6e61 6d65 2720 2222 220a 2020  filename' """.  
-0001aac0: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
-0001aad0: 6167 652d 6669 6c65 6e61 6d65 2720 696e  age-filename' in
-0001aae0: 2068 6561 6465 723a 0a20 2020 2020 2020   header:.       
-0001aaf0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0001ab00: 7469 6f6e 2822 6865 6164 6572 2064 6f65  tion("header doe
-0001ab10: 7320 6e6f 7420 636f 6e74 6169 6e20 2769  s not contain 'i
-0001ab20: 6d61 6765 2d66 696c 656e 616d 6527 2229  mage-filename'")
-0001ab30: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0001ab40: 2020 746d 705f 6461 7461 203d 206d 6971    tmp_data = miq
-0001ab50: 7466 2e74 6162 4669 6c65 4461 7461 2866  tf.tabFileData(f
-0001ab60: 696c 652c 2068 6561 6465 722c 636f 6c5f  ile, header,col_
-0001ab70: 7365 7061 7261 746f 723d 7365 7061 7261  separator=separa
-0001ab80: 746f 722c 206b 6579 5f63 6f6c 3d27 696d  tor, key_col='im
-0001ab90: 6167 652d 6669 6c65 6e61 6d65 272c 636f  age-filename',co
-0001aba0: 6e76 6572 743d 5472 7565 290a 2020 2020  nvert=True).    
-0001abb0: 2020 2020 7365 6c66 2e77 7269 7465 5061      self.writePa
-0001abc0: 7273 6564 4461 7461 546f 4974 656d 7328  rsedDataToItems(
-0001abd0: 746d 705f 6461 7461 2c69 7465 6d73 2c73  tmp_data,items,s
-0001abe0: 656c 662e 6966 646f 5f74 6d70 5b6d 6971  elf.ifdo_tmp[miq
-0001abf0: 7476 2e69 6d61 6765 5f73 6574 5f68 6561  tv.image_set_hea
-0001ac00: 6465 725f 6b65 795d 2c20 6461 7465 7469  der_key], dateti
-0001ac10: 6d65 5f66 6f72 6d61 743d 6461 7465 7469  me_format=dateti
-0001ac20: 6d65 5f66 6f72 6d61 7429 0a0a 0a20 2020  me_format)...   
-0001ac30: 2064 6566 2077 7269 7465 5061 7273 6564   def writeParsed
-0001ac40: 4461 7461 546f 4974 656d 7328 7365 6c66  DataToItems(self
-0001ac50: 2c64 6174 613a 6469 6374 2c69 7465 6d73  ,data:dict,items
-0001ac60: 3a64 6963 742c 6865 6164 6572 3a64 6963  :dict,header:dic
-0001ac70: 742c 2064 6174 6574 696d 655f 666f 726d  t, datetime_form
-0001ac80: 6174 3a73 7472 3d6d 6971 7476 2e64 6174  at:str=miqtv.dat
-0001ac90: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-0001aca0: 7427 5d29 3a0a 0a20 2020 2020 2020 2023  t']):..        #
-0001acb0: 2065 7661 6c20 7374 7269 6e67 7320 6173   eval strings as
-0001acc0: 2064 6963 7420 6f72 206c 6973 740a 2020   dict or list.  
-0001acd0: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
-0001ace0: 7273 6976 6545 7661 6c28 6461 7461 290a  rsiveEval(data).
-0001acf0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0001ad00: 6d69 7174 632e 7265 6375 7273 6976 656c  miqtc.recursivel
-0001ad10: 7952 656d 6f76 6545 6d70 7479 4669 656c  yRemoveEmptyFiel
-0001ad20: 6473 2864 6174 612c 636f 6e74 656e 7432  ds(data,content2
-0001ad30: 6265 5265 6d6f 7665 643d 4e6f 6e65 290a  beRemoved=None).
-0001ad40: 0a20 2020 2020 2020 2023 2070 6f74 656e  .        # poten
-0001ad50: 7461 696c 6c79 2072 656d 6f76 6520 636f  tailly remove co
-0001ad60: 6e73 7420 6461 7461 2066 726f 6d20 6974  nst data from it
-0001ad70: 656d 7320 616e 6420 7075 7420 696e 2068  ems and put in h
-0001ad80: 6561 6465 720a 2020 2020 2020 2020 7365  eader.        se
-0001ad90: 6c66 2e65 7874 7261 6374 436f 6e73 7444  lf.extractConstD
-0001ada0: 6174 6156 616c 7565 7328 6461 7461 2c68  ataValues(data,h
-0001adb0: 6561 6465 7229 0a0a 2020 2020 2020 2020  eader)..        
-0001adc0: 2320 6164 6420 2769 6d61 6765 2d66 696c  # add 'image-fil
-0001add0: 656e 616d 6527 2066 6965 6c64 0a20 2020  ename' field.   
-0001ade0: 2020 2020 2066 6f72 2069 6d67 2c20 656e       for img, en
-0001adf0: 7472 7920 696e 2064 6174 612e 6974 656d  try in data.item
-0001ae00: 7328 293a 0a0a 2020 2020 2020 2020 2020  s():..          
-0001ae10: 2020 2320 6c69 7374 0a20 2020 2020 2020    # list.       
-0001ae20: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0001ae30: 6365 2865 6e74 7279 2c6c 6973 7429 3a0a  ce(entry,list):.
-0001ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae50: 666f 7220 6c69 7374 4974 656d 2069 6e20  for listItem in 
-0001ae60: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
-0001ae70: 2020 2020 2020 2020 2020 206c 6973 7449             listI
-0001ae80: 7465 6d5b 2769 6d61 6765 2d66 696c 656e  tem['image-filen
-0001ae90: 616d 6527 5d20 3d20 696d 670a 2020 2020  ame'] = img.    
-0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aeb0: 2320 636f 7665 7274 2064 6174 6574 696d  # covert datetim
-0001aec0: 6520 7374 7269 6e67 0a20 2020 2020 2020  e string.       
-0001aed0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001aee0: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0001aef0: 2069 6e20 6c69 7374 4974 656d 3a0a 2020   in listItem:.  
+000194a0: 2020 2020 2020 206c 696e 6573 203d 2072         lines = r
+000194b0: 6573 2e72 6561 646c 696e 6573 2829 0a20  es.readlines(). 
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194d0: 2020 2020 2020 2072 6573 2e63 6c6f 7365         res.close
+000194e0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+000194f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00019500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019510: 2020 2020 206c 696e 6573 203d 205b 5d0a       lines = [].
+00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019530: 2020 2020 6920 3d20 300a 2020 2020 2020      i = 0.      
+00019540: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00019550: 6e65 4e72 203d 2069 0a20 2020 2020 2020  neNr = i.       
+00019560: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00019570: 206c 696e 6520 696e 206c 696e 6573 3a0a   line in lines:.
+00019580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019590: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+000195a0: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
+000195b0: 2920 696e 206c 696e 653a 0a20 2020 2020  ) in line:.     
+000195c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195d0: 2020 2020 2020 206c 696e 654e 7220 3d20         lineNr = 
+000195e0: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
+000195f0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00019600: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00019610: 2020 2020 2020 2020 2020 2020 6920 2b3d              i +=
+00019620: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00019630: 2020 2020 2020 2069 6620 6c69 6e65 4e72         if lineNr
+00019640: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
+00019650: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00019660: 656c 206c 696e 6573 5b6c 696e 654e 725d  el lines[lineNr]
+00019670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019680: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
+00019690: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
+000196a0: 5f75 7569 645f 6669 6c65 2829 2c20 2277  _uuid_file(), "w
+000196b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000196c0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+000196d0: 7269 7465 6c69 6e65 7328 6c69 6e65 7329  ritelines(lines)
+000196e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000196f0: 2020 2020 2020 2020 2072 6573 2e63 6c6f           res.clo
+00019700: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+00019710: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+00019720: 7863 6570 7469 6f6e 2820 2246 696c 6520  xception( "File 
+00019730: 2220 2b20 6669 6c65 202b 2022 2064 6f65  " + file + " doe
+00019740: 7320 6e6f 7420 636f 7461 696e 2061 2076  s not cotain a v
+00019750: 616c 6964 2055 5549 442e 2052 756e 2063  alid UUID. Run c
+00019760: 7265 6174 655f 7575 6964 5f66 696c 6528  reate_uuid_file(
+00019770: 2920 6669 7273 7421 2229 0a0a 2020 2020  ) first!")..    
+00019780: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00019790: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
+000197a0: 6261 7365 6e61 6d65 2866 696c 6529 0a20  basename(file). 
+000197b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000197c0: 6620 6e6f 7420 7265 5265 6164 416c 6c20  f not reReadAll 
+000197d0: 616e 6420 6669 6c65 5f6e 616d 6520 696e  and file_name in
+000197e0: 2068 6173 6865 733a 0a20 2020 2020 2020   hashes:.       
+000197f0: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00019800: 6865 735b 6669 6c65 5f6e 616d 655d 203d  hes[file_name] =
+00019810: 2068 6173 6865 735b 6669 6c65 5f6e 616d   hashes[file_nam
+00019820: 655d 5b6d 6971 7476 2e63 6f6c 5f68 6561  e][miqtv.col_hea
+00019830: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
+00019840: 6173 6827 5d5d 0a20 2020 2020 2020 2020  ash']].         
+00019850: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00019860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019870: 2068 6173 6865 735b 6669 6c65 5f6e 616d   hashes[file_nam
+00019880: 655d 203d 206d 6971 7463 2e73 6861 3235  e] = miqtc.sha25
+00019890: 3648 6173 6846 696c 6528 6669 6c65 290a  6HashFile(file).
+000198a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198b0: 2020 2020 6164 6465 645f 6861 7368 6573      added_hashes
+000198c0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+000198d0: 2020 7072 6f67 2e63 6c65 6172 2829 0a0a    prog.clear()..
+000198e0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000198f0: 6552 6561 6441 6c6c 206f 7220 6164 6465  eReadAll or adde
+00019900: 645f 6861 7368 6573 203e 2030 3a0a 2020  d_hashes > 0:.  
+00019910: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00019920: 7368 5f66 696c 6520 3d20 6f70 656e 2873  sh_file = open(s
+00019930: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
+00019940: 5f66 696c 6528 292c 2022 7722 290a 2020  _file(), "w").  
+00019950: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00019960: 7368 5f66 696c 652e 7772 6974 6528 206d  sh_file.write( m
+00019970: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00019980: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
+00019990: 2b22 5c74 222b 6d69 7174 762e 636f 6c5f  +"\t"+miqtv.col_
+000199a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+000199b0: 5b27 6861 7368 275d 2b22 5c6e 2229 0a20  ['hash']+"\n"). 
+000199c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000199d0: 6f72 2066 696c 655f 6e61 6d65 2069 6e20  or file_name in 
+000199e0: 6861 7368 6573 3a0a 2020 2020 2020 2020  hashes:.        
+000199f0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00019a00: 5f66 696c 652e 7772 6974 6528 6669 6c65  _file.write(file
+00019a10: 5f6e 616d 652b 225c 7422 2b68 6173 6865  _name+"\t"+hashe
+00019a20: 735b 6669 6c65 5f6e 616d 655d 2b22 5c6e  s[file_name]+"\n
+00019a30: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00019a40: 2020 2020 6861 7368 5f66 696c 652e 636c      hash_file.cl
+00019a50: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+00019a60: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00019a70: 652c 2022 4164 6465 6420 222b 7374 7228  e, "Added "+str(
+00019a80: 6164 6465 645f 6861 7368 6573 292b 2220  added_hashes)+" 
+00019a90: 6861 7368 6573 2074 6f20 6861 7368 2066  hashes to hash f
+00019aa0: 696c 6522 0a20 2020 2020 2020 2020 2020  ile".           
+00019ab0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00019ac0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00019ad0: 7565 2c20 2241 6c6c 2068 6173 6865 7320  ue, "All hashes 
+00019ae0: 6578 6973 7422 0a0a 2020 2020 2020 2020  exist"..        
+00019af0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00019b00: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00019b10: 224e 6f20 696d 6167 6573 2066 6f75 6e64  "No images found
+00019b20: 2074 6f20 6861 7368 220a 2020 2020 2020   to hash".      
+00019b30: 2020 0a20 2020 2064 6566 2063 7265 6174    .    def creat
+00019b40: 6549 6d61 6765 5348 4132 3536 4669 6c65  eImageSHA256File
+00019b50: 2873 656c 662c 7265 5265 6164 416c 6c3d  (self,reReadAll=
+00019b60: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
+00019b70: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
+00019b80: 7573 6520 6372 6561 7465 5f69 6d61 6765  use create_image
+00019b90: 5f73 6861 3235 365f 6669 6c65 2022 2222  _sha256_file """
+00019ba0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019bb0: 7365 6c66 2e63 7265 6174 655f 696d 6167  self.create_imag
+00019bc0: 655f 7368 6132 3536 5f66 696c 6528 7265  e_sha256_file(re
+00019bd0: 5265 6164 416c 6c29 0a0a 0a20 2020 2064  ReadAll)...    d
+00019be0: 6566 2063 7265 6174 655f 7374 6172 745f  ef create_start_
+00019bf0: 7469 6d65 5f66 696c 6528 7365 6c66 293a  time_file(self):
+00019c00: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
+00019c10: 6174 6573 2069 6e20 2f69 6e74 6572 6d65  ates in /interme
+00019c20: 6469 6174 6520 6120 7465 7874 2066 696c  diate a text fil
+00019c30: 6520 636f 6e74 6169 6e69 6e67 2070 6572  e containing per
+00019c40: 2069 6d61 6765 2069 7473 2073 7461 7274   image its start
+00019c50: 2074 696d 6520 7061 7273 6564 2066 726f   time parsed fro
+00019c60: 6d20 7468 6520 6669 6c65 206e 616d 6520  m the file name 
+00019c70: 2222 220a 0a20 2020 2020 2020 2073 203d  """..        s =
+00019c80: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
+00019c90: 696e 674d 7367 2822 4372 6561 7469 6e67  ingMsg("Creating
+00019ca0: 2069 6e74 6572 6d65 6469 6174 6520 7374   intermediate st
+00019cb0: 6172 7474 696d 6520 6669 6c65 2022 290a  arttime file ").
+00019cc0: 2020 2020 2020 2020 696d 6167 6573 496e          imagesIn
+00019cd0: 5261 7720 3d20 7365 6c66 2e69 6d61 6765  Raw = self.image
+00019ce0: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
+00019cf0: 6564 4c69 7374 2829 0a20 2020 2020 2020  edList().       
+00019d00: 2069 6620 6c65 6e28 696d 6167 6573 496e   if len(imagesIn
+00019d10: 5261 7729 203e 2030 3a0a 0a20 2020 2020  Raw) > 0:..     
+00019d20: 2020 2020 2020 206f 203d 206f 7065 6e28         o = open(
+00019d30: 7365 6c66 2e67 6574 5f69 6e74 5f73 7461  self.get_int_sta
+00019d40: 7274 5469 6d65 735f 6669 6c65 2829 2c20  rtTimes_file(), 
+00019d50: 2277 2229 0a20 2020 2020 2020 2020 2020  "w").           
+00019d60: 206f 2e77 7269 7465 286d 6971 7476 2e63   o.write(miqtv.c
+00019d70: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00019d80: 7427 5d5b 2769 6d67 275d 202b 0a20 2020  t']['img'] +.   
+00019d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019da0: 2022 5c74 222b 6d69 7174 762e 636f 6c5f   "\t"+miqtv.col_
+00019db0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00019dc0: 5b27 7574 6327 5d2b 225c 6e22 290a 0a20  ['utc']+"\n").. 
+00019dd0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+00019de0: 696c 6520 696e 2069 6d61 6765 7349 6e52  ile in imagesInR
+00019df0: 6177 3a0a 2020 2020 2020 2020 2020 2020  aw:.            
+00019e00: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
+00019e10: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00019e20: 2866 696c 6529 0a0a 2020 2020 2020 2020  (file)..        
+00019e30: 2020 2020 2020 2020 6474 203d 206d 6971          dt = miq
+00019e40: 7463 2e70 6172 7365 4669 6c65 4461 7465  tc.parseFileDate
+00019e50: 5469 6d65 4173 5554 4328 6669 6c65 5f6e  TimeAsUTC(file_n
+00019e60: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00019e70: 2020 2020 206f 2e77 7269 7465 2866 696c       o.write(fil
+00019e80: 655f 6e61 6d65 2b22 5c74 2220 2b20 6474  e_name+"\t" + dt
+00019e90: 2e73 7472 6674 696d 6528 6d69 7174 762e  .strftime(miqtv.
+00019ea0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+00019eb0: 7269 7174 275d 292b 225c 6e22 290a 0a20  riqt'])+"\n").. 
+00019ec0: 2020 2020 2020 2020 2020 206f 2e63 6c6f             o.clo
+00019ed0: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+00019ee0: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
+00019ef0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00019f00: 652c 2022 4372 6561 7465 6420 7374 6172  e, "Created star
+00019f10: 7420 7469 6d65 2066 696c 6522 0a20 2020  t time file".   
+00019f20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00019f30: 2020 2020 2020 2073 2e73 746f 7028 290a         s.stop().
+00019f40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00019f50: 726e 2046 616c 7365 2c20 224e 6f20 696d  rn False, "No im
+00019f60: 6167 6573 2066 6f75 6e64 2074 6f20 7265  ages found to re
+00019f70: 6164 2073 7461 7274 2074 696d 6573 220a  ad start times".
+00019f80: 2020 2020 2020 2020 0a20 2020 2064 6566          .    def
+00019f90: 2063 7265 6174 6553 7461 7274 5469 6d65   createStartTime
+00019fa0: 4669 6c65 2873 656c 6629 3a0a 2020 2020  File(self):.    
+00019fb0: 2020 2020 2222 2220 4465 7072 6563 6174      """ Deprecat
+00019fc0: 6564 202d 2075 7365 2063 7265 6174 655f  ed - use create_
+00019fd0: 7374 6172 745f 7469 6d65 5f66 696c 6520  start_time_file 
+00019fe0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00019ff0: 726e 2073 656c 662e 6372 6561 7465 5f73  rn self.create_s
+0001a000: 7461 7274 5f74 696d 655f 6669 6c65 2829  tart_time_file()
+0001a010: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
+0001a020: 6541 6371 7569 7369 7469 6f6e 5365 7474  eAcquisitionSett
+0001a030: 696e 6773 4558 4946 4669 6c65 2873 656c  ingsEXIFFile(sel
+0001a040: 662c 6f76 6572 7269 6465 3d46 616c 7365  f,override=False
+0001a050: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
+0001a060: 6570 7265 6361 7465 642e 2055 7365 2063  eprecated. Use c
+0001a070: 7265 6174 655f 6163 7175 6973 6974 696f  reate_acquisitio
+0001a080: 6e5f 7365 7474 696e 6773 5f65 7869 665f  n_settings_exif_
+0001a090: 6669 6c65 2829 2069 6e73 7465 6164 2e20  file() instead. 
+0001a0a0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0001a0b0: 726e 2073 656c 662e 6372 6561 7465 5f61  rn self.create_a
+0001a0c0: 6371 7569 7369 7469 6f6e 5f73 6574 7469  cquisition_setti
+0001a0d0: 6e67 735f 6578 6966 5f66 696c 6528 6f76  ngs_exif_file(ov
+0001a0e0: 6572 7269 6465 3d6f 7665 7272 6964 6529  erride=override)
+0001a0f0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+0001a100: 5f61 6371 7569 7369 7469 6f6e 5f73 6574  _acquisition_set
+0001a110: 7469 6e67 735f 6578 6966 5f66 696c 6528  tings_exif_file(
+0001a120: 7365 6c66 2c6f 7665 7272 6964 653d 4661  self,override=Fa
+0001a130: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+0001a140: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
+0001a150: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
+0001a160: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
+0001a170: 6720 7065 7220 696d 6167 6520 6120 6469  g per image a di
+0001a180: 6374 206f 6620 6578 6966 2074 6167 7320  ct of exif tags 
+0001a190: 616e 6420 7468 6569 7220 7661 6c75 6573  and their values
+0001a1a0: 2070 6172 7365 6420 6672 6f6d 2074 6865   parsed from the
+0001a1b0: 2069 6d61 6765 2022 2222 0a0a 2020 2020   image """..    
+0001a1c0: 2020 2020 696e 745f 6163 7175 6973 6974      int_acquisit
+0001a1d0: 696f 6e53 6574 7469 6e67 5f66 696c 6520  ionSetting_file 
+0001a1e0: 3d20 7365 6c66 2e5f 5f67 6574 5f69 6e74  = self.__get_int
+0001a1f0: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
+0001a200: 2027 5f69 6d61 6765 2d61 6371 7569 7369   '_image-acquisi
+0001a210: 7469 6f6e 2d73 6574 7469 6e67 732e 7478  tion-settings.tx
+0001a220: 7427 0a20 2020 2020 2020 2068 6561 6465  t'.        heade
+0001a230: 7220 3d20 7b20 206d 6971 7476 2e63 6f6c  r = {  miqtv.col
+0001a240: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0001a250: 5d5b 2769 6d67 275d 3a20 206d 6971 7476  ]['img']:  miqtv
+0001a260: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+0001a270: 6971 7427 5d5b 2769 6d67 275d 2c0a 2020  iqt']['img'],.  
+0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a290: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+0001a2a0: 6572 5b27 6d61 7269 7174 275d 5b27 6163  er['mariqt']['ac
+0001a2b0: 7175 6927 5d3a 6d69 7174 762e 636f 6c5f  qui']:miqtv.col_
+0001a2c0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+0001a2d0: 5b27 6163 7175 6927 5d7d 0a20 2020 2020  ['acqui']}.     
+0001a2e0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+0001a2f0: 6973 7473 2869 6e74 5f61 6371 7569 7369  ists(int_acquisi
+0001a300: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
+0001a310: 2920 616e 6420 6e6f 7420 6f76 6572 7269  ) and not overri
+0001a320: 6465 3a0a 2020 2020 2020 2020 2020 2020  de:.            
+0001a330: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
+0001a340: 666f 5f74 6162 5f66 696c 6528 696e 745f  fo_tab_file(int_
+0001a350: 6163 7175 6973 6974 696f 6e53 6574 7469  acquisitionSetti
+0001a360: 6e67 5f66 696c 652c 225c 7422 2c68 6561  ng_file,"\t",hea
+0001a370: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0001a380: 2072 6574 7572 6e20 5472 7565 2c20 2252   return True, "R
+0001a390: 6573 756c 7420 6669 6c65 2065 7869 7374  esult file exist
+0001a3a0: 7322 0a0a 2020 2020 2020 2020 696d 6167  s"..        imag
+0001a3b0: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
+0001a3c0: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+0001a3d0: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
+0001a3e0: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
+0001a3f0: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
+0001a400: 2020 2020 2020 2020 2020 206f 203d 206f             o = o
+0001a410: 7065 6e28 696e 745f 6163 7175 6973 6974  pen(int_acquisit
+0001a420: 696f 6e53 6574 7469 6e67 5f66 696c 652c  ionSetting_file,
+0001a430: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
+0001a440: 2020 6f2e 7772 6974 6528 6d69 7174 762e    o.write(miqtv.
+0001a450: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001a460: 7174 275d 5b27 696d 6727 5d20 2b20 225c  qt']['img'] + "\
+0001a470: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+0001a480: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
+0001a490: 6371 7569 275d 2b22 5c6e 2229 0a20 0a20  cqui']+"\n"). . 
+0001a4a0: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0001a4b0: 7345 7869 6673 203d 206d 6971 7469 2e67  sExifs = miqti.g
+0001a4c0: 6574 496d 6167 6573 416c 6c45 7869 6656  etImagesAllExifV
+0001a4d0: 616c 7565 7328 696d 6167 6573 496e 5261  alues(imagesInRa
+0001a4e0: 772c 7365 6c66 2e70 726f 7629 0a20 2020  w,self.prov).   
+0001a4f0: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+0001a500: 6520 696e 2069 6d61 6765 7345 7869 6673  e in imagesExifs
+0001a510: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a520: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
+0001a530: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
+0001a540: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0001a550: 2020 2020 206f 2e77 7269 7465 2866 696c       o.write(fil
+0001a560: 655f 6e61 6d65 2b22 5c74 222b 7374 7228  e_name+"\t"+str(
+0001a570: 696d 6167 6573 4578 6966 735b 6669 6c65  imagesExifs[file
+0001a580: 5d29 2b22 5c6e 2229 0a0a 2020 2020 2020  ])+"\n")..      
+0001a590: 2020 2020 2020 6f2e 636c 6f73 6528 290a        o.close().
+0001a5a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001a5b0: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
+0001a5c0: 7461 625f 6669 6c65 2869 6e74 5f61 6371  tab_file(int_acq
+0001a5d0: 7569 7369 7469 6f6e 5365 7474 696e 675f  uisitionSetting_
+0001a5e0: 6669 6c65 2c22 5c74 222c 6865 6164 6572  file,"\t",header
+0001a5f0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0001a600: 7475 726e 2054 7275 652c 2022 4372 6561  turn True, "Crea
+0001a610: 7465 6420 6163 7175 6973 6974 696f 6e20  ted acquisition 
+0001a620: 7365 7474 696e 6773 2066 696c 6522 0a20  settings file". 
+0001a630: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001a640: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001a650: 4661 6c73 652c 2022 4e6f 2069 6d61 6765  False, "No image
+0001a660: 7320 666f 756e 6422 0a0a 0a20 2020 2064  s found"...    d
+0001a670: 6566 2069 6d61 6765 7349 6e49 6d61 6765  ef imagesInImage
+0001a680: 7344 6972 2873 656c 6629 3a0a 2020 2020  sDir(self):.    
+0001a690: 2020 2020 7265 7475 726e 2063 6f70 792e      return copy.
+0001a6a0: 6465 6570 636f 7079 2873 656c 662e 5f69  deepcopy(self._i
+0001a6b0: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+0001a6c0: 290a 0a20 2020 2064 6566 2069 6d61 6765  )..    def image
+0001a6d0: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
+0001a6e0: 6564 4c69 7374 2873 656c 6629 3a0a 2020  edList(self):.  
+0001a6f0: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
+0001a700: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+0001a710: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
+0001a720: 6972 536f 7274 6564 4c69 7374 290a 0a0a  irSortedList)...
+0001a730: 2020 2020 6465 6620 7061 7273 6549 7465      def parseIte
+0001a740: 6d44 6174 6166 726f 6d54 6162 4669 6c65  mDatafromTabFile
+0001a750: 4461 7461 2873 656c 662c 2069 7465 6d73  Data(self, items
+0001a760: 3a20 6469 6374 2c20 6669 6c65 3a20 7374  : dict, file: st
+0001a770: 722c 2063 6f6c 733a 206c 6973 742c 206f  r, cols: list, o
+0001a780: 7074 696f 6e61 6c3a 206c 6973 7420 3d20  ptional: list = 
+0001a790: 5b5d 2c20 6461 7465 7469 6d65 5f66 6f72  [], datetime_for
+0001a7a0: 6d61 743a 7374 723d 6d69 7174 762e 6461  mat:str=miqtv.da
+0001a7b0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+0001a7c0: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
+0001a7d0: 2222 2070 6172 7365 7320 6461 7461 2066  "" parses data f
+0001a7e0: 726f 6d20 636f 6c75 6d6e 7320 696e 2063  rom columns in c
+0001a7f0: 6f6c 7320 616e 6420 7772 6974 6573 2069  ols and writes i
+0001a800: 6e66 6f20 746f 2069 7465 6d73 2e20 436f  nfo to items. Co
+0001a810: 6c75 6d6e 2027 696d 6167 652d 6669 6c65  lumn 'image-file
+0001a820: 6e61 6d65 2720 6d75 7374 2062 6520 696e  name' must be in
+0001a830: 2066 696c 6520 616e 6420 646f 6573 206e   file and does n
+0001a840: 6f74 206e 6565 6420 746f 2062 6520 7061  ot need to be pa
+0001a850: 7373 6564 2069 6e20 636f 6c73 2e20 0a20  ssed in cols. . 
+0001a860: 2020 2020 2020 2020 2020 2046 696c 6520             File 
+0001a870: 6d75 7374 2062 6520 7461 6220 7365 7061  must be tab sepa
+0001a880: 7261 7465 6420 616e 6420 636f 6c75 6d6e  rated and column
+0001a890: 7320 6e61 6d65 7320 6d75 7374 2065 7175  s names must equ
+0001a8a0: 616c 2069 7465 6d20 6669 656c 6420 6e61  al item field na
+0001a8b0: 6d65 7322 2222 0a20 2020 2020 2020 2074  mes""".        t
+0001a8c0: 6d70 5f64 6174 6120 3d20 6d69 7174 662e  mp_data = miqtf.
+0001a8d0: 7461 6246 696c 6544 6174 6128 6669 6c65  tabFileData(file
+0001a8e0: 2c20 636f 6c73 2b5b 2769 6d61 6765 2d66  , cols+['image-f
+0001a8f0: 696c 656e 616d 6527 5d2b 6f70 7469 6f6e  ilename']+option
+0001a900: 616c 2c20 6b65 795f 636f 6c3d 2769 6d61  al, key_col='ima
+0001a910: 6765 2d66 696c 656e 616d 6527 2c20 6f70  ge-filename', op
+0001a920: 7469 6f6e 616c 3d6f 7074 696f 6e61 6c2c  tional=optional,
+0001a930: 636f 6e76 6572 743d 5472 7565 290a 2020  convert=True).  
+0001a940: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
+0001a950: 5061 7273 6564 4461 7461 546f 4974 656d  ParsedDataToItem
+0001a960: 7328 746d 705f 6461 7461 2c69 7465 6d73  s(tmp_data,items
+0001a970: 2c73 656c 662e 6966 646f 5f74 6d70 5b6d  ,self.ifdo_tmp[m
+0001a980: 6971 7476 2e69 6d61 6765 5f73 6574 5f68  iqtv.image_set_h
+0001a990: 6561 6465 725f 6b65 795d 2c20 6461 7465  eader_key], date
+0001a9a0: 7469 6d65 5f66 6f72 6d61 743d 6461 7465  time_format=date
+0001a9b0: 7469 6d65 5f66 6f72 6d61 7429 0a0a 0a20  time_format)... 
+0001a9c0: 2020 2064 6566 2070 7261 7365 4974 656d     def praseItem
+0001a9d0: 4461 7461 4672 6f6d 4669 6c65 2873 656c  DataFromFile(sel
+0001a9e0: 662c 6974 656d 733a 6469 6374 2c66 696c  f,items:dict,fil
+0001a9f0: 653a 7374 722c 7365 7061 7261 746f 723a  e:str,separator:
+0001aa00: 7374 722c 6865 6164 6572 3a64 6963 742c  str,header:dict,
+0001aa10: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
+0001aa20: 3a73 7472 3d6d 6971 7476 2e64 6174 655f  :str=miqtv.date_
+0001aa30: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
+0001aa40: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
+0001aa50: 7061 7273 6573 2064 6174 6120 6672 6f6d  parses data from
+0001aa60: 2066 726f 6d20 6669 6c65 2074 6f20 6974   from file to it
+0001aa70: 656d 732e 2068 6561 6465 7220 6469 6374  ems. header dict
+0001aa80: 206d 7573 7420 6265 206f 6620 7374 7275   must be of stru
+0001aa90: 6374 7572 653a 207b 3c69 7465 6d2d 6669  cture: {<item-fi
+0001aaa0: 656c 642d 6e61 6d65 3e3a 3c63 6f6c 756d  eld-name>:<colum
+0001aab0: 6e2d 6e61 6d65 3e7d 0a20 2020 2020 2020  n-name>}.       
+0001aac0: 2020 2020 2061 6e64 206d 7573 7420 636f       and must co
+0001aad0: 6e74 6169 6e20 656e 7472 7920 2769 6d61  ntain entry 'ima
+0001aae0: 6765 2d66 696c 656e 616d 6527 2022 2222  ge-filename' """
+0001aaf0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001ab00: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
+0001ab10: 2069 6e20 6865 6164 6572 3a0a 2020 2020   in header:.    
+0001ab20: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001ab30: 6365 7074 696f 6e28 2268 6561 6465 7220  ception("header 
+0001ab40: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
+0001ab50: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
+0001ab60: 2722 290a 2020 2020 2020 2020 0a20 2020  '").        .   
+0001ab70: 2020 2020 2074 6d70 5f64 6174 6120 3d20       tmp_data = 
+0001ab80: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
+0001ab90: 6128 6669 6c65 2c20 6865 6164 6572 2c63  a(file, header,c
+0001aba0: 6f6c 5f73 6570 6172 6174 6f72 3d73 6570  ol_separator=sep
+0001abb0: 6172 6174 6f72 2c20 6b65 795f 636f 6c3d  arator, key_col=
+0001abc0: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
+0001abd0: 2c63 6f6e 7665 7274 3d54 7275 6529 0a20  ,convert=True). 
+0001abe0: 2020 2020 2020 2073 656c 662e 7772 6974         self.writ
+0001abf0: 6550 6172 7365 6444 6174 6154 6f49 7465  eParsedDataToIte
+0001ac00: 6d73 2874 6d70 5f64 6174 612c 6974 656d  ms(tmp_data,item
+0001ac10: 732c 7365 6c66 2e69 6664 6f5f 746d 705b  s,self.ifdo_tmp[
+0001ac20: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+0001ac30: 6865 6164 6572 5f6b 6579 5d2c 2064 6174  header_key], dat
+0001ac40: 6574 696d 655f 666f 726d 6174 3d64 6174  etime_format=dat
+0001ac50: 6574 696d 655f 666f 726d 6174 290a 0a0a  etime_format)...
+0001ac60: 2020 2020 6465 6620 7772 6974 6550 6172      def writePar
+0001ac70: 7365 6444 6174 6154 6f49 7465 6d73 2873  sedDataToItems(s
+0001ac80: 656c 662c 6461 7461 3a64 6963 742c 6974  elf,data:dict,it
+0001ac90: 656d 733a 6469 6374 2c68 6561 6465 723a  ems:dict,header:
+0001aca0: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
+0001acb0: 6f72 6d61 743a 7374 723d 6d69 7174 762e  ormat:str=miqtv.
+0001acc0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+0001acd0: 7269 7174 275d 293a 0a0a 2020 2020 2020  riqt']):..      
+0001ace0: 2020 2320 6576 616c 2073 7472 696e 6773    # eval strings
+0001acf0: 2061 7320 6469 6374 206f 7220 6c69 7374   as dict or list
+0001ad00: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
+0001ad10: 6563 7572 7369 7665 4576 616c 2864 6174  ecursiveEval(dat
+0001ad20: 6129 0a0a 2020 2020 2020 2020 6461 7461  a)..        data
+0001ad30: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
+0001ad40: 7665 6c79 5265 6d6f 7665 456d 7074 7946  velyRemoveEmptyF
+0001ad50: 6965 6c64 7328 6461 7461 2c63 6f6e 7465  ields(data,conte
+0001ad60: 6e74 3262 6552 656d 6f76 6564 3d4e 6f6e  nt2beRemoved=Non
+0001ad70: 6529 0a0a 2020 2020 2020 2020 2320 706f  e)..        # po
+0001ad80: 7465 6e74 6169 6c6c 7920 7265 6d6f 7665  tentailly remove
+0001ad90: 2063 6f6e 7374 2064 6174 6120 6672 6f6d   const data from
+0001ada0: 2069 7465 6d73 2061 6e64 2070 7574 2069   items and put i
+0001adb0: 6e20 6865 6164 6572 0a20 2020 2020 2020  n header.       
+0001adc0: 2073 656c 662e 6578 7472 6163 7443 6f6e   self.extractCon
+0001add0: 7374 4461 7461 5661 6c75 6573 2864 6174  stDataValues(dat
+0001ade0: 612c 6865 6164 6572 290a 0a20 2020 2020  a,header)..     
+0001adf0: 2020 2023 2061 6464 2027 696d 6167 652d     # add 'image-
+0001ae00: 6669 6c65 6e61 6d65 2720 6669 656c 640a  filename' field.
+0001ae10: 2020 2020 2020 2020 666f 7220 696d 672c          for img,
+0001ae20: 2065 6e74 7279 2069 6e20 6461 7461 2e69   entry in data.i
+0001ae30: 7465 6d73 2829 3a0a 0a20 2020 2020 2020  tems():..       
+0001ae40: 2020 2020 2023 206c 6973 740a 2020 2020       # list.    
+0001ae50: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0001ae60: 7461 6e63 6528 656e 7472 792c 6c69 7374  tance(entry,list
+0001ae70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001ae80: 2020 2066 6f72 206c 6973 7449 7465 6d20     for listItem 
+0001ae90: 696e 2065 6e74 7279 3a0a 2020 2020 2020  in entry:.      
+0001aea0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0001aeb0: 7374 4974 656d 5b27 696d 6167 652d 6669  stItem['image-fi
+0001aec0: 6c65 6e61 6d65 275d 203d 2069 6d67 0a20  lename'] = img. 
+0001aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aee0: 2020 2023 2063 6f76 6572 7420 6461 7465     # covert date
+0001aef0: 7469 6d65 2073 7472 696e 670a 2020 2020  time string.    
 0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af10: 2020 2020 2020 6474 203d 2064 6174 6574        dt = datet
-0001af20: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
-0001af30: 7074 696d 6528 6c69 7374 4974 656d 5b27  ptime(listItem['
-0001af40: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-0001af50: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0001af60: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0001af70: 2020 2020 2020 2020 2020 206c 6973 7449             listI
-0001af80: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
-0001af90: 696d 6527 5d20 3d20 6474 2e73 7472 6674  ime'] = dt.strft
-0001afa0: 696d 6528 6d69 7174 762e 6461 7465 5f66  ime(miqtv.date_f
-0001afb0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-0001afc0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0001afd0: 6966 2069 7369 6e73 7461 6e63 6528 656e  if isinstance(en
-0001afe0: 7472 792c 6469 6374 293a 0a20 2020 2020  try,dict):.     
-0001aff0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
-0001b000: 5b27 696d 6167 652d 6669 6c65 6e61 6d65  ['image-filename
-0001b010: 275d 203d 2069 6d67 0a20 2020 2020 2020  '] = img.       
-0001b020: 2020 2020 2020 2020 2023 2063 6f76 6572           # cover
-0001b030: 7420 6461 7465 7469 6d65 2073 7472 696e  t datetime strin
-0001b040: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-0001b050: 2020 6966 2027 696d 6167 652d 6461 7465    if 'image-date
-0001b060: 7469 6d65 2720 696e 2065 6e74 7279 3a0a  time' in entry:.
-0001b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b080: 2020 2020 6474 203d 2064 6174 6574 696d      dt = datetim
-0001b090: 652e 6461 7465 7469 6d65 2e73 7472 7074  e.datetime.strpt
-0001b0a0: 696d 6528 656e 7472 795b 2769 6d61 6765  ime(entry['image
-0001b0b0: 2d64 6174 6574 696d 6527 5d2c 2064 6174  -datetime'], dat
-0001b0c0: 6574 696d 655f 666f 726d 6174 290a 2020  etime_format).  
-0001b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0e0: 2020 656e 7472 795b 2769 6d61 6765 2d64    entry['image-d
-0001b0f0: 6174 6574 696d 6527 5d20 3d20 6474 2e73  atetime'] = dt.s
-0001b100: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
-0001b110: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-0001b120: 7174 275d 290a 2020 2020 2020 2020 2020  qt']).          
-0001b130: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001b140: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-0001b150: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-0001b160: 6e28 2264 6174 6120 656e 7472 6965 7320  n("data entries 
-0001b170: 6d75 7374 2062 6520 6469 6374 206f 7220  must be dict or 
-0001b180: 6c69 7374 2069 6620 6469 6374 7322 290a  list if dicts").
-0001b190: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
-0001b1a0: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
-0001b1b0: 4469 6374 7328 6974 656d 732c 6461 7461  Dicts(items,data
-0001b1c0: 290a 0a0a 2020 2020 4073 7461 7469 636d  )...    @staticm
-0001b1d0: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
-0001b1e0: 7472 6163 7443 6f6e 7374 4461 7461 5661  tractConstDataVa
-0001b1f0: 6c75 6573 2864 6174 613a 6469 6374 2c68  lues(data:dict,h
-0001b200: 6561 6465 723a 6469 6374 293a 0a20 2020  eader:dict):.   
-0001b210: 2020 2020 2022 2222 2052 656d 6f76 6573       """ Removes
-0001b220: 2066 6965 6c64 7320 7468 6174 2061 7265   fields that are
-0001b230: 2063 6f6e 7374 616e 7420 666f 7220 616c   constant for al
-0001b240: 6c20 656e 7472 6965 7320 6672 6f6d 2064  l entries from d
-0001b250: 6174 6120 6469 6374 2061 6e64 2070 7574  ata dict and put
-0001b260: 2074 6865 6d20 696e 2068 6561 6465 7220   them in header 
-0001b270: 6469 6374 2e20 0a20 2020 2020 2020 2020  dict. .         
-0001b280: 2020 2045 6163 6820 656e 7472 7920 6f66     Each entry of
-0001b290: 2064 6174 6120 6d75 7374 2062 6520 6120   data must be a 
-0001b2a0: 6469 6374 2077 6974 6820 7468 6520 7361  dict with the sa
-0001b2b0: 6d65 2073 6574 206f 6620 6b65 7973 2e20  me set of keys. 
-0001b2c0: 2222 220a 2020 2020 0a20 2020 2020 2020  """.    .       
-0001b2d0: 2023 2073 6b69 7020 6966 2074 6865 7265   # skip if there
-0001b2e0: 2069 7320 6f6e 6c79 206f 6e65 2069 7465   is only one ite
-0001b2f0: 6d0a 2020 2020 2020 2020 6966 206c 656e  m.        if len
-0001b300: 286c 6973 7428 6461 7461 2e6b 6579 7328  (list(data.keys(
-0001b310: 2929 2920 3d3d 2031 3a0a 2020 2020 2020  ))) == 1:.      
-0001b320: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0001b330: 2020 2020 2020 6669 656c 6473 546f 4967        fieldsToIg
-0001b340: 6e6f 7265 203d 205b 2769 6d61 6765 2d64  nore = ['image-d
-0001b350: 6174 6574 696d 6527 5d0a 2020 2020 2020  atetime'].      
-0001b360: 2020 636f 6e73 7444 6174 6120 3d20 7b7d    constData = {}
-0001b370: 0a20 2020 2020 2020 2066 6972 7374 496d  .        firstIm
-0001b380: 6167 6520 3d20 5472 7565 0a20 2020 2020  age = True.     
-0001b390: 2020 2066 6f72 2069 6d61 6765 2c69 6d61     for image,ima
-0001b3a0: 6765 5f64 6174 6120 696e 2064 6174 612e  ge_data in data.
-0001b3b0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0001b3c0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0001b3d0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0001b3e0: 6e63 6528 696d 6167 655f 6461 7461 2c6c  nce(image_data,l
-0001b3f0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-0001b400: 2020 2020 2020 696d 6167 655f 6461 7461        image_data
-0001b410: 203d 205b 696d 6167 655f 6461 7461 5d0a   = [image_data].
-0001b420: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001b430: 6e6f 7420 6669 7273 7449 6d61 6765 2061  not firstImage a
-0001b440: 6e64 2063 6f6e 7374 4461 7461 203d 3d20  nd constData == 
-0001b450: 7b7d 3a0a 2020 2020 2020 2020 2020 2020  {}:.            
-0001b460: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0001b470: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0001b480: 2020 2066 6972 7374 5469 6d65 506f 696e     firstTimePoin
-0001b490: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
-0001b4a0: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
-0001b4b0: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
-0001b4c0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0001b4d0: 2020 2020 2020 2320 7665 7279 2066 6972        # very fir
-0001b4e0: 7374 2064 6174 6120 666f 7220 636f 6d70  st data for comp
-0001b4f0: 6172 6973 6f6e 0a20 2020 2020 2020 2020  arison.         
-0001b500: 2020 2020 2020 2069 6620 6669 7273 7449         if firstI
-0001b510: 6d61 6765 2061 6e64 2066 6972 7374 5469  mage and firstTi
-0001b520: 6d65 506f 696e 743a 0a20 2020 2020 2020  mePoint:.       
-0001b530: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001b540: 7374 4461 7461 203d 2063 6f70 792e 6465  stData = copy.de
-0001b550: 6570 636f 7079 2869 6d61 6765 5f74 705f  epcopy(image_tp_
-0001b560: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
-0001b570: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-0001b580: 656c 6420 696e 2066 6965 6c64 7354 6f49  eld in fieldsToI
-0001b590: 676e 6f72 653a 0a20 2020 2020 2020 2020  gnore:.         
-0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b5b0: 6620 6669 656c 6420 696e 2063 6f6e 7374  f field in const
-0001b5c0: 4461 7461 3a0a 2020 2020 2020 2020 2020  Data:.          
+0001af10: 6966 2027 696d 6167 652d 6461 7465 7469  if 'image-dateti
+0001af20: 6d65 2720 696e 206c 6973 7449 7465 6d3a  me' in listItem:
+0001af30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001af40: 2020 2020 2020 2020 2064 7420 3d20 6461           dt = da
+0001af50: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+0001af60: 7374 7270 7469 6d65 286c 6973 7449 7465  strptime(listIte
+0001af70: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+0001af80: 6527 5d2c 2064 6174 6574 696d 655f 666f  e'], datetime_fo
+0001af90: 726d 6174 290a 2020 2020 2020 2020 2020  rmat).          
+0001afa0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0001afb0: 7374 4974 656d 5b27 696d 6167 652d 6461  stItem['image-da
+0001afc0: 7465 7469 6d65 275d 203d 2064 742e 7374  tetime'] = dt.st
+0001afd0: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
+0001afe0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0001aff0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+0001b000: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0001b010: 2865 6e74 7279 2c64 6963 7429 3a0a 2020  (entry,dict):.  
+0001b020: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0001b030: 7472 795b 2769 6d61 6765 2d66 696c 656e  try['image-filen
+0001b040: 616d 6527 5d20 3d20 696d 670a 2020 2020  ame'] = img.    
+0001b050: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+0001b060: 7665 7274 2064 6174 6574 696d 6520 7374  vert datetime st
+0001b070: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
+0001b080: 2020 2020 2069 6620 2769 6d61 6765 2d64       if 'image-d
+0001b090: 6174 6574 696d 6527 2069 6e20 656e 7472  atetime' in entr
+0001b0a0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0001b0b0: 2020 2020 2020 2064 7420 3d20 6461 7465         dt = date
+0001b0c0: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
+0001b0d0: 7270 7469 6d65 2865 6e74 7279 5b27 696d  rptime(entry['im
+0001b0e0: 6167 652d 6461 7465 7469 6d65 275d 2c20  age-datetime'], 
+0001b0f0: 6461 7465 7469 6d65 5f66 6f72 6d61 7429  datetime_format)
+0001b100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b110: 2020 2020 2065 6e74 7279 5b27 696d 6167       entry['imag
+0001b120: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
+0001b130: 742e 7374 7266 7469 6d65 286d 6971 7476  t.strftime(miqtv
+0001b140: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+0001b150: 6172 6971 7427 5d29 0a20 2020 2020 2020  ariqt']).       
+0001b160: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001b170: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001b180: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+0001b190: 7469 6f6e 2822 6461 7461 2065 6e74 7269  tion("data entri
+0001b1a0: 6573 206d 7573 7420 6265 2064 6963 7420  es must be dict 
+0001b1b0: 6f72 206c 6973 7420 6966 2064 6963 7473  or list if dicts
+0001b1c0: 2229 0a0a 2020 2020 2020 2020 6d69 7174  ")..        miqt
+0001b1d0: 632e 7265 6375 7273 6976 656c 7955 7064  c.recursivelyUpd
+0001b1e0: 6174 6544 6963 7473 2869 7465 6d73 2c64  ateDicts(items,d
+0001b1f0: 6174 6129 0a0a 0a20 2020 2040 7374 6174  ata)...    @stat
+0001b200: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+0001b210: 2065 7874 7261 6374 436f 6e73 7444 6174   extractConstDat
+0001b220: 6156 616c 7565 7328 6461 7461 3a64 6963  aValues(data:dic
+0001b230: 742c 6865 6164 6572 3a64 6963 7429 3a0a  t,header:dict):.
+0001b240: 2020 2020 2020 2020 2222 2220 5265 6d6f          """ Remo
+0001b250: 7665 7320 6669 656c 6473 2074 6861 7420  ves fields that 
+0001b260: 6172 6520 636f 6e73 7461 6e74 2066 6f72  are constant for
+0001b270: 2061 6c6c 2065 6e74 7269 6573 2066 726f   all entries fro
+0001b280: 6d20 6461 7461 2064 6963 7420 616e 6420  m data dict and 
+0001b290: 7075 7420 7468 656d 2069 6e20 6865 6164  put them in head
+0001b2a0: 6572 2064 6963 742e 200a 2020 2020 2020  er dict. .      
+0001b2b0: 2020 2020 2020 4561 6368 2065 6e74 7279        Each entry
+0001b2c0: 206f 6620 6461 7461 206d 7573 7420 6265   of data must be
+0001b2d0: 2061 2064 6963 7420 7769 7468 2074 6865   a dict with the
+0001b2e0: 2073 616d 6520 7365 7420 6f66 206b 6579   same set of key
+0001b2f0: 732e 2022 2222 0a20 2020 200a 2020 2020  s. """.    .    
+0001b300: 2020 2020 2320 736b 6970 2069 6620 7468      # skip if th
+0001b310: 6572 6520 6973 206f 6e6c 7920 6f6e 6520  ere is only one 
+0001b320: 6974 656d 0a20 2020 2020 2020 2069 6620  item.        if 
+0001b330: 6c65 6e28 6c69 7374 2864 6174 612e 6b65  len(list(data.ke
+0001b340: 7973 2829 2929 203d 3d20 313a 0a20 2020  ys())) == 1:.   
+0001b350: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0001b360: 0a20 2020 2020 2020 2066 6965 6c64 7354  .        fieldsT
+0001b370: 6f49 676e 6f72 6520 3d20 5b27 696d 6167  oIgnore = ['imag
+0001b380: 652d 6461 7465 7469 6d65 275d 0a20 2020  e-datetime'].   
+0001b390: 2020 2020 2063 6f6e 7374 4461 7461 203d       constData =
+0001b3a0: 207b 7d0a 2020 2020 2020 2020 6669 7273   {}.        firs
+0001b3b0: 7449 6d61 6765 203d 2054 7275 650a 2020  tImage = True.  
+0001b3c0: 2020 2020 2020 666f 7220 696d 6167 652c        for image,
+0001b3d0: 696d 6167 655f 6461 7461 2069 6e20 6461  image_data in da
+0001b3e0: 7461 2e69 7465 6d73 2829 3a0a 2020 2020  ta.items():.    
+0001b3f0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0001b400: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0001b410: 7374 616e 6365 2869 6d61 6765 5f64 6174  stance(image_dat
+0001b420: 612c 6c69 7374 293a 0a20 2020 2020 2020  a,list):.       
+0001b430: 2020 2020 2020 2020 2069 6d61 6765 5f64           image_d
+0001b440: 6174 6120 3d20 5b69 6d61 6765 5f64 6174  ata = [image_dat
+0001b450: 615d 0a0a 2020 2020 2020 2020 2020 2020  a]..            
+0001b460: 6966 206e 6f74 2066 6972 7374 496d 6167  if not firstImag
+0001b470: 6520 616e 6420 636f 6e73 7444 6174 6120  e and constData 
+0001b480: 3d3d 207b 7d3a 0a20 2020 2020 2020 2020  == {}:.         
+0001b490: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0001b4a0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0001b4b0: 2020 2020 2020 6669 7273 7454 696d 6550        firstTimeP
+0001b4c0: 6f69 6e74 203d 2054 7275 650a 2020 2020  oint = True.    
+0001b4d0: 2020 2020 2020 2020 666f 7220 696d 6167          for imag
+0001b4e0: 655f 7470 5f64 6174 6120 696e 2069 6d61  e_tp_data in ima
+0001b4f0: 6765 5f64 6174 613a 0a20 2020 2020 2020  ge_data:.       
+0001b500: 2020 2020 2020 2020 2023 2076 6572 7920           # very 
+0001b510: 6669 7273 7420 6461 7461 2066 6f72 2063  first data for c
+0001b520: 6f6d 7061 7269 736f 6e0a 2020 2020 2020  omparison.      
+0001b530: 2020 2020 2020 2020 2020 6966 2066 6972            if fir
+0001b540: 7374 496d 6167 6520 616e 6420 6669 7273  stImage and firs
+0001b550: 7454 696d 6550 6f69 6e74 3a0a 2020 2020  tTimePoint:.    
+0001b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b570: 636f 6e73 7444 6174 6120 3d20 636f 7079  constData = copy
+0001b580: 2e64 6565 7063 6f70 7928 696d 6167 655f  .deepcopy(image_
+0001b590: 7470 5f64 6174 6129 0a20 2020 2020 2020  tp_data).       
+0001b5a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001b5b0: 2066 6965 6c64 2069 6e20 6669 656c 6473   field in fields
+0001b5c0: 546f 4967 6e6f 7265 3a0a 2020 2020 2020  ToIgnore:.      
 0001b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5e0: 2020 6465 6c20 636f 6e73 7444 6174 615b    del constData[
-0001b5f0: 6669 656c 645d 0a20 2020 2020 2020 2020  field].         
-0001b600: 2020 2020 2020 2020 2020 2066 6972 7374             first
-0001b610: 5469 6d65 506f 696e 7420 3d20 4661 6c73  TimePoint = Fals
-0001b620: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001b630: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-0001b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b650: 636f 6e73 7444 6174 6120 3d20 6d69 7174  constData = miqt
-0001b660: 632e 6669 6e64 436f 6d6d 6f6e 4469 6374  c.findCommonDict
-0001b670: 456c 656d 656e 7473 2869 6d61 6765 5f74  Elements(image_t
-0001b680: 705f 6461 7461 2c63 6f6e 7374 4461 7461  p_data,constData
-0001b690: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
-0001b6a0: 6972 7374 496d 6167 6520 3d20 4661 6c73  irstImage = Fals
-0001b6b0: 650a 0a20 2020 2020 2020 2023 2054 4f44  e..        # TOD
-0001b6c0: 4f20 6368 6563 6b20 7769 7468 696e 2069  O check within i
-0001b6d0: 6d61 6765 2074 696d 6573 202d 3e20 746f  mage times -> to
-0001b6e0: 2069 6d61 6765 2064 6566 6175 6c74 2e20   image default. 
-0001b6f0: 2874 7269 636b 7920 7369 6e63 6520 7765  (tricky since we
-0001b700: 2064 6f6e 2774 2068 6176 6520 7468 6520   don't have the 
-0001b710: 6461 6661 756c 7420 696e 6465 7820 6865  dafault index he
-0001b720: 7265 2e20 4f6e 6c79 2061 2073 7562 7365  re. Only a subse
-0001b730: 7420 6d69 6768 7420 6265 2075 7064 6174  t might be updat
-0001b740: 6520 6865 7265 290a 2020 2020 2020 2020  e here).        
-0001b750: 2320 6368 6563 6b20 7769 7468 696e 2069  # check within i
-0001b760: 6d61 6765 2069 7465 6d73 202d 3e20 6865  mage items -> he
-0001b770: 6164 6572 0a20 2020 2020 2020 2068 6561  ader.        hea
-0001b780: 6465 7255 7064 6174 6520 3d20 636f 7079  derUpdate = copy
-0001b790: 2e64 6565 7063 6f70 7928 636f 6e73 7444  .deepcopy(constD
-0001b7a0: 6174 6129 0a20 2020 2020 2020 2068 6561  ata).        hea
-0001b7b0: 6465 7255 7064 6174 6564 5465 7374 203d  derUpdatedTest =
-0001b7c0: 2063 6f70 792e 6465 6570 636f 7079 2868   copy.deepcopy(h
-0001b7d0: 6561 6465 7229 0a20 2020 2020 2020 206d  eader).        m
-0001b7e0: 6971 7463 2e72 6563 7572 7369 7665 6c79  iqtc.recursively
-0001b7f0: 5570 6461 7465 4469 6374 7328 6865 6164  UpdateDicts(head
-0001b800: 6572 5570 6461 7465 6454 6573 742c 6865  erUpdatedTest,he
-0001b810: 6164 6572 5570 6461 7465 290a 2020 2020  aderUpdate).    
-0001b820: 2020 2020 7570 6461 7465 4469 6666 203d      updateDiff =
-0001b830: 2044 6565 7044 6966 6628 6865 6164 6572   DeepDiff(header
-0001b840: 2c68 6561 6465 7255 7064 6174 6564 5465  ,headerUpdatedTe
-0001b850: 7374 290a 2020 2020 2020 2020 2320 6368  st).        # ch
-0001b860: 6563 6b20 6966 2068 6561 6465 7255 7064  eck if headerUpd
-0001b870: 6174 6520 776f 756c 6420 6f76 6572 7772  ate would overwr
-0001b880: 6974 6520 616e 7974 6869 6e67 2066 726f  ite anything fro
-0001b890: 6d20 6375 7272 656e 7420 6865 6164 6572  m current header
-0001b8a0: 2028 7368 6f75 6c64 206e 6f74 2068 6170   (should not hap
-0001b8b0: 7065 6e29 2c20 6966 2073 6f20 646f 6e74  pen), if so dont
-0001b8c0: 2072 656d 6f76 6520 6672 6f6d 2069 7465   remove from ite
-0001b8d0: 6d73 0a20 2020 2020 2020 2069 6620 6e6f  ms.        if no
-0001b8e0: 7420 2776 616c 7565 735f 6368 616e 6765  t 'values_change
-0001b8f0: 6427 2069 6e20 7570 6461 7465 4469 6666  d' in updateDiff
-0001b900: 2061 6e64 206e 6f74 2027 7479 7065 5f63   and not 'type_c
-0001b910: 6861 6e67 6573 2720 696e 2075 7064 6174  hanges' in updat
-0001b920: 6544 6966 6620 616e 6420 6e6f 7420 2764  eDiff and not 'd
-0001b930: 6963 7469 6f6e 6172 795f 6974 656d 5f72  ictionary_item_r
-0001b940: 656d 6f76 6564 2720 696e 2075 7064 6174  emoved' in updat
-0001b950: 6544 6966 663a 0a20 2020 2020 2020 2020  eDiff:.         
-0001b960: 2020 2068 6561 6465 722e 636c 6561 7228     header.clear(
-0001b970: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
-0001b980: 6164 6572 2e75 7064 6174 6528 6865 6164  ader.update(head
-0001b990: 6572 5570 6461 7465 6454 6573 7429 0a0a  erUpdatedTest)..
-0001b9a0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-0001b9b0: 6d6f 7665 2063 6f6e 7374 2076 616c 7565  move const value
-0001b9c0: 7320 6672 6f6d 2064 6174 610a 2020 2020  s from data.    
-0001b9d0: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
-0001b9e0: 6375 7273 6976 654d 616b 654e 6f6e 6544  cursiveMakeNoneD
-0001b9f0: 6963 7446 6965 6c64 7345 6d70 7479 5374  ictFieldsEmptySt
-0001ba00: 7228 636f 6e73 7444 6174 6129 0a20 2020  r(constData).   
-0001ba10: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
-0001ba20: 6765 2c69 6d61 6765 5f64 6174 6120 696e  ge,image_data in
-0001ba30: 2064 6174 612e 6974 656d 7328 293a 0a20   data.items():. 
-0001ba40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ba50: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0001ba60: 2869 6d61 6765 5f64 6174 612c 6c69 7374  (image_data,list
-0001ba70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001ba80: 2020 2020 2020 2069 6d61 6765 5f64 6174         image_dat
-0001ba90: 6120 3d20 5b69 6d61 6765 5f64 6174 615d  a = [image_data]
-0001baa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bab0: 2066 6f72 2069 6d61 6765 5f74 705f 6461   for image_tp_da
-0001bac0: 7461 2069 6e20 696d 6167 655f 6461 7461  ta in image_data
-0001bad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001bae0: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
-0001baf0: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
-0001bb00: 7473 2869 6d61 6765 5f74 705f 6461 7461  ts(image_tp_data
-0001bb10: 2c63 6f6e 7374 4461 7461 2920 2020 2020  ,constData)     
-0001bb20: 2020 2020 200a 0a20 2020 2020 2020 2065       ..        e
-0001bb30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001bb40: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-0001bb50: 2020 2320 544f 444f 206c 6f67 3f0a 2020    # TODO log?.  
-0001bb60: 2020 200a 0a20 2020 2064 6566 2069 6e74     ..    def int
-0001bb70: 6572 6d65 6469 6174 654e 6176 4669 6c65  ermediateNavFile
-0001bb80: 4578 6973 7473 2873 656c 6629 3a0a 2020  Exists(self):.  
-0001bb90: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0001bba0: 2e65 7869 7374 7328 7365 6c66 2e67 6574  .exists(self.get
-0001bbb0: 5f69 6e74 5f6e 6176 5f66 696c 6528 2929  _int_nav_file())
-0001bbc0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001bbd0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001bbe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001bbf0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001bc00: 0a0a 0a20 2020 2064 6566 2068 6561 6465  ...    def heade
-0001bc10: 7246 6965 6c64 4669 6c6c 6564 2873 656c  rFieldFilled(sel
-0001bc20: 662c 6669 656c 643a 7374 7229 3a0a 2020  f,field:str):.  
-0001bc30: 2020 2020 2020 6966 2073 656c 662e 6669        if self.fi
-0001bc40: 6e64 546d 7046 6965 6c64 3228 6669 656c  ndTmpField2(fiel
-0001bc50: 6429 203d 3d20 2222 3a0a 2020 2020 2020  d) == "":.      
-0001bc60: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001bc70: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
-0001bc80: 6e20 5472 7565 0a0a 2020 2020 6465 6620  n True..    def 
-0001bc90: 636f 6e76 6572 7454 6f44 6566 6175 6c74  convertToDefault
-0001bca0: 4461 7465 5469 6d65 466f 726d 6174 2873  DateTimeFormat(s
-0001bcb0: 656c 662c 6966 646f 293a 0a20 2020 2020  elf,ifdo):.     
-0001bcc0: 2020 2022 2222 2043 6865 636b 7320 6966     """ Checks if
-0001bcd0: 2061 6c6c 2069 7465 6d73 2720 2769 6d61   all items' 'ima
-0001bce0: 6765 2d64 6174 6574 696d 6527 2066 6965  ge-datetime' fie
-0001bcf0: 6c64 7320 6d61 7463 6820 6465 6661 756c  lds match defaul
-0001bd00: 7420 6461 7465 7469 6d65 2066 6f72 6d61  t datetime forma
-0001bd10: 7420 6f72 2061 2063 7573 746f 6d20 6f6e  t or a custom on
-0001bd20: 6520 6465 6669 6e65 6420 696e 2027 696d  e defined in 'im
-0001bd30: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
-0001bd40: 6d61 7427 0a20 2020 2020 2020 2020 2020  mat'.           
-0001bd50: 2061 6e64 2063 6f6e 7665 7274 7320 746f   and converts to
-0001bd60: 2064 6566 6175 6c74 2066 6f72 6d61 742e   default format.
-0001bd70: 2054 6872 6f77 7320 6578 6365 7074 696f   Throws exceptio
-0001bd80: 6e20 6966 2064 6174 6574 696d 6520 6361  n if datetime ca
-0001bd90: 6e6e 6f74 2062 6520 7061 7273 6564 2022  nnot be parsed "
-0001bda0: 2222 0a20 2020 2020 2020 2063 7573 746f  "".        custo
-0001bdb0: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
-0001bdc0: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
-0001bdd0: 2020 2020 2068 6561 6465 7243 7573 746f       headerCusto
-0001bde0: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
-0001bdf0: 3d20 6669 6e64 4669 656c 6428 6966 646f  = findField(ifdo
-0001be00: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0001be10: 6164 6572 4b65 795d 2c27 696d 6167 652d  aderKey],'image-
-0001be20: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
-0001be30: 290a 2020 2020 2020 2020 6966 2068 6561  ).        if hea
-0001be40: 6465 7243 7573 746f 6d44 6174 6554 696d  derCustomDateTim
-0001be50: 6546 6f72 6d61 7420 213d 2022 223a 0a20  eFormat != "":. 
-0001be60: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
-0001be70: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0001be80: 6465 724b 6579 5d5b 2769 6d61 6765 2d64  derKey]['image-d
-0001be90: 6174 6574 696d 652d 666f 726d 6174 275d  atetime-format']
-0001bea0: 203d 2022 2220 2320 7265 6d6f 7665 2063   = "" # remove c
-0001beb0: 7573 746f 6d20 666f 726d 6174 0a20 2020  ustom format.   
-0001bec0: 2020 2020 2020 2020 2063 7573 746f 6d44           customD
-0001bed0: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
-0001bee0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-0001bef0: 2020 7072 6f67 203d 206d 6971 7463 2e50    prog = miqtc.P
-0001bf00: 7269 6e74 4b6e 6f77 6e50 726f 6772 6573  rintKnownProgres
-0001bf10: 734d 7367 2822 4368 6563 6b69 6e67 2064  sMsg("Checking d
-0001bf20: 6174 6574 696d 6520 666f 726d 6174 222c  atetime format",
-0001bf30: 206c 656e 2869 6664 6f5b 7365 6c66 2e69   len(ifdo[self.i
-0001bf40: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-0001bf50: 292c 6d6f 6475 6c6f 3d31 3029 0a20 2020  ),modulo=10).   
-0001bf60: 2020 2020 2066 6f72 2066 696c 652c 6974       for file,it
-0001bf70: 656d 2069 6e20 6966 646f 5b73 656c 662e  em in ifdo[self.
-0001bf80: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-0001bf90: 5d2e 6974 656d 7328 293a 0a20 2020 2020  ].items():.     
-0001bfa0: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
-0001bfb0: 7265 7373 2829 0a20 2020 2020 2020 2020  ress().         
-0001bfc0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0001bfd0: 616e 6365 2869 7465 6d2c 6c69 7374 293a  ance(item,list):
-0001bfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bff0: 2020 2020 2069 7465 6d20 3d20 5b69 7465       item = [ite
-0001c000: 6d5d 0a20 2020 2020 2020 2020 2020 2073  m].            s
-0001c010: 7562 4974 656d 4465 6661 756c 7420 3d20  ubItemDefault = 
-0001c020: 6974 656d 5b30 5d0a 2020 2020 2020 2020  item[0].        
-0001c030: 2020 2020 6974 656d 4375 7374 6f6d 4461      itemCustomDa
-0001c040: 7465 5469 6d65 466f 726d 6174 203d 2022  teTimeFormat = "
-0001c050: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
-0001c060: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-0001c070: 2d66 6f72 6d61 7427 2069 6e20 7375 6249  -format' in subI
-0001c080: 7465 6d44 6566 6175 6c74 3a0a 2020 2020  temDefault:.    
-0001c090: 2020 2020 2020 2020 2020 2020 6974 656d              item
-0001c0a0: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
-0001c0b0: 726d 6174 203d 2073 7562 4974 656d 4465  rmat = subItemDe
-0001c0c0: 6661 756c 745b 2769 6d61 6765 2d64 6174  fault['image-dat
-0001c0d0: 6574 696d 652d 666f 726d 6174 275d 0a20  etime-format']. 
-0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001c0f0: 7562 4974 656d 4465 6661 756c 745b 2769  ubItemDefault['i
-0001c100: 6d61 6765 2d64 6174 6574 696d 652d 666f  mage-datetime-fo
-0001c110: 726d 6174 275d 203d 2022 2220 2320 7265  rmat'] = "" # re
-0001c120: 6d6f 7665 2063 7573 746f 6d20 666f 726d  move custom form
-0001c130: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-0001c140: 2020 2063 7573 746f 6d44 6174 6554 696d     customDateTim
-0001c150: 6546 6f72 6d61 7446 6f75 6e64 203d 2054  eFormatFound = T
-0001c160: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-0001c170: 666f 7220 7375 6249 7465 6d20 696e 2069  for subItem in i
-0001c180: 7465 6d3a 0a20 2020 2020 2020 2020 2020  tem:.           
-0001c190: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001c1a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001c1b0: 726d 6174 203d 206d 6971 7476 2e64 6174  rmat = miqtv.dat
-0001c1c0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-0001c1d0: 7427 5d0a 2020 2020 2020 2020 2020 2020  t'].            
-0001c1e0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
-0001c1f0: 2e64 6174 6574 696d 652e 7374 7270 7469  .datetime.strpti
-0001c200: 6d65 2873 7562 4974 656d 5b27 696d 6167  me(subItem['imag
-0001c210: 652d 6461 7465 7469 6d65 275d 2c66 6f72  e-datetime'],for
-0001c220: 6d61 7429 0a20 2020 2020 2020 2020 2020  mat).           
-0001c230: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-0001c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c250: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001c260: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001c270: 726d 6174 203d 2068 6561 6465 7243 7573  rmat = headerCus
-0001c280: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
-0001c290: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0001c2a0: 2020 2020 2020 2020 2020 6474 203d 2064            dt = d
-0001c2b0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-0001c2c0: 2e73 7472 7074 696d 6528 7375 6249 7465  .strptime(subIte
-0001c2d0: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
-0001c2e0: 6527 5d2c 666f 726d 6174 290a 2020 2020  e'],format).    
-0001c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c300: 2020 2020 7375 6249 7465 6d5b 2769 6d61      subItem['ima
-0001c310: 6765 2d64 6174 6574 696d 6527 5d20 3d20  ge-datetime'] = 
-0001c320: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-0001c330: 652e 7374 7266 7469 6d65 2864 742c 6d69  e.strftime(dt,mi
-0001c340: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-0001c350: 5b27 6d61 7269 7174 275d 290a 2020 2020  ['mariqt']).    
-0001c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c370: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-0001c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c390: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3b0: 2066 6f72 6d61 7420 3d20 6974 656d 4375   format = itemCu
-0001c3c0: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
-0001c3d0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-0001c3e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001c3f0: 7420 3d20 6461 7465 7469 6d65 2e64 6174  t = datetime.dat
-0001c400: 6574 696d 652e 7374 7270 7469 6d65 2873  etime.strptime(s
-0001c410: 7562 4974 656d 5b27 696d 6167 652d 6461  ubItem['image-da
-0001c420: 7465 7469 6d65 275d 2c66 6f72 6d61 7429  tetime'],format)
-0001c430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c440: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-0001c450: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
-0001c460: 7469 6d65 275d 203d 2064 6174 6574 696d  time'] = datetim
-0001c470: 652e 6461 7465 7469 6d65 2e73 7472 6674  e.datetime.strft
-0001c480: 696d 6528 6474 2c6d 6971 7476 2e64 6174  ime(dt,miqtv.dat
-0001c490: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-0001c4a0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-0001c4b0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0001c4c0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4e0: 2070 726f 672e 636c 6561 7228 290a 2020   prog.clear().  
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c500: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001c510: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-0001c520: 696f 6e28 2749 6e76 616c 6964 2064 6174  ion('Invalid dat
-0001c530: 6574 696d 6520 7661 6c75 6527 2c73 7562  etime value',sub
-0001c540: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
-0001c550: 7469 6d65 275d 2c20 2264 6f65 7320 6e6f  time'], "does no
-0001c560: 7420 6d61 7463 6820 666f 726d 6174 2064  t match format d
-0001c570: 6566 6175 6c74 206f 7220 6375 7374 6f6d  efault or custom
-0001c580: 2066 6f72 6d61 7422 290a 2020 2020 2020   format").      
-0001c590: 2020 6966 2063 7573 746f 6d44 6174 6554    if customDateT
-0001c5a0: 696d 6546 6f72 6d61 7446 6f75 6e64 3a0a  imeFormatFound:.
-0001c5b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001c5c0: 2e70 726f 762e 6c6f 6728 2243 7573 746f  .prov.log("Custo
-0001c5d0: 6d20 6461 7465 7469 6d65 2066 6f72 6d61  m datetime forma
-0001c5e0: 7473 2066 6f75 6e64 2e20 5468 6579 2077  ts found. They w
-0001c5f0: 696c 6c20 6265 2072 6570 6c61 6365 6420  ill be replaced 
-0001c600: 6279 2074 6865 2064 6566 6175 6c74 2066  by the default f
-0001c610: 6f72 6d61 742e 2229 2020 200a 2020 2020  ormat.")   .    
-0001c620: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-0001c630: 2020 2020 0a0a 0a20 2020 2064 6566 205f      ...    def _
-0001c640: 5f69 6e69 7449 6e74 6572 6d65 6469 6174  _initIntermediat
-0001c650: 6546 696c 6573 2873 656c 6629 3a0a 2020  eFiles(self):.  
-0001c660: 2020 2020 2020 7365 6c66 2e69 6e74 6572        self.inter
-0001c670: 6d65 6469 6174 6546 696c 6573 4465 665f  mediateFilesDef_
-0001c680: 636f 7265 203d 207b 0a20 2020 2020 2020  core = {.       
-0001c690: 2020 2020 2027 6861 7368 6573 273a 207b       'hashes': {
-0001c6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c6b0: 2027 6372 6561 7469 6f6e 4663 7427 3a20   'creationFct': 
-0001c6c0: 2763 7265 6174 655f 696d 6167 655f 7368  'create_image_sh
-0001c6d0: 6132 3536 5f66 696c 6528 2927 2c0a 2020  a256_file()',.  
-0001c6e0: 2020 2020 2020 2020 2020 2020 2020 2773                's
-0001c6f0: 7566 6669 7827 3a20 275f 696d 6167 652d  uffix': '_image-
-0001c700: 6861 7368 6573 2e74 7874 272c 0a20 2020  hashes.txt',.   
-0001c710: 2020 2020 2020 2020 2020 2020 2027 636f               'co
-0001c720: 6c73 273a 205b 6d69 7174 762e 636f 6c5f  ls': [miqtv.col_
-0001c730: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0001c740: 5b27 6861 7368 275d 5d2c 0a20 2020 2020  ['hash']],.     
-0001c750: 2020 2020 2020 2020 2020 2027 6f70 7469             'opti
-0001c760: 6f6e 616c 273a 205b 5d7d 2c0a 2020 2020  onal': []},.    
-0001c770: 2020 2020 2020 2020 2775 7569 6473 273a          'uuids':
-0001c780: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0001c790: 2020 2027 6372 6561 7469 6f6e 4663 7427     'creationFct'
-0001c7a0: 3a20 2763 7265 6174 655f 7575 6964 5f66  : 'create_uuid_f
-0001c7b0: 696c 6528 2927 2c0a 2020 2020 2020 2020  ile()',.        
-0001c7c0: 2020 2020 2020 2020 2773 7566 6669 7827          'suffix'
-0001c7d0: 3a20 275f 696d 6167 652d 7575 6964 732e  : '_image-uuids.
-0001c7e0: 7478 7427 2c0a 2020 2020 2020 2020 2020  txt',.          
-0001c7f0: 2020 2020 2020 2763 6f6c 7327 3a20 5b6d        'cols': [m
-0001c800: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0001c810: 276d 6172 6971 7427 5d5b 2775 7569 6427  'mariqt']['uuid'
-0001c820: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
-0001c830: 2020 2020 276f 7074 696f 6e61 6c27 3a20      'optional': 
-0001c840: 5b5d 7d2c 0a20 2020 2020 2020 2020 2020  []},.           
-0001c850: 2027 6461 7465 7469 6d65 273a 207b 0a20   'datetime': {. 
-0001c860: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001c870: 6372 6561 7469 6f6e 4663 7427 3a20 2763  creationFct': 'c
-0001c880: 7265 6174 655f 7374 6172 745f 7469 6d65  reate_start_time
-0001c890: 5f66 696c 6528 2927 2c0a 2020 2020 2020  _file()',.      
-0001c8a0: 2020 2020 2020 2020 2020 2773 7566 6669            'suffi
-0001c8b0: 7827 3a20 275f 696d 6167 652d 7374 6172  x': '_image-star
-0001c8c0: 742d 7469 6d65 732e 7478 7427 2c0a 2020  t-times.txt',.  
-0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0001c8e0: 6f6c 7327 3a20 5b6d 6971 7476 2e63 6f6c  ols': [miqtv.col
-0001c8f0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-0001c900: 5d5b 2775 7463 275d 5d2c 0a20 2020 2020  ]['utc']],.     
-0001c910: 2020 2020 2020 2020 2020 2027 6f70 7469             'opti
-0001c920: 6f6e 616c 273a 205b 5d7d 2c0a 2020 2020  onal': []},.    
-0001c930: 2020 2020 2020 2020 276e 6176 6967 6174          'navigat
-0001c940: 696f 6e27 3a20 7b0a 2020 2020 2020 2020  ion': {.        
-0001c950: 2020 2020 2020 2020 2763 7265 6174 696f          'creatio
-0001c960: 6e46 6374 273a 2027 6372 6561 7465 5f69  nFct': 'create_i
-0001c970: 6d61 6765 5f6e 6176 6967 6174 696f 6e5f  mage_navigation_
-0001c980: 6669 6c65 2829 272c 0a20 2020 2020 2020  file()',.       
-0001c990: 2020 2020 2020 2020 2027 7375 6666 6978           'suffix
-0001c9a0: 273a 2027 5f69 6d61 6765 2d6e 6176 6967  ': '_image-navig
-0001c9b0: 6174 696f 6e2e 7478 7427 2c0a 2020 2020  ation.txt',.    
-0001c9c0: 2020 2020 2020 2020 2020 2020 2763 6f6c              'col
-0001c9d0: 7327 3a20 5b6d 6971 7476 2e63 6f6c 5f68  s': [miqtv.col_h
-0001c9e0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001c9f0: 2775 7463 275d 5d2c 0a20 2020 2020 2020  'utc']],.       
-0001ca00: 2020 2020 2020 2020 2027 6f70 7469 6f6e           'option
-0001ca10: 616c 273a 205b 6d69 7174 762e 636f 6c5f  al': [miqtv.col_
-0001ca20: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0001ca30: 5b27 6c6f 6e27 5d2c 206d 6971 7476 2e63  ['lon'], miqtv.c
-0001ca40: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-0001ca50: 7427 5d5b 276c 6174 275d 2c20 6d69 7174  t']['lat'], miqt
-0001ca60: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001ca70: 7269 7174 275d 5b27 616c 7427 5d2c 206d  riqt']['alt'], m
-0001ca80: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0001ca90: 276d 6172 6971 7427 5d5b 2768 6774 275d  'mariqt']['hgt']
-0001caa0: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
-0001cab0: 6572 5b27 6d61 7269 7174 275d 5b27 756e  er['mariqt']['un
-0001cac0: 6365 7274 275d 5d7d 2c0a 2020 2020 2020  cert']]},.      
-0001cad0: 2020 7d0a 0a20 2020 2020 2020 2073 656c    }..        sel
-0001cae0: 662e 6e6f 6e43 6f72 6546 6965 6c64 496e  f.nonCoreFieldIn
-0001caf0: 7465 726d 6564 6961 7465 4974 656d 496e  termediateItemIn
-0001cb00: 666f 4669 6c65 7320 3d20 5b5d 0a0a 2020  foFiles = []..  
-0001cb10: 2020 6465 6620 5f5f 6765 745f 696e 745f    def __get_int_
-0001cb20: 6669 6c65 5f70 7265 6669 7828 7365 6c66  file_prefix(self
-0001cb30: 293a 0a20 2020 2020 2020 2022 2222 2064  ):.        """ d
-0001cb40: 6570 656e 6473 206f 6e20 2769 6d61 6765  epends on 'image
-0001cb50: 2d65 7665 6e74 2720 616e 6420 2769 6d61  -event' and 'ima
-0001cb60: 6765 2d73 656e 736f 7227 2073 6f20 6974  ge-sensor' so it
-0001cb70: 2063 616e 2063 6861 6e67 6520 6475 7269   can change duri
-0001cb80: 6e67 2075 7061 7465 2022 2222 0a20 2020  ng upate """.   
-0001cb90: 2020 2020 2072 6574 7572 6e20 6f73 2e70       return os.p
-0001cba0: 6174 682e 6a6f 696e 2873 656c 662e 6469  ath.join(self.di
-0001cbb0: 722e 746f 2873 656c 662e 6469 722e 6474  r.to(self.dir.dt
-0001cbc0: 2e69 6e74 6572 6d65 6469 6174 6529 2c20  .intermediate), 
-0001cbd0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0001cbe0: 6428 2769 6d61 6765 2d73 6574 2d6e 616d  d('image-set-nam
-0001cbf0: 6527 2929 0a0a 2020 2020 6465 6620 6765  e'))..    def ge
-0001cc00: 745f 696e 745f 6861 7368 5f66 696c 6528  t_int_hash_file(
-0001cc10: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0001cc20: 6574 7572 6e20 7365 6c66 2e5f 5f67 6574  eturn self.__get
-0001cc30: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
-0001cc40: 2829 202b 2073 656c 662e 696e 7465 726d  () + self.interm
-0001cc50: 6564 6961 7465 4669 6c65 7344 6566 5f63  ediateFilesDef_c
-0001cc60: 6f72 655b 2768 6173 6865 7327 5d5b 2773  ore['hashes']['s
-0001cc70: 7566 6669 7827 5d0a 0a20 2020 2064 6566  uffix']..    def
-0001cc80: 2067 6574 5f69 6e74 5f75 7569 645f 6669   get_int_uuid_fi
-0001cc90: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
-0001cca0: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
-0001ccb0: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
-0001ccc0: 6669 7828 2920 2b20 7365 6c66 2e69 6e74  fix() + self.int
-0001ccd0: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
-0001cce0: 665f 636f 7265 5b27 7575 6964 7327 5d5b  f_core['uuids'][
-0001ccf0: 2773 7566 6669 7827 5d0a 0a20 2020 2064  'suffix']..    d
-0001cd00: 6566 2067 6574 5f69 6e74 5f73 7461 7274  ef get_int_start
-0001cd10: 5469 6d65 735f 6669 6c65 2873 656c 6629  Times_file(self)
-0001cd20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001cd30: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
-0001cd40: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
-0001cd50: 7365 6c66 2e69 6e74 6572 6d65 6469 6174  self.intermediat
-0001cd60: 6546 696c 6573 4465 665f 636f 7265 5b27  eFilesDef_core['
-0001cd70: 6461 7465 7469 6d65 275d 5b27 7375 6666  datetime']['suff
-0001cd80: 6978 275d 0a0a 2020 2020 6465 6620 6765  ix']..    def ge
-0001cd90: 745f 696e 745f 6e61 765f 6669 6c65 2873  t_int_nav_file(s
-0001cda0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0001cdb0: 7475 726e 2073 656c 662e 5f5f 6765 745f  turn self.__get_
-0001cdc0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-0001cdd0: 2920 2b20 7365 6c66 2e69 6e74 6572 6d65  ) + self.interme
-0001cde0: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
-0001cdf0: 7265 5b27 6e61 7669 6761 7469 6f6e 275d  re['navigation']
-0001ce00: 5b27 7375 6666 6978 275d 0a0a            ['suffix']..
+0001b5e0: 2020 6966 2066 6965 6c64 2069 6e20 636f    if field in co
+0001b5f0: 6e73 7444 6174 613a 0a20 2020 2020 2020  nstData:.       
+0001b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b610: 2020 2020 2064 656c 2063 6f6e 7374 4461       del constDa
+0001b620: 7461 5b66 6965 6c64 5d0a 2020 2020 2020  ta[field].      
+0001b630: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0001b640: 7273 7454 696d 6550 6f69 6e74 203d 2046  rstTimePoint = F
+0001b650: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0001b660: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0001b670: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+0001b680: 2020 2063 6f6e 7374 4461 7461 203d 206d     constData = m
+0001b690: 6971 7463 2e66 696e 6443 6f6d 6d6f 6e44  iqtc.findCommonD
+0001b6a0: 6963 7445 6c65 6d65 6e74 7328 696d 6167  ictElements(imag
+0001b6b0: 655f 7470 5f64 6174 612c 636f 6e73 7444  e_tp_data,constD
+0001b6c0: 6174 6129 0a0a 2020 2020 2020 2020 2020  ata)..          
+0001b6d0: 2020 6669 7273 7449 6d61 6765 203d 2046    firstImage = F
+0001b6e0: 616c 7365 0a0a 2020 2020 2020 2020 2320  alse..        # 
+0001b6f0: 544f 444f 2063 6865 636b 2077 6974 6869  TODO check withi
+0001b700: 6e20 696d 6167 6520 7469 6d65 7320 2d3e  n image times ->
+0001b710: 2074 6f20 696d 6167 6520 6465 6661 756c   to image defaul
+0001b720: 742e 2028 7472 6963 6b79 2073 696e 6365  t. (tricky since
+0001b730: 2077 6520 646f 6e27 7420 6861 7665 2074   we don't have t
+0001b740: 6865 2064 6166 6175 6c74 2069 6e64 6578  he dafault index
+0001b750: 2068 6572 652e 204f 6e6c 7920 6120 7375   here. Only a su
+0001b760: 6273 6574 206d 6967 6874 2062 6520 7570  bset might be up
+0001b770: 6461 7465 2068 6572 6529 0a20 2020 2020  date here).     
+0001b780: 2020 2023 2063 6865 636b 2077 6974 6869     # check withi
+0001b790: 6e20 696d 6167 6520 6974 656d 7320 2d3e  n image items ->
+0001b7a0: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+0001b7b0: 6865 6164 6572 5570 6461 7465 203d 2063  headerUpdate = c
+0001b7c0: 6f70 792e 6465 6570 636f 7079 2863 6f6e  opy.deepcopy(con
+0001b7d0: 7374 4461 7461 290a 2020 2020 2020 2020  stData).        
+0001b7e0: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
+0001b7f0: 7420 3d20 636f 7079 2e64 6565 7063 6f70  t = copy.deepcop
+0001b800: 7928 6865 6164 6572 290a 2020 2020 2020  y(header).      
+0001b810: 2020 6d69 7174 632e 7265 6375 7273 6976    miqtc.recursiv
+0001b820: 656c 7955 7064 6174 6544 6963 7473 2868  elyUpdateDicts(h
+0001b830: 6561 6465 7255 7064 6174 6564 5465 7374  eaderUpdatedTest
+0001b840: 2c68 6561 6465 7255 7064 6174 6529 0a20  ,headerUpdate). 
+0001b850: 2020 2020 2020 2075 7064 6174 6544 6966         updateDif
+0001b860: 6620 3d20 4465 6570 4469 6666 2868 6561  f = DeepDiff(hea
+0001b870: 6465 722c 6865 6164 6572 5570 6461 7465  der,headerUpdate
+0001b880: 6454 6573 7429 0a20 2020 2020 2020 2023  dTest).        #
+0001b890: 2063 6865 636b 2069 6620 6865 6164 6572   check if header
+0001b8a0: 5570 6461 7465 2077 6f75 6c64 206f 7665  Update would ove
+0001b8b0: 7277 7269 7465 2061 6e79 7468 696e 6720  rwrite anything 
+0001b8c0: 6672 6f6d 2063 7572 7265 6e74 2068 6561  from current hea
+0001b8d0: 6465 7220 2873 686f 756c 6420 6e6f 7420  der (should not 
+0001b8e0: 6861 7070 656e 292c 2069 6620 736f 2064  happen), if so d
+0001b8f0: 6f6e 7420 7265 6d6f 7665 2066 726f 6d20  ont remove from 
+0001b900: 6974 656d 730a 2020 2020 2020 2020 6966  items.        if
+0001b910: 206e 6f74 2027 7661 6c75 6573 5f63 6861   not 'values_cha
+0001b920: 6e67 6564 2720 696e 2075 7064 6174 6544  nged' in updateD
+0001b930: 6966 6620 616e 6420 6e6f 7420 2774 7970  iff and not 'typ
+0001b940: 655f 6368 616e 6765 7327 2069 6e20 7570  e_changes' in up
+0001b950: 6461 7465 4469 6666 2061 6e64 206e 6f74  dateDiff and not
+0001b960: 2027 6469 6374 696f 6e61 7279 5f69 7465   'dictionary_ite
+0001b970: 6d5f 7265 6d6f 7665 6427 2069 6e20 7570  m_removed' in up
+0001b980: 6461 7465 4469 6666 3a0a 2020 2020 2020  dateDiff:.      
+0001b990: 2020 2020 2020 6865 6164 6572 2e63 6c65        header.cle
+0001b9a0: 6172 2829 0a20 2020 2020 2020 2020 2020  ar().           
+0001b9b0: 2068 6561 6465 722e 7570 6461 7465 2868   header.update(h
+0001b9c0: 6561 6465 7255 7064 6174 6564 5465 7374  eaderUpdatedTest
+0001b9d0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0001b9e0: 2072 656d 6f76 6520 636f 6e73 7420 7661   remove const va
+0001b9f0: 6c75 6573 2066 726f 6d20 6461 7461 0a20  lues from data. 
+0001ba00: 2020 2020 2020 2020 2020 206d 6971 7463             miqtc
+0001ba10: 2e72 6563 7572 7369 7665 4d61 6b65 4e6f  .recursiveMakeNo
+0001ba20: 6e65 4469 6374 4669 656c 6473 456d 7074  neDictFieldsEmpt
+0001ba30: 7953 7472 2863 6f6e 7374 4461 7461 290a  yStr(constData).
+0001ba40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001ba50: 696d 6167 652c 696d 6167 655f 6461 7461  image,image_data
+0001ba60: 2069 6e20 6461 7461 2e69 7465 6d73 2829   in data.items()
+0001ba70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ba80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0001ba90: 6e63 6528 696d 6167 655f 6461 7461 2c6c  nce(image_data,l
+0001baa0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
+0001bab0: 2020 2020 2020 2020 2020 696d 6167 655f            image_
+0001bac0: 6461 7461 203d 205b 696d 6167 655f 6461  data = [image_da
+0001bad0: 7461 5d0a 2020 2020 2020 2020 2020 2020  ta].            
+0001bae0: 2020 2020 666f 7220 696d 6167 655f 7470      for image_tp
+0001baf0: 5f64 6174 6120 696e 2069 6d61 6765 5f64  _data in image_d
+0001bb00: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+0001bb10: 2020 2020 2020 2020 206d 6971 7463 2e72           miqtc.r
+0001bb20: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
+0001bb30: 4469 6374 7328 696d 6167 655f 7470 5f64  Dicts(image_tp_d
+0001bb40: 6174 612c 636f 6e73 7444 6174 6129 2020  ata,constData)  
+0001bb50: 2020 2020 2020 2020 0a0a 2020 2020 2020          ..      
+0001bb60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001bb70: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0001bb80: 2020 2020 2023 2054 4f44 4f20 6c6f 673f       # TODO log?
+0001bb90: 0a20 2020 2020 0a0a 2020 2020 6465 6620  .     ..    def 
+0001bba0: 696e 7465 726d 6564 6961 7465 4e61 7646  intermediateNavF
+0001bbb0: 696c 6545 7869 7374 7328 7365 6c66 293a  ileExists(self):
+0001bbc0: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+0001bbd0: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
+0001bbe0: 6765 745f 696e 745f 6e61 765f 6669 6c65  get_int_nav_file
+0001bbf0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+0001bc00: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+0001bc10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001bc20: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0001bc30: 6c73 650a 0a0a 2020 2020 6465 6620 6865  lse...    def he
+0001bc40: 6164 6572 4669 656c 6446 696c 6c65 6428  aderFieldFilled(
+0001bc50: 7365 6c66 2c66 6965 6c64 3a73 7472 293a  self,field:str):
+0001bc60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001bc70: 2e66 696e 6454 6d70 4669 656c 6432 2866  .findTmpField2(f
+0001bc80: 6965 6c64 2920 3d3d 2022 223a 0a20 2020  ield) == "":.   
+0001bc90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001bca0: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+0001bcb0: 7475 726e 2054 7275 650a 0a20 2020 2064  turn True..    d
+0001bcc0: 6566 2063 6f6e 7665 7274 546f 4465 6661  ef convertToDefa
+0001bcd0: 756c 7444 6174 6554 696d 6546 6f72 6d61  ultDateTimeForma
+0001bce0: 7428 7365 6c66 2c69 6664 6f29 3a0a 2020  t(self,ifdo):.  
+0001bcf0: 2020 2020 2020 2222 2220 4368 6563 6b73        """ Checks
+0001bd00: 2069 6620 616c 6c20 6974 656d 7327 2027   if all items' '
+0001bd10: 696d 6167 652d 6461 7465 7469 6d65 2720  image-datetime' 
+0001bd20: 6669 656c 6473 206d 6174 6368 2064 6566  fields match def
+0001bd30: 6175 6c74 2064 6174 6574 696d 6520 666f  ault datetime fo
+0001bd40: 726d 6174 206f 7220 6120 6375 7374 6f6d  rmat or a custom
+0001bd50: 206f 6e65 2064 6566 696e 6564 2069 6e20   one defined in 
+0001bd60: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
+0001bd70: 666f 726d 6174 270a 2020 2020 2020 2020  format'.        
+0001bd80: 2020 2020 616e 6420 636f 6e76 6572 7473      and converts
+0001bd90: 2074 6f20 6465 6661 756c 7420 666f 726d   to default form
+0001bda0: 6174 2e20 5468 726f 7773 2065 7863 6570  at. Throws excep
+0001bdb0: 7469 6f6e 2069 6620 6461 7465 7469 6d65  tion if datetime
+0001bdc0: 2063 616e 6e6f 7420 6265 2070 6172 7365   cannot be parse
+0001bdd0: 6420 2222 220a 2020 2020 2020 2020 6375  d """.        cu
+0001bde0: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+0001bdf0: 6174 466f 756e 6420 3d20 4661 6c73 650a  atFound = False.
+0001be00: 2020 2020 2020 2020 6865 6164 6572 4375          headerCu
+0001be10: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+0001be20: 6174 203d 2066 696e 6446 6965 6c64 2869  at = findField(i
+0001be30: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0001be40: 7448 6561 6465 724b 6579 5d2c 2769 6d61  tHeaderKey],'ima
+0001be50: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
+0001be60: 6174 2729 0a20 2020 2020 2020 2069 6620  at').        if 
+0001be70: 6865 6164 6572 4375 7374 6f6d 4461 7465  headerCustomDate
+0001be80: 5469 6d65 466f 726d 6174 2021 3d20 2222  TimeFormat != ""
+0001be90: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001bea0: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+0001beb0: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+0001bec0: 652d 6461 7465 7469 6d65 2d66 6f72 6d61  e-datetime-forma
+0001bed0: 7427 5d20 3d20 2222 2023 2072 656d 6f76  t'] = "" # remov
+0001bee0: 6520 6375 7374 6f6d 2066 6f72 6d61 740a  e custom format.
+0001bef0: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+0001bf00: 6f6d 4461 7465 5469 6d65 466f 726d 6174  omDateTimeFormat
+0001bf10: 466f 756e 6420 3d20 5472 7565 0a20 2020  Found = True.   
+0001bf20: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
+0001bf30: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
+0001bf40: 7265 7373 4d73 6728 2243 6865 636b 696e  ressMsg("Checkin
+0001bf50: 6720 6461 7465 7469 6d65 2066 6f72 6d61  g datetime forma
+0001bf60: 7422 2c20 6c65 6e28 6966 646f 5b73 656c  t", len(ifdo[sel
+0001bf70: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+0001bf80: 6579 5d29 2c6d 6f64 756c 6f3d 3130 290a  ey]),modulo=10).
+0001bf90: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+0001bfa0: 2c69 7465 6d20 696e 2069 6664 6f5b 7365  ,item in ifdo[se
+0001bfb0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0001bfc0: 4b65 795d 2e69 7465 6d73 2829 3a0a 2020  Key].items():.  
+0001bfd0: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
+0001bfe0: 726f 6772 6573 7328 290a 2020 2020 2020  rogress().      
+0001bff0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001c000: 6e73 7461 6e63 6528 6974 656d 2c6c 6973  nstance(item,lis
+0001c010: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0001c020: 2020 2020 2020 2020 6974 656d 203d 205b          item = [
+0001c030: 6974 656d 5d0a 2020 2020 2020 2020 2020  item].          
+0001c040: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
+0001c050: 203d 2069 7465 6d5b 305d 0a20 2020 2020   = item[0].     
+0001c060: 2020 2020 2020 2069 7465 6d43 7573 746f         itemCusto
+0001c070: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
+0001c080: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
+0001c090: 2069 6620 2769 6d61 6765 2d64 6174 6574   if 'image-datet
+0001c0a0: 696d 652d 666f 726d 6174 2720 696e 2073  ime-format' in s
+0001c0b0: 7562 4974 656d 4465 6661 756c 743a 0a20  ubItemDefault:. 
+0001c0c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001c0d0: 7465 6d43 7573 746f 6d44 6174 6554 696d  temCustomDateTim
+0001c0e0: 6546 6f72 6d61 7420 3d20 7375 6249 7465  eFormat = subIte
+0001c0f0: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
+0001c100: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
+0001c110: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001c120: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
+0001c130: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+0001c140: 2d66 6f72 6d61 7427 5d20 3d20 2222 2023  -format'] = "" #
+0001c150: 2072 656d 6f76 6520 6375 7374 6f6d 2066   remove custom f
+0001c160: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
+0001c170: 2020 2020 2020 6375 7374 6f6d 4461 7465        customDate
+0001c180: 5469 6d65 466f 726d 6174 466f 756e 6420  TimeFormatFound 
+0001c190: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0001c1a0: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
+0001c1b0: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
+0001c1c0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1e0: 2066 6f72 6d61 7420 3d20 6d69 7174 762e   format = miqtv.
+0001c1f0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+0001c200: 7269 7174 275d 0a20 2020 2020 2020 2020  riqt'].         
+0001c210: 2020 2020 2020 2020 2020 2064 6174 6574             datet
+0001c220: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
+0001c230: 7074 696d 6528 7375 6249 7465 6d5b 2769  ptime(subItem['i
+0001c240: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
+0001c250: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
+0001c260: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+0001c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c280: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2a0: 2066 6f72 6d61 7420 3d20 6865 6164 6572   format = header
+0001c2b0: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
+0001c2c0: 726d 6174 0a20 2020 2020 2020 2020 2020  rmat.           
+0001c2d0: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
+0001c2e0: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
+0001c2f0: 696d 652e 7374 7270 7469 6d65 2873 7562  ime.strptime(sub
+0001c300: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
+0001c310: 7469 6d65 275d 2c66 6f72 6d61 7429 0a20  time'],format). 
+0001c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c330: 2020 2020 2020 2073 7562 4974 656d 5b27         subItem['
+0001c340: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0001c350: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+0001c360: 7469 6d65 2e73 7472 6674 696d 6528 6474  time.strftime(dt
+0001c370: 2c6d 6971 7476 2e64 6174 655f 666f 726d  ,miqtv.date_form
+0001c380: 6174 735b 276d 6172 6971 7427 5d29 0a20  ats['mariqt']). 
+0001c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3a0: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3e0: 2020 2020 666f 726d 6174 203d 2069 7465      format = ite
+0001c3f0: 6d43 7573 746f 6d44 6174 6554 696d 6546  mCustomDateTimeF
+0001c400: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
+0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c420: 2020 6474 203d 2064 6174 6574 696d 652e    dt = datetime.
+0001c430: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
+0001c440: 6528 7375 6249 7465 6d5b 2769 6d61 6765  e(subItem['image
+0001c450: 2d64 6174 6574 696d 6527 5d2c 666f 726d  -datetime'],form
+0001c460: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
+0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c480: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+0001c490: 6174 6574 696d 6527 5d20 3d20 6461 7465  atetime'] = date
+0001c4a0: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
+0001c4b0: 7266 7469 6d65 2864 742c 6d69 7174 762e  rftime(dt,miqtv.
+0001c4c0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+0001c4d0: 7269 7174 275d 290a 2020 2020 2020 2020  riqt']).        
+0001c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4f0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+0001c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c510: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+0001c520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c530: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0001c540: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+0001c550: 6570 7469 6f6e 2827 496e 7661 6c69 6420  eption('Invalid 
+0001c560: 6461 7465 7469 6d65 2076 616c 7565 272c  datetime value',
+0001c570: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+0001c580: 6174 6574 696d 6527 5d2c 2022 646f 6573  atetime'], "does
+0001c590: 206e 6f74 206d 6174 6368 2066 6f72 6d61   not match forma
+0001c5a0: 7420 6465 6661 756c 7420 6f72 2063 7573  t default or cus
+0001c5b0: 746f 6d20 666f 726d 6174 2229 0a20 2020  tom format").   
+0001c5c0: 2020 2020 2069 6620 6375 7374 6f6d 4461       if customDa
+0001c5d0: 7465 5469 6d65 466f 726d 6174 466f 756e  teTimeFormatFoun
+0001c5e0: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+0001c5f0: 656c 662e 7072 6f76 2e6c 6f67 2822 4375  elf.prov.log("Cu
+0001c600: 7374 6f6d 2064 6174 6574 696d 6520 666f  stom datetime fo
+0001c610: 726d 6174 7320 666f 756e 642e 2054 6865  rmats found. The
+0001c620: 7920 7769 6c6c 2062 6520 7265 706c 6163  y will be replac
+0001c630: 6564 2062 7920 7468 6520 6465 6661 756c  ed by the defaul
+0001c640: 7420 666f 726d 6174 2e22 2920 2020 0a20  t format.")   . 
+0001c650: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0001c660: 7228 2920 2020 200a 0a0a 2020 2020 6465  r()    ...    de
+0001c670: 6620 5f5f 696e 6974 496e 7465 726d 6564  f __initIntermed
+0001c680: 6961 7465 4669 6c65 7328 7365 6c66 293a  iateFiles(self):
+0001c690: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+0001c6a0: 7465 726d 6564 6961 7465 4669 6c65 7344  termediateFilesD
+0001c6b0: 6566 5f63 6f72 6520 3d20 7b0a 2020 2020  ef_core = {.    
+0001c6c0: 2020 2020 2020 2020 2768 6173 6865 7327          'hashes'
+0001c6d0: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
+0001c6e0: 2020 2020 2763 7265 6174 696f 6e46 6374      'creationFct
+0001c6f0: 273a 2027 6372 6561 7465 5f69 6d61 6765  ': 'create_image
+0001c700: 5f73 6861 3235 365f 6669 6c65 2829 272c  _sha256_file()',
+0001c710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c720: 2027 7375 6666 6978 273a 2027 5f69 6d61   'suffix': '_ima
+0001c730: 6765 2d68 6173 6865 732e 7478 7427 2c0a  ge-hashes.txt',.
+0001c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c750: 2763 6f6c 7327 3a20 5b6d 6971 7476 2e63  'cols': [miqtv.c
+0001c760: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+0001c770: 7427 5d5b 2768 6173 6827 5d5d 2c0a 2020  t']['hash']],.  
+0001c780: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+0001c790: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
+0001c7a0: 2020 2020 2020 2020 2020 2027 7575 6964             'uuid
+0001c7b0: 7327 3a20 7b0a 2020 2020 2020 2020 2020  s': {.          
+0001c7c0: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
+0001c7d0: 6374 273a 2027 6372 6561 7465 5f75 7569  ct': 'create_uui
+0001c7e0: 645f 6669 6c65 2829 272c 0a20 2020 2020  d_file()',.     
+0001c7f0: 2020 2020 2020 2020 2020 2027 7375 6666             'suff
+0001c800: 6978 273a 2027 5f69 6d61 6765 2d75 7569  ix': '_image-uui
+0001c810: 6473 2e74 7874 272c 0a20 2020 2020 2020  ds.txt',.       
+0001c820: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
+0001c830: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
+0001c840: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
+0001c850: 6964 275d 5d2c 0a20 2020 2020 2020 2020  id']],.         
+0001c860: 2020 2020 2020 2027 6f70 7469 6f6e 616c         'optional
+0001c870: 273a 205b 5d7d 2c0a 2020 2020 2020 2020  ': []},.        
+0001c880: 2020 2020 2764 6174 6574 696d 6527 3a20      'datetime': 
+0001c890: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001c8a0: 2020 2763 7265 6174 696f 6e46 6374 273a    'creationFct':
+0001c8b0: 2027 6372 6561 7465 5f73 7461 7274 5f74   'create_start_t
+0001c8c0: 696d 655f 6669 6c65 2829 272c 0a20 2020  ime_file()',.   
+0001c8d0: 2020 2020 2020 2020 2020 2020 2027 7375               'su
+0001c8e0: 6666 6978 273a 2027 5f69 6d61 6765 2d73  ffix': '_image-s
+0001c8f0: 7461 7274 2d74 696d 6573 2e74 7874 272c  tart-times.txt',
+0001c900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c910: 2027 636f 6c73 273a 205b 6d69 7174 762e   'cols': [miqtv.
+0001c920: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001c930: 7174 275d 5b27 7574 6327 5d5d 2c0a 2020  qt']['utc']],.  
+0001c940: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+0001c950: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
+0001c960: 2020 2020 2020 2020 2020 2027 6e61 7669             'navi
+0001c970: 6761 7469 6f6e 273a 207b 0a20 2020 2020  gation': {.     
+0001c980: 2020 2020 2020 2020 2020 2027 6372 6561             'crea
+0001c990: 7469 6f6e 4663 7427 3a20 2763 7265 6174  tionFct': 'creat
+0001c9a0: 655f 696d 6167 655f 6e61 7669 6761 7469  e_image_navigati
+0001c9b0: 6f6e 5f66 696c 6528 2927 2c0a 2020 2020  on_file()',.    
+0001c9c0: 2020 2020 2020 2020 2020 2020 2773 7566              'suf
+0001c9d0: 6669 7827 3a20 275f 696d 6167 652d 6e61  fix': '_image-na
+0001c9e0: 7669 6761 7469 6f6e 2e74 7874 272c 0a20  vigation.txt',. 
+0001c9f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001ca00: 636f 6c73 273a 205b 6d69 7174 762e 636f  cols': [miqtv.co
+0001ca10: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+0001ca20: 275d 5b27 7574 6327 5d5d 2c0a 2020 2020  ']['utc']],.    
+0001ca30: 2020 2020 2020 2020 2020 2020 276f 7074              'opt
+0001ca40: 696f 6e61 6c27 3a20 5b6d 6971 7476 2e63  ional': [miqtv.c
+0001ca50: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+0001ca60: 7427 5d5b 276c 6f6e 275d 2c20 6d69 7174  t']['lon'], miqt
+0001ca70: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001ca80: 7269 7174 275d 5b27 6c61 7427 5d2c 206d  riqt']['lat'], m
+0001ca90: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+0001caa0: 276d 6172 6971 7427 5d5b 2761 6c74 275d  'mariqt']['alt']
+0001cab0: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
+0001cac0: 6572 5b27 6d61 7269 7174 275d 5b27 6867  er['mariqt']['hg
+0001cad0: 7427 5d2c 206d 6971 7476 2e63 6f6c 5f68  t'], miqtv.col_h
+0001cae0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001caf0: 2775 6e63 6572 7427 5d5d 7d2c 0a20 2020  'uncert']]},.   
+0001cb00: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+0001cb10: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
+0001cb20: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
+0001cb30: 6d49 6e66 6f46 696c 6573 203d 205b 5d0a  mInfoFiles = [].
+0001cb40: 0a20 2020 2064 6566 205f 5f67 6574 5f69  .    def __get_i
+0001cb50: 6e74 5f66 696c 655f 7072 6566 6978 2873  nt_file_prefix(s
+0001cb60: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0001cb70: 2220 6465 7065 6e64 7320 6f6e 2027 696d  " depends on 'im
+0001cb80: 6167 652d 6576 656e 7427 2061 6e64 2027  age-event' and '
+0001cb90: 696d 6167 652d 7365 6e73 6f72 2720 736f  image-sensor' so
+0001cba0: 2069 7420 6361 6e20 6368 616e 6765 2064   it can change d
+0001cbb0: 7572 696e 6720 7570 6174 6520 2222 220a  uring upate """.
+0001cbc0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001cbd0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
+0001cbe0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+0001cbf0: 2e64 742e 696e 7465 726d 6564 6961 7465  .dt.intermediate
+0001cc00: 292c 2073 656c 662e 6669 6e64 546d 7046  ), self.findTmpF
+0001cc10: 6965 6c64 2827 696d 6167 652d 7365 742d  ield('image-set-
+0001cc20: 6e61 6d65 2729 290a 0a20 2020 2064 6566  name'))..    def
+0001cc30: 2067 6574 5f69 6e74 5f68 6173 685f 6669   get_int_hash_fi
+0001cc40: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
+0001cc50: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+0001cc60: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
+0001cc70: 6669 7828 2920 2b20 7365 6c66 2e69 6e74  fix() + self.int
+0001cc80: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
+0001cc90: 665f 636f 7265 5b27 6861 7368 6573 275d  f_core['hashes']
+0001cca0: 5b27 7375 6666 6978 275d 0a0a 2020 2020  ['suffix']..    
+0001ccb0: 6465 6620 6765 745f 696e 745f 7575 6964  def get_int_uuid
+0001ccc0: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
+0001ccd0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001cce0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0001ccf0: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
+0001cd00: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
+0001cd10: 7344 6566 5f63 6f72 655b 2775 7569 6473  sDef_core['uuids
+0001cd20: 275d 5b27 7375 6666 6978 275d 0a0a 2020  ']['suffix']..  
+0001cd30: 2020 6465 6620 6765 745f 696e 745f 7374    def get_int_st
+0001cd40: 6172 7454 696d 6573 5f66 696c 6528 7365  artTimes_file(se
+0001cd50: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0001cd60: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
+0001cd70: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+0001cd80: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
+0001cd90: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
+0001cda0: 655b 2764 6174 6574 696d 6527 5d5b 2773  e['datetime']['s
+0001cdb0: 7566 6669 7827 5d0a 0a20 2020 2064 6566  uffix']..    def
+0001cdc0: 2067 6574 5f69 6e74 5f6e 6176 5f66 696c   get_int_nav_fil
+0001cdd0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001cde0: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
+0001cdf0: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+0001ce00: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
+0001ce10: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
+0001ce20: 5f63 6f72 655b 276e 6176 6967 6174 696f  _core['navigatio
+0001ce30: 6e27 5d5b 2773 7566 6669 7827 5d0a 0a    n']['suffix']..
```

## Comparing `mariqt-0.5.8.dist-info/LICENSE` & `mariqt-0.5.9.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.5.8.dist-info/METADATA` & `mariqt-0.5.9.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.5.8
+Version: 0.5.9
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

## Comparing `mariqt-0.5.8.dist-info/RECORD` & `mariqt-0.5.9.dist-info/RECORD`

 * *Files 16% similar despite different names*

```diff
@@ -1,31 +1,31 @@
 mariqt/converters.py,sha256=kYxAx41oKGLgywxYnnE5qqxDXzror4YvRKg_F5HgXpA,5876
-mariqt/core.py,sha256=gIMyi8GQ4c-0EJkalBVnn3_dLdrCMuVXmmPNhdPcMV4,14710
+mariqt/core.py,sha256=snX4tAHHDasmjU7bhncYPOtnKdOLtgU2EGJDLNgE_Vk,14751
 mariqt/directories.py,sha256=ZRJmUxFO5oD4JCECorwr3DYQel-U57GsrgfLutzT2hU,8485
 mariqt/equipment.py,sha256=WgZ2NfRqbHFHNpbcnTfRk8waOCQn9fDgdr4JTZR9wPk,465
 mariqt/files.py,sha256=V-7J_ekTjWbZ7tyGE7SayZxQwf658KNtl_rUyStnzV8,16621
 mariqt/geo.py,sha256=K89tqXN4Ntu2qBzii68WVB86kGqTxpJvHzWARlR3k60,28565
 mariqt/image.py,sha256=j41GAzx22_fuqeIXVRwwfVnNz19cUHxeImZiOOpQAbA,23207
 mariqt/misc.py,sha256=BF_ItP_gnkS1Z6zb9P7O4cRi3XMgJR-Bm2OmzX7AK9M,3090
 mariqt/navigation.py,sha256=3NFKxFggEVeZKM8RMketkNDeJe8MpAbfoGkF6FgjDLM,40980
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=bqjUJnTiKwFsbGP4cRQiwHQhsTi4191pb36R8GSKp58,4376
 mariqt/tests.py,sha256=BWJy4ejhsSINzhR_88HGfYeXVnPKbdMwDE-u2qLl6C0,8323
 mariqt/variables.py,sha256=TtGb3UVwJnE5tmDEOxuZlCFofebgEWiKr7Soh_DFk5g,9613
-mariqt/version.py,sha256=4z8MqtGBtOcbYu_3DvdmU5SaNZeJl5pfcqzI9wsbFcc,21
+mariqt/version.py,sha256=_rttnEwgSguXibYE1VR_2TaVRucoG0htOsin70GNI50,21
 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json,sha256=HyHwLO2Wc6KWE3YBctExeEHtDNz4HQldPkczvTdpFp0,6175
 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json,sha256=qKNwXPjk7NSpYI3PYGEItxsoyPUDTzJUNaJlqloWIHA,42461
 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json,sha256=krwoig3eWpFjG61HIsdX7N-7QXFJ3v9mRZ63vham7rM,3218
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
 mariqt/sources/dship_settings.py,sha256=2vAlW0oh4iHwRCkBQnbCZ4yhXNzVi7aKPnqNrN5RwI0,4684
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=9Sj5o1Dp6LzFfboKyezjv_jrapiAtotX2akN_8ySB6A,118284
+mariqt/sources/ifdo.py,sha256=sPFTN2ujOP4Wag3agtVEoy51oNzUDanEd0HK7eNN0Zs,118335
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.5.8.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
-mariqt-0.5.8.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.5.8.dist-info/METADATA,sha256=ZT8zId2gvF4lCucZmC_laQw6hZzWG6zaI72VLqpQ1ho,1133
-mariqt-0.5.8.dist-info/WHEEL,sha256=k3vXr0c0OitO0k9eCWBlI2yTYnpb_n_I2SGzrrfY7HY,110
-mariqt-0.5.8.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.5.8.dist-info/RECORD,,
+mariqt-0.5.9.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.5.9.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.5.9.dist-info/METADATA,sha256=cPs-rHRUih8-b283VtESUFd65Lg51Gn-Aedt0i3za6E,1133
+mariqt-0.5.9.dist-info/WHEEL,sha256=k3vXr0c0OitO0k9eCWBlI2yTYnpb_n_I2SGzrrfY7HY,110
+mariqt-0.5.9.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.5.9.dist-info/RECORD,,
```

