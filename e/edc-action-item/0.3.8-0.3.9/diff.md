# Comparing `tmp/edc_action_item-0.3.8-py3-none-any.whl.zip` & `tmp/edc_action_item-0.3.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 96477 bytes, number of entries: 105
+Zip file size: 96584 bytes, number of entries: 106
 -rw-r--r--  2.0 unx      438 b- defN 21-Feb-04 14:58 edc_action_item/__init__.py
 -rw-r--r--  2.0 unx    17599 b- defN 21-Mar-01 03:05 edc_action_item/action.py
 -rw-r--r--  2.0 unx     8526 b- defN 21-Mar-01 03:05 edc_action_item/action_item_notification.py
 -rw-r--r--  2.0 unx     1651 b- defN 21-Mar-01 03:05 edc_action_item/action_with_notification.py
 -rw-r--r--  2.0 unx      175 b- defN 21-Jun-23 14:58 edc_action_item/admin_site.py
 -rw-r--r--  2.0 unx     1259 b- defN 21-Feb-04 14:58 edc_action_item/apps.py
 -rw-r--r--  2.0 unx      347 b- defN 21-Feb-04 14:58 edc_action_item/choices.py
@@ -77,31 +77,32 @@
 -rw-r--r--  2.0 unx     1095 b- defN 20-Mar-04 23:01 edc_action_item/templates/edc_action_item/bootstrap3/add_action_item_popover.html
 -rw-r--r--  2.0 unx      983 b- defN 20-May-12 13:47 edc_action_item/templates/edc_action_item/bootstrap4/action_item_control.html
 -rw-r--r--  2.0 unx        0 b- defN 20-Mar-04 23:01 edc_action_item/templatetags/__init__.py
 -rw-r--r--  2.0 unx     1610 b- defN 21-Feb-04 14:58 edc_action_item/templatetags/action_item_extras.py
 -rw-r--r--  2.0 unx      374 b- defN 21-Feb-04 14:58 edc_action_item/tests/__init__.py
 -rw-r--r--  2.0 unx     5235 b- defN 21-Mar-01 03:05 edc_action_item/tests/action_items.py
 -rw-r--r--  2.0 unx      145 b- defN 21-Feb-04 14:58 edc_action_item/tests/baker_recipes.py
--rw-r--r--  2.0 unx     4873 b- defN 21-Jul-22 21:32 edc_action_item/tests/models.py
+-rw-r--r--  2.0 unx     5172 b- defN 21-Jul-27 13:13 edc_action_item/tests/models.py
+-rw-r--r--  2.0 unx     1802 b- defN 21-Jul-27 13:13 edc_action_item/tests/test_case_mixin.py
 -rw-r--r--  2.0 unx      345 b- defN 21-Feb-04 14:58 edc_action_item/tests/urls.py
--rw-r--r--  2.0 unx     1442 b- defN 21-Feb-04 14:58 edc_action_item/tests/visit_schedule.py
+-rw-r--r--  2.0 unx     1442 b- defN 21-Jul-26 21:59 edc_action_item/tests/visit_schedule.py
 -rw-r--r--  2.0 unx        0 b- defN 20-Mar-04 23:01 edc_action_item/tests/tests/__init__.py
--rw-r--r--  2.0 unx    20174 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_action.py
--rw-r--r--  2.0 unx    13349 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_action_item.py
--rw-r--r--  2.0 unx     5840 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_action_notification.py
--rw-r--r--  2.0 unx     7040 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_data_fixers.py
--rw-r--r--  2.0 unx     3298 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_delete_action.py
--rw-r--r--  2.0 unx     9496 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_helpers.py
--rw-r--r--  2.0 unx     3253 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_longitudinal_actions.py
--rw-r--r--  2.0 unx     1965 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_natural_keys.py
--rw-r--r--  2.0 unx    10175 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_popover.py
--rw-r--r--  2.0 unx     2872 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_site_action_items.py
--rw-r--r--  2.0 unx     1755 b- defN 21-Feb-04 14:58 edc_action_item/tests/tests/test_view.py
+-rw-r--r--  2.0 unx    19826 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_action.py
+-rw-r--r--  2.0 unx    13010 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_action_item.py
+-rw-r--r--  2.0 unx     5486 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_action_notification.py
+-rw-r--r--  2.0 unx     6820 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_data_fixers.py
+-rw-r--r--  2.0 unx     3089 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_delete_action.py
+-rw-r--r--  2.0 unx     9462 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_helpers.py
+-rw-r--r--  2.0 unx     1926 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_longitudinal_actions.py
+-rw-r--r--  2.0 unx     1413 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_natural_keys.py
+-rw-r--r--  2.0 unx     9850 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_popover.py
+-rw-r--r--  2.0 unx     1543 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_site_action_items.py
+-rw-r--r--  2.0 unx     1523 b- defN 21-Jul-27 13:13 edc_action_item/tests/tests/test_view.py
 -rw-r--r--  2.0 unx       56 b- defN 20-Mar-04 23:01 edc_action_item/view_mixins/__init__.py
 -rw-r--r--  2.0 unx      939 b- defN 20-Mar-04 23:01 edc_action_item/view_mixins/action_item_view_mixin.py
--rw-r--r--  2.0 unx       78 b- defN 21-Jul-22 21:33 edc_action_item-0.3.8.dist-info/AUTHORS
--rw-r--r--  2.0 unx    35147 b- defN 21-Jul-22 21:33 edc_action_item-0.3.8.dist-info/LICENSE
--rw-r--r--  2.0 unx     7539 b- defN 21-Jul-22 21:33 edc_action_item-0.3.8.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 21-Jul-22 21:33 edc_action_item-0.3.8.dist-info/WHEEL
--rw-r--r--  2.0 unx       16 b- defN 21-Jul-22 21:33 edc_action_item-0.3.8.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    10480 b- defN 21-Jul-22 21:33 edc_action_item-0.3.8.dist-info/RECORD
-105 files, 341797 bytes uncompressed, 79263 bytes compressed:  76.8%
+-rw-r--r--  2.0 unx       78 b- defN 21-Jul-27 13:13 edc_action_item-0.3.9.dist-info/AUTHORS
+-rw-r--r--  2.0 unx    35147 b- defN 21-Jul-27 13:13 edc_action_item-0.3.9.dist-info/LICENSE
+-rw-r--r--  2.0 unx     7539 b- defN 21-Jul-27 13:13 edc_action_item-0.3.9.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 21-Jul-27 13:13 edc_action_item-0.3.9.dist-info/WHEEL
+-rw-r--r--  2.0 unx       16 b- defN 21-Jul-27 13:13 edc_action_item-0.3.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    10576 b- defN 21-Jul-27 13:13 edc_action_item-0.3.9.dist-info/RECORD
+106 files, 338725 bytes uncompressed, 79214 bytes compressed:  76.6%
```

## zipnote {}

```diff
@@ -243,14 +243,17 @@
 
 Filename: edc_action_item/tests/baker_recipes.py
 Comment: 
 
 Filename: edc_action_item/tests/models.py
 Comment: 
 
+Filename: edc_action_item/tests/test_case_mixin.py
+Comment: 
+
 Filename: edc_action_item/tests/urls.py
 Comment: 
 
 Filename: edc_action_item/tests/visit_schedule.py
 Comment: 
 
 Filename: edc_action_item/tests/tests/__init__.py
@@ -291,26 +294,26 @@
 
 Filename: edc_action_item/view_mixins/__init__.py
 Comment: 
 
 Filename: edc_action_item/view_mixins/action_item_view_mixin.py
 Comment: 
 
-Filename: edc_action_item-0.3.8.dist-info/AUTHORS
+Filename: edc_action_item-0.3.9.dist-info/AUTHORS
 Comment: 
 
-Filename: edc_action_item-0.3.8.dist-info/LICENSE
+Filename: edc_action_item-0.3.9.dist-info/LICENSE
 Comment: 
 
-Filename: edc_action_item-0.3.8.dist-info/METADATA
+Filename: edc_action_item-0.3.9.dist-info/METADATA
 Comment: 
 
-Filename: edc_action_item-0.3.8.dist-info/WHEEL
+Filename: edc_action_item-0.3.9.dist-info/WHEEL
 Comment: 
 
-Filename: edc_action_item-0.3.8.dist-info/top_level.txt
+Filename: edc_action_item-0.3.9.dist-info/top_level.txt
 Comment: 
 
-Filename: edc_action_item-0.3.8.dist-info/RECORD
+Filename: edc_action_item-0.3.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## edc_action_item/tests/models.py

```diff
@@ -3,14 +3,16 @@
 from edc_constants.choices import YES_NO
 from edc_constants.constants import YES
 from edc_crf.crf_with_action_model_mixin import CrfWithActionModelMixin
 from edc_identifier.model_mixins import NonUniqueSubjectIdentifierFieldMixin
 from edc_model.models import BaseUuidModel, HistoricalRecords
 from edc_sites.models import SiteModelMixin
 from edc_utils import get_utcnow
+from edc_visit_tracking.constants import SCHEDULED
+from edc_visit_tracking.model_mixins import VisitModelMixin
 
 from ..models import ActionModelMixin
 
 
 class SubjectIdentifierModelManager(models.Manager):
     def get_by_natural_key(self, subject_identifier):
         return self.get(subject_identifier=subject_identifier)
@@ -50,26 +52,25 @@
     SiteModelMixin,
     BaseUuidModel,
 ):
 
     action_name = "submit-form-zero"
 
 
-class AppointmentSimple(BaseUuidModel):
-
-    appt_datetime = models.DateTimeField(default=get_utcnow)
-    history = HistoricalRecords()
-
-
-class SubjectVisitSimple(SiteModelMixin, BaseUuidModel):
-
-    subject_identifier = models.CharField(max_length=25)
-
-    appointment = models.OneToOneField(AppointmentSimple, on_delete=CASCADE)
-    history = HistoricalRecords()
+# class SubjectVisit(VisitModelMixin, SiteModelMixin, BaseUuidModel):
+#
+#     appointment = models.OneToOneField(
+#         "edc_appointment.appointment", on_delete=PROTECT, related_name="D_NHJS34"
+#     )
+#
+#     report_datetime = models.DateTimeField(default=get_utcnow)
+#
+#     reason = models.CharField(max_length=25, default=SCHEDULED)
+#
+#     history = HistoricalRecords()
 
 
 class FormZero(
     NonUniqueSubjectIdentifierFieldMixin,
     ActionModelMixin,
     SiteModelMixin,
     BaseUuidModel,
@@ -156,15 +157,19 @@
 ):
 
     action_name = "my-action"
 
 
 class CrfOne(ActionModelMixin, SiteModelMixin, BaseUuidModel):
 
-    subject_visit = models.OneToOneField(SubjectVisitSimple, on_delete=CASCADE)
+    subject_visit = models.OneToOneField(
+        "edc_metadata.subjectvisit",
+        on_delete=CASCADE,
+        related_name="edc_action_item_test_visit_one",
+    )
 
     action_name = "submit-crf-one"
 
     @property
     def subject_identifier(self):
         return self.subject_visit.subject_identifier
 
@@ -175,15 +180,19 @@
     @classmethod
     def visit_model_attr(cls):
         return "subject_visit"
 
 
 class CrfTwo(ActionModelMixin, SiteModelMixin, BaseUuidModel):
 
-    subject_visit = models.OneToOneField(SubjectVisitSimple, on_delete=CASCADE)
+    subject_visit = models.OneToOneField(
+        "edc_metadata.subjectvisit",
+        on_delete=CASCADE,
+        related_name="edc_action_item_test_visit_two",
+    )
 
     action_name = "submit-crf-two"
 
     @property
     def subject_identifier(self):
         return self.subject_visit.subject_identifier
```

## edc_action_item/tests/tests/test_action.py

```diff
@@ -1,9 +1,9 @@
 from django.core.exceptions import ObjectDoesNotExist
-from django.test import TestCase, tag
+from django.test import TestCase
 from edc_constants.constants import CLOSED, NEW, NO, YES
 
 from edc_action_item.get_action_type import get_action_type
 from edc_action_item.helpers import ActionItemHelper
 from edc_action_item.models import ActionItem, ActionType
 from edc_action_item.site_action_items import site_action_items
 
@@ -12,38 +12,26 @@
     FormOneAction,
     FormThreeAction,
     FormTwoAction,
     FormZeroAction,
     SingletonAction,
     register_actions,
 )
-from ..models import (
-    FormFour,
-    FormOne,
-    FormThree,
-    FormTwo,
-    FormZero,
-    SubjectIdentifierModel,
-)
+from ..models import FormFour, FormOne, FormThree, FormTwo, FormZero
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestAction(TestCase):
+class TestAction(TestCaseMixin, TestCase):
     def setUp(self):
         register_actions()
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         self.assertIn(FormOneAction.name, site_action_items.registry)
         self.assertIn(FormTwoAction.name, site_action_items.registry)
         self.assertIn(FormThreeAction.name, site_action_items.registry)
 
-    def tearDown(self):
-        ActionItem.subject_identifier_model = self.subject_identifier_model
-
     def test_str(self):
         action = FormZeroAction(subject_identifier=self.subject_identifier)
         self.assertTrue(str(action))
 
     def test_create_or_update_action_type(self):
         site_action_items.updated_action_types = False
         site_action_items.create_or_update_action_types()
@@ -158,15 +146,15 @@
             ActionItem.objects.filter(subject_identifier=self.subject_identifier).count(),
             1,
         )
 
     def test_creates_own_action1(self):
         obj = FormOne.objects.create(subject_identifier=self.subject_identifier)
         try:
-            obj = ActionItem.objects.get(action_identifier=obj.action_identifier)
+            ActionItem.objects.get(action_identifier=obj.action_identifier)
         except ObjectDoesNotExist:
             self.fail("Action item unexpectedly does not exist")
         for name in ["submit-form-one", "submit-form-two", "submit-form-three"]:
             with self.subTest(name=name):
                 try:
                     ActionItem.objects.get(
                         subject_identifier=self.subject_identifier,
```

## edc_action_item/tests/tests/test_action_item.py

```diff
@@ -7,37 +7,26 @@
 from edc_action_item.create_or_update_action_type import create_or_update_action_type
 from edc_action_item.forms import ActionItemForm
 from edc_action_item.get_action_type import get_action_type
 from edc_action_item.models import ActionItem, ActionType, SubjectDoesNotExist
 from edc_action_item.site_action_items import site_action_items
 
 from ..action_items import FormOneAction, FormThreeAction, FormTwoAction, FormZeroAction
-from ..models import (
-    FormOne,
-    FormThree,
-    FormTwo,
-    SubjectIdentifierModel,
-    TestModelWithAction,
-)
+from ..models import FormOne, FormThree, FormTwo, TestModelWithAction
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestActionItem(TestCase):
+class TestActionItem(TestCaseMixin, TestCase):
     def setUp(self):
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         site_action_items.registry = {}
         site_action_items.register(FormZeroAction)
         get_action_type(FormZeroAction)
         self.action_type = ActionType.objects.get(name=FormZeroAction.name)
 
-    def tearDown(self):
-        ActionItem.subject_identifier_model = self.subject_identifier_model
-
     def test_creates(self):
         obj = ActionItem.objects.create(
             subject_identifier=self.subject_identifier,
             action_type=self.action_type,
             reference_model="edc_action_item.testmodel",
         )
         self.assertTrue(obj.action_identifier.startswith("AC"))
@@ -76,15 +65,15 @@
         action_type = ActionType.objects.get(name=FormOneAction.name)
         obj = ActionItem.objects.create(
             subject_identifier=self.subject_identifier, action_type=action_type
         )
         action_identifier = obj.action_identifier
         obj.save()
         try:
-            obj = ActionItem.objects.get(action_identifier=action_identifier)
+            ActionItem.objects.get(action_identifier=action_identifier)
         except ObjectDoesNotExist:
             self.fail("ActionItem unexpectedly does not exist")
 
     def test_changes_action_item_status_from_new_to_open_on_edit(self):
 
         action_type = ActionType.objects.get(name=FormZeroAction.name)
```

## edc_action_item/tests/tests/test_action_notification.py

```diff
@@ -6,31 +6,25 @@
 from edc_notification import NewModelNotification, UpdatedModelNotification
 from edc_notification.site_notifications import site_notifications
 
 from edc_action_item.action_item_notification import (
     NOTIFY_ON_CHANGED_REFERENCE_OBJ,
     NOTIFY_ON_NEW_AND_NO_REFERENCE_OBJ,
 )
-from edc_action_item.models import ActionItem
 from edc_action_item.site_action_items import site_action_items
 
 from ..action_items import FormZeroAction, register_actions
-from ..models import FormZero, SubjectIdentifierModel
+from ..models import FormZero
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestActionNotification(TestCase):
+class TestActionNotification(TestCaseMixin, TestCase):
     def setUp(self):
         register_actions()
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
-
-    def tearDown(self):
-        ActionItem.subject_identifier_model = self.subject_identifier_model
+        self.subject_identifier = self.fake_enroll()
 
     def test_sends_correct_number_of_emails(self):
 
         self.assertIn(FormZeroAction, site_action_items.registry.values())
 
         # action without reference obj
         form_zero_action = FormZeroAction(subject_identifier=self.subject_identifier)
```

## edc_action_item/tests/tests/test_data_fixers.py

```diff
@@ -2,30 +2,27 @@
 from django.db.models.signals import post_save
 from django.test import TestCase
 
 from edc_action_item.data_fixers import (
     fix_null_action_item_fk,
     fix_null_related_action_items,
 )
-from edc_action_item.models import ActionItem, update_or_create_action_item_on_post_save
+from edc_action_item.models import update_or_create_action_item_on_post_save
 
 from ..action_items import register_actions
-from ..models import FormOne, FormTwo, SubjectIdentifierModel
+from ..models import FormOne, FormTwo
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestUtils(TestCase):
+class TestUtils(TestCaseMixin, TestCase):
     def setUp(self):
         register_actions()
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
 
     def test_fix_null_related_action_items(self):
-
         form_one = FormOne.objects.create(subject_identifier=self.subject_identifier)
         form_two = FormTwo.objects.create(
             subject_identifier=self.subject_identifier, form_one=form_one
         )
         form_two.refresh_from_db()
 
         self.assertEqual(form_one.action_item, form_two.related_action_item)
```

## edc_action_item/tests/tests/test_delete_action.py

```diff
@@ -1,34 +1,33 @@
 from django.core.exceptions import ObjectDoesNotExist
 from django.db.models.deletion import ProtectedError
 from django.test import TestCase, tag
 from edc_constants.constants import CLOSED, NEW, OPEN
 
 from edc_action_item.delete_action_item import ActionItemDeleteError, delete_action_item
-from edc_action_item.models import ActionItem, ActionType
+from edc_action_item.models import ActionItem
 from edc_action_item.site_action_items import site_action_items
 from edc_action_item.tests.models import FormTwo
 
 from ..action_items import (
     FormOneAction,
     FormThreeAction,
     FormTwoAction,
     SingletonAction,
     register_actions,
 )
-from ..models import FormOne, SubjectIdentifierModel
+from ..models import FormOne
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestAction(TestCase):
+@tag("1")
+class TestAction(TestCaseMixin, TestCase):
     def setUp(self):
         register_actions()
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         self.assertIn(FormOneAction.name, site_action_items.registry)
         self.assertIn(FormTwoAction.name, site_action_items.registry)
         self.assertIn(FormThreeAction.name, site_action_items.registry)
 
     def test_reference_model_delete_resets_action_item(self):
         obj = FormOne.objects.create(subject_identifier=self.subject_identifier)
         action_item = ActionItem.objects.get(action_identifier=obj.action_identifier)
```

## edc_action_item/tests/tests/test_helpers.py

```diff
@@ -1,32 +1,25 @@
+from django.apps import apps as django_apps
 from django.test import TestCase, tag
+from edc_appointment.models import Appointment
+from edc_visit_tracking.constants import SCHEDULED
 
 from edc_action_item.helpers import ActionItemHelper
 from edc_action_item.model_wrappers import ActionItemModelWrapper
 from edc_action_item.models import ActionItem
 
 from ..action_items import CrfOneAction, FormOneAction, register_actions
-from ..models import (
-    AppointmentSimple,
-    CrfOne,
-    CrfTwo,
-    FormOne,
-    FormTwo,
-    SubjectIdentifierModel,
-    SubjectVisitSimple,
-)
+from ..models import CrfOne, CrfTwo, FormOne, FormTwo
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestHelpers(TestCase):
+class TestHelpers(TestCaseMixin, TestCase):
     def setUp(self):
         register_actions()
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         self.form_one = FormOne.objects.create(subject_identifier=self.subject_identifier)
         self.action_item = ActionItem.objects.get(
             action_identifier=self.form_one.action_identifier
         )
         self.model_wrapper = ActionItemModelWrapper(model_obj=self.action_item)
 
     def test_init(self):
@@ -96,15 +89,14 @@
             context["reference_url"].split("?")[1],
             "next=edc_action_item:subject_dashboard_url,"
             f"subject_identifier&subject_identifier={self.subject_identifier}&"
             f"action_identifier={self.action_item.action_identifier}",
         )
 
     def test_create_parent_reference_model_instance_then_delete(self):
-
         form_two = FormTwo.objects.create(
             form_one=self.form_one, subject_identifier=self.subject_identifier
         )
         action_item = ActionItem.objects.get(action_identifier=form_two.action_identifier)
 
         model_wrapper = ActionItemModelWrapper(model_obj=action_item)
         helper = ActionItemHelper(action_item=model_wrapper.object, href=model_wrapper.href)
@@ -149,34 +141,36 @@
         self.assertEqual(context["parent_reference_obj"], first_form_two)
         self.assertEqual(context["related_reference_obj"], self.form_one)
         self.assertTrue(context["reference_url"])
         self.assertTrue(context["parent_reference_url"])
         self.assertTrue(context["related_reference_url"])
 
     def test_reference_as_crf(self):
-        appointment = AppointmentSimple.objects.create()
-        subject_visit = SubjectVisitSimple.objects.create(
-            subject_identifier=self.subject_identifier, appointment=appointment
+        self.enroll()
+        appointment = Appointment.objects.all().order_by("timepoint")[0]
+        subject_visit = django_apps.get_model("edc_metadata.subjectvisit").objects.create(
+            appointment=appointment, reason=SCHEDULED
         )
         crf_one = CrfOne.objects.create(subject_visit=subject_visit)
         action_item = ActionItem.objects.get(action_identifier=crf_one.action_identifier)
         model_wrapper = ActionItemModelWrapper(model_obj=action_item)
         helper = ActionItemHelper(action_item=model_wrapper.object, href=model_wrapper.href)
         context = helper.get_context()
         self.assertEqual(context["reference_obj"], crf_one)
         self.assertIsNone(context["parent_reference_obj"])
         self.assertIsNone(context["related_reference_obj"])
         self.assertTrue(context["reference_url"])
         self.assertIsNone(context["parent_reference_url"])
         self.assertIsNone(context["related_reference_url"])
 
     def test_reference_as_crf_create_next_model_instance(self):
-        appointment = AppointmentSimple.objects.create()
-        subject_visit = SubjectVisitSimple.objects.create(
-            subject_identifier=self.subject_identifier, appointment=appointment
+        subject_identifier = self.enroll()
+        appointment = Appointment.objects.all().order_by("timepoint")[0]
+        subject_visit = django_apps.get_model("edc_metadata.subjectvisit").objects.create(
+            appointment=appointment, reason=SCHEDULED
         )
         crf_one = CrfOne.objects.create(subject_visit=subject_visit)
         crf_two = CrfTwo.objects.create(subject_visit=subject_visit)
         action_item = ActionItem.objects.get(action_identifier=crf_two.action_identifier)
         model_wrapper = ActionItemModelWrapper(model_obj=action_item)
         helper = ActionItemHelper(action_item=model_wrapper.object, href=model_wrapper.href)
         context = helper.get_context()
@@ -190,12 +184,12 @@
         self.assertEqual(
             context["parent_reference_url"].split("?")[0],
             f"/admin/edc_action_item/crfone/{str(crf_one.id)}/change/",
         )
         self.assertEqual(
             context["parent_reference_url"].split("?")[1],
             "next=edc_action_item:subject_dashboard_url,"
-            f"subject_identifier&subject_identifier={self.subject_identifier}&"
+            f"subject_identifier&subject_identifier={subject_identifier}&"
             f"action_identifier={action_item.action_identifier}&"
             f"subject_visit={str(subject_visit.pk)}&"
             f"appointment={str(appointment.pk)}",
         )
```

## edc_action_item/tests/tests/test_longitudinal_actions.py

```diff
@@ -1,79 +1,51 @@
-from django.test import TestCase, tag
+import pdb
+
+from django.apps import apps as django_apps
+from django.test import TestCase
 from edc_appointment.models import Appointment
 from edc_facility import import_holidays
-from edc_metadata.tests.models import SubjectConsent, SubjectVisit
-from edc_reference import ReferenceModelConfig, site_reference_configs
-from edc_registration.models import RegisteredSubject
-from edc_utils import get_utcnow
-from edc_visit_schedule import site_visit_schedules
 from edc_visit_tracking.constants import SCHEDULED
 
 from edc_action_item import site_action_items
 from edc_action_item.models import ActionItem
-from edc_action_item.tests.visit_schedule import visit_schedule
 
 from ..action_items import CrfLongitudinalOneAction, CrfLongitudinalTwoAction
 from ..models import CrfLongitudinalOne
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestLongitudinal(TestCase):
+class TestLongitudinal(TestCaseMixin, TestCase):
     @classmethod
     def setUpClass(cls):
         import_holidays()
         return super().setUpClass()
 
     def setUp(self):
-        ActionItem.subject_identifier_model = "edc_registration.registeredsubject"
-        site_reference_configs.registry = {}
-        reference = ReferenceModelConfig(
-            name="edc_action_item.CrfLongitudinalOne", fields=["f1", "f2", "f3"]
-        )
-        site_reference_configs.register(reference)
         site_action_items.registry = {}
         site_action_items.register(CrfLongitudinalOneAction)
         site_action_items.register(CrfLongitudinalTwoAction)
-        site_visit_schedules._registry = {}
-        site_visit_schedules.loaded = False
-        site_visit_schedules.register(visit_schedule)
-        site_reference_configs.register_from_visit_schedule(
-            visit_models={"edc_appointment.appointment": "edc_metadata.subjectvisit"}
-        )
-        self.subject_identifier = "1111111"
-        subject_consent = SubjectConsent.objects.create(
-            subject_identifier=self.subject_identifier, consent_datetime=get_utcnow()
-        )
-
-        RegisteredSubject.objects.get(subject_identifier=self.subject_identifier)
-
-        _, self.schedule = site_visit_schedules.get_by_onschedule_model(
-            "edc_metadata.onschedule"
-        )
-        self.schedule.put_on_schedule(
-            subject_identifier=self.subject_identifier,
-            onschedule_datetime=subject_consent.consent_datetime,
-        )
+        self.subject_identifier = self.enroll()
 
     def test_(self):
         appointment = Appointment.objects.get(
             subject_identifier=self.subject_identifier,
             visit_code="1000",
         )
-        subject_visit = SubjectVisit.objects.create(
+        subject_visit = django_apps.get_model("edc_metadata.subjectvisit").objects.create(
             appointment=appointment,
             reason=SCHEDULED,
         )
         crf_one_a = CrfLongitudinalOne.objects.create(subject_visit=subject_visit)
         ActionItem.objects.get(action_identifier=crf_one_a.action_identifier)
         appointment = Appointment.objects.get(
             subject_identifier=self.subject_identifier,
             visit_code="2000",
         )
-        subject_visit = SubjectVisit.objects.create(
+        subject_visit = django_apps.get_model("edc_metadata.subjectvisit").objects.create(
             appointment=appointment,
             reason=SCHEDULED,
         )
 
         crf_one_b = CrfLongitudinalOne.objects.create(subject_visit=subject_visit)
-        crf_one_b.action_identifier
         ActionItem.objects.get(action_identifier=crf_one_b.action_identifier)
         self.assertNotEqual(crf_one_a.action_identifier, crf_one_b.action_identifier)
```

## edc_action_item/tests/tests/test_natural_keys.py

```diff
@@ -1,30 +1,21 @@
-from django.test import TestCase, tag
+from django.test import TestCase
 from edc_test_utils.natural_key_test_helper import NaturalKeyTestHelper
 
-# from django_collect_offline.models import OutgoingTransaction
-# from django_collect_offline.tests import OfflineTestHelper
-from edc_action_item.get_action_type import get_action_type
-from edc_action_item.models import ActionItem
 from edc_action_item.site_action_items import site_action_items
 
-from ..action_items import FormOneAction
-from ..models import SubjectIdentifierModel
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestNaturalKey(TestCase):
+class TestNaturalKey(TestCaseMixin, TestCase):
 
-    # offline_test_helper = OfflineTestHelper()
     natural_key_helper = NaturalKeyTestHelper()
 
     def setUp(self):
-        self.subject_identifier = "12345"
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         site_action_items.registry = {}
 
     def test_natural_key_attrs(self):
         self.natural_key_helper.nk_test_natural_key_attr(
             "edc_action_item", exclude_models=["edc_action_item.subjectidentifiermodel"]
         )
```

## edc_action_item/tests/tests/test_popover.py

```diff
@@ -1,38 +1,33 @@
-from django.test import TestCase, tag
+from django.test import TestCase
 from edc_constants.constants import CLOSED, NEW, OPEN
 from edc_model_wrapper import ModelWrapper
 
-from edc_action_item.models import ActionItem, ActionType
+from edc_action_item.models import ActionItem
 from edc_action_item.site_action_items import site_action_items
 from edc_action_item.templatetags.action_item_extras import action_item_with_popover
 
 from ..action_items import (
     FormOneAction,
     FormThreeAction,
     FormTwoAction,
     register_actions,
 )
-from ..models import Followup, FormOne, FormTwo, Initial, SubjectIdentifierModel
+from ..models import Followup, FormOne, FormTwo, Initial
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestPopover(TestCase):
+class TestPopover(TestCaseMixin, TestCase):
     def setUp(self):
         register_actions()
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         self.assertIn(FormOneAction.name, site_action_items.registry)
         self.assertIn(FormTwoAction.name, site_action_items.registry)
         self.assertIn(FormThreeAction.name, site_action_items.registry)
 
-    def tearDown(self):
-        ActionItem.subject_identifier_model = self.subject_identifier_model
-
     def test_popover_templatetag(self):
         class ActionItemModelWrapper(ModelWrapper):
 
             model = "edc_action_item.actionitem"
             next_url_attrs = ["subject_identifier"]
             next_url_name = "subject_dashboard_url"
```

## edc_action_item/tests/tests/test_site_action_items.py

```diff
@@ -1,31 +1,25 @@
-from uuid import uuid4
-
 from django.core.exceptions import ObjectDoesNotExist
-from django.test import TestCase, tag
+from django.test import TestCase
 
-from edc_action_item.action import ActionError
 from edc_action_item.get_action_type import get_action_type
-from edc_action_item.models import ActionItem, ActionType
+from edc_action_item.models import ActionType
 from edc_action_item.site_action_items import (
     AlreadyRegistered,
     SiteActionError,
     site_action_items,
 )
 
 from ..action_items import FormZeroAction
-from ..models import SubjectIdentifierModel
+from ..test_case_mixin import TestCaseMixin
 
 
-class TestSiteActionItems(TestCase):
+class TestSiteActionItems(TestCaseMixin, TestCase):
     def setUp(self):
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         site_action_items.registry = {}
         get_action_type(FormZeroAction)
         self.action_type = ActionType.objects.get(name=FormZeroAction.name)
 
     def test_action_raises_if_not_registered(self):
 
         self.assertRaises(
@@ -33,43 +27,17 @@
         )
 
     def test_action_raises_if_already_registered(self):
 
         site_action_items.register(FormZeroAction)
         self.assertRaises(AlreadyRegistered, site_action_items.register, FormZeroAction)
 
-    #     def test_action_raises_if_name_changed(self):
-    #         class FormZeroAction1(FormZeroAction):
-    #             name = str(uuid4())
-    #
-    #         class FormZeroAction2(FormZeroAction):
-    #             name = str(uuid4())
-    #
-    #         site_action_items.register(FormZeroAction1)
-    #         site_action_items.register(FormZeroAction2)
-    #         FormZeroAction1.name = FormZeroAction2.name
-    #         self.assertRaises(ActionError, FormZeroAction1)
-
     def test_action_instance_creates_action_type(self):
 
         ActionType.objects.all().delete()
         self.assertRaises(ObjectDoesNotExist, ActionType.objects.get, name=FormZeroAction.name)
         site_action_items.register(FormZeroAction)
         FormZeroAction(subject_identifier=self.subject_identifier)
         try:
             ActionType.objects.get(name=FormZeroAction.name)
         except ObjectDoesNotExist:
             self.fail("Object unexpectedly does not exist.")
-
-
-#     def test_getting_action_from_registry_creates_action_type(self):
-#
-#         ActionType.objects.all().delete()
-#         self.assertRaises(
-#             ObjectDoesNotExist, ActionType.objects.get, name=FormZeroAction.name
-#         )
-#         site_action_items.register(FormZeroAction)
-#         site_action_items.get(FormZeroAction.name)
-#         try:
-#             ActionType.objects.get(name=FormZeroAction.name)
-#         except ObjectDoesNotExist:
-#             self.fail("Object unexpectedly does not exist.")
```

## edc_action_item/tests/tests/test_view.py

```diff
@@ -1,28 +1,25 @@
-from django.test import TestCase, tag
+from django.test import TestCase
 from django.urls.base import reverse
 from edc_model_wrapper import ModelWrapper
 
 from edc_action_item.models import ActionItem, ActionType
 from edc_action_item.templatetags.action_item_extras import add_action_item_popover
 from edc_action_item.view_mixins import ActionItemViewMixin
 
-from ..models import SubjectIdentifierModel
+from ..test_case_mixin import TestCaseMixin
 
 
 class MyModelWrapper(ModelWrapper):
     next_url_name = "subject_dashboard_url"
 
 
-class TestAction(TestCase):
+class TestAction(TestCaseMixin, TestCase):
     def setUp(self):
-        self.subject_identifier_model = ActionItem.subject_identifier_model
-        ActionItem.subject_identifier_model = "edc_action_item.subjectidentifiermodel"
-        self.subject_identifier = "12345"
-        SubjectIdentifierModel.objects.create(subject_identifier=self.subject_identifier)
+        self.subject_identifier = self.fake_enroll()
         ActionItemViewMixin.action_item_model_wrapper_cls = MyModelWrapper
 
     def test_view_context(self):
         view = ActionItemViewMixin()
         view.kwargs = dict(subject_identifier=self.subject_identifier)
         context = view.get_context_data()
         self.assertEqual(context.get("open_action_items"), [])
```

## Comparing `edc_action_item-0.3.8.dist-info/LICENSE` & `edc_action_item-0.3.9.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `edc_action_item-0.3.8.dist-info/METADATA` & `edc_action_item-0.3.9.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: edc-action-item
-Version: 0.3.8
+Version: 0.3.9
 Summary: Add patient action items to clinicedc/edc projects
 Home-page: http://github.com/clinicedc/edc-action-item
 Author: Erik van Widenfelt
 Author-email: ew2789@gmail.com
 License: GPL license, see LICENSE
 Keywords: django Edc action items reminders
 Platform: UNKNOWN
```

## Comparing `edc_action_item-0.3.8.dist-info/RECORD` & `edc_action_item-0.3.9.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -76,30 +76,31 @@
 edc_action_item/templates/edc_action_item/bootstrap3/add_action_item_popover.html,sha256=CEeC4KV80eJka15EZJOHmYNSgmCinnu36TN1TTZsqyw,1095
 edc_action_item/templates/edc_action_item/bootstrap4/action_item_control.html,sha256=2sMEGEKRyaO4NTYsushERBVkWYtdxao8S-7QvTGhJPU,983
 edc_action_item/templatetags/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 edc_action_item/templatetags/action_item_extras.py,sha256=Ex70dPQ4MEEKPHrQ462Lsama7RmCyVJ31f5WYp0xD7s,1610
 edc_action_item/tests/__init__.py,sha256=8YXwxSueFIDYjaBAhxPJ074S8eHBotA_cr0R0xyZLTo,374
 edc_action_item/tests/action_items.py,sha256=4Oz7IEQXjrVFTtE37gUggbVhpUCx7cblFqjZ8qlYohM,5235
 edc_action_item/tests/baker_recipes.py,sha256=8R71HeDBqIDJ0in1ud4Rr0yGcD8sbIT-D8wnEnglmjc,145
-edc_action_item/tests/models.py,sha256=4ftFvPTa3LEIhbC_AtHhUW4hlIX86jxJNMkFHbIw15U,4873
+edc_action_item/tests/models.py,sha256=IzJNbj4jgxcmn88XqNqVunepuJ_Nfq2PLkfqU2l8i8Y,5172
+edc_action_item/tests/test_case_mixin.py,sha256=-RqeHm2763aTAIJ3KfGZ9F30b23sOd3zyd3x4Qz9LxI,1802
 edc_action_item/tests/urls.py,sha256=m2SXdBKx6EDVxqnaULxZ8BGKV9KlKEDaB1rmuCG21Lg,345
 edc_action_item/tests/visit_schedule.py,sha256=da1HdXuGfaM5VCwO_P9Es3R-0MK-YM1rDDrIGLm1g5M,1442
 edc_action_item/tests/tests/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-edc_action_item/tests/tests/test_action.py,sha256=8zXx1fF88uho9-duQuI5gjNkMxlN7WyQ3MAOUkdQd5s,20174
-edc_action_item/tests/tests/test_action_item.py,sha256=pbhhVf2IIVm9FKET51QUIBJ8KCYP32Bm15P7XSocbyk,13349
-edc_action_item/tests/tests/test_action_notification.py,sha256=DfMIzTHfGTJydpBBhnqnpArVXFaLgs5zEoRfKpVnbic,5840
-edc_action_item/tests/tests/test_data_fixers.py,sha256=Lx3VkIZQz-9X-Np2FryWgw_oZYUv40RXLj_flgM-5m4,7040
-edc_action_item/tests/tests/test_delete_action.py,sha256=3xCEVdxSy1z-_By-vpvn_OdOMsln5hZJ3HyBBBbItyQ,3298
-edc_action_item/tests/tests/test_helpers.py,sha256=432gsacpD4PcguvJSb8Dhv6cb-A4xUyoBDhSp5nC7Yk,9496
-edc_action_item/tests/tests/test_longitudinal_actions.py,sha256=HRr-prwbYhoyNMbzaHgGQqM0V5kr-DBi7wg8yCIoffY,3253
-edc_action_item/tests/tests/test_natural_keys.py,sha256=ohyaFO9Ls6GYQSulCAe0_XMFTh47_rdT4IpU8Eqlr7k,1965
-edc_action_item/tests/tests/test_popover.py,sha256=_g2qJ3F3CLcPp1RXBAaVx_EuTjLbwHuZlPVEtLbkoy4,10175
-edc_action_item/tests/tests/test_site_action_items.py,sha256=bI4V6Tcif91WnclfXwSH_Nse9zyCVnpyQI04q7IsIsg,2872
-edc_action_item/tests/tests/test_view.py,sha256=V1STmmvY-GWOCr7-jpOvSUCZeORfSf9HGFlVybDTVyk,1755
+edc_action_item/tests/tests/test_action.py,sha256=n2Y9cFTsMSJmmfxF8rk9jL8zeVDzGybBcBcYn-n9HrY,19826
+edc_action_item/tests/tests/test_action_item.py,sha256=8ns3laXnjVBM_mhkWA-PVMmiShgL03kKejEKyM59_2k,13010
+edc_action_item/tests/tests/test_action_notification.py,sha256=85hcScqrhcB0SooMOK-4eZ1i9vQXuLvJhvKvW1ZpdRM,5486
+edc_action_item/tests/tests/test_data_fixers.py,sha256=2Goao8ezkdBIG-8XkNIFOIxuD0_cJ51Njnnkbp_fQnI,6820
+edc_action_item/tests/tests/test_delete_action.py,sha256=zb3yp3m8TtFMlaKGoncKDV3rZsNmOYyWx_zett8YI9I,3089
+edc_action_item/tests/tests/test_helpers.py,sha256=9DutZbtLyHvwy0jse_dgZ-I9ubtPAHOU92P0o3Y1cnw,9462
+edc_action_item/tests/tests/test_longitudinal_actions.py,sha256=t7Hr52cHlaB78D6ADhKaRWPF7W7ed28v7mqYVoNxEkk,1926
+edc_action_item/tests/tests/test_natural_keys.py,sha256=T84TcE0S28VPMAMjHuUNrhzUrk7Les0mOaEMSAQjswY,1413
+edc_action_item/tests/tests/test_popover.py,sha256=BABDxQXVujqN8T5x0-NBkqHCkr97E-VQy2hFhvbaguw,9850
+edc_action_item/tests/tests/test_site_action_items.py,sha256=fBBEMpXR4NmZAJ41kB6BTMssUe6sD_NnJZlC9ezsSSM,1543
+edc_action_item/tests/tests/test_view.py,sha256=9Bmku_XGwKBqCK_nBhFMjs7V3PriGV8_jcaHy-QzRoc,1523
 edc_action_item/view_mixins/__init__.py,sha256=lB18tgDty-131lx2mzmfjDLsiitWWVofl3ZieJTbphE,56
 edc_action_item/view_mixins/action_item_view_mixin.py,sha256=XSSksvIcsLPcWciYjOYz2avGrwxidCuY2v6iEvyf_KI,939
-edc_action_item-0.3.8.dist-info/AUTHORS,sha256=IWtTZeKr1_ITBU3AdIl5RzbMIXtH5U7n0ctpZ29qS9Y,78
-edc_action_item-0.3.8.dist-info/LICENSE,sha256=jOtLnuWt7d5Hsx6XXB2QxzrSe2sWWh3NgMfFRetluQM,35147
-edc_action_item-0.3.8.dist-info/METADATA,sha256=BUQ1vF9yElBgFCboI75Ff9Tyl8bWb6CH-xYGymeqK78,7539
-edc_action_item-0.3.8.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
-edc_action_item-0.3.8.dist-info/top_level.txt,sha256=dAbAcoWs8NskESSwWA_713pd98DncbBGpB7cel-nzD0,16
-edc_action_item-0.3.8.dist-info/RECORD,,
+edc_action_item-0.3.9.dist-info/AUTHORS,sha256=IWtTZeKr1_ITBU3AdIl5RzbMIXtH5U7n0ctpZ29qS9Y,78
+edc_action_item-0.3.9.dist-info/LICENSE,sha256=jOtLnuWt7d5Hsx6XXB2QxzrSe2sWWh3NgMfFRetluQM,35147
+edc_action_item-0.3.9.dist-info/METADATA,sha256=We2JGLEFixC53cLxgNJ89Jg-zs_DwnVhFtsqgzz8vXI,7539
+edc_action_item-0.3.9.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
+edc_action_item-0.3.9.dist-info/top_level.txt,sha256=dAbAcoWs8NskESSwWA_713pd98DncbBGpB7cel-nzD0,16
+edc_action_item-0.3.9.dist-info/RECORD,,
```

